{"blogid": "122125911", "writerAge": "码龄7年", "writerBlogNum": "2", "writerCollect": "116", "writerComment": "18", "writerFan": "19", "writerGrade": "1级", "writerIntegral": "52", "writerName": "FuYongqing0412", "writerProfileAdress": "writer_image\\profile_122125911.jpg", "writerRankTotal": "255415", "writerRankWeekly": "89919", "writerThumb": "13", "writerVisitNum": "9004", "blog_read_count": "5420", "blog_time": "已于 2022-02-01 14:20:42 修改", "blog_title": "六轴UR机械臂标准DH正逆运动学公式推导+代码验证C++", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"DH%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D-toc\" style=\"margin-left:0px;\"><a href=\"#DH%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D\">DH参数介绍</a></p>\n<p id=\"%E6%AF%8F%E4%B8%AA%E8%BF%9E%E6%9D%86%E6%9C%89%E5%9B%9B%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8C%E7%AC%ACi%E4%B8%AA%E8%BF%9E%E6%9D%86%EF%BC%9A-toc\" style=\"margin-left:80px;\"></p>\n<p id=\"%C2%A0%E6%AD%A3%E8%BF%90%E5%8A%A8%E5%AD%A6-toc\" style=\"margin-left:0px;\"><a href=\"#%C2%A0%E6%AD%A3%E8%BF%90%E5%8A%A8%E5%AD%A6\"> 正运动学</a></p>\n<p id=\"%E4%BB%A3%E7%A0%81-toc\" style=\"margin-left:80px;\"><a href=\"#%E4%BB%A3%E7%A0%81\">代码</a></p>\n<p id=\"%E6%B5%8B%E8%AF%95-toc\" style=\"margin-left:80px;\"><a href=\"#%E6%B5%8B%E8%AF%95\">测试</a></p>\n<p id=\"%C2%A0%E9%80%86%E8%BF%90%E5%8A%A8%E5%AD%A6-toc\" style=\"margin-left:0px;\"><a href=\"#%C2%A0%E9%80%86%E8%BF%90%E5%8A%A8%E5%AD%A6\"> 逆运动学</a></p>\n<p id=\"%E5%8F%98%E6%8D%A2%E7%9F%A9%E9%98%B5-toc\" style=\"margin-left:80px;\"><a href=\"#%E5%8F%98%E6%8D%A2%E7%9F%A9%E9%98%B5\">变换矩阵</a></p>\n<p id=\"%E6%B1%82%E9%80%86%E8%A7%A3%E6%97%B6%E4%B8%80%E5%AE%9A%E8%A6%81%E7%94%A8atan2()%E6%9D%A5%E6%B1%82%E8%A7%A3%EF%BC%8CEigen%E5%BA%93%E4%B8%AD%E8%87%AA%E5%B8%A6%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E3%80%82%E5%8E%9F%E7%90%86%E5%8F%AF%E5%8F%82%E8%80%83UR%E6%9C%BA%E6%A2%B0%E8%87%82%E6%AD%A3%E9%80%86%E8%BF%90%E5%8A%A8%E5%AD%A6%E6%B1%82%E8%A7%A3_fengyu19930920%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2_%E6%9C%BA%E6%A2%B0%E8%87%82%E6%AD%A3%E9%80%86%E8%BF%90%E5%8A%A8%E5%AD%A6-toc\" style=\"margin-left:80px;\"></p>\n<p id=\"%E5%85%B3%E8%8A%821%E7%9A%84%E6%B1%82%E8%A7%A3-toc\" style=\"margin-left:80px;\"><a href=\"#%E5%85%B3%E8%8A%821%E7%9A%84%E6%B1%82%E8%A7%A3\">关节1的求解</a></p>\n<p id=\"%E5%85%B3%E8%8A%825%E7%9A%84%E6%B1%82%E8%A7%A3-toc\" style=\"margin-left:80px;\"><a href=\"#%E5%85%B3%E8%8A%825%E7%9A%84%E6%B1%82%E8%A7%A3\">关节5的求解</a></p>\n<p id=\"%E5%85%B3%E8%8A%826%E7%9A%84%E6%B1%82%E8%A7%A3-toc\" style=\"margin-left:80px;\"><a href=\"#%E5%85%B3%E8%8A%826%E7%9A%84%E6%B1%82%E8%A7%A3\">关节6的求解</a></p>\n<p id=\"%E5%85%B3%E8%8A%823%E7%9A%84%E6%B1%82%E8%A7%A3-toc\" style=\"margin-left:80px;\"><a href=\"#%E5%85%B3%E8%8A%823%E7%9A%84%E6%B1%82%E8%A7%A3\">关节3的求解</a></p>\n<p id=\"%E5%85%B3%E8%8A%822%E7%9A%84%E6%B1%82%E8%A7%A3-toc\" style=\"margin-left:80px;\"><a href=\"#%E5%85%B3%E8%8A%822%E7%9A%84%E6%B1%82%E8%A7%A3\">关节2的求解</a></p>\n<p id=\"%E5%85%B3%E8%8A%824%E7%9A%84%E6%B1%82%E8%A7%A3-toc\" style=\"margin-left:80px;\"><a href=\"#%E5%85%B3%E8%8A%824%E7%9A%84%E6%B1%82%E8%A7%A3\">关节4的求解</a></p>\n<p id=\"%E6%AD%A3%E9%80%86%E8%A7%A3%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-toc\" style=\"margin-left:80px;\"><a href=\"#%E6%AD%A3%E9%80%86%E8%A7%A3%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81\">正逆解完整代码</a></p>\n<p id=\"%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C-toc\" style=\"margin-left:80px;\"><a href=\"#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C\">测试结果</a></p>\n<p id=\"%E4%B8%8D%E8%B6%B3%E4%B9%8B%E5%A4%84-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%8D%E8%B6%B3%E4%B9%8B%E5%A4%84\">不足之处</a></p>\n<p id=\"%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E9%93%BE%E6%8E%A5-toc\" style=\"margin-left:80px;\"><a href=\"#%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E9%93%BE%E6%8E%A5\">一些有用链接</a></p>\n<hr id=\"hr-toc\"/>\n<p>最近做项目需要用到UR5的逆解，在网上找资料自己实现碰到一堆坑，现在终于完美解决。本文用的是标准DH参数，包含从末端位姿变换到关节角的全部过程，网上许多教程都是用正运动学算出的变换矩阵进行逆运动学求解，在我的项目中完全没有办法应用。其中UR末端姿态有两种表示方法，这也是排查了好久才找到的问题。现在将完整过程分享出来，希望可以帮到和我遇到同样问题的小伙伴。URsim使用及安装可参考我另一篇博客<a href=\"https://blog.csdn.net/sinat_32804425/article/details/122145759?spm=1001.2014.3001.5502\" title=\"URSim+Unity联合仿真以及Socket通信_sinat_32804425的博客-CSDN博客\">URSim+Unity联合仿真以及Socket通信_sinat_32804425的博客-CSDN博客</a></p>\n<p>（改进DH参数方法可参考<a href=\"https://blog.csdn.net/u011779517/article/details/111116938?spm=1001.2014.3001.5501\" title=\"UR3机械臂正逆运动学详解及c++完整代码_Scolin丶-CSDN博客_ur3机械臂\">UR3机械臂正逆运动学详解及c++完整代码_Scolin丶-CSDN博客_ur3机械臂</a>)</p>\n<h1 id=\"DH%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D\">DH参数介绍</h1>\n<h2>改进DH</h2>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"458\" src=\"image\\c39a4ec47c7c47539b8ef4e5a6bc4584.png\" width=\"789\"/></p>\n<p> 图源《机器人学导论》</p>\n<p>参考<a href=\"https://blog.csdn.net/qq_35865125/article/details/82720485\" title=\"Universial robot 运动学_Peace-CSDN博客\">Universial robot 运动学_Peace-CSDN博客</a>，此处是为了方便对比。</p>\n<ul><li> 第i个坐标系固连在第i个连杆的<strong>左端</strong>。</li><li>轴i固连于i-1杆，在i-1杆的右端。 </li><li>i坐标系固定在i杆上，随i杆转动。</li></ul>\n<h3 id=\"%E6%AF%8F%E4%B8%AA%E8%BF%9E%E6%9D%86%E6%9C%89%E5%9B%9B%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8C%E7%AC%ACi%E4%B8%AA%E8%BF%9E%E6%9D%86%EF%BC%9A\">每个连杆有四个参数，第i个连杆：</h3>\n<ol><li><strong>ai = (沿着Xi轴，从Zi移动到Zi+1的距离)  ，即 连杆i的抽象长度。</strong></li><li><strong>αi= (从Zi旋转到Zi+1的角度，转轴为Xi，右手定则)，即 连杆i与连杆i+1的夹角。</strong></li><li><strong>di = (沿着Zi轴，从Xi-1移动至Xi的距离)， Xi-1和Xi都是垂于Zi的。</strong></li><li><strong>θi = (绕Zi轴，从Xi-1旋转至Xi的角度)，即连杆i-1与连杆i的夹角。</strong></li></ol>\n<p>前两个参数的作用是建立 i系与i+1系的关系；</p>\n<p>后两个参数的作用是建立i-1系与i系的关系； </p>\n<h2>标准DH</h2>\n<p><img alt=\"\" height=\"625\" src=\"image\\fd32e6bdfaf3403a80e7af77dcb3349e.png\" width=\"852\"/></p>\n<p> 图源<a href=\"https://en.wikipedia.org/wiki/Denavit%E2%80%93Hartenberg_parameters\" title=\"https://en.wikipedia.org/wiki/Denavit%E2%80%93Hartenberg_parameters\">https://en.wikipedia.org/wiki/Denavit%E2%80%93Hartenberg_parameters</a></p>\n<p><strong>坐标系的建立：</strong></p>\n<p>z轴指向旋转轴。</p>\n<p>基座的x轴可以自由选择，之后的x轴与两个连续z轴的公垂线共线。</p>\n<p>原点选在公垂线与新z轴的交点，<strong>注意不在关节的中心，可以在空间的任何地方</strong>。</p>\n<p>y轴由右手定则给出。</p>\n<h3>有了这些关节坐标系，就可以得到由以下四个变量决定的关节之间的转换：</h3>\n<ul><li><strong>di : 沿着Zi-1轴，原点Oi-1至公垂线的距离。</strong></li><li><strong>θi : 绕Zi-1轴，从Xi-1旋转至Xi的角度。</strong></li><li><strong>ai : 沿着Xi轴，从Zi-1移动至Zi的距离， 即 连杆Linki关于Zi-1的旋转半径。</strong></li><li><strong>αi : 绕Xi轴，从Zi-1旋转到Zi的角度。</strong></li></ul>\n<p><strong>特殊情况：如果Z轴是平行的，那选择最方便的那个di。此时的αi一定是0。</strong></p>\n<p>辅助理解动画</p>\n<p><a class=\"has-card\" href=\"https://www.youtube.com/watch?v=rA9tm0gTln8\" title=\"https://www.youtube.com/watch?v=rA9tm0gTln8\"><span class=\"link-card-box\"><span class=\"link-title\">https://www.youtube.com/watch?v=rA9tm0gTln8</span><span class=\"link-link\"><img alt=\"icon-default.png?t=M0H8\" class=\"link-link-icon\" src=\"image\\icon-default.png\"/>https://www.youtube.com/watch?v=rA9tm0gTln8</span></span></a></p>\n<p>下图是官方给的UR机械臂坐标系位置</p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"471\" src=\"image\\4bdfd55d5faf4dcd858c51332984b200.png\" width=\"945\"/></p>\n<p></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"426\" src=\"image\\ee6b181398c0444da6ab38eb4bb01ea9.png\" width=\"942\"/></p>\n<p></p>\n<p> UR5的DH参数如下表所示 ，其他型号可以参考<a href=\"https://www.universal-robots.com/articles/ur/application-installation/dh-parameters-for-calculations-of-kinematics-and-dynamics/\" title=\"Universal Robots - DH Parameters for calculations of kinematics and dynamics\">Universal Robots - DH Parameters for calculations of kinematics and dynamics</a></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"313\" src=\"image\\ebf7d4c6b30b463db9d23dd4921f78ac.png\" width=\"906\"/></p>\n<h1 id=\"%C2%A0%E6%AD%A3%E8%BF%90%E5%8A%A8%E5%AD%A6\"> 正运动学</h1>\n<p>已知关节角度求变换矩阵T，根据标准DH参数法，可以得到坐标系i-1到i的变换矩阵<img alt=\"{ }_{i}^{i-1} T=\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7Bi%7D%5E%7Bi-1%7D%20T%3D\"/></p>\n<p style=\"text-align:center;\"><img alt=\"\\left[\\begin{array}{cccc} \\cos \\theta_{i} &amp; -\\sin \\theta_{i} \\cos \\alpha_{i} &amp; \\sin \\theta_{i} \\sin \\alpha_{i} &amp; a_{i} \\cos \\theta_{i} \\\\ \\sin \\theta_{i} &amp; \\cos \\theta_{i} \\cos \\alpha_{i} &amp; -\\cos \\theta_{i} \\sin \\alpha_{i} &amp; a_{i} \\sin \\theta_{i} \\\\ 0 &amp; \\sin \\alpha_{i} &amp; \\cos \\alpha_{i} &amp; d_{i} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20%5Ccos%20%5Ctheta_%7Bi%7D%20%26%20-%5Csin%20%5Ctheta_%7Bi%7D%20%5Ccos%20%5Calpha_%7Bi%7D%20%26%20%5Csin%20%5Ctheta_%7Bi%7D%20%5Csin%20%5Calpha_%7Bi%7D%20%26%20a_%7Bi%7D%20%5Ccos%20%5Ctheta_%7Bi%7D%20%5C%5C%20%5Csin%20%5Ctheta_%7Bi%7D%20%26%20%5Ccos%20%5Ctheta_%7Bi%7D%20%5Ccos%20%5Calpha_%7Bi%7D%20%26%20-%5Ccos%20%5Ctheta_%7Bi%7D%20%5Csin%20%5Calpha_%7Bi%7D%20%26%20a_%7Bi%7D%20%5Csin%20%5Ctheta_%7Bi%7D%20%5C%5C%200%20%26%20%5Csin%20%5Calpha_%7Bi%7D%20%26%20%5Ccos%20%5Calpha_%7Bi%7D%20%26%20d_%7Bi%7D%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p> 所以正运动学可以求得<img alt=\"{ }_{6}^{0} T={ }_{1}^{0} T \\times{ }_{2}^{1} T \\times{ }_{3}^{2} T \\times{ }_{4}^{3} T \\times{ }_{5}^{4} T \\times{ }_{6}^{5} T\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B6%7D%5E%7B0%7D%20T%3D%7B%20%7D_%7B1%7D%5E%7B0%7D%20T%20%5Ctimes%7B%20%7D_%7B2%7D%5E%7B1%7D%20T%20%5Ctimes%7B%20%7D_%7B3%7D%5E%7B2%7D%20T%20%5Ctimes%7B%20%7D_%7B4%7D%5E%7B3%7D%20T%20%5Ctimes%7B%20%7D_%7B5%7D%5E%7B4%7D%20T%20%5Ctimes%7B%20%7D_%7B6%7D%5E%7B5%7D%20T\"/>，只要知道六个关节角，就可以求出变换矩阵</p>\n<p style=\"text-align:center;\"><img alt=\"{ }_{6}^{0} T=\\left[\\begin{array}{cccc} n_{x} &amp; o_{x} &amp; a_{x} &amp; p_{x} \\\\ n_{y} &amp; o_{y} &amp; a_{y} &amp; p_{y} \\\\ n_{z} &amp; o_{z} &amp; a_{z} &amp; p_{z} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B6%7D%5E%7B0%7D%20T%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20n_%7Bx%7D%20%26%20o_%7Bx%7D%20%26%20a_%7Bx%7D%20%26%20p_%7Bx%7D%20%5C%5C%20n_%7By%7D%20%26%20o_%7By%7D%20%26%20a_%7By%7D%20%26%20p_%7By%7D%20%5C%5C%20n_%7Bz%7D%20%26%20o_%7Bz%7D%20%26%20a_%7Bz%7D%20%26%20p_%7Bz%7D%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<h3 id=\"%E4%BB%A3%E7%A0%81\">代码</h3>\n<p>可自行下载，链接如下：</p>\n<p><a href=\"https://download.csdn.net/download/sinat_32804425/70045943\" title=\"https://download.csdn.net/download/sinat_32804425/70045943\">https://download.csdn.net/download/sinat_32804425/70045943</a></p>\n<h3 id=\"%E6%B5%8B%E8%AF%95\">测试</h3>\n<p>在URSim上打开UR5的虚拟机，进入到move界面，选择Base基座坐标系，随意设置一个姿态，将六个关节角输入，可以检验正运动学计算正确与否。</p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"674\" src=\"image\\b1a09e85b1c3454ab9a005e91b414bb6.png\" width=\"802\"/></p>\n<p></p>\n<p> 运行正运动学程序，输入：93.14 -62.68 108.27 -135.56 -66.46 15.59</p>\n<p> 将变换矩阵T前三行打印出来，可以看到最后的位置与URSim中TCP的三个位置相同。</p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"213\" src=\"image\\08c713fe52fe4d13818999b2ace9baa1.png\" width=\"764\"/></p>\n<h1 id=\"%C2%A0%E9%80%86%E8%BF%90%E5%8A%A8%E5%AD%A6\"> 逆运动学</h1>\n<p>逆运动学就是已知末端的位姿，求六个关节角的过程，一般都会求出八组解，但是只有一组是最优解，通常试两次就可确定哪一组。</p>\n<h3 id=\"%E5%8F%98%E6%8D%A2%E7%9F%A9%E9%98%B5\">变换矩阵</h3>\n<p>根据末端执行器的位姿（绕静轴的姿态），求解末端坐标系到基座坐标系的变换矩阵。这里推荐一个视频，可以帮助理解绕静轴和 绕动轴两种变换方式<a href=\"https://www.bilibili.com/video/BV1oa4y1v7TY?p=2\" title=\"【机械臂运动学教程】机械臂+旋转矩阵+变换矩阵+DH+逆解+轨迹规划+机器人+教程_哔哩哔哩_bilibili\">【机械臂运动学教程】机械臂+旋转矩阵+变换矩阵+DH+逆解+轨迹规划+机器人+教程_哔哩哔哩_bilibili</a></p>\n<p>在URSim中也有两种表示位姿的方式，一种是Rotation Vector，另一种是RPY。所谓RPY就是绕参考坐标系，绕定轴X（Roll）—Y（Pitch）—Z（Yaw）旋转，旋转矩阵左乘。<strong>我们计算变换矩阵一定要采用RPY[rad]这种模式下的姿态角，要不然始终会有问题。</strong>RPY是绕静轴的一种旋转方式，理解可参考<a href=\"https://blog.csdn.net/lyhbkz/article/details/83542248\" title=\"机器人RPY角和Euler角 -- 基本公式_lyhbkz的博客-CSDN博客_rpy\">机器人RPY角和Euler角 -- 基本公式_lyhbkz的博客-CSDN博客_rpy</a>和<a href=\"https://blog.csdn.net/m0_37764065/article/details/107207404\" title=\"【机器人运动学/姿态角】欧拉角和RPY角_Amanda1m的博客-CSDN博客_rpy角\">【机器人运动学/姿态角】欧拉角和RPY角_Amanda1m的博客-CSDN博客_rpy角</a></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"674\" src=\"image\\ef7e6eae1bcf4d048008cf26397e8403.png\" width=\"802\"/></p>\n<p> 我这里采用绕静轴RPY的公式来计算旋转矩阵</p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"387\" src=\"image\\d4041684d434408999c8b0899ce3da88.png\" width=\"1008\"/></p>\n<p> 则位姿为<img alt=\"\\left[p_{x}, p_{y}, p_{z}, \\gamma, \\beta, \\alpha\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Cleft%5Bp_%7Bx%7D%2C%20p_%7By%7D%2C%20p_%7Bz%7D%2C%20%5Cgamma%2C%20%5Cbeta%2C%20%5Calpha%5Cright%5D\"/>时，旋转矩阵可以由如下公式计算得出。</p>\n<p style=\"text-align:center;\"><img alt=\"{ }_{6}^{0} R=\\left[\\begin{array}{lll} n_{x} &amp; o_{x} &amp; a_{x} \\\\ n_{y} &amp; o_{y} &amp; a_{y} \\\\ n_{z} &amp; o_{z} &amp; a_{z} \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B6%7D%5E%7B0%7D%20R%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Blll%7D%20n_%7Bx%7D%20%26%20o_%7Bx%7D%20%26%20a_%7Bx%7D%20%5C%5C%20n_%7By%7D%20%26%20o_%7By%7D%20%26%20a_%7By%7D%20%5C%5C%20n_%7Bz%7D%20%26%20o_%7Bz%7D%20%26%20a_%7Bz%7D%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p style=\"text-align:center;\"><img alt=\"=\\left[\\begin{array}{ccc} c \\alpha c \\beta &amp; c \\alpha s \\beta s \\gamma-s \\alpha c \\gamma &amp; c \\alpha s \\beta c \\gamma+s \\alpha s \\gamma \\\\ s \\alpha c \\beta &amp; s \\alpha s \\beta s \\gamma+c \\alpha c \\gamma &amp; s \\alpha s \\beta c \\gamma-c \\alpha s \\gamma \\\\ -s \\beta &amp; c \\beta s \\gamma &amp; c \\beta c \\gamma \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bccc%7D%20c%20%5Calpha%20c%20%5Cbeta%20%26%20c%20%5Calpha%20s%20%5Cbeta%20s%20%5Cgamma-s%20%5Calpha%20c%20%5Cgamma%20%26%20c%20%5Calpha%20s%20%5Cbeta%20c%20%5Cgamma&amp;plus;s%20%5Calpha%20s%20%5Cgamma%20%5C%5C%20s%20%5Calpha%20c%20%5Cbeta%20%26%20s%20%5Calpha%20s%20%5Cbeta%20s%20%5Cgamma&amp;plus;c%20%5Calpha%20c%20%5Cgamma%20%26%20s%20%5Calpha%20s%20%5Cbeta%20c%20%5Cgamma-c%20%5Calpha%20s%20%5Cgamma%20%5C%5C%20-s%20%5Cbeta%20%26%20c%20%5Cbeta%20s%20%5Cgamma%20%26%20c%20%5Cbeta%20c%20%5Cgamma%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p>至此得到了变换矩阵T，下面开始逐步计算关节角。下列公式参考<a href=\"https://www.guyuehome.com/6827\" title=\"UR5型六轴机械臂运动学推导及效果演示 - 古月居\">UR5型六轴机械臂运动学推导及效果演示 - 古月居</a></p>\n<h3 id=\"%E6%B1%82%E9%80%86%E8%A7%A3%E6%97%B6%E4%B8%80%E5%AE%9A%E8%A6%81%E7%94%A8atan2()%E6%9D%A5%E6%B1%82%E8%A7%A3%EF%BC%8CEigen%E5%BA%93%E4%B8%AD%E8%87%AA%E5%B8%A6%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E3%80%82%E5%8E%9F%E7%90%86%E5%8F%AF%E5%8F%82%E8%80%83UR%E6%9C%BA%E6%A2%B0%E8%87%82%E6%AD%A3%E9%80%86%E8%BF%90%E5%8A%A8%E5%AD%A6%E6%B1%82%E8%A7%A3_fengyu19930920%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2_%E6%9C%BA%E6%A2%B0%E8%87%82%E6%AD%A3%E9%80%86%E8%BF%90%E5%8A%A8%E5%AD%A6\"><strong>求逆解时一定要用atan2()来求解，Eigen库中自带这个函数。原理可参考</strong><a href=\"https://blog.csdn.net/fengyu19930920/article/details/81144042\" title=\"UR机械臂正逆运动学求解_fengyu19930920的博客-CSDN博客_机械臂正逆运动学\">UR机械臂正逆运动学求解_fengyu19930920的博客-CSDN博客_机械臂正逆运动学</a></h3>\n<h3 id=\"%E5%85%B3%E8%8A%821%E7%9A%84%E6%B1%82%E8%A7%A3\">关节1的求解</h3>\n<p>已知</p>\n<p style=\"text-align:center;\"><img alt=\"{ }_{6}^{0} T=\\left[\\begin{array}{cccc} n_{x} &amp; o_{x} &amp; a_{x} &amp; p_{x} \\\\ n_{y} &amp; o_{y} &amp; a_{y} &amp; p_{y} \\\\ n_{z} &amp; o_{z} &amp; a_{z} &amp; p_{z} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right]={ }_{1}^{0} T \\cdot{ }_{2}^{1} T \\cdot{ }_{3}^{2} T \\cdot{ }_{4}^{3} T \\cdot{ }_{5}^{4} T \\cdot{ }_{6}^{5} T\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B6%7D%5E%7B0%7D%20T%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20n_%7Bx%7D%20%26%20o_%7Bx%7D%20%26%20a_%7Bx%7D%20%26%20p_%7Bx%7D%20%5C%5C%20n_%7By%7D%20%26%20o_%7By%7D%20%26%20a_%7By%7D%20%26%20p_%7By%7D%20%5C%5C%20n_%7Bz%7D%20%26%20o_%7Bz%7D%20%26%20a_%7Bz%7D%20%26%20p_%7Bz%7D%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D%3D%7B%20%7D_%7B1%7D%5E%7B0%7D%20T%20%5Ccdot%7B%20%7D_%7B2%7D%5E%7B1%7D%20T%20%5Ccdot%7B%20%7D_%7B3%7D%5E%7B2%7D%20T%20%5Ccdot%7B%20%7D_%7B4%7D%5E%7B3%7D%20T%20%5Ccdot%7B%20%7D_%7B5%7D%5E%7B4%7D%20T%20%5Ccdot%7B%20%7D_%7B6%7D%5E%7B5%7D%20T\"/></p>\n<p>则                                                                                                <img alt=\"{ }_{1}^{0} T^{-1} \\cdot T \\cdot{ }_{6}^{5} T^{-1}={ }_{5}^{1} T={ }_{2}^{1} T \\cdot{ }_{3}^{2} T \\cdot{ }_{4}^{3} T \\cdot{ }_{5}^{4} T\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B1%7D%5E%7B0%7D%20T%5E%7B-1%7D%20%5Ccdot%20T%20%5Ccdot%7B%20%7D_%7B6%7D%5E%7B5%7D%20T%5E%7B-1%7D%3D%7B%20%7D_%7B5%7D%5E%7B1%7D%20T%3D%7B%20%7D_%7B2%7D%5E%7B1%7D%20T%20%5Ccdot%7B%20%7D_%7B3%7D%5E%7B2%7D%20T%20%5Ccdot%7B%20%7D_%7B4%7D%5E%7B3%7D%20T%20%5Ccdot%7B%20%7D_%7B5%7D%5E%7B4%7D%20T\"/></p>\n<p style=\"text-align:center;\"><img alt=\"{ }_{1}^{0} T^{-1}=\\left[\\begin{array}{cccc} \\cos \\theta_{1} &amp; \\sin \\theta_{1} &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 1 &amp; -d_{1} \\\\ \\sin \\theta_{1} &amp; -\\cos \\theta_{1} &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right],{ }_{6}^{5} T^{-1}=\\left[\\begin{array}{cccc} \\cos \\theta_{6} &amp; \\sin \\theta_{6} &amp; 0 &amp; 0 \\\\ -\\sin \\theta_{6} &amp; \\cos \\theta_{6} &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 1 &amp; -d_{6} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B1%7D%5E%7B0%7D%20T%5E%7B-1%7D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20%5Ccos%20%5Ctheta_%7B1%7D%20%26%20%5Csin%20%5Ctheta_%7B1%7D%20%26%200%20%26%200%20%5C%5C%200%20%26%200%20%26%201%20%26%20-d_%7B1%7D%20%5C%5C%20%5Csin%20%5Ctheta_%7B1%7D%20%26%20-%5Ccos%20%5Ctheta_%7B1%7D%20%26%200%20%26%200%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D%2C%7B%20%7D_%7B6%7D%5E%7B5%7D%20T%5E%7B-1%7D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20%5Ccos%20%5Ctheta_%7B6%7D%20%26%20%5Csin%20%5Ctheta_%7B6%7D%20%26%200%20%26%200%20%5C%5C%20-%5Csin%20%5Ctheta_%7B6%7D%20%26%20%5Ccos%20%5Ctheta_%7B6%7D%20%26%200%20%26%200%20%5C%5C%200%20%26%200%20%26%201%20%26%20-d_%7B6%7D%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p>所以<img alt=\"{ }_{1}^{0} T^{-1} \\cdot T \\cdot{ }_{6}^{5} T^{-1}=\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B1%7D%5E%7B0%7D%20T%5E%7B-1%7D%20%5Ccdot%20T%20%5Ccdot%7B%20%7D_%7B6%7D%5E%7B5%7D%20T%5E%7B-1%7D%3D\"/></p>\n<p style=\"text-align:center;\"><img alt=\"\\left[\\begin{array}{cccc} c_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)-s_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right) &amp; s_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)+c_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right) &amp; a_{x} c_{1}+a_{y} s_{1} &amp; p_{x} c_{1}-d_{6}\\left(a_{x} c_{1}+a_{y} s_{1}\\right)+p_{y} s_{1} \\\\ n_{x} c_{6}-o_{z} s_{6} &amp; o_{z} c_{6}+n_{z} s_{6} &amp; a_{z} &amp; p_{z}-d_{1}-a_{z} d_{6} \\\\ s_{6}\\left(o_{y} c_{1}-o_{x} s_{1}\\right)-c_{6}\\left(n_{y} c_{1}-n_{x} s_{1}\\right) &amp; -s_{6}\\left(n_{y} c_{1}-n_{x} s_{1}\\right)-c_{6}\\left(o_{y} c_{1}-o_{x} s_{1}\\right) &amp; a_{x} s_{1}-a_{y} c_{1} &amp; -p_{y} c_{1}+d_{6}\\left(a_{y} c_{1}-a_{x} s_{1}\\right)+p_{x} s_{1} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20c_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29-s_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%20%26%20s_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;c_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%20%26%20a_%7Bx%7D%20c_%7B1%7D&amp;plus;a_%7By%7D%20s_%7B1%7D%20%26%20p_%7Bx%7D%20c_%7B1%7D-d_%7B6%7D%5Cleft%28a_%7Bx%7D%20c_%7B1%7D&amp;plus;a_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;p_%7By%7D%20s_%7B1%7D%20%5C%5C%20n_%7Bx%7D%20c_%7B6%7D-o_%7Bz%7D%20s_%7B6%7D%20%26%20o_%7Bz%7D%20c_%7B6%7D&amp;plus;n_%7Bz%7D%20s_%7B6%7D%20%26%20a_%7Bz%7D%20%26%20p_%7Bz%7D-d_%7B1%7D-a_%7Bz%7D%20d_%7B6%7D%20%5C%5C%20s_%7B6%7D%5Cleft%28o_%7By%7D%20c_%7B1%7D-o_%7Bx%7D%20s_%7B1%7D%5Cright%29-c_%7B6%7D%5Cleft%28n_%7By%7D%20c_%7B1%7D-n_%7Bx%7D%20s_%7B1%7D%5Cright%29%20%26%20-s_%7B6%7D%5Cleft%28n_%7By%7D%20c_%7B1%7D-n_%7Bx%7D%20s_%7B1%7D%5Cright%29-c_%7B6%7D%5Cleft%28o_%7By%7D%20c_%7B1%7D-o_%7Bx%7D%20s_%7B1%7D%5Cright%29%20%26%20a_%7Bx%7D%20s_%7B1%7D-a_%7By%7D%20c_%7B1%7D%20%26%20-p_%7By%7D%20c_%7B1%7D&amp;plus;d_%7B6%7D%5Cleft%28a_%7By%7D%20c_%7B1%7D-a_%7Bx%7D%20s_%7B1%7D%5Cright%29&amp;plus;p_%7Bx%7D%20s_%7B1%7D%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p>而</p>\n<p style=\"text-align:center;\"><img alt=\"{ }_{2}^{1} T \\cdot{ }_{3}^{2} T \\cdot{ }_{4}^{3} T \\cdot{ }_{5}^{4} T=\\left[\\begin{array}{cccc} c_{234} c_{5} &amp; -s_{234} &amp; -c_{234} s_{5} &amp; a_{3} c_{23}+a_{2} c_{2}+d_{2} s_{234} \\\\ s_{234} c_{5} &amp; c_{234} &amp; -s_{234} s_{5} &amp; a_{3} s_{23}+a_{2} s_{2}-d_{5} c_{234} \\\\ s_{5} &amp; 0 &amp; c_{5} &amp; d_{4} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B2%7D%5E%7B1%7D%20T%20%5Ccdot%7B%20%7D_%7B3%7D%5E%7B2%7D%20T%20%5Ccdot%7B%20%7D_%7B4%7D%5E%7B3%7D%20T%20%5Ccdot%7B%20%7D_%7B5%7D%5E%7B4%7D%20T%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20c_%7B234%7D%20c_%7B5%7D%20%26%20-s_%7B234%7D%20%26%20-c_%7B234%7D%20s_%7B5%7D%20%26%20a_%7B3%7D%20c_%7B23%7D&amp;plus;a_%7B2%7D%20c_%7B2%7D&amp;plus;d_%7B2%7D%20s_%7B234%7D%20%5C%5C%20s_%7B234%7D%20c_%7B5%7D%20%26%20c_%7B234%7D%20%26%20-s_%7B234%7D%20s_%7B5%7D%20%26%20a_%7B3%7D%20s_%7B23%7D&amp;plus;a_%7B2%7D%20s_%7B2%7D-d_%7B5%7D%20c_%7B234%7D%20%5C%5C%20s_%7B5%7D%20%26%200%20%26%20c_%7B5%7D%20%26%20d_%7B4%7D%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p>根据两式第三行第四列相等，则可以得到</p>\n<p style=\"text-align:center;\"><img alt=\"d_{4}=-p_{y} c_{1}+d_{6}\\left(a_{y} c_{1}-a_{x} s_{1}\\right)+p_{x} s_{1}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?d_%7B4%7D%3D-p_%7By%7D%20c_%7B1%7D&amp;plus;d_%7B6%7D%5Cleft%28a_%7By%7D%20c_%7B1%7D-a_%7Bx%7D%20s_%7B1%7D%5Cright%29&amp;plus;p_%7Bx%7D%20s_%7B1%7D\"/></p>\n<p>另<img alt=\"m=d_{6} a_{y}-p_{y}, n=a_{x} d_{6}-p_{x}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?m%3Dd_%7B6%7D%20a_%7By%7D-p_%7By%7D%2C%20n%3Da_%7Bx%7D%20d_%7B6%7D-p_%7Bx%7D\"/>，有</p>\n<p style=\"text-align:center;\"><img alt=\"\\theta_{1}=a \\tan 2(m, n)-a \\tan 2\\left(d_{4}, \\pm \\sqrt{m^{2}+n^{2}-d_{4}^{2}}\\right)\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Ctheta_%7B1%7D%3Da%20%5Ctan%202%28m%2C%20n%29-a%20%5Ctan%202%5Cleft%28d_%7B4%7D%2C%20%5Cpm%20%5Csqrt%7Bm%5E%7B2%7D&amp;plus;n%5E%7B2%7D-d_%7B4%7D%5E%7B2%7D%7D%5Cright%29\"/></p>\n<p>共两组解。</p>\n<h3 id=\"%E5%85%B3%E8%8A%825%E7%9A%84%E6%B1%82%E8%A7%A3\">关节5的求解</h3>\n<p>根据两式第三行第三列相等，有<img alt=\"c_{5}=a_{x} s_{1}-a_{y} c_{1}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?c_%7B5%7D%3Da_%7Bx%7D%20s_%7B1%7D-a_%7By%7D%20c_%7B1%7D\"/>，则</p>\n<p style=\"text-align:center;\"><img alt=\"\\theta_{5}=\\pm \\arccos \\left(a_{x} s_{1}-a_{y} c_{1}\\right)\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Ctheta_%7B5%7D%3D%5Cpm%20%5Carccos%20%5Cleft%28a_%7Bx%7D%20s_%7B1%7D-a_%7By%7D%20c_%7B1%7D%5Cright%29\"/></p>\n<p>至此共四组解。</p>\n<h3 id=\"%E5%85%B3%E8%8A%826%E7%9A%84%E6%B1%82%E8%A7%A3\">关节6的求解</h3>\n<p>根据两式第三行第三列相等，有<img alt=\"s_{5}=s_{6}\\left(o_{y} c_{1}-o_{x} s_{1}\\right)-c_{6}\\left(n_{y} c_{1}-n_{x} s_{1}\\right)\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?s_%7B5%7D%3Ds_%7B6%7D%5Cleft%28o_%7By%7D%20c_%7B1%7D-o_%7Bx%7D%20s_%7B1%7D%5Cright%29-c_%7B6%7D%5Cleft%28n_%7By%7D%20c_%7B1%7D-n_%7Bx%7D%20s_%7B1%7D%5Cright%29\"/></p>\n<p>令<img alt=\"m m=n_{x} s_{1}-n_{y} c_{1}, \\quad n n=o_{x} s_{1}-o_{y} c_{1}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?m%20m%3Dn_%7Bx%7D%20s_%7B1%7D-n_%7By%7D%20c_%7B1%7D%2C%20%5Cquad%20n%20n%3Do_%7Bx%7D%20s_%7B1%7D-o_%7By%7D%20c_%7B1%7D\"/>，有</p>\n<p style=\"text-align:center;\"><img alt=\"\\theta_{6}=a \\tan 2(m m, n n)-a \\tan 2\\left(s_{5}, 0\\right)\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Ctheta_%7B6%7D%3Da%20%5Ctan%202%28m%20m%2C%20n%20n%29-a%20%5Ctan%202%5Cleft%28s_%7B5%7D%2C%200%5Cright%29\"/></p>\n<p>至此共四组解。</p>\n<h3 id=\"%E5%85%B3%E8%8A%823%E7%9A%84%E6%B1%82%E8%A7%A3\">关节3的求解</h3>\n<p>由<img alt=\"{ }_{1}^{0} T^{-1} \\cdot T \\cdot{ }_{6}^{5} T^{-1} \\cdot{ }_{5}^{4} T^{-1}={ }_{4}^{1} T={ }_{2}^{1} T \\cdot{ }_{3}^{2} T \\cdot{ }_{4}^{3} T\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B1%7D%5E%7B0%7D%20T%5E%7B-1%7D%20%5Ccdot%20T%20%5Ccdot%7B%20%7D_%7B6%7D%5E%7B5%7D%20T%5E%7B-1%7D%20%5Ccdot%7B%20%7D_%7B5%7D%5E%7B4%7D%20T%5E%7B-1%7D%3D%7B%20%7D_%7B4%7D%5E%7B1%7D%20T%3D%7B%20%7D_%7B2%7D%5E%7B1%7D%20T%20%5Ccdot%7B%20%7D_%7B3%7D%5E%7B2%7D%20T%20%5Ccdot%7B%20%7D_%7B4%7D%5E%7B3%7D%20T\"/>，而且</p>\n<p style=\"text-align:center;\"><img alt=\"{ }_{5}^{4} T^{-1}=\\left[\\begin{array}{cccc} \\cos \\theta_{5} &amp; \\sin \\theta_{5} &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; -1 &amp; d_{5} \\\\ -\\sin \\theta_{5} &amp; \\cos \\theta_{5} &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B5%7D%5E%7B4%7D%20T%5E%7B-1%7D%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20%5Ccos%20%5Ctheta_%7B5%7D%20%26%20%5Csin%20%5Ctheta_%7B5%7D%20%26%200%20%26%200%20%5C%5C%200%20%26%200%20%26%20-1%20%26%20d_%7B5%7D%20%5C%5C%20-%5Csin%20%5Ctheta_%7B5%7D%20%26%20%5Ccos%20%5Ctheta_%7B5%7D%20%26%200%20%26%200%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p>所以有<img alt=\"{ }_{1}^{0} T^{-1} \\cdot T \\cdot{ }_{6}^{5} T^{-1} \\cdot{ }_{5}^{4} T^{-1}=\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B1%7D%5E%7B0%7D%20T%5E%7B-1%7D%20%5Ccdot%20T%20%5Ccdot%7B%20%7D_%7B6%7D%5E%7B5%7D%20T%5E%7B-1%7D%20%5Ccdot%7B%20%7D_%7B5%7D%5E%7B4%7D%20T%5E%7B-1%7D%3D\"/></p>\n<p style=\"text-align:center;\"><img alt=\"\\left[\\begin{array}{cc} c_{5}\\left(c_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)-s_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right)\\right)-s_{5}\\left(a_{x} c_{1}+a_{y} s_{1}\\right) &amp; s_{5}\\left(c_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)-s_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right)\\right)+c_{5}\\left(a_{x} c_{1}+a_{y} s_{1}\\right) \\\\ c_{5}\\left(n_{x} c_{6}-o_{z} s_{6}\\right)-s_{5} a_{z} &amp; s_{5}\\left(n_{x} c_{6}-o_{z} s_{6}\\right)+c_{5} a_{z} \\\\ c_{5}\\left(s_{6}\\left(o_{y} c_{1}-o_{x} s_{1}\\right)-c_{6}\\left(n_{y} c_{1}-n_{x} s_{1}\\right)\\right)-s_{5}\\left(a_{x} s_{1}-a_{y} c_{1}\\right) &amp; s_{5}\\left(s_{6}\\left(o_{y} c_{1}-o_{x} s_{1}\\right)-c_{6}\\left(n_{y} c_{1}-n_{x} s_{1}\\right)\\right)+c_{5}\\left(a_{x} s_{1}-a_{y} c_{1}\\right) \\\\ 0 &amp; 0 \\end{array}\\right.\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Cleft%5B%5Cbegin%7Barray%7D%7Bcc%7D%20c_%7B5%7D%5Cleft%28c_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29-s_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%5Cright%29-s_%7B5%7D%5Cleft%28a_%7Bx%7D%20c_%7B1%7D&amp;plus;a_%7By%7D%20s_%7B1%7D%5Cright%29%20%26%20s_%7B5%7D%5Cleft%28c_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29-s_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%5Cright%29&amp;plus;c_%7B5%7D%5Cleft%28a_%7Bx%7D%20c_%7B1%7D&amp;plus;a_%7By%7D%20s_%7B1%7D%5Cright%29%20%5C%5C%20c_%7B5%7D%5Cleft%28n_%7Bx%7D%20c_%7B6%7D-o_%7Bz%7D%20s_%7B6%7D%5Cright%29-s_%7B5%7D%20a_%7Bz%7D%20%26%20s_%7B5%7D%5Cleft%28n_%7Bx%7D%20c_%7B6%7D-o_%7Bz%7D%20s_%7B6%7D%5Cright%29&amp;plus;c_%7B5%7D%20a_%7Bz%7D%20%5C%5C%20c_%7B5%7D%5Cleft%28s_%7B6%7D%5Cleft%28o_%7By%7D%20c_%7B1%7D-o_%7Bx%7D%20s_%7B1%7D%5Cright%29-c_%7B6%7D%5Cleft%28n_%7By%7D%20c_%7B1%7D-n_%7Bx%7D%20s_%7B1%7D%5Cright%29%5Cright%29-s_%7B5%7D%5Cleft%28a_%7Bx%7D%20s_%7B1%7D-a_%7By%7D%20c_%7B1%7D%5Cright%29%20%26%20s_%7B5%7D%5Cleft%28s_%7B6%7D%5Cleft%28o_%7By%7D%20c_%7B1%7D-o_%7Bx%7D%20s_%7B1%7D%5Cright%29-c_%7B6%7D%5Cleft%28n_%7By%7D%20c_%7B1%7D-n_%7Bx%7D%20s_%7B1%7D%5Cright%29%5Cright%29&amp;plus;c_%7B5%7D%5Cleft%28a_%7Bx%7D%20s_%7B1%7D-a_%7By%7D%20c_%7B1%7D%5Cright%29%20%5C%5C%200%20%26%200%20%5Cend%7Barray%7D%5Cright.\"/><img alt=\"\\left.\\begin{array}{cc} -\\left(s_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)+c_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right)\\right) &amp; d_{5}\\left(s_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)+c_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right)\\right)+p_{x} c_{1}-d_{6}\\left(a_{x} c_{1}+a_{y} s_{1}\\right)+p_{y} s_{1} \\\\ -\\left(o_{z} c_{6}+n_{z} s_{6}\\right) &amp; d_{5}\\left(o_{z} c_{6}+n_{z} s_{6}\\right)+p_{z}-d_{1}-a_{z} d_{6} \\\\ s_{6}\\left(n_{y} c_{1}-n_{x} s_{1}\\right)+c_{6}\\left(o_{y} c_{1}-o_{x} s_{1}\\right) &amp; d_{5}\\left(-s_{6}\\left(n_{y} c_{1}-n_{x} s_{1}\\right)-c_{6}\\left(o_{y} c_{1}-o_{x} s_{1}\\right)\\right)-p_{y} c_{1}+d_{6}\\left(a_{y} c_{1}-a_{x} s_{1}\\right)+p_{x} s_{1} \\\\ 0 &amp; 1 \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Cleft.%5Cbegin%7Barray%7D%7Bcc%7D%20-%5Cleft%28s_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;c_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%5Cright%29%20%26%20d_%7B5%7D%5Cleft%28s_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;c_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%5Cright%29&amp;plus;p_%7Bx%7D%20c_%7B1%7D-d_%7B6%7D%5Cleft%28a_%7Bx%7D%20c_%7B1%7D&amp;plus;a_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;p_%7By%7D%20s_%7B1%7D%20%5C%5C%20-%5Cleft%28o_%7Bz%7D%20c_%7B6%7D&amp;plus;n_%7Bz%7D%20s_%7B6%7D%5Cright%29%20%26%20d_%7B5%7D%5Cleft%28o_%7Bz%7D%20c_%7B6%7D&amp;plus;n_%7Bz%7D%20s_%7B6%7D%5Cright%29&amp;plus;p_%7Bz%7D-d_%7B1%7D-a_%7Bz%7D%20d_%7B6%7D%20%5C%5C%20s_%7B6%7D%5Cleft%28n_%7By%7D%20c_%7B1%7D-n_%7Bx%7D%20s_%7B1%7D%5Cright%29&amp;plus;c_%7B6%7D%5Cleft%28o_%7By%7D%20c_%7B1%7D-o_%7Bx%7D%20s_%7B1%7D%5Cright%29%20%26%20d_%7B5%7D%5Cleft%28-s_%7B6%7D%5Cleft%28n_%7By%7D%20c_%7B1%7D-n_%7Bx%7D%20s_%7B1%7D%5Cright%29-c_%7B6%7D%5Cleft%28o_%7By%7D%20c_%7B1%7D-o_%7Bx%7D%20s_%7B1%7D%5Cright%29%5Cright%29-p_%7By%7D%20c_%7B1%7D&amp;plus;d_%7B6%7D%5Cleft%28a_%7By%7D%20c_%7B1%7D-a_%7Bx%7D%20s_%7B1%7D%5Cright%29&amp;plus;p_%7Bx%7D%20s_%7B1%7D%20%5C%5C%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p>因为</p>\n<p style=\"text-align:center;\"><img alt=\"{ }_{2}^{1} T \\cdot{ }_{3}^{2} T \\cdot{ }_{4}^{3} T=\\left[\\begin{array}{cccc} c_{234} &amp; 0 &amp; s_{234} &amp; a_{3} c_{23}+a_{2} c_{2} \\\\ s_{234} &amp; 0 &amp; -c_{234} &amp; a_{3} s_{23}+a_{2} s_{2} \\\\ 0 &amp; 1 &amp; 0 &amp; d_{4} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{array}\\right]\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B2%7D%5E%7B1%7D%20T%20%5Ccdot%7B%20%7D_%7B3%7D%5E%7B2%7D%20T%20%5Ccdot%7B%20%7D_%7B4%7D%5E%7B3%7D%20T%3D%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D%20c_%7B234%7D%20%26%200%20%26%20s_%7B234%7D%20%26%20a_%7B3%7D%20c_%7B23%7D&amp;plus;a_%7B2%7D%20c_%7B2%7D%20%5C%5C%20s_%7B234%7D%20%26%200%20%26%20-c_%7B234%7D%20%26%20a_%7B3%7D%20s_%7B23%7D&amp;plus;a_%7B2%7D%20s_%7B2%7D%20%5C%5C%200%20%26%201%20%26%200%20%26%20d_%7B4%7D%20%5C%5C%200%20%26%200%20%26%200%20%26%201%20%5Cend%7Barray%7D%5Cright%5D\"/></p>\n<p>根据两式第一行第四列相等，第二行第四列相等，有</p>\n<p style=\"text-align:center;\"> <img alt=\"\\begin{aligned} &amp;d_{5}\\left(s_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)+c_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right)\\right)+p_{x} c_{1}-d_{6}\\left(a_{x} c_{1}+a_{y} s_{1}\\right)+p_{y} s_{1}=a_{3} c_{23}+a_{2} c_{2} \\\\ &amp;d_{5}\\left(o_{z} c_{6}+n_{z} s_{6}\\right)+p_{z}-d_{1}-a_{z} d_{6}=a_{3} s_{23}+a_{2} s_{2} \\end{aligned}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Cbegin%7Baligned%7D%20%26d_%7B5%7D%5Cleft%28s_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;c_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%5Cright%29&amp;plus;p_%7Bx%7D%20c_%7B1%7D-d_%7B6%7D%5Cleft%28a_%7Bx%7D%20c_%7B1%7D&amp;plus;a_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;p_%7By%7D%20s_%7B1%7D%3Da_%7B3%7D%20c_%7B23%7D&amp;plus;a_%7B2%7D%20c_%7B2%7D%20%5C%5C%20%26d_%7B5%7D%5Cleft%28o_%7Bz%7D%20c_%7B6%7D&amp;plus;n_%7Bz%7D%20s_%7B6%7D%5Cright%29&amp;plus;p_%7Bz%7D-d_%7B1%7D-a_%7Bz%7D%20d_%7B6%7D%3Da_%7B3%7D%20s_%7B23%7D&amp;plus;a_%7B2%7D%20s_%7B2%7D%20%5Cend%7Baligned%7D\"/></p>\n<p>令</p>\n<p style=\"text-align:center;\"><img alt=\"m m m=d_{5}\\left(s_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)+c_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right)\\right)+p_{x} c_{1}-d_{6}\\left(a_{x} c_{1}+a_{y} s_{1}\\right)+p_{y} s_{1}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?m%20m%20m%3Dd_%7B5%7D%5Cleft%28s_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;c_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%5Cright%29&amp;plus;p_%7Bx%7D%20c_%7B1%7D-d_%7B6%7D%5Cleft%28a_%7Bx%7D%20c_%7B1%7D&amp;plus;a_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;p_%7By%7D%20s_%7B1%7D\"/></p>\n<p style=\"text-align:center;\"><img alt=\"\\text { nnn }=d_{5}\\left(o_{z} c_{6}+n_{z} s_{6}\\right)+p_{z}-d_{1}-a_{z} d_{6}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Ctext%20%7B%20nnn%20%7D%3Dd_%7B5%7D%5Cleft%28o_%7Bz%7D%20c_%7B6%7D&amp;plus;n_%7Bz%7D%20s_%7B6%7D%5Cright%29&amp;plus;p_%7Bz%7D-d_%7B1%7D-a_%7Bz%7D%20d_%7B6%7D\"/></p>\n<p>则有</p>\n<p style=\"text-align:center;\"><img alt=\"\\theta_{3}=\\pm \\arccos \\left(\\frac{m m m^{2}+n n n^{2}-a_{2}^{2}-a_{3}^{2}}{2 a_{2} a_{3}}\\right)\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Ctheta_%7B3%7D%3D%5Cpm%20%5Carccos%20%5Cleft%28%5Cfrac%7Bm%20m%20m%5E%7B2%7D&amp;plus;n%20n%20n%5E%7B2%7D-a_%7B2%7D%5E%7B2%7D-a_%7B3%7D%5E%7B2%7D%7D%7B2%20a_%7B2%7D%20a_%7B3%7D%7D%5Cright%29\"/></p>\n<p>至此共八组解。</p>\n<h3 id=\"%E5%85%B3%E8%8A%822%E7%9A%84%E6%B1%82%E8%A7%A3\">关节2的求解</h3>\n<p>由上述推导，可令</p>\n<p style=\"text-align:center;\"><img alt=\"s_{2}=\\frac{\\left(a_{3} c_{3}+a_{2}\\right) n n n-a_{3} s_{3} m m m}{a_{2}^{2}+a_{3}^{2}+2 a_{2} a_{3} c_{3}}, \\quad c_{2}=\\frac{m m m+a_{3} s_{3} s_{2}}{a_{3} c_{3}+a_{2}}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?s_%7B2%7D%3D%5Cfrac%7B%5Cleft%28a_%7B3%7D%20c_%7B3%7D&amp;plus;a_%7B2%7D%5Cright%29%20n%20n%20n-a_%7B3%7D%20s_%7B3%7D%20m%20m%20m%7D%7Ba_%7B2%7D%5E%7B2%7D&amp;plus;a_%7B3%7D%5E%7B2%7D&amp;plus;2%20a_%7B2%7D%20a_%7B3%7D%20c_%7B3%7D%7D%2C%20%5Cquad%20c_%7B2%7D%3D%5Cfrac%7Bm%20m%20m&amp;plus;a_%7B3%7D%20s_%7B3%7D%20s_%7B2%7D%7D%7Ba_%7B3%7D%20c_%7B3%7D&amp;plus;a_%7B2%7D%7D\"/></p>\n<p>所以</p>\n<p style=\"text-align:center;\"><img alt=\"\\theta_{2}=a \\tan 2\\left(s_{2}, c_{2}\\right)\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Ctheta_%7B2%7D%3Da%20%5Ctan%202%5Cleft%28s_%7B2%7D%2C%20c_%7B2%7D%5Cright%29\"/></p>\n<p>至此共八组解。</p>\n<h3 id=\"%E5%85%B3%E8%8A%824%E7%9A%84%E6%B1%82%E8%A7%A3\">关节4的求解</h3>\n<p>由<img alt=\"{ }_{1}^{0} T^{-1} \\cdot T \\cdot{ }_{6}^{5} T^{-1}={ }_{5}^{1} T={ }_{2}^{1} T \\cdot{ }_{3}^{2} T \\cdot{ }_{4}^{3} T \\cdot{ }_{5}^{4} T\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%7B%20%7D_%7B1%7D%5E%7B0%7D%20T%5E%7B-1%7D%20%5Ccdot%20T%20%5Ccdot%7B%20%7D_%7B6%7D%5E%7B5%7D%20T%5E%7B-1%7D%3D%7B%20%7D_%7B5%7D%5E%7B1%7D%20T%3D%7B%20%7D_%7B2%7D%5E%7B1%7D%20T%20%5Ccdot%7B%20%7D_%7B3%7D%5E%7B2%7D%20T%20%5Ccdot%7B%20%7D_%7B4%7D%5E%7B3%7D%20T%20%5Ccdot%7B%20%7D_%7B5%7D%5E%7B4%7D%20T\"/>，可设</p>\n<p style=\"text-align:center;\"><img alt=\"\\begin{gathered} -s_{234}=s_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)+c_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right) \\\\ c_{234}=o_{z} c_{6}+n_{z} s_{6} \\end{gathered}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Cbegin%7Bgathered%7D%20-s_%7B234%7D%3Ds_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29&amp;plus;c_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%20%5C%5C%20c_%7B234%7D%3Do_%7Bz%7D%20c_%7B6%7D&amp;plus;n_%7Bz%7D%20s_%7B6%7D%20%5Cend%7Bgathered%7D\"/></p>\n<p>所以</p>\n<p style=\"text-align:center;\"><img alt=\"\\theta_{4}=a \\tan 2\\left(-s_{6}\\left(n_{x} c_{1}+n_{y} s_{1}\\right)-c_{6}\\left(o_{x} c_{1}+o_{y} s_{1}\\right), o_{z} c_{6}+n_{z} s_{6}\\right)-\\theta_{2}-\\theta_{3}\" class=\"mathcode\" src=\"https://latex.codecogs.com/gif.latex?%5Ctheta_%7B4%7D%3Da%20%5Ctan%202%5Cleft%28-s_%7B6%7D%5Cleft%28n_%7Bx%7D%20c_%7B1%7D&amp;plus;n_%7By%7D%20s_%7B1%7D%5Cright%29-c_%7B6%7D%5Cleft%28o_%7Bx%7D%20c_%7B1%7D&amp;plus;o_%7By%7D%20s_%7B1%7D%5Cright%29%2C%20o_%7Bz%7D%20c_%7B6%7D&amp;plus;n_%7Bz%7D%20s_%7B6%7D%5Cright%29-%5Ctheta_%7B2%7D-%5Ctheta_%7B3%7D\"/></p>\n<p>总共八组解。</p>\n<h3 id=\"%E6%AD%A3%E9%80%86%E8%A7%A3%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81\">正逆解完整代码</h3>\n<p>按照上面公式，即可完美求解。代码链接如下：</p>\n<p><a href=\"https://download.csdn.net/download/sinat_32804425/70047254\" title=\"https://download.csdn.net/download/sinat_32804425/70047254\">https://download.csdn.net/download/sinat_32804425/70047254</a></p>\n<h3 id=\"%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C\">测试结果</h3>\n<p>输入：0.17269 -0.55555 0.11106 3.025 0.395 2.901</p>\n<p><img alt=\"\" height=\"674\" src=\"image\\edb6dbf9fefa4689bf8b75914abd8afa.png\" width=\"802\"/></p>\n<p>结果如下，可以看出，第三组与URSim中的完美匹配。</p>\n<p><img alt=\"\" height=\"634\" src=\"image\\6d54ec45e598404ba5281f678a0a9200.png\" width=\"1200\"/></p>\n<h1 id=\"%E4%B8%8D%E8%B6%B3%E4%B9%8B%E5%A4%84\">不足之处</h1>\n<p>没有考虑奇异解的特殊情况，后面需要的话会再进行研究。</p>\n<p>其他UR构型的机械臂换一下DH参数应该也是也可用这种方法来求解的。有问题的话可以评论区交流~~</p>\n<h3 id=\"%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E9%93%BE%E6%8E%A5\">一些有用链接</h3>\n<p>UR运动学GitHub代码</p>\n<p><a href=\"https://github.com/ros-industrial/universal_robot/blob/kinetic-devel/ur_kinematics/src/ur_kin.cpp\" title=\"https://github.com/ros-industrial/universal_robot/blob/kinetic-devel/ur_kinematics/src/ur_kin.cpp\">https://github.com/ros-industrial/universal_robot/blob/kinetic-devel/ur_kinematics/src/ur_kin.cpp</a></p>\n<p> 手册下载</p>\n<p><a href=\"https://www.universal-robots.com/download/?query=&amp;type%5B%5D=14949&amp;type%5B%5D=98765\" title=\"UR Download | Support Site | Universal Robots\">UR Download | Support Site | Universal Robots</a></p>\n<p></p>\n<p></p>\n<p></p>\n</div>\n</div>"}