{"blogid": "126632432", "writerAge": "码龄4年", "writerBlogNum": "1373", "writerCollect": "7891", "writerComment": "1049", "writerFan": "39174", "writerGrade": "7级", "writerIntegral": "18503", "writerName": "perseverance52", "writerProfileAdress": "writer_image\\profile_126632432.jpg", "writerRankTotal": "440", "writerRankWeekly": "262", "writerThumb": "1923", "writerVisitNum": "1430040", "blog_read_count": "425", "blog_time": "已于 2022-09-03 15:38:36 修改", "blog_title": "【CircuitPython】RaspberryPi Pico RP2040 自定义机械键盘实例", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h2><a id=\"centerfont_colorcorealCircuitPythonRaspberryPi_Pico_RP2040_Mechanical_Keyboard_0\"></a>\n<center>\n<font color=\"coreal\">【CircuitPython】RaspberryPi Pico RP2040 Mechanical Keyboard实例</font>\n</center></h2>\n<hr/>\n<ul><li>✨本示例基于<code>Thonny</code>开发，所使用的固件是：<code>CircuitPython</code>，区别于<code>MicroPython</code>固件。✨</li></ul>\n<blockquote>\n<h4><a id=\"BRaspberryPi_Pico_RP2040RP204020_3\"></a>🎈最近B站某君的瀚文键盘很火热，这里介绍利用<code>RaspberryPi Pico RP2040</code>实现键盘按键定制功能。由于<code>RP2040</code>引脚限制，最多支持20个自定义按键或组合键的输入。</h4>\n</blockquote>\n<ul><li>🛒现有售卖模块有16按键的，如果自己打板可以设计最多20的按键，</li><li>📜介绍链接：<code>https://shop.pimoroni.com/products/pico-rgb-keypad-base?variant=32369517166675</code><br/> <img alt=\"在这里插入图片描述\" src=\"image\\925d6e9b975641b9848674967b8dca28.png\"/></li></ul>\n<h3><a id=\"_7\"></a>🍭测试方法</h3>\n<p>-📍 在线<code>键盘按键测试</code></p>\n<ul><li>👉找一个测试按键的专门网站：<code>https://keyboard.bmcx.com/</code>进行按键测试和验证。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\3e04b788132748aca8006f2cd885815b.png\"/><br/> -🗝测试方法：</li></ul>\n<blockquote>\n<p>📑调试时可以使用一根导线串联一个1K的电阻用于限流作用，一头接到<code>GND</code>，另一端去触碰引脚，处理<code>GP16</code>引脚外，其他数字引脚都可以去碰一碰，你可以在按键测试网站上看到，按键有被模拟按下。同时如果你打开了<code>Thonny</code>，在Shell调试窗口有对应的按键码值打印信息。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\d5ba42118bf448c6929937c219be4015.png\"/></p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\3b97456e995d410cbb0cb60b4b982ff1.png\"/></p>\n<ul><li>📌按键映射可以自己在代码中修改成自己想要的指定按键或组合按键。</li></ul>\n<pre><code class=\"prism language-c\">keymap <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>Keycode<span class=\"token punctuation\">.</span>GUI<span class=\"token punctuation\">,</span> Keycode<span class=\"token punctuation\">.</span>C<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span># win <span class=\"token operator\">+</span> <span class=\"token function\">C</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>Keycode<span class=\"token punctuation\">.</span>GUI<span class=\"token punctuation\">,</span> Keycode<span class=\"token punctuation\">.</span>V<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span># win <span class=\"token operator\">+</span><span class=\"token function\">V</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>THREE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>FOUR<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>FIVE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>MEDIA<span class=\"token punctuation\">,</span> ConsumerControlCode<span class=\"token punctuation\">.</span>VOLUME_DECREMENT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>MEDIA<span class=\"token punctuation\">,</span> ConsumerControlCode<span class=\"token punctuation\">.</span>VOLUME_INCREMENT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>R<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>G<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>B<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>UP_ARROW<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>X<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  # plus <span class=\"token function\">key</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>Y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>Z<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>I<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>O<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>LEFT_ARROW<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">17</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>DOWN_ARROW<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>RIGHT_ARROW<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">19</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>ALT<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>U<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3><a id=\"_48\"></a>📖环境搭建说明</h3>\n<ul><li>✔下载和烧录<code>CircuitPython</code>固件</li><li>👉官方RP2040固件下载地址：<code>https://circuitpython.org/downloads</code><br/> <img alt=\"在这里插入图片描述\" src=\"image\\0d247a723c344c638efff89b255cc15e.png\"/></li><li>🌿如果使用的是YD2040的板子可以选择：<code>pimoroni</code>型号<code>flash</code>容量分：<code>4MB</code>、<code>8MB</code>、<code>16MB</code><br/> <img alt=\"在这里插入图片描述\" src=\"image\\e13947fb83f944a4992873cb649c600e.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\f6a3a884c2c4417f9d70555a910f79c1.png\"/></li></ul>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\fffa8eec04404cdc9891a6e6c1055c40.png\"/></p>\n<ul><li>⛳固件选择说明<br/> <img alt=\"在这里插入图片描述\" src=\"image\\e839df9c34f04b08b12ce775071c8fb7.png\"/></li><li>🎄由于没有中文提示的，只有拼音<br/> <img alt=\"在这里插入图片描述\" src=\"image\\42e25cffa7e8494380d44d24a8c3745f.png\"/></li><li>烧录方法<br/> 在插入usb到电脑前先按住boot按键，在连接到电脑上，电脑上会显示一个虚拟出来的120MB容量的U盘，然后将下载下来的.uf2文件拷贝到虚拟的U盘当中即可实现固件的烧录。</li></ul>\n<h3><a id=\"_64\"></a>🧧库下载和导入</h3>\n<ul><li>🎉在<code>Thonny</code>工具栏上当中-<code>工具</code> -<code>管理插件</code>，搜索<code>adafruit_hid</code><br/> <img alt=\"在这里插入图片描述\" src=\"image\\1c041f1819344a2da31c9933ce6e3887.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\b3654e2fa07f42959753671d9683582a.png\"/></li><li>找到下载路径：<code>C:\\Users\\Administrator\\AppData\\Roaming\\Thonny\\plugins\\Python310\\site-packages</code></li></ul>\n<blockquote>\n<p>将<code>adafruit_hid</code>文件夹拷贝到<code>Pi Pico RP2040</code>设备当中。</p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\efefcc2e5842440896bf5d22c26e44f1.png\"/></p>\n<ul><li> <p>🎯先将此文件夹拷贝到桌面或其他自己能找到的地方，通过<code>Thonny</code>定位到文件夹，选中，右键<code>上传到/</code>(注意需要将设备退出U盘模式，不然上传会出错)<br/> <img alt=\"在这里插入图片描述\" src=\"image\\66647756353d425fba4aeb68f0dd514f.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\d21c7b5254224ff68c27ec521f8f34fa.png\"/></p> </li><li> <p>🌿如果没有将文件菜单勾选的：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\56154ba5b5274f58b86267453c6b9f7d.png\"/></p> </li><li> <p>🌿直接拷贝方法：当<code>RP2040</code>插入到电脑上默认是有一个盘符的，不像<code>Micropython ESP32</code><br/> <img alt=\"在这里插入图片描述\" src=\"image\\fa084426b2a140ab99931fe8b357fe45.png\"/></p> </li><li> <p>📗文件结构<br/> <img alt=\"在这里插入图片描述\" src=\"image\\538efda3864a447fb27302af66490ad1.png\"/></p> </li></ul>\n<h3><a id=\"Pico_RP2040_Mech_Keyboard__84\"></a>📝Pico_RP2040 Mech Keyboard 示例代码</h3>\n<ul><li>📍示例地址：<code>https://github.com/adafruit/Adafruit_Learning_System_Guides/tree/main/Pico_RP2040_Mech_Keyboard</code></li><li>🎆引脚注意：<code>GP15</code>不要被使用，它被内部USB外设使用，具体说明：<code>https://github.com/adafruit/circuitpython/issues/4034</code></li></ul>\n<blockquote>\n<p>🎈 在源代码上添加了按键调试串口输出，方便查阅。</p>\n</blockquote>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">SPDX<span class=\"token operator\">-</span>FileCopyrightText<span class=\"token operator\">:</span> <span class=\"token number\">2021</span> John Park <span class=\"token keyword\">for</span> Adafruit Industries</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">SPDX<span class=\"token operator\">-</span>License<span class=\"token operator\">-</span>Identifier<span class=\"token operator\">:</span> MIT</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token expression\">RaspberryPi Pico RP2040 Mechanical Keyboard</span></span>\n\nimport time\nimport board\nfrom digitalio import DigitalInOut<span class=\"token punctuation\">,</span> Direction<span class=\"token punctuation\">,</span> Pull\nimport usb_hid\nfrom adafruit_hid<span class=\"token punctuation\">.</span>keyboard import Keyboard\nfrom adafruit_hid<span class=\"token punctuation\">.</span>keycode import Keycode\nfrom adafruit_hid<span class=\"token punctuation\">.</span>consumer_control import ConsumerControl\nfrom adafruit_hid<span class=\"token punctuation\">.</span>consumer_control_code import ConsumerControlCode\n\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"---Pico Pad Keyboard---\"</span><span class=\"token punctuation\">)</span>\n\nled <span class=\"token operator\">=</span> <span class=\"token function\">DigitalInOut</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">.</span>LED<span class=\"token punctuation\">)</span>\nled<span class=\"token punctuation\">.</span>direction <span class=\"token operator\">=</span> Direction<span class=\"token punctuation\">.</span>OUTPUT\nled<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> True\n\nkbd <span class=\"token operator\">=</span> <span class=\"token function\">Keyboard</span><span class=\"token punctuation\">(</span>usb_hid<span class=\"token punctuation\">.</span>devices<span class=\"token punctuation\">)</span>\ncc <span class=\"token operator\">=</span> <span class=\"token function\">ConsumerControl</span><span class=\"token punctuation\">(</span>usb_hid<span class=\"token punctuation\">.</span>devices<span class=\"token punctuation\">)</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span> <span class=\"token directive keyword\">list</span> <span class=\"token expression\">of pins to <span class=\"token function\">use</span> <span class=\"token punctuation\">(</span>skipping GP15 on Pico because it's funky<span class=\"token punctuation\">)</span></span></span>\npins <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    board<span class=\"token punctuation\">.</span>GP0<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP1<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP2<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP3<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP4<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP5<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP6<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP7<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP8<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP9<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP10<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP11<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP12<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP13<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP14<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP16<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP17<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP18<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP19<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP20<span class=\"token punctuation\">,</span>\n    board<span class=\"token punctuation\">.</span>GP21<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\n\nMEDIA <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\nKEY <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n\nkeymap <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>Keycode<span class=\"token punctuation\">.</span>GUI<span class=\"token punctuation\">,</span> Keycode<span class=\"token punctuation\">.</span>C<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span># win <span class=\"token operator\">+</span> <span class=\"token function\">C</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>Keycode<span class=\"token punctuation\">.</span>GUI<span class=\"token punctuation\">,</span> Keycode<span class=\"token punctuation\">.</span>V<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span># win <span class=\"token operator\">+</span><span class=\"token function\">V</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>THREE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>FOUR<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>FIVE<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>MEDIA<span class=\"token punctuation\">,</span> ConsumerControlCode<span class=\"token punctuation\">.</span>VOLUME_DECREMENT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>MEDIA<span class=\"token punctuation\">,</span> ConsumerControlCode<span class=\"token punctuation\">.</span>VOLUME_INCREMENT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>R<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>G<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>B<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>UP_ARROW<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>X<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  # plus <span class=\"token function\">key</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>Y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>Z<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token punctuation\">(</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>I<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>O<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>LEFT_ARROW<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">17</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>DOWN_ARROW<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">18</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>RIGHT_ARROW<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">19</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>ALT<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>KEY<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>Keycode<span class=\"token punctuation\">.</span>U<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token punctuation\">}</span>\n\nswitches <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> i in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>pins<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token operator\">=</span> <span class=\"token function\">DigitalInOut</span><span class=\"token punctuation\">(</span>pins<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">switch</span><span class=\"token punctuation\">.</span>direction <span class=\"token operator\">=</span> Direction<span class=\"token punctuation\">.</span>INPUT\n    <span class=\"token keyword\">switch</span><span class=\"token punctuation\">.</span>pull <span class=\"token operator\">=</span> Pull<span class=\"token punctuation\">.</span>UP\n    switches<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">switch</span><span class=\"token punctuation\">)</span>\n\n\nswitch_state <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">while</span> True<span class=\"token operator\">:</span>\n    <span class=\"token keyword\">for</span> button in <span class=\"token function\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">21</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">if</span> switch_state<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">if</span> not switches<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token operator\">:</span>\n                try<span class=\"token operator\">:</span>\n                    <span class=\"token keyword\">if</span> keymap<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> KEY<span class=\"token operator\">:</span>\n                        kbd<span class=\"token punctuation\">.</span><span class=\"token function\">press</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>keymap<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>keymap<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token keyword\">else</span><span class=\"token operator\">:</span>\n                        cc<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>keymap<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>keymap<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                except ValueError<span class=\"token operator\">:</span>  # deals w six key limit\n                    pass\n                switch_state<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n        <span class=\"token keyword\">if</span> switch_state<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">if</span> switches<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token operator\">:</span>\n                try<span class=\"token operator\">:</span>\n                    <span class=\"token keyword\">if</span> keymap<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> KEY<span class=\"token operator\">:</span>\n                        kbd<span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>keymap<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n                except ValueError<span class=\"token operator\">:</span>\n                    pass\n                switch_state<span class=\"token punctuation\">[</span>button<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n    time<span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span>  # debounce\n\n\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}