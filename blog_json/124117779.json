{"blogid": "124117779", "writerAge": "码龄3年", "writerBlogNum": "42", "writerCollect": "52", "writerComment": "3", "writerFan": "16", "writerGrade": "3级", "writerIntegral": "446", "writerName": "御七彩虹猫", "writerProfileAdress": "writer_image\\profile_124117779.jpg", "writerRankTotal": "66969", "writerRankWeekly": "85639", "writerThumb": "9", "writerVisitNum": "38681", "blog_read_count": "3434", "blog_time": "已于 2022-05-12 09:45:38 修改", "blog_title": "SSH-私钥泄露", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h2><a id=\"_0\"></a>前言</h2>\n<p>靶机的网盘下载地址</p>\n<blockquote>\n<p>链接:https://pan.baidu.com/s/1NXO_oDqHxd0WaIG5Tqf8gw?pwd=w5qd 提取码: w5qd 复制这段内容后打开百度网盘手机App，操作更方便哦</p>\n</blockquote>\n<blockquote>\n<p>KALI地址：192.168.10.60</p>\n<p>靶机地址：192.168.10.56</p>\n</blockquote>\n<hr/>\n<h2><a id=\"_12\"></a>一.信息收集</h2>\n<h3><a id=\"1_14\"></a>1.主机发现</h3>\n<p>使用命令，如下来进行主机发现。</p>\n<pre><code class=\"prism language-bash\">netdiscover -r <span class=\"token number\">192.168</span>.10.60\n</code></pre>\n<p>我们发现了靶机地址。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Y6MlIKwF-1649730369328)(/images/wordimage/2022/0412/netdis.png)]\" src=\"image\\b0d57a83b9f44bf386cc0a944632b970.png\"/></p>\n<hr/>\n<h3><a id=\"2_29\"></a>2.主机扫描</h3>\n<p>这里使用nmap工具来进行主机扫描，命令如下。</p>\n<pre><code class=\"prism language-bash\">nmap -A -T4 -O -p <span class=\"token number\">0</span>-65535 <span class=\"token number\">192.168</span>.10.56\n</code></pre>\n<p>如下图扫描，结果，发现开放了<code>80</code>,<code>22</code>,<code>31337</code>端口，并且发现<code>31337</code>端口也是http服务</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-XRZtHFqc-1649730369329)(/images/wordimage/2022/0412/port.png)]\" src=\"image\\22aea9761e744685bff89870bc3c6795.png\"/></p>\n<hr/>\n<h3><a id=\"3_44\"></a>3.目录扫描</h3>\n<p>既然开放了web服务端口，那我们肯定要进行web目录扫描，命令如下，由于开放了两个web服务，就可以进行两次web服务扫描。</p>\n<pre><code class=\"prism language-bash\">dirb http://192.168.10.56\n</code></pre>\n<p>如下图，是80端口的目录扫描，发现什么都没有</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-MUSellJM-1649730369329)(/images/wordimage/2022/0412/dirb80.png)]\" src=\"image\\ed4d5438a75f44cfa7cd789e619ea17a.png\"/></p>\n<p>我们可以进行对<code>31337</code>端口进行扫描，命令和上面差不多，后面加一个端口就可以了，扫描结果如下，发现有东西，一个是<code>.ssh</code>文件看名字值得注意还有一个是<code>robots</code>文件</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qXUwYxAw-1649730369329)(/images/wordimage/2022/0412/robots.png)]\" src=\"image\\5d6db208ed494e60b30ffd5adefcf860.png\"/></p>\n<hr/>\n<h3><a id=\"3_64\"></a>3.网页信息收集</h3>\n<p>既然开放了web服务，我们肯定要进行查看，因为有很多信息都是从网页目录收集。</p>\n<p>如下图，是访问的80端口，发现是nginx默认页面，经过收集没有什么可以发现的。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-oXV8bFGd-1649730369330)(/images/wordimage/2022/0412/nginx.png)]\" src=\"image\\cc8313e0fb1346c0a818c6a63a8fbc26.png\"/></p>\n<p>如下图是访问的31337端口，发现啥也没有。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-9HPJBItR-1649730369330)(/images/wordimage/2022/0412/NotFound.png)]\" src=\"image\\136beeb2a68f4a139b48b6158ee79928.png\"/></p>\n<hr/>\n<h2><a id=\"_80\"></a>二.漏洞利用</h2>\n<h3><a id=\"1_82\"></a>1.私钥泄露</h3>\n<h4><a id=\"11flag_84\"></a>1.1.发现第一个flag</h4>\n<p>经过上面信息收集，我们发现了robots文件，和.ssh文件，我们先查看robots文件，如下图，发现有几个文件，看这个样子，我第一反应是去看<code>taxes</code>这个目录，因为，这个文件不常见。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-WJrgQtEc-1649730369331)(/images/wordimage/2022/0412/taxes.png)]\" src=\"image\\4bbb5bdb391d4ef79b91d195f833b688.png\"/></p>\n<p>如下图，查看<code>taxes</code>，发现了第一个flag。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-oxfirElt-1649730369332)(/images/wordimage/2022/0412/flag1.png)]\" src=\"image\\0ecd4cd7d38e43959e02c89bd1da9cd1.png\"/></p>\n<p>然后其他两个文件也查看了，没有什么发现。</p>\n<hr/>\n<h4><a id=\"12_100\"></a>1.2.发现私钥泄露文件</h4>\n<p>我们在去查看，上面我们信息收集收集到的<code>.ssh</code>目录，如下图，看这个名字就知道了，怀疑的是，.ssh目录下面有这三个文件，我们挨个访问看看。</p>\n<p><code>id_rsa</code>,<code>authorized_keys</code>,<code>id_rsa.pub</code>，分别对应的是<code>私钥</code>,<code>数字签名</code>,<code>公钥</code><br/> <img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-2ea4zRE5-1649730369332)(/images/wordimage/2022/0412/id_rsa.png)]\" src=\"image\\f4ade64178964df795739dc38a0ea6b0.png\"/></p>\n<p>经过测试，发现是可以进行下载的，并且是ssh密钥文件，然后复制到了kali。</p>\n<p>但是打开<code>id_rsa</code>的时候发现需要密码。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-hr108kao-1649730369333)(/images/wordimage/2022/0412/id_rsapass.png)]\" src=\"image\\373c435433794921b129f16cbd2b5c7e.png\"/></p>\n<p>然后，我们打开其他文件，发现了用户名泄露，如下图，用户名是<code>simon</code>。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-KuoLkYAB-1649730369333)(/images/wordimage/2022/0412/simon.png)]\" src=\"image\\7961b13a9a6242bc8df0df49f1648fbd.png\"/></p>\n<p>然后上面<code>id_rsa</code>文件，需要进行破解。</p>\n<h4><a id=\"13id_rsa_122\"></a>1.3.破解id_rsa文件</h4>\n<p>这里使用<code>ssh2john</code>工具进行破解，但是新版kali没有，其实是有的文件在<code>/usr/share/john/ssh2john.py</code>，我们直接使用python运行即可，如下命令，把破解之后的东西放在了rsacrack里面</p>\n<pre><code class=\"prism language-bash\">python /usr/share/john/ssh2john.py id_rsa <span class=\"token operator\">&gt;</span> rsacrack\n</code></pre>\n<p>如下图是文件内容，还需要在破解一次。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-iBEcepKq-1649730369334)(/images/wordimage/2022/0412/rsacrack.png)]\" src=\"image\\4f368e89676d4131a5563795e5b2fd31.png\"/></p>\n<p>这里使用<code>john</code>工具来进行破解，命令如下。</p>\n<pre><code class=\"prism language-bash\">john rsacrack\n</code></pre>\n<p>如下图，发现破解出来一个密码，我破解的时候没有解图，我就直接查看了，密码是<code>starwars</code></p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Xp0tSszj-1649730369334)(/images/wordimage/2022/0412/starwars.png)]\" src=\"image\\359735ad3b05498985e3169e137d1572.png\"/></p>\n<p>破解出来了我以为是打开输入密码，其实不是，其实是咋子连接的时候的密码，说一个踩的坑，不能给<code>id_rsa</code>这个文件赋777权限，不然会报错，就是说777权限太开放了，然后我就重新赋了一个600权限，就可以了。</p>\n<p>然后我们就可以尝试连接，用户名是simon，然后私钥密码，是<code>starwars</code>，命令如下,前提是先要赋权限600命令是<code>chmod 600 id_rsa</code></p>\n<pre><code class=\"prism language-bash\"><span class=\"token function\">ssh</span> -i id_rsa simon@192.168.10.56\n</code></pre>\n<p>如下图，连接成功。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-hexEzVfA-1649730369335)(/images/wordimage/2022/0412/simonsucc.png)]\" src=\"image\\5b8586a537d84b6cac753662919596fd.png\"/></p>\n<hr/>\n<h2><a id=\"_161\"></a>三.提权</h2>\n<p>我们进入系统之后，首先查看的是<code>/etc/passwd</code>和<code>home</code>目录下面的文件，但是都没有发现可以利用的点，但是我们可以进入root目录，里面有一个flag,我们打不开，如下图。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-RQy6POEE-1649730369335)(/images/wordimage/2022/0412/rootflag.png)]\" src=\"image\\47f9b537c0064116a02e3ffb5603d230.png\"/></p>\n<h3><a id=\"1flag_168\"></a>1.发现第二个flag</h3>\n<p>但是里面有一个其他文件<code>read_message.c</code>意思就是读取信息嘛，那我们cat一下看看，就发现了第二个flag如下图。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-T9pvWiUQ-1649730369336)(/images/wordimage/2022/0412/flag2.png)]\" src=\"image\\eb7676860ab24506b4a4700f7be348a6.png\"/></p>\n<p>我们仔细阅读源代码，就是问我们是不是Simon，但是里面有一个<code>char buf[20]</code>，这个可以栈溢出，只需要大于20个字符就可以提权了。</p>\n<p>所以我们直接运行这个C文件，然后大于20个字符即可，如下图，我们就提权成功了，就可以查看最后一个flag。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-KP7qho3Q-1649730369336)(/images/wordimage/2022/0412/root.png)]\" src=\"image\\5096723827414783904a1916f3fa9505.png\"/></p>\n<h3><a id=\"2flag_182\"></a>2.发现第三个flag</h3>\n<p>如下图，最后一个flag。</p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-iDHDqtA0-1649730369337)(/images/wordimage/2022/0412/flag3.png)]\" src=\"image\\8eca6d51a0254a14830d07c858d2b629.png\"/></p>\n<hr/>\n<h2><a id=\"_191\"></a>四.总结</h2>\n<p>需要多注意隐藏目录，和不放过任何一个隐藏目录，看见密钥需要会连接，也需要学会使用john工具。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}