{"blogid": "121971077", "writerAge": "码龄14年", "writerBlogNum": "80", "writerCollect": "178", "writerComment": "7", "writerFan": "2597", "writerGrade": "4级", "writerIntegral": "919", "writerName": "小道士写程序", "writerProfileAdress": "writer_image\\profile_121971077.jpg", "writerRankTotal": "18899", "writerRankWeekly": "6099", "writerThumb": "56", "writerVisitNum": "101534", "blog_read_count": "6178", "blog_time": "于 2021-12-16 11:38:50 发布", "blog_title": "Docker 安装 PHP", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1>安装 PHP 镜像</h1>\n<h3>方法一、docker pull php</h3>\n<p>查找 <a href=\"https://hub.docker.com/_/php?tab=tags\" title=\"Docker Hub\">Docker Hub</a> 上的 php 镜像:</p>\n<p style=\"text-align:center;\"><a href=\"https://www.runoob.com/wp-content/uploads/2016/06/0D34717D-1D07-4655-8559-A8661BCB4A3D.jpg\"><img alt=\"\" src=\"image\\34268532dfab755c7319ca16f2efe6fd.png\"/></a></p>\n<p>可以通过 Sort by 查看其他版本的 php，默认是最新版本 <strong>php:latest</strong>。</p>\n<p>此外，我们还可以用 docker search php 命令来查看可用版本：</p>\n<pre>runoob@runoob:~/php-fpm$ docker search php\nNAME                      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nphp                       While designed for web development, the PH...   1232      [OK]       \nricharvey/nginx-php-fpm   Container running Nginx + PHP-FPM capable ...   207                  [OK]\nphpmyadmin/phpmyadmin     A web interface for MySQL and MariaDB.          123                  [OK]\neboraas/apache-php        PHP5 on Apache (with SSL support), built o...   69                   [OK]\nphp-zendserver            Zend Server - the integrated PHP applicati...   69        [OK]       \nmillion12/nginx-php       Nginx + PHP-FPM 5.5, 5.6, 7.0 (NG), CentOS...   67                   [OK]\nwebdevops/php-nginx       Nginx with PHP-FPM                              39                   [OK]\nwebdevops/php-apache      Apache with PHP-FPM (based on webdevops/php)    14                   [OK]\nphpunit/phpunit           PHPUnit is a programmer-oriented testing f...   14                   [OK]\ntetraweb/php              PHP 5.3, 5.4, 5.5, 5.6, 7.0 for CI and run...   12                   [OK]\nwebdevops/php             PHP (FPM and CLI) service container             10                   [OK]\n...</pre>\n<p>这里我们拉取官方的镜像,标签为5.6-fpm</p>\n<pre>runoob@runoob:~/php-fpm$ docker pull php:5.6-fpm</pre>\n<p>等待下载完成后，我们就可以在本地镜像列表里查到REPOSITORY为php,标签为5.6-fpm的镜像。</p>\n<pre>runoob@runoob:~/php-fpm$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nphp                 5.6-fpm             025041cd3aa5        6 days ago          456.3 MB</pre>\n<hr/>\n<h2>Nginx + PHP 部署</h2>\n<p>Nginx 部署可以查看：<a href=\"https://www.runoob.com/docker/docker-install-nginx.html\" title=\"Docker 安装 Nginx\">Docker 安装 Nginx</a>，一些 Nginx 的配置参考这篇文章。</p>\n<p>启动 PHP：</p>\n<pre>$ docker run --name  myphp-fpm -v ~/nginx/www:/www  -d php:5.6-fpm</pre>\n<p>命令说明：</p>\n<ul><li> <p><strong>--name myphp-fpm</strong> : 将容器命名为 myphp-fpm。</p> </li><li> <p><strong>-v ~/nginx/www:/www</strong> : 将主机中项目的目录 www 挂载到容器的 /www</p> </li></ul>\n<p>创建 ~/nginx/conf/conf.d 目录：</p>\n<pre>mkdir ~/nginx/conf/conf.d </pre>\n<p>在该目录下添加 <strong>~/nginx/conf/conf.d/runoob-test-php.conf</strong> 文件，内容如下：</p>\n<pre>server {\n    listen       80;\n    server_name  localhost;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm index.php;\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n    location ~ \\.php$ {\n        fastcgi_pass   php:9000;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME  /www/$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n}</pre>\n<p>配置文件说明：</p>\n<ul><li><strong>php:9000</strong>: 表示 php-fpm 服务的 URL，下面我们会具体说明。</li><li><strong>/www/</strong>: 是 <strong>myphp-fpm</strong> 中 php 文件的存储路径，映射到本地的 ~/nginx/www 目录。</li></ul>\n<p>启动 nginx：</p>\n<pre>docker run --name runoob-php-nginx -p 8083:80 -d \\\n    -v ~/nginx/www:/usr/share/nginx/html:ro \\\n    -v ~/nginx/conf/conf.d:/etc/nginx/conf.d:ro \\\n    --link myphp-fpm:php \\\n    nginx</pre>\n<ul><li><strong>-p 8083:80</strong>: 端口映射，把 <strong>nginx</strong> 中的 80 映射到本地的 8083 端口。</li><li><strong>~/nginx/www</strong>: 是本地 html 文件的存储目录，/usr/share/nginx/html 是容器内 html 文件的存储目录。</li><li><strong>~/nginx/conf/conf.d</strong>: 是本地 nginx 配置文件的存储目录，/etc/nginx/conf.d 是容器内 nginx 配置文件的存储目录。</li><li><strong>--link myphp-fpm:php</strong>: 把 <strong>myphp-fpm</strong> 的网络并入 <strong><em>nginx</em></strong>，并通过修改 <strong>nginx</strong> 的 /etc/hosts，把域名 <strong>php</strong> 映射成 127.0.0.1，让 nginx 通过 php:9000 访问 php-fpm。</li></ul>\n<p>接下来我们在 ~/nginx/www 目录下创建 index.php，代码如下：</p>\n<pre>&lt;?php\necho phpinfo();\n?&gt;</pre>\n<p>浏览器打开 <strong>http://127.0.0.1:8083/index.php</strong>，显示如下：</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\2b8b5c69a9b8109ad0d5e95e05e8e8a4.png\"/></p>\n<p> <a href=\"https://www.runoob.com/docker/docker-install-node.html\" title=\"Docker 安装 Node.js\">Docker 安装 Node.js</a></p>\n<p><a href=\"https://www.runoob.com/docker/docker-install-mysql.html\" title=\"Docker 安装 MySQL\">Docker 安装 MySQL</a></p>\n<h2></h2>\n<p>1 篇笔记 写笔记</p>\n<ol><li id=\"comment-34619\"> <p>   pengqiangsheng</p> <p>  294***2136@qq.com</p> <p> <a href=\"https://www.cnblogs.com/boundless-sky/p/7182410.html?utm_source=itdadao&amp;utm_medium=referral\" title=\"  参考地址\">  参考地址</a></p> <p>35</p> <p><strong>Docker 配置 nginx、php-fpm、mysql</strong></p> <p><strong>运行环境</strong></p> <p style=\"text-align:center;\"><img alt=\"\" src=\"image\\f1732245a7c2a47cc1bddb860686e6d4.png\"/></p> <p><strong>创建目录</strong></p> <pre>mkdir -p /Users/sui/docker/nginx/conf.d &amp;&amp; mkdir /Users/sui/www &amp;&amp;  cd /Users/sui/docker/nginx/conf.d &amp;&amp; sudo touch default.conf</pre> <p><strong>启动 php-fpm</strong></p> <p>解释执行 php 需要 php-fpm，先让它运行起来：</p> <pre>docker run --name sui-php -d \\\n    -v /Users/sui/www:/var/www/html:ro \\\n    php:7.1-fpm</pre> <p>--name sui-php 是容器的名字。</p> <p>/Users/sui/www 是本地 php 文件的存储目录，/var/www/html 是容器内 php 文件的存储目录，ro 表示只读。</p> <p><strong>编辑 nginx 配置文件</strong></p> <p>配置文件位置：/Users/sui/docker/nginx/conf.d/default.conf。</p> <pre>server {\n    listen       80;\n    server_name  localhost;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n    location ~ \\.php$ {\n        fastcgi_pass   php:9000;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME  /var/www/html/$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n}</pre> <p>说明：</p>\n<ul><li>php:9000 表示 php-fpm 服务的访问路径，下文还会提及。</li><li>/var/www/html 是 sui<strong><em>-php</em></strong> 中 php 文件的存储路径，经 docker 映射，变成本地路径 /Users/sui/www（可以再看一眼 php-fpm 启动命令</li></ul><p>启动 nginx:</p> <pre>docker run --name sui-nginx -p 80:80 -d \\\n    -v /Users/sui/www:/usr/share/nginx/html:ro \\\n    -v /Users/sui/docker/nginx/conf.d:/etc/nginx/conf.d:ro \\\n    --link sui-php:php \\\n    nginx</pre>\n<ul><li> -p 80:80 用于添加端口映射，把 <strong><em>sui-nginx</em></strong> 中的 80 端口暴露出来。</li><li> /Users/sui/www 是本地 html 文件的存储目录，/usr/share/nginx/html 是容器内 html 文件的存储目录。</li><li> /Users/sui/docker/nginx/conf.d 是本地 nginx 配置文件的存储目录，/etc/nginx/conf.d 是容器内 nginx 配置文件的存储目录。</li><li> --link sui-php:php 把 <strong><em>sui-php</em></strong> 的网络并入 <strong><em>sui-nginx</em></strong>，并通过修改 <strong><em>sui-nginx</em></strong> 的 /etc/hosts，把域名 <strong><em>php</em></strong> 映射成 127.0.0.1，让 nginx 通过 php:9000 访问 php-fpm。</li></ul><p style=\"text-align:center;\"><img alt=\"\" src=\"image\\d668abffd3e7a42a849f19e5a8627ddc.png\"/></p> <p><strong>测试结果</strong></p> <p>在 /Users/sui/www 下放两个文件：index.html index.php</p> <p style=\"text-align:center;\"><img alt=\"\" src=\"image\\504aa99540844666b274bbacc93efffb.png\"/></p> <p><strong>mysql 和 phpmyadmin</strong></p> <p>mysql 服务器</p> <pre>sudo mkdir -p /Users/sui/docker/mysql/data /Users/sui/docker/mysql/logs /Users/sui/docker/mysql/conf</pre>\n<ul><li> data 目录将映射为 mysql 容器配置的数据文件存放路径</li><li> logs 目录将映射为 mysql 容器的日志目录</li><li> conf 目录里的配置文件将映射为 mysql 容器的配置文件</li></ul><pre>docker run -p 3307:3306 --name sui-mysql -v /Users/sui/docker/mysql/conf:/etc/mysql -v /Users/sui/docker/mysql/logs:/logs -v /Users/sui/docker/mysql/data:/mysql_data -e MYSQL_ROOT_PASSWORD=123456 -d --link sui-php mysql</pre> <p>进入mysql客户端:</p> <pre>docker run -it --link sui-mysql:mysql --rm mysql sh -c 'exec mysql -h\"$MYSQL_PORT_3306_TCP_ADDR\" -P\"$MYSQL_PORT_3306_TCP_PORT\" -uroot -p\"$MYSQL_ENV_MYSQL_ROOT_PASSWORD\"'</pre> <p>注意：我本地 3306 端口有 mysql, 所以这里用3307端口。</p> <p style=\"text-align:center;\"><img alt=\"\" src=\"image\\3951eb2de0ba44979b0a892e60f38528.png\"/></p> <p><strong>phpmyadmin</strong></p> <pre>docker run --name sui-myadmin -d --link sui-mysql:db -p 8080:80 phpmyadmin/phpmyadmin</pre> <p style=\"text-align:center;\"><img alt=\"\" src=\"image\\b56eccfc3c32d39a3b10309a8593f06d.png\"/></p> <p>大功告成:</p> <p style=\"text-align:center;\"><img alt=\"\" src=\"image\\4056a791c56260e6f20df149858fb5d3.png\"/></p> <p>  </p>  </li></ol>\n</div>\n</div>"}