{"blogid": "126620429", "writerAge": "ç é¾„6å¹´", "writerBlogNum": "835", "writerCollect": "11227", "writerComment": "9932", "writerFan": "45962", "writerGrade": "8çº§", "writerIntegral": "34190", "writerName": "Lansonli", "writerProfileAdress": "writer_image\\profile_126620429.jpg", "writerRankTotal": "141", "writerRankWeekly": "24", "writerThumb": "9278", "writerVisitNum": "1320112", "blog_read_count": "467", "blog_time": "äºÂ 2022-08-31 11:46:36Â å‘å¸ƒ", "blog_title": "å¤§æ•°æ®ClickHouseè¿›é˜¶ï¼ˆä¸€ï¼‰ï¼šClickHouseä½¿ç”¨åœºæ™¯å’Œé›†ç¾¤å®‰è£…", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\d30183e3a0114961af47add45c5e3252.jpeg\"/></p>\n<p id=\"main-toc\"><strong>æ–‡ç« ç›®å½•</strong></p>\n<p id=\"ClickHouse%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%92%8C%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85-toc\" style=\"margin-left:0px;\"><a href=\"#ClickHouse%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%92%8C%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85\">ClickHouseä½¿ç”¨åœºæ™¯å’Œé›†ç¾¤å®‰è£…</a></p>\n<p id=\"%E4%B8%80%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-toc\" style=\"margin-left:40px;\"><a href=\"#%E4%B8%80%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\">ä¸€ã€ä½¿ç”¨åœºæ™¯</a></p>\n<p id=\"%E4%BA%8C%E3%80%81%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8BClickHouse%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85-toc\" style=\"margin-left:40px;\"><a href=\"#%E4%BA%8C%E3%80%81%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8BClickHouse%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85\">äºŒã€ClickHouseåˆ†å¸ƒå¼é›†ç¾¤å®‰è£…</a></p>\n<p id=\"1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85-toc\" style=\"margin-left:80px;\"><a href=\"#1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85\">1ã€åˆ†å¸ƒå¼é›†ç¾¤å®‰è£…</a></p>\n<p id=\"2%E3%80%81ClickHouse%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-toc\" style=\"margin-left:80px;\"><a href=\"#2%E3%80%81ClickHouse%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\">2ã€ClickHouseç›®å½•ç»“æ„</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<h1>ClickHouseä½¿ç”¨åœºæ™¯å’Œé›†ç¾¤å®‰è£…</h1>\n<h2 id=\"%E4%B8%80%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF\">ä¸€ã€ä½¿ç”¨åœºæ™¯</h2>\n<p style=\"margin-left:.0001pt;text-align:justify;\">ClickHouseæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œç”¨äºè”æœºåˆ†æï¼ˆOLAPï¼‰çš„åˆ—å¼æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMS-database manager systemï¼‰, å®ƒæ˜¯é¢å‘åˆ—çš„ï¼Œå¹¶å…è®¸ä½¿ç”¨SQLæŸ¥è¯¢ï¼Œå®æ—¶ç”Ÿæˆåˆ†ææŠ¥å‘Šã€‚ClickHouseæœ€åˆæ˜¯ä¸€æ¬¾åä¸ºYandex.Metricaçš„äº§å“ï¼Œä¸»è¦ç”¨äºWEBæµé‡åˆ†æã€‚ClickHouseçš„å…¨ç§°æ˜¯Click Streamï¼ŒData WareHouseï¼Œç®€ç§°ClickHouseã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">ClickHouseä½¿ç”¨C++è¿›è¡Œç¼–å†™ï¼Œå…·æœ‰å¾ˆå¤šä¼˜ç§€çš„ç‰¹ç‚¹ï¼Œå¦‚åœ¨ClickHouseåŸºç¡€ç¯‡æˆ‘ä»¬è®²è§£çš„ClickHouseç‰¹æ€§ï¼šå®Œå¤‡çš„DBMSåŠŸèƒ½ã€åˆ—å¼å­˜å‚¨ã€æ•°æ®å‹ç¼©ã€å‘é‡åŒ–æ‰§è¡Œã€æ”¯æŒæ ‡å‡†SQLã€æ”¯æŒ20å¤šå¼ è¡¨å¼•æ“ã€æ”¯æŒå¤šçº¿ç¨‹ä¸åˆ†å¸ƒå¼ã€å¤šä¸»æ¶æ„ã€äº¤äº’å¼æŸ¥è¯¢ã€æ•°æ®åˆ†ç‰‡ä¸åˆ†å¸ƒå¼æŸ¥è¯¢ç­‰ã€‚ClickHouseå®˜ç½‘åœ°å€ç”±åŸæ¥çš„https://ClickHouse.techæ”¹å˜ä¸ºhttps://ClickHouse.comã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">ClickHouseé€‚åˆOLAPæ•°æ®åˆ†æç±»çš„åœºæ™¯ï¼Œæ•°æ®ä½“é‡è¶Šå¤§ï¼ŒClickHouseçš„ä¼˜åŠ¿è¶Šå¤§ã€‚ClickHouseä¸é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>\n<ul><li style=\"text-align:justify;\"><strong>ClickHouse ä¸æ”¯æŒäº‹åŠ¡ï¼Œäº‹åŠ¡åœºæ™¯ä¸é€‚åˆ</strong></li><li style=\"text-align:justify;\"><strong>ä¸é€‚åˆæ ¹æ®ä¸»é”®è¿›è¡Œè¡Œç²’åº¦æŸ¥è¯¢æˆ–åˆ é™¤åœºæ™¯ï¼ˆæ”¯æŒä½†ä¸å»ºè®®ï¼‰</strong></li></ul>\n<p style=\"text-align:justify;\"></p>\n<h2 id=\"%E4%BA%8C%E3%80%81%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8BClickHouse%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85\" style=\"text-align:justify;\"><strong>äºŒã€</strong>â€‹â€‹â€‹â€‹â€‹â€‹â€‹<strong>ClickHouseåˆ†å¸ƒå¼é›†ç¾¤å®‰è£…</strong></h2>\n<p style=\"margin-left:.0001pt;text-align:justify;\">åœ¨åæœŸåˆ›å»ºè¡¨æ¼”ç¤ºClickHouseé«˜çº§æ“ä½œæ—¶ï¼Œå¿…é¡»ä½¿ç”¨åˆ°ClickHouseé›†ç¾¤ï¼Œç”±äºClickHouseå‘å±•éå¸¸è¿…é€Ÿï¼Œå‡ ä¹æ¯ä¸ªæœˆéƒ½ä¼šæ›´æ–°ClickHouseå‡ ä¸ªç‰ˆæœ¬ï¼Œä¸ä¹‹å‰çš„ClickHouse20.8ç‰ˆæœ¬ç›¸å¯¹æ¯”ï¼Œæ–°çš„ClickHouseç‰ˆæœ¬å®‰è£…ä¸é…ç½®æœ‰éƒ¨åˆ†ä¸åŒï¼Œ è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ClickHouse 21.9.4.35ç‰ˆæœ¬æ¥é‡æ–°è¿›è¡Œåˆ†å¸ƒå¼é›†ç¾¤æ­å»ºï¼Œé‡‡ç”¨rmpåŒ…çš„å®‰è£…æ–¹å¼ã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">æˆ‘ä»¬å¯ä»¥ä»å®˜ç½‘ç»™å®šçš„ä¸‹è½½rpmåŒ…çš„åœ°å€ä¸‹è½½æœ€æ–°çš„ClickHouse rpmå®‰è£…åŒ…ï¼Œåœ°å€å¦‚ä¸‹ï¼š<a href=\"https://repo.yandex.ru/clickhouse/rpm/stable/x86_64/\" title=\"https://repo.yandex.ru/ClickHouse/rpm/stable/x86_64/\">https://repo.yandex.ru/ClickHouse/rpm/stable/x86_64/</a></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">æ³¨æ„ï¼šè¿™é‡Œä»ClickHouse19.4ç‰ˆæœ¬ä¹‹åï¼Œåªéœ€è¦ä¸‹è½½3ä¸ªrpmå®‰è£…åŒ…å³å¯ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-bash\">ClickHouse-common-static-21.9.4.35-2.x86_64.rpm\nClickHouse-server-21.9.4.35-2.noarch.rpm\nClickHouse-client-21.9.4.35-2.noarch.rpm</code></pre>\n<p></p>\n<h3 id=\"1%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85\">1ã€åˆ†å¸ƒå¼é›†ç¾¤å®‰è£…</h3>\n<p style=\"margin-left:.0001pt;text-align:justify;\">ClickHouseåˆ†å¸ƒå¼é›†ç¾¤å®‰è£…é€‰æ‹©ä¸‰å°èŠ‚ç‚¹ï¼Œåˆ†åˆ«ä¸ºnode1,node2,node3ï¼Œè¯¦ç»†å®‰è£…æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<p style=\"text-align:justify;\"><strong><strong>1.1ã€é€‰æ‹©ä¸‰å°clicsskhouseèŠ‚ç‚¹ï¼Œåœ¨æ¯å°èŠ‚ç‚¹ä¸Šå®‰è£…ClickHouseéœ€è¦çš„å®‰è£…åŒ…</strong></strong></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">è¿™é‡Œé€‰æ‹©node1ã€node2,node3ä¸‰å°èŠ‚ç‚¹ï¼Œä¸Šä¼ å®‰è£…åŒ…ï¼Œåˆ†åˆ«åœ¨æ¯å°èŠ‚ç‚¹ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…ClickHouse:</p>\n<pre><code class=\"language-bash\">rpm -ivh ./ClickHouse-common-static-21.9.4.35-2.x86_64.rpm\n#æ³¨æ„åœ¨å®‰è£…ä»¥ä¸‹rpmåŒ…æ—¶ï¼Œè®©è¾“å…¥å¯†ç ï¼Œå¯ä»¥ç›´æ¥å›è½¦è·³è¿‡\nrpm -ivh ./ClickHouse-server-21.9.4.35-2.noarch.rpm\nrpm -ivh ClickHouse-client-21.9.4.35-2.noarch.rpm</code></pre>\n<p></p>\n<p><strong>1.2ã€å®‰è£…zookeeperé›†ç¾¤å¹¶å¯åŠ¨</strong></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">æ­å»ºClickHouseé›†ç¾¤æ—¶ï¼Œéœ€è¦ä½¿ç”¨Zookeeperå»å®ç°é›†ç¾¤å‰¯æœ¬ä¹‹é—´çš„åŒæ­¥ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦zookeeperé›†ç¾¤ï¼Œzookeeperé›†ç¾¤å®‰è£…åå¯å¿½ç•¥æ­¤æ­¥éª¤ã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><strong>1.3ã€é…ç½®å¤–ç½‘å¯è®¿é—®</strong></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">åœ¨æ¯å°ClickHouseèŠ‚ç‚¹ä¸­é…ç½®/etc/ClickHouse-server/config.xmlæ–‡ä»¶ç¬¬164è¡Œ&lt;listen_host&gt;ï¼Œå¦‚ä¸‹ï¼š</p>\n<pre><code class=\"language-bash\">&lt;listen_host&gt;::1&lt;/listen_host&gt;\n#æ³¨æ„æ¯å°èŠ‚ç‚¹ç›‘å¬çš„hoståç§°é…ç½®å½“å‰èŠ‚ç‚¹host\n&lt;listen_host&gt;node1&lt;/listen_host&gt;</code></pre>\n<p></p>\n<p><strong>1.4ã€åœ¨æ¯å°èŠ‚ç‚¹åˆ›å»ºmetrika.xmlæ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹</strong></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">åœ¨node1ã€node2ã€node3èŠ‚ç‚¹ä¸Š/etc/ClickHouse-server/config.dè·¯å¾„ä¸‹ä¸‹é…ç½®metrika.xmlæ–‡ä»¶ï¼Œé»˜è®¤ClickHouseä¼šåœ¨/etcè·¯å¾„ä¸‹æŸ¥æ‰¾metrika.xmlæ–‡ä»¶ï¼Œä½†æ˜¯å¿…é¡»è¦æ±‚metrika.xmlä¸Šçº§ç›®å½•æ‹¥æœ‰è€…æƒé™ä¸ºClickHouse ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°†metrika.xmlåˆ›å»ºåœ¨/etc/ClickHouse-server/config.dè·¯å¾„ä¸‹ï¼Œconfig.dç›®å½•çš„æ‹¥æœ‰è€…æƒé™ä¸ºClickHouseã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">åœ¨metrika.xmlä¸­æˆ‘ä»¬é…ç½®åæœŸä½¿ç”¨çš„ClickHouseé›†ç¾¤ä¸­åˆ›å»ºåˆ†å¸ƒå¼è¡¨æ—¶ä½¿ç”¨3ä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡æœ‰1ä¸ªå‰¯æœ¬ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">vim /etc/ClickHouse-server/config.d/metrika.xml:</p>\n<pre><code class=\"language-XML\">&lt;yandex&gt;\n    &lt;remote_servers&gt;\n        &lt;ClickHouse_cluster_3shards_1replicas&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;node1&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;node2&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n            &lt;shard&gt;\n                &lt;internal_replication&gt;true&lt;/internal_replication&gt;\n                &lt;replica&gt;\n                    &lt;host&gt;node3&lt;/host&gt;\n                    &lt;port&gt;9000&lt;/port&gt;\n                &lt;/replica&gt;\n            &lt;/shard&gt;\n        &lt;/ClickHouse_cluster_3shards_1replicas&gt;\n    &lt;/remote_servers&gt;\n     \n    &lt;zookeeper&gt;\n        &lt;node index=\"1\"&gt;\n            &lt;host&gt;node3&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n        &lt;node index=\"2\"&gt;\n            &lt;host&gt;node4&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n        &lt;node index=\"3\"&gt;\n            &lt;host&gt;node5&lt;/host&gt;\n            &lt;port&gt;2181&lt;/port&gt;\n        &lt;/node&gt;\n    &lt;/zookeeper&gt;\n    &lt;macros&gt;\n        &lt;shard&gt;01&lt;/shard&gt; \n        &lt;replica&gt;node1&lt;/replica&gt;\n    &lt;/macros&gt;\n    &lt;networks&gt;\n        &lt;ip&gt;::/0&lt;/ip&gt;\n    &lt;/networks&gt;\n    &lt;ClickHouse_compression&gt;\n        &lt;case&gt;\n            &lt;min_part_size&gt;10000000000&lt;/min_part_size&gt;\n            &lt;min_part_size_ratio&gt;0.01&lt;/min_part_size_ratio&gt;\n            &lt;method&gt;lz4&lt;/method&gt;\n        &lt;/case&gt;\n    &lt;/ClickHouse_compression&gt;\n&lt;/yandex&gt;</code></pre>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><strong>å¯¹ä»¥ä¸Šé…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹çš„è§£é‡Šå¦‚ä¸‹:</strong></p>\n<ul><li style=\"text-align:justify;\">remote_serversï¼š</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">ClickHouseé›†ç¾¤é…ç½®æ ‡ç­¾ï¼Œå›ºå®šå†™æ³•ã€‚<strong><span style=\"color:#ff0000;\"><strong>æ³¨æ„ï¼šè¿™é‡Œä¸ä¹‹å‰ç‰ˆæœ¬ä¸åŒï¼Œä¹‹å‰è¦æ±‚å¿…é¡»ä»¥ClickHouseå¼€å¤´ï¼Œæ–°ç‰ˆæœ¬ä¸å†éœ€è¦ã€‚</strong></span></strong></p>\n<ul><li style=\"text-align:justify;\">ClickHouse_cluster_3shards_1replicas:</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">é…ç½®ClickHouseçš„é›†ç¾¤åç§°ï¼Œå¯è‡ªç”±å®šä¹‰åç§°ï¼Œæ³¨æ„é›†ç¾¤åç§°ä¸­ä¸èƒ½åŒ…å«ç‚¹å·ã€‚è¿™é‡Œä»£è¡¨é›†ç¾¤ä¸­æœ‰3ä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡æœ‰1ä¸ªå‰¯æœ¬ã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">åˆ†ç‰‡æ˜¯æŒ‡åŒ…å«éƒ¨åˆ†æ•°æ®çš„æœåŠ¡å™¨ï¼Œè¦è¯»å–æ‰€æœ‰çš„æ•°æ®ï¼Œå¿…é¡»è®¿é—®æ‰€æœ‰çš„åˆ†ç‰‡ã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">å‰¯æœ¬æ˜¯æŒ‡å­˜å‚¨åˆ†ç‰‡å¤‡ä»½æ•°æ®çš„æœåŠ¡å™¨ï¼Œè¦è¯»å–æ‰€æœ‰çš„æ•°æ®ï¼Œè®¿é—®ä»»æ„å‰¯æœ¬ä¸Šçš„æ•°æ®å³å¯ã€‚</p>\n<ul><li style=\"text-align:justify;\">shardï¼š</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">åˆ†ç‰‡ï¼Œä¸€ä¸ªClickHouseé›†ç¾¤å¯ä»¥åˆ†å¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯ä»¥å­˜å‚¨æ•°æ®ï¼Œè¿™é‡Œ<strong><span style=\"color:#ff0000;\"><strong>åˆ†ç‰‡å¯ä»¥ç†è§£ä¸ºClickHouseæœºå™¨ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œ1ä¸ªåˆ†ç‰‡åªèƒ½å¯¹åº”1æœåŠ¡èŠ‚ç‚¹</strong></span></strong>ã€‚è¿™é‡Œå¯ä»¥é…ç½®ä¸€ä¸ªæˆ–è€…ä»»æ„å¤šä¸ªåˆ†ç‰‡ï¼Œåœ¨æ¯ä¸ªåˆ†ç‰‡ä¸­å¯ä»¥é…ç½®ä¸€ä¸ªæˆ–ä»»æ„å¤šä¸ªå‰¯æœ¬ï¼Œä¸åŒåˆ†ç‰‡å¯é…ç½®ä¸åŒæ•°é‡çš„å‰¯æœ¬ã€‚å¦‚æœåªæ˜¯é…ç½®ä¸€ä¸ªåˆ†ç‰‡ï¼Œè¿™ç§æƒ…å†µä¸‹æŸ¥è¯¢æ“ä½œåº”è¯¥ç§°ä¸ºè¿œç¨‹æŸ¥è¯¢ï¼Œè€Œä¸æ˜¯åˆ†å¸ƒå¼æŸ¥è¯¢ã€‚</p>\n<ul><li style=\"text-align:justify;\">replicaï¼š</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">æ¯ä¸ªåˆ†ç‰‡çš„å‰¯æœ¬ï¼Œé»˜è®¤æ¯ä¸ªåˆ†ç‰‡é…ç½®äº†ä¸€ä¸ªå‰¯æœ¬ã€‚ä¹Ÿå¯ä»¥é…ç½®å¤šä¸ªï¼Œå‰¯æœ¬çš„æ•°é‡ä¸Šé™æ˜¯ç”±ClickHouseèŠ‚ç‚¹çš„æ•°é‡å†³å®šçš„ã€‚å¦‚æœé…ç½®äº†å‰¯æœ¬ï¼Œè¯»å–æ“ä½œå¯ä»¥ä»æ¯ä¸ªåˆ†ç‰‡é‡Œé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„å‰¯æœ¬ã€‚å¦‚æœå‰¯æœ¬ä¸å¯ç”¨ï¼Œä¼šä¾æ¬¡é€‰æ‹©ä¸‹ä¸ªå‰¯æœ¬è¿›è¡Œè¿æ¥ã€‚è¯¥æœºåˆ¶åˆ©äºç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p>\n<ul><li style=\"text-align:justify;\">internal_replicationï¼š</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">é»˜è®¤ä¸ºfalse,å†™æ•°æ®æ“ä½œä¼šå°†æ•°æ®å†™å…¥æ‰€æœ‰çš„å‰¯æœ¬ï¼Œè®¾ç½®ä¸ºtrue,å†™æ“ä½œåªä¼šé€‰æ‹©ä¸€ä¸ªæ­£å¸¸çš„å‰¯æœ¬å†™å…¥æ•°æ®ï¼Œæ•°æ®çš„åŒæ­¥åœ¨åå°è‡ªåŠ¨è¿›è¡Œã€‚</p>\n<ul><li style=\"text-align:justify;\">zookeeperï¼š</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">é…ç½®çš„zookeeperé›†ç¾¤ï¼Œ<strong><span style=\"color:#ff0000;\"><strong>æ³¨æ„ï¼šä¸ä¹‹å‰ç‰ˆæœ¬ä¸åŒï¼Œä¹‹å‰ç‰ˆæœ¬æ˜¯â€œzookeeper-serversâ€ã€‚</strong></span></strong></p>\n<ul><li style=\"text-align:justify;\">macrosï¼š</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">åŒºåˆ†æ¯å°ClickHouseèŠ‚ç‚¹çš„å®é…ç½®ï¼Œmacrosä¸­æ ‡ç­¾&lt;shard&gt;ä»£è¡¨å½“å‰èŠ‚ç‚¹çš„åˆ†ç‰‡å·ï¼Œæ ‡ç­¾&lt;replica&gt;ä»£è¡¨å½“å‰èŠ‚ç‚¹çš„å‰¯æœ¬å·ï¼Œè¿™ä¸¤ä¸ªåç§°å¯ä»¥éšæ„å–ï¼ŒåæœŸåœ¨åˆ›å»ºå‰¯æœ¬è¡¨æ—¶å¯ä»¥åŠ¨æ€è¯»å–è¿™ä¸¤ä¸ªå®å˜é‡ã€‚æ³¨æ„ï¼šæ¯å°ClickHouseèŠ‚ç‚¹éœ€è¦é…ç½®ä¸åŒåç§°ã€‚</p>\n<ul><li style=\"text-align:justify;\">networksï¼š</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">è¿™é‡Œé…ç½®ipä¸ºâ€œ::/0â€ä»£è¡¨ä»»æ„IPå¯ä»¥è®¿é—®ï¼ŒåŒ…å«IPv4å’ŒIPv6ã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">æ³¨æ„ï¼šå…è®¸å¤–ç½‘è®¿é—®è¿˜éœ€é…ç½®/etc/ClickHouse-server/config.xml å‚ç…§ç¬¬ä¸‰æ­¥éª¤ã€‚</p>\n<ul><li style=\"text-align:justify;\">ClickHouse_compressionï¼š</li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">MergeTreeå¼•æ“è¡¨çš„æ•°æ®å‹ç¼©è®¾ç½®ï¼Œmin_part_sizeï¼šä»£è¡¨æ•°æ®éƒ¨åˆ†æœ€å°å¤§å°ã€‚min_part_size_ratioï¼šæ•°æ®éƒ¨åˆ†å¤§å°ä¸è¡¨å¤§å°çš„æ¯”ç‡ã€‚methodï¼šæ•°æ®å‹ç¼©æ ¼å¼ã€‚</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><strong><span style=\"color:#ff0000;\"><strong>æ³¨æ„ï¼šéœ€è¦åœ¨æ¯å°ClickHouseèŠ‚ç‚¹ä¸Šé…ç½®metrika.xmlæ–‡ä»¶ï¼Œå¹¶ä¸”ä¿®æ”¹æ¯ä¸ªèŠ‚ç‚¹çš„ macrosé…ç½®åç§°ã€‚</strong></span></strong></p>\n<pre><code class=\"language-XML\">#node2èŠ‚ç‚¹ä¿®æ”¹metrika.xmlä¸­çš„å®å˜é‡å¦‚ä¸‹ï¼š\n    &lt;macros&gt;\n        &lt;shard&gt;02&lt;/replica&gt; \n        &lt;replica&gt;node2&lt;/replica&gt;\n    &lt;/macros&gt;\n\n#node3èŠ‚ç‚¹ä¿®æ”¹metrika.xmlä¸­çš„å®å˜é‡å¦‚ä¸‹:\n&lt;macros&gt;\n        &lt;shard&gt;03&lt;/replica&gt; \n        &lt;replica&gt;node3&lt;/replica&gt;\n    &lt;/macros&gt;</code></pre>\n<p></p>\n<p><strong>1.5ã€åœ¨æ¯å°èŠ‚ç‚¹ä¸Šå¯åŠ¨/æŸ¥çœ‹/é‡å¯/åœæ­¢ClickHouseæœåŠ¡</strong></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">é¦–å…ˆå¯åŠ¨zookeeperé›†ç¾¤ï¼Œç„¶ååˆ†åˆ«åœ¨node1ã€node2ã€node3èŠ‚ç‚¹ä¸Šå¯åŠ¨ClickHouseæœåŠ¡ï¼Œè¿™é‡Œæ¯å°èŠ‚ç‚¹å’Œå•èŠ‚ç‚¹å¯åŠ¨ä¸€æ ·ã€‚å¯åŠ¨ä¹‹åï¼ŒClickHouseé›†ç¾¤é…ç½®å®Œæˆã€‚</p>\n<pre><code class=\"language-bash\">#æ¯å°èŠ‚ç‚¹å¯åŠ¨ClickchouseæœåŠ¡\nservice ClickHouse-server start\n\n#æ¯å°èŠ‚ç‚¹æŸ¥çœ‹ClickHouseæœåŠ¡çŠ¶æ€\nservice ClickHouse-server status\n\n#æ¯å°èŠ‚ç‚¹é‡å¯ClickHouseæœåŠ¡\nservice ClickHouse-server restart\n\n#æ¯å°èŠ‚ç‚¹å…³é—­ClikchouseæœåŠ¡\nservice clickhose-server stop</code></pre>\n<p></p>\n<p><strong>1.6ã€æ£€æŸ¥é›†ç¾¤é…ç½®æ˜¯å¦å®Œæˆ</strong></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">åœ¨node1ã€node2ã€node3ä»»æ„ä¸€å°èŠ‚ç‚¹è¿›å…¥ClickHouseå®¢æˆ·ç«¯ï¼ŒæŸ¥è¯¢é›†ç¾¤é…ç½®ï¼š</p>\n<pre><code class=\"language-bash\">#é€‰æ‹©ä¸‰å°ClickHouseä»»æ„ä¸€å°èŠ‚ç‚¹ï¼Œè¿›å…¥å®¢æˆ·ç«¯\nClickHouse-client \n#æŸ¥è¯¢é›†ç¾¤ä¿¡æ¯ï¼Œçœ‹åˆ°ä¸‹å›¾æ‰€ç¤ºå³ä»£è¡¨é›†ç¾¤é…ç½®æˆåŠŸã€‚\nnode1 :) select * from system.clusters;</code></pre>\n<p><img alt=\"\" height=\"208\" src=\"image\\de7b142e50914534a80448dd14d3bc37.png\" width=\"1200\"/></p>\n<pre><code class=\"language-bash\">#æŸ¥è¯¢é›†ç¾¤ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤\nnode1 :) select cluster,host_name from system.clusters;</code></pre>\n<p> <img alt=\"\" height=\"189\" src=\"image\\2de28e8e829843b89742f9c189019ee3.png\" width=\"692\"/></p>\n<p></p>\n<h3 id=\"2%E3%80%81ClickHouse%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\"><strong>2ã€ClickHouseç›®å½•ç»“æ„</strong></h3>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><strong>ClickHouseé›†ç¾¤å®‰è£…å®Œæˆä¹‹åä¼šç”Ÿæˆå¦‚ä¸‹å¯¹åº”çš„ç›®å½•ï¼Œæ¯ä¸ªç›®å½•çš„ä»‹ç»å¦‚ä¸‹ï¼š</strong></p>\n<ul><li style=\"text-align:justify;\"><strong>/etc/ClickHouse-server :</strong></li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼ŒåŒ…æ‹¬å…¨å±€é…ç½®config.xml å’Œç”¨æˆ·é…ç½®users.xmlã€‚</p>\n<ul><li style=\"text-align:justify;\"><strong>/var/lib/ClickHouse :</strong></li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">é»˜è®¤çš„æ•°æ®å­˜å‚¨ç›®å½•ï¼Œé€šå¸¸ä¼šä¿®æ”¹ï¼Œå°†æ•°æ®ä¿å­˜åˆ°å¤§å®¹é‡ç£ç›˜è·¯å¾„ä¸­ï¼Œæ­¤è·¯å¾„å¯ä»¥é€šè¿‡/etc/ClickHouse-server/config.xmlé…ç½®ï¼Œé…ç½®æ ‡ç­¾&lt;path&gt;å¯¹åº”çš„æ•°æ®ã€‚</p>\n<ul><li style=\"text-align:justify;\"><strong>/var/log/cilckhouse-server :</strong></li></ul>\n<p style=\"margin-left:.0001pt;text-align:justify;\">é»˜è®¤ä¿å­˜æ—¥å¿—çš„ç›®å½•ï¼Œé€šå¸¸ä¼šä¿®æ”¹ï¼Œå°†æ•°æ®ä¿å­˜åˆ°å¤§å®¹é‡ç£ç›˜è·¯å¾„ä¸­ï¼Œæ­¤è·¯å¾„å¯ä»¥é€šè¿‡/etc/ClickHouse-server/config.xmlé…ç½®ï¼Œé…ç½®æ ‡ç­¾&lt;log&gt;å¯¹åº”çš„æ•°æ®ã€‚</p>\n<p style=\"text-align:justify;\"><strong>åœ¨/usr/binä¸‹ä¼šæœ‰å¯æ‰§è¡Œæ–‡ä»¶ï¼š</strong></p>\n<ul><li style=\"text-align:justify;\">ClickHouse:ä¸»ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶</li><li style=\"text-align:justify;\">ClickHouse-server:ä¸€ä¸ªæŒ‡å‘ClickHouseå¯æ‰§è¡Œæ–‡ä»¶çš„è½¯è¿æ¥ï¼Œä¾›æœåŠ¡ç«¯å¯åŠ¨ä½¿ç”¨</li><li style=\"text-align:justify;\">ClickHouse-client:ä¸€ä¸ªæŒ‡å‘ClickHouseå¯æ‰§è¡Œæ–‡ä»¶çš„è½¯è¿æ¥ï¼Œä¾›å®¢æˆ·ç«¯å¯åŠ¨ä½¿ç”¨</li></ul>\n<p> </p>\n<hr/>\n<ul><li>ğŸ“¢åšå®¢ä¸»é¡µï¼š<a href=\"https://lansonli.blog.csdn.net/\" title=\"https://lansonli.blog.csdn.net\">https://lansonli.blog.csdn.net</a></li><li>ğŸ“¢æ¬¢è¿ç‚¹èµ ğŸ‘ æ”¶è— â­ç•™è¨€ ğŸ“ å¦‚æœ‰é”™è¯¯æ•¬è¯·æŒ‡æ­£ï¼</li><li>ğŸ“¢æœ¬æ–‡ç”± Lansonli åŸåˆ›ï¼Œé¦–å‘äº CSDNåšå®¢ğŸ™‰</li><li>ğŸ“¢åœä¸‹ä¼‘æ¯çš„æ—¶å€™ä¸è¦å¿˜äº†åˆ«äººè¿˜åœ¨å¥”è·‘ï¼Œå¸Œæœ›å¤§å®¶æŠ“ç´§æ—¶é—´å­¦ä¹ ï¼Œå…¨åŠ›å¥”èµ´æ›´ç¾å¥½çš„ç”Ÿæ´»âœ¨</li></ul>\n</div>\n</div>"}