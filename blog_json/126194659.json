{"blogid": "126194659", "writerAge": "码龄2年", "writerBlogNum": "180", "writerCollect": "4030", "writerComment": "2963", "writerFan": "23586", "writerGrade": "7级", "writerIntegral": "11032", "writerName": "侯小啾", "writerProfileAdress": "writer_image\\profile_126194659.jpg", "writerRankTotal": "1009", "writerRankWeekly": "23", "writerThumb": "3361", "writerVisitNum": "332888", "blog_read_count": "512", "blog_time": "已于 2022-08-11 09:16:14 修改", "blog_title": "python机器学习 一元线性回归 梯度下降法的实现 【Python机器学习系列（四）】", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-kimbie-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p><font color=\"brown\" size=\"5\">python机器学习 一元线性回归 梯度下降法的实现 【Python机器学习系列（四）】<br/> </font></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#_4\">①首先读取数据集</a></li><li><a href=\"#_16\">②初始化相关参数</a></li><li><a href=\"#MSE_29\">③定义计算代价函数--&gt;MSE</a></li><li><a href=\"#_47\">④梯度下降</a></li><li><a href=\"#_87\">⑤执行</a></li></ul>\n</div>\n<br/>\n<font color=\"brown\" size=\"4\">梯度下降法的机器学习的重要思想之一，梯度下降法的目标，是使得代价函数最小。下边对梯度下降算法的实现展开详细介绍。</font>\n<p></p>\n<hr/>\n<h1><a id=\"_4\"></a>①首先读取数据集</h1>\n<p><font size=\"4\">导包并读取数据，数据自行任意准备，只要有两列，可以分为自变量x和因变量y即可即可。</font></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt\n\ndata <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>loadtxt<span class=\"token punctuation\">(</span><span class=\"token string\">\"data.csv\"</span><span class=\"token punctuation\">,</span> delimiter<span class=\"token operator\">=</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span>\n\nx_data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\ny_data <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n</code></pre>\n<hr/>\n<h1><a id=\"_16\"></a>②初始化相关参数</h1>\n<pre><code class=\"prism language-python\"><span class=\"token comment\"># 初始化 学习率 即每次梯度下降时的步长 这里设置为0.0001</span>\nlearning_rate <span class=\"token operator\">=</span> <span class=\"token number\">0.0001</span>\n\n<span class=\"token comment\"># 初始化 截距b 与 斜率k</span>\nb <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\nk <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token comment\"># 初始化最大迭代的次数 以50次为例</span>\nn_iterables <span class=\"token operator\">=</span> <span class=\"token number\">50</span>\n</code></pre>\n<hr/>\n<h1><a id=\"MSE_29\"></a>③定义计算代价函数–&gt;MSE</h1>\n<p><font size=\"4\">使用均方误差 MSE （Mean Square Error）来作为性能度量标准<br/> 假设共有m个样本数据，则均方误差：<br/>  <br/> <font color=\"brown\" size=\"5\">           <span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n      \n       \n        \n         \n          M\n         \n         \n          S\n         \n         \n          E\n         \n         \n          =\n         \n         \n          \n           1\n          \n          \n           m\n          \n         \n         \n          \n           ∑\n          \n          \n           \n            i\n           \n           \n            =\n           \n           \n            1\n           \n          \n          \n           m\n          \n         \n         \n          [\n         \n         \n          (\n         \n         \n          k\n         \n         \n          \n           x\n          \n          \n           i\n          \n         \n         \n          +\n         \n         \n          b\n         \n         \n          )\n         \n         \n          −\n         \n         \n          \n           y\n          \n          \n           i\n          \n         \n         \n          \n           ]\n          \n          \n           2\n          \n         \n        \n        \n         MSE=\\frac{1}{m}\\sum_{i=1}^{m}[(kx_i+b)-y_i]^2\n        \n       \n      </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right: 0.0576em;\">MSE</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1.1901em; vertical-align: -0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.8451em;\"><span class=\"\" style=\"top: -2.655em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"\" style=\"top: -3.23em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width: 0.04em;\"></span></span><span class=\"\" style=\"top: -3.394em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.345em;\"><span class=\"\"></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position: relative; top: 0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.8043em;\"><span class=\"\" style=\"top: -2.4003em; margin-left: 0em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span class=\"\" style=\"top: -3.2029em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.2997em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mopen\">[(</span><span class=\"mord mathnormal\" style=\"margin-right: 0.0315em;\">k</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.3117em;\"><span class=\"\" style=\"top: -2.55em; margin-left: 0em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.15em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right: 0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1.0641em; vertical-align: -0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right: 0.0359em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.3117em;\"><span class=\"\" style=\"top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.15em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">]</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.8141em;\"><span class=\"\" style=\"top: -3.063em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></font></font></p>\n<p>将该公式定义为代价函数，此外为例后续求导方便，则使结果在原mse的基础上，再乘以1/2。</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">compute_mse</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span>  k<span class=\"token punctuation\">,</span>  x_data<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    total_error <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        total_error <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>y_data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>k <span class=\"token operator\">*</span> x_data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token number\">2</span>\n\n    <span class=\"token comment\"># 为方便求导：乘以1/2</span>\n    mse_ <span class=\"token operator\">=</span> total_error <span class=\"token operator\">/</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span>\n    <span class=\"token keyword\">return</span> mse_\n</code></pre>\n<hr/>\n<h1><a id=\"_47\"></a>④梯度下降</h1>\n<p><font size=\"4\">分别对上述的MSE表达式（乘以1/2后）中的k,b求偏导，<br/>  <br/> <font color=\"brown\" size=\"6\">        <span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n      \n       \n        \n         \n          \n           \n            ∂\n           \n           \n            \n             1\n            \n            \n             2\n            \n           \n           \n            M\n           \n           \n            S\n           \n           \n            E\n           \n          \n          \n           \n            ∂\n           \n           \n            b\n           \n          \n         \n         \n          =\n         \n         \n          \n           ∑\n          \n          \n           \n            i\n           \n           \n            =\n           \n           \n            1\n           \n          \n          \n           m\n          \n         \n         \n          \n           \n            (\n           \n           \n            k\n           \n           \n            \n             x\n            \n            \n             i\n            \n           \n           \n            +\n           \n           \n            b\n           \n           \n            −\n           \n           \n            \n             y\n            \n            \n             i\n            \n           \n           \n            )\n           \n          \n          \n           m\n          \n         \n        \n        \n         \\frac{∂ \\frac{1}{2}MSE}{∂b}=\\sum_{i=1}^m\\frac{(kx_i+b-y_i)}{m}\n        \n       \n      </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 1.4868em; vertical-align: -0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 1.1418em;\"><span class=\"\" style=\"top: -2.655em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right: 0.0556em;\">∂</span><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"\" style=\"top: -3.23em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width: 0.04em;\"></span></span><span class=\"\" style=\"top: -3.5508em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right: 0.0556em;\">∂</span><span class=\"mord mtight\"><span class=\"mopen nulldelimiter sizing reset-size3 size6\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.8443em;\"><span class=\"\" style=\"top: -2.656em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"\" style=\"top: -3.2255em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"frac-line mtight\" style=\"border-bottom-width: 0.049em;\"></span></span><span class=\"\" style=\"top: -3.384em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.344em;\"><span class=\"\"></span></span></span></span></span><span class=\"mclose nulldelimiter sizing reset-size3 size6\"></span></span><span class=\"mord mathnormal mtight\" style=\"margin-right: 0.0576em;\">MSE</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.345em;\"><span class=\"\"></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1.355em; vertical-align: -0.345em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position: relative; top: 0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.8043em;\"><span class=\"\" style=\"top: -2.4003em; margin-left: 0em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span class=\"\" style=\"top: -3.2029em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.2997em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 1.01em;\"><span class=\"\" style=\"top: -2.655em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"\" style=\"top: -3.23em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width: 0.04em;\"></span></span><span class=\"\" style=\"top: -3.485em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right: 0.0315em;\">k</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.3281em;\"><span class=\"\" style=\"top: -2.357em; margin-left: 0em; margin-right: 0.0714em;\"><span class=\"pstrut\" style=\"height: 2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.143em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\">b</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right: 0.0359em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.3281em;\"><span class=\"\" style=\"top: -2.357em; margin-left: -0.0359em; margin-right: 0.0714em;\"><span class=\"pstrut\" style=\"height: 2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.143em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.345em;\"><span class=\"\"></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span><br/>  <br/> <font color=\"brown\" size=\"6\">        <span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n       \n        \n         \n          \n           \n            \n             ∂\n            \n            \n             \n              1\n             \n             \n              2\n             \n            \n            \n             M\n            \n            \n             S\n            \n            \n             E\n            \n           \n           \n            \n             ∂\n            \n            \n             k\n            \n           \n          \n          \n           =\n          \n          \n           \n            ∑\n           \n           \n            \n             i\n            \n            \n             =\n            \n            \n             1\n            \n           \n           \n            m\n           \n          \n          \n           \n            \n             (\n            \n            \n             k\n            \n            \n             \n              x\n             \n             \n              i\n             \n            \n            \n             +\n            \n            \n             b\n            \n            \n             −\n            \n            \n             \n              y\n             \n             \n              i\n             \n            \n            \n             )\n            \n            \n             \n              x\n             \n             \n              i\n             \n            \n           \n           \n            m\n           \n          \n         \n         \n          \\frac{∂ \\frac{1}{2}MSE}{∂k}=\\sum_{i=1}^m\\frac{(kx_i+b-y_i)x_i}{m}\n         \n        \n       </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 1.4868em; vertical-align: -0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 1.1418em;\"><span class=\"\" style=\"top: -2.655em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right: 0.0556em;\">∂</span><span class=\"mord mathnormal mtight\" style=\"margin-right: 0.0315em;\">k</span></span></span></span><span class=\"\" style=\"top: -3.23em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width: 0.04em;\"></span></span><span class=\"\" style=\"top: -3.5508em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right: 0.0556em;\">∂</span><span class=\"mord mtight\"><span class=\"mopen nulldelimiter sizing reset-size3 size6\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.8443em;\"><span class=\"\" style=\"top: -2.656em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"\" style=\"top: -3.2255em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"frac-line mtight\" style=\"border-bottom-width: 0.049em;\"></span></span><span class=\"\" style=\"top: -3.384em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.344em;\"><span class=\"\"></span></span></span></span></span><span class=\"mclose nulldelimiter sizing reset-size3 size6\"></span></span><span class=\"mord mathnormal mtight\" style=\"margin-right: 0.0576em;\">MSE</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.345em;\"><span class=\"\"></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right: 0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1.355em; vertical-align: -0.345em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position: relative; top: 0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.8043em;\"><span class=\"\" style=\"top: -2.4003em; margin-left: 0em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span class=\"\" style=\"top: -3.2029em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.2997em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right: 0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 1.01em;\"><span class=\"\" style=\"top: -2.655em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"\" style=\"top: -3.23em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width: 0.04em;\"></span></span><span class=\"\" style=\"top: -3.485em;\"><span class=\"pstrut\" style=\"height: 3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right: 0.0315em;\">k</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.3281em;\"><span class=\"\" style=\"top: -2.357em; margin-left: 0em; margin-right: 0.0714em;\"><span class=\"pstrut\" style=\"height: 2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.143em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mbin mtight\">+</span><span class=\"mord mathnormal mtight\">b</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right: 0.0359em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.3281em;\"><span class=\"\" style=\"top: -2.357em; margin-left: -0.0359em; margin-right: 0.0714em;\"><span class=\"pstrut\" style=\"height: 2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.143em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mclose mtight\">)</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.3281em;\"><span class=\"\" style=\"top: -2.357em; margin-left: 0em; margin-right: 0.0714em;\"><span class=\"pstrut\" style=\"height: 2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.143em;\"><span class=\"\"></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.345em;\"><span class=\"\"></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></font></font></font></p>\n<p><font size=\"4\">更新b和k时，使用原来的b,k值分别减去关于b、k的偏导数与学习率的乘积即可。至于为什么使用减号，可以这么理解：以斜率k为例，当其导数大于零的时候，则表示均方误差随着斜率的增大而增大，为了使均方误差减小，则不应该使斜率继续增大，所以需要使其减小，反之当偏导大于零的时候也是同理。其次，因为这个导数衡量的是均方误差的变化，而不是斜率和截距的变化，所以这里需要引入一个学习率，使得其与偏导数的乘积能够在一定程度上起到控制截距和斜率变化的作用。</font></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">gradient_descent</span><span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span>  k<span class=\"token punctuation\">,</span>  learning_rate<span class=\"token punctuation\">,</span>  n_iterables<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    m <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># 迭代</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n_iterables<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 初始化b、k的偏导</span>\n        b_grad <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        k_grad <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n        <span class=\"token comment\"># 遍历m次</span>\n        <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 对b,k求偏导</span>\n            b_grad <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> m<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>k <span class=\"token operator\">*</span> x_data<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> y_data<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            k_grad <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">/</span> m<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>k <span class=\"token operator\">*</span> x_data<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> y_data<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> x_data<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span>\n\n        <span class=\"token comment\"># 更新 b 和 k  减去偏导乘以学习率</span>\n        b <span class=\"token operator\">=</span> b <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>learning_rate <span class=\"token operator\">*</span> b_grad<span class=\"token punctuation\">)</span>\n        k <span class=\"token operator\">=</span> k <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>learning_rate <span class=\"token operator\">*</span> k_grad<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># 每迭代 5 次  输出一次图形</span>\n        <span class=\"token keyword\">if</span> i <span class=\"token operator\">%</span> <span class=\"token number\">5</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"当前第</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>i<span class=\"token punctuation\">}</span></span><span class=\"token string\">次迭代\"</span></span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"b_gard：\"</span><span class=\"token punctuation\">,</span> b_grad<span class=\"token punctuation\">,</span> <span class=\"token string\">\"k_gard：\"</span><span class=\"token punctuation\">,</span> k_grad<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"b：\"</span><span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> <span class=\"token string\">\"k：\"</span><span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">)</span>\n            plt<span class=\"token punctuation\">.</span>scatter<span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"maroon\"</span><span class=\"token punctuation\">,</span> marker<span class=\"token operator\">=</span><span class=\"token string\">\"x\"</span><span class=\"token punctuation\">)</span>\n            plt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">,</span> k <span class=\"token operator\">*</span> x_data <span class=\"token operator\">+</span> b<span class=\"token punctuation\">)</span>\n            plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> b<span class=\"token punctuation\">,</span> k\n</code></pre>\n<h1><a id=\"_87\"></a>⑤执行</h1>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"开始：截距b=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>b<span class=\"token punctuation\">}</span></span><span class=\"token string\">,斜率k=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>k<span class=\"token punctuation\">}</span></span><span class=\"token string\">，损失=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>compute_mse<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span>k<span class=\"token punctuation\">,</span>x_data<span class=\"token punctuation\">,</span>y_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始迭代\"</span><span class=\"token punctuation\">)</span>\nb<span class=\"token punctuation\">,</span> k <span class=\"token operator\">=</span> gradient_descent<span class=\"token punctuation\">(</span>x_data<span class=\"token punctuation\">,</span> y_data<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">,</span> learning_rate<span class=\"token punctuation\">,</span> n_iterables<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"迭代</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>n_iterables<span class=\"token punctuation\">}</span></span><span class=\"token string\">次后：截距b=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>b<span class=\"token punctuation\">}</span></span><span class=\"token string\">,斜率k=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>k<span class=\"token punctuation\">}</span></span><span class=\"token string\">，损失=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>compute_mse<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span>k<span class=\"token punctuation\">,</span>x_data<span class=\"token punctuation\">,</span>y_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><font size=\"4\">代码执行过程产生了一系列的图像，部分图像如下图所示，随着迭代次数的增加，代价函数越来越小，最终达到预期效果，如下图所示：</font></p>\n<p><font color=\"brown\" size=\"4\">第5次迭代：<br/>        <img alt=\"在这里插入图片描述\" src=\"image\\f957c06c1062441b9ea23f4990f86ed3.png\"/></font></p>\n<hr/>\n<p><font color=\"brown\" size=\"4\">第10次迭代：<br/>        <img alt=\"在这里插入图片描述\" src=\"image\\1cf785734abb47e19bbd054a4eb45d48.png\"/></font></p>\n<hr/>\n<p><font color=\"brown\" size=\"4\">第50次迭代：<br/>        <img alt=\"在这里插入图片描述\" src=\"image\\51c43360e9554a14a84b5a891ce1f9d8.png\"/></font></p>\n<hr/>\n<p><font color=\"brown\" size=\"4\">执行过程的输出结果如下图所示：<br/>  <img alt=\"在这里插入图片描述\" src=\"image\\8da7d5f42a0c4054b987fcfe984cebc8.png\"/><br/> 可以看到，随着偏导数越来越小，斜率与截距的变化也越来越细微。</font></p>\n<hr/>\n<p><font size=\"4\">感谢您对博主的支持！</font></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}