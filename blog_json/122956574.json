{"blogid": "122956574", "writerAge": "码龄1年", "writerBlogNum": "111", "writerCollect": "267", "writerComment": "7", "writerFan": "700", "writerGrade": "4级", "writerIntegral": "1347", "writerName": ".海上月", "writerProfileAdress": "writer_image\\profile_122956574.jpg", "writerRankTotal": "17416", "writerRankWeekly": "43413", "writerThumb": "212", "writerVisitNum": "69434", "blog_read_count": "1096", "blog_time": "已于 2022-05-13 09:29:17 修改", "blog_title": "微信小程序 授权登录+手机发送验证码+jwt验证接口（laravel8+php）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>参考博客 <a href=\"https://www.cnblogs.com/xiaoyantongxue/p/15677256.html\" title=\"小程序授权登录并 laravel7(laravel8)  token 应用  - 王越666 - 博客园\">小程序授权登录并 laravel7(laravel8) token 应用 - 王越666 - 博客园</a></p>\n<p> </p>\n<p></p>\n<p>                 <a href=\"https://www.jianshu.com/p/7179c325d4a5\" title=\"微信小程序sku商品规格选择器 - 简书\">微信小程序sku商品规格选择器 - 简书</a>  </p>\n<p><a href=\"https://blog.csdn.net/guanj0623/article/details/122029899\" title=\"                微信小程序 和 laravel8 实现搜索后分页 加载_guanj0623的博客-CSDN博客\">                微信小程序 和 laravel8 实现搜索后分页 加载_guanj0623的博客-CSDN博客</a></p>\n<p>                <a href=\"https://www.jb51.net/article/207552.htm\" title=\"https://www.jb51.net/article/207552.htm\">https://www.jb51.net/article/207552.htm</a></p>\n<p>.wxml(授权登录页面)</p>\n<pre><code>&lt;!--前台页面，通过判断决定展示登录还是信息--&gt;\n&lt;view wx:if=\"{<!-- -->{isHide}}\"&gt;\n    &lt;view wx:if=\"{<!-- -->{canIUse}}\" &gt;\n        &lt;view class='header'&gt;\n            &lt;image src='/images/x.jpg'&gt;&lt;/image&gt;\n        &lt;/view&gt;\n \n        &lt;view class='content'&gt;\n            &lt;view&gt;申请获取以下权限&lt;/view&gt;\n            &lt;text&gt;获得你的公开信息(昵称，头像等)&lt;/text&gt;\n        &lt;/view&gt;\n \n        &lt;button type=\"primary\"  open-type=\"getUserInfo\" bind:tap=\"login\"&gt;授权登录&lt;/button&gt;\n    &lt;/view&gt;\n    &lt;view wx:else&gt;请升级微信版本&lt;/view&gt;\n&lt;/view&gt;\n \n&lt;view wx:else&gt;\n    &lt;view&gt;我的首页内容&lt;/view&gt;\n&lt;/view&gt;\n</code></pre>\n<p> .wxss(授权登录页面)</p>\n<pre><code>.header {\n  margin: 90rpx 0 90rpx 50rpx;\n  border-bottom: 1px solid #ccc;\n  text-align: center;\n  width: 650rpx;\n  height: 300rpx;\n  line-height: 450rpx;\n}\n\n.header image {\n  width: 200rpx;\n  height: 200rpx;\n}\n\n.content {\n  margin-left: 50rpx;\n  margin-bottom: 90rpx;\n}\n\n.content text {\n  display: block;\n  color: #9d9d9d;\n  margin-top: 40rpx;\n}\n\n.bottom {\n  border-radius: 80rpx;\n  margin: 70rpx 50rpx;\n  font-size: 35rpx;\n}\n</code></pre>\n<p>.js(授权登录)</p>\n<pre><code>// index.js\n// 获取应用实例\nconst app = getApp()\n \nPage({\n  data: {\n    canIUse: wx.canIUse('button.open-type.getUserInfo'),\n    // 前台判断用的就是这个\n    isHide: true\n  },\n \n  // 微信授权\n  login(evt){\n    var that=this;\n    //    wx.getUserProfile获取用户信息\n    wx.getUserProfile({\n      // desc    声明获取用户个人信息后的用途，不超过30个字符\n      desc: 'desc',\n      success:res=&gt;{\n        if (res.userInfo) {\n          /*  wx.login 调用接口获取登录凭证（code）。通过凭证进而换取用户登录态信息，包括用户在当前小程序的唯一标识（openid）、微信开放平台帐号下的唯一标识（unionid，若当前小程序已绑定到微信开放平台帐号）及本次登录的会话密钥（session_key）*/\n          wx.login({\n            success:ret=&gt;{\n              \n              // 获取code\n              var code=ret.code;\n              \n              // 获取用户昵称\n              var nickName=res.userInfo.nickName;\n              // 获取用户照片\n              var log=res.userInfo.avatarUrl;\n              // 发送至php后端\n              wx.request({\n                url: 'http://www.yk.com/api/v1/wxlogin', //仅为示例，并非真实的接口地址\n                data: {\n                  code:code,\n                  nickName:nickName,\n                  log:log\n                },\n                method:\"POST\",\n                header: {\n                  'content-type': 'application/json' // 默认值\n                },\n                // 数据返回json格式\n                    success (res) {\n                   \n                        // 获取返回来的token，并将token进行保存至本地缓冲中\n                     wx.setStorageSync('token', res.data.data.token)\n                    // // 将用户id储存于本地\n                    wx.setStorageSync('userid', res.data.data.id);\n                    wx.reLaunch({\n                      url: '/pages/mine/mine',\n                    })\n                    }\n              })\n            }\n          })\n        }else{\n          console.log('用户拒绝啦');\n        }\n      }\n    })\n  }\n})\n</code></pre>\n<p> 控制器</p>\n<pre><code>&lt;?php\n\nnamespace App\\Http\\Controllers\\Api;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\User;\nuse App\\Service\\JwtServer;\nuse App\\Service\\Token;\nuse Illuminate\\Http\\Request;\n\n\nclass LoginController extends Controller\n{\n    public function loginInfo(Request $request)\n    {\n        //接收前台传来的值\n        $params = $request-&gt;post();\n        $code=$request-&gt;post('code');\n        //获取appid\n        $appID = \"wx1378003a2bdb6c0c\";\n        // 从微信公众平台获得secret\n        $appSecret = \"37e8b20e2f4bb7e85707c92cc1f4f0e4\";\n\n         // 发送请求换取openid和sessionkey\n        $url=\"https://api.weixin.qq.com/sns/jscode2session?appid=\".$appID.\"&amp;secret=\".$appSecret.\"&amp;js_code=\".$code.\"&amp;grant_type=authorization_code\";\n        // 暂使用file_get_contents()发送请求，你可以使用CURL扩展的形式实现,获取opid和session_key\n\n        $res = json_decode(file_get_contents($url), true);\n\n\n       //调用成功后定义一个新的数组，最主要的session_key和openid两个值\n        $params['openid'] = $res['openid'];\n\n        //  给$params追加session_key\n        $params['session_key'] = $res['session_key'];\n\n       //查看数据库里是否有openid,有就修改，没有就添加\n        $res = User::where('openid', $params['openid'])-&gt;first();\n\n        //用查找到的用户信息的id生成token\n            $token=JwtServer::createToken($res['id']);\n        //将token发送至小程序，小程序进行缓冲token和用户id\n        $res['token']=$token;\n\n       //有就修改用户的额openID\n        if ($res) {\n            User::where('openid', $params['openid'])-&gt;update($params);\n            return ['code' =&gt; 201, 'meg' =&gt; '修改成功', 'data' =&gt; $res];\n        } else {\n         //没有就添加新用户\n            $add =User::create($params);\n            return ['code' =&gt; 200, 'meg' =&gt; '添加成功', 'data' =&gt; $res];\n        }\n\n    }\n}\n</code></pre>\n<p>App\\Service新建Curl.php文件</p>\n<pre><code>&lt;?php\n\n\nnamespace App\\Service;\n\n\nclass Curl\n{\n    public static function getCurl($url)\n    {\n        $headerArray =array(\"Content-type:application/json;\",\"Accept:application/json\");\n        $ch = curl_init();\n        curl_setopt($ch, CURLOPT_URL, $url);\n        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);\n        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);\n        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n        curl_setopt($ch,CURLOPT_HTTPHEADER,$headerArray);\n        $output = curl_exec($ch);\n        curl_close($ch);\n        $output = json_decode($output,true);\n        return $output;\n    }\n\n}\n</code></pre>\n<p> composer 下载jwt</p>\n<pre><code>composer require firebase/php-jwt</code></pre>\n<p> service下建一个JwtServer.php，加人以下代码</p>\n<p><img alt=\"\" height=\"243\" src=\"image\\477a34acf76d432c80a136a13d597d61.png\" width=\"220\"/></p>\n<p> App\\Http\\Middleware 下新建JwtToken.php 文件,toekn中间件</p>\n<pre><code>&lt;?php\nnamespace App\\Http\\Middleware;\nuse App\\Service\\JwtServer;\nuse Closure;\nuse Illuminate\\Http\\Request;\n\nclass JwtToken\n{\n    /**\n     * Handle an incoming request.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\Closure  $next\n     * @return mixed\n     */\n    public function handle(Request $request, Closure $next)\n    {\n        $token = $request-&gt;header('token');\n\n        if(empty($token)){\n            return response()-&gt;json(['code'=&gt;40001,'msg'=&gt;'请先登录','data'=&gt;$token]);\n        }\n        $userId=JwtServer::decodeToken($token);\n        if(!is_numeric($userId)){\n            return response()-&gt;json(['code'=&gt;40002,'msg'=&gt;'token过期','data'=&gt;$userId]);\n        }\n        $request['id'] = $userId;\n        return $next($request);\n\n    }\n}\n</code></pre>\n<p> 中间件kernel.php文件下</p>\n<pre><code>    protected $routeMiddleware = [\n        'auth' =&gt; \\App\\Http\\Middleware\\Authenticate::class,\n        'auth.basic' =&gt; \\Illuminate\\Auth\\Middleware\\AuthenticateWithBasicAuth::class,\n        'cache.headers' =&gt; \\Illuminate\\Http\\Middleware\\SetCacheHeaders::class,\n        'can' =&gt; \\Illuminate\\Auth\\Middleware\\Authorize::class,\n        'guest' =&gt; \\App\\Http\\Middleware\\RedirectIfAuthenticated::class,\n        'password.confirm' =&gt; \\Illuminate\\Auth\\Middleware\\RequirePassword::class,\n        'signed' =&gt; \\Illuminate\\Routing\\Middleware\\ValidateSignature::class,\n        'throttle' =&gt; \\Illuminate\\Routing\\Middleware\\ThrottleRequests::class,\n        'verified' =&gt; \\Illuminate\\Auth\\Middleware\\EnsureEmailIsVerified::class,\n//        中间件\n        'jwt'=&gt;JwtToken::class\n    ];</code></pre>\n<p> 定义api路由，注意api路由书写格式，默认api前缀</p>\n<pre><code>Route::group(['prefix'=&gt;'v1','namespace'=&gt;'Api'],function (){\n//小程序登录\n    Route::any('wxlogin','LoginController@loginInfo');\n});\n\n\nRoute::group(['middleware'=&gt;'jwt','prefix'=&gt;'v2','namespace'=&gt;'Api'],function (){\n    //获取手机验证码\n    Route::get('phone','PhoneController@PhoneCode');\n    //绑定手机\n    Route::get('bound','PhoneController@bound');\n//    查询商品列表\n    Route::get('goods','IndexController@index');\n//    获取商品详情\n    Route::get('detail','IndexController@detail');\n//    获取商品规格属性值\n    Route::get('specs','IndexController@specs');\n    //添加订单\n    Route::post('orders','IndexController@orders');\n    //获取订单详情\n    Route::get('order','IndexController@order');\n    //支付接口\n    Route::post('pay','IndexController@pay');\n});\n</code></pre>\n<p>手机发送验证码 </p>\n<p> .wxss(手机发送验证码)</p>\n<pre><code>&lt;!--pages/logins/logins.wxml--&gt;\n&lt;view class=\"container\"&gt;\n  &lt;view class=\"title\"&gt;绑定手机号&lt;/view&gt;\n  &lt;form catchsubmit=\"login\"&gt;\n    &lt;view class=\"inputView\"&gt;\n      &lt;input class=\"inputText\" placeholder=\"请输入手机号\" name=\"phone\" bindinput=\"phone\" /&gt;\n    &lt;/view&gt;\n    &lt;view class=\"inputView\"&gt;\n      &lt;input class=\"inputText\" placeholder=\"请输入验证码\" name=\"code\" /&gt;\n      &lt;button class=\"line\"  size=\"mini\" bindtap=\"sendcode\"&gt;{<!-- -->{codebtn}}&lt;/button&gt;\n    &lt;/view&gt;\n    &lt;view class=\"loginBtnView\"&gt;\n      &lt;button class=\"loginBtn\" type=\"primary\" formType=\"submit\"&gt;绑定&lt;/button&gt;\n    &lt;/view&gt;\n  &lt;/form&gt;\n&lt;/view&gt;\n</code></pre>\n<p> .wxss</p>\n<pre><code>.container { \n  display: flex;  \n  flex-direction: column; \n  padding: 0; \n } \n .inputView { \n  line-height: 45px; \n  border-bottom:1px solid #999999;\n } \n.title{\n  width: 80%;\n  font-weight: bold;\n  font-size: 30px;\n}\n .inputText { \n  display: inline-block; \n  line-height: 45px; \n  padding-left: 10px; \n  margin-top: 11px;\n  color: #cccccc; \n  font-size: 14px;\n } \n \n .line {\n  border: 1px solid #ccc;\n  border-radius: 20px; \n  float: right; \n  margin-top: 9px;\n  color: #cccccc;\n } \n .loginBtn { \n  margin-top: 40px; \n  border-radius:10px;\n }\n \n</code></pre>\n<p>.js</p>\n<pre><code>// pages/logins/logins.js\nPage({\n \n  /**\n   * 页面的初始数据\n   */\n  data: {\n    phone:'',\n    code: '',\n    codebtn:'发送验证码',\n    disabled:false,\n \n  },\n\n  // 获取输入账号 \n  phone: function (e) {\n    let phone = e.detail.value;\n    this.setData({\n      phone: e.detail.value\n    })\n  },\n  //发送验证码\n  sendcode:function(){\n    let that=this;\n    let phone =this.data.phone;\n    let token=wx.getStorageSync('token');\n    // console.log(token)\n    wx.request({\n      url: 'http://www.yk.com/api/v2/phone', //仅为示例，并非真实的接口地址\n      data: {phone},\n      header: {token},\n      method:\"GET\",\n      success (res) {\n        console.log(res.data)\n        that.setData({\n          code:res.data\n        })\n      }\n    })\n  },\n \n  // 绑定处理\n  login: function (evt) {\n    // console.log(evt);\n    var that = this;\n    // console.log(this.data.code)\n    var userid=wx.getStorageSync('userid')\n    var token=wx.getStorageSync('token');\n \n      wx.request({\n        url: 'http://www.yk.com/api/v2/bound', // 仅为示例，并非真实的接口地址\n        method: 'get',\n        data: {\n          phone: that.data.phone,\n         code:that.data.code,\n          userid:userid\n        },\n        header: {\n         token\n        },\n        success(res) {\n          if (res.data.code == \"10000\") {\n            wx.reLaunch({\n              url: '/pages/home/home',\n            })\n          } else {\n            wx.showToast({\n              title: res.data.msg,\n              icon: 'none',\n              duration: 2000\n            })\n          }\n        }\n      })\n    }\n    \n  \n})\n</code></pre>\n<p>控制器</p>\n<pre><code>&lt;?php\n\nnamespace App\\Http\\Controllers\\Api;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\User;\n\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\Cache;\n\nclass PhoneController extends Controller\n{\n    /**\n     * 获取验证码方法\n     *  Request $request参数\n     * $getphone 手机号 $code 验证码\n     */\n    public function PhoneCode(Request $request){\n//       接收手机号码\n        $getPhone=$request-&gt;get('phone');\n\n//       生成一个随机四位的随机数\n        $code=mt_rand(1111,9999);\n\n        if(empty($getPhone) || empty($code)){\n            return ['code'=&gt;0,'data'=&gt;'','msg'=&gt;'参数不能为空'];\n        }\n\n        Cache::set($getPhone,$code,5000);\n//\n//        $statusStr = array(\n//            \"0\" =&gt; \"短信发送成功\",\n//            \"-1\" =&gt; \"参数不全\",\n//            \"-2\" =&gt; \"服务器空间不支持,请确认支持curl或者fsocket，联系您的空间商解决或者更换空间！\",\n//            \"30\" =&gt; \"密码错误\",\n//            \"40\" =&gt; \"账号不存在\",\n//            \"41\" =&gt; \"余额不足\",\n//            \"42\" =&gt; \"帐户已过期\",\n//            \"43\" =&gt; \"IP地址限制\",\n//            \"50\" =&gt; \"内容含有敏感词\"\n//        );\n//        $smsapi = \"http://api.smsbao.com/\";\n//        $user = \"tannanping\"; //短信平台帐号\n//        $pass = md5(\"\"); //短信平台密码\n//        $content=\"短信内容\".$code;//要发送的短信内容\n//        $phone = $getPhone;//要发送短信的手机号码\n//        $sendurl = $smsapi.\"sms?u=\".$user.\"&amp;p=\".$pass.\"&amp;m=\".$phone.\"&amp;c=\".urlencode($content);\n//        $result =file_get_contents($sendurl) ;\n//       echo $statusStr[$result];\n        return $code;\n    }\n\n    /**\n     * 登录方法\n     * 参数 Request $request\n     */\n\n    public function bound(Request $request){\n        $phone=$request-&gt;get('phone');\n        $code=$request-&gt;get('code');\n\n//       取出缓存内的验证码\n        $oldCode=Cache::get($phone);\n        if($code!=$oldCode){\n            return ['code'=&gt;10001,'data'=&gt;'','msg'=&gt;'验证码不正确'];\n        }else{\n            $model=new User();\n            $res=$model-&gt;where('phone',$phone)-&gt;first();\n            if(empty($res)){\n                return ['code'=&gt;10002,'data'=&gt;'','msg'=&gt;'账号不存在'];\n            }else{\n                return ['code'=&gt;10000,'data'=&gt;$res,'msg'=&gt;'绑定成功'];\n            }\n        }\n\n    }\n\n}\n</code></pre>\n<p>app.js(先验证是否登录 判断token是否存在)</p>\n<pre><code>//app.js\nApp({\n  onLaunch: function () {\n    // 展示本地存储能力\n    var logs = wx.getStorageSync('logs') || []\n    logs.unshift(Date.now())\n    wx.setStorageSync('logs', logs)\n    var token=wx.getStorageSync('token');\n\n    if(token!=\"\"){\n      wx.reLaunch({\n        url: '/pages/mine/mine',\n      })\n    }else{\n      wx.reLaunch({\n        url: '/pages/index/index',\n      })\n    }\n\n\n\n    // 登录\n    wx.login({\n      success: res =&gt; {\n        // 发送 res.code 到后台换取 openId, sessionKey, unionId\n      }\n    })\n    // 获取用户信息\n    wx.getSetting({\n      success: res =&gt; {\n        if (res.authSetting['scope.userInfo']) {\n          // 已经授权，可以直接调用 getUserInfo 获取头像昵称，不会弹框\n          wx.getUserInfo({\n            success: res =&gt; {\n              // 可以将 res 发送给后台解码出 unionId\n              this.globalData.userInfo = res.userInfo\n\n              // 由于 getUserInfo 是网络请求，可能会在 Page.onLoad 之后才返回\n              // 所以此处加入 callback 以防止这种情况\n              if (this.userInfoReadyCallback) {\n                this.userInfoReadyCallback(res)\n              }\n            }\n          })\n        }\n      }\n    })\n  },\n  globalData: {\n    userInfo: null\n  }\n})</code></pre>\n<p> 控制器商品购物流程</p>\n<pre><code>&lt;?php\n\nnamespace App\\Http\\Controllers\\Api;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\Goods;\nuse App\\Models\\Goodspecs;\nuse App\\Models\\Orders;\nuse App\\Models\\User;\nuse Illuminate\\Http\\Request;\n\nclass IndexController extends Controller\n{\n    //展示商品列表数据\n    public function index(Request $request){\n//        $keyword = $request-&gt;input('keyword');\n        $data = Goods::paginate(5);\n        return ['status'=&gt;200,'msg'=&gt;'success','data'=&gt;$data];\n    }\n\n    public function detail(Request $request){\n        $id=$request-&gt;get('id');\n        $model=new Goods();\n        $res=$model-&gt;where('gid',$id)-&gt;first();\n        return ['status'=&gt;200,'msg'=&gt;'success','data'=&gt;$res];\n    }\n\n    public function specs(Request $request){\n        $id=$request-&gt;get('id');\n        $model=new Goods();\n        $res=$model-&gt;where('gid',$id)-&gt;with(['specs','goodspecs'])-&gt;get();\n        return ['status'=&gt;200,'msg'=&gt;'success','data'=&gt;$res];\n    }\n\n\n    //添加订单\n    public function orders(Request $request){\n       $param=$request-&gt;post();\n       //商品id\n       $id=$request-&gt;post('g_id');\n       //查询该商品的库存\n        $good=new Goodspecs();\n        $ku=$good-&gt;where('g_id',$id)-&gt;first();\n        $number=$ku['num'];\n//       判断商品库存是否足够\n        if($number&lt;$param['num']){\n            return ['status'=&gt;0,'msg'=&gt;'商品库存不够','data'=&gt;$number];\n        }\n\n        $model=new Orders();\n        $res=$model-&gt;create($param);\n        if(!$res){\n            return ['status'=&gt;0,'msg'=&gt;'error','data'=&gt;$res];\n        }else{\n            return ['status'=&gt;200,'msg'=&gt;'success','data'=&gt;$res];\n        }\n    }\n    //获取订单详情\n    public function order(Request $request){\n        $oid=$request-&gt;get('oid');\n        $model=new Orders();\n        $res=$model-&gt;where('oid',$oid)-&gt;with(['user','goods'])-&gt;get();\n        return ['status'=&gt;200,'msg'=&gt;'success','data'=&gt;$res];\n    }\n//    执行支付\n    public function pay(Request $request){\n        $oid=$request-&gt;post('oid');\n        $uid=$request-&gt;post('uid');\n\n        $model=new Orders();\n        $oldprice=$model-&gt;where('oid',$oid)-&gt;first();\n        $user=new User();\n        $zh=$user-&gt;where('id',$uid)-&gt;first();\n        if($zh['price']&lt;$oldprice['price']){\n            return ['status'=&gt;0,'msg'=&gt;'余额不足','data'=&gt;$zh];\n        }else{\n//            商品属性表\n            $goods=new Goodspecs();\n//            获取原来库存\n            $kc=$goods-&gt;where('g_id',$oldprice['g_id'])-&gt;first();\n            //当前库存=原来库存-购买数量\n            $newnumber=$kc['num']-$oldprice['num'];\n            //支付成功 修改库存\n            $res=$goods-&gt;where('g_id',$oldprice['g_id'])-&gt;update(['num'=&gt;$newnumber]);\n\n        }\n\n    }\n\n}\n</code></pre>\n<p>商品列表 </p>\n<p> .wxml(商品列表)</p>\n<pre><code>&lt;view&gt;\n  &lt;view&gt;\n     &lt;view&gt;\n      &lt;form bindsubmit=\"dopost\"&gt;\n        &lt;view class=\"weui-search-bar\"&gt;\n            &lt;view class=\"weui-search-bar__form\"&gt;\n            &lt;!-- 搜索框 --&gt;\n                &lt;view class=\"weui-search-bar__box\"&gt;\n                    &lt;icon class=\"weui-icon-search_in-box\" type=\"search\" size=\"14\"&gt;&lt;/icon&gt;\n                    &lt;input type=\"text\" name=\"keyword\" value=\"{<!-- -->{keyword}}\" class=\"weui-search-bar__input\" placeholder=\"请输入搜索内容\" /&gt;\n                &lt;/view&gt;\n            &lt;/view&gt;\n            &lt;!-- 搜索按钮,调用搜索查询方法 --&gt;\n            &lt;button size=\"mini\" class=\"weui-search-bar__cancel-btn\" form-type=\"submit\"&gt;搜索&lt;/button&gt;\n        &lt;/view&gt;\n        &lt;/form&gt;\n    &lt;/view&gt;\n  &lt;/view&gt;\n  &lt;view class=\"page-section-spacing\"&gt;\n        &lt;scroll-view scroll-y=\"true\" class=\"page-scroll-style\" bindscrolltolower=\"scroll\"&gt;\n        &lt;block wx:for=\"{<!-- -->{activity}}\" wx:key=\"activity\"&gt;\n          &lt;view class=\"scroll-view-content\"&gt;\n            &lt;image src=\"{<!-- -->{item.image}}\" class=\"scroll-view-image\" bindtap=\"\"&gt;&lt;/image&gt;\n            &lt;view class=\"scroll-view-text\" bindtap=\"detail\" data-id=\"{<!-- -->{item.gid}}\"&gt;\n              {<!-- -->{item.name}}\n            &lt;/view&gt;\n            &lt;view class=\"scroll-view-name\"&gt;\n              {<!-- -->{item.price}}\n            &lt;/view&gt;\n          &lt;/view&gt;\n        &lt;/block&gt;\n        &lt;/scroll-view&gt;\n  &lt;/view&gt;\n&lt;/view&gt;\n</code></pre>\n<p>.wxss</p>\n<pre><code>/**index.wxss**/\n.weui-search-bar {\n    position: relative;\n    padding: 8px 10px;\n    display: -webkit-box;\n    display: -webkit-flex;\n    display: flex;\n    box-sizing: border-box;\n    background-color: #EFEFF4;\n    border-top: 1rpx solid #D7D6DC;\n    border-bottom: 1rpx solid #D7D6DC;\n  }\n  .weui-icon-search_in-box {\n    position: absolute;\n    left: 10px;\n    top: 7px;\n  }\n  .weui-search-bar__form {\n    position: relative;\n    -webkit-box-flex: 1;\n    -webkit-flex: auto;\n            flex: auto;\n    border-radius: 5px;\n    background: #FFFFFF;\n    border: 1rpx solid #E6E6EA;\n  }\n  .weui-search-bar__box {\n    position: relative;\n    padding-left: 30px;\n    padding-right: 30px;\n    width: 100%;\n    box-sizing: border-box;\n    z-index: 1;\n  }\n  .weui-search-bar__input {\n    height: 28px;\n    line-height: 28px;\n    font-size: 14px;\n  }\n  .weui-search-bar__cancel-btn {\n    margin-left: 10px;\n    line-height: 28px;\n    color: #09BB07;\n    white-space: nowrap;\n  }\n  .swp{\n    height: 500rpx;\n  }\n  .page-section-spacing{\n    margin-top: 60rpx;\n  }\n   \n  .page-scroll-style{\n    height: 1000rpx;\n    background: aliceblue;\n  }\n  .scroll-view-content{\n    height: 230rpx;\n    margin: auto 10rpx;\n    background: white;\n    border: 1px solid gray;\n  }\n  .scroll-view-image{\n    width: 200rpx;\n    height: 200rpx;\n    margin-top: 15rpx;\n    margin-left: 20rpx;\n    float: left;\n  }\n  .scroll-view-text{\n    width: 400rpx;\n    float: left;\n    font-weight: 800;\n    margin-top: 15rpx;\n    margin-left: 20rpx;\n  }\n  .scroll-view-name{\n    float: left;\n    font-size: 30rpx;\n    color: gray;\n    margin-top: 20rpx;\n    margin-left: 20rpx;\n  }\n  .scroll-view_H{\n    white-space: nowrap;\n  }\n  .scroll-view-item{\n    height: 300rpx;\n  }\n  .scroll-view-item_H{\n    display: inline-block;\n    width: 100%;\n    height: 300rpx;\n  }\n  </code></pre>\n<p> .js</p>\n<pre><code>Page({\n \n    /**\n     * 页面的初始数据\n     */\n    data: {\n      activity:{},\n      page:1,\n      last_page : 0,\n      keyword:''\n    },\n   \n    detail:function(evn){\n   \n      let id=evn.target.dataset.id;\n      wx.reLaunch({\n        url: '/pages/detail/detail?id='+id,\n      })\n    },\n  //加载\n  scroll(e){\n    let that = this;\n    let page = that.data.page+1;\n    let keyword = that.data.keyword\n    that.setData({\n      page:page \n    })\n    let last_page = that.data.last_page\n    if(page &gt; last_page){\n      wx.showToast({\n        title: '到底了',\n      })\n      return ;\n    }\n    wx.showLoading({\n        title: '加载中',\n    })\n    let token=wx.getStorageSync('token');\n    wx.request({\n      url: 'http://www.yk.com/api/v2/goods',\n      data:{page,keyword},\n      header: {\n       token\n      },\n      success (res) {\n        console.log(res.data)\n        let activity = res.data.data.data\n        that.setData({\n          activity:that.data.activity.concat(activity),\n        })\n        wx.hideLoading()\n      }\n    })\n  },\n    /**\n     * 生命周期函数--监听页面加载\n     */\n    onLoad: function (options) {\n      var that = this;\n      let token=wx.getStorageSync('token');\n      wx.request({\n        url: 'http://www.yk.com/api/v2/goods',\n        header: {\n            token\n        },\n        success (res) {\n          // console.log(res.data)\n          let activity = res.data.data.data\n          that.setData({\n            activity:activity,\n            last_page:res.data.data.last_page,\n            page:res.data.data.current_page\n          })\n        }\n      })\n    },\n \n  //搜索\n    dopost:function(e){\n      console.log(e);\n      let formData = e.detail.value;\n      wx.request({\n        url: 'http://www.week2.skill.com/api/activity/index',\n        data:formData,\n        method:\"GET\",\n        success:res=&gt;{\n          console.log(res);\n          if(res.data.status==200){\n            this.setData({\n              activity:res.data.data.data,\n              keyword:formData.keyword,\n              last_page:res.data.data.last_page,\n              page:res.data.data.current_page\n            })\n          }\n        },\n        fail(e){\n          wx.showToast({\n            title: '请求失败',\n            icon:\"error\"\n          })\n        }\n      })\n    },\n  })\n  </code></pre>\n<p>商品详情</p>\n<p>.wxml</p>\n<p></p>\n<pre><code>&lt;!-- banner --&gt;\n&lt;swiper indicator-dots=\"{<!-- -->{indicatorDots}}\" autoplay=\"{<!-- -->{autoplay}}\" interval=\"{<!-- -->{interval}}\" duration=\"{<!-- -->{duration}}\"&gt;\n  &lt;block&gt;\n    &lt;swiper-item&gt;\n      &lt;image src=\"{<!-- -->{activity.image}}\" data-src=\"{<!-- -->{item}}\" bindtap=\"previewImage\"&gt;&lt;/image&gt;\n    &lt;/swiper-item&gt;\n  &lt;/block&gt;\n&lt;/swiper&gt;\n&lt;scroll-view scroll-y=\"true\"&gt;\n  &lt;view class=\"detail\"&gt;\n    &lt;text class=\"title\"&gt;{<!-- -->{activity.name}}&lt;/text&gt;\n    &lt;text class=\"price\"&gt;￥{<!-- -->{activity.price}}&lt;/text&gt;\n\n  &lt;/view&gt;\n  &lt;view class=\"separate\"&gt;&lt;/view&gt;\n  &lt;!-- sku选择 --&gt;\n  &lt;text bindtap=\"toggleDialog\"&gt;请选择购买数量&lt;/text&gt;\n  &lt;view class=\"separate\"&gt;&lt;/view&gt;\n  &lt;text&gt;商品评价&lt;/text&gt;\n  &lt;text class=\"text-remark\"&gt;东西还可以，好评~&lt;/text&gt;\n  &lt;view class=\"separate\"&gt;&lt;/view&gt;\n  &lt;text&gt;商品详情&lt;/text&gt;\n  &lt;block wx:for-items=\"{<!-- -->{detailImg}}\" wx:key=\"name\"&gt;\n    &lt;image class=\"image_detail\" src=\"{<!-- -->{item}}\" /&gt;\n  &lt;/block&gt;\n  &lt;view class=\"temp\"&gt;&lt;/view&gt;\n&lt;/scroll-view&gt;\n&lt;!-- 底部悬浮栏\n&lt;view class=\"detail-nav\"&gt;\n  &lt;image bindtap=\"toCar\"/&gt;\n  &lt;view class=\"line_nav\"&gt;&lt;/view&gt;\n  &lt;image bindtap=\"addLike\"/&gt;\n  &lt;button class=\"button-green\" bindtap=\"addCar\" formType=\"submit\"&gt;加入购物车&lt;/button&gt;\n  &lt;button class=\"button-red\" bindtap=\"immeBuy\" formType=\"submit\"&gt;立即购买&lt;/button&gt;\n&lt;/view&gt; --&gt;\n\n\n&lt;!--pages/demo/demo.wxml--&gt;\n&lt;view class=\"container\"&gt;\n  &lt;view class=\"footer-box\" hover-class=\"btn-hover\" bindtap=\"buy\" data-id=\"{<!-- -->{activity.gid}}\"&gt;\n    立即购买\n  &lt;/view&gt;\n\n\n\n  &lt;view class=\"mark\" hidden='{<!-- -->{selHidden}}' bindtap='hiddenSel'&gt;&lt;/view&gt;\n  &lt;view class=\"detail-box\" animation=\"{<!-- -->{animationDataSel}}\" wx:for=\"{<!-- -->{activ}}\"&gt;\n\n    &lt;view class=\"goods-img-box\"&gt;\n      &lt;image src=\"{<!-- -->{item.image}}\" class=\"goods-img\"&gt;&lt;/image&gt;\n      &lt;view class='right-side'&gt;\n        &lt;view class='price'&gt;¥{<!-- -->{item.price}}&lt;/view&gt;\n        &lt;view class='type'&gt;已选：{<!-- -->{selTypeList}}&lt;/view&gt;\n        &lt;view class='inventory'&gt;库存：{<!-- -->{activ.num}}&lt;/view&gt;\n      &lt;/view&gt;\n      &lt;view class=\"sel-box\"&gt;\n      &lt;view class=\"sel-list\" wx:for=\"{<!-- -->{item.specs}}\"&gt;\n          &lt;text class=\"{<!-- -->{indexArr[childIndex] == index ? 'active':''}}\" bindtap=\"choice\" data-fid=\"{<!-- -->{childIndex}}\" data-id=\"{<!-- -->{index}}\"&gt;\n           {<!-- -->{item.name}}\n         &lt;/text&gt;\n      &lt;/view&gt;\n      &lt;view class=\"sel-list\" wx:for=\"{<!-- -->{item.specs}}\"&gt;\n          &lt;text class=\"{<!-- -->{indexArr[childIndex] == index ? 'active':''}}\" bindtap=\"choice\" data-fid=\"{<!-- -->{childIndex}}\" data-id=\"{<!-- -->{index}}\"&gt;\n           {<!-- -->{item.name}}\n         &lt;/text&gt;\n      &lt;/view&gt;\n    &lt;/view&gt;\n    &lt;/view&gt;\n    &lt;view class=\"number-box\" style=\"margin-top: 200px;\"&gt;\n      &lt;view class=\"control {<!-- -->{plusBan}}\" bindtap='plus'&gt;+&lt;/view&gt;\n      &lt;view class=\"control num\"&gt;{<!-- -->{selNum}}&lt;/view&gt;\n      &lt;view class=\"control {<!-- -->{minusBan}}\" bindtap='minus'&gt;-&lt;/view&gt;  \n    &lt;/view&gt;\n    &lt;view class=\"confirm-btn {<!-- -->{btnType}}\"  bindtap='confirm' data-id=\"{<!-- -->{activity.gid}}\" data-price=\"{<!-- -->{activity.price}}\"&gt;确认&lt;/view&gt;\n  &lt;/view&gt;\n&lt;/view&gt;\n</code></pre>\n<p>.wxss</p>\n<pre><code>page {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n  }\n  /* 直接设置swiper属性 */\n  swiper {\n    height: 500rpx;\n  }\n  swiper-item image {\n    width: 100%;\n    height: 100%;\n  }\n  .detail {\n    display: flex;\n    flex-direction: column;\n    margin-top: 15rpx;\n    margin-bottom: 0rpx;\n  }\n  .detail .title {\n    font-size: 40rpx;\n    margin: 10rpx;\n    color: black;\n    text-align: justify;\n  }\n  .detail .price {\n    color: red;\n    font-size: 40rpx;\n    margin: 10rpx;\n  }\n  .line_flag {\n    width: 80rpx;\n    height: 1rpx;\n    display: inline-block;\n    margin: 20rpx auto;\n    background-color: gainsboro;\n    text-align: center;\n  }\n  .line {\n    width: 100%;\n    height: 2rpx;\n    display: inline-block;\n    margin: 20rpx 0rpx;\n    background-color: gainsboro;\n    text-align: center;\n  }\n  .detail-nav {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    float: left;\n    background-color: #fff;\n    position: fixed;\n    bottom: 0;\n    right: 0;\n    z-index: 1;\n    width: 100%;\n    height: 100rpx;\n  }\n  .button-green {\n    background-color: #4caf50; /* Green */\n  }\n  .button-red {\n    background-color: #f44336; /* 红色 */\n  }\n  .image_detail {\n    width: 100%;\n  }\n  button {\n    color: white;\n    text-align: center;\n    text-decoration: none;\n    display: inline-block;\n    font-size: 30rpx;\n    border-radius: 0rpx;\n    width: 50%;\n    height: 100%;\n    line-height: 100rpx;\n  }\n  .detail-nav image {\n    width: 70rpx;\n    height: 50rpx;\n    margin: 20rpx 40rpx;\n  }\n  .line_nav {\n    width: 5rpx;\n    height: 100%;\n    background-color: gainsboro;\n  }\n  /* 占位 */\n  .temp {\n    height: 100rpx;\n  }\n  text {\n    display: block;\n    height: 60rpx;\n    line-height: 60rpx;\n    font-size: 30rpx;\n    margin: 10rpx;\n  }\n  .text-remark {\n    display: block;\n    font-size: 25rpx;\n    margin: 10rpx;\n  }\n\n  \n  \n  /* pages/demo/demo.wxss */\n.container .footer-box{\n  position: fixed;\n  bottom: 0rpx;\n  margin: auto;\n  height: 100rpx;\n  width:100%;\n  background-color: #E40112;\n  text-align: center;\n  line-height: 100rpx;\n  color: #fff;\n  font-size: 32rpx;\n}\n.container .btn-hover{\n  opacity: 0.8;\n}\n.container .mark{\n  position: fixed;\n  z-index: 10;\n  height: 100%;\n  width: 100%;\n  background-color: rgba(0, 0, 0, 0.75)\n}\n.container .detail-box{\n  position: fixed;\n  z-index: 10;\n  bottom: -980rpx;\n  height: 980rpx;\n  width: 100%;\n  background-color: #fff;\n}\n.container .detail-box .goods-img-box{\n  height: 240rpx;\n  box-sizing: border-box;\n  padding: 24rpx;\n  border-bottom: solid 1rpx #e3e3e3;\n}\n.container .detail-box .goods-img-box .goods-img{\n  height: 192rpx;\n  width: 192rpx;\n  float: left;\n}\n.container .detail-box .goods-img-box .right-side{\n  float: left;\n  padding-top: 10rpx;\n}\n.container .detail-box .goods-img-box .right-side .price{\n  font-size: 32rpx;\n  color: #E40112;\n  font-weight: bold;\n}\n.container .detail-box .goods-img-box .right-side .type{\n  font-size: 24rpx;\n  color: #333;\n  margin-top: 8rpx;\n  margin-bottom: 8rpx;\n  overflow : hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;  \n}\n.container .detail-box .goods-img-box .right-side .inventory{\n  font-size: 24rpx;\n  color: #999;\n}\n\n.container .detail-box .sel-box{\n  height: 560rpx;\n  width: 100%;\n  box-sizing: border-box;\n  padding-bottom: 24rpx;\n  overflow-y: auto;\n}\n\n.container .detail-box .sel-box .sel-list .sel-title{\n  font-size: 28rpx;\n  color: #333;\n  line-height: 60rpx;\n  padding-left: 24rpx;\n}\n.container .detail-box .sel-box .sel-list .type-list{\n  padding-left: 24rpx;\n}\n.container .detail-box .sel-box .sel-list .type-list {\n  overflow: hidden;\n} \n.container .detail-box .sel-box .sel-list .type-list .type-item{\n  display: inline-block;\n  \n  height: 50rpx;\n  line-height: 48rpx;\n  border: solid 1rpx #999;\n  padding-left: 15rpx;\n  padding-right: 15rpx;\n  font-size: 24rpx;\n  color: #666;\n  border-radius: 5rpx;\n  margin-right: 24rpx;\n  margin-bottom: 24rpx;\n}\n.container .detail-box .sel-box .sel-list .type-list .sel{\n  border: solid 1rpx #f63636;\n  color: #f63636;\n}\n.container .detail-box .sel-box .sel-list .type-list .ban{\n  background-color: #f5f5f5;\n  border: solid 1rpx #f5f5f5;  \n}\n.container .detail-box .confirm-btn{\n  height: 100rpx;\n  background-color: #E40112;\n  text-align: center;\n  line-height: 100rpx;\n  color: #fff;\n  font-size: 30rpx;\n}\n.container .detail-box .buy-ban{\n  background-color: #ddd;\n}\n.container .detail-box .number-box{\n  padding-left: 24rpx;\n  padding-right: 24rpx;\n  height: 80rpx;\n  box-sizing: border-box;\n  border-top: solid 1rpx #e3e3e3;\n}\n.container .detail-box .number-box .control{\n  margin-top: 14rpx;\n  float: right;\n  height: 52rpx;\n  width: 52rpx;\n  background-color: #e3e3e3;\n  text-align: center;\n  line-height: 52rpx;\n  color: #666;\n  font-size: 36rpx;\n  border-radius: 5rpx;\n  margin-left: 4rpx;\n}\n.container .detail-box .number-box .ban{\n  background-color: #F0F0F0;\n}\n.container .detail-box .number-box .num{\n  width: 100rpx;\n  font-size: 26rpx;\n  background-color: #f0f0f0;\n  font-family: Arial, Helvetica, sans-serif; \n}\n</code></pre>\n<p>.js</p>\n<pre><code>Page({\n    data: {\n        shopping:[],\n        selNum:1,//要购买的数量\n    },\n    minus:function(){\n      //减少购买数量\n      let that=this;\n      if (that.data.minusBan==\"ban\"){\n        return;\n      }else{\n        that.setData({\n          selNum: that.data.selNum-1\n        })\n        if (that.data.selNum==1){\n          that.setData({\n            minusBan:\"ban\"\n          })\n        }\n      }\n      if (that.data.selNum == that.data.selStock) {\n        that.setData({\n          plusBan: \"ban\"\n        })\n      }else{\n        that.setData({\n          plusBan: \"\"\n        })      \n      }\n    },\n    plus:function(){\n      //增加购买数量\n      let that = this;\n      if (that.data.plusBan == \"ban\"){\n        return;\n      }else{\n        that.setData({\n          selNum: that.data.selNum + 1\n        })\n        if (that.data.selNum == that.data.selStock) {\n          that.setData({\n            plusBan: \"ban\"\n          })\n        }\n        if (that.data.selNum == 1) {\n          that.setData({\n            minusBan: \"ban\"\n          })\n        }else{\n          that.setData({\n            minusBan: \"\"\n          })        \n        }\n      }\n    },\n    confirm:function(evn){\n      //弹窗确认按钮触发\n        let num=this.data.selNum;\n        let u_id=wx.getStorageSync('userid');\n        let g_id=evn.target.dataset.id;\n        let oldprice=evn.target.dataset.price;\n        //总价格=总数量*单价\n        let price=num*oldprice;\n       \n        let token=wx.getStorageSync('token');\n        wx.request({\n          url: 'http://www.yk.com/api/v2/orders',\n          method:'post',\n          data:{u_id,g_id,num,price},\n          header: {\n              token\n          },\n          success (res) {\n            // 获取订单id\n           let id=res.data.data.id;\n            wx.reLaunch({\n              url: '/pages/order/order?id='+id,\n            })\n           \n          }\n        })\n\n\n      \n    },\n    onLoad: function (options) {\n      //  商品id\n        let id=options.id;\n        var that = this;\n        let token=wx.getStorageSync('token');\n        wx.request({\n          url: 'http://www.yk.com/api/v2/detail',\n          method:'GET',\n          data:{id},\n          header: {\n              token\n          },\n          success (res) {\n            // console.log(res.data)\n            let activity = res.data.data\n            that.setData({\n              activity:activity,\n        \n            })\n          }\n        })\n      },\n\n \n      buy:function(evn){\n        // console.log(evn.target.dataset.id);\n        // 商品id\n        let id=evn.target.dataset.id;\n        //立即购买按钮触发\n        this.showSelBox();\n        let that = this;\n        let token=wx.getStorageSync('token');\n        wx.request({\n          url: 'http://www.yk.com/api/v2/specs',\n          method:'GET',\n         data:{id},\n          header: {\n              token\n          },\n          success (res) {\n            console.log(res.data.data)\n            let activ = res.data.data;\n          \n            that.setData({\n              activ:activ,\n            })\n          }\n        })\n      },\n \n      onReady: function () {\n        let that = this\n        that.animation = wx.createAnimation({ //动画\n          duration: 300, //动画持续时间\n          timingFunction: 'linear', //动画的效果 动画从头到尾的速度是相同的\n          transformOrigin: \"50% 50% 0\",\n        })  \n      },\n      showSelBox: function (e) {//显示选项\n        let that = this;\n        let systemInfo = wx.getSystemInfoSync();\n        let px = 980 / 750 * systemInfo.windowWidth;\n    \n        this.animation.translateY(-px).step() //在Y轴偏移tx，单位px\n        this.setData({\n          animationDataSel: that.animation.export(),\n          selHidden: false,\n        })\n      },   \n\n \n\n  })\n  </code></pre>\n<p>订单页面</p>\n<p>.wxml</p>\n<pre><code>&lt;view wx:for=\"{<!-- -->{order}}\" wx:key=\"order\"&gt;\n    &lt;view wx:for=\"{<!-- -->{item.user}}\"&gt;\n        &lt;view&gt;{<!-- -->{item.nickName}}&lt;/view&gt;\n        &lt;view&gt;{<!-- -->{item.phone}}&lt;/view&gt;\n    &lt;/view&gt;\n    &lt;view style=\"margin-top: 100;\" wx:for=\"{<!-- -->{item.goods}}\"&gt;\n        &lt;view&gt;{<!-- -->{item.name}}&lt;/view&gt;\n        &lt;image src=\"{<!-- -->{item.image}}\"&gt;&lt;/image&gt;\n        &lt;view&gt;单价{<!-- -->{item.price}}&lt;/view&gt;\n    &lt;/view&gt;\n    &lt;view style=\"margin-top: 100;\"&gt;\n        &lt;view&gt;数量：{<!-- -->{item.num}}&lt;/view&gt;\n        &lt;view&gt;总价：{<!-- -->{item.price}}&lt;/view&gt;\n        &lt;button bindtap=\"pay\" data-id=\"{<!-- -->{item.oid}}\"&gt;去支付&lt;/button&gt;\n    &lt;/view&gt;\n  \n&lt;/view&gt;\n \n\n</code></pre>\n<p> .js</p>\n<pre><code>// pages/order/order.js\nPage({\n\n    /**\n     * 页面的初始数据\n     */\n    data: {\n        \n    },\n    pay:function(evn){\n       \n        let oid=evn.target.dataset.id;\n        let uid=wx.getStorageSync('userid');\n        let token=wx.getStorageSync('token');\n        wx.request({\n          url: 'http://www.yk.com/api/v2/pay',\n          method:'post',\n          data:{oid,uid},\n          header: {\n              token\n          },\n          success (res) {\n            // 获取订单id\n        \n            console.log(res)\n\n            // let order=res.data.data;\n            // console.log(order)\n            // that.setData({\n            //     order:order\n            //   })\n            // wx.reLaunch({\n            //   url: '/pages/order/order?id='+id,\n            // })\n           \n          }\n        })\n\n\n    },\n    /**\n     * 生命周期函数--监听页面加载\n     */\n    onLoad: function (options) {\n        let that=this;\n        // console.log(options.id);\n        let oid=options.id;\n              \n        let token=wx.getStorageSync('token');\n        wx.request({\n          url: 'http://www.yk.com/api/v2/order',\n          method:'get',\n          data:{oid},\n          header: {\n              token\n          },\n          success (res) {\n            // 获取订单id\n        \n            // console.log(res)\n            let order=res.data.data;\n            console.log(order)\n            that.setData({\n                order:order\n              })\n            // wx.reLaunch({\n            //   url: '/pages/order/order?id='+id,\n            // })\n           \n          }\n        })\n\n    },\n\n    /**\n     * 生命周期函数--监听页面初次渲染完成\n     */\n    onReady: function () {\n\n    },\n\n    /**\n     * 生命周期函数--监听页面显示\n     */\n    onShow: function () {\n\n    },\n\n    /**\n     * 生命周期函数--监听页面隐藏\n     */\n    onHide: function () {\n\n    },\n\n    /**\n     * 生命周期函数--监听页面卸载\n     */\n    onUnload: function () {\n\n    },\n\n    /**\n     * 页面相关事件处理函数--监听用户下拉动作\n     */\n    onPullDownRefresh: function () {\n\n    },\n\n    /**\n     * 页面上拉触底事件的处理函数\n     */\n    onReachBottom: function () {\n\n    },\n\n    /**\n     * 用户点击右上角分享\n     */\n    onShareAppMessage: function () {\n\n    }\n})</code></pre>\n<p>app.json</p>\n<pre><code>{\n    \"pages\": [\n        \"pages/mine/mine\",\n        \"pages/index/index\",\n        \"pages/home/home\",\n        \"pages/detail/detail\",\n        \"pages/order/order\"\n    ],\n    \"window\": {\n        \"backgroundTextStyle\": \"light\",\n        \"navigationBarBackgroundColor\": \"#f0145a\",\n        \"navigationBarTitleText\": \"微商城\",\n        \"backgroundColor\": \"#f0145a\"\n    },\n    \"tabBar\": {\n        \"color\": \"#858585\",\n        \"selectedColor\": \"#f0145a\",\n        \"backgroundColor\": \"#ffffff\",\n        \"borderStyle\": \"white\",\n        \"list\": [\n            {\n                \"pagePath\": \"pages/index/index\",\n                \"iconPath\": \"images/home.png\",\n                \"selectedIconPath\": \"images/home_select.png\",\n                \"text\": \"首页\"\n            },\n            {\n                \"pagePath\": \"pages/home/home\",\n                \"iconPath\": \"images/classify.png\",\n                \"selectedIconPath\": \"images/classify_select.png\",\n                \"text\": \"分类\"\n            },\n            {\n                \"pagePath\": \"pages/detail/detail\",\n                \"iconPath\": \"images/classify.png\",\n                \"selectedIconPath\": \"images/classify_select.png\",\n                \"text\": \"详情\"\n            },\n            {\n                \"pagePath\": \"pages/mine/mine\",\n                \"iconPath\": \"images/mine.png\",\n                \"selectedIconPath\": \"images/mine_select.png\",\n                \"text\": \"我的\"\n            }\n        ]\n    },\n    \"sitemapLocation\": \"sitemap.json\"\n}</code></pre>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n</div>\n</div>"}