{"blogid": "126617137", "writerAge": "ç é¾„97å¤©", "writerBlogNum": "173", "writerCollect": "2239", "writerComment": "175", "writerFan": "754", "writerGrade": "5çº§", "writerIntegral": "2970", "writerName": "Mdc_stdio", "writerProfileAdress": "writer_image\\profile_126617137.jpg", "writerRankTotal": "5961", "writerRankWeekly": "245", "writerThumb": "1069", "writerVisitNum": "141888", "blog_read_count": "605", "blog_time": "äºÂ 2022-08-31 09:27:48Â å‘å¸ƒ", "blog_title": "ã€æ¯•ä¸šè®¾è®¡ã€‘ä¾¿æºå¼STM32çš„çº¢å¤–ä¿¡å·åˆ†æä»ª - å•ç‰‡æœº ç‰©è”ç½‘ åµŒå…¥å¼", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>æ–‡ç« ç›®å½•</h3>\n<ul><li><a href=\"#0__5\">0 å‰è¨€</a></li><li><a href=\"#1__27\">1 ç®€ä»‹</a></li><li><a href=\"#2__31\">2 ä¸»è¦å™¨ä»¶</a></li><li><a href=\"#3__37\">3 å®ç°æ•ˆæœ</a></li><li><a href=\"#4__44\">4 è®¾è®¡åŸç†</a></li><li><a href=\"#5__63\">5 éƒ¨åˆ†æ ¸å¿ƒä»£ç </a></li><li><a href=\"#5__433\">5 æœ€å</a></li></ul>\n</div>\n<p></p>\n<hr color=\"#000000\" size='1\"'/>\n<h1><a id=\"0__5\"></a>0 å‰è¨€</h1>\n<p>ğŸ”¥ è¿™ä¸¤å¹´å¼€å§‹æ¯•ä¸šè®¾è®¡å’Œæ¯•ä¸šç­”è¾©çš„è¦æ±‚å’Œéš¾åº¦ä¸æ–­æå‡ï¼Œä¼ ç»Ÿçš„æ¯•è®¾é¢˜ç›®ç¼ºå°‘åˆ›æ–°å’Œäº®ç‚¹ï¼Œå¾€å¾€è¾¾ä¸åˆ°æ¯•ä¸šç­”è¾©çš„è¦æ±‚ï¼Œè¿™ä¸¤å¹´ä¸æ–­æœ‰å­¦å¼Ÿå­¦å¦¹å‘Šè¯‰å­¦é•¿è‡ªå·±åšçš„é¡¹ç›®ç³»ç»Ÿè¾¾ä¸åˆ°è€å¸ˆçš„è¦æ±‚ã€‚</p>\n<p>ä¸ºäº†å¤§å®¶èƒ½å¤Ÿé¡ºåˆ©ä»¥åŠæœ€å°‘çš„ç²¾åŠ›é€šè¿‡æ¯•è®¾ï¼Œå­¦é•¿åˆ†äº«ä¼˜è´¨æ¯•ä¸šè®¾è®¡é¡¹ç›®ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯</p>\n<p>ğŸš© <strong>ä¾¿æºå¼STM32çš„çº¢å¤–ä¿¡å·åˆ†æä»ª</strong></p>\n<p>ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)</p>\n<ul><li>éš¾åº¦ç³»æ•°ï¼š3åˆ†</li><li>å·¥ä½œé‡ï¼š3åˆ†</li><li>åˆ›æ–°ç‚¹ï¼š5åˆ†</li></ul>\n<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p>\n<p><a href=\"https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md\">https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md</a></p>\n<br/>\n<h1><a id=\"1__27\"></a>1 ç®€ä»‹</h1>\n<p>ç”±STM32F411CEU6ä½œä¸ºä¸»æ§èŠ¯ç‰‡çš„å¸¦æœ‰å§¿æ€æ„Ÿåº”ï¼Œçº¢å¤–è¾“å…¥ï¼Œçº¢å¤–è¾“å‡ºï¼Œå¯æ ¹æ®ä»»æ„å½•å…¥çš„çº¢å¤–ä¿¡å·è¿›è¡Œå­˜å‚¨ï¼Œç„¶åå‘å‡ºçº¢å¤–çº¿æ§åˆ¶å„ç§ç”µå™¨è®¾å¤‡, å¹¶å…·æœ‰æµ‹ç”µæµï¼Œç”µå‹ï¼Œç”µé˜»ï¼Œç”µå®¹èƒ½åŠ›çš„æ‰‹è¡¨ï¼Œæ˜¯å¯¹äºç”µå­å·¥ç¨‹å¸ˆæ¥è¯´å…·æœ‰è¾ƒå¼ºå®ç”¨æ€§çš„å°å·¥å…·ã€‚</p>\n<h1><a id=\"2__31\"></a>2 ä¸»è¦å™¨ä»¶</h1>\n<ul><li>STM32F411CEU6ä¸»æ§èŠ¯ç‰‡</li><li>ACS712ç”µæµä¼ æ„Ÿå™¨èŠ¯ç‰‡</li><li>TCå•ç‰‡æœº</li></ul>\n<h1><a id=\"3__37\"></a>3 å®ç°æ•ˆæœ</h1>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\218a8f7bfc474a63bc356b0e2226d27f.png\" width=\"500\"/><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\c5a1517f58bc418b8d0c1cf880c5905b.png\" width=\"500\"/><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\7168cd606b87418ebf9c7f238d28e7ed.png\" width=\"500\"/><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\cdaee43470bc4f9096f820c6c219f8a2.png\" width=\"500\"/></p>\n<h1><a id=\"4__44\"></a>4 è®¾è®¡åŸç†</h1>\n<p><strong>ç¡¬ä»¶</strong></p>\n<ul><li>ç”µå‹æ£€æµ‹ç”µè·¯ï¼Œä¸»è¦æ˜¯å°†å¤–éƒ¨-15v<sub>15vçš„ç”µå‹é€šè¿‡å‡ ä¸ªé™å‹ç”µé˜»æ ¹æ®KCLå’ŒKVLè½¬åŒ–æˆ0</sub>3.3vï¼Œå†ç”±ADCèŠ¯ç‰‡é‡‡é›†ï¼›</li><li>ç”µé˜»æ£€æµ‹ç”µè·¯ï¼Œæ ¹æ®ç®€å•çš„åˆ†å‹åŸç†ï¼Œå°†å¾…æµ‹ç”µé˜»é€šè¿‡æ¨¡æ‹Ÿå¼€å…³åˆ†åˆ«ä¸1kå’Œ1Mæ¬§é«˜ç²¾åº¦ç”µé˜»ä¸²è”æµ‹å¾—åˆ†å‹ï¼Œä»è€Œå®ç°ç²¾ç¡®æµ‹é‡è¾ƒå¤§èŒƒå›´å†…çš„ç”µé˜»é˜»å€¼ï¼›</li><li>ç”µå®¹æ£€æµ‹ç”µè·¯ï¼Œæ ¹æ®ç”µå®¹çš„ä¸€é˜¶é›¶çŠ¶æ€å“åº”ï¼Œç®—å‡ºæ—¶é—´å¸¸æ•°ï¼Œå†æ ¹æ®ä¸²è”çš„ç”µé˜»è®¡ç®—å‡ºæ¥å…¥ç”µå®¹çš„ç”µå®¹å€¼ï¼›</li><li>ï¼‰çº¢å¤–æ¥æ”¶å‘å°„ç”µè·¯ï¼Œé‡‡ç”¨å¤–åŠ ä¸€å—STCå•ç‰‡æœº(ä¸€ä¸ªæ¨¡å—~~~~)ï¼Œé‡Œé¢é¢„å…ˆçƒ§å½•çº¢å¤–è§£ç ç¨‹åºï¼Œå†é€šè¿‡ä¸²å£ä¸STM32é€šè®¯ï¼Œå®ç°å¯¹å¤–éƒ¨è¾“å…¥çº¢å¤–ä¿¡å·çš„è§£ç å’Œè°ƒåˆ¶å‘å°„ï¼›</li></ul>\n<p><strong>è½¯ä»¶</strong></p>\n<ul><li>å§¿æ€è§£ç®—ç®—æ³•ï¼Œå®ç°æ­¥æ•°è®¡ç®—ï¼ŒæŠ¬æ‰‹æ„Ÿåº”ï¼Œç¿»è…•æ„Ÿåº”ï¼ŒLCDè™šæ‹Ÿè§¦å±ï¼›</li><li>é’ˆå¯¹ä¸åŒçº¢å¤–ä¿¡å·çš„è§£ç å’Œå‘å°„ç®—æ³•ï¼Œçº¢å¤–ä¿¡å·å­˜å‚¨ç®—æ³•ç­‰ï¼›</li><li>ç”µé˜»ï¼Œç”µå®¹æµ‹é‡ç®—æ³•ï¼›</li><li>è‡ªåˆ¶å®šæ—¶å™¨ç³»ç»Ÿä»»åŠ¡è°ƒåº¦ç®—æ³•ã€‚</li></ul>\n<p><strong>ä¸»è¦åŸç†å›¾</strong><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\f12b9ce07f034535bf45c95688b7f4c3.png\" width=\"500\"/></p>\n<h1><a id=\"5__63\"></a>5 éƒ¨åˆ†æ ¸å¿ƒä»£ç </h1>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"main.h\"</span></span>\n\n\n\n<span class=\"token comment\">/********************å˜é‡å£°æ˜åŒº_START********************/</span>\nu8 flag_Power_On <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> flag_MPU_Refresh <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\nbool LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">uint8_t</span> RTC_hour <span class=\"token operator\">=</span> <span class=\"token number\">23</span><span class=\"token punctuation\">,</span> RTC_minute <span class=\"token operator\">=</span> <span class=\"token number\">14</span><span class=\"token punctuation\">,</span> RTC_second <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\nu8 IR_flag <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> IR_Channel <span class=\"token operator\">=</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> flag_BEEP <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> flag_ADS_readC <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> flag_ADS_readR <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\nu8 Arm_Position <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">short</span> aacx<span class=\"token punctuation\">,</span> aacy<span class=\"token punctuation\">,</span> aacz<span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨åŸå§‹æ•°æ®</span>\n\nbool Raised_Flag <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\nbool Reversed_Flag <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n\nu8 flag_of_STATE <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">uint16_t</span> Menu_Pointer<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">35</span><span class=\"token punctuation\">,</span> <span class=\"token number\">69</span><span class=\"token punctuation\">,</span> <span class=\"token number\">103</span><span class=\"token punctuation\">,</span> <span class=\"token number\">137</span><span class=\"token punctuation\">,</span> <span class=\"token number\">171</span><span class=\"token punctuation\">,</span> <span class=\"token number\">205</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nu8 Fill_IR_Code<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//æ˜¾ç¤ºçº¢å¤–ç å­˜å‚¨åŒºæ˜¯å¦ä¸ºç©ºï¼š0-ç©º 1-æœ‰</span>\n<span class=\"token class-name\">uint16_t</span> time_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">54</span><span class=\"token punctuation\">,</span> <span class=\"token number\">102</span><span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">uint16_t</span> clock_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">135</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @brief å†³å®šç³»ç»ŸçŠ¶æ€çš„é€‰æ‹©\n * @param èœå•;çº¢å¤–æ”¶å‘æ¨¡å¼;çº¢å¤–é€šé“é€‰æ‹©æ¨¡å¼;é™€èºä»ªæ¨¡å¼;æ¨¡æ‹Ÿé‡æµ‹è¯•æ¨¡å¼;\n */</span>\n<span class=\"token keyword\">enum</span> <span class=\"token class-name\">STATUS</span> <span class=\"token punctuation\">{<!-- --></span>\n    MENU <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    TIMERUN<span class=\"token punctuation\">,</span>\n    TIME_SET<span class=\"token punctuation\">,</span>\n    CLOCK_SET<span class=\"token punctuation\">,</span>\n    IR_REMOTE<span class=\"token punctuation\">,</span>\n    IR_CHANNEL_CHOOSE<span class=\"token punctuation\">,</span>\n    MPU6050<span class=\"token punctuation\">,</span>\n    AD_VAL<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> STATE<span class=\"token punctuation\">;</span>\n\n\n\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span>  <span class=\"token macro-name\">PUT_UP</span>     <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span>  <span class=\"token macro-name\">LAY_DOWN</span>   <span class=\"token expression\"><span class=\"token number\">2</span></span></span>\n\n<span class=\"token comment\">//mpu6050</span>\n<span class=\"token keyword\">short</span> cnt_up <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">short</span> cnt_down <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">short</span> cnt_reverse <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">short</span> cnt_raising <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">short</span> Stale_aacx_Data <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">short</span> Stale_aacy_Data <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">short</span> Reverse_status <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/********************å˜é‡å£°æ˜åŒº_END********************/</span>\n\n\n\n<span class=\"token comment\">/********************APIå£°æ˜åŒº_START********************/</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Proc2msTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//å¤„ç†2msä»»åŠ¡</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Proc50msTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//å¤„ç†50msä»»åŠ¡</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">InitSoftware</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">InitHardware</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">ST7789_SHOW</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">KEY_Process</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Get_Arm_Position</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">short</span><span class=\"token operator\">*</span> aacx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">short</span><span class=\"token operator\">*</span> aacy<span class=\"token punctuation\">,</span> <span class=\"token keyword\">short</span><span class=\"token operator\">*</span> aacz<span class=\"token punctuation\">,</span> u8<span class=\"token operator\">*</span> Arm_Position<span class=\"token punctuation\">,</span> bool<span class=\"token operator\">*</span> Raised_Flag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span>  bool  <span class=\"token function\">Judge_Wrist_Reverse</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">short</span><span class=\"token operator\">*</span> aacx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">short</span><span class=\"token operator\">*</span> aacy<span class=\"token punctuation\">,</span> <span class=\"token keyword\">short</span><span class=\"token operator\">*</span> aacz<span class=\"token punctuation\">,</span> u8<span class=\"token operator\">*</span> Arm_Position<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">MPU6050_Process</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Page0_Menu</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Page1_TimeRunning</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Page2_Timeset</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//static  void  Page3_Clockset1(void);</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Page4_Clockset2</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Page5_IR_Remote</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Page7_AD_VAL</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/********************APIå£°æ˜åŒº_END********************/</span>\n\n\n\n<span class=\"token comment\">/*********************************************************************************************************\n* å‡½    æ•°: main\n* æ³¨    æ„: ä½œè€…ä¸ºäº†è®©mainçœ‹èµ·æ¥æ›´æ¼‚äº®ï¼Œæ•´äº†äº›èŠ±é‡Œèƒ¡å“¨çš„API QWQ\n*********************************************************************************************************/</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\n    <span class=\"token function\">InitSoftware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">InitHardware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    STATE <span class=\"token operator\">=</span> MENU<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ST7789_Fill_Color</span><span class=\"token punctuation\">(</span>WHITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag_Power_On<span class=\"token punctuation\">)</span><span class=\"token function\">Proc2msTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag_MPU_Refresh <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            flag_MPU_Refresh <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">ST7789_Fill_Color</span><span class=\"token punctuation\">(</span>BLACK<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag_Power_On<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\tLCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">ST7789_Fill_Color</span><span class=\"token punctuation\">(</span>WHITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">Proc50msTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">delay_ms</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n\n\n<span class=\"token comment\">/*********************************************************************************************************\n*                                              å†…éƒ¨å‡½æ•°å®ç°\n*********************************************************************************************************/</span>\n<span class=\"token comment\">/*********************************************************************************************************\n* å‡½æ•°åç§°: Proc2msTask\n* å‡½æ•°åŠŸèƒ½: å¤„ç†2msä»»åŠ¡\n* è¾“å…¥å‚æ•°: void\n* è¾“å‡ºå‚æ•°: void\n* è¿” å› å€¼: void\n* æ³¨    æ„:\n*********************************************************************************************************/</span>\n<span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Proc2msTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get2msFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">static</span> u8 <span class=\"token class-name\">tmp_t</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>LCD_Already_Updated<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">ST7789_SHOW</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag_BEEP <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">BEEP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            flag_BEEP <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag_BEEP <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token function\">BEEP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            flag_BEEP <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">tmp_t</span> <span class=\"token operator\">==</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">KEY_Process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">tmp_t</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token class-name\">tmp_t</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">Clr2msFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/*********************************************************************************************************\n* å‡½æ•°åç§°: Proc50msTask\n* å‡½æ•°åŠŸèƒ½: å¤„ç†50msä»»åŠ¡\n* è¾“å…¥å‚æ•°: void\n* è¾“å‡ºå‚æ•°: void\n* è¿” å› å€¼: void\n* æ³¨    æ„:\n*********************************************************************************************************/</span>\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">Proc50msTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Get50msFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">MPU6050_Process</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">Clr50msFlag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">InitSoftware</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">static</span>  <span class=\"token keyword\">void</span>  <span class=\"token function\">InitHardware</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function\">SystemInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">NVIC_PriorityGroupConfig</span><span class=\"token punctuation\">(</span>NVIC_PriorityGroup_2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//è®¾ç½®ç³»ç»Ÿä¸­æ–­ä¼˜å…ˆçº§åˆ†ç»„2</span>\n    <span class=\"token function\">delay_init</span><span class=\"token punctuation\">(</span><span class=\"token number\">104</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \t\t\t<span class=\"token comment\">//åˆå§‹åŒ–å»¶æ—¶å‡½æ•°</span>\n    <span class=\"token function\">uart_init</span><span class=\"token punctuation\">(</span><span class=\"token number\">115200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t<span class=\"token comment\">//åˆå§‹åŒ–ä¸²å£</span>\n    <span class=\"token function\">InitTimer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t\t<span class=\"token comment\">//åˆå§‹åŒ–ä»»åŠ¡è°ƒåº¦å®šæ—¶å™¨</span>\n    <span class=\"token function\">GPIO_ALLInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t\t<span class=\"token comment\">//åˆå§‹åŒ–èœ‚é¸£å™¨ï¼ŒLEDï¼ŒKEYå¤–è®¾</span>\n    <span class=\"token function\">five_keys_exti_config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t<span class=\"token comment\">//åˆå§‹åŒ–äº”å‘æŒ‰é”®</span>\n    <span class=\"token function\">ST7789_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t\t<span class=\"token comment\">//åˆå§‹åŒ–LCD-ST7789</span>\n    <span class=\"token function\">MPU_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t\t\t<span class=\"token comment\">//åˆå§‹åŒ–MPU6050</span>\n    <span class=\"token function\">My_RTC_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">RTC_Set_WakeUp</span><span class=\"token punctuation\">(</span>RTC_WakeUpClock_CK_SPRE_16bits<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t<span class=\"token comment\">//é…ç½®WAKE UPä¸­æ–­,1ç§’é’Ÿä¸­æ–­ä¸€æ¬¡</span>\n\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token function\">mpu_dmp_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MPU6050 Init Error!\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">delay_ms</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Init OK\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">ST7789_SHOW</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>STATE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\n    <span class=\"token keyword\">case</span> MENU<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">SPI_ChangeConfig</span><span class=\"token punctuation\">(</span>LCD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Page0_Menu</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        LCD_Already_Updated <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> TIMERUN<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">SPI_ChangeConfig</span><span class=\"token punctuation\">(</span>LCD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Page1_TimeRunning</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        LCD_Already_Updated <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> TIME_SET<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">SPI_ChangeConfig</span><span class=\"token punctuation\">(</span>LCD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Page2_Timeset</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        LCD_Already_Updated <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> CLOCK_SET<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">SPI_ChangeConfig</span><span class=\"token punctuation\">(</span>LCD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Page4_Clockset2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        LCD_Already_Updated <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> IR_REMOTE<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">SPI_ChangeConfig</span><span class=\"token punctuation\">(</span>LCD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Page5_IR_Remote</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        LCD_Already_Updated <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> IR_CHANNEL_CHOOSE<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">SPI_ChangeConfig</span><span class=\"token punctuation\">(</span>LCD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">ST7789_DrawImage</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span> <span class=\"token number\">240</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">uint16_t</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>IR_ChannelChoosing<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        LCD_Already_Updated <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> AD_VAL<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">SPI_ChangeConfig</span><span class=\"token punctuation\">(</span>ADS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">cin_get_cap_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">ADS1118GPIOInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">ADS1118_Init</span><span class=\"token punctuation\">(</span>ADS1118_SS_NONE<span class=\"token punctuation\">,</span> ADS1118_MODE_LX<span class=\"token punctuation\">,</span> ADS1118_DR_128<span class=\"token punctuation\">,</span> ADS1118_PULL_UP_EN_E<span class=\"token punctuation\">,</span> ADS1118_NOP_W<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">SPI_ChangeConfig</span><span class=\"token punctuation\">(</span>LCD<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">Page7_AD_VAL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">default</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        LCD_Already_Updated <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">KEY_Process</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    u8 key <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    key <span class=\"token operator\">=</span> <span class=\"token function\">KEY_Scan</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//å¾—åˆ°é”®å€¼</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">case</span> KEY1_PRES<span class=\"token operator\">:</span>\n            <span class=\"token comment\">//çº¢å¤–é€‰æ‹©é€šé“ï¼š1/2/3/4</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> IR_CHANNEL_CHOOSE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                IR_Channel <span class=\"token operator\">=</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">;</span>\n                STATE <span class=\"token operator\">=</span> MENU<span class=\"token punctuation\">;</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n                <span class=\"token function\">ST7789_Fill_Color</span><span class=\"token punctuation\">(</span>WHITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">//çº¢å¤–æ”¶å‘æ¨¡å¼</span>\n            <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> IR_REMOTE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                IR_flag <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>IR_flag<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>IR_flag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    LED2 <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>USART_RX_BUF<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>USART_RX_BUF<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token function\">USART1_Tx_Puts</span><span class=\"token punctuation\">(</span>cmd_stor_buffer1<span class=\"token punctuation\">,</span> IR_Channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n                    LED2 <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>flag_USART_Get<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                        Fill_IR_Code<span class=\"token punctuation\">[</span>IR_Channel <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                        LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n\t\t\t\t\t\tflag_USART_Get <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n                        Fill_IR_Code<span class=\"token punctuation\">[</span>IR_Channel <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n                        LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n\t\t\t\t\t\tflag_USART_Get <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token comment\">//print_buffer;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> AD_VAL<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                flag_ADS_readC <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token function\">BEEP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">case</span> KEY2_PRES<span class=\"token operator\">:</span>\n            <span class=\"token comment\">//çº¢å¤–é€‰æ‹©é€šé“ï¼š1/2/3/4</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> IR_CHANNEL_CHOOSE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                IR_Channel <span class=\"token operator\">=</span> <span class=\"token number\">0x02</span><span class=\"token punctuation\">;</span>\n                STATE <span class=\"token operator\">=</span> MENU<span class=\"token punctuation\">;</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n                <span class=\"token function\">ST7789_Fill_Color</span><span class=\"token punctuation\">(</span>WHITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">//çº¢å¤–æ”¶å‘æ¨¡å¼</span>\n            <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> IR_REMOTE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token function\">USART1_Tx_Puts</span><span class=\"token punctuation\">(</span>cmd_send_buffer1<span class=\"token punctuation\">,</span> IR_Channel<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> AD_VAL<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                flag_ADS_readR <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token function\">BEEP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">case</span> KEY3_PRES<span class=\"token operator\">:</span>\n            <span class=\"token comment\">//çº¢å¤–é€‰æ‹©é€šé“ï¼š1/2/3/4</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> IR_CHANNEL_CHOOSE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                IR_Channel <span class=\"token operator\">=</span> <span class=\"token number\">0x03</span><span class=\"token punctuation\">;</span>\n                STATE <span class=\"token operator\">=</span> MENU<span class=\"token punctuation\">;</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n                <span class=\"token function\">ST7789_Fill_Color</span><span class=\"token punctuation\">(</span>WHITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> TIME_SET<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token function\">ST7789_DrawRectangle</span><span class=\"token punctuation\">(</span>time_set_Pos<span class=\"token punctuation\">[</span>time_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">110</span><span class=\"token punctuation\">,</span>\n                                     time_set_Pos<span class=\"token punctuation\">[</span>time_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token number\">148</span><span class=\"token punctuation\">,</span> WHITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                time_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>time_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">2</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>time_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> CLOCK_SET<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token function\">ST7789_DrawRectangle</span><span class=\"token punctuation\">(</span>clock_set_Pos<span class=\"token punctuation\">[</span>clock_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n                                     clock_set_Pos<span class=\"token punctuation\">[</span>clock_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> WHITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                clock_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>clock_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">1</span> <span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token function\">BEEP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">case</span> KEY4_PRES<span class=\"token operator\">:</span>\n            <span class=\"token comment\">//çº¢å¤–é€‰æ‹©é€šé“ï¼š1/2/3/4</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> IR_CHANNEL_CHOOSE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                IR_Channel <span class=\"token operator\">=</span> <span class=\"token number\">0x04</span><span class=\"token punctuation\">;</span>\n                STATE <span class=\"token operator\">=</span> MENU<span class=\"token punctuation\">;</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n                <span class=\"token function\">ST7789_Fill_Color</span><span class=\"token punctuation\">(</span>WHITE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> TIME_SET<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>time_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    RTC_second <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>RTC_second <span class=\"token operator\">==</span> <span class=\"token number\">59</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> RTC_second <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>time_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    RTC_minute <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>RTC_minute <span class=\"token operator\">==</span> <span class=\"token number\">59</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> RTC_minute <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n                    RTC_hour <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>RTC_hour <span class=\"token operator\">==</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> RTC_hour <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>STATE <span class=\"token operator\">==</span> CLOCK_SET<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>clock_set_Pos<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    RTC_minute <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>RTC_minute <span class=\"token operator\">==</span> <span class=\"token number\">59</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> RTC_minute <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n                    RTC_hour <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>RTC_hour <span class=\"token operator\">==</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> RTC_hour <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token function\">BEEP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        LCD_Already_Updated <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token comment\">//else delay_ms(10);</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<br/>\n<h1><a id=\"5__433\"></a>5 æœ€å</h1>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}