{"blogid": "126715752", "writerAge": "码龄6年", "writerBlogNum": "20", "writerCollect": "129", "writerComment": "150", "writerFan": "261", "writerGrade": "3级", "writerIntegral": "643", "writerName": "北京前端 年薪100w+", "writerProfileAdress": "writer_image\\profile_126715752.jpg", "writerRankTotal": "34708", "writerRankWeekly": "734", "writerThumb": "188", "writerVisitNum": "3008", "blog_read_count": "151", "blog_time": "于 2022-09-06 08:01:41 发布", "blog_title": "微信公众号支付(JSAPI)", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night-eighties\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p><em>六年代码两茫茫，不思量，自难忘</em><br/> 6年资深前端主管一枚，只分享技术干货，项目实战分享<br/> <strong>关注博主不迷路~</strong></p>\n</blockquote>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#JSAPI_7\">JSAPI支付简介</a></li><li><a href=\"#_11\">应用场景</a></li><li><a href=\"#_15\">支付的对接</a></li><li><ul><li><a href=\"#_16\">准备工作</a></li><li><a href=\"#_21\">开发流程</a></li><li><ul><li><a href=\"#_24\">必填参数</a></li><li><a href=\"#_39\">预支付统一下单</a></li><li><a href=\"#_43\">公众号授权</a></li><li><a href=\"#_46\">获取用户信息</a></li><li><a href=\"#JSAPI_55\">微信支付（JSAPI）</a></li></ul>\n</li></ul>\n</li></ul>\n</div>\n<p></p>\n<hr/>\n<h1><a id=\"JSAPI_7\"></a>JSAPI支付简介</h1>\n<p>JSAPI支付是指商户通过调用微信支付提供的JSAPI接口，在支付场景中调起微信支付模块完成收款。</p>\n<h1><a id=\"_11\"></a>应用场景</h1>\n<ul><li>线下场所：调用接口生成二维码，用户扫描二维码后在微信浏览器中打开页面后完成支付。</li><li>公众号场景：用户在微信公众账号内进入商家公众号，打开某个主页面，完成支付。</li><li>PC网站场景：在网站中展示二维码，用户扫描二维码后在微信浏览器中打开页面后完成支付。</li></ul>\n<h1><a id=\"_15\"></a>支付的对接</h1>\n<h2><a id=\"_16\"></a>准备工作</h2>\n<p>要想支持微信支付,必须拥有两个账号：</p>\n<ol><li>微信公众已认证的服务号,并且需要开通微信支付该能（必须是企业才有资格申请哦）</li><li>微信商户平台账号<br/> <code>*这两个账号一个都不能少</code></li></ol>\n<h2><a id=\"_21\"></a>开发流程</h2>\n<p>微信支付原理（说白了就是调用官方文档的“统一下单”接口,之后将微信服务器返回的参数做个加工后,返回到前台（JSP页面）,就OK了。咱们要做的就是想方设法的凑齐统一下单的所有参数。</p>\n<h3><a id=\"_24\"></a>必填参数</h3>\n<p><code>appid</code> APPID<br/> <code>mch_id</code> 商户ID<br/> <code>nonce_str </code>随机字符串<br/> <code>sign</code> 签名<br/> <code>body</code> 所支付的名称<br/> <code>out_trade_no</code> 自己所提供的订单号,需要唯一<br/> <code>total_fee</code> 支付金额<br/> <code>spbill_create_ip</code> IP地址<br/> <code>notify_url</code> 回调地址<br/> <code>trade_type</code> 支付类型<br/> <code>openid</code> 支付人的微信公众号对应的唯一标识</p>\n<p><mark>参数的获取呢主要是用其中的WXPayUtil工具类中的一些方法</mark><br/> <strong>好了开始咱们的取值之旅了~</strong></p>\n<h3><a id=\"_39\"></a>预支付统一下单</h3>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\506efc0431b14b0990eb2a61dca2e5de.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\37d5893e29b04952b5fc8e969252fe3d.png\"/></p>\n<h3><a id=\"_43\"></a>公众号授权</h3>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\206d1cfb16854ee196c1168cce25ff32.png\"/></p>\n<h3><a id=\"_46\"></a>获取用户信息</h3>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\563f87d21d404e498a9a5a245a25beac.png\"/></p>\n<p>前台页面配置（主要为获取授权）在此处主要为打开首页跳转微信的授权地址 然后微信回调到页面且携带参数code<br/> <em>如：<br/> 当前访问地址：http://aaa.com<br/> 微信回调地址：http://aaa.com?code=xxxxx<br/> getAuth(code)为请求后台的auth方法来获取token和用户的openid 然后再调用getUserInfo()来请求后台info接口来获取用户信息，将用户的信息存入缓存</em><br/> <img alt=\"在这里插入图片描述\" src=\"image\\04397e1c6ebe48e581a4a5a91f5cddf5.png\"/></p>\n<h3><a id=\"JSAPI_55\"></a>微信支付（JSAPI）</h3>\n<p>接下来才是重点，也就是支付的实现，下图的onPay()函数执行了两步操作</p>\n<ol><li>调用wxPay()函数，带参为本地缓存的用户openid（也就是调用后台预支付的API接口）生成预支付订单</li><li>然后调用微信内置浏览器的组件WeixinJSBridge.invoke()将刚才后台返回的数据参数带入来发起支付<br/> 如图所示：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\5d20185113b84e1a908d2eee515fd661.png\"/><br/> 发起支付</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\9a1f823fb9a643188b3f89db6bb48c89.png\"/></p>\n<p>完成！</p>\n<blockquote>\n<p>✨原 创 不 易 ， 还 希 望 各 位 支 持<br/> 👍 点 赞 ， 你 的 认 可 是 我 创 作 的 动 力 ！<br/> ⭐️ 收 藏 ， 你 的 青 睐 是 我 努 力 的 方 向 ！<br/> ✏️ 评 论 ， 你 的 意 见 是 我 进 步 的 财 富 ！</p>\n</blockquote>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}