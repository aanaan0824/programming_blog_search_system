{"blogid": "122913108", "writerAge": "码龄3年", "writerBlogNum": "2", "writerCollect": "7", "writerComment": "1", "writerFan": "4", "writerGrade": "1级", "writerIntegral": "22", "writerName": "张明新1", "writerProfileAdress": "writer_image\\profile_122913108.jpg", "writerRankTotal": "203525", "writerRankWeekly": "406333", "writerThumb": "1", "writerVisitNum": "2850", "blog_read_count": "1140", "blog_time": "于 2022-05-08 17:46:57 发布", "blog_title": "C#语言使用EasyModbus做客户端和西门子1511PLC通信", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"EasyModbus_0\"></a>一、为什么使用EasyModbus?</h1>\n<p>之前一直使用开源库NModbus，它是一个非常优秀的Modbus通信类库，偶然机会下我发现了EasyModbus，发现EasyModbus的代码非常精炼、间接，一两行代码就可以创建一个Modbus TCP Client。<br/> EasyModbus官网：http://easymodbustcp.net/en/</p>\n<h1><a id=\"_5\"></a>二、使用步骤</h1>\n<h2><a id=\"1_6\"></a>1.添加引用</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\a7a109a66fac48cea167f2c33c66c56c.png\"/>在官网下载DLL文件，在项目中添加引用。</p>\n<p><font color=\"#999AAA\">代码如下（示例）：</font></p>\n<pre><code class=\"prism language-c\">using EasyModbus<span class=\"token punctuation\">;</span>\n</code></pre>\n<h2><a id=\"2Modbus_TCP_Client_21\"></a>2.创建一个Modbus TCP Client</h2>\n<p><font color=\"#999AAA\">代码如下（示例）：</font></p>\n<pre><code class=\"prism language-c\">ModbusClient modbusClient <span class=\"token operator\">=</span> new <span class=\"token function\">ModbusClient</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"192.168.0.1\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">502</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//创建一个ModbusTCP客户端，IP地址为127.0.0.1，端口号为502</span>\n\n</code></pre>\n<h2><a id=\"3Modbus_TCP_Client_31\"></a>3.添加一个按钮事件来开启Modbus TCP Client</h2>\n<p><font color=\"#999AAA\">代码如下（示例）：</font></p>\n<pre><code class=\"prism language-c\">private <span class=\"token keyword\">void</span> <span class=\"token function\">bthConnect_Click</span><span class=\"token punctuation\">(</span>object sender<span class=\"token punctuation\">,</span> EventArgs e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n  ModbusTCP客户端定时器<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//MoubusTCP客户端定时器开启</span>\n  modbusClient<span class=\"token punctuation\">.</span><span class=\"token function\">Connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//ModbusTCP客户端连接</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h2><a id=\"4_44\"></a>4.添加一个计时器来刷新数据</h2>\n<p><font color=\"#999AAA\">代码如下（示例）：</font></p>\n<pre><code class=\"prism language-c\">private <span class=\"token keyword\">void</span> ModbusTCP客户端定时器<span class=\"token function\">_Tick</span><span class=\"token punctuation\">(</span>object sender<span class=\"token punctuation\">,</span> EventArgs e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">region</span> <span class=\"token expression\">ModbusTCP客户端读取数据</span></span>\n  <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> readHoldingRegisters <span class=\"token operator\">=</span> modbusClient<span class=\"token punctuation\">.</span><span class=\"token function\">ReadHoldingRegisters</span><span class=\"token punctuation\">(</span>txtStart<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//读取从40001寄存器开始的10个地址</span>\n  txtReceive1<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive2<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive3<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive4<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive5<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive6<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive7<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive8<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive9<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  txtReceive10<span class=\"token punctuation\">.</span>IntValue <span class=\"token operator\">=</span> readHoldingRegisters<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endregion</span></span>\n  <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">region</span> <span class=\"token expression\">将<span class=\"token number\">10</span>个值批次写入从<span class=\"token number\">40001</span>开始的<span class=\"token number\">10</span>个寄存器</span></span>\n  modbusClient<span class=\"token punctuation\">.</span><span class=\"token function\">WriteMultipleRegisters</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> new <span class=\"token keyword\">int</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{<!-- --></span> txtSend1<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend2<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend3<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend4<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend5<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend6<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend7<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend8<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend9<span class=\"token punctuation\">.</span>IntValue<span class=\"token punctuation\">,</span> txtSend10<span class=\"token punctuation\">.</span>IntValue <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endregion</span></span>\n  <span class=\"token punctuation\">}</span>\n</code></pre>\n<h2><a id=\"5PLCModbus_TCP_Server_70\"></a>5.西门子PLC创建Modbus TCP Server</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\2de5878d922843b28b06d8bc11177933.png\"/>InterfaceId：本地PLC接口硬件标识符<br/> ID：引用该连接（取值范围：1 到 4095）。该参数将唯一确定 CPU 中的连接。<br/> ConnectionType ：连接类型，对于 TCP，选择 11（16#0B)<br/> ActiveEstablished：建立连接的方式所对应的 ID，对于被动连接建立，应选择 FALSE。<br/> RemoteAddress：连接伙伴的 IP 地址，如果要接受来自任何连接伙伴的连接请求，应使用“0.0.0.0”<br/> RemotePort：远程连接伙伴的端口号，如果要接受来自远程伙伴任何端口的连接请求，应使用“0”<br/> LocalPort：本地连接伙伴的端口号，定义 Modbus 客户端连接请求中要监视的 IP 端口。默认为 502。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\dab4655704844a43ae8ab24096ae34c2.png\"/>MB_HOLD_REG ：指向“MB_SERVER”指令中 Modbus 保持性寄存器的指针使用地址，上图代表MW100对应40001，MW102对应40002，MW104对应40003…依次类推</p>\n<h2><a id=\"6_79\"></a>6.页面展示</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\741bafcb0a2e4a7db9a38193f91210e4.png\"/></p>\n<h1><a id=\"_81\"></a>总结</h1>\n<p>EasyModbus是非常优秀的Modbus通信类库，代码简洁干练，一两行代码就可以创建一个Modbus TCP连接，特别符合电气工程师的使用习惯。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}