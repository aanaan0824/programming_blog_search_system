{"blogid": "123800864", "writerAge": "码龄178天", "writerBlogNum": "2", "writerCollect": "7", "writerComment": "2", "writerFan": "2", "writerGrade": "1级", "writerIntegral": "21", "writerName": "Hs.ss", "writerProfileAdress": "writer_image\\profile_123800864.jpg", "writerRankTotal": "222391", "writerRankWeekly": "1108308", "writerThumb": "0", "writerVisitNum": "6634", "blog_read_count": "5830", "blog_time": "于 2022-03-29 16:21:42 发布", "blog_title": "文件包含漏洞及原理", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1><strong>什么是文件包含漏洞</strong></h1>\n<p><strong>1：随着网站的业务的需求，程序开发人员一般希望代码更加灵活，所以将被包含的文件设置为变量，用来进行动态调用，但是正是这种灵活性通过动态变量的方式引入需要包含的文件时，用户对这个变量可控而且服务端又没有做合理的校检或者校检被绕过就造成了文件包含漏洞。</strong></p>\n<p>经常见到的函数</p>\n<p>1：include（）当前使用该函数包含文件时，只有代码执行到include（）函数时将文件包含起来，发生错误时给出一个警告，然后继续执行语句</p>\n<p>2，include_once()功能和include（）相同，区别当重复调用一个文件时，程序只调用一次</p>\n<p>3：reguire（）执行如果发生错误，函数会输出错误信息，并终止脚本的运行</p>\n<p>4：require_once（）功能与require（）相同区别在于当重复调用一个文件时，程序只调用一次</p>\n<p>5：nighcight_file(),show_source()函数对文件进行语法高亮显示，通常能看到源代码</p>\n<p>6：readfile（），file_get_contents（）函数读取一个文件，并写入输出缓冲</p>\n<p>7：fopen（），打开一个文件或者url</p>\n<p>几乎所有的脚本语言中都提供文件包含的功能，但文件包含漏洞在php中居多，而在jsp\\ASP\\ASP.NETC 程序中非常少，甚至没有文件包含漏洞的存在。</p>\n<h2>文件包含漏洞分类</h2>\n<p>1，本地文件包含：</p>\n<p>当被包含的文件在服务器本地时，就形成的本地文件包含漏洞</p>\n<p>2，远程文件包含漏洞：</p>\n<p>本地文件包含和远程文件包含造成漏洞的原因时一样的，当php.ini中的配置选项allow_url_fopen和alliw_url_include为ON的话，则包含的文件可以是第三方服务器中的文件，就形成了远程文件包含漏洞。</p>\n<h3>漏洞的环境代码</h3>\n<p>&lt;?php</p>\n<p>      </p>\n<p>        $flie=$_GET[ \"file\"];</p>\n<p>        include($flir);</p>\n<p>      </p>\n<p>?&gt;</p>\n<p><img alt=\"\" src=\"image\\88b9e0b7a6df40559d2842a5c46df5b5.png\"/></p>\n<p> 127.0.0.1/a.php/../shell.php相对路径就可以访问到这个文件</p>\n<p></p>\n<p><img alt=\"\" src=\"image\\af19abe4b15c463ea9d7632307f9cf9d.png\"/></p>\n<p>C:/windows/system32.txt</p>\n<p>../是父级目录  就是上一层的目录 C：/</p>\n<p>./是当前目录</p>\n<p>/是根目录 </p>\n<p>本地包含是可以实现php phpinfo（）；的，写一个文件aa.php里面写php phpinfo（）；它的后缀名是什么都可以，aa.dada都可以的</p>\n<p><img alt=\"\" height=\"874\" src=\"image\\1eec4069996c4e959cb1058592e1c861.png\" width=\"1200\"/></p>\n<p>也可以写一句话木马，用工具来链接，不管后缀名是什么都会当代码执行，这个漏洞一般都要配合i其他漏洞来找。这就是本地包含漏洞</p>\n<h1>远程包含文件漏洞</h1>\n<p>利用条件</p>\n<p>在对方开启这两个配置时才可以使用</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">需要满足两个条件在php.ini中。当php.ini中的配置选项allow_url_fopen:on  allow_url_include:on</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"501\" src=\"image\\94cad47a81a6489bbcc4659d37f03b0d.png\" width=\"700\"/></p>\n<p>开启apache 服务 ，一定要桥接模式</p>\n<p><img alt=\"\" height=\"1002\" src=\"image\\8463c866e7654a5e896bdf3143942dc2.png\" width=\"1200\"/></p>\n<p> </p>\n<p>已经显示出来了，用第3方服务器来做操作 ，如果用的是一句话木马，就可以用菜刀蚁剑来链接！</p>\n</div>\n</div>"}