{"blogid": "126741875", "writerAge": "码龄4年", "writerBlogNum": "255", "writerCollect": "309", "writerComment": "44", "writerFan": "30", "writerGrade": "5级", "writerIntegral": "3005", "writerName": "加蓓努力我先飞", "writerProfileAdress": "writer_image\\profile_126741875.jpg", "writerRankTotal": "10964", "writerRankWeekly": "26836", "writerThumb": "69", "writerVisitNum": "138143", "blog_read_count": "11", "blog_time": "于 2022-09-07 11:55:49 发布", "blog_title": "前端打包踩坑", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>现在觉得这个有用，先暂时这样理解，后续再进行修改</p>\n<p></p>\n<div class=\"toc\">\n<h3>前端打包踩坑</h3>\n<ul><li><a href=\"#1vue2_4\">1.vue2打包</a></li><li><ul><li><a href=\"#11_5\">1.1打包配置</a></li><li><a href=\"#12_53\">1.2打包文件名</a></li></ul>\n</li><li><a href=\"#2vue3_85\">2.vue3打包</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"1vue2_4\"></a>1.vue2打包</h1>\n<h2><a id=\"11_5\"></a>1.1打包配置</h2>\n<p>1.在 build/build.formal.js中（没有该文件的话创建），更改</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">const</span> webpackConfig <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./webpack.prod.formal.conf'</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>2.在 build/webpack.dev.formal.conf.js 中（没有该文件的话创建），更改</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>DefinePlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token string-property property\">'process.env'</span><span class=\"token operator\">:</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../config/dev.formal.env'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n</code></pre>\n<p>3.在 build/webpack.prod.formal.conf.js中（没有该文件的话创建），更改</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">const</span> env <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../config/dev.formal.env'</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<pre><code class=\"prism language-javascript\">    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>build<span class=\"token punctuation\">.</span>assetsRoot<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">assetsPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js/[name].[chunkhash].js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">assetsPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js/[id].[chunkhash].js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">publicPath</span><span class=\"token operator\">:</span> <span class=\"token string\">'/dirc/'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</code></pre>\n<p>4.在 config/dev.formal.env.js 中（没有该文件的话创建），更改</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token string\">'use strict'</span>\n<span class=\"token keyword\">const</span> merge <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'webpack-merge'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> prodEnv <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./prod.env'</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>prodEnv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token constant\">NODE_ENV</span><span class=\"token operator\">:</span> <span class=\"token string\">'\"newFormal\"'</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//process.env.NODE_ENV</span>\n<span class=\"token comment\">//就可以获取到定义的值-newFormal，用来更改不同环境的接口地址</span>\n</code></pre>\n<p>5.在 package.json 文件里面，最后进行操作</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token string-property property\">\"dev:formal\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"webpack-dev-server --host 0.0.0.0 --inline --progress --config build/webpack.dev.formal.conf.js\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string-property property\">\"build:formal\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node build/build.formal.js\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">//最后一个定义的不需要加逗号</span>\n</code></pre>\n<h2><a id=\"12_53\"></a>1.2打包文件名</h2>\n<p>在config/index.js</p>\n<pre><code class=\"prism language-javascript\"> <span class=\"token literal-property property\">build</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token comment\">// Template for index.html</span>\n        <span class=\"token comment\">//更改此处</span>\n        <span class=\"token literal-property property\">index</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../dirc/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token comment\">//更改此处</span>\n        <span class=\"token literal-property property\">assetsRoot</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../dirc'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">assetsSubDirectory</span><span class=\"token operator\">:</span> <span class=\"token string\">'static'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">assetsPublicPath</span><span class=\"token operator\">:</span> <span class=\"token string\">'./'</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token literal-property property\">productionSourceMap</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">devtool</span><span class=\"token operator\">:</span> <span class=\"token string\">'#source-map'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">productionGzip</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">productionGzipExtensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'css'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token literal-property property\">bundleAnalyzerReport</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span>npm_config_report\n    <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>2.在 build/webpack.prod.formal.conf.js中，更改</p>\n<pre><code class=\"prism language-javascript\">    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>build<span class=\"token punctuation\">.</span>assetsRoot<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">assetsPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js/[name].[chunkhash].js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">assetsPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js/[id].[chunkhash].js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">publicPath</span><span class=\"token operator\">:</span> <span class=\"token string\">'/dirc/'</span><span class=\"token comment\">//更改此处</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</code></pre>\n<h1><a id=\"2vue3_85\"></a>2.vue3打包</h1>\n<ol><li>配置打包文件名，和development下的前端代理</li></ol>\n<pre><code class=\"prism language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token literal-property property\">publicPath</span><span class=\"token operator\">:</span> <span class=\"token string\">'./'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">outputDir</span><span class=\"token operator\">:</span> <span class=\"token string\">'dirc'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">assetsDir</span><span class=\"token operator\">:</span> <span class=\"token string\">'static'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">lintOnSave</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">'development'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">productionSourceMap</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">devServer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> port<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">open</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">proxy</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token string-property property\">'/dev-api'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">'http://192.111.11.11:8080'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">ws</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// // 是否启用websockets</span>\n                <span class=\"token literal-property property\">changeOrigin</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 开启代理：在本地会创建一个虚拟服务端，然后发送请求的数据，并同时接收请求的数据，这样服务端和服务端进行数据的交互就不会有跨域问题</span>\n                <span class=\"token comment\">// secure: false,</span>\n                <span class=\"token literal-property property\">pathRewrite</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token string-property property\">'^/dev-api'</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<ol start=\"2\"><li>在目录下 .env.development 文件中</li></ol>\n<pre><code class=\"prism language-javascript\"># just a flag\n<span class=\"token constant\">ENV</span> <span class=\"token operator\">=</span> <span class=\"token string\">'development'</span>\n\n# base api\n<span class=\"token constant\">VUE_APP_BASE_API</span> <span class=\"token operator\">=</span> <span class=\"token string\">'/dev-api'</span>\n</code></pre>\n<ol start=\"3\"><li>在目录下 新建文件.env.formal</li></ol>\n<pre><code class=\"prism language-javascript\"><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">=</span> formal\n\n# just a flag\n<span class=\"token constant\">ENV</span> <span class=\"token operator\">=</span> <span class=\"token string\">'formal'</span>\n\n# base api\n<span class=\"token constant\">VUE_APP_BASE_API</span> <span class=\"token operator\">=</span> <span class=\"token string\">' http://10.111.111.11:8080'</span>\n#全局获取此处定义的ip地址\n#process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">VUE_APP_BASE_API</span>\n</code></pre>\n<ol start=\"4\"><li>在src/utils/request.js文件中设置调用接口的地址</li></ol>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token literal-property property\">baseURL</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">VUE_APP_BASE_API</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// url = base url + request url</span>\n    <span class=\"token literal-property property\">timeout</span><span class=\"token operator\">:</span> <span class=\"token number\">500000000</span> <span class=\"token comment\">// request timeout</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<ol start=\"5\"><li>在package.json问价里面进行配置，就可以使用了</li></ol>\n<pre><code class=\"prism language-javascript\"><span class=\"token string-property property\">\"formal\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vue-cli-service serve --mode formal\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string-property property\">\"build:formal\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vue-cli-service build --mode formal\"</span><span class=\"token punctuation\">,</span>\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}