{"blogid": "125790367", "writerAge": "码龄1年", "writerBlogNum": "12", "writerCollect": "45", "writerComment": "39", "writerFan": "772", "writerGrade": "2级", "writerIntegral": "218", "writerName": "灰星球大大怪", "writerProfileAdress": "writer_image\\profile_125790367.jpg", "writerRankTotal": "59546", "writerRankWeekly": "8469", "writerThumb": "29", "writerVisitNum": "9768", "blog_read_count": "1321", "blog_time": "已于 2022-07-14 23:13:59 修改", "blog_title": "瑞数5药监局js逆向", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>本次网址：www.nmpa.gov.cn</p>\n<p><img alt=\"\" height=\"104\" src=\"image\\ae8f32fc8b54450dae0ea27a3b22f2ed.png\" width=\"745\"/></p>\n<p></p>\n<p>这是最后一篇四代五代瑞数的文章了，环境的话拿维普期刊的环境跑，稍微改下就能用，不会补的话看四代房地产的文章。 </p>\n<p>药监局的cook有效期有一段时效，拿到第二个ts也就是6000多行vm生成的cook，可以一直使用；</p>\n<p>无线debufgger右键跳过加个for (let i = 1; i &lt; 99999; i++) window.clearInterval(i);</p>\n<p>获取流程;</p>\n<p>从首页进来只需要获取ts生成的cook跟202页面返回的俩cook，然后点击药品查询，会进入到搜索页面，也就是<a href=\"https://www.nmpa.gov.cn/datasearch/home-index.html#category=yp\" title=\"https://www.nmpa.gov.cn/datasearch/home-index.html#category=yp\">https://www.nmpa.gov.cn/datasearch/home-index.html#category=yp</a>，</p>\n<p><img alt=\"\" height=\"883\" src=\"image\\50f2b4028e134764bf23119c41df6e29.png\" width=\"1200\"/></p>\n<p> 按原网页流程走的话，如果直接从搜索页面药品查询开始的话需要带上后缀跟sign，</p>\n<p>从首页进来的话只需要带上两个服务器返回的cook跟第二个ts也就是6000行vm生成的cook和sign就能访问；</p>\n<p>第一次202页面获取的ts生成一万两千行的vm，然后得到151位的cookie</p>\n<p><img alt=\"\" height=\"887\" src=\"image\\2092ed43798f44e593c9ba936357dcca.png\" width=\"1200\"/></p>\n<p> 随后跳过断点，进入到200页面，触发load事件，使cook添加了</p>\n<p>.$_f0</p>\n<p>$_f1</p>\n<p>$_fh1这三个指纹，可以打load断点看具体生成。load事件创建了canvas，然后取</p>\n<pre>toDataURL方法，然后用了canvas下的getContext方法又创建了2d跟webgl两个对象取参数进行加密，打事件断点load可以看到，补的话也很好补\n</pre>\n<p><img alt=\"\" height=\"340\" src=\"image\\9f6370a9b61e41fab47d303d13e97719.png\" width=\"1086\"/></p>\n<p> </p>\n<p><img alt=\"\" height=\"165\" src=\"image\\9dd812fd8d6645a7b553ccac49964337.png\" width=\"1200\"/></p>\n<p></p>\n<p><img alt=\"\" height=\"858\" src=\"image\\a2d875877b284956a1171bb08841fa1a.png\" width=\"1200\"/></p>\n<p> 添加完指纹后cook长度就变成258位了，指纹随机就可以并发。</p>\n<p></p>\n<p>搜索页面的cook是321位的，在首页所有内容加载完后，点击搜索触发新的事件，为cook里面添加了轨迹，258位的cook就能正常访问数据，也不用追求完美321位的cook</p>\n<p><img alt=\"\" height=\"816\" src=\"image\\01b9beaef41d4878a4f31820ec804c5f.png\" width=\"1200\"/></p>\n<p> sign的参数是页面加个时间搓跟搜索接口的id，打xhr断点，搜sign直接能找到，是个md5加密</p>\n<p><img alt=\"\" height=\"630\" src=\"image\\79c31c2e291c4ee8961ba95b7a30a27d.png\" width=\"1200\"/></p>\n<p> <img alt=\"\" height=\"924\" src=\"image\\aa4805b7ac7445d4953d2744878e3e73.png\" width=\"1200\"/></p>\n<p> 请求时首页6000行vm生成的cook可以用一段时间，6000行vm逻辑与第一次ts一万两千行的vm相同，只需要每次刷新sign就可以正常访问</p>\n<p><img alt=\"\" height=\"874\" src=\"image\\f694e70cd05d4eccbf7b4a6ce3222d54.png\" width=\"1200\"/></p>\n<p></p>\n</div>\n</div>"}