{"blogid": "125830177", "writerAge": "码龄5年", "writerBlogNum": "367", "writerCollect": "13447", "writerComment": "5162", "writerFan": "30916", "writerGrade": "7级", "writerIntegral": "17124", "writerName": "IT邦德", "writerProfileAdress": "writer_image\\profile_125830177.jpg", "writerRankTotal": "469", "writerRankWeekly": "27", "writerThumb": "6589", "writerVisitNum": "1255520", "blog_read_count": "4418", "blog_time": "已于 2022-07-17 13:06:56 修改", "blog_title": "【云原生】-Docker容器迁移Oracle到MySQL", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-github-gist\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p>📢📢📢📣📣📣<br/> 哈喽！大家好，我是【IT邦德】，江湖人称jeames007，10年DBA工作经验<br/> 一位上进心十足的【大数据领域博主】！😜😜😜<br/> 中国DBA联盟(ACDU)成员，目前从事DBA及程序编程<br/> 擅长主流数据Oracle、MySQL、PG 运维开发，备份恢复，安装迁移，性能优化、故障应急处理等。<br/> ✨ 如果有对【数据库】感兴趣的【小可爱】，欢迎关注【IT邦德】💞💞💞<br/> ❤️❤️❤️感谢各位大可爱小可爱！❤️❤️❤️</p>\n</blockquote>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#_11\">前言</a></li><li><ul><li><a href=\"#_1__17\">⛳️ 1. 创建专用网络</a></li><li><a href=\"#_2_Oracle_12C_22\">⛳️ 2. Oracle 12C部署</a></li><li><ul><li><a href=\"#_21__23\">✨ 2.1 镜像下载</a></li><li><a href=\"#_22__27\">✨ 2.2 容器创建</a></li><li><a href=\"#_23__35\">✨ 2.3 创建业务用户</a></li><li><a href=\"#_24__54\">✨ 2.4 监听启动</a></li></ul>\n</li><li><a href=\"#_3_MySQL8_76\">⛳️ 3. MySQL8部署</a></li><li><ul><li><a href=\"#_31__77\">✨ 3.1 容器创建</a></li><li><a href=\"#_32__92\">✨ 3.2 参数设置</a></li><li><a href=\"#_33_MySQL_104\">✨ 3.3 登陆MySQL</a></li></ul>\n</li><li><a href=\"#_4_kettleOracleMySQL_109\">⛳️ 4. kettle迁移Oracle到MySQL</a></li><li><ul><li><a href=\"#41_kettle_110\">✨4.1 部署kettle</a></li><li><a href=\"#42_Oracle_157\">✨4.2 Oracle端数据校验</a></li><li><a href=\"#43_OracleMySQL_185\">✨4.3 迁移Oracle到MySQL</a></li><li><a href=\"#44_MySQL_197\">✨4.4 迁移后MySQL数据验证</a></li></ul>\n</li></ul>\n</li></ul>\n</div>\n<p></p>\n<h1><a id=\"_11\"></a>前言</h1>\n<font color=\"#999AAA\"> Kettle是开源的 【TEL】 工具，JVAV编写，可以运行在多个平台，使用时有图形界面、命令脚本，还可以二次开发。用于数据抽取、转存等，非常方便 </font>\n<hr color=\"#000000\" size='1\"'/>\n<h2><a id=\"_1__17\"></a>⛳️ 1. 创建专用网络</h2>\n<blockquote>\n<p>docker network create --subnet=168.66.6.0/24 db-network<br/> [root@docker ~]# docker network inspect db-network --查看网络信息</p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\b57fe7ad730740e1963ade687d937b1c.png\"/></p>\n<h2><a id=\"_2_Oracle_12C_22\"></a>⛳️ 2. Oracle 12C部署</h2>\n<h3><a id=\"_21__23\"></a>✨ 2.1 镜像下载</h3>\n<blockquote>\n<p>docker pull registry.cn-shanghai.aliyuncs.com/techerwang/oracle:ora12c_12201</p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\daed4e826610454684b0a5d2dacf8493.png\"/></p>\n<h3><a id=\"_22__27\"></a>✨ 2.2 容器创建</h3>\n<blockquote>\n<p>docker run -itd --name jemora1221 -h jemora1221 <br/> –net=db-network --ip 168.66.6.34 <br/> -p 1526:1521 -p 3396:3389 <br/> –privileged=true <br/> registry.cn-shanghai.aliyuncs.com/techerwang/oracle:ora12c_12201 init</p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\a9a5c227c6924f47b2d3eb01b6ce7bfd.png\"/></p>\n<h3><a id=\"_23__35\"></a>✨ 2.3 创建业务用户</h3>\n<pre><code class=\"prism language-sql\"><span class=\"token punctuation\">[</span>root<span class=\"token variable\">@jeames</span> <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span><span class=\"token comment\"># docker exec -it jemora1221 bash</span>\n<span class=\"token punctuation\">[</span>root<span class=\"token variable\">@jemora1221</span> <span class=\"token operator\">/</span><span class=\"token punctuation\">]</span><span class=\"token comment\"># su - oracle</span>\n<span class=\"token punctuation\">[</span>oracle<span class=\"token variable\">@jemora1221</span> <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span>$ sqlplus <span class=\"token operator\">/</span> <span class=\"token keyword\">as</span> sysdba\nSYS<span class=\"token variable\">@jem</span><span class=\"token operator\">&gt;</span> startup\nSYS<span class=\"token variable\">@jem</span><span class=\"token operator\">&gt;</span> <span class=\"token keyword\">show</span> pdbs\n    CON_ID CON_NAME                       <span class=\"token keyword\">OPEN</span> <span class=\"token keyword\">MODE</span>  RESTRICTED\n<span class=\"token comment\">---------- ------------------------------ ---------- ----------</span>\n         <span class=\"token number\">2</span> PDB$SEED                       <span class=\"token keyword\">READ</span> ONLY  <span class=\"token keyword\">NO</span>\n         <span class=\"token number\">3</span> JEMPDB                         MOUNTED\n<span class=\"token keyword\">alter</span> pluggable <span class=\"token keyword\">database</span> JEMPDB <span class=\"token keyword\">open</span><span class=\"token punctuation\">;</span>\nSYS<span class=\"token variable\">@jem</span><span class=\"token operator\">&gt;</span> <span class=\"token keyword\">select</span> con_id<span class=\"token punctuation\">,</span>dbid<span class=\"token punctuation\">,</span>NAME<span class=\"token punctuation\">,</span>OPEN_MODE <span class=\"token keyword\">from</span> v$pdbs<span class=\"token punctuation\">;</span>\nSYS<span class=\"token variable\">@jem</span><span class=\"token operator\">&gt;</span> <span class=\"token keyword\">alter</span> <span class=\"token keyword\">session</span> <span class=\"token keyword\">set</span> container<span class=\"token operator\">=</span>JEMPDB<span class=\"token punctuation\">;</span>\nSYS<span class=\"token variable\">@jem</span><span class=\"token operator\">&gt;</span> <span class=\"token keyword\">create</span> <span class=\"token keyword\">user</span> jemmes identified <span class=\"token keyword\">by</span> jemmes\nSYS<span class=\"token variable\">@jem</span><span class=\"token operator\">&gt;</span> <span class=\"token keyword\">GRANT</span> DBA <span class=\"token keyword\">to</span> jemmes <span class=\"token punctuation\">;</span>\n</code></pre>\n<h3><a id=\"_24__54\"></a>✨ 2.4 监听启动</h3>\n<pre><code class=\"prism language-sql\"><span class=\"token punctuation\">[</span>oracle<span class=\"token variable\">@jemora1221</span> <span class=\"token operator\">~</span><span class=\"token punctuation\">]</span>$ cd $ORACLE_HOME<span class=\"token operator\">/</span>network\n<span class=\"token punctuation\">[</span>oracle<span class=\"token variable\">@jemora1221</span> network<span class=\"token punctuation\">]</span>$ cd admin\n\n<span class=\"token comment\">## 配置TNS，后续连接数据库</span>\n<span class=\"token punctuation\">[</span>oracle<span class=\"token variable\">@jemora1221</span> admin<span class=\"token punctuation\">]</span>$ vi tnsnames<span class=\"token punctuation\">.</span>ora\nJEMPDB <span class=\"token operator\">=</span>\n <span class=\"token punctuation\">(</span>DESCRIPTION <span class=\"token operator\">=</span>\n <span class=\"token punctuation\">(</span>ADDRESS <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>PROTOCOL <span class=\"token operator\">=</span> TCP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>HOST <span class=\"token operator\">=</span> jemora1221<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>PORT <span class=\"token operator\">=</span> <span class=\"token number\">1521</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">(</span>CONNECT_DATA <span class=\"token operator\">=</span>\n <span class=\"token punctuation\">(</span>SERVER <span class=\"token operator\">=</span> DEDICATED<span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">(</span>SERVICE_NAME <span class=\"token operator\">=</span> JEMPDB<span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">)</span>\n \n <span class=\"token comment\">## 监听启动</span>\nlsnrctl <span class=\"token keyword\">start</span>\nlsnrctl <span class=\"token keyword\">status</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\e90217d2166a44e59dc9413453758687.png\"/></p>\n<h2><a id=\"_3_MySQL8_76\"></a>⛳️ 3. MySQL8部署</h2>\n<h3><a id=\"_31__77\"></a>✨ 3.1 容器创建</h3>\n<blockquote>\n<p>docker run -d --name mysql8027 -h mysql8027 -p 3418:3306 <br/> –net=db-network --ip 168.66.6.35 <br/> -v /etc/mysql/mysql8027/conf:/etc/mysql/conf.d <br/> -e MYSQL_ROOT_PASSWORD=jeames -e TZ=Asia/Shanghai <br/> mysql:8.0.27</p>\n</blockquote>\n<blockquote>\n<p>查看容器<br/> [root@jeames ~]# docker ps --format “table {<!-- -->{.ID}}\\t{<!-- -->{.Names}}\\t{<!-- -->{.Status}}”<br/> CONTAINER ID NAMES STATUS<br/> 043d1652404d jemora1221 Up 7 minutes<br/> dc2989508b67 mysql8027 Up 23 seconds<br/> 7e6a53d71017 centos7.8 Up 20 minutes</p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\7d70524552b1473e983ed5b4abcfff73.png\"/></p>\n<h3><a id=\"_32__92\"></a>✨ 3.2 参数设置</h3>\n<blockquote>\n<p>cat &gt; /etc/mysql/mysql8027/conf/my.cnf &lt;&lt; “EOF”<br/> [mysqld]<br/> default-time-zone = ‘+8:00’<br/> log_timestamps = SYSTEM<br/> skip-name-resolve<br/> log-bin<br/> server_id=80273418<br/> character_set_server=utf8mb4<br/> default_authentication_plugin=mysql_native_password<br/> EOF</p>\n</blockquote>\n<h3><a id=\"_33_MySQL_104\"></a>✨ 3.3 登陆MySQL</h3>\n<blockquote>\n<p>mysql -uroot -pjeames -h 168.66.6.35<br/> create database jemdb;</p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\91a0f05c4fd24810a6d1c629a8753d9d.png\"/></p>\n<h2><a id=\"_4_kettleOracleMySQL_109\"></a>⛳️ 4. kettle迁移Oracle到MySQL</h2>\n<h3><a id=\"41_kettle_110\"></a>✨4.1 部署kettle</h3>\n<blockquote>\n<p>Kettle是一款国外开源的ETL工具，纯java编写，可以在Window、Linux、Unix上运行.<br/> Kettle 中文名称叫水壶，该项目的主程序员MATT 希望把各种数据放到一个壶里，然后以一种指定的格式流出。Kettle这个ETL工具集，它允许你管理来自不同数据库的数据，通过提供一个图形化的用户环境来描述你想做什么，而不是你想怎么做。Kettle中有两种脚本文件，transformation和job，transformation完成针对数据的基础转换，job则完成整个工作流的控制。</p>\n</blockquote>\n<p>📢📢📢 kettle的组成<br/> <img alt=\"在这里插入图片描述\" src=\"image\\2c10c71fff944cd592e6fe9f7215913b.png\"/></p>\n<blockquote>\n<p>整个流程一共分为两步：一是安装JAVA环境；二是下载kettle的安装包</p>\n</blockquote>\n<p>📢📢📢 安装AVA JDK</p>\n<p>下载jdk安装包后打开文件开始安装<br/> <img alt=\"在这里插入图片描述\" src=\"image\\010b8c9e7419469bb502faa2d34f81fb.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\cfae0f69766b49fbb3dbd925357f42e1.png\"/></p>\n<blockquote>\n<p>添加以下3个变量<br/> 【1】JAVA_HOME：刚刚Java安装的路径，我的是：C:\\Program Files\\Java\\jdk1.8.0_231<br/> 【2】CLASSPATH：.;%JAVA_HOME%\\lib\\dt.jar;%JAVA_HOME%\\lib\\tools.jar;<br/> 【3】配置环境变量Path<br/> 双击Path，添加“%JAVA_HOME%\\bin”；添加“%JAVA_HOME%\\jre\\bin”。<br/> Win+R键弹出运行窗口，输入cmd，回车运行<br/> 分别输入“java -version”，“javac”进行测试，显示以下内容说明配置成功</p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\48e67611dea649e681a041063274d56a.png\"/><br/> 📢📢📢 下载kettle安装包</p>\n<p>这里我们选择7.1版本<br/> <img alt=\"在这里插入图片描述\" src=\"image\\e80f59b59b1748ac919ea480d491e5ef.png\"/><br/> 下载完成解压到任意路径，打开文件夹，找到Spoon.bat，创建桌面快捷方式，打开<br/> <img alt=\"在这里插入图片描述\" src=\"image\\2972f6c293474c6e839267c19ddbc53a.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\4df1fdd1b1a9404d8e4d4cff931e4ff9.png\"/><br/> 📢📢📢 数据库驱动包下载</p>\n<blockquote>\n<p>将mysql驱动和oracle驱动放在kettle包下面的lib包下面即可。<br/> MySQL JDBC 驱动下载<br/> 文件后缀名为 .tar.gz 的是Linux/IOS的压缩包；后缀为 .zip 的是Windows下的压缩包，<br/> 根据系统选择下载。<br/> 下载这个版本即可：mysql-connector-java-5.1.49-bin.jar<br/> Oracle JDBC 驱动下载<br/> <img alt=\"在这里插入图片描述\" src=\"image\\9797cd4f40874a5ca56fe3ae35f8b501.png\"/><br/> 📢📢📢 数据库连接</p>\n</blockquote>\n<p>A.建立转换<br/> 在文件-&gt;新建装换，新建转换后在左边的主对象树中建立DB连接用以连接数据库</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\2575c62768e8420f86df79fcc9547e97.png\"/><br/> B.数据库连接MySQL<br/> <img alt=\"在这里插入图片描述\" src=\"image\\57bf4a732c1f42938959fd25a50fb7ef.png\"/><br/> C.数据库连接Oracle 12C<br/> <img alt=\"在这里插入图片描述\" src=\"image\\3636bd322c5b4230a02d66a7d6910cda.png\"/></p>\n<h3><a id=\"42_Oracle_157\"></a>✨4.2 Oracle端数据校验</h3>\n<pre><code class=\"prism language-sql\"><span class=\"token comment\">## 创建测试表</span>\n SYS<span class=\"token variable\">@jem</span><span class=\"token operator\">&gt;</span> conn jemmes<span class=\"token operator\">/</span>jemmes<span class=\"token variable\">@JEMPDB</span>    \n@<span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>oracle<span class=\"token operator\">/</span>demo_ora_create<span class=\"token punctuation\">.</span><span class=\"token keyword\">sql</span>\n@<span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>oracle<span class=\"token operator\">/</span>demo_ora_insert<span class=\"token punctuation\">.</span><span class=\"token keyword\">sql</span>\n\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> flower<span class=\"token punctuation\">(</span>\n           id varchar2<span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span>  <span class=\"token keyword\">default</span> sys_guid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span><span class=\"token punctuation\">,</span>\n           flower_name varchar2<span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           color varchar2<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           origin varchar2<span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           moral varchar2<span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           create_time <span class=\"token keyword\">timestamp</span> <span class=\"token keyword\">default</span> sysdate<span class=\"token punctuation\">,</span>\n           update_time <span class=\"token keyword\">timestamp</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n JEMMES<span class=\"token variable\">@JEMPDB</span><span class=\"token operator\">&gt;</span> <span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> flower<span class=\"token punctuation\">(</span>flower_name<span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dd'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">--oracle所有表</span>\nJEMMES<span class=\"token variable\">@JEMPDB</span><span class=\"token operator\">&gt;</span> <span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> tab<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">--迁移前相关检查</span>\ncol TABLE_NAME format a30\n<span class=\"token keyword\">SELECT</span> a<span class=\"token punctuation\">.</span>table_name<span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">.</span>num_rows <span class=\"token keyword\">FROM</span> dba_tables a <span class=\"token keyword\">where</span> a<span class=\"token punctuation\">.</span>OWNER<span class=\"token operator\">=</span><span class=\"token string\">'JEMMES'</span> <span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">select</span> object_type<span class=\"token punctuation\">,</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">from</span> dba_objects <span class=\"token keyword\">where</span> owner<span class=\"token operator\">=</span><span class=\"token string\">'JEMMES'</span> <span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> object_type<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">select</span> object_type<span class=\"token punctuation\">,</span><span class=\"token keyword\">status</span><span class=\"token punctuation\">,</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">from</span> dba_objects <span class=\"token keyword\">where</span> owner<span class=\"token operator\">=</span><span class=\"token string\">'JEMMES'</span> <span class=\"token keyword\">group</span> <span class=\"token keyword\">by</span> object_type<span class=\"token punctuation\">,</span><span class=\"token keyword\">status</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">select</span> <span class=\"token function\">sum</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">1024</span><span class=\"token operator\">/</span><span class=\"token number\">1024</span> <span class=\"token keyword\">from</span> dba_segments <span class=\"token keyword\">where</span> owner<span class=\"token operator\">=</span><span class=\"token string\">'JEMMES'</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\aa38c8655b424ea082bc1f86b36e9a13.png\"/></p>\n<h3><a id=\"43_OracleMySQL_185\"></a>✨4.3 迁移Oracle到MySQL</h3>\n<p>复制多表<br/> <img alt=\"在这里插入图片描述\" src=\"image\\29d845ab25e0472c8c0837c46e4c25c9.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\9af76bc8a59e43dc8b9b7b6272249a7f.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\2357f40d4c3d47beafd2ebb1399bb54c.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\f37aab0717204fcc9d59120528c31185.png\"/><br/> 完成后，会自动生成如下的执行树：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\14e09b858a38479e99a0d56874319af1.png\"/><br/> 点击run，开始执行即可：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\a2d5c4936c9042e1a94ead14c3f7a586.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\ea01ca048fe340b3946ad8ac2c6ade8a.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\ce18b438492d4ef48a1648a5dd836f7d.png\"/></p>\n<h3><a id=\"44_MySQL_197\"></a>✨4.4 迁移后MySQL数据验证</h3>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\e9a8c80f5e874366b71a96de04ca4a64.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"https://img-blog.csdnimg.cn/8b6019518a4642bdb98d214830fef092.gif#pic_center\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}