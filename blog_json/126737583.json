{"blogid": "126737583", "writerAge": "码龄10年", "writerBlogNum": "194", "writerCollect": "29331", "writerComment": "9549", "writerFan": "59353", "writerGrade": "8级", "writerIntegral": "39536", "writerName": "小小明-代码实体", "writerProfileAdress": "writer_image\\profile_126737583.jpg", "writerRankTotal": "101", "writerRankWeekly": "196", "writerThumb": "20407", "writerVisitNum": "6705117", "blog_read_count": "809", "blog_time": "已于 2022-09-07 14:34:45 修改", "blog_title": "以深圳为例Python一键生成核酸检测日历", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p>📢作者： <strong>小小明-代码实体</strong></p>\n<p>📢博客主页：<a href=\"https://blog.csdn.net/as604049322\">https://blog.csdn.net/as604049322</a></p>\n<p>📢欢迎点赞 👍 收藏 ⭐留言 📝 欢迎讨论！</p>\n</blockquote>\n<p>大家好，我是小小明。鉴于深圳最近每天都要做核酸，我觉得有必要用程序生成自己的检测日历，方便查看。</p>\n<p>首先我们需要从<code>深i您-自主申报</code>的微信小程序中提取自己的核酸检测记录，然后使用绘图库自动绘制检测日历。</p>\n<h1><a id=\"UI_11\"></a>UI自动化提取检测记录</h1>\n<p>首先，我们在PC端微信打开<code>深i您-自主申报</code>微信小程序：</p>\n<p><img alt=\"image-20220907004822465\" src=\"image\\05eace95029e3c615ce060ed184630f7.png\"/></p>\n<p>点击 核酸检测记录，再点击自己的姓名即可查看自己的核酸检测记录：</p>\n<p><img alt=\"image-20220907004955288\" src=\"image\\8a68b3fdbf5e85248ad5efd8f288c3d3.png\"/></p>\n<p>下面我们打开<code>inspect.exe</code>工具分析查看节点：</p>\n<p><img alt=\"image-20220907005130425\" src=\"image\\a2526b6a4399fad756dd0a1d538149e6.png\"/></p>\n<p>于是开始编码：</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n<span class=\"token keyword\">import</span> uiautomation <span class=\"token keyword\">as</span> auto\n\npane <span class=\"token operator\">=</span> auto<span class=\"token punctuation\">.</span>PaneControl<span class=\"token punctuation\">(</span>searchDepth<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Name<span class=\"token operator\">=</span><span class=\"token string\">\"深i您 - 自主申报\"</span><span class=\"token punctuation\">)</span>\npane<span class=\"token punctuation\">.</span>SetActive<span class=\"token punctuation\">(</span>waitTime<span class=\"token operator\">=</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span>\npane<span class=\"token punctuation\">.</span>SetTopmost<span class=\"token punctuation\">(</span>waitTime<span class=\"token operator\">=</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span>\n\ntags <span class=\"token operator\">=</span> pane<span class=\"token punctuation\">.</span>GetFirstChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>GetFirstChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token punctuation\">.</span>GetLastChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>GetFirstChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token punctuation\">.</span>GetChildren<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nresult <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> tag <span class=\"token keyword\">in</span> tags<span class=\"token punctuation\">:</span>\n    tmp <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> item<span class=\"token punctuation\">,</span> depth <span class=\"token keyword\">in</span> auto<span class=\"token punctuation\">.</span>WalkControl<span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">,</span> maxDepth<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> item<span class=\"token punctuation\">.</span>ControlType <span class=\"token operator\">!=</span> auto<span class=\"token punctuation\">.</span>ControlType<span class=\"token punctuation\">.</span>TextControl<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">continue</span>\n        tmp<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span>\n    row <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"检测结果\"</span><span class=\"token punctuation\">:</span> tmp<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>tmp<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> tmp<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        row<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v\n    result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span>\npane<span class=\"token punctuation\">.</span>SetTopmost<span class=\"token punctuation\">(</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> waitTime<span class=\"token operator\">=</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span>\ndf <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\ndf<span class=\"token punctuation\">.</span>采样时间 <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>to_datetime<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">.</span>采样时间<span class=\"token punctuation\">)</span>\ndf<span class=\"token punctuation\">.</span>检测时间 <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>to_datetime<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">.</span>检测时间<span class=\"token punctuation\">)</span>\ndf<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>结果如下：</p>\n<p><img alt=\"image-20220907005308295\" src=\"image\\49269dcf2a28b5e154b028bfcc5bc469.png\"/></p>\n<p>有了检测数据，我们就可以生成检测日历了。也可以先将检测数据保存起来：</p>\n<pre><code class=\"prism language-python\">df<span class=\"token punctuation\">.</span>to_excel<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>pd<span class=\"token punctuation\">.</span>Timestamp<span class=\"token punctuation\">(</span><span class=\"token string\">'now'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">核酸检测记录.xlsx\"</span></span><span class=\"token punctuation\">,</span> index<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<blockquote>\n<p>注意：其他省市的童鞋，请根据自己城市对应的小程序实际情况编写代码进行提取。</p>\n<p>原本想抓包获取检测数据，却发现新版的PC端微信的小程序已经无法被抓包，暂时还未理解啥原理啥实现的。</p>\n</blockquote>\n<p>后面碰到正在检测的记录上面的代码会报错，分析节点后，下面升级到能够兼容出现检测记录的情况：</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n<span class=\"token keyword\">import</span> uiautomation <span class=\"token keyword\">as</span> auto\n\npane <span class=\"token operator\">=</span> auto<span class=\"token punctuation\">.</span>PaneControl<span class=\"token punctuation\">(</span>searchDepth<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Name<span class=\"token operator\">=</span><span class=\"token string\">\"深i您 - 自主申报\"</span><span class=\"token punctuation\">)</span>\npane<span class=\"token punctuation\">.</span>SetActive<span class=\"token punctuation\">(</span>waitTime<span class=\"token operator\">=</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span>\npane<span class=\"token punctuation\">.</span>SetTopmost<span class=\"token punctuation\">(</span>waitTime<span class=\"token operator\">=</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span>\n\ntag <span class=\"token operator\">=</span> pane<span class=\"token punctuation\">.</span>GetFirstChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>GetFirstChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token punctuation\">.</span>GetLastChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>GetFirstChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntmp <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> item<span class=\"token punctuation\">,</span> depth <span class=\"token keyword\">in</span> auto<span class=\"token punctuation\">.</span>WalkControl<span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">,</span> maxDepth<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> item<span class=\"token punctuation\">.</span>ControlType <span class=\"token operator\">!=</span> auto<span class=\"token punctuation\">.</span>ControlType<span class=\"token punctuation\">.</span>TextControl<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">continue</span>\n    tmp<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span>\nresult <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ntags <span class=\"token operator\">=</span> tag<span class=\"token punctuation\">.</span>GetChildren<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> tmp<span class=\"token punctuation\">:</span>\n    row <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"检测结果\"</span><span class=\"token punctuation\">:</span> tmp<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>tmp<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> tmp<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        row<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v\n    result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> tag <span class=\"token keyword\">in</span> tags<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> tag<span class=\"token punctuation\">.</span>Name <span class=\"token keyword\">or</span> tag<span class=\"token punctuation\">.</span>GetFirstChildControl<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">continue</span>\n    tmp <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> item<span class=\"token punctuation\">,</span> depth <span class=\"token keyword\">in</span> auto<span class=\"token punctuation\">.</span>WalkControl<span class=\"token punctuation\">(</span>tag<span class=\"token punctuation\">,</span> maxDepth<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> item<span class=\"token punctuation\">.</span>ControlType <span class=\"token operator\">!=</span> auto<span class=\"token punctuation\">.</span>ControlType<span class=\"token punctuation\">.</span>TextControl<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">continue</span>\n        tmp<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span>\n    row <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"检测结果\"</span><span class=\"token punctuation\">:</span> tmp<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>tmp<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> tmp<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        row<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> v\n    result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span>\npane<span class=\"token punctuation\">.</span>SetTopmost<span class=\"token punctuation\">(</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> waitTime<span class=\"token operator\">=</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span>\ndf <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\ndf<span class=\"token punctuation\">.</span>采样时间 <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>to_datetime<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">.</span>采样时间<span class=\"token punctuation\">)</span>\ndf<span class=\"token punctuation\">.</span>检测时间 <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>to_datetime<span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">.</span>检测时间<span class=\"token punctuation\">)</span>\ndf<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"image-20220907142944133\" src=\"image\\8c9ce4f9f9af834ac127da5a17ca1869.png\"/></p>\n<h1><a id=\"_115\"></a>生成核酸检测日历</h1>\n<p>经过几小时的测试，最终编写出如下方法：</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> calendar\n<span class=\"token keyword\">from</span> PIL <span class=\"token keyword\">import</span> Image<span class=\"token punctuation\">,</span> ImageFont<span class=\"token punctuation\">,</span> ImageDraw\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_calendar_img</span><span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">,</span> days<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token string\">\"作者：小小明 https://xxmdmst.blog.csdn.net\"</span>\n    font <span class=\"token operator\">=</span> ImageFont<span class=\"token punctuation\">.</span>truetype<span class=\"token punctuation\">(</span><span class=\"token string\">'msyh.ttc'</span><span class=\"token punctuation\">,</span> size<span class=\"token operator\">=</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    im <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span>mode<span class=\"token operator\">=</span><span class=\"token string\">'RGB'</span><span class=\"token punctuation\">,</span> size<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">505</span><span class=\"token punctuation\">,</span> <span class=\"token number\">251</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">\"white\"</span><span class=\"token punctuation\">)</span>\n    draw <span class=\"token operator\">=</span> ImageDraw<span class=\"token punctuation\">.</span>Draw<span class=\"token punctuation\">(</span>im<span class=\"token operator\">=</span>im<span class=\"token punctuation\">)</span>\n    draw<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">504</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> fill<span class=\"token operator\">=</span><span class=\"token string\">'#418CFA'</span><span class=\"token punctuation\">,</span> outline<span class=\"token operator\">=</span><span class=\"token string\">'black'</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    draw<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">(</span>xy<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">170</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>year<span class=\"token punctuation\">}</span></span><span class=\"token string\">年</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>month<span class=\"token punctuation\">}</span></span><span class=\"token string\">月\"</span></span><span class=\"token punctuation\">,</span> fill<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n              font<span class=\"token operator\">=</span>ImageFont<span class=\"token punctuation\">.</span>truetype<span class=\"token punctuation\">(</span><span class=\"token string\">'msyh.ttc'</span><span class=\"token punctuation\">,</span> size<span class=\"token operator\">=</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    title_datas <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'星期一'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'星期二'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'星期三'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'星期四'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'星期五'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'星期六'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'星期日'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> title_data <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>title_datas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        draw<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">*</span><span class=\"token number\">72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">70</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                       fill<span class=\"token operator\">=</span><span class=\"token string\">'lightblue'</span><span class=\"token punctuation\">,</span> outline<span class=\"token operator\">=</span><span class=\"token string\">'black'</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        draw<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">(</span>xy<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">*</span><span class=\"token number\">72</span><span class=\"token operator\">+</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span>title_data<span class=\"token punctuation\">,</span> fill<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                  font<span class=\"token operator\">=</span>font<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># 第一天是星期几和一个月的天数</span>\n    weekday<span class=\"token punctuation\">,</span> day_num <span class=\"token operator\">=</span> calendar<span class=\"token punctuation\">.</span>monthrange<span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">)</span>\n    col<span class=\"token punctuation\">,</span> row <span class=\"token operator\">=</span> weekday<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> day_num<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> col <span class=\"token operator\">&gt;=</span> <span class=\"token number\">7</span><span class=\"token punctuation\">:</span>\n            col <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n            row <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n        fill <span class=\"token operator\">=</span> <span class=\"token string\">\"#009B3C\"</span> <span class=\"token keyword\">if</span> i <span class=\"token keyword\">in</span> days <span class=\"token keyword\">else</span> <span class=\"token boolean\">None</span>\n        draw<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>col<span class=\"token operator\">*</span><span class=\"token number\">72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token operator\">+</span><span class=\"token number\">30</span><span class=\"token operator\">*</span>row<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>col<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token operator\">+</span><span class=\"token number\">30</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>row<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                       fill<span class=\"token operator\">=</span>fill<span class=\"token punctuation\">,</span> outline<span class=\"token operator\">=</span><span class=\"token string\">'black'</span><span class=\"token punctuation\">,</span> width<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        draw<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">(</span>xy<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>col<span class=\"token operator\">*</span><span class=\"token number\">72</span><span class=\"token operator\">+</span><span class=\"token number\">24</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token operator\">+</span><span class=\"token number\">30</span><span class=\"token operator\">*</span>row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> text<span class=\"token operator\">=</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>zfill<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> fill<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                  font<span class=\"token operator\">=</span>font<span class=\"token punctuation\">)</span>\n        col <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">return</span> im\n</code></pre>\n<p>然后我们可以生成最近1-3个月的核酸检测日历：</p>\n<pre><code class=\"prism language-python\">dates <span class=\"token operator\">=</span> df<span class=\"token punctuation\">.</span>采样时间<span class=\"token punctuation\">.</span>dt<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">.</span>sort_values<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> month<span class=\"token punctuation\">,</span> date_split <span class=\"token keyword\">in</span> dates<span class=\"token punctuation\">.</span>groupby<span class=\"token punctuation\">(</span>dates<span class=\"token punctuation\">.</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    year<span class=\"token punctuation\">,</span> month <span class=\"token operator\">=</span> <span class=\"token builtin\">map</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    days <span class=\"token operator\">=</span> date_split<span class=\"token punctuation\">.</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span>\n    im <span class=\"token operator\">=</span> create_calendar_img<span class=\"token punctuation\">(</span>year<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">,</span> days<span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">)</span>\n    display<span class=\"token punctuation\">(</span>im<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"image-20220907010248874\" src=\"image\\fc297b502912e32485b934ae11a88008.png\"/></p>\n<p>可以看到我最近连续9天都是每天做一次核酸。</p>\n<p>如果有需要，这些图片也可以按需保存：</p>\n<pre><code class=\"prism language-python\">im<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>year<span class=\"token punctuation\">}</span></span><span class=\"token string\">年</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>month<span class=\"token punctuation\">}</span></span><span class=\"token string\">月检测记录.jpg\"</span></span><span class=\"token punctuation\">)</span>\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}