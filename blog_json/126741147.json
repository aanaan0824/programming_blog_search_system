{"blogid": "126741147", "writerAge": "码龄7年", "writerBlogNum": "82", "writerCollect": "158", "writerComment": "76", "writerFan": "188", "writerGrade": "5级", "writerIntegral": "2276", "writerName": "qq_540616979", "writerProfileAdress": "writer_image\\profile_126741147.jpg", "writerRankTotal": "9662", "writerRankWeekly": "44863", "writerThumb": "105", "writerVisitNum": "699009", "blog_read_count": "37", "blog_time": "已于 2022-09-07 13:40:03 修改", "blog_title": "进程管理PV信号量购书店题详解", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>有小伙伴要考软设证,遇到个PV信号量的问题,没整的很明白,网上各种都说的云里雾里,这里一起研究下,题目如下:</p>\n<h2><a id=\"_2\"></a>题目</h2>\n<p><strong>某书店有一个收银员该书店最多允许n个购书者进入。将收银员和购书者看作不同的进程，其工作流程如下图所示。利用PV操作实现该过程，设置信号量S1,S2和Sn,初值分别为0，0，n.则图中a1,a2及b1,b2应该填入?</strong><br/> <img alt=\"在这里插入图片描述\" src=\"image\\c442becfa35f49ca8be0cf50e053069f.png\"/></p>\n<h2><a id=\"SPV_7\"></a>简单说下信号量S,跟PV操作</h2>\n<p><strong>信号量s</strong>:一般代表当前某类型资源(或者某种条件)可被进程同时操作的数量,如果小于0则代表操作该信号量类型的进程应该被挂起等待,大于或等于0则能继续执行<br/> <strong>P操作</strong>:表示申请一个信号量资源,会将信号量S-1,然后判断S,小于0则挂起等待<br/> <strong>V操作</strong>:表示释放一个信号量资源,会将信号量S+1,并且唤醒其他等待该信号的线程</p>\n<h2><a id=\"_13\"></a>题目解析</h2>\n<p>这个题目不好理解,原因有下面几个<br/> <strong>1:整个购书流程不清楚</strong>,是先收银还是先付款这个流程很关键,但这里没有说明<br/> eg:流程1:进店-&gt;购书-&gt;收银-&gt;付款-&gt;离开<br/> 流程2:进店-&gt;购书-&gt;准备付款-&gt;收银-&gt;离开<br/> 不同的流程,导致触发的操作会有不一致</p>\n<p><strong>2:资源不清晰</strong>,这里信号量代表的临界资源不清晰,刚看题目很容易认为付款人是临界资源,因为同时只允许一个人付款,这里有2个信号量,正常是有2个临界资源,但S1,S2各代表哪边的资源也没有清晰指定</p>\n<p><strong>3:这个题目的解不一定是唯一</strong>的,也就是说要达到线程同步,可能有多种方式可以做到,甚至有时用一个信号量也可以(不是说这题用一个就可以),信号量的设计,使用是很灵活的;<br/> 以上3点综合起来,让这个题目很迷…一时间真不好理解,好的是,它是个选择题,可以从选项排除</p>\n<h2><a id=\"_26\"></a>解题思路</h2>\n<p><strong>1:这里Sn 的使用是很清楚的,进店-&gt;出店,所以选项里带sn 操作的肯定可以排除了</strong></p>\n<p><strong>2:信号量操作很关键的点就是,线程唤起做操作前一定是需要做P操作的,不然这个资源就可能被无限线程操作,所以对b1来说一定是个P操作,(选项排除sn 也只剩P 操作选项了…),同样对a1,a2 中一定有个P操作,表示付款进程占据了资源,很显然就是不能上来就P操作,因为s1,s2初始信号量都为0,上来P操作线程就直接挂起了,后面所有流程也就没有了(因为b那边肯定是P操作了),即a1是V,a2是P,这里可以得到1的答案为A,从选项可以看出S1代表付款资源,S2代表收银资源,所有b1操作肯定是P(s2),得到2的答案为C</strong></p>\n<h2><a id=\"_31\"></a>完整详解</h2>\n<p><strong>1:完整流程</strong><br/> 题目真正的流程是:<br/> <strong>进店-&gt;购书-&gt;进入付款区域-&gt;收银-&gt;离开</strong></p>\n<p><strong>2:临界资源</strong><br/> <strong>A:进入付款区域这个条件,每次只能一个顾客进入</strong><br/> <strong>B:可以理解为收银机,同时只能有一个人操作收银机</strong><br/> <mark><strong>这里要把进入付款跟收银看为一个整体,即能进入付款区就必定能被收银员收银</strong></mark>;</p>\n<p>所以整个流程也很清晰了<br/> 顾客进入付款区后需要做2件事<br/> <strong>1:通知收银员(释放收银机权限/钥匙)=&gt;V操作<br/> 2:阻止其他人进入=&gt;P操作</strong><br/> 并且这2件事之间应该是原子性的,否则付款区域就可能被其他人进来了,严格来说我认为这里应该先阻止其他人进入等待区即先P操作后在给钥匙给收银员,但是题目限制初始信号量为0,先P操作后面就被挂起了,所有说信号量的设计跟使用是很灵活的,可以有其他很多方式也能达到目的,这里只能以题目进行<br/> 收银员收到信息后开始收银,此时<strong>他需要保证其他人员不能再用这个收银机</strong>收银了即 P操作,等收银完成,<strong>需要通知排队区域让下一个顾客进入付款区</strong>即 V操作</p>\n<h2><a id=\"_49\"></a>总结</h2>\n<p><strong>1:一般信号量S都会代表某个临界资源或者限制条件<br/> 2:信号量的使用跟程序流程是密切相关的,设计前一定要理解好流程<br/> 3:信号量使用是非常灵活的,可以有多个方式达到相同目的,一切以题目为中心</strong></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}