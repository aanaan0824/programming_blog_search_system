{"blogid": "122686212", "writerAge": "码龄16年", "writerBlogNum": "395", "writerCollect": "957", "writerComment": "221", "writerFan": "16424", "writerGrade": "6级", "writerIntegral": "4790", "writerName": "java编程艺术", "writerProfileAdress": "writer_image\\profile_122686212.jpg", "writerRankTotal": "3298", "writerRankWeekly": "376", "writerThumb": "298", "writerVisitNum": "437805", "blog_read_count": "12187", "blog_time": "已于 2022-01-26 13:57:53 修改", "blog_title": "Python 图形界面框架 PySide6 使用及避坑指南", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>使用Python开发图形界面的软件其实并不多，相对于GUI界面，可能Web方式的应用更受人欢迎。但基于GUI做一些小工具，还是很实用的。</p>\n<p>在界面工具中，PySide6功能强大，与Pycharm相结合，可以满足各种变态与正常的需求。<br/> PySide6的界面目前为两种，一种是传统的QT Widgets，另一种是相对新颖的QML。</p>\n<p>本文演示了PySide6 的安装、配置、以天气预报示例演示了开发流程，对期间碰到的问题进行了梳理和总结。<br/> 环境信息是：Win10、PyCharm 2020.1、PySide6 6.2.2.1、PyInstaller 4.8、Python 3.7，基于QT Widgets设置图形界面。</p>\n<h1><a id=\"PySide6_8\"></a>安装PySide6</h1>\n<h2><a id=\"PySide6_9\"></a>安装PySide6</h2>\n<p><strong>Qt是一个跨平台的C++图形界面应用程序框架</strong>。<br/> 它提供给开发者建立图形用户界面所需的功能，广泛用于开发GUI程序，也可用于开发非GUI程序。<br/> Qt很容易扩展，并且允许真正地组件编程。<br/> 基本上，Qt同X Window上的Motif,Openwin,GTK等图形界面库以及Windows平台上的MFC、OWL、VCL、ATL是同类型的东西。</p>\n<ul><li>PySide6是来自于Qt for Python项目的官方Python模块，它提供了对完整Qt 6.0+框架的访问。</li><li>Qt Designer 拖拽式的界面设计工具：通过拖拽的方式放置控件，并实时查看控件效果进行快速UI设计</li><li>PyUIC：主要是把Qt Designer生成的.ui文件换成.py文件</li><li>PyRCC主要是把编写的.qrc资源文件换成.py文件</li></ul>\n<pre><code class=\"prism language-bash\">pip <span class=\"token function\">install</span> PySide6\n</code></pre>\n<p>安装的是最新版：6.2.2.1，已经包含了Qt Designer、PyUIC、PyRCC工具</p>\n<h2><a id=\"PyCharmExternal_Tools_24\"></a>PyCharm中配置External Tools</h2>\n<p>在 PyCharm中的External Tools中，配置下图的三个工具。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\08103a9d95f044e9b8e635977375c89e.png\"/></p>\n<h3><a id=\"QtDesigner_28\"></a>配置QtDesigner</h3>\n<ul><li>Name: <code>QtDesigner</code></li><li>Program : <code>D:\\program\\Anaconda3\\Scripts\\pyside6-designer.exe</code> # 请根据实际修改</li><li>Working directory: <code>$ProjectFileDir$</code><br/> <img alt=\"在这里插入图片描述\" src=\"image\\066630493d524e068377afde8f4306b3.png\"/></li></ul>\n<h3><a id=\"PyUIC_33\"></a>配置PyUIC</h3>\n<ul><li>Name: <code>PyUIC</code></li><li>Program : <code>D:\\program\\Anaconda3\\Scripts\\pyside6-uic.exe</code> # 请根据实际修改</li><li>Arguments：<code>$FileName$ -o $FileNameWithoutExtension$.py</code></li><li>Working directory: <code>$FileDir$</code><br/> <img alt=\"在这里插入图片描述\" src=\"image\\1d7e2c45fd9e4359bbaf721721d4b5f8.png\"/></li></ul>\n<h3><a id=\"PyRCC_39\"></a>配置PyRCC</h3>\n<ul><li>Name: <code>PyRCC</code></li><li>Program : <code>D:\\program\\Anaconda3\\Scripts\\pyside6-rcc.exe</code> # 请根据实际修改</li><li>Arguments：<code>$FileName$ -o $FileNameWithoutExtension$_rc.py</code></li><li>Working directory: <code>$FileDir$</code><br/> <img alt=\"在这里插入图片描述\" src=\"image\\862296fb31074b5088e8892a15bb9a52.png\"/></li></ul>\n<h1><a id=\"_45\"></a>使用示例</h1>\n<p>使用PySide6开发一个天气预报查询页面，通过选择广东不同的地市，查询不同地市的天气预报信息。</p>\n<p>代码结构如下：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\53efe2196b304bdbb40df2fa183589c9.png\"/></p>\n<h2><a id=\"QtDesigner_50\"></a>使用QtDesigner进行界面设计</h2>\n<p>整个画面的构成：</p>\n<ul><li>左侧的“Widget Box”就是各种可以自由拖动的组件</li><li>中间的“MainWindow – weather.ui”窗体就是画布</li><li>右上方的”Object Inspector”可以查看当前ui的结构</li><li>右侧中部的”Property Editor”可以设置当前选中组件的属性</li><li>右下方的”Resource Browser”可以添加各种素材，比如图片，背景等等</li></ul>\n<p><strong>最终生成.ui文件</strong>（实质上是XML格式的文件），可直接使用，也可以通过PyUIC工具转换成.py文件。</p>\n<p>本示例用到的控件有Button, GroupBox, Label,ComboBox,TextEdit，同时定义了两个按钮searchBtn及clearBtn，分别用来查询及清空天气数据：</p>\n<p>针对按钮设置信号/槽，也可以不设置，生成python代码后在代码中添加。</p>\n<ul><li>在Qt Designer右下角选择 信号/槽编辑器，点击+号新增</li><li>分别选择searchBtn及clearBtn，选择信号 clicked(), 接收者 QtWeather 及槽【内置了一些常用的槽函数，如close,repaint,hide】，（槽函数这里不知道如何定义，后期在代码里再进行修改）</li></ul>\n<p>设置完成后，保存为weather.ui文件。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\1e699b59b0ac450f961f569c0f281ebb.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\9ccf239de00944d69c8fb70656ae3ff1.png\"/></p>\n<h2><a id=\"uipy_69\"></a>转换.ui文件为.py文件</h2>\n<p>为了更好的自定义及修改上面的槽函数，可以选择weather.ui，然后右键打开External Tools – PyUIC，即可生成weather.py，实际运行命令如下：<br/> <code>D:\\program\\Anaconda3\\Scripts\\pyside6-uic.exe weather.ui -o weather.py</code></p>\n<h2><a id=\"_73\"></a>绑定槽函数</h2>\n<p>设置两个按钮绑定的槽函数</p>\n<pre><code class=\"prism language-python\">self<span class=\"token punctuation\">.</span>seachBtn<span class=\"token punctuation\">.</span>clicked<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">.</span>queryWeather<span class=\"token punctuation\">)</span>\nself<span class=\"token punctuation\">.</span>clearBtn<span class=\"token punctuation\">.</span>clicked<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">.</span>clearText<span class=\"token punctuation\">)</span>\n</code></pre>\n<h2><a id=\"_79\"></a>设置下拉列表内容</h2>\n<p>详见weather.py代码<br/> 将selectBox下拉列表选择设置为广东的21个地市，并且默认选择第三个。</p>\n<pre><code class=\"prism language-python\"><span class=\"token comment\"># -*- coding: utf-8 -*-</span>\n<span class=\"token comment\">################################################################################</span>\n<span class=\"token comment\">## Form generated from reading UI file 'weather.ui'</span>\n<span class=\"token comment\">## Created by: Qt User Interface Compiler version 6.2.2</span>\n<span class=\"token comment\">## WARNING! All changes made in this file will be lost when recompiling UI file!</span>\n<span class=\"token comment\">################################################################################</span>\n<span class=\"token keyword\">from</span> PySide6<span class=\"token punctuation\">.</span>QtCore <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>QCoreApplication<span class=\"token punctuation\">,</span> QMetaObject<span class=\"token punctuation\">,</span> QRect<span class=\"token punctuation\">,</span>\n                            Qt<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">from</span> PySide6<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>QComboBox<span class=\"token punctuation\">,</span> QGroupBox<span class=\"token punctuation\">,</span> QLabel<span class=\"token punctuation\">,</span>\n                               QMenuBar<span class=\"token punctuation\">,</span> QPushButton<span class=\"token punctuation\">,</span> QStatusBar<span class=\"token punctuation\">,</span> QTextEdit<span class=\"token punctuation\">,</span> QWidget<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Ui_QtWeather</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">setupUi</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> QtWeather<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> QtWeather<span class=\"token punctuation\">.</span>objectName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            QtWeather<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"QtWeather\"</span><span class=\"token punctuation\">)</span>\n        QtWeather<span class=\"token punctuation\">.</span>setWindowModality<span class=\"token punctuation\">(</span>Qt<span class=\"token punctuation\">.</span>ApplicationModal<span class=\"token punctuation\">)</span>\n        QtWeather<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span><span class=\"token number\">360</span><span class=\"token punctuation\">,</span> <span class=\"token number\">398</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>centralwidget <span class=\"token operator\">=</span> QWidget<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>centralwidget<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"centralwidget\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>groupBox <span class=\"token operator\">=</span> QGroupBox<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>centralwidget<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>groupBox<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"groupBox\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>groupBox<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span>QRect<span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">321</span><span class=\"token punctuation\">,</span> <span class=\"token number\">301</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>cityLabel <span class=\"token operator\">=</span> QLabel<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>groupBox<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>cityLabel<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"cityLabel\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>cityLabel<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span>QRect<span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox <span class=\"token operator\">=</span> QComboBox<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>groupBox<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"selectBox\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span>QRect<span class=\"token punctuation\">(</span><span class=\"token number\">60</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">231</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>setEditable<span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>textEdit <span class=\"token operator\">=</span> QTextEdit<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>groupBox<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>textEdit<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"textEdit\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>textEdit<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span>QRect<span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">70</span><span class=\"token punctuation\">,</span> <span class=\"token number\">271</span><span class=\"token punctuation\">,</span> <span class=\"token number\">211</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>clearBtn <span class=\"token operator\">=</span> QPushButton<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>centralwidget<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>clearBtn<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"clearBtn\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>clearBtn<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span>QRect<span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">330</span><span class=\"token punctuation\">,</span> <span class=\"token number\">75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>seachBtn <span class=\"token operator\">=</span> QPushButton<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>centralwidget<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>seachBtn<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"seachBtn\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>seachBtn<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span>QRect<span class=\"token punctuation\">(</span><span class=\"token number\">270</span><span class=\"token punctuation\">,</span> <span class=\"token number\">330</span><span class=\"token punctuation\">,</span> <span class=\"token number\">75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        QtWeather<span class=\"token punctuation\">.</span>setCentralWidget<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>centralwidget<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>menubar <span class=\"token operator\">=</span> QMenuBar<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>menubar<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"menubar\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>menubar<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span>QRect<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        QtWeather<span class=\"token punctuation\">.</span>setMenuBar<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>menubar<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>statusbar <span class=\"token operator\">=</span> QStatusBar<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>statusbar<span class=\"token punctuation\">.</span>setObjectName<span class=\"token punctuation\">(</span><span class=\"token string\">u\"statusbar\"</span><span class=\"token punctuation\">)</span>\n        QtWeather<span class=\"token punctuation\">.</span>setStatusBar<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>statusbar<span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>retranslateUi<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>seachBtn<span class=\"token punctuation\">.</span>clicked<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">.</span>queryWeather<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>clearBtn<span class=\"token punctuation\">.</span>clicked<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">.</span>clearText<span class=\"token punctuation\">)</span>\n\n        QMetaObject<span class=\"token punctuation\">.</span>connectSlotsByName<span class=\"token punctuation\">(</span>QtWeather<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># setupUi</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">retranslateUi</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> QtWeather<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        _translate <span class=\"token operator\">=</span> QCoreApplication<span class=\"token punctuation\">.</span>translate\n        QtWeather<span class=\"token punctuation\">.</span>setWindowTitle<span class=\"token punctuation\">(</span>_translate<span class=\"token punctuation\">(</span><span class=\"token string\">\"QtWeather\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">u\"MainWindow\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>groupBox<span class=\"token punctuation\">.</span>setTitle<span class=\"token punctuation\">(</span>_translate<span class=\"token punctuation\">(</span><span class=\"token string\">\"QtWeather\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">u\"城市天气预报\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>cityLabel<span class=\"token punctuation\">.</span>setText<span class=\"token punctuation\">(</span>_translate<span class=\"token punctuation\">(</span><span class=\"token string\">\"QtWeather\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">u\"城市\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>clearBtn<span class=\"token punctuation\">.</span>setText<span class=\"token punctuation\">(</span>_translate<span class=\"token punctuation\">(</span><span class=\"token string\">\"QtWeather\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">u\"清空\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>seachBtn<span class=\"token punctuation\">.</span>setText<span class=\"token punctuation\">(</span>_translate<span class=\"token punctuation\">(</span><span class=\"token string\">\"QtWeather\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">u\"查询\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"广州\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"韶关\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"深圳\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"珠海\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"汕头\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"佛山\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"江门\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"湛江\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"茂名\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"肇庆\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"惠州\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"梅州\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"汕尾\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"河源\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"阳江\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"清远\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"东莞\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"中山\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"潮州\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"揭阳\"</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>addItem<span class=\"token punctuation\">(</span><span class=\"token string\">\"云浮\"</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\">#设置默认值</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>setCurrentIndex<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>currentText<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># retranslateUi</span>\n</code></pre>\n<h2><a id=\"_173\"></a>编写应用业务逻辑</h2>\n<p>在MainWindow中调用界面类Ui_QtWeather，然后在其中添加查询天气的业务逻辑代码，这样就做到了界面显示和业务逻辑的分离。</p>\n<p>新增myapp.py文件， 在MainWindow类中定义两个槽函数queryWeather()和clearText()，以便在界面文件weather.ui中定义的两个按钮(searchBtn 和clearBtn) 触发clicked 信号与这两个槽函数进行绑定。</p>\n<p><strong>Application组件讲解</strong>：</p>\n<ul><li>QApplication()：每个GUI都必须包含一个QApplication，argv表示获取命令行参数。</li><li>QMainWindow()：类似一个容器(窗口) \n  <ul><li>QMainWindow类提供一个带有菜单条，工具条和一个状态条的主应用程序窗口。主窗口通常提供一个大的中央窗口部件，以及周围菜单，工具条，和一个状态栏。</li><li>用来包含按钮、文本、输入框等widgets。arg标识可以获取命令行执行时的参数。</li></ul> </li><li>setGeometry是用来定义 MainWindow() 窗口的尺寸， 语法：setGeometry(x, y, width, height )，其中x,y为屏幕上的坐标点。</li><li>show()：用来显示窗口</li><li>exit(app.exec())：设置窗口一直运行，直到使用关闭按钮进行关闭</li><li>QWidget类是所有用户界面对象的基类，窗口部件是用户界面的一个基本单元，它从窗口系统接收鼠标，键盘和其他消息，并在屏幕上绘制自己。一个窗口部件可以被他的父窗口或者是其他窗口挡住一部分。</li><li>QDialog类是对话框窗口的基类，对话框窗口主要用于短期任务和用户进行短期通讯的顶级窗口，QDialog可以是模态对话框或者是非模态对话框。QDialog支持扩展并带有返回值，他们可以带有默认值</li></ul>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">import</span> requests\n<span class=\"token keyword\">from</span> PySide6<span class=\"token punctuation\">.</span>QtWidgets <span class=\"token keyword\">import</span> QApplication<span class=\"token punctuation\">,</span> QMainWindow\n<span class=\"token keyword\">from</span> weather <span class=\"token keyword\">import</span> Ui_QtWeather\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MainWindow</span><span class=\"token punctuation\">(</span>QMainWindow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>ui <span class=\"token operator\">=</span> Ui_QtWeather<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>ui<span class=\"token punctuation\">.</span>setupUi<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>cityDict <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token string\">\"广州\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440100\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"韶关\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440200\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"深圳\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440300\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"珠海\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440400\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"汕头\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440500\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"佛山\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440600\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"江门\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440700\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"湛江\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440800\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"茂名\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"440900\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"肇庆\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"441200\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"惠州\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"441300\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"梅州\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"441400\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"汕尾\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"441500\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"河源\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"441600\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"阳江\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"441700\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"清远\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"441800\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"东莞\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"441900\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"中山\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"442000\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"潮州\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"445100\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"揭阳\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"445200\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"云浮\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"445300\"</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">queryWeather</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        cityName <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>ui<span class=\"token punctuation\">.</span>selectBox<span class=\"token punctuation\">.</span>currentText<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        cityCode <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>getCode<span class=\"token punctuation\">(</span>cityName<span class=\"token punctuation\">)</span>\n\n        r <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>\n            <span class=\"token string\">\"https://restapi.amap.com/v3/weather/weatherInfo?key=f4fd5b287b6d7d51a3c60fee24e42002&amp;city={}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>cityCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> r<span class=\"token punctuation\">.</span>status_code <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\n            data <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'lives'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n            weatherMsg <span class=\"token operator\">=</span> <span class=\"token string\">'城市：{}\\n天气：{}\\n温度：{}\\n风向：{}\\n风力：{}\\n湿度：{}\\n发布时间：{}\\n'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n                data<span class=\"token punctuation\">[</span><span class=\"token string\">'city'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                data<span class=\"token punctuation\">[</span><span class=\"token string\">'weather'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                data<span class=\"token punctuation\">[</span><span class=\"token string\">'temperature'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                data<span class=\"token punctuation\">[</span><span class=\"token string\">'winddirection'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                data<span class=\"token punctuation\">[</span><span class=\"token string\">'windpower'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                data<span class=\"token punctuation\">[</span><span class=\"token string\">'humidity'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                data<span class=\"token punctuation\">[</span><span class=\"token string\">'reporttime'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            weatherMsg <span class=\"token operator\">=</span> <span class=\"token string\">'天气查询失败，请稍后再试！'</span>\n        self<span class=\"token punctuation\">.</span>ui<span class=\"token punctuation\">.</span>textEdit<span class=\"token punctuation\">.</span>setText<span class=\"token punctuation\">(</span>weatherMsg<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">getCode</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> cityName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>cityDict<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>cityName<span class=\"token punctuation\">,</span> <span class=\"token string\">'广州'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">clearText</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>ui<span class=\"token punctuation\">.</span>textEdit<span class=\"token punctuation\">.</span>clear<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    app <span class=\"token operator\">=</span> QApplication<span class=\"token punctuation\">(</span>sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span>\n\n    window <span class=\"token operator\">=</span> MainWindow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    window<span class=\"token punctuation\">.</span>setGeometry<span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">360</span><span class=\"token punctuation\">,</span> <span class=\"token number\">398</span><span class=\"token punctuation\">)</span>\n    window<span class=\"token punctuation\">.</span>setWindowTitle<span class=\"token punctuation\">(</span><span class=\"token string\">\"QT 简单示例教程\"</span><span class=\"token punctuation\">)</span>\n    window<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    sys<span class=\"token punctuation\">.</span>exit<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span><span class=\"token keyword\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<h2><a id=\"_261\"></a>运行效果</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\53b279c3539b4ff9a9c4733ccf45a22d.png\"/></p>\n<h1><a id=\"exe_263\"></a>将代码打包成exe文件</h1>\n<p>将.py文件打包成可执行的exe在Python中称为freezing，常用的工具有：PyInstaller, py2exe, fbs等。</p>\n<ul><li>py2exe：软件更新已经不活跃，因此也就略过。</li><li>pyinstaller：明确支持win8、win10、理论上支持win7,，支持apple Macos, linux。pyinsaller可以打包成文件夹形式内含exe入口执行文件的形式，也可以是一个单独的exe文件。</li><li>fbs：基于PyInstaller，使用起来更加方便，但开源版本只支持python 3.6/3.7</li></ul>\n<p><strong>本文使用<a href=\"https://pypi.org/project/pyinstaller/\">pyinstaller</a>打包</strong><br/> 打包后会在项目目录下生成dist / myapp 目录，在此目录中包含一个myapp.exe文件，点击可运行。</p>\n<pre><code class=\"prism language-bash\"><span class=\"token comment\">#安装,版本是4.8</span>\npip <span class=\"token function\">install</span> pyinstaller\n\n<span class=\"token comment\">#打包</span>\npyinstaller E:<span class=\"token punctuation\">\\</span>pycodes<span class=\"token punctuation\">\\</span>qt-test<span class=\"token punctuation\">\\</span>myapp.py\n</code></pre>\n<h1><a id=\"_279\"></a>附录</h1>\n<h2><a id=\"_280\"></a>错误解决</h2>\n<h3><a id=\"PyCharmQt_platform_plugin_could_be_initialized_281\"></a>PyCharm中运行报Qt platform plugin could be initialized</h3>\n<p>运行myapp.py时，报错：This application failed to start because not Qt platform plugin could be initialized.Reinstalling the application may fix this problem.<br/> 解决方案有如下2种：</p>\n<ul><li>设置环境变量: <code>QT_QPA_PLATFORM_PLUGIN_PATH = D:\\program\\Anaconda3\\Lib\\site-packages\\PySide6\\plugins\\platforms</code></li><li>在程序初始部分添加如下代码:</li></ul>\n<pre><code class=\"prism language-python\">dirname <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>dirname<span class=\"token punctuation\">(</span>PySide6<span class=\"token punctuation\">.</span>__file__<span class=\"token punctuation\">)</span>\nplugin_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'plugins'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'platforms'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>plugin_path<span class=\"token punctuation\">)</span>\nos<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">[</span><span class=\"token string\">'QT_QPA_PLATFORM_PLUGIN_PATH'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> plugin_path\n</code></pre>\n<h3><a id=\"PySide6_no_Qt_platform_plugin_could_be_initialized_292\"></a>PySide6程序打包后无法运行 no Qt platform plugin could be initialized</h3>\n<p>使用Pyinstaller打包之后的可执行文件无法运行，显示的报错信息：This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.<br/> <img alt=\"在这里插入图片描述\" src=\"image\\7524237f120243e7b4d8341500909136.png\"/></p>\n<ul><li> <p><strong>方案1</strong>: 经过与PySide 2打包后的文件进行对比，发现Pyinstaller打包的文件目录里缺少了Qt运行所需的一些文件，如下：</p>\n<ul><li>plugins</li><li>translations</li><li>qt.conf</li></ul> <p>在哪里找到PySide 6需要的这些文件呢? 步骤如下：</p>\n<ul><li>使用下面的命令查询PySide 6的安装位置（Location）<code>pip show PySide6</code></li><li>进入到安装目录，再进入子目录（PySide6）</li><li>找到并复制 plugins、translations、qt.conf 打包目录的PySide6下即可。</li></ul> </li><li> <p><strong>方案2</strong><br/> 将打包命令修改为：<br/> <code>pyinstaller myapp.py --noconsole --hidden-import PySide6.QtXml</code></p> <p><strong>参数说明</strong></p>\n<ul><li><code>-w, --windowed, --noconsole</code><br/> Windows and Mac OS X: do not provide a console window for standard i/o.<br/> On Mac OS this also triggers building a Mac OS .app bundle.<br/> On Windows this option is automatically set if the first script is a ‘.pyw’ file.<br/> This option is ignored on *NIX systems.</li><li><code>--hidden-import MODULENAME, --hiddenimport MODULENAME</code><br/> Name an import not visible in the code of the<br/> script(s). This option can be used multiple times.</li><li><code>PySide6.QtXml</code> 包含模块类的定义</li></ul> </li></ul>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}