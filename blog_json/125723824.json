{"blogid": "125723824", "writerAge": "码龄7年", "writerBlogNum": "170", "writerCollect": "335", "writerComment": "40", "writerFan": "1000", "writerGrade": "5级", "writerIntegral": "2534", "writerName": "HKW_hankangwen", "writerProfileAdress": "writer_image\\profile_125723824.jpg", "writerRankTotal": "9482", "writerRankWeekly": "5969", "writerThumb": "93", "writerVisitNum": "112159", "blog_read_count": "640", "blog_time": "已于 2022-07-11 16:08:32 修改", "blog_title": "2.C#操作MongoDB（详细）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h4><a id=\"1_1\"></a>1.连接数据库</h4>\n<p>要连接数据库，首先需要指定要连接的数据库名称，如果数据库不存在的话，MongoDB 则会自动创建它。下面通过简单的代码来演示如何使用C#代码连接 MongoDB 数据库：</p>\n<pre><code class=\"prism language-c#\">using System;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n\n            MongoCredential credential;\n            credential = MongoCredential.CreateCredential(\"sampleUser\", \"myDb\", \"password\");\n            Console.WriteLine(\"Connected to the database successfully!\");\n\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n            Console.WriteLine(\"Credentials ::\" + credential);\n\n            Console.ReadKey();\n        }\n    }\n}\n\n</code></pre>\n<p>编译并运行上面的程序，即可创建名为“myDb”的数据库，并输出如下所示的内容：</p>\n<p>Connected to the database successfully!<br/> Credentials ::myDb@sampleUser</p>\n<h4><a id=\"2_36\"></a>2.创建集合</h4>\n<p>若要创建集合，您可以使用 com.mongodb.client.MongoDatabase 类的 createCollection() 方法，示例代码如下：</p>\n<pre><code class=\"prism language-C#\">using System;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n\n            MongoCredential credential;\n            credential = MongoCredential.CreateCredential(\"sampleUser\", \"myDb\", \"password\");\n            Console.WriteLine(\"Connected to the database successfully!\");\n\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n\n            database.CreateCollection(\"tutorial\");\n            Console.WriteLine(\"Create collection successfully!\");\n\n            Console.ReadKey();\n        }\n    }\n}\n\n</code></pre>\n<p>编译并运行上面的程序，运行结果如下所示：</p>\n<p>Connected to the database successfully!<br/> Create collection successfully!</p>\n<h4><a id=\"3_74\"></a>3.获取/选择集合</h4>\n<p>要获取/选择数据库中的集合，您可以使用 com.mongodb.client.MongoDatabase 类的 getCollection() 方法，示例代码如下：</p>\n<pre><code class=\"prism language-C#\">using System;\nusing MongoDB.Bson;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n\n            MongoCredential credential;\n            credential = MongoCredential.CreateCredential(\"sampleUser\", \"myDb\", \"password\");\n            Console.WriteLine(\"Connected to the database successfully!\");\n\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n\n            database.CreateCollection(\"tutorial2\");\n            Console.WriteLine(\"Create collection successfully!\");\n\n            const string collectionName = \"tutorial2\";\n            var collection = database.GetCollection&lt;BsonDocument&gt;(collectionName);\n            Console.WriteLine(\"Select collection tutorial2 successfully!\");\n\n            Console.ReadKey();\n        }\n    }\n}\n\n</code></pre>\n<p>编译并运行上面的程序，运行结果如下所示：</p>\n<p>Connected to the database successfully!<br/> Create collection successfully!<br/> Select collection tutorial2 successfully!</p>\n<h4><a id=\"4_118\"></a>4.插入文档</h4>\n<p>想要向集合中插入文档，您可以使用 com.mongodb.client.MongoCollection 类的 insert() 方法，示例代码如下：</p>\n<pre><code class=\"prism language-c#\">using System;\nusing MongoDB.Bson;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n\n            const string collectionName = \"tutorial3\";\n            database.CreateCollection(collectionName);\n            Console.WriteLine(\"Create collection successfully!\");\n\n            var collection = database.GetCollection&lt;BsonDocument&gt;(collectionName);\n            Console.WriteLine(\"Select collection successfully!\");\n\n            BsonDocument document = new BsonDocument(\"title\", \"MongoDB\")\n                .Add(\"description\", \"database\")\n                .Add(\"likes\", 100)\n                .Add(\"url\", \"www.bianchengbang.net\")\n                .Add(\"by\", \"编程帮\");\n            collection.InsertOne(document);\n            Console.WriteLine(\"Insert document successfully\");\n\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n<p>Create collection successfully!<br/> Select collection successfully!<br/> Insert document successfully</p>\n<h4><a id=\"5_162\"></a>5.查询文档</h4>\n<p>想要查询集合中的文档，您可以使用 com.mongodb.client.MongoCollection 类的 find() 方法，此方法会返回一个游标，因此想要查询集合中的所有文档您只需要不断迭代此游标即可，示例代码如下：</p>\n<pre><code class=\"prism language-c#\">using System;\nusing System.Collections.Generic;\nusing System.Threading.Tasks;\nusing MongoDB.Bson;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n\n            MongoCredential credential;\n            credential = MongoCredential.CreateCredential(\"sampleUser\", \"myDb\", \"password\");\n            Console.WriteLine(\"Connected to the database successfully!\");\n\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n\n            const string collectionName = \"tutorial3\";\n            var collection = database.GetCollection&lt;BsonDocument&gt;(collectionName);\n            Console.WriteLine(\"Select collection successfully!\");\n\n            BsonDocument document1 = new BsonDocument(\"title\", \"MongoDB\")\n                .Add(\"description\", \"database\")\n                .Add(\"likes\", 100)\n                .Add(\"url\", \"www.bianchengbang.net\")\n                .Add(\"by\", \"编程帮\");\n            BsonDocument document2 = new BsonDocument(\"title\", \"html\")\n                .Add(\"description\", \"database\")\n                .Add(\"likes\", 200)\n                .Add(\"url\", \"www.bianchengbang.net/html\")\n                .Add(\"by\", \"编程帮\");\n            List&lt;BsonDocument&gt; list = new List&lt;BsonDocument&gt;();\n            list.Add(document1);\n            list.Add(document2);\n            collection.InsertMany(list);\n\n            var filter = new BsonDocument();\n            var list2 = Task.Run(async () =&gt; await collection.Find(filter).ToListAsync()).Result;\n            list2.ForEach(p =&gt;\n            {\n                Console.WriteLine(p);\n            });\n\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n<p>Connected to the database successfully!<br/> Select collection successfully!<br/> { “_id” : ObjectId(“62cb94d1c6343689168a3979”), “title” : “MongoDB”, “description” : “database”, “likes” : 100, “url” : “www.bianchengbang.net”, “by” : “编程帮” }<br/> { “_id” : ObjectId(“62cbbcc68b693b007da230d9”), “title” : “MongoDB”, “description” : “database”, “likes” : 100, “url” : “www.bianchengbang.net”, “by” : “编程帮” }<br/> { “_id” : ObjectId(“62cbbcc68b693b007da230da”), “title” : “html”, “description” : “database”, “likes” : 200, “url” : “www.bianchengbang.net/html”, “by” : “编程帮” }</p>\n<h4><a id=\"6_226\"></a>6.更新文档</h4>\n<p>要更新（修改）集合中文档的数据，您可以使用 com.mongodb.client.MongoCollection 类的 updateOne() 方法，示例代码如下：</p>\n<pre><code class=\"prism language-c#\">using System;\nusing System.Collections.Generic;\nusing System.Threading.Tasks;\nusing MongoDB.Bson;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n\n            MongoCredential credential;\n            credential = MongoCredential.CreateCredential(\"sampleUser\", \"myDb\", \"password\");\n            Console.WriteLine(\"Connected to the database successfully!\");\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n\n            const string collectionName = \"tutorial3\";\n            var collection = database.GetCollection&lt;BsonDocument&gt;(collectionName);\n            Console.WriteLine(\"Select collection successfully!\");\n\n            var filter = Builders&lt;BsonDocument&gt;.Filter.Eq(\"title\", \"html\");\n            var update = Builders&lt;BsonDocument&gt;.Update\n                .Set(\"likes\", 520)\n                .CurrentDate(\"lastModified\");\n            collection.UpdateOne(filter, update);\n            Console.WriteLine(\"Update document successfully!\");\n\n            var filter2 = new BsonDocument();\n            var list = Task.Run(async () =&gt; await collection.Find(filter2).ToListAsync()).Result;\n            list.ForEach(p =&gt;\n            {\n                Console.WriteLine(p);\n            });\n\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n<p>Connected to the database successfully!<br/> Select collection successfully!<br/> Update document successfully!<br/> { “_id” : ObjectId(“62cb94d1c6343689168a3979”), “title” : “MongoDB”, “description” : “database”, “likes” : 100, “url” : “www.bianchengbang.net”, “by” : “编程帮” }<br/> { “_id” : ObjectId(“62cbbcc68b693b007da230d9”), “title” : “MongoDB”, “description” : “database”, “likes” : 100, “url” : “www.bianchengbang.net”, “by” : “编程帮” }<br/> { “_id” : ObjectId(“62cbbcc68b693b007da230da”), “title” : “html”, “description” : “database”, “likes” : 520, “url” : “www.bianchengbang.net/html”, “by” : “编程帮”, “lastModified” : ISODate(“2022-07-11T06:50:03.421Z”) }</p>\n<h4><a id=\"7_282\"></a>7.删除文档</h4>\n<p>想要从集合中删除文档，您可以使用 com.mongodb.client.MongoCollection 类的 deleteOne() 方法，示例代码如下：</p>\n<pre><code class=\"prism language-c#\">using System;\nusing System.Collections.Generic;\nusing System.Threading.Tasks;\nusing MongoDB.Bson;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n\n            MongoCredential credential;\n            credential = MongoCredential.CreateCredential(\"sampleUser\", \"myDb\", \"password\");\n            Console.WriteLine(\"Connected to the database successfully!\");\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n\n            const string collectionName = \"tutorial3\";\n            var collection = database.GetCollection&lt;BsonDocument&gt;(collectionName);\n            Console.WriteLine(\"Select collection successfully!\");\n\n            var filter = Builders&lt;BsonDocument&gt;.Filter.Eq(\"title\", \"MongoDB\");\n            collection.DeleteOne(filter);\n            Console.WriteLine(\"Delete document successfully!\");\n\n            var filter2 = new BsonDocument();\n            var list = Task.Run(async () =&gt; await collection.Find(filter2).ToListAsync()).Result;\n            list.ForEach(p =&gt;\n            {\n                Console.WriteLine(p);\n            });\n\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n<p>Connected to the database successfully!<br/> Select collection successfully!<br/> Delete document successfully!<br/> { “_id” : ObjectId(“62cbbcc68b693b007da230d9”), “title” : “MongoDB”, “description” : “database”, “likes” : 100, “url” : “www.bianchengbang.net”, “by” : “编程帮” }<br/> { “_id” : ObjectId(“62cbbcc68b693b007da230da”), “title” : “html”, “description” : “database”, “likes” : 520, “url” : “www.bianchengbang.net/html”, “by” : “编程帮”, “lastModified” : ISODate(“2022-07-11T06:50:03.421Z”) }</p>\n<h4><a id=\"8_334\"></a>8.删除集合</h4>\n<p>要从数据库中删除集合，您可以使用 com.mongodb.client.MongoCollection 类中的 drop() 方法，示例代码如下：</p>\n<pre><code class=\"prism language-c#\">using System;\nusing System.Collections.Generic;\nusing System.Threading.Tasks;\nusing MongoDB.Bson;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n\n            MongoCredential credential;\n            credential = MongoCredential.CreateCredential(\"sampleUser\", \"myDb\", \"password\");\n            Console.WriteLine(\"Connected to the database successfully!\");\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n            \n            const string collectionName = \"tutorial\";\n            Task.Run(async () =&gt;\n            {\n                await database.DropCollectionAsync(collectionName);\n            });\n            Console.WriteLine(\"Drop collection successfully!\");\n\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n<p>Connected to the database successfully!<br/> Drop collection successfully!</p>\n<h4><a id=\"9_375\"></a>9.列出所有集合</h4>\n<pre><code class=\"prism language-c#\">using System;\nusing MongoDB.Driver;\n\nnamespace MongoDBDemo\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            string connectionString = \"mongodb://127.0.0.1:27017/bianchengbang\";\n            MongoClient mongoClient = new MongoClient(connectionString);\n\n            MongoCredential credential;\n            credential = MongoCredential.CreateCredential(\"sampleUser\", \"myDb\", \"password\");\n            Console.WriteLine(\"Connected to the database successfully!\");\n            IMongoDatabase database = mongoClient.GetDatabase(\"myDB\");\n\n            var list = database.ListCollectionNames().ToList();\n            foreach (var item in list)\n            {\n                Console.WriteLine(item);\n            }\n\n            Console.ReadKey();\n        }\n    }\n}\n</code></pre>\n<p>Connected to the database successfully!<br/> tutorial3<br/> tutorial1<br/> tutorial2</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}