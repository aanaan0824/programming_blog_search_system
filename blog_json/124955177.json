{"blogid": "124955177", "writerAge": "码龄12年", "writerBlogNum": "389", "writerCollect": "774", "writerComment": "196", "writerFan": "2495", "writerGrade": "7级", "writerIntegral": "9083", "writerName": "蓝创精英团队", "writerProfileAdress": "writer_image\\profile_124955177.jpg", "writerRankTotal": "1655", "writerRankWeekly": "3529", "writerThumb": "287", "writerVisitNum": "593176", "blog_read_count": "1150", "blog_time": "已于 2022-05-27 12:01:07 修改", "blog_title": "RPA之基于FlaUI的微信发送消息给某人", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"RPAC_FlaUI_0\"></a>RPA之基于C# FlaUI的微信发送消息给某人</h1>\n<hr/>\n<h1><a id=\"_3\"></a>目的</h1>\n<p>一直想实现微信的群发功能，但是，没有实现，原因有一条是怕违法，记得某某公司因为破解了微信的接口巴拉巴拉，然后，被告了。罚了N多钱。</p>\n<p>这个时候，我想，如果我基于RPA技术，那么，就不会对微信有任何影响啊，毕竟，我只是模拟我的电脑操作，微信公司也识别不到我的行为是非法的。</p>\n<p>那么，这个行为可能就是基于安全的方式的技术了。</p>\n<p>所以，我就尝试了一下，同时也借鉴了网络上的资料，给我了一些启发</p>\n<hr/>\n<h1><a id=\"FlaUI_14\"></a>一、FlaUI是什么？</h1>\n<p>FlaUI 是一个基于微软 UIAutomation 技术 从Windows Vista开始推出的一套全新UI自动化测试技术， 简称UIA。在最新的Windows SDK中，UIA和MSAA等其它支持UI自动化技术的组件放在一起发布，叫做Windows Automation API。</p>\n<p>UIA定义了全新的、针对UI自动化的接口和模式。 分别是支持对UI元素进行遍历和条件化查询的TreeWalker/FindAll。定义了读写UI元素属性的UIA Property， 包括Name、 ID、Type、ClassName、Location、 Visibility等等。定义了UI元素行为的UIA Pattern， 比如Select、Expand、Resize、 Check、Value等等。 还引入了UIA Event接口，可以让测试程序在某些事件发生后得到通知，比如新窗口打开事件等</p>\n<p>目前 FlaUI所用的为UIA2和UIA3两种技术。<br/> 我这里主要用的是UIA3</p>\n<h1><a id=\"_22\"></a>二、使用步骤</h1>\n<h2><a id=\"1Nuget_23\"></a>1.引入Nuget包</h2>\n<pre><code class=\"prism language-csharp\">Install<span class=\"token operator\">-</span>Package FlaUI<span class=\"token punctuation\">.</span>UIA3 <span class=\"token operator\">-</span>Version <span class=\"token number\">3.2</span><span class=\"token number\">.0</span>\n</code></pre>\n<h2><a id=\"2_29\"></a>2.实现一个简单的给指定人发送消息</h2>\n<p>代码如下（示例）：</p>\n<pre><code class=\"prism language-csharp\"> <span class=\"token class-name\">Process<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> processes <span class=\"token operator\">=</span> Process<span class=\"token punctuation\">.</span><span class=\"token function\">GetProcessesByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WeChat\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>processes<span class=\"token punctuation\">.</span><span class=\"token function\">Count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"微信未启动或启动多个微信\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token comment\">//1.附加到微信进程</span>\n                <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> app <span class=\"token operator\">=</span> Application<span class=\"token punctuation\">.</span><span class=\"token function\">Attach</span><span class=\"token punctuation\">(</span>processes<span class=\"token punctuation\">.</span><span class=\"token function\">First</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> automation <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">UIA3Automation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        <span class=\"token comment\">//2.获取主界面</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> mainWindow <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">GetMainWindow</span><span class=\"token punctuation\">(</span>automation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"获取主界面\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token comment\">//3.切换到通讯录</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> elements <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindAll</span><span class=\"token punctuation\">(</span>FlaUI<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Definitions<span class=\"token punctuation\">.</span>TreeScope<span class=\"token punctuation\">.</span>Subtree<span class=\"token punctuation\">,</span> TrueCondition<span class=\"token punctuation\">.</span>Default<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> addressBook <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"通讯录\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        addressBook<span class=\"token punctuation\">.</span><span class=\"token function\">DrawHighlight</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>Drawing<span class=\"token punctuation\">.</span>Color<span class=\"token punctuation\">.</span>Red<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> path <span class=\"token operator\">=</span> Debug<span class=\"token punctuation\">.</span><span class=\"token function\">GetXPathToElement</span><span class=\"token punctuation\">(</span>addressBook<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"点击通讯录\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        addressBook<span class=\"token punctuation\">.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                        <span class=\"token comment\">//4.搜索</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> target <span class=\"token operator\">=</span> <span class=\"token string\">\"文件传输助手\"</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> searchTextBox <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"搜索\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">AsTextBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        searchTextBox<span class=\"token punctuation\">.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Keyboard<span class=\"token punctuation\">.</span><span class=\"token function\">Type</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Keyboard<span class=\"token punctuation\">.</span><span class=\"token function\">Type</span><span class=\"token punctuation\">(</span>VirtualKeyShort<span class=\"token punctuation\">.</span>RETURN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"搜索目标对象\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                        <span class=\"token comment\">//5.切换到对话框</span>\n                        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> searchList <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"搜索结果\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>searchList <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">{<!-- --></span>\n                            <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> searchItem <span class=\"token operator\">=</span> searchList<span class=\"token punctuation\">.</span><span class=\"token function\">FindAllDescendants</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">FirstOrDefault</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span>Name <span class=\"token operator\">==</span> target <span class=\"token operator\">&amp;&amp;</span> cf<span class=\"token punctuation\">.</span>ControlType <span class=\"token operator\">==</span> FlaUI<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Definitions<span class=\"token punctuation\">.</span>ControlType<span class=\"token punctuation\">.</span>ListItem<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            searchItem<span class=\"token punctuation\">?.</span><span class=\"token function\">DrawHighlight</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>Drawing<span class=\"token punctuation\">.</span>Color<span class=\"token punctuation\">.</span>Red<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            searchItem<span class=\"token punctuation\">?.</span><span class=\"token function\">AsListBoxItem</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span>\n                        <span class=\"token keyword\">else</span>\n                        <span class=\"token punctuation\">{<!-- --></span>\n                            Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"没有搜索到内容\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span>\n                        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token comment\">//6.输入文本</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> sendMsg <span class=\"token operator\">=</span> <span class=\"token string\">\"这个是我微信的输入信息:\"</span> <span class=\"token operator\">+</span> DateTime<span class=\"token punctuation\">.</span>Now<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> msgInput <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"输入\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">AsTextBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        msgInput<span class=\"token punctuation\">?.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms<span class=\"token punctuation\">.</span>Clipboard<span class=\"token punctuation\">.</span><span class=\"token function\">SetText</span><span class=\"token punctuation\">(</span>sendMsg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Keyboard<span class=\"token punctuation\">.</span><span class=\"token function\">TypeSimultaneously</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{<!-- --></span> VirtualKeyShort<span class=\"token punctuation\">.</span>CONTROL<span class=\"token punctuation\">,</span> VirtualKeyShort<span class=\"token punctuation\">.</span>KEY_V <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> sendBtn <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendBtn\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        sendBtn<span class=\"token punctuation\">?.</span><span class=\"token function\">DrawHighlight</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>Drawing<span class=\"token punctuation\">.</span>Color<span class=\"token punctuation\">.</span>Red<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        sendBtn<span class=\"token punctuation\">?.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>代码有注释也容易理解。<br/> 就是搜索指定人，然后，发送指定信息给他。搞定。<br/> 图示效果如下:</p>\n<h2><a id=\"httpsimgblogcsdnimgcn1dba96d61f1243529669299991a64357gif_98\"></a><img alt=\"在这里插入图片描述\" src=\"https://img-blog.csdnimg.cn/1dba96d61f1243529669299991a64357.gif\"/></h2>\n<h2><a id=\"3_100\"></a>3.实现一个获取会话列表批量发送消息</h2>\n<p>代码如下（示例）：</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token class-name\">Process<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> processes <span class=\"token operator\">=</span> Process<span class=\"token punctuation\">.</span><span class=\"token function\">GetProcessesByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WeChat\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>processes<span class=\"token punctuation\">.</span><span class=\"token function\">Count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"微信未启动或启动多个微信\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token comment\">//1.附加到微信进程</span>\n                <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> app <span class=\"token operator\">=</span> Application<span class=\"token punctuation\">.</span><span class=\"token function\">Attach</span><span class=\"token punctuation\">(</span>processes<span class=\"token punctuation\">.</span><span class=\"token function\">First</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> automation <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">UIA3Automation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        <span class=\"token comment\">//2.获取主界面</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> mainWindow <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">GetMainWindow</span><span class=\"token punctuation\">(</span>automation<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"获取主界面\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token comment\">//3.切换到聊天目录</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> elements <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindAll</span><span class=\"token punctuation\">(</span>TreeScope<span class=\"token punctuation\">.</span>Subtree<span class=\"token punctuation\">,</span> TrueCondition<span class=\"token punctuation\">.</span>Default<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> addressBook <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"聊天\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        addressBook<span class=\"token punctuation\">.</span><span class=\"token function\">DrawHighlight</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>Drawing<span class=\"token punctuation\">.</span>Color<span class=\"token punctuation\">.</span>Red<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> path <span class=\"token operator\">=</span> Debug<span class=\"token punctuation\">.</span><span class=\"token function\">GetXPathToElement</span><span class=\"token punctuation\">(</span>addressBook<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        addressBook<span class=\"token punctuation\">.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"切换到聊天\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        Thread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token comment\">//4.获取聊天列表</span>\n                        <span class=\"token comment\">//只发前六个</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> searchTextBox <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"会话\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">AsListBoxItem</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>searchTextBox <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">{<!-- --></span>\n                            <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> list <span class=\"token operator\">=</span> searchTextBox<span class=\"token punctuation\">.</span><span class=\"token function\">FindAllChildren</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> item <span class=\"token keyword\">in</span> list<span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">{<!-- --></span>\n                                count<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n                                <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> name <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">;</span>\n                                item<span class=\"token punctuation\">.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> type <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span>ControlType<span class=\"token punctuation\">;</span>\n                                item<span class=\"token punctuation\">.</span><span class=\"token function\">DrawHighlight</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>Drawing<span class=\"token punctuation\">.</span>Color<span class=\"token punctuation\">.</span>Red<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> MsgSend <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"输入\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">AsTextBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> MsgSendButton <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendBtn\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>MsgSend <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> MsgSendButton <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                                <span class=\"token punctuation\">{<!-- --></span>\n                                    MsgSend<span class=\"token punctuation\">.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                    System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms<span class=\"token punctuation\">.</span>Clipboard<span class=\"token punctuation\">.</span><span class=\"token function\">SetText</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"群发消息,请忽略:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span><span class=\"token expression language-csharp\">DateTime<span class=\"token punctuation\">.</span>Now</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                    Keyboard<span class=\"token punctuation\">.</span><span class=\"token function\">TypeSimultaneously</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{<!-- --></span> VirtualKeyShort<span class=\"token punctuation\">.</span>CONTROL<span class=\"token punctuation\">,</span> VirtualKeyShort<span class=\"token punctuation\">.</span>KEY_V <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                    MsgSendButton<span class=\"token punctuation\">.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                    Console<span class=\"token punctuation\">.</span><span class=\"token function\">WriteLine</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"发送信息:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span><span class=\"token expression language-csharp\">name</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                    Thread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                <span class=\"token punctuation\">}</span>\n                                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">==</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n                                <span class=\"token punctuation\">{<!-- --></span>\n                                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                                <span class=\"token punctuation\">}</span>\n                            <span class=\"token punctuation\">}</span>\n                            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>count <span class=\"token operator\">==</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">{<!-- --></span>\n                                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token punctuation\">}</span>\n                            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> list<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">{<!-- --></span>\n                                searchTextBox<span class=\"token punctuation\">.</span><span class=\"token function\">Focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                Keyboard<span class=\"token punctuation\">.</span><span class=\"token function\">Press</span><span class=\"token punctuation\">(</span>VirtualKeyShort<span class=\"token punctuation\">.</span>DOWN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                Thread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token punctuation\">}</span>\n                            searchTextBox <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"会话\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">AsListBoxItem</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            Thread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>这个代码重要是群发给了前6个人，如果会话没有发送按钮，就不会发送，避免影响更多人。</p>\n<p>图示效果如下:<br/> <img alt=\"在这里插入图片描述\" src=\"https://img-blog.csdnimg.cn/9fc937ea345b486ca5606cf39cf88487.gif\"/><br/> 录了好几次。。最后还有人把我把我删掉了，尴尬。</p>\n<h2><a id=\"4FlaUI__182\"></a>4.FlaUI 如何获取页面的信息</h2>\n<p>打开这个FlaUinspect工具<br/> <a href=\"https://github.com/FlaUI/FlaUInspect\">FlaUInspect</a><br/> <img alt=\"在这里插入图片描述\" src=\"image\\2c0f007765c041d9be36fd34bb1026f2.png\"/><br/> 可以通过 以下看到 XPath地址<br/> <img alt=\"在这里插入图片描述\" src=\"image\\17d267a3f4654a88b5e1022a17f936b1.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\555bafdcd0ce45e0ae454f4ddac14ae3.png\"/><br/> 这个FlaUinspect项目是一个WPF项目，想深入研究的可以查看源码，跟踪调试一波。<br/> 这里主要的是可以通过以下两种方式来获取所需要的内容</p>\n<p>第一种就像下面的一样，通过同一个页面独一无二的名字来获取到</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> addressBook <span class=\"token operator\">=</span> mainWindow<span class=\"token punctuation\">.</span><span class=\"token function\">FindFirstDescendant</span><span class=\"token punctuation\">(</span>cf <span class=\"token operator\">=&gt;</span> cf<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"聊天\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>第二种是这样的<br/> 可以通过 图上面的2的XPath地址来找到你想要的控件</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> infoData <span class=\"token operator\">=</span> automationElement<span class=\"token punctuation\">.</span><span class=\"token function\">FindAllByXPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Pane/Pane[1]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h1><a id=\"_203\"></a>总结</h1>\n<p>总的来说，这个技术还是很方便的，但是对于QQ这种底层是自绘技术的以及是使用QT，JAVA级的应用应该是实现不了。只能针对于微软的技术的产品WinFrom和WPF等。</p>\n<p>大体来讲，还是降低了使用时候的难度的。</p>\n<p>比如这个微信发送信息，你有功能了，你就可以自己扩展，比如，指定人发，群发，定时发，标签发送，实现完，对个人来讲，作用也是不错的。</p>\n<p>既然都看到了这里，点个 关注 走一波</p>\n<h1><a id=\"_214\"></a>关于其他网友运行不起来的解决方案</h1>\n<p>如果是报这个错误。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\c75fa1545f92485dbdadd45f1c1e9bfc.png\"/></p>\n<p>可以通过，下载 https://github.com/FlaUI/FlaUI 源码，直接引用，不通过nuget 解决这个问题。<br/> 暂时没有深究是由于啥导致的。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}