{"blogid": "120051095", "writerAge": "码龄4年", "writerBlogNum": "6", "writerCollect": "166", "writerComment": "14", "writerFan": "17", "writerGrade": "2级", "writerIntegral": "100", "writerName": "ping_Kingzero", "writerProfileAdress": "writer_image\\profile_120051095.jpg", "writerRankTotal": "159826", "writerRankWeekly": "281305", "writerThumb": "24", "writerVisitNum": "22627", "blog_read_count": "5684", "blog_time": "已于 2022-03-14 08:52:59 修改", "blog_title": "C#Winform的DataGridView控件使用详解2—DataGridView表格样式设置及表格操作", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>C#Winform的DataGridView控件使用详解2—DataGridView表格样式设置及表格操作</h3>\n<ul><li><a href=\"#DataGridView_5\">DataGridView表格样式设置</a></li><li><ul><li><a href=\"#DataGridView_31\">DataGridView行序号设置</a></li></ul>\n</li><li><a href=\"#_53\">右键弹出控件表格操作</a></li><li><ul><li><a href=\"#DataGridView_65\">DataGridView新建行</a></li><li><a href=\"#DataGridView_76\">DataGridView删除行</a></li><li><a href=\"#DataGridView_88\">DataGridView清除内容</a></li><li><a href=\"#DataGridView_104\">DataGridView复制</a></li><li><a href=\"#DataGridView_119\">DataGridView粘贴</a></li></ul>\n</li></ul>\n</div>\n<br/> 在展示和处理二维数据时，我们常常会想起Excel。但是使用Excel自带的各种函数处理较为繁琐的步骤时显得略显吃力，如果使用Excel自带宏编程，可能会对VB语言不甚熟悉或是感觉不nice。这个时候，熟悉C#编程语言的你，就需要用到DataGridView控件，设计一款二维数据处理利器。\n<mark><em>此处，我们开始进入对DataGridView摸索学习的环节…</em></mark>\n<p></p>\n<p>在上一章内容<a href=\"https://blog.csdn.net/ping_Kingzero/article/details/119528469?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163050959516780262597134%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=163050959516780262597134&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v29_ecpm-1-119528469.first_rank_v2_pc_rank_v29&amp;utm_term=C%23Winform%E7%9A%84DataGridView%E6%8E%A7%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A31&amp;spm=1018.2226.3001.4187\">《C#Winform的DataGridView控件使用详解1-七种DataGridViewColumn类型使用方法》</a>中，我们介绍了6种DataGridView列对象，在本章内容部中，我们将详细介绍DataGridViewTextBoxColumn对象的Cell设置(表头、表格内容、行序号)、右键弹出行操作(新建行、删除行、清空内容、复制、粘贴)。</p>\n<h1><a id=\"DataGridView_5\"></a>DataGridView表格样式设置</h1>\n<p>DataGridView的表格样式包括表头(<mark><em>ColumnHeadersDefaultCellStyle</em></mark>)和表格内容(<mark><em>RowsDefaultCellStyle</em></mark>)的样式，此处我们对其的<strong>字体</strong>、<strong>对齐方式</strong>、<strong>点击自动排序</strong>和<strong>宽度可调节</strong>来进行设置：<br/> 1、字体与对齐方式设置</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token comment\">// 设置表头居中，其对齐方式一共有10种，包含竖向的顶中底和水平的左中右以及NotSet</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>ColumnHeadersDefaultCellStyle<span class=\"token punctuation\">.</span>Alignment <span class=\"token operator\">=</span> DataGridViewContentAlignment<span class=\"token punctuation\">.</span>MiddleCenter<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//设置表头字体样式</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>ColumnHeadersDefaultCellStyle<span class=\"token punctuation\">.</span>Font <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Font</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"宋体\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//设置单元格cell内容居中</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>RowsDefaultCellStyle<span class=\"token punctuation\">.</span>Alignment <span class=\"token operator\">=</span> DataGridViewContentAlignment<span class=\"token punctuation\">.</span>MiddleCenter<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//设置单元格cell字体样式</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>RowsDefaultCellStyle<span class=\"token punctuation\">.</span>Font <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Font</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"宋体\"</span><span class=\"token punctuation\">,</span> \n</code></pre>\n<p>设置各种居中和字体样式后，结果如下显示：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\c7d1ddb65fba40e28328499124338743.png\"/><br/> 2、对齐与表格排序的相互影响<br/> 但是当我们设置了表头和单元格均居中后，但发现表头并没有出现居中效果，如下图：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\e88b10258f284a979f169afaf4e57eff.png\"/>这里，我们需要调整一下表格列的参数，将排序模式设置为无排序：</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\91d1f9be3e8440f88d20d440fe653a1b.png\"/><br/> 设置了表头居中并没有显示居中效果的原因在于，该列排序模式为自动排序，所有该表头位置会出现一个便于排序点击的倒三角，会占据表头位置。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\2615400c8a6f4433b3a2e904d4f5f058.png\"/><br/> 3、表格宽度调节<br/> Excel表格的行高和列宽都能手动拉，为了满足一定的需求，我们需要设置是否可以调整行列尺寸（False：不能手动调整，True：可手动调整）。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\b504d9d96c2e4fa1a388b4d639f9a677.png\"/></p>\n<h2><a id=\"DataGridView_31\"></a>DataGridView行序号设置</h2>\n<p>我们直接使用并填充数据的DataGridView默认是没有行号的，这里我们要利用表格的RowPostPaint函数，对表格进行重绘：</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 显示行号</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">dtLineHCurvePara_RowPostPaint</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">DataGridViewRowPostPaintEventArgs</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token keyword\">var</span> grid <span class=\"token operator\">=</span> sender <span class=\"token keyword\">as</span> DataGridView<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">var</span> rowidx <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>RowIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">var</span> centerFormat <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StringFormat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\tAlignment <span class=\"token operator\">=</span> StringAlignment<span class=\"token punctuation\">.</span>Center<span class=\"token punctuation\">,</span>\n\tLineAlignment <span class=\"token operator\">=</span> StringAlignment<span class=\"token punctuation\">.</span>Center\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">var</span> headerBuunds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> \t<span class=\"token class-name\">System<span class=\"token punctuation\">.</span>Drawing<span class=\"token punctuation\">.</span>Rectangle</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>RowBounds<span class=\"token punctuation\">.</span>Left<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>RowBounds<span class=\"token punctuation\">.</span>Top<span class=\"token punctuation\">,</span> grid<span class=\"token punctuation\">.</span>RowHeadersWidth<span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>RowBounds<span class=\"token punctuation\">.</span>Height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\te<span class=\"token punctuation\">.</span>Graphics<span class=\"token punctuation\">.</span><span class=\"token function\">DrawString</span><span class=\"token punctuation\">(</span>rowidx<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Font</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"宋体\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> SystemBrushes<span class=\"token punctuation\">.</span>ControlText<span class=\"token punctuation\">,</span> headerBuunds<span class=\"token punctuation\">,</span> centerFormat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token preprocessor property\">#<span class=\"token directive keyword\">endregion</span></span>\n</code></pre>\n<p>对表格进行重绘后，表格每添加一行，均会显示每行的行号，行号的字体也可以在代码中设置，表现如下：<br/> <img alt=\"在这里插入图片描述\" src=\"image\\5b000bb9187740a5b540411e8e3eb5fa.png\"/></p>\n<h1><a id=\"_53\"></a>右键弹出控件表格操作</h1>\n<p>为实现表格的会操作，给DataGridView绑定contextMenuStrip控件，然后在右键弹出菜单里面添加<strong>新建行</strong>、<strong>删除行</strong>、<strong>清除选中内容</strong>、<strong>复制</strong>和<strong>粘贴操作</strong><br/> 首先在软件界面登录的时候，将表格与右键弹出框绑定。</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 编辑平曲线界面的Load事件</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sFrmLineHCurveParaEdit_Load</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>ContextMenuStrip <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contextMenuStrip1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\f02d5eb12cb3496aa7e3bd585241fdc4.png\"/></p>\n<h2><a id=\"DataGridView_65\"></a>DataGridView新建行</h2>\n<p>右键弹出框，点击【新建行】按钮，即可在表格最后新增一行</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 新建行</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">btnNewRow_Click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token preprocessor property\">#<span class=\"token directive keyword\">endregion</span></span>\n</code></pre>\n<h2><a id=\"DataGridView_76\"></a>DataGridView删除行</h2>\n<p>右键弹出框，点击【删除行】按钮，即可删除指定行号的行，如果要删除选中行，需要循环遍历DataGridView的SelectedRows对象，获取选中行的行序号，删除即可。</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 删除行</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">btnDeleteRow_Click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">int</span> RowIndex <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//需要删除行的行序号</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">.</span><span class=\"token function\">RemoveAt</span><span class=\"token punctuation\">(</span>RowIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token preprocessor property\">#<span class=\"token directive keyword\">endregion</span></span>\n</code></pre>\n<h2><a id=\"DataGridView_88\"></a>DataGridView清除内容</h2>\n<p>右键弹出框，点击【清除】按钮，即可将选中单元格的内容清空</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 清除选中内容</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">btnClear_Click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token comment\">//根据选中的datagridview单元格，对其内容赋值为\"\"</span>\n    <span class=\"token keyword\">int</span> cellsCount <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span> <span class=\"token comment\">//选中的单元格数量</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> cellsCount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//循环选中的单元格</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Value <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token preprocessor property\">#<span class=\"token directive keyword\">endregion</span></span>\n</code></pre>\n<h2><a id=\"DataGridView_104\"></a>DataGridView复制</h2>\n<p>右键弹出框，点击【复制】按钮，即可将选中表格内容按照一定格式写入电脑剪切板，后续可直接在Excel表中粘贴即可，会保留一样的数据格式。</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 复制选中的单元格内容</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">btnCopy_Click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">try</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n    \tClipboard<span class=\"token punctuation\">.</span><span class=\"token function\">SetText</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span><span class=\"token function\">GetClipboardContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetData</span><span class=\"token punctuation\">(</span>DataFormats<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token preprocessor property\">#<span class=\"token directive keyword\">endregion</span></span>\n</code></pre>\n<h2><a id=\"DataGridView_119\"></a>DataGridView粘贴</h2>\n<p>右键弹出框，点击【粘贴】按钮，即可将剪切板上的内容按照格式依序粘贴到DataGridView的单元格内。它可以自动判断需要的行，然后行自增，可以判断需要的列。列数不够会弹出提示。可以实现直接将Excel表格内容粘贴进来。</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 粘贴剪切板内表格内容到DataGridView</span>\n<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">btnPaste_Click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">object</span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">try</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">string</span> clipboardText <span class=\"token operator\">=</span> Clipboard<span class=\"token punctuation\">.</span><span class=\"token function\">GetText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//获取剪贴板中的内容</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">string</span><span class=\"token punctuation\">.</span><span class=\"token function\">IsNullOrEmpty</span><span class=\"token punctuation\">(</span>clipboardText<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//检测是否为空</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">int</span> colnum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//获取剪切板列数量</span>\n        <span class=\"token keyword\">int</span> rownum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//获取剪切板行数量</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> clipboardText<span class=\"token punctuation\">.</span>Length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//每列</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                colnum<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//每行</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                rownum<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">//粘贴板上的数据来源于EXCEL时，每行末尾都有\\n，来源于DataGridView是，最后一行末尾没有\\n</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span>clipboardText<span class=\"token punctuation\">.</span>Length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//剪切板最后一位</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            rownum<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">//此时，行数列数均比真实行列内容对象少1</span>\n        colnum <span class=\"token operator\">=</span> colnum <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>rownum <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//？？？？？</span>\n        <span class=\"token keyword\">object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">]</span> data<span class=\"token punctuation\">;</span> <span class=\"token comment\">//定义object类型的二维数组</span>\n        data <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">object</span><span class=\"token punctuation\">[</span>rownum <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> colnum <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//根据剪贴板的行列数实例化数组</span>\n        <span class=\"token comment\">//根据创建的data数组的行列数，检测是否当前datagridview行数大于等于data数组行数，少于则新建行</span>\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>rownum <span class=\"token operator\">&gt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>RowCount <span class=\"token operator\">-</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">.</span>Count <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>RowIndex <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//每次创建五行，直到数量足够</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 检查剪切板内的列是否多于datagridview2内的列</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>colnum <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>ColumnCount<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"复制列数大于当前表格列数\\n，请重新复制!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">string</span> rowStr <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//对数组各元素赋值</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> rownum<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;=</span> colnum<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token comment\">//一行中的其它列</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">!=</span> colnum<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    rowStr <span class=\"token operator\">=</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    clipboardText <span class=\"token operator\">=</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span>clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//将前面使用过的部分裁剪</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token comment\">//一行中的最后一列（最后一个不为\\r）</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">==</span> colnum <span class=\"token operator\">&amp;&amp;</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    rowStr <span class=\"token operator\">=</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token comment\">//最后一行的最后一列（最后一个为\\r）</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>j <span class=\"token operator\">==</span> colnum <span class=\"token operator\">&amp;&amp;</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    rowStr <span class=\"token operator\">=</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> rowStr<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">//截取下一行及以后的数据</span>\n            clipboardText <span class=\"token operator\">=</span> clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span>clipboardText<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        clipboardText <span class=\"token operator\">=</span> Clipboard<span class=\"token punctuation\">.</span><span class=\"token function\">GetText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> cellsCount <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span> <span class=\"token comment\">//选中的单元格数量</span>\n        <span class=\"token keyword\">int</span> r1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">[</span>cellsCount <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>RowIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//选中的第一个的行下标</span>\n        <span class=\"token keyword\">int</span> r2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>RowIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//选中最后一个的行下标</span>\n        <span class=\"token keyword\">int</span> c1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">[</span>cellsCount <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>ColumnIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//选中的第一个的列下标</span>\n        <span class=\"token keyword\">int</span> c2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>SelectedCells<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>ColumnIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//选中的最后一个的列下表</span>\n\n        <span class=\"token keyword\">int</span> rowIndex <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">Abs</span><span class=\"token punctuation\">(</span>r2 <span class=\"token operator\">-</span> r1<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//选中单元格的行数量</span>\n        <span class=\"token keyword\">int</span> colIndex <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">Abs</span><span class=\"token punctuation\">(</span>c2 <span class=\"token operator\">-</span> c1<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//选中但换个的列数量</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>colIndex <span class=\"token operator\">!=</span> colnum <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">||</span> rowIndex <span class=\"token operator\">!=</span> rownum <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//选中的行列数量与剪切板内的行列数量不一致</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token comment\">//如果区域不一致，选取选中的第一格单元格作为锚点</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> rownum<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//遍历行</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;=</span> colnum<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//遍历列</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> r1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Cells<span class=\"token punctuation\">[</span>j <span class=\"token operator\">+</span> c1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> rownum<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//遍历行</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;=</span> colnum<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//遍历列</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dtLineHCurvePara<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> r1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Cells<span class=\"token punctuation\">[</span>j <span class=\"token operator\">+</span> c1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token punctuation\">}</span>\n    \n<span class=\"token punctuation\">}</span>\n<span class=\"token preprocessor property\">#<span class=\"token directive keyword\">endregion</span></span>\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}