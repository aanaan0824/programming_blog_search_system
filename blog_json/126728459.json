{"blogid": "126728459", "writerAge": "None", "writerBlogNum": "122", "writerCollect": "3529", "writerComment": "3354", "writerFan": "11751", "writerGrade": "6级", "writerIntegral": "6102", "writerName": "优信电子", "writerProfileAdress": "writer_image\\profile_126728459.jpg", "writerRankTotal": "2412", "writerRankWeekly": "1770", "writerThumb": "590", "writerVisitNum": "416858", "blog_read_count": "70", "blog_time": "于 2022-09-06 17:46:14 发布", "blog_title": "51驱动TTP229矩阵触摸按键模块，16键输入有效模式", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>51驱动TTP229，51驱动矩阵触摸按键模块</h3>\n<ul><li><a href=\"#TTP229_1\">TTP229</a></li><li><ul><li><a href=\"#_5\">输入按键数目选择</a></li><li><a href=\"#_8\">数据输出模式</a></li><li><a href=\"#_10\">按键工作模式</a></li></ul>\n</li><li><a href=\"#_29\">模块和单片机的接线</a></li><li><a href=\"#TTP229_36\">TTP229的时序与程序</a></li><li><ul><li><a href=\"#2_38\">2-线串行通讯方式时序</a></li><li><ul><li><a href=\"#_41\">数据读取程序</a></li><li><a href=\"#_63\">主程序和数据处理程序</a></li></ul>\n</li></ul>\n</li><li><a href=\"#_97\">总结</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"TTP229_1\"></a>TTP229</h1>\n<p>TTP229 TonTouch IC是一款使用电容感应式原理设计的触摸芯片。此芯片内建稳压电路供触摸传感器使用，稳定的触摸效果可以应用在各种不同应用上,人体触摸面板可以通过非导电性绝缘材料连接，主要应用是以取代机械开关或按钮,此芯片可以独立支持8个触摸键或16个触摸键.<br/> <a href=\"https://item.taobao.com/item.htm?spm=a1z10.3-c-s.w4002-21223910208.9.69d56a4buayHQB&amp;id=656059018223\"><img alt=\"在这里插入图片描述\" src=\"image\\a2353c94c69a4d61866782b87f2c777e.png\"/></a></p>\n<center>\n 点击图片购买\n</center>\n<p></p>\n<h2><a id=\"_5\"></a>输入按键数目选择</h2>\n<p>TTP229 具有 8 键输入模式和 16 键输入模式。两者是通过 TP2(KYSEL)是否连接高阻值电阻到VSS 所决定。默认为 TP2(KYSEL)不连接电阻到 VSS 选定为 8 键输入模式,16 键输入模式是连接高阻值电阻到 VSS。<br/> 本模块采用的是TP2连接高阻值到GND。即16 键输入模式；</p>\n<h2><a id=\"_8\"></a>数据输出模式</h2>\n<p>TTP229 具有 8 端口直接输出模式和两种串行输出模式。16 键输入模式下只能使用串行输出方式。本模块采用的是两线输出模式</p>\n<h2><a id=\"_10\"></a>按键工作模式</h2>\n<p>TTP229 具备单键有效和多键有效功能。这些功能由 TP3(SKMS1)和 TP4(SKMS0) 端口设定。全部16 个按键可分为一组或两组进行设置。第一组包括 TP0，TP1，TP2，TP3，TP8，TP9，TP10，TP11 按键。组-2 包括 TP4，TP5，TP6，TP7，TP12，TP13，TP14，TP15 按键。设置方式键下表 ：</p>\n<table><thead><tr><th>TP3</th><th>TP4</th><th>功能说明</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>全部多键有效：设定为一组（16键）</td></tr><tr><td>0</td><td>1</td><td>设置为2组：第一组=&gt;单键；第二组=&gt;多键</td></tr><tr><td>1</td><td>0</td><td>设置为2组：第一组=&gt;单键；第二组=&gt;单键</td></tr><tr><td>1</td><td>1</td><td>全部单键有效：一组（16键）</td></tr></tbody></table>\n<p>备注：1. 设定为一组:<br/> 其包括：TP0~TP15。<br/> 设定为二组：<br/> 第一组其包括=&gt;TP0，TP1，TP2，TP3，TP8，TP9，TP10，TP11。<br/> 第二组其包括=&gt;TP4，TP5，TP6，TP7，TP12，TP13，TP14，TP15。<br/> 2. 当使用 8 模式时 TP0~TP7 为输入键。<br/> 3. TP3 和 TP4 的选择状态，“0”状态是指连接高阻值电阻到 VSS，“1”状态是不连接高阻值电阻到 VSS。<br/> 4. 在单键有效功能下，键的检测承认优先权是依键的扫描顺序(从 TP0 到 TP15)，当同时多键被有效触摸。不是依照键被触摸的强度。<br/> 本模块是TP3和TP4连接高阻值到GND：全部多键有效：设定为一组（16键）</p>\n<h1><a id=\"_29\"></a>模块和单片机的接线</h1>\n<table><thead><tr><th>TTP229</th><th>51单片机</th></tr></thead><tbody><tr><td>V</td><td>5V</td></tr><tr><td>G</td><td>GND</td></tr><tr><td>SCL</td><td>P1_0</td></tr><tr><td>SDA</td><td>P1_1</td></tr></tbody></table>\n<h1><a id=\"TTP229_36\"></a>TTP229的时序与程序</h1>\n<p>模块采用的是2-线串行通讯方式</p>\n<h2><a id=\"2_38\"></a>2-线串行通讯方式时序</h2>\n<p><img alt=\"  \" src=\"image\\f65a5a84989c4717865bb04bd1193ebb.png\"/><br/> 模块设置的是TP1=1，TP2=0，设置为16键模式，低电平有效</p>\n<h3><a id=\"_41\"></a>数据读取程序</h3>\n<pre><code class=\"prism language-c\"><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> <span class=\"token function\">ttp229_read</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> i<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> temp <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\tsdo<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">delay10us</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tsdo<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">delay10us</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\n\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">16</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\ttemp<span class=\"token operator\">&gt;&gt;=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t\tscl<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>sdo<span class=\"token punctuation\">)</span>\n\t\t\ttemp<span class=\"token operator\">|=</span><span class=\"token number\">0x8000</span><span class=\"token punctuation\">;</span>\n\t\tscl<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">return</span> temp<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3><a id=\"_63\"></a>主程序和数据处理程序</h3>\n<pre><code class=\"prism language-c\"><span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token keyword\">unsigned</span>  <span class=\"token keyword\">int</span> a<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t\n\t<span class=\"token function\">UART_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\ta <span class=\"token operator\">=</span> <span class=\"token function\">ttp229_read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0001</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0002</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0004</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0008</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'A'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0010</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'4'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0020</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'5'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0040</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'6'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0080</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'B'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'7'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'9'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x0800</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'C'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x4000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'#'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>a<span class=\"token operator\">==</span><span class=\"token number\">0x8000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">UART_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token char\">'D'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token function\">UART_SendString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\t\t\t\n\t\t<span class=\"token function\">Delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>实验现象：按着对应引脚的按键会在串口打印的对应的值<br/> <img alt=\"在这里插入图片描述\" src=\"image\\5dbb4264eafb40f19d49fb239c7324fb.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\b1a9d352482d4d3c9b51d014925f2c77.png\"/></p>\n<h1><a id=\"_97\"></a>总结</h1>\n<p>模块容易误触，需要手指尽量按在中心位置，背面不能有金属物质；<br/> 需要完整工程的可以在下载留言获取</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}