{"blogid": "126498324", "writerAge": "ç é¾„3å¹´", "writerBlogNum": "85", "writerCollect": "2335", "writerComment": "2028", "writerFan": "4567", "writerGrade": "6çº§", "writerIntegral": "6214", "writerName": "èµµå››å¸æœº", "writerProfileAdress": "writer_image\\profile_126498324.jpg", "writerRankTotal": "2434", "writerRankWeekly": "19", "writerThumb": "2058", "writerVisitNum": "203609", "blog_read_count": "3472", "blog_time": "äºÂ 2022-09-01 10:36:26Â å‘å¸ƒ", "blog_title": "ã€Spring Cloudã€‘æ–°é—»å¤´æ¡å¾®æœåŠ¡é¡¹ç›®ï¼šå¼•å…¥ElasticSearchå»ºç«‹æ–‡ç« æœç´¢ç´¢å¼•", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p><img alt=\"8420b26844034fab91b6df661ae68671.png\" src=\"image\\8420b26844034fab91b6df661ae68671.png\"/></p>\n<p><strong>ä¸ªäººç®€ä»‹ï¼š </strong></p>\n<blockquote>\n<p>&gt; ğŸ“¦ä¸ªäººä¸»é¡µï¼š<a href=\"https://blog.csdn.net/weixin_45750572?type=blog\" title=\"èµµå››å¸æœº\">èµµå››å¸æœº</a><br/> &gt; ğŸ†å­¦ä¹ æ–¹å‘ï¼šJAVAåç«¯å¼€å‘ <br/> &gt; â°å¾€æœŸæ–‡ç« ï¼š<a href=\"https://blog.csdn.net/weixin_45750572/article/details/125534014\" title=\"SpringBooté¡¹ç›®æ•´åˆå¾®ä¿¡æ”¯ä»˜\">SpringBooté¡¹ç›®æ•´åˆå¾®ä¿¡æ”¯ä»˜</a><br/> &gt; ğŸ””åšä¸»æ¨èç½‘ç«™ï¼š<a href=\"https://www.nowcoder.com/link/pc_csdncpt_zssj_sf\" title=\"ç‰›å®¢ç½‘ åˆ·é¢˜|é¢è¯•|æ‰¾å·¥ä½œç¥å™¨\">ç‰›å®¢ç½‘ åˆ·é¢˜|é¢è¯•|æ‰¾å·¥ä½œç¥å™¨</a><br/> &gt; ğŸ“£ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ï¼<br/> &gt; ğŸ’–å–œæ¬¢çš„è¯éº»çƒ¦ç‚¹ç‚¹å…³æ³¨å–”ï¼Œä½ ä»¬çš„æ”¯æŒæ˜¯æˆ‘çš„æœ€å¤§åŠ¨åŠ›ã€‚</p>\n</blockquote>\n<p><strong>å‰è¨€ï¼š</strong></p>\n<blockquote>\n<p>æœ€è¿‘åœ¨åšä¸€ä¸ªåŸºäºSpringCloud+Springboot+Dockerçš„æ–°é—»å¤´æ¡å¾®æœåŠ¡é¡¹ç›®ï¼Œç”¨çš„æ˜¯é»‘é©¬çš„æ•™ç¨‹ï¼Œç°åœ¨é¡¹ç›®å¼€å‘è¿›å…¥äº†å°¾å£°ï¼Œæˆ‘æ‰“ç®—é€šè¿‡å†™æ–‡ç« çš„å½¢å¼è¿›è¡Œæ¢³ç†ä¸€éï¼Œå¹¶ä¸”ä¼šå°†æ¢³ç†è¿‡ç¨‹ä¸­å‘ç°çš„Bugè¿›è¡Œä¿®å¤ï¼Œæœ‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹æˆ‘ä¹Ÿä¼šç»§ç»­åšå‡ºæ”¹è¿›ã€‚è¿™ä¸€ç³»åˆ—çš„æ–‡ç« æˆ‘å°†ä¼šæ”¾å…¥å¾®æœåŠ¡é¡¹ç›®ä¸“æ ä¸­ï¼Œè¿™ä¸ªé¡¹ç›®é€‚åˆåˆšæ¥è§¦å¾®æœåŠ¡çš„äººä½œä¸ºç»ƒæ‰‹é¡¹ç›®ï¼Œå‡å¦‚ä½ å¯¹è¿™ä¸ªé¡¹ç›®æ„Ÿå…´è¶£ä½ å¯ä»¥è®¢é˜…æˆ‘çš„ä¸“æ è¿›è¡ŒæŸ¥çœ‹ï¼Œéœ€è¦èµ„æ–™å¯ä»¥ç§ä¿¡æˆ‘ï¼Œå½“ç„¶è¦æ˜¯èƒ½ç»™æˆ‘ç‚¹ä¸ªå°å°çš„å…³æ³¨å°±æ›´å¥½äº†ï¼Œä½ ä»¬çš„æ”¯æŒæ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚</p>\n<p> å¦‚æœä½ æƒ³è¦ä¸€ä¸ªå¯ä»¥ç³»ç»Ÿå­¦ä¹ çš„ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘æ¨èçš„æ˜¯ç‰›å®¢ç½‘ï¼Œä¸ªäººæ„Ÿè§‰ç”¨ç€è¿˜æ˜¯ä¸é”™çš„ï¼Œé¡µé¢å¾ˆæ•´æ´ï¼Œè€Œä¸”å†…å®¹ä¹Ÿå¾ˆå…¨é¢ï¼Œè¯­æ³•ç»ƒä¹ ï¼Œç®—æ³•é¢˜ç»ƒä¹ ï¼Œé¢è¯•çŸ¥è¯†æ±‡æ€»ç­‰ç­‰éƒ½æœ‰ï¼Œè®ºå›ä¹Ÿå¾ˆæ´»è·ƒï¼Œä¼ é€é—¨é“¾æ¥ï¼š<a href=\"https://www.nowcoder.com/link/pc_csdncpt_zssj_sf\" title=\"ç‰›å®¢åˆ·é¢˜ç¥å™¨\">ç‰›å®¢åˆ·é¢˜ç¥å™¨</a></p>\n</blockquote>\n<p id=\"main-toc\"><strong>ç›®å½•</strong></p>\n<p id=\"%E4%B8%80%EF%BC%9A%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%80%EF%BC%9A%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90\">ä¸€ï¼šéœ€æ±‚åˆ†æ</a></p>\n<p id=\"%E4%BA%8C%EF%BC%9A%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%8C%EF%BC%9A%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B\">äºŒï¼šæŠ€æœ¯é€‰å‹</a></p>\n<p id=\"1.%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94-toc\" style=\"margin-left:40px;\"><a href=\"#1.%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94\">1.æ–¹æ¡ˆå¯¹æ¯”</a></p>\n<p id=\"2.ES%E7%AE%80%E4%BB%8B-toc\" style=\"margin-left:40px;\"><a href=\"#2.ES%E7%AE%80%E4%BB%8B\">2.ESç®€ä»‹</a></p>\n<p id=\"%E4%B8%89%EF%BC%9AES%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%89%EF%BC%9AES%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\">ä¸‰ï¼šESç¯å¢ƒæ­å»º</a></p>\n<p id=\"1.%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F-toc\" style=\"margin-left:40px;\"><a href=\"#1.%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F\">1.æ‹‰å–é•œåƒ</a></p>\n<p id=\"2.%20%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8-toc\" style=\"margin-left:40px;\"><a href=\"#2.%20%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8\">2. åˆ›å»ºå®¹å™¨</a></p>\n<p id=\"3.%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8%20ik-toc\" style=\"margin-left:40px;\"><a href=\"#3.%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8%20ik\">3.é…ç½®ä¸­æ–‡åˆ†è¯å™¨ ik</a></p>\n<p id=\"%E5%9B%9B%EF%BC%9A%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%9B%9B%EF%BC%9A%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0\">å››ï¼šä»£ç å®ç°</a></p>\n<p id=\"1.%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-toc\" style=\"margin-left:40px;\"><a href=\"#1.%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF\">1.å®ç°æ€è·¯</a></p>\n<p id=\"2.%E5%88%9B%E5%BB%BA%E6%98%A0%E5%B0%84-toc\" style=\"margin-left:40px;\"><a href=\"#2.%E5%88%9B%E5%BB%BA%E6%98%A0%E5%B0%84\">2.åˆ›å»ºæ˜ å°„</a></p>\n<p id=\"3.%E6%95%B0%E6%8D%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%B0%E7%B4%A2%E5%BC%95%E5%BA%93-toc\" style=\"margin-left:40px;\"><a href=\"#3.%E6%95%B0%E6%8D%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%B0%E7%B4%A2%E5%BC%95%E5%BA%93\">3.æ•°æ®åˆå§‹åŒ–åˆ°ç´¢å¼•åº“</a></p>\n<p id=\"4.%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0-toc\" style=\"margin-left:40px;\"><a href=\"#4.%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0\">4.æœç´¢åŠŸèƒ½å®ç°</a></p>\n<p id=\"5.%E6%B5%8B%E8%AF%95-toc\" style=\"margin-left:40px;\"><a href=\"#5.%E6%B5%8B%E8%AF%95\">5.æµ‹è¯•</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<h1 id=\"%E4%B8%80%EF%BC%9A%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90\">ä¸€ï¼šéœ€æ±‚åˆ†æ</h1>\n<p><img alt=\"\" src=\"image\\8788dd13337743dea80433d79d477bc5.png\"/></p>\n<p>        åœ¨Appç«¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¦–é¡µçš„é¡¶éƒ¨æœç´¢æ é‡Œè¾“å…¥å…³é”®å­—è¿›è¡Œæ–‡ç« çš„æœç´¢ï¼Œè€Œä¸”å¯¹äºæœç´¢ç»“æœæˆ‘ä»¬ä¼šå¯¹å‘½ä¸­çš„æ ‡é¢˜è¿›è¡Œé«˜äº®å±•ç¤ºï¼Œå¯¹äºæ ‡é¢˜æ²¡å‘½ä¸­ä½†æ˜¯æ–‡ç« å†…å®¹å‘½ä¸­çš„æ–‡ç« æˆ‘ä»¬ä¹Ÿè¦å°†å…¶å±•ç¤ºå‡ºæ¥ï¼Œå¹¶ä¸”å½“ç”¨æˆ·ç‚¹å‡»æœç´¢ç»“æœä¸­æŸä¸€æ¡æ–‡ç« çš„æ—¶å€™èƒ½å¤Ÿå®ç°é¡µé¢è·³è½¬æŸ¥çœ‹æ–‡ç« è¯¦æƒ…çš„åŠŸèƒ½ã€‚</p>\n<h1 id=\"%E4%BA%8C%EF%BC%9A%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B\">äºŒï¼šæŠ€æœ¯é€‰å‹</h1>\n<h2 id=\"1.%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94\">1.æ–¹æ¡ˆå¯¹æ¯”</h2>\n<p>        è·Ÿä»¥å¾€ä¸ä¸€æ ·çš„æ˜¯ï¼Œä»¥å‰æˆ‘ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ç”¨SQLè¯­å¥è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¾€å¾€ä¹Ÿèƒ½è¾¾åˆ°ä¸é”™çš„æ•ˆæœã€‚ä½†æ˜¯è¿™åªé€‚ç”¨äºæ•°æ®é‡æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œè€Œä¸”æ•°æ®åº“æ¨¡ç³ŠæŸ¥è¯¢è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æˆ‘è¦æœç´¢â€œä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶â€ï¼Œè¿™æ—¶å€™æ­£å¥½æœ‰ä¸€ç¯‡æ–‡ç« ä¸­åŒ…å«æœ‰â€œæ¶ˆæ¯ä¸­é—´ä»¶çš„ä»‹ç»â€çš„æ–‡å­—å†…å®¹ï¼Œä½†æ˜¯è¿™æ—¶å€™ä½¿ç”¨SQLçš„æ¨¡ç³ŠæŸ¥è¯¢æ˜¯æŸ¥è¯¢ä¸åˆ°è¿™ä¸ªç»“æœçš„ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¼Šç«¯ã€‚</p>\n<p>        é™¤æ­¤ä¹‹å¤–ï¼Œå½“æ•°æ®åº“ä¸­çš„æ–‡æ¡£æ•°è¾¾åˆ°ä¸Šä¸‡æ¡æ—¶å€™ï¼Œé‡‡ç”¨æ¨¡ç³ŠæŸ¥è¯¢å°±å·²ç»å¾ˆæ…¢äº†ï¼Œè¦æ˜¯æ•°æ®è¾¾åˆ°ä¼ä¸šçº§çš„è¯ï¼Œè¿™æ ·çš„æ£€ç´¢é€Ÿåº¦è‚¯å®šæ˜¯è®©äººå—ä¸äº†çš„ã€‚å› ä¸ºé‡‡ç”¨æ¨¡ç³ŠæŸ¥è¯¢è¿™æ—¶å€™æ•°æ®åº“å¹¶ä¸çŸ¥é“é‚£äº›æ•°æ®åŒ…å«äº†è¿™ä¸ªå…³é”®è¯ï¼Œåªèƒ½ä¸€æ¡æ•°æ®ä¸€æ¡æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œä¸”è¿˜éœ€è¦è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…ï¼Œå‡å¦‚æˆ‘æœç´¢â€œKafkaâ€è¿™ä¸€å…³é”®è¯ï¼Œå°±ç®—æ•°æ®åº“ä¸­ä¸€ä¸‡æ¡æ•°æ®åªæœ‰ä¸€æ¡æ˜¯åŒ…å«æœ‰è¿™ä¸ªè¯çš„é‡‡ç”¨æ¨¡ç³ŠæŸ¥è¯¢è¿˜æ˜¯ä¼šæ£€ç´¢æ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œè¿™æ ·åšæ˜¾ç„¶æ˜¯å¾ˆè´¹æ—¶è´¹åŠ›çš„ã€‚</p>\n<p>        è€Œé‡‡ç”¨ESï¼ˆElasticSearchï¼‰ä¹‹åèƒ½å¾ˆå¥½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå³ä½¿æ˜¯TBçº§çš„æ•°æ®ä¹Ÿèƒ½åœ¨æ¯«ç§’å†…è¿”å›ç»“æœã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆESèƒ½å…·æœ‰å¦‚æ­¤é«˜çš„æ•ˆç‡å‘¢ï¼Ÿ</p>\n<h2 id=\"2.ES%E7%AE%80%E4%BB%8B\">2.ESç®€ä»‹</h2>\n<p>        Elasticsearchæ˜¯ä¸€ä¸ªå¼€æºçš„é«˜æ‰©å±•çš„åˆ†å¸ƒå¼å…¨æ–‡æ£€ç´¢å¼•æ“ï¼Œå®ƒå¯ä»¥è¿‘ä¹å®æ—¶çš„å­˜å‚¨ã€æ£€ç´¢æ•°æ®ï¼›æœ¬èº«æ‰©å±•æ€§å¾ˆå¥½ï¼Œå¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«çš„æ•°æ®ã€‚ æˆ‘ä»¬çŸ¥é“Javaæ˜¯é¢å‘å¯¹è±¡çš„ï¼Œè€ŒElasticsearchæ˜¯é¢å‘æ–‡æ¡£çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ–‡æ¡£æ˜¯æ‰€æœ‰å¯æœç´¢æ•°æ®çš„æœ€å°å•å…ƒã€‚ESçš„æ–‡æ¡£å°±åƒMySqlä¸­çš„ä¸€æ¡è®°å½•ï¼Œåªæ˜¯ESçš„æ–‡æ¡£ä¼šè¢«åºåˆ—åŒ–æˆjsonæ ¼å¼ï¼Œä¿å­˜åœ¨Elasticsearchä¸­ã€‚</p>\n<p>         ESæ˜¯åŸºäºå€’æ’ç´¢å¼•çš„ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æµ·é‡çš„æ–‡æ¡£ä¸­åªæœ‰æ–‡æ¡£Aã€Bã€Cã€DåŒ…å«æœ‰â€œKafkaâ€è¿™ä¸ªå…³é”®è¯ï¼Œå‡å¦‚ç”¨æˆ·æœç´¢â€œKafkaâ€ï¼Œè¿™æ—¶å€™ESå°±ä¼šç«‹å³è¿”å›Aã€Bã€Cã€Dè¿™å››ä¸ªæ–‡æ¡£ï¼Œä»è€Œé¿å…æŠŠæ—¶é—´æµªè´¹åœ¨æ£€ç´¢å…¶ä»–æ–‡æ¡£ä¸Šé¢ã€‚</p>\n<p>        ç”±äºESå¯¹ä¸­æ–‡çš„åˆ†è¯ä¸å¤ªå‹å¥½ï¼Œå› æ­¤éœ€è¦è‡ªå·±é…ç½®ä¸€ä¸ªä¸­æ–‡åˆ†è¯å™¨ikã€‚</p>\n<h1 id=\"%E4%B8%89%EF%BC%9AES%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA\">ä¸‰ï¼šESç¯å¢ƒæ­å»º</h1>\n<h2 id=\"1.%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F\">1.æ‹‰å–é•œåƒ</h2>\n<pre><code>docker pull elasticsearch:7.4.0</code></pre>\n<h2 id=\"2.%20%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8\">2. åˆ›å»ºå®¹å™¨</h2>\n<pre><code>docker run -id --name elasticsearch -d --restart=always -p 9200:9200 -p 9300:9300 -v /usr/share/elasticsearch/plugins:/usr/share/elasticsearch/plugins -e \"discovery.type=single-node\" elasticsearch:7.4.0</code></pre>\n<h2 id=\"3.%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8%20ik\">3.é…ç½®ä¸­æ–‡åˆ†è¯å™¨ ik</h2>\n<p>å› ä¸ºåœ¨åˆ›å»ºelasticsearchå®¹å™¨çš„æ—¶å€™ï¼Œæ˜ å°„äº†ç›®å½•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šè¿›è¡Œé…ç½®ikä¸­æ–‡åˆ†è¯å™¨</p>\n<p>åœ¨å»é€‰æ‹©ikåˆ†è¯å™¨çš„æ—¶å€™ï¼Œéœ€è¦ä¸elasticsearchçš„ç‰ˆæœ¬å¥½å¯¹åº”ä¸Šã€‚</p>\n<p>æŠŠèµ„æ–™ä¸­çš„<code>elasticsearch-analysis-ik-7.4.0.zip</code>ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Š,æ”¾åˆ°å¯¹åº”ç›®å½•ï¼ˆpluginsï¼‰è§£å‹</p>\n<pre><code>#åˆ‡æ¢ç›®å½•\ncd /usr/share/elasticsearch/plugins\n#æ–°å»ºç›®å½•\nmkdir analysis-ik\ncd analysis-ik\n#rootæ ¹ç›®å½•ä¸­æ‹·è´æ–‡ä»¶\nmv elasticsearch-analysis-ik-7.4.0.zip /usr/share/elasticsearch/plugins/analysis-ik\n#è§£å‹æ–‡ä»¶\ncd /usr/share/elasticsearch/plugins/analysis-ik\nunzip elasticsearch-analysis-ik-7.4.0.zip</code></pre>\n<h1 id=\"%E5%9B%9B%EF%BC%9A%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0\">å››ï¼šä»£ç å®ç°</h1>\n<h2 id=\"1.%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF\">1.å®ç°æ€è·¯</h2>\n<p>        ä¸ºäº†åŠ å¿«æ£€ç´¢é€Ÿåº¦ï¼Œæœç´¢å…³é”®è¯æ—¶å€™ä¸ä¼šåˆ°æ•°æ®åº“ä¸­ç›´æ¥æœç´¢ï¼Œè€Œæ˜¯åˆ°ESç´¢å¼•åº“ä¸­è¿›è¡Œæ£€ç´¢ï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºå¥½ ç´¢å¼•åº“ï¼Œç„¶åéœ€è¦å¯¹ä»¥å‰ä¸Šä¼ çš„æ–‡ç« åˆ›å»ºç´¢å¼•ï¼Œå½“åç»­æœ‰æ–°æ–‡ç« è¦ä¸Šä¼ æ—¶å€™ï¼Œæˆ‘ä»¬å°±é‡‡å–å®æ—¶åˆ›å»ºç´¢å¼•çš„ç­–ç•¥ã€‚å½“ç”¨æˆ·è¾“å…¥å…³é”®è¯è¿›è¡Œæœç´¢æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¼šåˆ°ESä¸­è¿›è¡Œæ£€ç´¢ï¼Œå‡å¦‚æ£€ç´¢ç»“æœä¸­æ ‡é¢˜å«æœ‰è¯¥å…³é”®è¯ï¼Œåˆ™å°†è¯¥æ ‡é¢˜ä¸­è¯¥å…³é”®è¯é«˜äº®è¿›è¡Œè¿”å›ï¼Œè‹¥æ ‡é¢˜ä¸åŒ…å«å…³é”®è¯ä½†æ˜¯å†…å®¹åŒ…å«å…³é”®è¯ä¹Ÿå°†ç»“æœè¿”å›ï¼Œå¦‚è‹¥ä¸ç„¶åˆ™è¯´æ˜æ²¡æœ‰æ£€ç´¢ç»“æœï¼Œæµç¨‹å›¾è§ä¸‹å›¾ï¼š</p>\n<p><img alt=\"\" height=\"278\" src=\"image\\1aefeb0a53f340de87b528ce9474e056.png\" width=\"692\"/></p>\n<h2 id=\"2.%E5%88%9B%E5%BB%BA%E6%98%A0%E5%B0%84\">2.åˆ›å»ºæ˜ å°„</h2>\n<p>ä½¿ç”¨apifoxæ·»åŠ æ˜ å°„</p>\n<p> <img alt=\"\" height=\"381\" src=\"image\\c762566614534ca4a914e03f634420bb.png\" width=\"1158\"/>  </p>\n<p>æ˜ å°„å†…å®¹ï¼š</p>\n<pre><code>{\n    \"mappings\":{\n        \"properties\":{\n            \"id\":{\n                \"type\":\"long\"\n            },\n            \"publishTime\":{\n                \"type\":\"date\"\n            },\n            \"layout\":{\n                \"type\":\"integer\"\n            },\n            \"images\":{\n                \"type\":\"keyword\",\n                \"index\": false\n            },\n            \"staticUrl\":{\n                \"type\":\"keyword\",\n                \"index\": false\n            },\n            \"authorId\": {\n                \"type\": \"long\"\n            },\n            \"authorName\": {\n                \"type\": \"text\"\n            },\n            \"title\":{\n                \"type\":\"text\",\n                \"analyzer\":\"ik_smart\"\n            },\n            \"content\":{\n                \"type\":\"text\",\n                \"analyzer\":\"ik_smart\"\n            }\n        }\n    }\n}</code></pre>\n<p> æœ€åä¸¤é¡¹è¡¨ç¤ºå¯¹æ–‡ç« æ ‡é¢˜å’Œå†…å®¹åˆ›å»ºç´¢å¼•ï¼Œå…¶ä»–å­—æ®µå‡ç”¨äºå±•ç¤ºä½¿ç”¨ã€‚</p>\n<h2 id=\"3.%E6%95%B0%E6%8D%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%B0%E7%B4%A2%E5%BC%95%E5%BA%93\">3.æ•°æ®åˆå§‹åŒ–åˆ°ç´¢å¼•åº“</h2>\n<p>â‘ åœ¨tbug-headlines-testä¸­åˆ›å»ºæ–°æ¨¡å—es-init</p>\n<p> <img alt=\"\" height=\"560\" src=\"image\\cd5daec9f5964f82a9bc998f338dee59.png\" width=\"451\"/> </p>\n<p>â‘¡ç›¸å…³é…ç½®</p>\n<pre><code>server:\n  port: 9999\nspring:\n  application:\n    name: es-article\n\n  datasource:\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/headlines_article?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC\n    username: root\n    password: 43\n# è®¾ç½®Mapperæ¥å£æ‰€å¯¹åº”çš„XMLæ–‡ä»¶ä½ç½®ï¼Œå¦‚æœä½ åœ¨Mapperæ¥å£ä¸­æœ‰è‡ªå®šä¹‰æ–¹æ³•ï¼Œéœ€è¦è¿›è¡Œè¯¥é…ç½®\nmybatis-plus:\n  mapper-locations: classpath*:mapper/*.xml\n  # è®¾ç½®åˆ«ååŒ…æ‰«æè·¯å¾„ï¼Œé€šè¿‡è¯¥å±æ€§å¯ä»¥ç»™åŒ…ä¸­çš„ç±»æ³¨å†Œåˆ«å\n  type-aliases-package: com.my.model.article.pojos\n\n\n#è‡ªå®šä¹‰elasticsearchè¿æ¥é…ç½®\nelasticsearch:\n  host: 49.23.192\n  port: 9200\n</code></pre>\n<p>â‘¢pojoåŠmapperç±»</p>\n<p>pojo</p>\n<pre><code class=\"language-java\">package com.my.es.pojo;\n\nimport lombok.Data;\nimport java.util.Date;\n\n@Data\npublic class SearchArticleVo {\n\n    // æ–‡ç« id\n    private Long id;\n    // æ–‡ç« æ ‡é¢˜\n    private String title;\n    // æ–‡ç« å‘å¸ƒæ—¶é—´\n    private Date publishTime;\n    // æ–‡ç« å¸ƒå±€\n    private Integer layout;\n    // å°é¢\n    private String images;\n    // ä½œè€…id\n    private Long authorId;\n    // ä½œè€…åè¯\n    private String authorName;\n    //é™æ€url\n    private String staticUrl;\n    //æ–‡ç« å†…å®¹\n    private String content;\n\n}</code></pre>\n<p>mapper </p>\n<pre><code class=\"language-java\">package com.my.es.mapper;\n\nimport com.baomidou.mybatisplus.core.mapper.BaseMapper;\nimport com.my.es.pojo.SearchArticleVo;\nimport com.my.model.article.pojos.ApArticle;\nimport org.apache.ibatis.annotations.Mapper;\n\nimport java.util.List;\n\n@Mapper\npublic interface ApArticleMapper extends BaseMapper&lt;ApArticle&gt; {\n\n    List&lt;SearchArticleVo&gt; loadArticleList();\n\n}\n</code></pre>\n<p>XML </p>\n<pre><code class=\"language-XML\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;\n&lt;mapper namespace=\"com.my.es.mapper.ApArticleMapper\"&gt;\n\n    &lt;resultMap id=\"resultMap\" type=\"com.my.es.pojo.SearchArticleVo\"&gt;\n        &lt;id column=\"id\" property=\"id\"/&gt;\n        &lt;result column=\"title\" property=\"title\"/&gt;\n        &lt;result column=\"author_id\" property=\"authorId\"/&gt;\n        &lt;result column=\"author_name\" property=\"authorName\"/&gt;\n        &lt;result column=\"layout\" property=\"layout\"/&gt;\n        &lt;result column=\"images\" property=\"images\"/&gt;\n        &lt;result column=\"publish_time\" property=\"publishTime\"/&gt;\n        &lt;result column=\"static_url\" property=\"staticUrl\"/&gt;\n        &lt;result column=\"content\" property=\"content\"/&gt;\n    &lt;/resultMap&gt;\n    &lt;select id=\"loadArticleList\" resultMap=\"resultMap\"&gt;\n        SELECT\n            aa.*, aacon.content\n        FROM\n            `ap_article` aa,\n            ap_article_config aac,\n            ap_article_content aacon\n        WHERE\n            aa.id = aac.article_id\n          AND aa.id = aacon.article_id\n          AND aac.is_delete != 1\n          AND aac.is_down != 1\n\n    &lt;/select&gt;\n\n&lt;/mapper&gt;</code></pre>\n<p>â‘£æ‰¹é‡å¯¼å…¥</p>\n<pre><code class=\"language-java\">package com.my.es;\n\nimport com.alibaba.fastjson.JSON;\nimport com.my.es.mapper.ApArticleMapper;\nimport com.my.es.pojo.SearchArticleVo;\nimport org.elasticsearch.action.bulk.BulkRequest;\nimport org.elasticsearch.action.index.IndexRequest;\nimport org.elasticsearch.client.RequestOptions;\nimport org.elasticsearch.client.RestHighLevelClient;\nimport org.elasticsearch.common.xcontent.XContentType;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.test.context.SpringBootTest;\nimport org.springframework.test.context.junit4.SpringRunner;\n\nimport java.util.List;\n\n@SpringBootTest\n@RunWith(SpringRunner.class)\npublic class ApArticleTest {\n    @Autowired\n    private ApArticleMapper apArticleMapper;\n\n    @Autowired\n    private RestHighLevelClient restHighLevelClient;\n    /**\n     * æ³¨æ„ï¼šæ•°æ®é‡çš„å¯¼å…¥ï¼Œå¦‚æœæ•°æ®é‡è¿‡å¤§ï¼Œéœ€è¦åˆ†é¡µå¯¼å…¥\n     * @throws Exception\n     */\n    @Test\n    public void init() throws Exception {\n        //1.æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ç« æ•°æ®\n        List&lt;SearchArticleVo&gt; searchArticleVos = apArticleMapper.loadArticleList();\n\n        //2.æ‰¹é‡å¯¼å…¥åˆ°esç´¢å¼•åº“\n\n        BulkRequest bulkRequest = new BulkRequest(\"app_info_article\");\n\n        for (SearchArticleVo searchArticleVo : searchArticleVos) {\n\n            IndexRequest indexRequest = new IndexRequest().id(searchArticleVo.getId().toString())\n                    .source(JSON.toJSONString(searchArticleVo), XContentType.JSON);\n\n            //æ‰¹é‡æ·»åŠ æ•°æ®\n            bulkRequest.add(indexRequest);\n\n        }\n        restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);\n\n    }\n\n}</code></pre>\n<p>æ³¨æ„è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå…¨å±€ç´¢å¼•åç§°app_info_article</p>\n<h2 id=\"4.%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0\">4.æœç´¢åŠŸèƒ½å®ç°</h2>\n<p>â‘ å¯¼å…¥tbug-headlines-searchæ¨¡å—</p>\n<p> <img alt=\"\" height=\"736\" src=\"image\\2abaef67d34e45bdadce2e241916903b.png\" width=\"465\"/> </p>\n<p>â‘¡åœ¨tbug-headlines-serviceä¸­æ·»åŠ ä¾èµ–</p>\n<pre><code class=\"language-XML\">&lt;!--elasticsearch--&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;\n    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;\n    &lt;version&gt;7.4.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;\n    &lt;artifactId&gt;elasticsearch-rest-client&lt;/artifactId&gt;\n    &lt;version&gt;7.4.0&lt;/version&gt;\n&lt;/dependency&gt;\n&lt;dependency&gt;\n    &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;\n    &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;\n    &lt;version&gt;7.4.0&lt;/version&gt;\n&lt;/dependency&gt;</code></pre>\n<p>â‘¢nacosé…ç½®</p>\n<pre><code class=\"language-XML\">spring:\n  autoconfigure:\n    exclude: org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration\nelasticsearch:\n  host: 49.234.52.192\n  port: 9200</code></pre>\n<p>â‘£æœç´¢æ¥å£å®šä¹‰</p>\n<pre><code class=\"language-java\">package com.my.search.controller.v1;\n\nimport com.my.model.common.dtos.ResponseResult;\nimport com.my.model.search.dtos.UserSearchDto;\nimport com.my.search.service.ArticleSearchService;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\nimport java.io.IOException;\n\n@RestController\n@RequestMapping(\"/api/v1/article/search\")\npublic class ArticleSearchController {\n    @Autowired\n    private ArticleSearchService articleSearchService;\n\n    @PostMapping(\"/search\")\n    public ResponseResult search(@RequestBody UserSearchDto dto) throws IOException {\n        return articleSearchService.search(dto);\n    }\n}</code></pre>\n<p>â‘¤dto</p>\n<pre><code class=\"language-java\">package com.my.model.search.dtos;\n\nimport lombok.Data;\n\nimport java.util.Date;\n\n\n@Data\npublic class UserSearchDto {\n\n    /**\n    * æœç´¢å…³é”®å­—\n    */\n    String searchWords;\n    /**\n    * å½“å‰é¡µ\n    */\n    int pageNum;\n    /**\n    * åˆ†é¡µæ¡æ•°\n    */\n    int pageSize;\n    /**\n    * æœ€å°æ—¶é—´\n    */\n    Date minBehotTime;\n\n    public int getFromIndex(){\n        if(this.pageNum&lt;1)return 0;\n        if(this.pageSize&lt;1) this.pageSize = 10;\n        return this.pageSize * (pageNum-1);\n    }\n}</code></pre>\n<p>â‘¥ä¸šåŠ¡å±‚å®ç°</p>\n<pre><code class=\"language-java\">package com.my.search.service;\n\n\nimport com.my.model.common.dtos.ResponseResult;\nimport com.my.model.search.dtos.UserSearchDto;\n\nimport java.io.IOException;\n\npublic interface ArticleSearchService {\n\n    /**\n     ESæ–‡ç« åˆ†é¡µæœç´¢\n     @return\n     */\n    ResponseResult search(UserSearchDto userSearchDto) throws IOException;\n}</code></pre>\n<pre><code class=\"language-java\">package com.my.search.service.serviceImpl;\n\nimport com.alibaba.fastjson.JSON;\nimport com.my.model.common.dtos.ResponseResult;\nimport com.my.model.common.enums.AppHttpCodeEnum;\nimport com.my.model.search.dtos.UserSearchDto;\nimport com.my.model.user.pojos.ApUser;\nimport com.my.search.service.ApUserSearchService;\nimport com.my.search.service.ArticleSearchService;\nimport com.my.utils.thread.AppThreadLocalUtils;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.lang3.StringUtils;\nimport org.elasticsearch.action.search.SearchRequest;\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.client.RequestOptions;\nimport org.elasticsearch.client.RestHighLevelClient;\nimport org.elasticsearch.common.text.Text;\nimport org.elasticsearch.index.query.*;\nimport org.elasticsearch.search.SearchHit;\nimport org.elasticsearch.search.builder.SearchSourceBuilder;\nimport org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;\nimport org.elasticsearch.search.sort.SortOrder;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.util.Map;\n\n@Slf4j\n@Service\npublic class ArticleSearchServiceImpl implements ArticleSearchService {\n    @Autowired\n    private RestHighLevelClient restHighLevelClient;\n    @Autowired\n    private ApUserSearchService apUserSearchService;\n\n    /**\n     * esæ–‡ç« åˆ†é¡µæ£€ç´¢\n     *\n     * @param dto\n     * @return\n     */\n    @Override\n    public ResponseResult search(UserSearchDto dto) throws IOException {\n\n        // 1.æ£€æŸ¥å‚æ•°\n        if (dto == null || StringUtils.isBlank(dto.getSearchWords())) {\n            return ResponseResult.errorResult(AppHttpCodeEnum.PARAM_INVALID);\n        }\n        log.info(\"æ–‡ç« æŸ¥è¯¢...\");\n\n        //å¼‚æ­¥è°ƒç”¨ä¿å­˜å†å²è®°å½•\n        ApUser user = AppThreadLocalUtils.getUser();\n        //ç”¨æˆ·ä¿¡æ¯ä¸ä¸ºç©ºå¹¶ä¸”ä¸ºé¦–é¡µæœç´¢æ‰è¿›è¡Œä¿å­˜\n        if(user != null &amp;&amp; dto.getFromIndex() == 0) {\n            apUserSearchService.insert(dto.getSearchWords(),user.getId());\n        }\n\n        // 2.è®¾ç½®æŸ¥è¯¢æ¡ä»¶\n        SearchRequest searchRequest = new SearchRequest(\"app_info_article\");\n        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();\n\n        // å¸ƒå°”æŸ¥è¯¢\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n\n        // å…³é”®å­—çš„åˆ†è¯ä¹‹åæŸ¥è¯¢\n        QueryStringQueryBuilder queryStringQueryBuilder = QueryBuilders.queryStringQuery\n                (dto.getSearchWords()).field(\"title\").field(\"content\").defaultOperator(Operator.OR);\n        boolQueryBuilder.must(queryStringQueryBuilder);\n\n        // æŸ¥è¯¢å°äºmindateçš„æ•°æ®\n        RangeQueryBuilder rangeQueryBuilder = QueryBuilders.rangeQuery(\"publishTime\")\n                .lt(dto.getMinBehotTime().getTime());\n        boolQueryBuilder.filter(rangeQueryBuilder);\n\n        // åˆ†é¡µæŸ¥è¯¢\n        searchSourceBuilder.from(0);\n        searchSourceBuilder.size(dto.getPageSize());\n\n        // æŒ‰ç…§å‘å¸ƒæ—¶é—´å€’åºæŸ¥è¯¢\n        searchSourceBuilder.sort(\"publishTime\", SortOrder.DESC);\n\n        // è®¾ç½®é«˜äº®  title\n        HighlightBuilder highlightBuilder = new HighlightBuilder();\n        highlightBuilder.field(\"title\");\n        highlightBuilder.preTags(\"&lt;font style='color: red; font-size: inherit;'&gt;\");\n        highlightBuilder.postTags(\"&lt;/font&gt;\");\n        searchSourceBuilder.highlighter(highlightBuilder);\n\n\n        searchSourceBuilder.query(boolQueryBuilder);\n        searchRequest.source(searchSourceBuilder);\n        SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);\n\n\n        // 3.ç»“æœå°è£…è¿”å›\n\n        List&lt;Map&gt; list = new ArrayList&lt;&gt;();\n\n        SearchHit[] hits = searchResponse.getHits().getHits();\n        for (SearchHit hit : hits) {\n            String json = hit.getSourceAsString();\n            Map map = JSON.parseObject(json, Map.class);\n            // å¤„ç†é«˜äº®\n            if (hit.getHighlightFields() != null &amp;&amp; hit.getHighlightFields().size() &gt; 0) {\n                Text[] titles = hit.getHighlightFields().get(\"title\").getFragments();\n                String title = StringUtils.join(titles);\n                // é«˜äº®æ ‡é¢˜\n                map.put(\"h_title\", title);\n            } else {\n                // åŸå§‹æ ‡é¢˜\n                map.put(\"h_title\", map.get(\"title\"));\n            }\n            list.add(map);\n        }\n\n        return ResponseResult.okResult(list);\n    }\n}\n</code></pre>\n<p>â‘¦åœ¨appç½‘å…³æ·»åŠ å¦‚ä¸‹é…ç½®</p>\n<pre><code class=\"language-java\">        #æœç´¢å¾®æœåŠ¡\n        - id: headlines-search\n          uri: lb://headlines-search\n          predicates:\n            - Path=/search/**\n          filters:\n            - StripPrefix= 1</code></pre>\n<h2 id=\"5.%E6%B5%8B%E8%AF%95\">5.æµ‹è¯•</h2>\n<p>        å¯åŠ¨é¡¹ç›®è¿›è¡Œæµ‹è¯•ï¼Œè‡³å°‘è¦å¯åŠ¨æ–‡ç« å¾®æœåŠ¡ï¼Œç”¨æˆ·å¾®æœåŠ¡ï¼Œæœç´¢å¾®æœåŠ¡ï¼Œappç½‘å…³å¾®æœåŠ¡ï¼Œappå‰ç«¯å·¥ç¨‹ï¼Œç”±äºæˆ‘çš„äº‘æœåŠ¡å™¨å·²ç»è¿‡æœŸäº†ï¼Œæ‰€ä»¥æˆ‘å°±ä¸è¿›è¡Œå±•ç¤ºäº†ï¼Œä»£ç æ˜¯æ²¡é—®é¢˜çš„ï¼Œæœ‰é—®é¢˜çš„å¯ä»¥éšæ—¶ç§ä¿¡æˆ‘ã€‚</p>\n<p></p>\n<p>ä¸‹ç¯‡é¢„å‘Šï¼šæ–‡ç« è‡ªåŠ¨æ„å»ºç´¢å¼•&amp;æœç´¢è®°å½•&amp;å…³é”®è¯è”æƒ³</p>\n<p> å‹æƒ…é“¾æ¥ï¼š <a class=\"link-info\" href=\"https://www.nowcoder.com/link/pc_csdncpt_zssj_sf\" title=\"ç‰›å®¢ç½‘  åˆ·é¢˜|é¢è¯•|æ‰¾å·¥ä½œç¥å™¨\">ç‰›å®¢ç½‘  åˆ·é¢˜|é¢è¯•|æ‰¾å·¥ä½œç¥å™¨</a></p>\n</div>\n</div>"}