{"blogid": "123928000", "writerAge": "码龄4年", "writerBlogNum": "21", "writerCollect": "327", "writerComment": "17", "writerFan": "467", "writerGrade": "2级", "writerIntegral": "323", "writerName": "明知山有虎 不去明知山", "writerProfileAdress": "writer_image\\profile_123928000.jpg", "writerRankTotal": "41629", "writerRankWeekly": "217033", "writerThumb": "95", "writerVisitNum": "29647", "blog_read_count": "5821", "blog_time": "已于 2022-04-07 19:08:58 修改", "blog_title": "从零开始—仿牛客网讨论社区项目（一）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1></h1>\n<h1>主要技术架构：</h1>\n<p>SpringBoot Spring SpringMVC MyBatis Redis Kakfa Elasticsearch Spring Security Spring Actator</p>\n<h1>1.配置项目环境</h1>\n<p>        在<a class=\"link-info\" href=\"https://start.spring.io/\" title=\"Spring Boot Initializr\">Spring Boot Initializr</a>中或者Idea中初始化一个SpringBoot项目并导出</p>\n<p><img alt=\"\" height=\"1200\" src=\"image\\fff24b4ac29b4ba58c0253267888a2d1.png\" width=\"1200\"/></p>\n<p>        使用Idea打开导出的项目</p>\n<h1>2.MyBatis配置</h1>\n<p> 各个层之间的关系如下</p>\n<p><img alt=\"\" height=\"568\" src=\"image\\fba9cd30a1d64d6db4e22a841ef6f5e2.png\" width=\"959\"/>       在<a class=\"link-info\" href=\"https://mvnrepository.com/?__cf_chl_rt_tk=S6a5uVIFPsIePlnWmIGDLbRZ7HzzWfHp4Z8WlsQdi_g-1648901526-0-gaNycGzNCqU\" title=\"Maven Repository\">Maven Repository</a>搜索MySql Maven配置文件，在resources文件包内的pom.xml文件中导入相关的配置文件依赖，并在application.properties文件中配置相关的参数。</p>\n<pre><code># ServerProperties\nserver.port=8080\nserver.servlet.context-path=/community\n\n# ThymeleafProperties\nspring.thymeleaf.cache=false\n\n# DataSourceProperties\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\nspring.datasource.url=jdbc:mysql://localhost:3306/community?characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Hongkong\n#数据库的名称、密码等\nspring.datasource.username=root\nspring.datasource.password=123456\nspring.datasource.type=com.zaxxer.hikari.HikariDataSource\n#最大连接数、超时时间等\nspring.datasource.hikari.maximum-pool-size=15\nspring.datasource.hikari.minimum-idle=5\nspring.datasource.hikari.idle-timeout=30000\n\n# MybatisProperties\n#mapper扫描路径\nmybatis.mapper-locations=classpath:mapper/*.xml\n#在communtiy下创建实体类\nmybatis.type-aliases-package=com.nowcoder.community.entity\nmybatis.configuration.useGeneratedKeys=true\nmybatis.configuration.mapUnderscoreToCamelCase=true</code></pre>\n<p>        在community文件下创建config entity文件包，在resources文件下创建mapper文件包</p>\n<p>        在entity文件下创建User类</p>\n<pre><code class=\"language-java\">public class User {\n\n    private int id;\n    private String username;\n    private String password;\n    private String salt;\n    private String email;\n    private int type;\n    private int status;\n    private String activationCode;\n    private String headerUrl;\n    private Date createTime;\n\n    public int getId() {\n        return id;\n    }\n\n    public void setId(int id) {\n        this.id = id;\n    }\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n    public String getSalt() {\n        return salt;\n    }\n\n    public void setSalt(String salt) {\n        this.salt = salt;\n    }\n\n    public String getEmail() {\n        return email;\n    }\n\n    public void setEmail(String email) {\n        this.email = email;\n    }\n\n    public int getType() {\n        return type;\n    }\n\n    public void setType(int type) {\n        this.type = type;\n    }\n\n    public int getStatus() {\n        return status;\n    }\n\n    public void setStatus(int status) {\n        this.status = status;\n    }\n\n    public String getActivationCode() {\n        return activationCode;\n    }\n\n    public void setActivationCode(String activationCode) {\n        this.activationCode = activationCode;\n    }\n\n    public String getHeaderUrl() {\n        return headerUrl;\n    }\n\n    public void setHeaderUrl(String headerUrl) {\n        this.headerUrl = headerUrl;\n    }\n\n    public Date getCreateTime() {\n        return createTime;\n    }\n\n    public void setCreateTime(Date createTime) {\n        this.createTime = createTime;\n    }\n\n    @Override\n    public String toString() {\n        return \"User{\" +\n                \"id=\" + id +\n                \", username='\" + username + '\\'' +\n                \", password='\" + password + '\\'' +\n                \", salt='\" + salt + '\\'' +\n                \", email='\" + email + '\\'' +\n                \", type=\" + type +\n                \", status=\" + status +\n                \", activationCode='\" + activationCode + '\\'' +\n                \", headerUrl='\" + headerUrl + '\\'' +\n                \", createTime=\" + createTime +\n                '}';\n    }\n\n}</code></pre>\n<p>在dao文件下创建UserMapper接口访问数据库</p>\n<pre><code class=\"language-java\">@Mapper\npublic interface UserMapper {\n\n    User selectById(int id);\n\n    User selectByName(String username);\n\n    User selectByEmail(String email);\n\n    int insertUser(User user);\n\n    int updateStatus(int id, int status);\n\n    int updateHeader(int id, String headerUrl);\n\n    int updatePassword(int id, String password);\n\n}</code></pre>\n<p>        使用Mapper注解，并在mapper文件下创建user-mapp.xml，使得方法与Sql语句相关联，Mybatis 的xml配置可以在官网找到相关的配置。</p>\n<pre><code class=\"language-XML\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;!DOCTYPE mapper\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;\n&lt;mapper namespace=\"com.nowcoder.community.dao.UserMapper\"&gt;\n\n    &lt;sql id=\"insertFields\"&gt;\n        username, password, salt, email, type, status, activation_code, header_url, create_time\n    &lt;/sql&gt;\n\n    &lt;sql id=\"selectFields\"&gt;\n        id, username, password, salt, email, type, status, activation_code, header_url, create_time\n    &lt;/sql&gt;\n\n    &lt;select id=\"selectById\" resultType=\"User\"&gt;\n        select &lt;include refid=\"selectFields\"&gt;&lt;/include&gt;\n        from user\n        where id = #{id}\n    &lt;/select&gt;\n\n    &lt;select id=\"selectByName\" resultType=\"User\"&gt;\n        select &lt;include refid=\"selectFields\"&gt;&lt;/include&gt;\n        from user\n        where username = #{username}\n    &lt;/select&gt;\n\n    &lt;select id=\"selectByEmail\" resultType=\"User\"&gt;\n        select &lt;include refid=\"selectFields\"&gt;&lt;/include&gt;\n        from user\n        where email = #{email}\n    &lt;/select&gt;\n\n    &lt;insert id=\"insertUser\" parameterType=\"User\" keyProperty=\"id\"&gt;\n        insert into user (&lt;include refid=\"insertFields\"&gt;&lt;/include&gt;)\n        values(#{username}, #{password}, #{salt}, #{email}, #{type}, #{status}, #{activationCode}, #{headerUrl}, #{createTime})\n    &lt;/insert&gt;\n\n    &lt;update id=\"updateStatus\"&gt;\n        update user set status = #{status} where id = #{id}\n    &lt;/update&gt;\n\n    &lt;update id=\"updateHeader\"&gt;\n        update user set header_url = #{headerUrl} where id = #{id}\n    &lt;/update&gt;\n\n    &lt;update id=\"updatePassword\"&gt;\n        update user set password = #{password} where id = #{id}\n    &lt;/update&gt;\n\n&lt;/mapper&gt;</code></pre>\n<p>        可以使用@Test注解测试相关方法是否正常使用</p>\n<h1>3.开发社区首页功能：</h1>\n<h2>3.1 开发社区首页显示前10个帖子</h2>\n<p>        在Entity创建DiscussPost类，用于表示发送的相关数据，并在dao文件中创建DiscussPostMapper接口</p>\n<pre><code class=\"language-java\">public class DiscussPost {\n\n    private int id;\n    private int userId;\n    private String title;\n    private String content;\n    private int type;\n    private int status;\n    private Date createTime;\n    private int commentCount;\n    private double score;\n\n    public int getId() {\n        return id;\n    }\n\n    public void setId(int id) {\n        this.id = id;\n    }\n\n    public int getUserId() {\n        return userId;\n    }\n\n    public void setUserId(int userId) {\n        this.userId = userId;\n    }\n\n    public String getTitle() {\n        return title;\n    }\n\n    public void setTitle(String title) {\n        this.title = title;\n    }\n\n    public String getContent() {\n        return content;\n    }\n\n    public void setContent(String content) {\n        this.content = content;\n    }\n\n    public int getType() {\n        return type;\n    }\n\n    public void setType(int type) {\n        this.type = type;\n    }\n\n    public int getStatus() {\n        return status;\n    }\n\n    public void setStatus(int status) {\n        this.status = status;\n    }\n\n    public Date getCreateTime() {\n        return createTime;\n    }\n\n    public void setCreateTime(Date createTime) {\n        this.createTime = createTime;\n    }\n\n    public int getCommentCount() {\n        return commentCount;\n    }\n\n    public void setCommentCount(int commentCount) {\n        this.commentCount = commentCount;\n    }\n\n    public double getScore() {\n        return score;\n    }\n\n    public void setScore(double score) {\n        this.score = score;\n    }\n\n    @Override\n    public String toString() {\n        return \"DiscussPost{\" +\n                \"id=\" + id +\n                \", userId=\" + userId +\n                \", title='\" + title + '\\'' +\n                \", content='\" + content + '\\'' +\n                \", type=\" + type +\n                \", status=\" + status +\n                \", createTime=\" + createTime +\n                \", commentCount=\" + commentCount +\n                \", score=\" + score +\n                '}';\n    }\n}</code></pre>\n<pre><code class=\"language-java\">@Mapper\npublic interface DiscussPostMapper {\n\n    \n    // 考虑到后期分页功能加入offset 和 limit变量\n    // @Param注解用于给参数取别名,\n    // 如果只有一个参数,并且在&lt;if&gt;里使用,则必须加别名.\n\n\n    List&lt;DiscussPost&gt; selectDiscussPosts(int userId, int offset, int limit);\n    int selectDiscussPostRows(@Param(\"userId\") int userId);\n\n}\n</code></pre>\n<p>        在mapper文件下创建相关的xml文件用于数据库操作</p>\n<pre><code class=\"language-XML\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;!DOCTYPE mapper\n        PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n        \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;\n&lt;mapper namespace=\"com.nowcoder.community.dao.DiscussPostMapper\"&gt;\n\n    &lt;sql id=\"selectFields\"&gt;\n        id, user_id, title, content, type, status, create_time, comment_count, score\n    &lt;/sql&gt;\n\n    &lt;select id=\"selectDiscussPosts\" resultType=\"DiscussPost\"&gt;\n        select &lt;include refid=\"selectFields\"&gt;&lt;/include&gt;\n        from discuss_post\n        where status != 2\n        &lt;if test=\"userId!=0\"&gt;\n            and user_id = #{userId}\n        &lt;/if&gt;\n        order by type desc, create_time desc\n        limit #{offset}, #{limit}\n    &lt;/select&gt;\n\n    &lt;select id=\"selectDiscussPostRows\" resultType=\"int\"&gt;\n        select count(id)\n        from discuss_post\n        where status != 2\n        &lt;if test=\"userId!=0\"&gt;\n            and user_id = #{userId}\n        &lt;/if&gt;\n    &lt;/select&gt;\n\n&lt;/mapper&gt;</code></pre>\n<p>        在service文件下创建DiscussPostService类，用于服务层使用（使用@Service注解）</p>\n<pre><code class=\"language-java\">@Service\npublic class DiscussPostService {\n\n    @Autowired\n    private DiscussPostMapper discussPostMapper;\n\n    public List&lt;DiscussPost&gt; findDiscussPosts(int userId, int offset, int limit) {\n        return discussPostMapper.selectDiscussPosts(userId, offset, limit);\n    }\n\n    public int findDiscussPostRows(int userId) {\n        return discussPostMapper.selectDiscussPostRows(userId);\n    }\n\n}\n</code></pre>\n<p>        将静态资源（css image js等文件）放到static文件下，将模板文件（site index.html）放到templates文件下。</p>\n<p>        接下来开发视图层，新建一个HomeController在controller文件下使用@Controller注解</p>\n<pre><code class=\"language-java\">//Controller访问路径可以省略\n@Controller\npublic class HomeController {\n\n    //注入对象\n    @Autowired\n    private DiscussPostService discussPostService;\n\n    @Autowired\n    private UserService userService;\n\n    //使用GET方法\n    @RequestMapping(path = \"/index\", method = RequestMethod.GET)\n\n\n        List&lt;DiscussPost&gt; list = discussPostService.findDiscussPosts(0, page.getOffset(), page.getLimit());\n        List&lt;Map&lt;String, Object&gt;&gt; discussPosts = new ArrayList&lt;&gt;();\n        if (list != null) {\n            for (DiscussPost post : list) {\n                Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n                map.put(\"post\", post);\n                User user = userService.findUserById(post.getUserId());\n                map.put(\"user\", user);\n                discussPosts.add(map);\n            }\n        }\n        model.addAttribute(\"discussPosts\", discussPosts);\n        return \"/index\";\n    }\n\n}</code></pre>\n<p>        更改Index.html文件，使用Thymeleaf对其中相对路径进行更改，并显示相关的帖子。</p>\n<pre><code class=\"language-html\">&lt;ul class=\"list-unstyled\"&gt;\n\t\t\t\t\t&lt;li class=\"media pb-3 pt-3 mb-3 border-bottom\" th:each=\"map:${discussPosts}\"&gt;\n\t\t\t\t\t\t&lt;a href=\"site/profile.html\"&gt;\n\t\t\t\t\t\t\t&lt;img th:src=\"${map.user.headerUrl}\" class=\"mr-4 rounded-circle\" alt=\"用户头像\" style=\"width:50px;height:50px;\"&gt;\n\t\t\t\t\t\t&lt;/a&gt;\n\t\t\t\t\t\t&lt;div class=\"media-body\"&gt;\n\t\t\t\t\t\t\t&lt;h6 class=\"mt-0 mb-3\"&gt;\n\t\t\t\t\t\t\t\t&lt;a href=\"#\" th:utext=\"${map.post.title}\"&gt;备战春招，面试刷题跟他复习，一个月全搞定！&lt;/a&gt;\n\t\t\t\t\t\t\t\t&lt;span class=\"badge badge-secondary bg-primary\" th:if=\"${map.post.type==1}\"&gt;置顶&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;span class=\"badge badge-secondary bg-danger\" th:if=\"${map.post.status==1}\"&gt;精华&lt;/span&gt;\n\t\t\t\t\t\t\t&lt;/h6&gt;\n\t\t\t\t\t\t\t&lt;div class=\"text-muted font-size-12\"&gt;\n\t\t\t\t\t\t\t\t&lt;u class=\"mr-3\" th:utext=\"${map.user.username}\"&gt;寒江雪&lt;/u&gt; 发布于 &lt;b th:text=\"${#dates.format(map.post.createTime,'yyyy-MM-dd HH:mm:ss')}\"&gt;2019-04-15 15:32:18&lt;/b&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"d-inline float-right\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"d-inline ml-2\"&gt;赞 11&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"d-inline ml-2\"&gt;|&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"d-inline ml-2\"&gt;回帖 7&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\t\t\t\t\t\t\n\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t&lt;/ul&gt;</code></pre>\n<p>        完整的HTML文件如下：</p>\n<pre><code class=\"language-html\">&lt;!doctype html&gt;\n&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;\n&lt;head&gt;\n\t&lt;meta charset=\"utf-8\"&gt;\n\t&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"&gt;\n\t&lt;link rel=\"icon\" href=\"https://static.nowcoder.com/images/logo_87_87.png\"/&gt;\n\t&lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" crossorigin=\"anonymous\"&gt;\n\t&lt;link rel=\"stylesheet\" th:href=\"@{/css/global.css}\" /&gt;\n\t&lt;title&gt;牛客网-首页&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\t\n\t&lt;div class=\"nk-container\"&gt;\n\t\t&lt;!-- 头部 --&gt;\n\t\t&lt;header class=\"bg-dark sticky-top\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;!-- 导航 --&gt;\n\t\t\t\t&lt;nav class=\"navbar navbar-expand-lg navbar-dark\"&gt;\n\t\t\t\t\t&lt;!-- logo --&gt;\n\t\t\t\t\t&lt;a class=\"navbar-brand\" href=\"#\"&gt;&lt;/a&gt;\n\t\t\t\t\t&lt;button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\"&gt;\n\t\t\t\t\t\t&lt;span class=\"navbar-toggler-icon\"&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/button&gt;\n\t\t\t\t\t&lt;!-- 功能 --&gt;\n\t\t\t\t\t&lt;div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\"&gt;\n\t\t\t\t\t\t&lt;ul class=\"navbar-nav mr-auto\"&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"index.html\"&gt;首页&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link position-relative\" href=\"site/letter.html\"&gt;消息&lt;span class=\"badge badge-danger\"&gt;12&lt;/span&gt;&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"site/register.html\"&gt;注册&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"site/login.html\"&gt;登录&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical dropdown\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"navbarDropdown\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\"http://images.nowcoder.com/head/1t.png\" class=\"rounded-circle\" style=\"width:30px;\"/&gt;\n\t\t\t\t\t\t\t\t&lt;/a&gt;\n\t\t\t\t\t\t\t\t&lt;div class=\"dropdown-menu\" aria-labelledby=\"navbarDropdown\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"site/profile.html\"&gt;个人主页&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"site/setting.html\"&gt;账号设置&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"site/login.html\"&gt;退出登录&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;div class=\"dropdown-divider\"&gt;&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\"dropdown-item text-center text-secondary\"&gt;nowcoder&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t&lt;!-- 搜索 --&gt;\n\t\t\t\t\t\t&lt;form class=\"form-inline my-2 my-lg-0\" action=\"site/search.html\"&gt;\n\t\t\t\t\t\t\t&lt;input class=\"form-control mr-sm-2\" type=\"search\" aria-label=\"Search\" /&gt;\n\t\t\t\t\t\t\t&lt;button class=\"btn btn-outline-light my-2 my-sm-0\" type=\"submit\"&gt;搜索&lt;/button&gt;\n\t\t\t\t\t\t&lt;/form&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/nav&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/header&gt;\n\n\t\t&lt;!-- 内容 --&gt;\n\t\t&lt;div class=\"main\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;div class=\"position-relative\"&gt;\n\t\t\t\t\t&lt;!-- 筛选条件 --&gt;\n\t\t\t\t\t&lt;ul class=\"nav nav-tabs mb-3\"&gt;\n\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"nav-link active\" href=\"#\"&gt;最新&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"#\"&gt;最热&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t&lt;button type=\"button\" class=\"btn btn-primary btn-sm position-absolute rt-0\" data-toggle=\"modal\" data-target=\"#publishModal\"&gt;我要发布&lt;/button&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;!-- 弹出框 --&gt;\n\t\t\t\t&lt;div class=\"modal fade\" id=\"publishModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"publishModalLabel\" aria-hidden=\"true\"&gt;\n\t\t\t\t\t&lt;div class=\"modal-dialog modal-lg\" role=\"document\"&gt;\n\t\t\t\t\t\t&lt;div class=\"modal-content\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"modal-header\"&gt;\n\t\t\t\t\t\t\t\t&lt;h5 class=\"modal-title\" id=\"publishModalLabel\"&gt;新帖发布&lt;/h5&gt;\n\t\t\t\t\t\t\t\t&lt;button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;span aria-hidden=\"true\"&gt;&amp;times;&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;/button&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t&lt;div class=\"modal-body\"&gt;\n\t\t\t\t\t\t\t\t&lt;form&gt;\n\t\t\t\t\t\t\t\t\t&lt;div class=\"form-group\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;label for=\"recipient-name\" class=\"col-form-label\"&gt;标题：&lt;/label&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;input type=\"text\" class=\"form-control\" id=\"recipient-name\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t&lt;div class=\"form-group\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;label for=\"message-text\" class=\"col-form-label\"&gt;正文：&lt;/label&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;textarea class=\"form-control\" id=\"message-text\" rows=\"15\"&gt;&lt;/textarea&gt;\n\t\t\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t\t&lt;/form&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t&lt;div class=\"modal-footer\"&gt;\n\t\t\t\t\t\t\t\t&lt;button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\"&gt;取消&lt;/button&gt;\n\t\t\t\t\t\t\t\t&lt;button type=\"button\" class=\"btn btn-primary\" id=\"publishBtn\"&gt;发布&lt;/button&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;!-- 提示框 --&gt;\n\t\t\t\t&lt;div class=\"modal fade\" id=\"hintModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"hintModalLabel\" aria-hidden=\"true\"&gt;\n\t\t\t\t\t&lt;div class=\"modal-dialog modal-lg\" role=\"document\"&gt;\n\t\t\t\t\t\t&lt;div class=\"modal-content\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"modal-header\"&gt;\n\t\t\t\t\t\t\t\t&lt;h5 class=\"modal-title\" id=\"hintModalLabel\"&gt;提示&lt;/h5&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t&lt;div class=\"modal-body\" id=\"hintBody\"&gt;\n\t\t\t\t\t\t\t\t发布完毕!\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t\t\n\t\t\t\t&lt;!-- 帖子列表 --&gt;\n\t\t\t\t&lt;ul class=\"list-unstyled\"&gt;\n\t\t\t\t\t&lt;li class=\"media pb-3 pt-3 mb-3 border-bottom\" th:each=\"map:${discussPosts}\"&gt;\n\t\t\t\t\t\t&lt;a href=\"site/profile.html\"&gt;\n\t\t\t\t\t\t\t&lt;img th:src=\"${map.user.headerUrl}\" class=\"mr-4 rounded-circle\" alt=\"用户头像\" style=\"width:50px;height:50px;\"&gt;\n\t\t\t\t\t\t&lt;/a&gt;\n\t\t\t\t\t\t&lt;div class=\"media-body\"&gt;\n\t\t\t\t\t\t\t&lt;h6 class=\"mt-0 mb-3\"&gt;\n\t\t\t\t\t\t\t\t&lt;a href=\"#\" th:utext=\"${map.post.title}\"&gt;备战春招，面试刷题跟他复习，一个月全搞定！&lt;/a&gt;\n\t\t\t\t\t\t\t\t&lt;span class=\"badge badge-secondary bg-primary\" th:if=\"${map.post.type==1}\"&gt;置顶&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;span class=\"badge badge-secondary bg-danger\" th:if=\"${map.post.status==1}\"&gt;精华&lt;/span&gt;\n\t\t\t\t\t\t\t&lt;/h6&gt;\n\t\t\t\t\t\t\t&lt;div class=\"text-muted font-size-12\"&gt;\n\t\t\t\t\t\t\t\t&lt;u class=\"mr-3\" th:utext=\"${map.user.username}\"&gt;寒江雪&lt;/u&gt; 发布于 &lt;b th:text=\"${#dates.format(map.post.createTime,'yyyy-MM-dd HH:mm:ss')}\"&gt;2019-04-15 15:32:18&lt;/b&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"d-inline float-right\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"d-inline ml-2\"&gt;赞 11&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"d-inline ml-2\"&gt;|&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"d-inline ml-2\"&gt;回帖 7&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\t\t\t\t\t\t\n\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t&lt;/ul&gt;\n\t\t\t\t&lt;!-- 分页 --&gt;\n\t\t\t\t&lt;nav class=\"mt-5\" th:if=\"${page.rows&gt;0}\"&gt;\n\t\t\t\t\t&lt;ul class=\"pagination justify-content-center\"&gt;\n\t\t\t\t\t\t&lt;li class=\"page-item\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" th:href=\"@{${page.path}(current=1)}\"&gt;首页&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;li th:class=\"|page-item ${page.current==1?'disabled':''}|\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" th:href=\"@{${page.path}(current=${page.current-1})}\"&gt;上一页&lt;/a&gt;&lt;/li&gt;\n\t\t\t\t\t\t&lt;li th:class=\"|page-item ${i==page.current?'active':''}|\" th:each=\"i:${#numbers.sequence(page.from,page.to)}\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" href=\"#\" th:text=\"${i}\"&gt;1&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;li th:class=\"|page-item ${page.current==page.total?'disabled':''}|\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" th:href=\"@{${page.path}(current=${page.current+1})}\"&gt;下一页&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;li class=\"page-item\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" th:href=\"@{${page.path}(current=${page.total})}\"&gt;末页&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t&lt;/nav&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\n\t\t&lt;!-- 尾部 --&gt;\n\t\t&lt;footer class=\"bg-dark\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t&lt;!-- 二维码 --&gt;\n\t\t\t\t\t&lt;div class=\"col-4 qrcode\"&gt;\n\t\t\t\t\t\t&lt;img src=\"https://uploadfiles.nowcoder.com/app/app_download.png\" class=\"img-thumbnail\" style=\"width:136px;\" /&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;!-- 公司信息 --&gt;\n\t\t\t\t\t&lt;div class=\"col-8 detail-info\"&gt;\n\t\t\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"col\"&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"nav\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;关于我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;加入我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;意见反馈&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;企业服务&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;联系我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;免责声明&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;友情链接&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"col\"&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"nav btn-group-vertical company-info\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t公司地址：北京市朝阳区大屯路东金泉时代3-2708北京牛客科技有限公司\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t联系方式：010-60728802(电话)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;admin@nowcoder.com\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t牛客科技©2018 All rights reserved\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t京ICP备14055008号-4 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;\n\t\t\t\t\t\t\t\t\t\t&lt;img src=\"http://static.nowcoder.com/company/images/res/ghs.png\" style=\"width:18px;\" /&gt;\n\t\t\t\t\t\t\t\t\t\t京公网安备 11010502036488号\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/footer&gt;\n\t&lt;/div&gt;\n\n\t&lt;script src=\"https://code.jquery.com/jquery-3.3.1.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script th:src=\"@{/js/global.js}\"&gt;&lt;/script&gt;\n\t&lt;script th:src=\"@{js/index.js}\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<h2>3.2开发分页组件，分页显示所有帖子</h2>\n<p>        在entity文件下创建page类，用于记录分页数据</p>\n<pre><code class=\"language-java\">/**\n * 封装分页相关的信息.\n */\npublic class Page {\n\n    // 当前页码\n    private int current = 1;\n    // 显示上限\n    private int limit = 10;\n    // 数据总数(用于计算总页数)\n    private int rows;\n    // 查询路径(用于复用分页链接)\n    private String path;\n\n    public int getCurrent() {\n        return current;\n    }\n\n    public void setCurrent(int current) {\n        if (current &gt;= 1) {\n            this.current = current;\n        }\n    }\n\n    public int getLimit() {\n        return limit;\n    }\n\n    public void setLimit(int limit) {\n        if (limit &gt;= 1 &amp;&amp; limit &lt;= 100) {\n            this.limit = limit;\n        }\n    }\n\n    public int getRows() {\n        return rows;\n    }\n\n    public void setRows(int rows) {\n        if (rows &gt;= 0) {\n            this.rows = rows;\n        }\n    }\n\n    public String getPath() {\n        return path;\n    }\n\n    public void setPath(String path) {\n        this.path = path;\n    }\n\n    /**\n     * 获取当前页的起始行\n     *\n     * @return\n     */\n    public int getOffset() {\n        // current * limit - limit\n        return (current - 1) * limit;\n    }\n\n    /**\n     * 获取总页数\n     *\n     * @return\n     */\n    public int getTotal() {\n        // rows / limit [+1]\n        if (rows % limit == 0) {\n            return rows / limit;\n        } else {\n            return rows / limit + 1;\n        }\n    }\n\n    /**\n     * 获取起始页码\n     *\n     * @return\n     */\n    public int getFrom() {\n        int from = current - 2;\n        return from &lt; 1 ? 1 : from;\n    }\n\n    /**\n     * 获取结束页码\n     *\n     * @return\n     */\n    public int getTo() {\n        int to = current + 2;\n        int total = getTotal();\n        return to &gt; total ? total : to;\n    }\n\n}</code></pre>\n<p>        更改HomeController，加入分页的方法。</p>\n<pre><code class=\"language-java\">//Controller访问路径可以省略\n@Controller\npublic class HomeController {\n\n    //注入对象\n    @Autowired\n    private DiscussPostService discussPostService;\n\n    @Autowired\n    private UserService userService;\n\n    //使用GET方法\n    @RequestMapping(path = \"/index\", method = RequestMethod.GET)\n\n    public String getIndexPage(Model model, Page page) {\n        // 方法调用钱,SpringMVC会自动实例化Model和Page,并将Page注入Model.\n        // 所以,在thymeleaf中可以直接访问Page对象中的数据.\n        page.setRows(discussPostService.findDiscussPostRows(0));\n        page.setPath(\"/index\");\n\n        List&lt;DiscussPost&gt; list = discussPostService.findDiscussPosts(0, page.getOffset(), page.getLimit());\n        List&lt;Map&lt;String, Object&gt;&gt; discussPosts = new ArrayList&lt;&gt;();\n        if (list != null) {\n            for (DiscussPost post : list) {\n                Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n                map.put(\"post\", post);\n                User user = userService.findUserById(post.getUserId());\n                map.put(\"user\", user);\n                discussPosts.add(map);\n            }\n        }\n        model.addAttribute(\"discussPosts\", discussPosts);\n        return \"/index\";\n    }\n\n}</code></pre>\n<p>        在更改Index.html问件中分页的方法</p>\n<pre><code class=\"language-html\">&lt;!-- 分页 --&gt;\n\t\t\t\t&lt;nav class=\"mt-5\" th:if=\"${page.rows&gt;0}\"&gt;\n\t\t\t\t\t&lt;ul class=\"pagination justify-content-center\"&gt;\n\t\t\t\t\t\t&lt;li class=\"page-item\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" th:href=\"@{${page.path}(current=1)}\"&gt;首页&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;li th:class=\"|page-item ${page.current==1?'disabled':''}|\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" th:href=\"@{${page.path}(current=${page.current-1})}\"&gt;上一页&lt;/a&gt;&lt;/li&gt;\n\t\t\t\t\t\t&lt;li th:class=\"|page-item ${i==page.current?'active':''}|\" th:each=\"i:${#numbers.sequence(page.from,page.to)}\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" href=\"#\" th:text=\"${i}\"&gt;1&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;li th:class=\"|page-item ${page.current==page.total?'disabled':''}|\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" th:href=\"@{${page.path}(current=${page.current+1})}\"&gt;下一页&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;li class=\"page-item\"&gt;\n\t\t\t\t\t\t\t&lt;a class=\"page-link\" th:href=\"@{${page.path}(current=${page.total})}\"&gt;末页&lt;/a&gt;\n\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t&lt;/nav&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;</code></pre>\n<p>效果图如下：</p>\n<p><img alt=\"\" height=\"894\" src=\"image\\72b634128a474d14865b4426c07b3185.png\" width=\"1200\"/></p>\n<h1>4.开发社区登录模块</h1>\n<h2>4.1邮件发送</h2>\n<p>           在<a class=\"link-info\" href=\"https://mvnrepository.com/?__cf_chl_rt_tk=S6a5uVIFPsIePlnWmIGDLbRZ7HzzWfHp4Z8WlsQdi_g-1648901526-0-gaNycGzNCqU\" title=\"Maven Repository\">Maven Repository</a>搜索Spring Mail配置文件并加入到poml文件中，在application.properties文件中配置Mail的参数。</p>\n<pre><code># ServerProperties\nserver.port=8080\nserver.servlet.context-path=/community\n\n# ThymeleafProperties\nspring.thymeleaf.cache=false\n\n# DataSourceProperties\nspring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver\nspring.datasource.url=jdbc:mysql://localhost:3306/community?characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Hongkong\nspring.datasource.username=root\nspring.datasource.password=lihonghe\nspring.datasource.type=com.zaxxer.hikari.HikariDataSource\nspring.datasource.hikari.maximum-pool-size=15\nspring.datasource.hikari.minimum-idle=5\nspring.datasource.hikari.idle-timeout=30000\n\n# MybatisProperties\nmybatis.mapper-locations=classpath:mapper/*.xml\nmybatis.type-aliases-package=com.nowcoder.community.entity\nmybatis.configuration.useGeneratedKeys=true\nmybatis.configuration.mapUnderscoreToCamelCase=true\n\n\n# MailProperties\nspring.mail.host=smtp.sina.com\nspring.mail.port=465\n#自己的邮箱\nspring.mail.username=nowcoder@sina.com\nspring.mail.password=nowcoder123\nspring.mail.protocol=smtps\nspring.mail.properties.mail.smtp.ssl.enable=true</code></pre>\n<p>        如果发送不了邮件，需要在个人邮箱的网站设置启用授权码，验证手机，并修改properties文件中关于Email的配置</p>\n<pre><code># MailProperties\nspring.mail.host=smtp.sina.com\n#spring.mail.port=465\nspring.mail.username=nowcoder@sina.com\nspring.mail.password=3398c6c71399f9fe\n#spring.mail.protocol=smtps\n#spring.mail.properties.mail.smtp.ssl.enable=true\nspring.mail.properties.mail.smtl.auth=true</code></pre>\n<p>        在community文件下创建util工具文件包，并在util包中创建MailClient类使用@Component注解，并创建发送邮件的方法。</p>\n<pre><code class=\"language-java\">@Component\npublic class MailClient {\n\n    private static final Logger logger = LoggerFactory.getLogger(MailClient.class);\n\n    @Autowired\n    private JavaMailSender mailSender;\n    \n    //从配置文件中获取值\n    @Value(\"${spring.mail.username}\")\n    private String from;\n\n    public void sendMail(String to, String subject, String content) {\n        try {\n            MimeMessage message = mailSender.createMimeMessage();\n            MimeMessageHelper helper = new MimeMessageHelper(message);\n            helper.setFrom(from);\n            helper.setTo(to);\n            helper.setSubject(subject);\n            helper.setText(content, true);\n            mailSender.send(helper.getMimeMessage());\n        } catch (MessagingException e) {\n            logger.error(\"发送邮件失败:\" + e.getMessage());\n        }\n    }\n\n}</code></pre>\n<h2>4.2注册功能</h2>\n<p><img alt=\"\" height=\"746\" src=\"image\\696e8ed39700466481ed09dd4e13c65b.png\" width=\"1200\"/></p>\n<p>        在Controller层下创建LoginController类，实现登录界面跳转到注册页面，使用@Controller注解。</p>\n<pre><code class=\"language-java\">@Controller\npublic class LoginController implements CommunityConstant {\n\n    @RequestMapping(path = \"/register\", method = RequestMethod.GET)\n    public String getRegisterPage() {\n        return \"/site/register\";\n    }\n\n    @RequestMapping(path = \"/login\", method = RequestMethod.GET)\n    public String getLoginPage() {\n        return \"/site/login\";\n    }\n}\n\n    </code></pre>\n<p>         使用模板引擎thymeleaf修改注册页面regist.html。</p>\n<pre><code class=\"language-html\">&lt;!doctype html&gt;\n&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;\n&lt;head&gt;\n\t&lt;meta charset=\"utf-8\"&gt;\n\t&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"&gt;\n\t&lt;link rel=\"icon\" href=\"https://static.nowcoder.com/images/logo_87_87.png\"/&gt;\n\t&lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" crossorigin=\"anonymous\"&gt;\n\t&lt;link rel=\"stylesheet\" th:href=\"@{/css/global.css}\" /&gt;\n\t&lt;link rel=\"stylesheet\" th:href=\"@{/css/login.css}\" /&gt;\n\t&lt;title&gt;牛客网-注册&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\t&lt;div class=\"nk-container\"&gt;\n\t\t&lt;!-- 头部 --&gt;\n\t\t&lt;header class=\"bg-dark sticky-top\" th:replace=\"index::header\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;!-- 导航 --&gt;\n\t\t\t\t&lt;nav class=\"navbar navbar-expand-lg navbar-dark\"&gt;\n\t\t\t\t\t&lt;!-- logo --&gt;\n\t\t\t\t\t&lt;a class=\"navbar-brand\" href=\"#\"&gt;&lt;/a&gt;\n\t\t\t\t\t&lt;button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\"&gt;\n\t\t\t\t\t\t&lt;span class=\"navbar-toggler-icon\"&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/button&gt;\n\t\t\t\t\t&lt;!-- 功能 --&gt;\n\t\t\t\t\t&lt;div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\"&gt;\n\t\t\t\t\t\t&lt;ul class=\"navbar-nav mr-auto\"&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"../index.html\"&gt;首页&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link position-relative\" href=\"letter.html\"&gt;消息&lt;span class=\"badge badge-danger\"&gt;12&lt;/span&gt;&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"register.html\"&gt;注册&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"login.html\"&gt;登录&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical dropdown\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"navbarDropdown\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\"http://images.nowcoder.com/head/1t.png\" class=\"rounded-circle\" style=\"width:30px;\"/&gt;\n\t\t\t\t\t\t\t\t&lt;/a&gt;\n\t\t\t\t\t\t\t\t&lt;div class=\"dropdown-menu\" aria-labelledby=\"navbarDropdown\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"profile.html\"&gt;个人主页&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"setting.html\"&gt;账号设置&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"login.html\"&gt;退出登录&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;div class=\"dropdown-divider\"&gt;&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\"dropdown-item text-center text-secondary\"&gt;nowcoder&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t&lt;!-- 搜索 --&gt;\n\t\t\t\t\t\t&lt;form class=\"form-inline my-2 my-lg-0\" action=\"search.html\"&gt;\n\t\t\t\t\t\t\t&lt;input class=\"form-control mr-sm-2\" type=\"search\" aria-label=\"Search\" /&gt;\n\t\t\t\t\t\t\t&lt;button class=\"btn btn-outline-light my-2 my-sm-0\" type=\"submit\"&gt;搜索&lt;/button&gt;\n\t\t\t\t\t\t&lt;/form&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/nav&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/header&gt;\n\n\t\t&lt;!-- 内容 --&gt;\n\t\t&lt;div class=\"main\"&gt;\n\t\t\t&lt;div class=\"container pl-5 pr-5 pt-3 pb-3 mt-3 mb-3\"&gt;\n\t\t\t\t&lt;h3 class=\"text-center text-info border-bottom pb-3\"&gt;注&amp;nbsp;&amp;nbsp;册&lt;/h3&gt;\n\t\t\t\t&lt;form class=\"mt-5\" method=\"post\" th:action=\"@{/register}\"&gt;\n\t\t\t\t\t&lt;div class=\"form-group row\"&gt;\n\t\t\t\t\t\t&lt;label for=\"username\" class=\"col-sm-2 col-form-label text-right\"&gt;账号:&lt;/label&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10\"&gt;\n\t\t\t\t\t\t\t&lt;input type=\"text\"\n\t\t\t\t\t\t\t\t   th:class=\"|form-control ${usernameMsg!=null?'is-invalid':''}|\"\n\t\t\t\t\t\t\t\t   th:value=\"${user!=null?user.username:''}\"\n\t\t\t\t\t\t\t\t   id=\"username\" name=\"username\" placeholder=\"请输入您的账号!\" required&gt;\n\t\t\t\t\t\t\t&lt;div class=\"invalid-feedback\" th:text=\"${usernameMsg}\"&gt;\n\t\t\t\t\t\t\t\t该账号已存在!\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;label for=\"password\" class=\"col-sm-2 col-form-label text-right\"&gt;密码:&lt;/label&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10\"&gt;\n\t\t\t\t\t\t\t&lt;input type=\"password\"\n\t\t\t\t\t\t\t\t   th:class=\"|form-control ${passwordMsg!=null?'is-invalid':''}|\"\n\t\t\t\t\t\t\t\t   th:value=\"${user!=null?user.password:''}\"\n\t\t\t\t\t\t\t\t   id=\"password\" name=\"password\" placeholder=\"请输入您的密码!\" required&gt;\n\t\t\t\t\t\t\t&lt;div class=\"invalid-feedback\" th:text=\"${passwordMsg}\"&gt;\n\t\t\t\t\t\t\t\t密码长度不能小于8位!\n\t\t\t\t\t\t\t&lt;/div&gt;\t\t\t\t\t\t\t\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;label for=\"confirm-password\" class=\"col-sm-2 col-form-label text-right\"&gt;确认密码:&lt;/label&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10\"&gt;\n\t\t\t\t\t\t\t&lt;input type=\"password\" class=\"form-control\"\n\t\t\t\t\t\t\t\t   th:value=\"${user!=null?user.password:''}\"\n\t\t\t\t\t\t\t\t   id=\"confirm-password\" placeholder=\"请再次输入密码!\" required&gt;\n\t\t\t\t\t\t\t&lt;div class=\"invalid-feedback\"&gt;\n\t\t\t\t\t\t\t\t两次输入的密码不一致!\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=\"form-group row\"&gt;\n\t\t\t\t\t\t&lt;label for=\"email\" class=\"col-sm-2 col-form-label text-right\"&gt;邮箱:&lt;/label&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10\"&gt;\n\t\t\t\t\t\t\t&lt;input type=\"email\"\n\t\t\t\t\t\t\t\t   th:class=\"|form-control ${emailMsg!=null?'is-invalid':''}|\"\n\t\t\t\t\t\t\t\t   th:value=\"${user!=null?user.email:''}\"\n\t\t\t\t\t\t\t\t   id=\"email\" name=\"email\" placeholder=\"请输入您的邮箱!\" required&gt;\n\t\t\t\t\t\t\t&lt;div class=\"invalid-feedback\" th:text=\"${emailMsg}\"&gt;\n\t\t\t\t\t\t\t\t该邮箱已注册!\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-2\"&gt;&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10 text-center\"&gt;\n\t\t\t\t\t\t\t&lt;button type=\"submit\" class=\"btn btn-info text-white form-control\"&gt;立即注册&lt;/button&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/form&gt;\t\t\t\t\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\n\t\t&lt;!-- 尾部 --&gt;\n\t\t&lt;footer class=\"bg-dark\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t&lt;!-- 二维码 --&gt;\n\t\t\t\t\t&lt;div class=\"col-4 qrcode\"&gt;\n\t\t\t\t\t\t&lt;img src=\"https://uploadfiles.nowcoder.com/app/app_download.png\" class=\"img-thumbnail\" style=\"width:136px;\" /&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;!-- 公司信息 --&gt;\n\t\t\t\t\t&lt;div class=\"col-8 detail-info\"&gt;\n\t\t\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"col\"&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"nav\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;关于我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;加入我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;意见反馈&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;企业服务&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;联系我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;免责声明&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;友情链接&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"col\"&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"nav btn-group-vertical company-info\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t公司地址：北京市朝阳区大屯路东金泉时代3-2708北京牛客科技有限公司\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t联系方式：010-60728802(电话)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;admin@nowcoder.com\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t牛客科技©2018 All rights reserved\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t京ICP备14055008号-4 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;\n\t\t\t\t\t\t\t\t\t\t&lt;img src=\"http://static.nowcoder.com/company/images/res/ghs.png\" style=\"width:18px;\" /&gt;\n\t\t\t\t\t\t\t\t\t\t京公网安备 11010502036488号\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/footer&gt;\n\t&lt;/div&gt;\n\n\t&lt;script src=\"https://code.jquery.com/jquery-3.3.1.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script th:src=\"@{/js/global.js}\"&gt;&lt;/script&gt;\n\t&lt;script th:src=\"@{/js/register.js}\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>         在<a class=\"link-info\" href=\"https://mvnrepository.com/?__cf_chl_rt_tk=S6a5uVIFPsIePlnWmIGDLbRZ7HzzWfHp4Z8WlsQdi_g-1648901526-0-gaNycGzNCqU\" title=\"Maven Repository\">Maven Repository</a>搜索commons lang配置文件并加入到poml文件中。在properties文件中加入community的路径。</p>\n<pre><code># community\ncommunity.path.domain=http://localhost:8080</code></pre>\n<p>在util中添加CommunityUtil工具类，方便生成密码。</p>\n<pre><code class=\"language-java\">public class CommunityUtil {\n\n    // 生成随机字符串\n    public static String generateUUID() {\n        return UUID.randomUUID().toString().replaceAll(\"-\", \"\");\n    }\n\n    // MD5加密\n    // hello -&gt; abc123def456\n    // hello + 3e4a8 -&gt; abc123def456abc\n    public static String md5(String key) {\n        if (StringUtils.isBlank(key)) {\n            return null;\n        }\n        return DigestUtils.md5DigestAsHex(key.getBytes());\n    }\n\n}\n</code></pre>\n<p>        在Service中更新UserService类，用于注册用户业务，并更新激活页面activation.html。</p>\n<pre><code class=\"language-java\">@Service\npublic class UserService implements CommunityConstant {\n\n    @Autowired\n    private UserMapper userMapper;\n\n    @Autowired\n    private MailClient mailClient;\n\n    @Autowired\n    private TemplateEngine templateEngine;\n\n    @Value(\"${community.path.domain}\")\n    private String domain;\n\n    @Value(\"${server.servlet.context-path}\")\n    private String contextPath;\n\n    @Autowired\n    private LoginTicketMapper loginTicketMapper;\n\n    public User findUserById(int id) {\n        return userMapper.selectById(id);\n    }\n\n    public Map&lt;String, Object&gt; register(User user) {\n        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n\n        // 空值处理\n        if (user == null) {\n            throw new IllegalArgumentException(\"参数不能为空!\");\n        }\n        if (StringUtils.isBlank(user.getUsername())) {\n            map.put(\"usernameMsg\", \"账号不能为空!\");\n            return map;\n        }\n        if (StringUtils.isBlank(user.getPassword())) {\n            map.put(\"passwordMsg\", \"密码不能为空!\");\n            return map;\n        }\n        if (StringUtils.isBlank(user.getEmail())) {\n            map.put(\"emailMsg\", \"邮箱不能为空!\");\n            return map;\n        }\n\n        // 验证账号\n        User u = userMapper.selectByName(user.getUsername());\n        if (u != null) {\n            map.put(\"usernameMsg\", \"该账号已存在!\");\n            return map;\n        }\n\n        // 验证邮箱\n        u = userMapper.selectByEmail(user.getEmail());\n        if (u != null) {\n            map.put(\"emailMsg\", \"该邮箱已被注册!\");\n            return map;\n        }\n\n        // 注册用户\n        user.setSalt(CommunityUtil.generateUUID().substring(0, 5));\n        user.setPassword(CommunityUtil.md5(user.getPassword() + user.getSalt()));\n        user.setType(0);\n        user.setStatus(0);\n        user.setActivationCode(CommunityUtil.generateUUID());\n        user.setHeaderUrl(String.format(\"http://images.nowcoder.com/head/%dt.png\", new Random().nextInt(1000)));\n        user.setCreateTime(new Date());\n        userMapper.insertUser(user);\n\n        // 激活邮件\n        Context context = new Context();\n        context.setVariable(\"email\", user.getEmail());\n        // http://localhost:8080/community/activation/101/code\n        String url = domain + contextPath + \"/activation/\" + user.getId() + \"/\" + user.getActivationCode();\n        context.setVariable(\"url\", url);\n        String content = templateEngine.process(\"/mail/activation\", context);\n        mailClient.sendMail(user.getEmail(), \"激活账号\", content);\n\n        return map;\n    }\n\n    public int activation(int userId, String code) {\n        User user = userMapper.selectById(userId);\n        if (user.getStatus() == 1) {\n            return ACTIVATION_REPEAT;\n        } else if (user.getActivationCode().equals(code)) {\n            userMapper.updateStatus(userId, 1);\n            return ACTIVATION_SUCCESS;\n        } else {\n            return ACTIVATION_FAILURE;\n        }\n    }\n\n    public Map&lt;String, Object&gt; login(String username, String password, int expiredSeconds) {\n        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n\n        // 空值处理\n        if (StringUtils.isBlank(username)) {\n            map.put(\"usernameMsg\", \"账号不能为空!\");\n            return map;\n        }\n        if (StringUtils.isBlank(password)) {\n            map.put(\"passwordMsg\", \"密码不能为空!\");\n            return map;\n        }\n\n        // 验证账号\n        User user = userMapper.selectByName(username);\n        if (user == null) {\n            map.put(\"usernameMsg\", \"该账号不存在!\");\n            return map;\n        }\n\n        // 验证状态\n        if (user.getStatus() == 0) {\n            map.put(\"usernameMsg\", \"该账号未激活!\");\n            return map;\n        }\n\n        // 验证密码\n        password = CommunityUtil.md5(password + user.getSalt());\n        if (!user.getPassword().equals(password)) {\n            map.put(\"passwordMsg\", \"密码不正确!\");\n            return map;\n        }\n\n        // 生成登录凭证\n        LoginTicket loginTicket = new LoginTicket();\n        loginTicket.setUserId(user.getId());\n        loginTicket.setTicket(CommunityUtil.generateUUID());\n        loginTicket.setStatus(0);\n        loginTicket.setExpired(new Date(System.currentTimeMillis() + expiredSeconds * 1000));\n        loginTicketMapper.insertLoginTicket(loginTicket);\n\n        map.put(\"ticket\", loginTicket.getTicket());\n        return map;\n    }\n\n\n}\n</code></pre>\n<pre><code class=\"language-html\">&lt;!doctype html&gt;\n&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;link rel=\"icon\" href=\"https://static.nowcoder.com/images/logo_87_87.png\"/&gt;\n    &lt;title&gt;牛客网-激活账号&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\t&lt;div&gt;\n\t\t&lt;p&gt;\n\t\t\t&lt;b th:text=\"${email}\"&gt;xxx@xxx.com&lt;/b&gt;, 您好!\n\t\t&lt;/p&gt;\n\t\t&lt;p&gt;\n\t\t\t您正在注册牛客网, 这是一封激活邮件, 请点击 \n\t\t\t&lt;a th:href=\"${url}\"&gt;此链接&lt;/a&gt;,\n\t\t\t激活您的牛客账号!\n\t\t&lt;/p&gt;\n\t&lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;</code></pre>\n<p>        注册之后需要更新LoginController，处理注册完成的请求。</p>\n<pre><code class=\"language-java\">@Controller\npublic class LoginController implements CommunityConstant {\n\n    private static final Logger logger = LoggerFactory.getLogger(LoginController.class);\n\n    @Autowired\n    private UserService userService;\n\n    @Autowired\n    private Producer kaptchaProducer;\n\n    @Value(\"${server.servlet.context-path}\")\n    private String contextPath;\n\n    @RequestMapping(path = \"/register\", method = RequestMethod.GET)\n    public String getRegisterPage() {\n        return \"/site/register\";\n    }\n\n    @RequestMapping(path = \"/login\", method = RequestMethod.GET)\n    public String getLoginPage() {\n        return \"/site/login\";\n    }\n\n    @RequestMapping(path = \"/register\", method = RequestMethod.POST)\n    public String register(Model model, User user) {\n        Map&lt;String, Object&gt; map = userService.register(user);\n        if (map == null || map.isEmpty()) {\n            model.addAttribute(\"msg\", \"注册成功,我们已经向您的邮箱发送了一封激活邮件,请尽快激活!\");\n            model.addAttribute(\"target\", \"/index\");\n            return \"/site/operate-result\";\n        } else {\n            model.addAttribute(\"usernameMsg\", map.get(\"usernameMsg\"));\n            model.addAttribute(\"passwordMsg\", map.get(\"passwordMsg\"));\n            model.addAttribute(\"emailMsg\", map.get(\"emailMsg\"));\n            return \"/site/register\";\n        }\n    }\n\n    \n}\n</code></pre>\n<p>        更新operate-result页面。</p>\n<pre><code class=\"language-html\">&lt;!doctype html&gt;\n&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;\n&lt;head&gt;\n\t&lt;meta charset=\"utf-8\"&gt;\n\t&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"&gt;\n\t&lt;link rel=\"icon\" href=\"https://static.nowcoder.com/images/logo_87_87.png\"/&gt;\n\t&lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" crossorigin=\"anonymous\"&gt;\n\t&lt;link rel=\"stylesheet\" th:href=\"@{/css/global.css}\" /&gt;\n\t&lt;title&gt;牛客网-操作结果&lt;/title&gt;\n&lt;/head&gt;\n&lt;body class=\"bg-white\"&gt;\n\t&lt;div class=\"nk-container\"&gt;\n\t\t&lt;!-- 头部 --&gt;\n\t\t&lt;header class=\"bg-dark sticky-top\" th:replace=\"index::header\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;!-- 导航 --&gt;\n\t\t\t\t&lt;nav class=\"navbar navbar-expand-lg navbar-dark\"&gt;\n\t\t\t\t\t&lt;!-- logo --&gt;\n\t\t\t\t\t&lt;a class=\"navbar-brand\" href=\"#\"&gt;&lt;/a&gt;\n\t\t\t\t\t&lt;button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\"&gt;\n\t\t\t\t\t\t&lt;span class=\"navbar-toggler-icon\"&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/button&gt;\n\t\t\t\t\t&lt;!-- 功能 --&gt;\n\t\t\t\t\t&lt;div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\"&gt;\n\t\t\t\t\t\t&lt;ul class=\"navbar-nav mr-auto\"&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"../index.html\"&gt;首页&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link position-relative\" href=\"letter.html\"&gt;消息&lt;span class=\"badge badge-danger\"&gt;12&lt;/span&gt;&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"register.html\"&gt;注册&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"login.html\"&gt;登录&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical dropdown\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"navbarDropdown\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\"http://images.nowcoder.com/head/1t.png\" class=\"rounded-circle\" style=\"width:30px;\"/&gt;\n\t\t\t\t\t\t\t\t&lt;/a&gt;\n\t\t\t\t\t\t\t\t&lt;div class=\"dropdown-menu\" aria-labelledby=\"navbarDropdown\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"profile.html\"&gt;个人主页&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"setting.html\"&gt;账号设置&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"login.html\"&gt;退出登录&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;div class=\"dropdown-divider\"&gt;&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\"dropdown-item text-center text-secondary\"&gt;nowcoder&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t&lt;!-- 搜索 --&gt;\n\t\t\t\t\t\t&lt;form class=\"form-inline my-2 my-lg-0\" action=\"search.html\"&gt;\n\t\t\t\t\t\t\t&lt;input class=\"form-control mr-sm-2\" type=\"search\" aria-label=\"Search\" /&gt;\n\t\t\t\t\t\t\t&lt;button class=\"btn btn-outline-light my-2 my-sm-0\" type=\"submit\"&gt;搜索&lt;/button&gt;\n\t\t\t\t\t\t&lt;/form&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/nav&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/header&gt;\n\n\t\t&lt;!-- 内容 --&gt;\n\t\t&lt;div class=\"main\"&gt;\n\t\t\t&lt;div class=\"container mt-5\"&gt;\n\t\t\t\t&lt;div class=\"jumbotron\"&gt;\n\t\t\t\t\t&lt;p class=\"lead\" th:text=\"${msg}\"&gt;您的账号已经激活成功,可以正常使用了!&lt;/p&gt;\n\t\t\t\t\t&lt;hr class=\"my-4\"&gt;\n\t\t\t\t\t&lt;p&gt;\n\t\t\t\t\t\t系统会在 &lt;span id=\"seconds\" class=\"text-danger\"&gt;8&lt;/span&gt; 秒后自动跳转,\n\t\t\t\t\t\t您也可以点此 &lt;a id=\"target\" th:href=\"@{${target}}\" class=\"text-primary\"&gt;链接&lt;/a&gt;, 手动跳转!\n\t\t\t\t\t&lt;/p&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\n\t\t&lt;!-- 尾部 --&gt;\n\t\t&lt;footer class=\"bg-dark\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t&lt;!-- 二维码 --&gt;\n\t\t\t\t\t&lt;div class=\"col-4 qrcode\"&gt;\n\t\t\t\t\t\t&lt;img src=\"https://uploadfiles.nowcoder.com/app/app_download.png\" class=\"img-thumbnail\" style=\"width:136px;\" /&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;!-- 公司信息 --&gt;\n\t\t\t\t\t&lt;div class=\"col-8 detail-info\"&gt;\n\t\t\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"col\"&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"nav\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;关于我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;加入我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;意见反馈&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;企业服务&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;联系我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;免责声明&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;友情链接&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"col\"&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"nav btn-group-vertical company-info\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t公司地址：北京市朝阳区大屯路东金泉时代3-2708北京牛客科技有限公司\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t联系方式：010-60728802(电话)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;admin@nowcoder.com\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t牛客科技©2018 All rights reserved\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t京ICP备14055008号-4 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;\n\t\t\t\t\t\t\t\t\t\t&lt;img src=\"http://static.nowcoder.com/company/images/res/ghs.png\" style=\"width:18px;\" /&gt;\n\t\t\t\t\t\t\t\t\t\t京公网安备 11010502036488号\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/footer&gt;\n\t&lt;/div&gt;\n\n\t&lt;script src=\"https://code.jquery.com/jquery-3.3.1.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script&gt;\n\t\t$(function(){\n\t\t\tsetInterval(function(){\n\t\t\t\tvar seconds = $(\"#seconds\").text();\n\t\t\t\t$(\"#seconds\").text(--seconds);\n\t\t\t\tif(seconds == 0) {\n\t\t\t\t\tlocation.href = $(\"#target\").attr(\"href\");\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t});\n\t&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>在utill中创建一个CommunityConstant接口，用于表示注册状态码。</p>\n<pre><code class=\"language-java\">public interface CommunityConstant {\n\n    /**\n     * 激活成功\n     */\n    int ACTIVATION_SUCCESS = 0;\n\n    /**\n     * 重复激活\n     */\n    int ACTIVATION_REPEAT = 1;\n\n    /**\n     * 激活失败\n     */\n    int ACTIVATION_FAILURE = 2;\n\n    /**\n     * 默认状态的登录凭证的超时时间\n     */\n    int DEFAULT_EXPIRED_SECONDS = 3600 * 12;\n\n    /**\n     * 记住状态的登录凭证超时时间\n     */\n    int REMEMBER_EXPIRED_SECONDS = 3600 * 24 * 100;\n\n}\n</code></pre>\n<p>        更新LoginController的功能，并更改Index.html文件相对应位置的模板参数。</p>\n<pre><code class=\"language-java\">@Controller\npublic class LoginController implements CommunityConstant {\n\n    private static final Logger logger = LoggerFactory.getLogger(LoginController.class);\n\n    @Autowired\n    private UserService userService;\n\n    @Autowired\n    private Producer kaptchaProducer;\n\n    @Value(\"${server.servlet.context-path}\")\n    private String contextPath;\n\n    @RequestMapping(path = \"/register\", method = RequestMethod.GET)\n    public String getRegisterPage() {\n        return \"/site/register\";\n    }\n\n    @RequestMapping(path = \"/login\", method = RequestMethod.GET)\n    public String getLoginPage() {\n        return \"/site/login\";\n    }\n\n    @RequestMapping(path = \"/register\", method = RequestMethod.POST)\n    public String register(Model model, User user) {\n        Map&lt;String, Object&gt; map = userService.register(user);\n        if (map == null || map.isEmpty()) {\n            model.addAttribute(\"msg\", \"注册成功,我们已经向您的邮箱发送了一封激活邮件,请尽快激活!\");\n            model.addAttribute(\"target\", \"/index\");\n            return \"/site/operate-result\";\n        } else {\n            model.addAttribute(\"usernameMsg\", map.get(\"usernameMsg\"));\n            model.addAttribute(\"passwordMsg\", map.get(\"passwordMsg\"));\n            model.addAttribute(\"emailMsg\", map.get(\"emailMsg\"));\n            return \"/site/register\";\n        }\n    }\n\n    // http://localhost:8080/community/activation/101/code\n    @RequestMapping(path = \"/activation/{userId}/{code}\", method = RequestMethod.GET)\n    public String activation(Model model, @PathVariable(\"userId\") int userId, @PathVariable(\"code\") String code) {\n        int result = userService.activation(userId, code);\n        if (result == ACTIVATION_SUCCESS) {\n            model.addAttribute(\"msg\", \"激活成功,您的账号已经可以正常使用了!\");\n            model.addAttribute(\"target\", \"/login\");\n        } else if (result == ACTIVATION_REPEAT) {\n            model.addAttribute(\"msg\", \"无效操作,该账号已经激活过了!\");\n            model.addAttribute(\"target\", \"/index\");\n        } else {\n            model.addAttribute(\"msg\", \"激活失败,您提供的激活码不正确!\");\n            model.addAttribute(\"target\", \"/index\");\n        }\n        return \"/site/operate-result\";\n    }\n\n\n}\n</code></pre>\n<h2>4.3会话管理</h2>\n<p><img alt=\"\" height=\"889\" src=\"image\\3147c842f3c4493ab620e7c0da5f6a58.png\" width=\"1200\"/></p>\n<p>         使用Cookie保存一些信息，可以使用浏览器插件查看Cookie(F12控制台)</p>\n<p><img alt=\"\" height=\"731\" src=\"image\\d60cf17417c7408a8820f817bbfa232b.png\" width=\"1200\"/></p>\n<p>         有关Cookie的一个小示例：</p>\n<pre><code class=\"language-java\">// cookie示例\n\n    @RequestMapping(path = \"/cookie/set\", method = RequestMethod.GET)\n    @ResponseBody\n    public String setCookie(HttpServletResponse response) {\n        // 创建cookie\n        Cookie cookie = new Cookie(\"code\", CommunityUtil.generateUUID());\n        // 设置cookie生效的范围\n        cookie.setPath(\"/community/alpha\");\n        // 设置cookie的生存时间\n        cookie.setMaxAge(60 * 10);\n        // 发送cookie\n        response.addCookie(cookie);\n\n        return \"set cookie\";\n    }\n\n    @RequestMapping(path = \"/cookie/get\", method = RequestMethod.GET)\n    @ResponseBody\n    public String getCookie(@CookieValue(\"code\") String code) {\n        System.out.println(code);\n        return \"get cookie\";\n    }\n\n    // session示例\n\n    @RequestMapping(path = \"/session/set\", method = RequestMethod.GET)\n    @ResponseBody\n    public String setSession(HttpSession session) {\n        session.setAttribute(\"id\", 1);\n        session.setAttribute(\"name\", \"Test\");\n        return \"set session\";\n    }\n\n    @RequestMapping(path = \"/session/get\", method = RequestMethod.GET)\n    @ResponseBody\n    public String getSession(HttpSession session) {\n        System.out.println(session.getAttribute(\"id\"));\n        System.out.println(session.getAttribute(\"name\"));\n        return \"get session\";\n    }</code></pre>\n<p>cookie和session的区别<img alt=\"\" height=\"711\" src=\"image\\f20fea2ce25644c580f8b556be54ad8a.png\" width=\"1200\"/></p>\n<p>后期可以考虑将Session数据传输到redis数据库中，用于保存一些登陆凭证</p>\n<h2>4.4生成验证码</h2>\n<p>        验证码使用Kaptcha jar包用于随机生成字符和图片。 在<a class=\"link-info\" href=\"https://mvnrepository.com/?__cf_chl_rt_tk=S6a5uVIFPsIePlnWmIGDLbRZ7HzzWfHp4Z8WlsQdi_g-1648901526-0-gaNycGzNCqU\" title=\"Maven Repository\">Maven Repository</a>搜索Kaptcha配置文件，在resources文件包内的pom.xml文件中导入相关的配置文件依赖。在community目录下创建config文件包并创建KaptchaConfig配置类，使用@Configuration注解。</p>\n<pre><code class=\"language-java\">@Configuration\npublic class KaptchaConfig {\n\n    @Bean\n    public Producer kaptchaProducer() {\n        Properties properties = new Properties();\n        properties.setProperty(\"kaptcha.image.width\", \"100\");\n        properties.setProperty(\"kaptcha.image.height\", \"40\");\n        properties.setProperty(\"kaptcha.textproducer.font.size\", \"32\");\n        properties.setProperty(\"kaptcha.textproducer.font.color\", \"0,0,0\");\n        properties.setProperty(\"kaptcha.textproducer.char.string\", \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYAZ\");\n        properties.setProperty(\"kaptcha.textproducer.char.length\", \"4\");\n        properties.setProperty(\"kaptcha.noise.impl\", \"com.google.code.kaptcha.impl.NoNoise\");\n\n        DefaultKaptcha kaptcha = new DefaultKaptcha();\n        Config config = new Config(properties);\n        kaptcha.setConfig(config);\n        return kaptcha;\n    }\n\n}</code></pre>\n<p>        在LoginController文件中完善验证码功能，并完善登陆页面.html文件中验证码的模板，并实现刷新验证码的功能。</p>\n<pre><code class=\"language-java\"> @RequestMapping(path = \"/kaptcha\", method = RequestMethod.GET)\n    public void getKaptcha(HttpServletResponse response, HttpSession session) {\n        // 生成验证码\n        String text = kaptchaProducer.createText();\n        BufferedImage image = kaptchaProducer.createImage(text);\n\n        // 将验证码存入session\n        session.setAttribute(\"kaptcha\", text);\n\n        // 将突图片输出给浏览器\n        response.setContentType(\"image/png\");\n        try {\n            OutputStream os = response.getOutputStream();\n            ImageIO.write(image, \"png\", os);\n        } catch (IOException e) {\n            logger.error(\"响应验证码失败:\" + e.getMessage());\n        }\n    }\n\n    @RequestMapping(path = \"/login\", method = RequestMethod.POST)\n    public String login(String username, String password, String code, boolean rememberme,\n                        Model model, HttpSession session, HttpServletResponse response) {\n        // 检查验证码\n        String kaptcha = (String) session.getAttribute(\"kaptcha\");\n        if (StringUtils.isBlank(kaptcha) || StringUtils.isBlank(code) || !kaptcha.equalsIgnoreCase(code)) {\n            model.addAttribute(\"codeMsg\", \"验证码不正确!\");\n            return \"/site/login\";\n        }</code></pre>\n<p>        刷新验证码方法：</p>\n<pre><code class=\"language-html\">&lt;script&gt;\n\tfunction refresh_kaptcha() {\n\t\tvar path = CONTEXT_PATH + \"/kaptcha?p=\" + Math.random();\n\t\t$(\"#kaptcha\").attr(\"src\", path);\n\t}\n&lt;/script&gt;</code></pre>\n<h2>4.5登录、退出功能</h2>\n<p>密码使用MD5加密</p>\n<p><img alt=\"\" height=\"777\" src=\"image\\0c121c7707d24585903a3d23b5c1bd51.png\" width=\"1041\"/></p>\n<p>         数据库中有关于登录凭证的ticket，使用这个ticket作为登陆凭证。涉及到数据库的操作，就要处理LoginTicketMapper。</p>\n<p>LoginTicketMapper(这里是mapper的另外一种写法，不用再resource里面创建mapper文件):</p>\n<pre><code class=\"language-java\">@Mapper\npublic interface LoginTicketMapper {\n\n    @Insert({\n            \"insert into login_ticket(user_id,ticket,status,expired) \",\n            \"values(#{userId},#{ticket},#{status},#{expired})\"\n    })\n    @Options(useGeneratedKeys = true, keyProperty = \"id\")\n    int insertLoginTicket(LoginTicket loginTicket);\n\n    @Select({\n            \"select id,user_id,ticket,status,expired \",\n            \"from login_ticket where ticket=#{ticket}\"\n    })\n    LoginTicket selectByTicket(String ticket);\n\n    @Update({\n            \"&lt;script&gt;\",\n            \"update login_ticket set status=#{status} where ticket=#{ticket} \",\n            \"&lt;if test=\\\"ticket!=null\\\"&gt; \",\n            \"and 1=1 \",\n            \"&lt;/if&gt;\",\n            \"&lt;/script&gt;\"\n    })\n    int updateStatus(String ticket, int status);\n\n}\n</code></pre>\n<p>        在UserService中增加登陆的方法，并在login.html中增加相应的修改：</p>\n<pre><code class=\"language-java\">public Map&lt;String, Object&gt; login(String username, String password, int expiredSeconds) {\n        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n\n        // 空值处理\n        if (StringUtils.isBlank(username)) {\n            map.put(\"usernameMsg\", \"账号不能为空!\");\n            return map;\n        }\n        if (StringUtils.isBlank(password)) {\n            map.put(\"passwordMsg\", \"密码不能为空!\");\n            return map;\n        }\n\n        // 验证账号\n        User user = userMapper.selectByName(username);\n        if (user == null) {\n            map.put(\"usernameMsg\", \"该账号不存在!\");\n            return map;\n        }\n\n        // 验证状态\n        if (user.getStatus() == 0) {\n            map.put(\"usernameMsg\", \"该账号未激活!\");\n            return map;\n        }\n\n        // 验证密码\n        password = CommunityUtil.md5(password + user.getSalt());\n        if (!user.getPassword().equals(password)) {\n            map.put(\"passwordMsg\", \"密码不正确!\");\n            return map;\n        }\n\n        // 生成登录凭证\n        LoginTicket loginTicket = new LoginTicket();\n        loginTicket.setUserId(user.getId());\n        loginTicket.setTicket(CommunityUtil.generateUUID());\n        loginTicket.setStatus(0);\n        loginTicket.setExpired(new Date(System.currentTimeMillis() + expiredSeconds * 1000));\n        loginTicketMapper.insertLoginTicket(loginTicket);\n\n        map.put(\"ticket\", loginTicket.getTicket());\n        return map;\n    }</code></pre>\n<p>        增加Controller层中的登录方法：</p>\n<pre><code class=\"language-java\">@RequestMapping(path = \"/login\", method = RequestMethod.POST)\n    public String login(String username, String password, String code, boolean rememberme,\n                        Model model, HttpSession session, HttpServletResponse response) {\n        // 检查验证码\n        String kaptcha = (String) session.getAttribute(\"kaptcha\");\n        if (StringUtils.isBlank(kaptcha) || StringUtils.isBlank(code) || !kaptcha.equalsIgnoreCase(code)) {\n            model.addAttribute(\"codeMsg\", \"验证码不正确!\");\n            return \"/site/login\";\n        }\n\n        // 检查账号,密码\n        int expiredSeconds = rememberme ? REMEMBER_EXPIRED_SECONDS : DEFAULT_EXPIRED_SECONDS;\n        Map&lt;String, Object&gt; map = userService.login(username, password, expiredSeconds);\n        if (map.containsKey(\"ticket\")) {\n            Cookie cookie = new Cookie(\"ticket\", map.get(\"ticket\").toString());\n            cookie.setPath(contextPath);\n            cookie.setMaxAge(expiredSeconds);\n            response.addCookie(cookie);\n            return \"redirect:/index\";\n        } else {\n            model.addAttribute(\"usernameMsg\", map.get(\"usernameMsg\"));\n            model.addAttribute(\"passwordMsg\", map.get(\"passwordMsg\"));\n            return \"/site/login\";\n        }\n    }\n\n    @RequestMapping(path = \"/logout\", method = RequestMethod.GET)\n    public String logout(@CookieValue(\"ticket\") String ticket) {\n        userService.logout(ticket);\n        return \"redirect:/login\";\n    }</code></pre>\n<h2>4.6显示登陆信息</h2>\n<p>        使用拦截器实现        </p>\n<p><img alt=\"\" height=\"737\" src=\"image\\ad16c5c4f4624720b2acb161e0309c40.png\" width=\"1020\"/></p>\n<p>在controller层下创建Interceptor文件包，</p>\n<p>拦截器的方法</p>\n<pre><code class=\"language-java\"> // 在Controller之前执行\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        logger.debug(\"preHandle: \" + handler.toString());\n        return true;\n    }\n\n    // 在Controller之后执行\n    @Override\n    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        logger.debug(\"postHandle: \" + handler.toString());\n    }\n\n    // 在TemplateEngine之后执行\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        logger.debug(\"afterCompletion: \" + handler.toString());\n    }</code></pre>\n<p>在cpnfig文件下创建配置类WebMvcConfig，配置拦截器。</p>\n<pre><code class=\"language-java\">@Configuration\npublic class WebMvcConfig implements WebMvcConfigurer {\n\n    //测试拦截器方法\n    @Autowired\n    private AlphaInterceptor alphaInterceptor;\n\n    @Autowired\n    private LoginTicketInterceptor loginTicketInterceptor;\n\n    @Autowired\n    private LoginRequiredInterceptor loginRequiredInterceptor;\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        registry.addInterceptor(alphaInterceptor)\n                .excludePathPatterns(\"/**/*.css\", \"/**/*.js\", \"/**/*.png\", \"/**/*.jpg\", \"/**/*.jpeg\")\n                .addPathPatterns(\"/register\", \"/login\");\n\n        registry.addInterceptor(loginTicketInterceptor)\n                .excludePathPatterns(\"/**/*.css\", \"/**/*.js\", \"/**/*.png\", \"/**/*.jpg\", \"/**/*.jpeg\");\n\n    }\n\n}</code></pre>\n<p>在请求开始之前查询登录用户：</p>\n<p>在Interceptor文件下创建LoginTicketInterceptor，实现拦截器的方法。</p>\n<pre><code class=\"language-java\">@Component\npublic class LoginTicketInterceptor implements HandlerInterceptor {\n\n    @Autowired\n    private UserService userService;\n\n    @Autowired\n    private HostHolder hostHolder;\n\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        // 从cookie中获取凭证\n        String ticket = CookieUtil.getValue(request, \"ticket\");\n\n        if (ticket != null) {\n            // 查询凭证\n            LoginTicket loginTicket = userService.findLoginTicket(ticket);\n            // 检查凭证是否有效\n            if (loginTicket != null &amp;&amp; loginTicket.getStatus() == 0 &amp;&amp; loginTicket.getExpired().after(new Date())) {\n                // 根据凭证查询用户\n                User user = userService.findUserById(loginTicket.getUserId());\n                // 在本次请求中持有用户\n                hostHolder.setUser(user);\n            }\n        }\n\n        return true;\n    }\n\n    @Override\n    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        User user = hostHolder.getUser();\n        if (user != null &amp;&amp; modelAndView != null) {\n            modelAndView.addObject(\"loginUser\", user);\n        }\n    }\n\n    @Override\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        hostHolder.clear();\n    }\n}</code></pre>\n<p>        在Util文件中创建Cookie工具，以及HostHolder工具用于代替session对象。完成过后修改相应的html文件。</p>\n<pre><code class=\"language-java\">public class CookieUtil {\n\n    public static String getValue(HttpServletRequest request, String name) {\n        if (request == null || name == null) {\n            throw new IllegalArgumentException(\"参数为空!\");\n        }\n\n        Cookie[] cookies = request.getCookies();\n        if (cookies != null) {\n            for (Cookie cookie : cookies) {\n                if (cookie.getName().equals(name)) {\n                    return cookie.getValue();\n                }\n            }\n        }\n\n        return null;\n    }\n\n}</code></pre>\n<pre><code class=\"language-java\">/**\n * 持有用户信息,用于代替session对象.\n */\n@Component\npublic class HostHolder {\n\n    private ThreadLocal&lt;User&gt; users = new ThreadLocal&lt;&gt;();\n\n    public void setUser(User user) {\n        users.set(user);\n    }\n\n    public User getUser() {\n        return users.get();\n    }\n\n    public void clear() {\n        users.remove();\n    }\n\n}\n</code></pre>\n<h2>4.7账号设置</h2>\n<p>        用户自己上传头像，请求必须是POST请求，表单：enctype = \"multipart/form-data\",SpringMVC通过MutipartFile上传文件。</p>\n<p>        创建Usercontroller</p>\n<pre><code class=\"language-java\">@Controller\n@RequestMapping(\"/user\")\npublic class UserController {\n\n    private static final Logger logger = LoggerFactory.getLogger(UserController.class);\n\n    @Value(\"${community.path.upload}\")\n    private String uploadPath;\n\n    @Value(\"${community.path.domain}\")\n    private String domain;\n\n    @Value(\"${server.servlet.context-path}\")\n    private String contextPath;\n\n    @Autowired\n    private UserService userService;\n\n    @Autowired\n    private HostHolder hostHolder;\n\n    @LoginRequired\n    @RequestMapping(path = \"/setting\", method = RequestMethod.GET)\n    public String getSettingPage() {\n        return \"/site/setting\";\n    }\n\n    @LoginRequired\n    @RequestMapping(path = \"/upload\", method = RequestMethod.POST)\n    public String uploadHeader(MultipartFile headerImage, Model model) {\n        if (headerImage == null) {\n            model.addAttribute(\"error\", \"您还没有选择图片!\");\n            return \"/site/setting\";\n        }\n\n        String fileName = headerImage.getOriginalFilename();\n        String suffix = fileName.substring(fileName.lastIndexOf(\".\"));\n        if (StringUtils.isBlank(suffix)) {\n            model.addAttribute(\"error\", \"文件的格式不正确!\");\n            return \"/site/setting\";\n        }\n\n        // 生成随机文件名\n        fileName = CommunityUtil.generateUUID() + suffix;\n        // 确定文件存放的路径\n        File dest = new File(uploadPath + \"/\" + fileName);\n        try {\n            // 存储文件\n            headerImage.transferTo(dest);\n        } catch (IOException e) {\n            logger.error(\"上传文件失败: \" + e.getMessage());\n            throw new RuntimeException(\"上传文件失败,服务器发生异常!\", e);\n        }\n\n        // 更新当前用户的头像的路径(web访问路径)\n        // http://localhost:8080/community/user/header/xxx.png\n        User user = hostHolder.getUser();\n        String headerUrl = domain + contextPath + \"/user/header/\" + fileName;\n        userService.updateHeader(user.getId(), headerUrl);\n\n        return \"redirect:/index\";\n    }\n\n    @RequestMapping(path = \"/header/{fileName}\", method = RequestMethod.GET)\n    public void getHeader(@PathVariable(\"fileName\") String fileName, HttpServletResponse response) {\n        // 服务器存放路径\n        fileName = uploadPath + \"/\" + fileName;\n        // 文件后缀\n        String suffix = fileName.substring(fileName.lastIndexOf(\".\"));\n        // 响应图片\n        response.setContentType(\"image/\" + suffix);\n        try (\n                FileInputStream fis = new FileInputStream(fileName);\n                OutputStream os = response.getOutputStream();\n        ) {\n            byte[] buffer = new byte[1024];\n            int b = 0;\n            while ((b = fis.read(buffer)) != -1) {\n                os.write(buffer, 0, b);\n            }\n        } catch (IOException e) {\n            logger.error(\"读取头像失败: \" + e.getMessage());\n        }\n    }\n\n}\n</code></pre>\n<p>配置setting.html的静态资源路径</p>\n<pre><code class=\"language-html\">&lt;!doctype html&gt;\n&lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt;\n&lt;head&gt;\n\t&lt;meta charset=\"utf-8\"&gt;\n\t&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"&gt;\n\t&lt;link rel=\"icon\" href=\"https://static.nowcoder.com/images/logo_87_87.png\"/&gt;\n\t&lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" crossorigin=\"anonymous\"&gt;\n\t&lt;link rel=\"stylesheet\" th:href=\"@{/css/global.css}\" /&gt;\n\t&lt;link rel=\"stylesheet\" th:href=\"@{/css/login.css}\" /&gt;\n\t&lt;title&gt;牛客网-账号设置&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\t&lt;div class=\"nk-container\"&gt;\n\t\t&lt;!-- 头部 --&gt;\n\t\t&lt;header class=\"bg-dark sticky-top\" th:replace=\"index::header\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;!-- 导航 --&gt;\n\t\t\t\t&lt;nav class=\"navbar navbar-expand-lg navbar-dark\"&gt;\n\t\t\t\t\t&lt;!-- logo --&gt;\n\t\t\t\t\t&lt;a class=\"navbar-brand\" href=\"#\"&gt;&lt;/a&gt;\n\t\t\t\t\t&lt;button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\"&gt;\n\t\t\t\t\t\t&lt;span class=\"navbar-toggler-icon\"&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/button&gt;\n\t\t\t\t\t&lt;!-- 功能 --&gt;\n\t\t\t\t\t&lt;div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\"&gt;\n\t\t\t\t\t\t&lt;ul class=\"navbar-nav mr-auto\"&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"../index.html\"&gt;首页&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link position-relative\" href=\"letter.html\"&gt;消息&lt;span class=\"badge badge-danger\"&gt;12&lt;/span&gt;&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"register.html\"&gt;注册&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link\" href=\"login.html\"&gt;登录&lt;/a&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t&lt;li class=\"nav-item ml-3 btn-group-vertical dropdown\"&gt;\n\t\t\t\t\t\t\t\t&lt;a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"navbarDropdown\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\"http://images.nowcoder.com/head/1t.png\" class=\"rounded-circle\" style=\"width:30px;\"/&gt;\n\t\t\t\t\t\t\t\t&lt;/a&gt;\n\t\t\t\t\t\t\t\t&lt;div class=\"dropdown-menu\" aria-labelledby=\"navbarDropdown\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"profile.html\"&gt;个人主页&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"setting.html\"&gt;账号设置&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;a class=\"dropdown-item text-center\" href=\"login.html\"&gt;退出登录&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;div class=\"dropdown-divider\"&gt;&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\"dropdown-item text-center text-secondary\"&gt;nowcoder&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t&lt;!-- 搜索 --&gt;\n\t\t\t\t\t\t&lt;form class=\"form-inline my-2 my-lg-0\" action=\"search.html\"&gt;\n\t\t\t\t\t\t\t&lt;input class=\"form-control mr-sm-2\" type=\"search\" aria-label=\"Search\" /&gt;\n\t\t\t\t\t\t\t&lt;button class=\"btn btn-outline-light my-2 my-sm-0\" type=\"submit\"&gt;搜索&lt;/button&gt;\n\t\t\t\t\t\t&lt;/form&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/nav&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/header&gt;\n\n\t\t&lt;!-- 内容 --&gt;\n\t\t&lt;div class=\"main\"&gt;\n\t\t\t&lt;div class=\"container p-5 mt-3 mb-3\"&gt;\n\t\t\t\t&lt;!-- 上传头像 --&gt;\n\t\t\t\t&lt;h6 class=\"text-left text-info border-bottom pb-2\"&gt;上传头像&lt;/h6&gt;\n\t\t\t\t&lt;form class=\"mt-5\" method=\"post\" enctype=\"multipart/form-data\" th:action=\"@{/user/upload}\"&gt;\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;label for=\"head-image\" class=\"col-sm-2 col-form-label text-right\"&gt;选择头像:&lt;/label&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"custom-file\"&gt;\n\t\t\t\t\t\t\t\t&lt;input type=\"file\" th:class=\"|custom-file-input ${error!=null?'is-invalid':''}|\"\n\t\t\t\t\t\t\t\t\t   id=\"head-image\" name=\"headerImage\" lang=\"es\" required=\"\"&gt;\n\t\t\t\t\t\t\t\t&lt;label class=\"custom-file-label\" for=\"head-image\" data-browse=\"文件\"&gt;选择一张图片&lt;/label&gt;\n\t\t\t\t\t\t\t\t&lt;div class=\"invalid-feedback\" th:text=\"${error}\"&gt;\n\t\t\t\t\t\t\t\t\t该账号不存在!\n\t\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-2\"&gt;&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10 text-center\"&gt;\n\t\t\t\t\t\t\t&lt;button type=\"submit\" class=\"btn btn-info text-white form-control\"&gt;立即上传&lt;/button&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/form&gt;\n\t\t\t\t&lt;!-- 修改密码 --&gt;\n\t\t\t\t&lt;h6 class=\"text-left text-info border-bottom pb-2 mt-5\"&gt;修改密码&lt;/h6&gt;\n\t\t\t\t&lt;form class=\"mt-5\"&gt;\t\t\t\t\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;label for=\"old-password\" class=\"col-sm-2 col-form-label text-right\"&gt;原密码:&lt;/label&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10\"&gt;\n\t\t\t\t\t\t\t&lt;input type=\"password\" class=\"form-control\" id=\"old-password\" placeholder=\"请输入原始密码!\" required&gt;\n\t\t\t\t\t\t\t&lt;div class=\"invalid-feedback\"&gt;\n\t\t\t\t\t\t\t\t密码长度不能小于8位!\n\t\t\t\t\t\t\t&lt;/div&gt;\t\t\t\t\t\t\t\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;label for=\"new-password\" class=\"col-sm-2 col-form-label text-right\"&gt;新密码:&lt;/label&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10\"&gt;\n\t\t\t\t\t\t\t&lt;input type=\"password\" class=\"form-control\" id=\"new-password\" placeholder=\"请输入新的密码!\" required&gt;\n\t\t\t\t\t\t\t&lt;div class=\"invalid-feedback\"&gt;\n\t\t\t\t\t\t\t\t密码长度不能小于8位!\n\t\t\t\t\t\t\t&lt;/div&gt;\t\t\t\t\t\t\t\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;label for=\"confirm-password\" class=\"col-sm-2 col-form-label text-right\"&gt;确认密码:&lt;/label&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10\"&gt;\n\t\t\t\t\t\t\t&lt;input type=\"password\" class=\"form-control\" id=\"confirm-password\" placeholder=\"再次输入新密码!\" required&gt;\n\t\t\t\t\t\t\t&lt;div class=\"invalid-feedback\"&gt;\n\t\t\t\t\t\t\t\t两次输入的密码不一致!\n\t\t\t\t\t\t\t&lt;/div&gt;\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\t\t\t\t\n\t\t\t\t\t&lt;div class=\"form-group row mt-4\"&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-2\"&gt;&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=\"col-sm-10 text-center\"&gt;\n\t\t\t\t\t\t\t&lt;button type=\"submit\" class=\"btn btn-info text-white form-control\"&gt;立即保存&lt;/button&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/form&gt;\t\t\t\t\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\n\t\t&lt;!-- 尾部 --&gt;\n\t\t&lt;footer class=\"bg-dark\"&gt;\n\t\t\t&lt;div class=\"container\"&gt;\n\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t&lt;!-- 二维码 --&gt;\n\t\t\t\t\t&lt;div class=\"col-4 qrcode\"&gt;\n\t\t\t\t\t\t&lt;img src=\"https://uploadfiles.nowcoder.com/app/app_download.png\" class=\"img-thumbnail\" style=\"width:136px;\" /&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;!-- 公司信息 --&gt;\n\t\t\t\t\t&lt;div class=\"col-8 detail-info\"&gt;\n\t\t\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"col\"&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"nav\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;关于我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;加入我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;意见反馈&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;企业服务&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;联系我们&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;免责声明&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item\"&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;a class=\"nav-link text-light\" href=\"#\"&gt;友情链接&lt;/a&gt;\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;div class=\"row\"&gt;\n\t\t\t\t\t\t\t&lt;div class=\"col\"&gt;\n\t\t\t\t\t\t\t\t&lt;ul class=\"nav btn-group-vertical company-info\"&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t公司地址：北京市朝阳区大屯路东金泉时代3-2708北京牛客科技有限公司\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t联系方式：010-60728802(电话)&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;admin@nowcoder.com\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t牛客科技©2018 All rights reserved\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t\t&lt;li class=\"nav-item text-white-50\"&gt;\n\t\t\t\t\t\t\t\t\t\t京ICP备14055008号-4 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;\n\t\t\t\t\t\t\t\t\t\t&lt;img src=\"http://static.nowcoder.com/company/images/res/ghs.png\" style=\"width:18px;\" /&gt;\n\t\t\t\t\t\t\t\t\t\t京公网安备 11010502036488号\n\t\t\t\t\t\t\t\t\t&lt;/li&gt;\n\t\t\t\t\t\t\t\t&lt;/ul&gt;\n\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/footer&gt;\n\t&lt;/div&gt;\n\n\t&lt;script src=\"https://code.jquery.com/jquery-3.3.1.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script src=\"https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.js\" crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n\t&lt;script th:src=\"@{/js/global.js}\"&gt;&lt;/script&gt;\n\t&lt;script&gt;\n\t\t$(function(){\n\t\t\tbsCustomFileInput.init();\n\t\t});\n\t&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p>修改配置文件中，上传文件的保存位置。</p>\n<pre><code>community.path.upload=d:/work/data/upload</code></pre>\n<h2>4.8检查登陆状态</h2>\n<p>        防止未登录访问某些资源，可以使用拦截器和注解。</p>\n<p>       使用注解，在community创建annotation文件创建Login注解。</p>\n<pre><code class=\"language-java\">@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface LoginRequired {\n\n\n\n}</code></pre>\n<p>        给Usercontroller中的方法，加入@LoginRequire注解，并创建拦截器拦截带注解的方法。</p>\n<p>创建一个新的拦截器LoginRequireInterceptor。</p>\n<pre><code class=\"language-java\">@Component\npublic class LoginRequiredInterceptor implements HandlerInterceptor {\n\n    @Autowired\n    private HostHolder hostHolder;\n\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        //保证拦截的是方法\n        if (handler instanceof HandlerMethod) {\n            HandlerMethod handlerMethod = (HandlerMethod) handler;\n            Method method = handlerMethod.getMethod();\n            LoginRequired loginRequired = method.getAnnotation(LoginRequired.class);\n            if (loginRequired != null &amp;&amp; hostHolder.getUser() == null) {\n                response.sendRedirect(request.getContextPath() + \"/login\");\n                return false;\n            }\n        }\n        return true;\n    }\n}\n</code></pre>\n<h1></h1>\n<h1></h1>\n<h2>项目代码及相关资源：<a href=\"https://github.com/Ming-XMU\" title=\"Ming-XMU (Yiming Zhang) · GitHub\">Ming-XMU (Yiming Zhang) · GitHub</a></h2>\n<h1>麻烦点点小星星！！！！！！</h1>\n<p>CSDN下载需要积分<a href=\"https://download.csdn.net/download/qq_43351888/85072880\" title=\"基于SpringBoot仿牛客网讨论社区项目-Java文档类资源-CSDN下载\">基于SpringBoot仿牛客网讨论社区项目-Java文档类资源-CSDN下载</a></p>\n<p><a href=\"https://blog.csdn.net/qq_43351888/article/details/123928000?spm=1001.2014.3001.5501\" title=\"从零开始—仿牛客网讨论社区项目（一）_芙蓉铁蛋的博客-CSDN博客\">从零开始—仿牛客网讨论社区项目（一）_芙蓉铁蛋的博客-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/qq_43351888/article/details/123936613?spm=1001.2014.3001.5501\" title=\" 从零开始—仿牛客网讨论社区项目（二）_芙蓉铁蛋的博客-CSDN博客\"> 从零开始—仿牛客网讨论社区项目（二）_芙蓉铁蛋的博客-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/qq_43351888/article/details/123943949?spm=1001.2014.3001.5501\" title=\"从零开始—仿牛客网讨论社区项目（三）_芙蓉铁蛋的博客-CSDN博客\">从零开始—仿牛客网讨论社区项目（三）_芙蓉铁蛋的博客-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/qq_43351888/article/details/123953939?spm=1001.2014.3001.5501\" title=\"从零开始—仿牛客网讨论社区项目（四）_芙蓉铁蛋的博客-CSDN博客\">从零开始—仿牛客网讨论社区项目（四）_芙蓉铁蛋的博客-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/qq_43351888/article/details/123959047?spm=1001.2014.3001.5501\" title=\"从零开始—仿牛客网讨论社区项目（五）_芙蓉铁蛋的博客-CSDN博客\">从零开始—仿牛客网讨论社区项目（五）_芙蓉铁蛋的博客-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/qq_43351888/article/details/123968582?spm=1001.2014.3001.5501\" title=\"从零开始—仿牛客网讨论社区项目（六）_芙蓉铁蛋的博客-CSDN博客\">从零开始—仿牛客网讨论社区项目（六）_芙蓉铁蛋的博客-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/qq_43351888/article/details/123974771?spm=1001.2014.3001.5501\" title=\"仿牛客网讨论社区项目—优化网站性能_芙蓉铁蛋的博客-CSDN博客\">仿牛客网讨论社区项目—优化网站性能_芙蓉铁蛋的博客-CSDN博客</a></p>\n<p><a href=\"https://blog.csdn.net/qq_43351888/article/details/123997073?spm=1001.2014.3001.5501\" title=\"仿牛客网讨论社区项目—项目总结及项目常见面试题_芙蓉铁蛋的博客-CSDN博客\">仿牛客网讨论社区项目—项目总结及项目常见面试题_芙蓉铁蛋的博客-CSDN博客</a></p>\n</div>\n</div>"}