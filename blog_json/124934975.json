{"blogid": "124934975", "writerAge": "码龄1年", "writerBlogNum": "11", "writerCollect": "79", "writerComment": "1", "writerFan": "3029", "writerGrade": "2级", "writerIntegral": "160", "writerName": "打更幺鸡", "writerProfileAdress": "writer_image\\profile_124934975.jpg", "writerRankTotal": "80298", "writerRankWeekly": "2924", "writerThumb": "48", "writerVisitNum": "22102", "blog_read_count": "845", "blog_time": "已于 2022-05-23 21:51:29 修改", "blog_title": "weevely工具使用", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><strong>weevely工具使用</strong></h1>\n<p><br/></p>\n<hr/>\n<p></p>\n<div class=\"toc\">\n<h3>目录</h3>\n<ul><li><a href=\"#_weevely_17\">一． 关于weevely</a></li><li><a href=\"#_weevely_23\">二． 安装weevely</a></li><li><a href=\"#_weevely_32\">三． 使用weevely</a></li><li><a href=\"#_weevely_125\">四． weevely实战</a></li><li><a href=\"#__199\">五． 常用模块</a></li><li><a href=\"#_weevely_246\">六． weevely工作原理</a></li></ul>\n</div>\n<p></p>\n<hr/>\n<p><br/></p>\n<blockquote>\n<p>声明：本文<code>禁止转载</code>。 仅作网络安全学习交流，切勿用于任何非法用途，否则后果自负。</p>\n</blockquote>\n<p><br/></p>\n<h1><a id=\"_weevely_17\"></a>一． 关于weevely</h1>\n<p>  weevely是一款基于python编写的webshell管理工具，其优点是跨平台，隐蔽性不错，参数随机生成并加密。但缺点是只支持php。<br/>   我们可以在普通的一句话木马上传无效的情况下，使用weevley工具生成的一句话木马进行上传，实现在有IDS检测设备或者网站安全狗的企业网络场景下进行渗透测试，后门放置，文件管理，资源搜索，命令执行，系统信息收集等多种功能。</p>\n<p><br/></p>\n<h1><a id=\"_weevely_23\"></a>二． 安装weevely</h1>\n<ol><li>安装weevely之前需要安装python，这里就不多赘述。（如有需要后面我会补充安装python的博客）</li></ol>\n<p><br/></p>\n<ol start=\"2\"><li>由于我的电脑上有kaliLinux镜像，所以这次将直接使用kaliLinux里的weevely。（关于如何安装weevely后面有时间我会更新一篇教程）</li></ol>\n<p><br/></p>\n<h1><a id=\"_weevely_32\"></a>三． 使用weevely</h1>\n<ol><li>启动weevely工具。</li></ol>\n<pre><code class=\"prism language-php\">命令：weevely\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\825545a88e4f4715ace1ffd49ead6151.png\"/></p>\n<blockquote>\n<p>注：<br/> 连接weevely生成的木马 ： weevely &lt; URL &gt; &lt;password&gt; [cmd]<br/> 加载session会话文件 ： weevely session &lt;pa\n  <path>\n   th&gt; [cmd]\n   <br/> 生成weevely后门木马文件 ： weevely generate &lt;password&gt; &lt;pa\n   <path>\n    th&gt;\n   </path>\n</path></p>\n</blockquote>\n<p><br/></p>\n<ol start=\"2\"><li>查看weecely工具的使用方法。</li></ol>\n<pre><code class=\"prism language-php\">命令：weevely <span class=\"token operator\">-</span>h\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\afeeec7c2aeb464385f05006dda92c8e.png\"/></p>\n<blockquote>\n<p>注：<br/> 终端 在目标上运行终端或命令<br/> 会话 恢复现有会话<br/> 生成 生成新代理</p>\n</blockquote>\n<p><br/></p>\n<ol start=\"3\"><li>创建一句话木马。</li></ol>\n<pre><code class=\"prism language-php\">命令：weevely generate cmd <span class=\"token operator\">/</span>root<span class=\"token operator\">/</span>m<span class=\"token operator\">.</span>php\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\c0a6dd45562b46b4bf748292385c73e2.png\"/></p>\n<blockquote>\n<p>注：<br/> cmd是密码<br/> /root/m.php是路径<br/> 当回车后出现Generated ‘路径’ with password ‘密码’ of xxx byte size时即为创建成功。<br/> 这里的木马是weevely自动生成的，不用自己写。当然我们也可以使用命令查看生成的文件。<br/> 创建完weevely木马后，可以上传至靶机，上传操作详见<code>四.weevely实战</code>，此处省略。</p>\n</blockquote>\n<p><br/></p>\n<ol start=\"4\"><li>连接weevely木马。（上传完后操作）</li></ol>\n<pre><code class=\"prism language-php\">命令：weevely http<span class=\"token punctuation\">:</span><span class=\"token comment\">//172.16.1.105/hackable/uploads/m.php cmd</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\04f6e24f5ff744ff827d158a4d29ea16.png\"/></p>\n<blockquote>\n<p>注：<br/> http://172.16.1.105/hackable/upload/m.php是该木马文件在对方靶机里的路径，路径如何判断具体请看<code>四.weevely实战第7步</code>。<br/> cmd 是密码，连接时一定要加上密码，千万不能忘记，否则会出问题。<br/> 出现weevely&gt; 即为木马连接成功。</p>\n</blockquote>\n<p><br/></p>\n<ol start=\"5\"><li>输入任意键回车后进入虚拟终端界面。</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\f90d636dbe45448c80e7a843afa92caf.png\"/></p>\n<blockquote>\n<p>注：<br/> 此处我们可以发现部分内容显示乱码，需在终端中点击设定字符编码。<br/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\ed160475e0084f639a453cfe93b2d73d.png\"/><br/><br/> 点击添加或删除，添加GB2312简体中文。 <br/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\279219493cc348819133a9f22fd105ae.png\"/><br/><br/> 关闭页面，重新回到终端-设定字符编码中，选择简体中文（GB2312）。 <br/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\841a317b4e1048ffb1d207aef8e9dffa.png\"/><br/></p>\n</blockquote>\n<p><br/></p>\n<ol start=\"6\"><li>在虚拟终端模式查看可以利用的weevely模块。</li></ol>\n<pre><code class=\"prism language-php\">命令：点击键盘上的Tab\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\9351c72273544e03bbdb031dbd42ce8c.png\"/></p>\n<blockquote>\n<p>注：使用模块时前面记得加<code>:</code>（英文冒号）</p>\n</blockquote>\n<p><br/></p>\n<ol start=\"7\"><li>至此，weevely基本使用完成。</li></ol>\n<p><br/></p>\n<h1><a id=\"_weevely_125\"></a>四． weevely实战</h1>\n<p><br/></p>\n<p><strong>靶场：DVWA<br/> 渗透机：kaliLinux<br/> 靶机：WindowsServer 2008<br/> 漏洞：文件上传<br/> 工具：weevely<br/> 难度：Low</strong></p>\n<p><br/></p>\n<ol><li>前往DVWA靶场。</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\7f07975b71394027bfce75a0585b1bfb.png\"/></p>\n<p><br/></p>\n<ol start=\"2\"><li>点击DVWA Security更改安全级别。</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\59b19d98897c457aa185858b4f5b93f0.png\"/></p>\n<p><br/></p>\n<ol start=\"3\"><li>点击下拉框，选择Low。</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\e68ac68096f84927a48f15dbd9f6e05b.png\"/></p>\n<p><br/></p>\n<ol start=\"4\"><li>点击Submit保存更改。</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\c5ec711f6b33434f8dde86877f1c59ef.png\"/></p>\n<p><br/></p>\n<ol start=\"5\"><li>点击File Upload。</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\6dccf9c4499b4326b082e7693530c47b.png\"/></p>\n<p><br/></p>\n<ol start=\"6\"><li>点击Browse选择文件。（该文件为我们<code>三.使用weevely</code>时创建的weevely木马）</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\b7e3538a52c046bfb73e762605e696ef.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\9aeab4b0cb8f42f18ff9c403ddeb819c.png\"/></p>\n<p><br/></p>\n<ol start=\"7\"><li>点击Upload上传。</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\e830c95706d543a787f9a0fd2db4d6f6.png\"/></p>\n<blockquote>\n<p>注：<br/> 出现路径以及<code>sucessfully uploaded！</code>等文字即为文件上传成功。<br/> 对方靶机里该文件路径具体判断方法为：<br/> 首先观察红字部分<code>../../hackable/uploads/m.php successfully uploaded!</code>中<code>../../</code>指的是目前URL中的路径<code>172.16.1.105/vulnerabilities/upload/</code>的上上级，即<code>172.16.1.105/</code>，所以靶机里的该文件的路径为<code>172.16.1.105/ hackable/uploads/m.php</code>。</p>\n</blockquote>\n<p><br/></p>\n<ol start=\"8\"><li>上传成功，进行连接。</li></ol>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\0fda0528804844e1a064d7ade7b53c3d.png\"/></p>\n<p><br/></p>\n<ol start=\"9\"><li>进入虚拟终端。（进入方法详见<code>三.使用weevely第5步</code>）</li></ol>\n<p><br/></p>\n<ol start=\"10\"><li>渗透成功，进行具体操作。例如获取靶机flag等等。</li></ol>\n<p><br/></p>\n<h1><a id=\"__199\"></a>五． 常用模块</h1>\n<p>:backdoor_reversetcp 执行反向TCP shell。<br/> :backdoor_tcp 在TCP端口产生一个壳。<br/> :file_cp 复制单个文件。<br/> :file_grep 打印线与多个文件中的模式匹配。<br/> :file_zip 压缩或展开ZIP文件。<br/> :file_bzip2 压缩或展开Bzip2文件。<br/> :file_tar 压缩或展开tar文件。<br/> :file_gzip 压缩或展开Gzip文件。<br/> :file_mount 使用httpfs安装远程文件系统。<br/> :file_cd 更改当前工作目录。<br/> :file_clearlog 从文件中删除字符串。<br/> :file_read 从远程文件系统中读取远程文件。<br/> :file_download 从远程文件系统下载文件。<br/> :file_touch 更改文件时间戳。<br/> :file_ls 列表目录内容。<br/> :file_enum 检查存在列表列表的存在和权限。<br/> :file_upload 将文件上传到远程文件系统。<br/> :file_find 查找具有给定名称和属性的文件。<br/> :file_check 获取文件的属性和权限。<br/> :file_edit 在本地编辑器上编辑远程文件。<br/> :file_webdownload 下载URL。<br/> :file_upload2web 将文件自动上传到Web文件夹并获得相应的URL。<br/> :file_rm 删除远程文件。<br/> :shell_php 执行php命令。<br/> :shell_sh 执行shell命令。<br/> :shell_su 执行su的命令。<br/> :sql_dump 多DBMS MySqldump更换。<br/> :sql_console 执行SQL查询或运行控制台。<br/> :bruteforce_sql BruteForce SQL数据库。<br/> :net_ifconfig 获取网络接口地址。<br/> :net_mail 发送邮件。<br/> :net_curl 执行类似卷曲的HTTP请求。<br/> :net_scan TCP端口扫描。<br/> :net_proxy 运行本地代理以通过目标浏览HTTP / HTTPS浏览。<br/> :net_phpproxy 在目标上安装PHP代理。<br/> :system_info 收集系统信息。<br/> :system_extensions 收集PHP和WebServer扩展列表。<br/> :system_procs 列出运行进程。<br/> :audit_phpconf 审核PHP配置。<br/> :audit_suidsgid 查找suid或sgid标志的文件。<br/> :audit_disablefunctionbypass 旁路禁用与mod_cgi和.htaccess的限制。<br/> :audit_filesystem 审核文件系统以获取弱权限。<br/> :audit_etcpasswd 用不同的技术读取/ etc / passwd。</p>\n<p><br/></p>\n<h1><a id=\"_weevely_246\"></a>六． weevely工作原理</h1>\n<p>  weevely在上传木马进行后渗透测试的过程中可用于模拟一个类似于telnet的连接shell，通常用于web程序的漏洞利用，隐藏后门或者使用类似telnet的方式来代替web 页面式的管理，weevely生成的服务器端php代码经过了base64编码，可以绕过主流的杀毒软件和IDS，上传服务器端代码后通常可以通过weevely直接运行。使用它可以浏览文件系统，检测服务器设置，创建tcpshell和reverse shell。<br/>   客户端为运行weevely进程的计算机，服务端为存有PHP木马的服务器。在客户端，weevely每执行一条命令就通过HTTP协议发出一条GET/POST请求；在服务端，木马针对每条GET/POST请求作出响应，产生一条响应包。</p>\n<p><br/></p>\n<hr/>\n<p><strong>本篇博客为本人学习weevely时的详细记录，如有错误之处，还望各位指正。</strong><br/> <strong>该篇博客，仅作网络安全学习交流，切勿用于任何非法用途，否则后果自负。</strong><br/> <strong>禁止转载!!!</strong></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}