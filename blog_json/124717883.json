{"blogid": "124717883", "writerAge": "码龄2年", "writerBlogNum": "65", "writerCollect": "64", "writerComment": "15", "writerFan": "56", "writerGrade": "4级", "writerIntegral": "854", "writerName": "spring℡", "writerProfileAdress": "writer_image\\profile_124717883.jpg", "writerRankTotal": "39504", "writerRankWeekly": "163696", "writerThumb": "140", "writerVisitNum": "47488", "blog_read_count": "4433", "blog_time": "已于 2022-05-11 21:36:14 修改", "blog_title": "MySQL备份", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"main-toc-toc\" style=\"margin-left:0px;\"><a href=\"#main-toc\">一、直接拷贝数据库文件</a></p>\n<p id=\"%C2%A0%E4%BA%8C%E3%80%81mysqldump%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93-toc\" style=\"margin-left:0px;\"><a href=\"#%C2%A0%E4%BA%8C%E3%80%81mysqldump%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93\">二、mysqldump备份数据库</a></p>\n<p id=\"1%20%E5%A4%87%E4%BB%BD-toc\" style=\"margin-left:40px;\"><a href=\"#1%20%E5%A4%87%E4%BB%BD\">1、备份</a></p>\n<p id=\"2%20%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F-toc\" style=\"margin-left:40px;\"><a href=\"#2%20%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F\">2、备份还原</a></p>\n<p id=\"%EF%BC%881%EF%BC%89%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%881%EF%BC%89%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F\">(1)完全备份还原</a></p>\n<p id=\"%EF%BC%882%EF%BC%89%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%882%EF%BC%89%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD\">(2)增量备份</a></p>\n<p id=\"%23eg-toc\" style=\"margin-left:80px;\"><a href=\"#%23eg\">#eg</a></p>\n<p id=\"%C2%A0%20%C2%A0%20%C2%A0(1)%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8resume.test-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%20%C2%A0%20%C2%A0%281%29%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8resume.test\">     ​(1)创建一个新的数据库表resume.test</a></p>\n<p id=\"%C2%A0%20%C2%A0%20%C2%A0%E2%80%8B(2)%E6%AD%A4%E6%97%B6%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%20%C2%A0%20%C2%A0%E2%80%8B%282%29%E6%AD%A4%E6%97%B6%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD\">     ​(2)此时完全备份</a></p>\n<p id=\"%C2%A0%20%C2%A0%20%C2%A0%E2%80%8B(3)%E6%8E%A5%E7%9D%80%E5%86%8D%E5%BE%80%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E9%87%8C%E9%9D%A2%E6%8F%92%E5%85%A5%E4%B8%A4%E6%9D%A1%E6%95%B0%E6%8D%AE-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%20%C2%A0%20%C2%A0%E2%80%8B%283%29%E6%8E%A5%E7%9D%80%E5%86%8D%E5%BE%80%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E9%87%8C%E9%9D%A2%E6%8F%92%E5%85%A5%E4%B8%A4%E6%9D%A1%E6%95%B0%E6%8D%AE\">     ​​(3)接着再往数据库表里面插入两条数据</a></p>\n<p id=\"%C2%A0%20%C2%A0%20%C2%A0(4)%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93resume%2C%E5%88%B7%E6%96%B0%E6%97%A5%E5%BF%97-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%20%C2%A0%20%C2%A0%284%29%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93resume%2C%E5%88%B7%E6%96%B0%E6%97%A5%E5%BF%97\">     ​(4)删除数据库resume,刷新日志</a></p>\n<p id=\"%C2%A0%20%C2%A0%20%C2%A0(5)%E6%AD%A4%E6%97%B6%E4%BC%9A%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%20%C2%A0%20%C2%A0%285%29%E6%AD%A4%E6%97%B6%E4%BC%9A%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97\">     ​(5)此时会增加一个新的二进制日志</a></p>\n<p id=\"%C2%A0%20%C2%A0%20%C2%A0(6)%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%20%C2%A0%20%C2%A0%286%29%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F\">     ​(6)备份还原</a></p>\n<p id=\"%C2%A0%E4%B8%89%E3%80%81GTID%E5%85%A8%E5%B1%80%E4%BA%8B%E5%8A%A1%E6%A0%87%E8%AF%86%E7%AC%A6-toc\" style=\"margin-left:0px;\"><a href=\"#%C2%A0%E4%B8%89%E3%80%81GTID%E5%85%A8%E5%B1%80%E4%BA%8B%E5%8A%A1%E6%A0%87%E8%AF%86%E7%AC%A6\">#GTID全局事务标识符</a></p>\n<p id=\"1%E3%80%81binlog%E6%97%A5%E5%BF%97%E7%9A%84GTID%E6%96%B0%E7%89%B9%E6%80%A7-toc\" style=\"margin-left:40px;\"><a href=\"#1%E3%80%81binlog%E6%97%A5%E5%BF%97%E7%9A%84GTID%E6%96%B0%E7%89%B9%E6%80%A7\">#binlog日志的GTID新特性</a></p>\n<p id=\"%EF%BC%881%EF%BC%89%E5%90%AF%E5%8A%A8gtid-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%881%EF%BC%89%E5%90%AF%E5%8A%A8gtid\">(1)启动gtid</a></p>\n<p id=\"%EF%BC%882%EF%BC%89%C2%A0%E4%BD%BF%E7%94%A8DDL%E5%92%8CDML%E8%AF%AD%E5%8F%A5%E4%B9%8B%E5%90%8E%E6%9F%A5%E7%9C%8Bgtid%E4%BC%9A%E5%8F%91%E7%94%9F%E6%94%B9%E5%8F%98-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%882%EF%BC%89%C2%A0%E4%BD%BF%E7%94%A8DDL%E5%92%8CDML%E8%AF%AD%E5%8F%A5%E4%B9%8B%E5%90%8E%E6%9F%A5%E7%9C%8Bgtid%E4%BC%9A%E5%8F%91%E7%94%9F%E6%94%B9%E5%8F%98\">(2)使用DDL和DML语句之后查看gtid会发生改变</a></p>\n<p id=\"%23%E6%9F%A5%E7%9C%8Bbinlog-toc\" style=\"margin-left:80px;\"><a href=\"#%23%E6%9F%A5%E7%9C%8Bbinlog\">#查看binlog</a></p>\n<p id=\"%C2%A0(3)%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%98%E5%8E%9F-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%283%29%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%98%E5%8E%9F\">(3)数据库还原</a></p>\n<p id=\"%C2%A0%E4%B8%89%E3%80%81mydumper%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93-toc\" style=\"margin-left:0px;\"><a href=\"#%C2%A0%E4%B8%89%E3%80%81mydumper%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93\">三、mydumper备份数据库</a></p>\n<p id=\"1%E3%80%81%E5%A4%87%E4%BB%BD%20mydumper-toc\" style=\"margin-left:40px;\"><a href=\"#1%E3%80%81%E5%A4%87%E4%BB%BD%20mydumper\">1、备份 mydumper</a></p>\n<p id=\"2%E3%80%81%E8%BF%98%E5%8E%9Fmyloader-toc\" style=\"margin-left:40px;\"><a href=\"#2%E3%80%81%E8%BF%98%E5%8E%9Fmyloader\">2、还原 myloader</a></p>\n<p id=\"%C2%A0eg%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%20db.course%EF%BC%8C%E5%88%A0%E9%99%A4%E8%A1%A8%E5%90%8E%E8%BF%98%E5%8E%9F-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0eg%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%20db.course%EF%BC%8C%E5%88%A0%E9%99%A4%E8%A1%A8%E5%90%8E%E8%BF%98%E5%8E%9F\"> eg：备份数据库表 db.course，删除表后还原</a></p>\n<p id=\"%E5%9B%9B%E3%80%81%E5%80%9F%E7%94%A8windows%E4%B8%8B%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%A4%87%E4%BB%BD-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%9B%9B%E3%80%81%E5%80%9F%E7%94%A8windows%E4%B8%8B%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%A4%87%E4%BB%BD\">四、借用windows下的软件备份</a></p>\n<p id=\"1%E3%80%81%E9%A6%96%E5%85%88%E5%85%88%E6%8E%88%E6%9D%83%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7-toc\" style=\"margin-left:80px;\"><a href=\"#1%E3%80%81%E9%A6%96%E5%85%88%E5%85%88%E6%8E%88%E6%9D%83%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7\">1、首先先授权一个用户</a></p>\n<p id=\"2%E3%80%81%E6%AD%A4%E6%97%B6%E8%BD%AF%E4%BB%B6%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93-toc\" style=\"margin-left:80px;\"><a href=\"#2%E3%80%81%E6%AD%A4%E6%97%B6%E8%BD%AF%E4%BB%B6%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93\">2、此时软件登录数据库</a></p>\n<p id=\"%E4%BA%94%E3%80%81lvm%E5%A4%87%E4%BB%BD%E3%80%81%E6%81%A2%E5%A4%8D-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%94%E3%80%81lvm%E5%A4%87%E4%BB%BD%E3%80%81%E6%81%A2%E5%A4%8D\">五、lvm备份、恢复</a></p>\n<p id=\"1%E3%80%81%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%88%B0%E9%80%BB%E8%BE%91%E5%8D%B7-toc\" style=\"margin-left:40px;\"><a href=\"#1%E3%80%81%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%88%B0%E9%80%BB%E8%BE%91%E5%8D%B7\">1、数据迁移到逻辑卷</a></p>\n<p id=\"%EF%BC%881%EF%BC%89%E8%BF%9B%E8%A1%8C%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%881%EF%BC%89%E8%BF%9B%E8%A1%8C%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86\">（1）进行逻辑卷管理</a></p>\n<p id=\"%EF%BC%882%EF%BC%89%20%E5%B0%86%2Fvar%2Flib%2Fmysql%2F%E4%B8%8B%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9%E5%8E%8B%E7%BC%A9%E6%89%93%E5%8C%85%E5%88%B0%2Fbackup%2FMySQL%2F-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%882%EF%BC%89%20%E5%B0%86%2Fvar%2Flib%2Fmysql%2F%E4%B8%8B%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9%E5%8E%8B%E7%BC%A9%E6%89%93%E5%8C%85%E5%88%B0%2Fbackup%2FMySQL%2F\">（2） 将/var/lib/mysql/下所有内容压缩打包到/backup/MySQL/</a></p>\n<p id=\"%EF%BC%883%EF%BC%89%E5%B0%86lv_mysql%E6%8C%82%E8%BD%BD%E5%88%B0%2Fvar%2Flib%2Fmysql%E4%B8%8B%E6%AD%A4%E6%97%B6mysql%E4%B8%8B%E5%86%85%E5%AE%B9%E5%B0%86%E8%87%AA%E5%8A%A8%E8%A2%AB%E6%B8%85%E7%A9%BA%EF%BC%8C%E6%8E%A5%E7%9D%80%E8%BF%9B%E8%A1%8C%E8%A7%A3%E5%8E%8B-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%883%EF%BC%89%E5%B0%86lv_mysql%E6%8C%82%E8%BD%BD%E5%88%B0%2Fvar%2Flib%2Fmysql%E4%B8%8B%E6%AD%A4%E6%97%B6mysql%E4%B8%8B%E5%86%85%E5%AE%B9%E5%B0%86%E8%87%AA%E5%8A%A8%E8%A2%AB%E6%B8%85%E7%A9%BA%EF%BC%8C%E6%8E%A5%E7%9D%80%E8%BF%9B%E8%A1%8C%E8%A7%A3%E5%8E%8B\">（3）将lv_mysql挂载到/var/lib/mysql下此时mysql下内容将自动被清空，接着进行解压</a></p>\n<p id=\"%EF%BC%884%EF%BC%89%C2%A0%E6%8E%A5%E7%9D%80%E6%A3%80%E6%9F%A5%E6%89%80%E5%B1%9E%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E6%98%AF%E5%90%A6%E4%B8%BAmysql%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%88%99%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%884%EF%BC%89%C2%A0%E6%8E%A5%E7%9D%80%E6%A3%80%E6%9F%A5%E6%89%80%E5%B1%9E%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E6%98%AF%E5%90%A6%E4%B8%BAmysql%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%88%99%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9\">（4） 接着检查所属用户和组是否为mysql，如果不是则需要修改</a></p>\n<p id=\"%EF%BC%885%EF%BC%89%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%885%EF%BC%89%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93\">（5）登录数据库</a></p>\n<p id=\"%E2%80%8B%23%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83%E6%96%B9%E6%B3%95-toc\" style=\"margin-left:80px;\"><a href=\"#%E2%80%8B%23%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83%E6%96%B9%E6%B3%95\">​#创建用户并授权方法</a></p>\n<p id=\"2%E3%80%81%E5%BF%AB%E7%85%A7%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93-toc\" style=\"margin-left:40px;\"><a href=\"#2%E3%80%81%E5%BF%AB%E7%85%A7%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93\">2、快照备份数据库</a></p>\n<p id=\"%EF%BC%881%EF%BC%89%E9%94%81%E8%A1%A8%EF%BC%88%E8%AF%BB%E9%94%81%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%881%EF%BC%89%E9%94%81%E8%A1%A8%EF%BC%88%E8%AF%BB%E9%94%81%EF%BC%89\">(1)锁表（读锁）</a></p>\n<p id=\"%EF%BC%882%EF%BC%89%E9%80%BB%E8%BE%91%E5%8D%B7%E5%88%9B%E5%BB%BA%E5%BF%AB%E7%85%A7-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%882%EF%BC%89%E9%80%BB%E8%BE%91%E5%8D%B7%E5%88%9B%E5%BB%BA%E5%BF%AB%E7%85%A7\">(2)逻辑卷创建快照</a></p>\n<p id=\"%EF%BC%883%EF%BC%89%E8%A7%A3%E9%94%81-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%883%EF%BC%89%E8%A7%A3%E9%94%81\">(3)解锁</a></p>\n<p id=\"%EF%BC%884%EF%BC%89%E6%8C%82%E8%BD%BD-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%884%EF%BC%89%E6%8C%82%E8%BD%BD\">(4)挂载</a></p>\n<p id=\"%C2%A0%20%C2%A0%20%C2%A0%20%23%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89rsync%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%EF%BC%88yum%20install%20rsync%20-y%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%20%C2%A0%20%C2%A0%20%23%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89rsync%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%EF%BC%88yum%20install%20rsync%20-y%EF%BC%89\">      #如果没有rsync需要进行安装（yum install rsync -y）</a></p>\n<p id=\"%EF%BC%885%EF%BC%89%E5%A4%87%E4%BB%BD-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%885%EF%BC%89%E5%A4%87%E4%BB%BD\">(5)备份</a></p>\n<p id=\"%C2%A0%EF%BC%886%EF%BC%89%E6%AD%A4%E6%97%B6%E5%85%B3%E6%8E%89mysql%20%E9%85%8D%E7%BD%AE%2Fetc%2Fmy.cnf-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%EF%BC%886%EF%BC%89%E6%AD%A4%E6%97%B6%E5%85%B3%E6%8E%89mysql%20%E9%85%8D%E7%BD%AE%2Fetc%2Fmy.cnf\">(6)此时关掉mysql 配置/etc/my.cnf</a></p>\n<p id=\"%C2%A0%EF%BC%887%EF%BC%89%E6%8E%A5%E7%9D%80%E5%90%AF%E5%8A%A8mysql%E5%B9%B6%E7%99%BB%E5%BD%95%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%92%8C%E5%BC%80%E5%A7%8B%E4%B8%80%E6%A0%B7-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0%EF%BC%887%EF%BC%89%E6%8E%A5%E7%9D%80%E5%90%AF%E5%8A%A8mysql%E5%B9%B6%E7%99%BB%E5%BD%95%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%92%8C%E5%BC%80%E5%A7%8B%E4%B8%80%E6%A0%B7\">(7)接着启动mysql并登录可以看到数据库表和开始一样</a></p>\n<p id=\"%EF%BC%888%EF%BC%89%E5%8D%B8%E8%BD%BD%E5%BF%AB%E7%85%A7%E5%B9%B6%E5%88%A0%E9%99%A4-toc\" style=\"margin-left:80px;\"><a href=\"#%EF%BC%888%EF%BC%89%E5%8D%B8%E8%BD%BD%E5%BF%AB%E7%85%A7%E5%B9%B6%E5%88%A0%E9%99%A4\">(8)卸载快照并删除</a></p>\n<p id=\"%23%E8%84%9A%E6%9C%AC%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%EF%BC%881%EF%BC%89-%EF%BC%888%EF%BC%89%E6%93%8D%E4%BD%9C-toc\" style=\"margin-left:80px;\"><a href=\"#%23%E8%84%9A%E6%9C%AC%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%EF%BC%881%EF%BC%89-%EF%BC%888%EF%BC%89%E6%93%8D%E4%BD%9C\">#脚本方式进行（1）-（8）操作</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<h1 id=\"main-toc\">一、直接拷贝数据库文件</h1>\n<pre><code>首先关闭数据库\n[root@host1 mysql]# pwd\n/var/lib/mysql\n压缩、拷贝到host2\n[root@host1 mysql]# tar czf db.tar.gz *\n[root@host1 mysql]# scp db.tar.gz 192.168.157.11:/beifen\n\nhost2\n首先关闭数据库，清理/var/lib/mysql/下的内容\n[root@host2 beifen]# tar xf db.tar.gz /var/lib/mysql/\n将/beifen/db.tar.gz解压到/var/lib/mysql</code></pre>\n<p><img alt=\"\" height=\"270\" src=\"image\\0f9684db77624803a7e59167aa18773f.png\" width=\"968\"/></p>\n<p> 此时登录host2的数据库可以看到两个数据库中的内容相同</p>\n<p><img alt=\"\" height=\"824\" src=\"image\\73dd6e718d4e461d951ca62ab02fb125.png\" width=\"1200\"/></p>\n<h1 id=\"%C2%A0%E4%BA%8C%E3%80%81mysqldump%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93\">二、mysqldump备份数据库</h1>\n<h2 id=\"1%20%E5%A4%87%E4%BB%BD\">1、备份</h2>\n<pre><code>帮助 mysqldump --help\n\n[root@host1 ~]# mysqldump -u登录用户 -p'密码' 数据库 表名 &gt; 备份文件名称.sql\n#数据库 表名:这里可以是指定数据库或者是某个库表\n-A备份所有数据库，\n-B会将创建数据库语句也备份，\n-b备份数据库表的结构不备份数据。\n​\n备份数据库\n[root@host1 ~]# mysqldump -uroot -p'MySQL@123' db -B  &gt; beifen1.sql  \nmysqldump: [Warning] Using a password on the command line interface can be insecure.\n[root@host1 ~]# ls\nbeifen1.sql\n备份成压缩包形式\n[root@host1 ~]# mysqldump -uroot -p'MySQL@123' db -B | gzip &gt; beifen1.sql.gz\nmysqldump: [Warning] Using a password on the command line interface can be insecure.</code></pre>\n<p> <img alt=\"\" height=\"88\" src=\"image\\6d14eb16cd454578a59719677d362e7d.png\" width=\"374\"/></p>\n<pre><code>备份数据库表\n[root@host1 ~]# mysqldump -uroot -p'MySQL@123' db course &gt; beifen2.sql\nmysqldump: [Warning] Using a password on the command line interface can be insecure.\n[root@host1 ~]# ls beifen*\nbeifen1.sql  beifen1.sql.gz  beifen2.sql</code></pre>\n<h2 id=\"2%20%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F\">2、备份还原</h2>\n<h3 id=\"%EF%BC%881%EF%BC%89%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F\">(1)完全备份还原</h3>\n<pre><code>备份还原\n还原数据库\n方法一\n在mysql中source后跟备份文件存放路径\nmysql&gt; source /backup/MySQL/beifen1.sql\n​\n方法二\n[root@host1 ~]# mysql -uroot -p'MySQL@123' &lt; /backup/MySQL/beifen1.sql\nmysql: [Warning] Using a password on the command line interface can be insecure.\n​\n这个时候就可以看到被还原的数据库\n​\n还原数据库表\nmysql&gt; source /backup/MySQL/beifen2.sql\n​\n[root@host1 MySQL]# mysql -uroot -p'MySQL@123' db &lt; ./beifen2.sql\nmysql: [Warning] Using a password on the command line interface can be insecure.\n​\n压缩包还原\n[root@host1 MySQL]# zcat ./beifen1.sql.gz | mysql -uroot -p'MySQL@123'\nmysql: [Warning] Using a password on the command line interface can be insecure.</code></pre>\n<h3 id=\"%EF%BC%882%EF%BC%89%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD\">(2)增量备份</h3>\n<p>首先是要先开启数据库的二进制日志的log_bin</p>\n<p>方法参考<a href=\"https://blog.csdn.net/weixin_52951697/article/details/124260039?spm=1001.2014.3001.5501#t7\" title=\"MySQL日志管理_spring℡的博客-CSDN博客\">MySQL日志管理_spring℡的博客-CSDN博客</a></p>\n<p>第一步先做完全备份</p>\n<h3 id=\"%23eg\">#eg</h3>\n<h3 id=\"%C2%A0%20%C2%A0%20%C2%A0(1)%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8resume.test\">     ​(1)创建一个新的数据库表resume.test</h3>\n<pre><code>mysql&gt; select * from test;\n+--------+------+------+------------+------+\n| name   | weig | age  | hobby      | sex  |\n+--------+------+------+------------+------+\n| 白熊   | 80.0 |   10 | dance,sing | m    |\n| 胖达   | 75.0 |   10 | dance,sing | m    |\n+--------+------+------+------------+------+\n2 rows in set (0.00 sec)\n​\nmysql&gt; insert test values ('克洛伊','35','8','sing','f'),('棕熊','76','9','dance','m');\nQuery OK, 2 rows affected (0.01 sec)\nRecords: 2  Duplicates: 0  Warnings: 0</code></pre>\n<h3 id=\"%C2%A0%20%C2%A0%20%C2%A0%E2%80%8B(2)%E6%AD%A4%E6%97%B6%E5%AE%8C%E5%85%A8%E5%A4%87%E4%BB%BD\">     ​(2)此时完全备份</h3>\n<pre><code>[root@host1 MySQL]# mysqldump -uroot -p'MySQL@123' --opt -F --single-transaction -B resume &gt; /backup/MySQL/resume.sql\nmysqldump: [Warning] Using a password on the command line interface can be insecure.</code></pre>\n<h3 id=\"%C2%A0%20%C2%A0%20%C2%A0%E2%80%8B(3)%E6%8E%A5%E7%9D%80%E5%86%8D%E5%BE%80%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E9%87%8C%E9%9D%A2%E6%8F%92%E5%85%A5%E4%B8%A4%E6%9D%A1%E6%95%B0%E6%8D%AE\">     ​​(3)接着再往数据库表里面插入两条数据</h3>\n<pre><code>mysql&gt; insert test values ('小白','45','8','sing','f'),('小胖','66','9','dance','m');</code></pre>\n<h3 id=\"%C2%A0%20%C2%A0%20%C2%A0(4)%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93resume%2C%E5%88%B7%E6%96%B0%E6%97%A5%E5%BF%97\">     ​(4)删除数据库resume,刷新日志</h3>\n<pre><code>mysql&gt; drop database resume;\nQuery OK, 1 row affected (0.01 sec)\nmysql&gt; flush logs;\nQuery OK, 0 rows affected (0.01 sec)</code></pre>\n<h3 id=\"%C2%A0%20%C2%A0%20%C2%A0(5)%E6%AD%A4%E6%97%B6%E4%BC%9A%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97\">     ​(5)此时会增加一个新的二进制日志</h3>\n<pre><code>[root@host1 mysql]# ll mysql-bin.00000*\n-rw-r-----. 1 mysql mysql   177 Apr 17 14:34 mysql-bin.000002\n-rw-r-----. 1 mysql mysql   177 Apr 17 14:54 mysql-bin.000003\n-rw-r-----. 1 mysql mysql   177 Apr 17 14:59 mysql-bin.000004\n-rw-r-----. 1 mysql mysql   177 Apr 17 15:28 mysql-bin.000005\n-rw-r-----. 1 mysql mysql  3303 Apr 17 15:37 mysql-bin.000006\n-rw-r-----. 1 mysql mysql 18407 Apr 20 15:03 mysql-bin.000007\n-rw-r-----. 1 mysql mysql  2059 Apr 20 16:44 mysql-bin.000008\n-rw-r-----. 1 mysql mysql   665 Apr 20 16:46 mysql-bin.000009</code></pre>\n<h3 id=\"%C2%A0%20%C2%A0%20%C2%A0(6)%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F\">     ​(6)备份还原</h3>\n<p>第一步还原完全备份<br/> mysql&gt; source /backup/MySQL/resume.sql<br/> ​<br/> 第二步还原增量备份<br/> [root@host1 ~]# mysqlbinlog /var/lib/mysql/mysql-bin.000009</p>\n<p><img alt=\"\" height=\"782\" src=\"image\\d636513352de4d37a6235e5c9a3a8f2f.png\" width=\"1200\"/></p>\n<pre><code>方法一：根据时间备份还原\n[root@host1 MySQL]# mysqlbinlog --start-datetime=\"2022-04-20 16:45:32\" --stop-datetime=\"2022-04-20 16:45:57\"  /var/lib/mysql/mysql-bin.000009 -r resume1.sql\n[root@host1 MySQL]# mysql -uroot -p'MySQL@123' &lt; resume1.sql\nmysql: [Warning] Using a password on the command line interface can be insecure.\n​\n方法二：根据位置点备份还原\n[root@host1 MySQL]# mysqlbinlog --start-position=293 --stop-position=455  /var/lib/mysql/mysql-bin.000009 -r resume2.sql\nmysql&gt; source /backup/MySQL/resume2.sql</code></pre>\n<pre><code>mysql&gt; select * from test;\n+-----------+------+------+------------+------+\n| name      | weig | age  | hobby      | sexs  |\n+-----------+------+------+------------+------+\n| 白熊      | 80.0 |   10 | dance,sing | m    |\n| 胖达      | 75.0 |   10 | dance,sing | m    |\n| 克洛伊    | 35.0 |    8 | sing       | f    |\n| 棕熊      | 76.0 |    9 | dance      | m    |\n| 小白      | 45.0 |    8 | sing       | f    |\n| 小胖      | 66.0 |    9 | dance      | m    |\n+-----------+------+------+------------+------+\n6 rows in set (0.00 sec)</code></pre>\n<h1 id=\"%C2%A0%E4%B8%89%E3%80%81GTID%E5%85%A8%E5%B1%80%E4%BA%8B%E5%8A%A1%E6%A0%87%E8%AF%86%E7%AC%A6\">#GTID全局事务标识符</h1>\n<p>5.6以后添加5.7做了加强</p>\n<h2 id=\"1%E3%80%81binlog%E6%97%A5%E5%BF%97%E7%9A%84GTID%E6%96%B0%E7%89%B9%E6%80%A7\">#binlog日志的GTID新特性</h2>\n<h3 id=\"%EF%BC%881%EF%BC%89%E5%90%AF%E5%8A%A8gtid\">(1)启动gtid</h3>\n<pre><code>mysql&gt; desc mysql.gtid_executed\n   -&gt; ;\n+----------------+------------+------+-----+---------+-------+\n| Field          | Type       | Null | Key | Default | Extra |\n+----------------+------------+------+-----+---------+-------+\n| source_uuid    | char(36)   | NO   | PRI | NULL    |       |\n| interval_start | bigint(20) | NO   | PRI | NULL    |       |\n| interval_end   | bigint(20) | NO   |     | NULL    |       |\n+----------------+------------+------+-----+---------+-------+\n3 rows in set (0.01 sec)</code></pre>\n<pre><code>mysql&gt; show variables like '%gtid%';\n+----------------------------------+-----------+\n| Variable_name                    | Value     |\n+----------------------------------+-----------+\n| binlog_gtid_simple_recovery      | ON        |\n| enforce_gtid_consistency         | OFF       |\n| gtid_executed_compression_period | 1000      |\n| gtid_mode                        | OFF       |\n| gtid_next                        | AUTOMATIC |\n| gtid_owned                       |           |\n| gtid_purged                      |           |\n| session_track_gtids              | OFF       |\n+----------------------------------+-----------+\n8 rows in set (0.00 sec)</code></pre>\n<p> 由于gtid_mode=OFF所以需要开启</p>\n<pre><code>[root@host1 ~]# vim /etc/my.cnf\n​\ngtid-mode=on\nenforce-gtid-consistency=on</code></pre>\n<p><img alt=\"\" height=\"576\" src=\"image\\32dd50c5b5154f2fb2ce855eb840cb4f.png\" width=\"641\"/></p>\n<h3 id=\"%EF%BC%882%EF%BC%89%C2%A0%E4%BD%BF%E7%94%A8DDL%E5%92%8CDML%E8%AF%AD%E5%8F%A5%E4%B9%8B%E5%90%8E%E6%9F%A5%E7%9C%8Bgtid%E4%BC%9A%E5%8F%91%E7%94%9F%E6%94%B9%E5%8F%98\">(2)使用DDL和DML语句之后查看gtid会发生改变</h3>\n<pre><code>DDL\nmysql&gt; create database dba;\nQuery OK, 1 row affected (0.01 sec)\nmysql&gt; use dba\nDatabase changed\nmysql&gt; create table test (sno char(12),name char(13),cno char(8));\nQuery OK, 0 rows affected (0.01 sec)</code></pre>\n<p><img alt=\"\" height=\"521\" src=\"image\\63dddb755e574c6380272ba9f67625f6.png\" width=\"1200\"/></p>\n<pre><code>DML\n​\n开启事务mysql&gt; begin;\n​\nmysql&gt; insert test(sno,name) values('122110','小白');\nQuery OK, 1 row affected (0.00 sec)\n#不管是中间进行几次插入\n​\n事务提交mysql&gt; commit;\n最后79c7390e-ad1f-11ec-9593-000c29ae9e04:只会增一</code></pre>\n<p><img alt=\"\" height=\"186\" src=\"image\\877fe64c90d14ba28e1cdb5bdb30f674.png\" width=\"1200\"/></p>\n<h3 id=\"%23%E6%9F%A5%E7%9C%8Bbinlog\">#查看binlog</h3>\n<pre><code>mysql&gt; SHOW binlog EVENTS in 'mysql-bin.000012';</code></pre>\n<p><img alt=\"\" height=\"460\" src=\"image\\4b2a022d40d94de39913b7a979bd2ff1.png\" width=\"1200\"/></p>\n<h3 id=\"%C2%A0(3)%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%98%E5%8E%9F\">(3)数据库还原</h3>\n<p>首先有一个数据库 dba 库里面有表tb1,且表内插入了一些简单数据。</p>\n<pre><code>mysql&gt; select * from tb1;\n+-----+--------+\n| sno | name   |\n+-----+--------+\n| 100 | 小明   |\n| 101 | 小李   |\n+-----+--------+\n2 rows in set (0.00 sec)\n\n创完之后删除tb1</code></pre>\n<p>mysql&gt; show binlog events in 'mysql-bin.000012'; </p>\n<p><img alt=\"\" height=\"550\" src=\"image\\a04ab44f8eac4e88a7206f943bbfd6e2.png\" width=\"1200\"/></p>\n<p> 此时在/backup/MySQL下编写备份还原部分内容 </p>\n<p>因为9是删表部分因此恢复1-8</p>\n<pre><code>（1）数据备份\n因为GTID幂等性，这里我添加了--skip-gtids\n​\n[root@host1 MySQL]# mysqlbinlog  --skip-gtids --include-gtids=\"79c7390e-ad1f-11ec-9593-000c29ae9e04:1-8\" mysql-bin.000012 -r gtid_1.sql\n​\n此时就有了gtid_1.sql\n\n（2）数据恢复​\nmysql&gt; set sql_log_bin=0;\nQuery OK, 0 rows affected (0.00 sec)\n​\n[root@host1 MySQL]# mysql -u root -p'MySQL@123'&lt; gtid_1.sql\nmysql: [Warning] Using a password on the command line interface can be insecure.\n​\nmysql&gt; set sql_log_bin=1;\nQuery OK, 0 rows affected (0.00 sec)</code></pre>\n<p>此时在数据库中就可以查看被删除的数据库已经库表</p>\n<p><img alt=\"\" height=\"457\" src=\"image\\5339453260c949db9d3c564d01710902.png\" width=\"339\"/></p>\n<h1 id=\"%C2%A0%E4%B8%89%E3%80%81mydumper%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93\">三、mydumper备份数据库</h1>\n<p>安装：<a href=\"https://gitee.com/mirrors/mydumper#redhat--centos\" title=\"Gitee 极速下载/mydumper\">Gitee 极速下载/mydumper</a></p>\n<pre><code>yum install https://github.com/mydumper/mydumper/releases/download/v0.11.5/mydumper-0.11.5-1.el7.x86_64.rpm</code></pre>\n<h2 id=\"1%E3%80%81%E5%A4%87%E4%BB%BD%20mydumper\">1、备份 mydumper</h2>\n<pre><code>mydumper -uroot -pMySQL@123 -B 数据库名 -T 表名 -o /存放路径</code></pre>\n<pre><code>备份数据库db\n\n[root@localhost ~]# mydumper -u root -p MySQL@123 -B db -o /db\n[root@localhost ~]# tree /db\n/db\n├── db.course.00000.sql\n├── db.course-metadata\n├── db.course-schema.sql\n├── db-schema-create.sql\n├── db.student.00000.sql\n├── db.student-metadata\n├── db.student-schema.sql\n└── metadata\n​\n0 directories, 8 files</code></pre>\n<h2 id=\"2%E3%80%81%E8%BF%98%E5%8E%9Fmyloader\">2、还原 myloader</h2>\n<pre><code>myloader -u root -p MySQL@123 -d /db -o -B db</code></pre>\n<p>先右边再左边 </p>\n<p><img alt=\"\" height=\"835\" src=\"image\\fb37485156904e6d9cb8d39806614d80.png\" width=\"1200\"/></p>\n<h3 id=\"%C2%A0eg%EF%BC%9A%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%20db.course%EF%BC%8C%E5%88%A0%E9%99%A4%E8%A1%A8%E5%90%8E%E8%BF%98%E5%8E%9F\"> eg：备份数据库表 db.course，删除表后还原</h3>\n<pre><code>备份\n[root@localhost db]# mydumper -u root -p MySQL@123 -B db -T course -o /db11\n#这里-B后面跟数据库名，-T后面跟表名，-o代表输出到那个位置\n[root@localhost db]# cd /db11\n[root@localhost db11]# ls\ndb.course.00000.sql  db.course-metadata  db.course-schema.sql  db-schema-create.sql  metadata\n​\n删除表course\nmysql&gt; drop table course;\nQuery OK, 0 rows affected (0.02 sec)\n​\n恢复表course\n[root@localhost db11]# myloader -u root -p MySQL@123 -d /db11 -B db  -o\n这里直接恢复数据库就会恢复表内容</code></pre>\n<p><img alt=\"\" height=\"683\" src=\"image\\48185605c99b4cf3bc2977335b8342d7.png\" width=\"868\"/></p>\n<h1 id=\"%E5%9B%9B%E3%80%81%E5%80%9F%E7%94%A8windows%E4%B8%8B%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%A4%87%E4%BB%BD\">四、借用windows下的软件备份</h1>\n<h3 id=\"1%E3%80%81%E9%A6%96%E5%85%88%E5%85%88%E6%8E%88%E6%9D%83%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7\">1、首先先授权一个用户</h3>\n<p>grant all on <em>.</em> to jim@'%' identified by 'Jim@12345';</p>\n<h3 id=\"2%E3%80%81%E6%AD%A4%E6%97%B6%E8%BD%AF%E4%BB%B6%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93\">2、此时软件登录数据库</h3>\n<p>将需要备份的数据库如下备份，后删除再导入即可</p>\n<p><img alt=\"\" height=\"1046\" src=\"image\\ebd984a4b7f04b248030a60efd107a42.png\" width=\"1200\"/></p>\n<h1 id=\"%E4%BA%94%E3%80%81lvm%E5%A4%87%E4%BB%BD%E3%80%81%E6%81%A2%E5%A4%8D\">五、lvm备份、恢复</h1>\n<h2 id=\"1%E3%80%81%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%88%B0%E9%80%BB%E8%BE%91%E5%8D%B7\">1、数据迁移到逻辑卷</h2>\n<p>先关闭mysql服务，虚拟机添加一块新的磁盘（这里添加6G）</p>\n<p>lvs：查看磁盘分区情况</p>\n<p>lsblk：磁盘剩余内存</p>\n<p>此时重启虚拟机即可</p>\n<p><img alt=\"\" height=\"358\" src=\"image\\8b611b183fd44732b2ffddabb971f8b9.png\" width=\"832\"/></p>\n<h3 id=\"%EF%BC%881%EF%BC%89%E8%BF%9B%E8%A1%8C%E9%80%BB%E8%BE%91%E5%8D%B7%E7%AE%A1%E7%90%86\">（1）进行逻辑卷管理</h3>\n<pre><code>创建物理卷\n[root@localhost ~]# pvcreate /dev/sdb\n  Physical volume \"/dev/sdb\" successfully created.\n​\n创建卷组\n[root@localhost ~]# vgcreate vg1 /dev/sdb\n  Volume group \"vg1\" successfully created\n​\n创建逻辑卷\n[root@localhost ~]# lvcreate -n lv_mysql -L 4G vg1\n  Logical volume \"lv_mysql\" created.\n \n格式化逻辑卷（xfs的文件系统只支持扩大逻辑卷，ext4的文件系统支持扩大和缩小逻辑卷）\n[root@localhost ~]# mkfs.xfs /dev/vg1/lv_mysql</code></pre>\n<p><img alt=\"\" height=\"273\" src=\"image\\0945c6e4e19344df9ca65547623b180f.png\" width=\"996\"/></p>\n<h3 id=\"%EF%BC%882%EF%BC%89%20%E5%B0%86%2Fvar%2Flib%2Fmysql%2F%E4%B8%8B%E6%89%80%E6%9C%89%E5%86%85%E5%AE%B9%E5%8E%8B%E7%BC%A9%E6%89%93%E5%8C%85%E5%88%B0%2Fbackup%2FMySQL%2F\">（2） 将/var/lib/mysql/下所有内容压缩打包到/backup/MySQL/</h3>\n<pre><code>[root@localhost mysql]# tar -czvf /backup/MySQL/mysql.tar.gz .\n查看\n[root@localhost mysql]# tar -tvf /backup/MySQL/mysql.tar.gz</code></pre>\n<h3 id=\"%EF%BC%883%EF%BC%89%E5%B0%86lv_mysql%E6%8C%82%E8%BD%BD%E5%88%B0%2Fvar%2Flib%2Fmysql%E4%B8%8B%E6%AD%A4%E6%97%B6mysql%E4%B8%8B%E5%86%85%E5%AE%B9%E5%B0%86%E8%87%AA%E5%8A%A8%E8%A2%AB%E6%B8%85%E7%A9%BA%EF%BC%8C%E6%8E%A5%E7%9D%80%E8%BF%9B%E8%A1%8C%E8%A7%A3%E5%8E%8B\">（3）将lv_mysql挂载到/var/lib/mysql下此时mysql下内容将自动被清空，接着进行解压</h3>\n<pre><code>[root@localhost mysql]# mount /dev/vg1/lv_mysql /var/lib/mysql\n[root@localhost mysql]# tar xf /backup/MySQL/mysql.tar.gz -C .</code></pre>\n<h3 id=\"%EF%BC%884%EF%BC%89%C2%A0%E6%8E%A5%E7%9D%80%E6%A3%80%E6%9F%A5%E6%89%80%E5%B1%9E%E7%94%A8%E6%88%B7%E5%92%8C%E7%BB%84%E6%98%AF%E5%90%A6%E4%B8%BAmysql%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%88%99%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9\">（4） 接着检查所属用户和组是否为mysql，如果不是则需要修改</h3>\n<pre><code>[root@localhost lib]# ls -ld mysql\ndrwxr-x--x. 15 mysql mysql 4096 May  4 16:42 mysql\n\n此时启动mysql即可\nsystemctl start mysqld</code></pre>\n<h3 id=\"%EF%BC%885%EF%BC%89%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93\">（5）登录数据库</h3>\n<pre><code>show databases;\n和原来数据库内容一样\n</code></pre>\n<h3 id=\"%E2%80%8B%23%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83%E6%96%B9%E6%B3%95\">​#创建用户并授权方法</h3>\n<p>mysql&gt; grant all on *.* to admin@'192.168.157.%' identified by 'Admin@123';<br/> Query OK, 0 rows affected, 1 warning (0.00 sec)</p>\n<h2 id=\"2%E3%80%81%E5%BF%AB%E7%85%A7%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93\">2、快照备份数据库</h2>\n<h3 id=\"%EF%BC%881%EF%BC%89%E9%94%81%E8%A1%A8%EF%BC%88%E8%AF%BB%E9%94%81%EF%BC%89\">(1)锁表（读锁）</h3>\n<pre><code>mysql&gt; flush table with read lock;\nQuery OK, 0 rows affected (0.00 sec)</code></pre>\n<h3 id=\"%EF%BC%882%EF%BC%89%E9%80%BB%E8%BE%91%E5%8D%B7%E5%88%9B%E5%BB%BA%E5%BF%AB%E7%85%A7\">(2)逻辑卷创建快照</h3>\n<pre><code>[root@host1 ~]# lvcreate -n lv_mysql_s -L 500M -s /dev/vg1/lv_mysql\n  Logical volume \"lv_mysql_s\" created.</code></pre>\n<pre><code>[root@host1 ~]# lvs\n  LV         VG     Attr       LSize   Pool Origin   Data%  Meta%  Move Log Cpy%Sync Convert\n  root       centos -wi-ao---- &lt;17.00g                                                      \n  swap       centos -wi-ao----   2.00g                                                      \n  lv_mysql   vg1    owi-aos---   4.00g                                                      \n  lv_mysql_s vg1    swi-a-s--- 500.00m      lv_mysql 0.00  </code></pre>\n<h3 id=\"%EF%BC%883%EF%BC%89%E8%A7%A3%E9%94%81\">(3)解锁</h3>\n<pre><code>​​​​​​​mysql&gt; unlock tables;\nQuery OK, 0 rows affected (0.00 sec)</code></pre>\n<h3 id=\"%EF%BC%884%EF%BC%89%E6%8C%82%E8%BD%BD\">(4)挂载</h3>\n<pre><code>[root@host1 ~]# mkdir /mnt/mysql -p\n[root@host1 ~]# mount -o nouuid /dev/vg1/lv_mysql_s /mnt/mysql</code></pre>\n<h3 id=\"%C2%A0%20%C2%A0%20%C2%A0%20%23%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89rsync%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E5%AE%89%E8%A3%85%EF%BC%88yum%20install%20rsync%20-y%EF%BC%89\">      #如果没有rsync需要进行安装（yum install rsync -y）</h3>\n<h3 id=\"%EF%BC%885%EF%BC%89%E5%A4%87%E4%BB%BD\">(5)备份</h3>\n<pre><code>[root@host1 mnt]# rsync -av /mnt/mysql/ /mysql_back/</code></pre>\n<p><img alt=\"\" height=\"217\" src=\"image\\711c77abb03f498983bb41d291f1ccdb.png\" width=\"1200\"/></p>\n<h3 id=\"%C2%A0%EF%BC%886%EF%BC%89%E6%AD%A4%E6%97%B6%E5%85%B3%E6%8E%89mysql%20%E9%85%8D%E7%BD%AE%2Fetc%2Fmy.cnf\">(6)此时关掉mysql 配置/etc/my.cnf</h3>\n<p><img alt=\"\" height=\"782\" src=\"image\\a9edca204fbf4d1bb074498fd47c0829.png\" width=\"1200\"/></p>\n<h3 id=\"%C2%A0%EF%BC%887%EF%BC%89%E6%8E%A5%E7%9D%80%E5%90%AF%E5%8A%A8mysql%E5%B9%B6%E7%99%BB%E5%BD%95%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%92%8C%E5%BC%80%E5%A7%8B%E4%B8%80%E6%A0%B7\">(7)接着启动mysql并登录可以看到数据库表和开始一样</h3>\n<p><img alt=\"\" height=\"517\" src=\"image\\331d6d2a118045c5bbbc00e460665db0.png\" width=\"366\"/></p>\n<h3 id=\"%EF%BC%888%EF%BC%89%E5%8D%B8%E8%BD%BD%E5%BF%AB%E7%85%A7%E5%B9%B6%E5%88%A0%E9%99%A4\">(8)卸载快照并删除</h3>\n<p>[root@host1 ~]# umount /mnt/mysql/ &amp;&amp; lvremove /dev/vg01/lv_mysql_s</p>\n<h3 id=\"%23%E8%84%9A%E6%9C%AC%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%EF%BC%881%EF%BC%89-%EF%BC%888%EF%BC%89%E6%93%8D%E4%BD%9C\">#脚本方式进行（1）-（8）操作</h3>\n<p>cd /mysql/scripts</p>\n<p>[root@host1 scripts]# vim my.sh</p>\n<pre><code>#!/bin/bash\nback_dir=/backup/`date +%F`\n[ -d $back_dir ]|| mkdir -p $back_dir\necho \"flush tables with read lock; system lvcreate -n lv_mysql_s -L 500M -s /dev/vg1/lv_mysql;unlock tables;\" |mysql -uroot -pMySQL@123 &amp;&gt;/dev/null\n[ -d /mnt/mysql/ ] || mkdir -p /mnt/mysql/\nmount -o nouuid /dev/vg1/lv_mysql_s /mnt/mysql/\nrsync -a /mnt/mysql/ $back_dir\nif [ $? -eq 0 ];then\n       umount /mnt/mysql/ &amp;&amp; lvremove -f /dev/vg01/lv_mysql_s &amp;&gt;/dev/null\nfi</code></pre>\n<p>执行脚本</p>\n<p>[root@host1 scripts]# sh my.sh</p>\n<p><img alt=\"\" height=\"123\" src=\"image\\0a16c67296e5420ca7325a4fca753faf.png\" width=\"731\"/></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n</div>\n</div>"}