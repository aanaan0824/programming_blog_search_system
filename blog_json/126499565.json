{"blogid": "126499565", "writerAge": "ç é¾„2å¹´", "writerBlogNum": "153", "writerCollect": "2306", "writerComment": "921", "writerFan": "9381", "writerGrade": "5çº§", "writerIntegral": "4268", "writerName": "å‰ç«¯è€å®äºº", "writerProfileAdress": "writer_image\\profile_126499565.jpg", "writerRankTotal": "4179", "writerRankWeekly": "2008", "writerThumb": "1695", "writerVisitNum": "326490", "blog_read_count": "1737", "blog_time": "äºÂ 2022-08-24 16:34:04Â å‘å¸ƒ", "blog_title": "Vueå®ç°ç™»å½•åŠŸèƒ½å…¨å¥—è¯¦è§£ï¼ˆå«å°è£…axiosï¼‰", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p id=\"main-toc\"><strong>ç›®å½•</strong></p>\n<p id=\"Vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E5%A4%A7%E8%87%B4%E6%80%9D%E8%B7%AF%EF%BC%9A-toc\" style=\"margin-left:0px;\"><a href=\"#Vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E5%A4%A7%E8%87%B4%E6%80%9D%E8%B7%AF%EF%BC%9A\">Vueé¡¹ç›®ä¸­å®ç°ç™»å½•å¤§è‡´æ€è·¯ï¼š</a></p>\n<p id=\"%E7%94%A8%E5%88%B0%E7%9A%84%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6-toc\" style=\"margin-left:80px;\"><a href=\"#%E7%94%A8%E5%88%B0%E7%9A%84%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6\">ç”¨åˆ°çš„å…³é”®æ–‡ä»¶</a></p>\n<p id=\"%C2%A0%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6-toc\" style=\"margin-left:0px;\"><a href=\"#%C2%A0%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6\"> ä¸€ã€å®‰è£…æ’ä»¶</a></p>\n<p id=\"%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAstore%C2%A0-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAstore%C2%A0\">äºŒã€åˆ›å»ºstore </a></p>\n<p id=\"%E4%B8%89%E3%80%81%E5%B0%81%E8%A3%85axios-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%89%E3%80%81%E5%B0%81%E8%A3%85axios\">ä¸‰ã€å°è£…axios</a></p>\n<p id=\"qs%20vue%20%E6%8F%92%E4%BB%B6-toc\" style=\"margin-left:80px;\"><a href=\"#qs%20vue%20%E6%8F%92%E4%BB%B6\">qs vue æ’ä»¶</a></p>\n<p id=\"api.js%E7%9A%84%E4%BD%9C%E7%94%A8%C2%A0-toc\" style=\"margin-left:40px;\"><a href=\"#api.js%E7%9A%84%E4%BD%9C%E7%94%A8%C2%A0\">api.jsçš„ä½œç”¨ </a></p>\n<p id=\"%E5%9B%9B%E3%80%81%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%9B%9B%E3%80%81%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA\">å››ã€è·¯ç”±æ‹¦æˆª</a></p>\n<p id=\"%E4%BA%94%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%94%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8\">äº”ã€ç™»å½•é¡µé¢å®é™…ä½¿ç”¨</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<h1>Vueé¡¹ç›®ä¸­å®ç°ç™»å½•å¤§è‡´æ€è·¯ï¼š</h1>\n<p>1ã€ç¬¬ä¸€æ¬¡ç™»å½•çš„æ—¶å€™ï¼Œå‰ç«¯è°ƒåç«¯çš„ç™»é™†æ¥å£ï¼Œå‘é€ç”¨æˆ·åå’Œå¯†ç </p>\n<p>2ã€åç«¯æ”¶åˆ°è¯·æ±‚ï¼ŒéªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼ŒéªŒè¯æˆåŠŸï¼Œå°±ç»™å‰ç«¯è¿”å›ä¸€ä¸ªtoken</p>\n<p>3ã€å‰ç«¯æ‹¿åˆ°tokenï¼Œå°†tokenå­˜å‚¨åˆ°localStorageå’Œvuexä¸­ï¼Œå¹¶è·³è½¬è·¯ç”±é¡µé¢</p>\n<p>4ã€å‰ç«¯æ¯æ¬¡è·³è½¬è·¯ç”±ï¼Œå°±åˆ¤æ–­ localStroage ä¸­æœ‰æ—  token ï¼Œæ²¡æœ‰å°±è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œæœ‰åˆ™è·³è½¬åˆ°å¯¹åº”è·¯ç”±é¡µé¢</p>\n<p>5ã€æ¯æ¬¡è°ƒåç«¯æ¥å£ï¼Œéƒ½è¦åœ¨è¯·æ±‚å¤´ä¸­åŠ token</p>\n<p>6ã€åç«¯åˆ¤æ–­è¯·æ±‚å¤´ä¸­æœ‰æ— tokenï¼Œæœ‰tokenï¼Œå°±æ‹¿åˆ°tokenå¹¶éªŒè¯tokenï¼ŒéªŒè¯æˆåŠŸå°±è¿”å›æ•°æ®ï¼ŒéªŒè¯å¤±è´¥ï¼ˆä¾‹å¦‚ï¼štokenè¿‡æœŸï¼‰å°±è¿”å›401ï¼Œè¯·æ±‚å¤´ä¸­æ²¡æœ‰tokenä¹Ÿè¿”å›401</p>\n<p>7ã€å¦‚æœå‰ç«¯æ‹¿åˆ°çŠ¶æ€ç ä¸º401ï¼Œå°±æ¸…é™¤tokenä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢</p>\n<h3 id=\"%E7%94%A8%E5%88%B0%E7%9A%84%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6\">ç”¨åˆ°çš„å…³é”®æ–‡ä»¶</h3>\n<p><img alt=\"\" height=\"232\" src=\"image\\81aef141836d4f8294e7db3e12260b5b.png\" width=\"321\"/></p>\n<h1 id=\"%C2%A0%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6\"> ä¸€ã€å®‰è£…æ’ä»¶</h1>\n<pre><code>npm install axios; // å®‰è£…axios\nnpm install vuex  // å®‰è£…vuex</code></pre>\n<p>è¡¥å……ï¼š </p>\n<ul><li>åˆ›å»ºstoreæ˜¯å¿…é¡»çš„ï¼</li><li>tokenä¸€å®šè¦å­˜åœ¨storageç¼“å­˜ä¸­ï¼Œå¦åˆ™åˆ·æ–°ä¸€ä¸‹ï¼Œstoreä¼šé‡æ–°è¢«åŠ è½½ï¼Œtokenå°±æ²¡äº†ï¼›</li><li>é‚£å­˜åœ¨storeæ˜¯ä¸æ˜¯å¤šä½™äº†ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸ºäº†æ•°æ®ç»Ÿä¸€ç®¡ç†å§ï¼Œä¹Ÿæ˜¯æ•°æ®å¯è§†åŒ–ï¼Œå› ä¸ºç¼“å­˜ä¸­çš„æ•°æ®ä»£ç ä¸­æ˜¯çœ‹ä¸è§çš„ã€‚ï¼ˆä¸ºäº†ä»£ç æ›´å®¹æ˜“è®©åˆ«äººç†è§£æ‰€ä»¥åŠ ä¸Švuexï¼Œä¸åŠ ä¹Ÿä¸å½±å“åšç™»å½•ï¼‰</li></ul>\n<h1 id=\"%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAstore%C2%A0\">äºŒã€åˆ›å»ºstore </h1>\n<pre><code class=\"language-javascript\">\nimport Vue from 'vue'\nimport Vuex from 'vuex'\nVue.use(Vuex);\n// ç”¨Vuex.Storeå¯¹è±¡ç”¨æ¥è®°å½•token\nconst store = new Vuex.Store({\n\n  state: {\n    // å­˜å‚¨token\n    token:\"\",\n    userName:\"\" // å¯é€‰\n  },\n  getters: {\n\tgetToken(state){\n\t\treturn state.token || localStorage.getItem(\"token\") || \"\";\n\t}\n  },\n  mutations: {\n    // ä¿®æ”¹tokenï¼Œå¹¶å°†tokenå­˜å…¥localStorage\n    setToken(state,token) {\n      state.token = token;\n      localStorage.setItem('token', token);\n      console.log('storeã€localstorageä¿å­˜tokenæˆåŠŸï¼');\n    },\n    delToken(state) {\n      state.token = \"\";\n      localStorage.removeItem(\"token\");\n    },\n    // å¯é€‰\n    setUserInfo(state, userName) {\n      state.userName = userName;\n    }\n  },\n\n actions: {\n   // removeToken: (context) =&gt; {\n     // context.commit('setToken')\n   // }\n },\n});\n  \nexport default store;\n</code></pre>\n<p>å¼•ç”¨åˆ°main.js</p>\n<pre><code class=\"language-javascript\">import store from './store'\nnew Vue({\n  router,\n  store,\n  render: h =&gt; h(App),\n}).$mount('#app')\n</code></pre>\n<p></p>\n<h1 id=\"%E4%B8%89%E3%80%81%E5%B0%81%E8%A3%85axios\">ä¸‰ã€å°è£…axios</h1>\n<p>request.jsæ–‡ä»¶ç”¨æ¥å°è£…æˆ‘ä»¬çš„axios</p>\n<h3 id=\"qs%20vue%20%E6%8F%92%E4%BB%B6\">qs vue æ’ä»¶</h3>\n<p>é‡Œé¢æœ‰ç”¨åˆ°qsï¼Œè¿™é‡Œæˆ‘é—¨è®²è§£ä¸‹ä»–çš„ä½œç”¨ï¼š</p>\n<p>getæ–¹æ³•ï¼šæˆ‘ä»¬é€šè¿‡å®šä¹‰ä¸€ä¸ªgetå‡½æ•°ï¼Œgetå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæˆ‘ä»¬è¦è¯·æ±‚çš„urlåœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦æºå¸¦çš„è¯·æ±‚å‚æ•°ã€‚getå‡½æ•°è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå½“axioså…¶è¯·æ±‚æˆåŠŸæ—¶resolveæœåŠ¡å™¨è¿”å› å€¼ï¼Œè¯·æ±‚å¤±è´¥æ—¶rejecté”™è¯¯å€¼ã€‚æœ€åé€šè¿‡exportæŠ›å‡ºgetå‡½æ•°ã€‚</p>\n<p>postæ–¹æ³•ï¼šåŸç†åŒgetåŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œpostæ–¹æ³•å¿…é¡»è¦ä½¿ç”¨å¯¹æäº¤ä»å‚æ•°å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–çš„æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€šè¿‡nodeçš„qsæ¨¡å—æ¥åºåˆ—åŒ–æˆ‘ä»¬çš„å‚æ•°ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œå¦‚æœæ²¡æœ‰åºåˆ—åŒ–æ“ä½œï¼Œåå°æ˜¯æ‹¿ä¸åˆ°ä½ æäº¤çš„æ•°æ®çš„ã€‚è¿™å°±æ˜¯æ–‡ç« å¼€å¤´æˆ‘ä»¬import QS from â€˜qsâ€™;çš„åŸå› ã€‚</p>\n<p>ç®€å•æ¥è¯´ï¼Œqs æ˜¯ä¸€ä¸ªå¢åŠ äº†ä¸€äº›å®‰å…¨æ€§çš„æŸ¥è¯¢å­—ç¬¦ä¸²è§£æå’Œåºåˆ—åŒ–å­—ç¬¦ä¸²çš„åº“ã€‚</p>\n<p>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·è¾“å…¥ï¼šnpm install qs<br/> å®‰è£…å®Œæˆååœ¨éœ€è¦ç”¨åˆ°çš„ç»„ä»¶ä¸­ï¼šimport qs from 'qsâ€™<br/> å…·ä½“ä½¿ç”¨ä¸­æˆ‘æŸ¥çœ‹äº†ï¼šqs.parse()å’Œqs.stringify()</p>\n<p>è¿™ä¸¤ç§æ–¹æ³•è™½ç„¶éƒ½æ˜¯åºåˆ—åŒ–ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚<br/> qs.parse()æ˜¯å°†URLè§£ææˆå¯¹è±¡çš„å½¢å¼<br/> qs.stringify()æ˜¯å°†å¯¹è±¡ åºåˆ—åŒ–æˆURLçš„å½¢å¼ï¼Œä»¥&amp;è¿›è¡Œæ‹¼æ¥</p>\n<pre><code class=\"language-javascript\">// å°è£…axios\nimport axios from 'axios'\n// åºåˆ—åŒ–\nimport QS from 'qs';\n// vuex\nimport store from '../store/index'\n\n//è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯åˆ¤æ–­å‡ºå½“å‰æ˜¯å¼€å‘ç¯å¢ƒè¿˜æ˜¯ç”Ÿæˆç¯å¢ƒï¼Œæ–¹æ³•ä¸æ­¢ä¸€ç§ï¼Œè¾¾åˆ°ç›®çš„å°±è¡Œ\n// if(process.env.NODE_ENV==\"development\"){\n//   baseURL=''\n// }else{\n//   baseURL=''\n// }\n\n// ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶å‘é€è¯·æ±‚\nconst instance = axios.create({\n    baseURL: '',\n    timeout: 80000,\n    headers: {\n        // 'Content-Type': 'application/json;charset=UTF-8',\n        // 'custome-header':'tianliangjiaoyu'\n    }\n});\n// postè¯·æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸Šä¸€ä¸ªè¯·æ±‚å¤´ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€ä¸ªé»˜è®¤çš„è®¾ç½®ï¼Œå³è®¾ç½®postçš„è¯·æ±‚å¤´ä¸º\naxios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=UTF-8';\n// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨\ninstance.interceptors.request.use(function (config) {\n    // æ¯æ¬¡å‘é€è¯·æ±‚ä¹‹å‰åˆ¤æ–­vuexä¸­æ˜¯å¦å­˜åœ¨token        \n    // å¦‚æœå­˜åœ¨ï¼Œåˆ™ç»Ÿä¸€åœ¨httpè¯·æ±‚çš„headeréƒ½åŠ ä¸Štokenï¼Œè¿™æ ·åå°æ ¹æ®tokenåˆ¤æ–­ä½ çš„ç™»å½•æƒ…å†µ\n    // å³ä½¿æœ¬åœ°å­˜åœ¨tokenï¼Œä¹Ÿæœ‰å¯èƒ½tokenæ˜¯è¿‡æœŸçš„ï¼Œæ‰€ä»¥åœ¨å“åº”æ‹¦æˆªå™¨ä¸­è¦å¯¹è¿”å›çŠ¶æ€è¿›è¡Œåˆ¤æ–­ \n    const token = store.getters.getToken;\n    if (token) {\n        // å·²ç»ç™»å½•æˆåŠŸï¼Œç»Ÿä¸€æ·»åŠ token\n        config.headers.Authorization = `Bearer ${token}`\n    }\n    // token &amp;&amp; (config.headers.Authorization = token);\n    return config;\n}, function (error) {\n    // å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ\n    return Promise.reject(error);\n});\n\n// è¿™é‡Œè¯´ä¸€ä¸‹tokenï¼Œä¸€èˆ¬æ˜¯åœ¨ç™»å½•å®Œæˆä¹‹åï¼Œå°†ç”¨æˆ·çš„tokené€šè¿‡localStorageæˆ–è€…cookieå­˜åœ¨æœ¬åœ°ï¼Œ\n// ç„¶åç”¨æˆ·æ¯æ¬¡åœ¨è¿›å…¥é¡µé¢çš„æ—¶å€™ï¼ˆå³åœ¨main.jsä¸­ï¼‰ï¼Œä¼šé¦–å…ˆä»æœ¬åœ°å­˜å‚¨ä¸­è¯»å–tokenï¼Œå¦‚æœtokenå­˜åœ¨è¯´æ˜ç”¨æˆ·å·²ç»ç™»é™†è¿‡ï¼Œ\n// åˆ™æ›´æ–°vuexä¸­çš„tokençŠ¶æ€ã€‚ç„¶åï¼Œåœ¨æ¯æ¬¡è¯·æ±‚æ¥å£çš„æ—¶å€™ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚çš„headerä¸­æºå¸¦tokenï¼Œ\n// åå°äººå‘˜å°±å¯ä»¥æ ¹æ®ä½ æºå¸¦çš„tokenæ¥åˆ¤æ–­ä½ çš„ç™»å½•æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ²¡æœ‰æºå¸¦ï¼Œåˆ™è¯´æ˜æ²¡æœ‰ç™»å½•è¿‡ã€‚\n// æ·»åŠ å“åº”æ‹¦æˆªå™¨\ninstance.interceptors.response.use(function (response) {\n    if (response.status === 200) {\n        return Promise.resolve(response);\n    } else {\n        return Promise.reject(response);\n    }\n}, function (error) {\n    // å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ\n    if (error.response.status) {\n        switch (error.response.status) {\n            // 401: æœªç™»å½•\n            // æœªç™»å½•åˆ™è·³è½¬ç™»å½•é¡µé¢ï¼Œå¹¶æºå¸¦å½“å‰é¡µé¢çš„è·¯å¾„\n            // åœ¨ç™»å½•æˆåŠŸåè¿”å›å½“å‰é¡µé¢ï¼Œè¿™ä¸€æ­¥éœ€è¦åœ¨ç™»å½•é¡µæ“ä½œã€‚                \n            case 401:\n                router.replace({\n                    path: '/login',\n                    query: {\n                        redirect: router.currentRoute.fullPath\n                    }\n                });\n                break;\n            // 403 tokenè¿‡æœŸ\n            // ç™»å½•è¿‡æœŸå¯¹ç”¨æˆ·è¿›è¡Œæç¤º\n            // æ¸…é™¤æœ¬åœ°tokenå’Œæ¸…ç©ºvuexä¸­tokenå¯¹è±¡\n            // è·³è½¬ç™»å½•é¡µé¢                \n            case 403:\n                this.$message({\n                    message: 'ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',\n                    duration: 1000,\n                    type: 'success'\n                });\n                // æ¸…é™¤token\n                localStorage.removeItem('token');\n                store.commit('loginSuccess', null);\n                // è·³è½¬ç™»å½•é¡µé¢ï¼Œå¹¶å°†è¦æµè§ˆçš„é¡µé¢fullPathä¼ è¿‡å»ï¼Œç™»å½•æˆåŠŸåè·³è½¬éœ€è¦è®¿é—®çš„é¡µé¢ \n                setTimeout(() =&gt; {\n                    router.replace({\n                        path: '/login',\n                        query: {\n                            redirect: router.currentRoute.fullPath\n                        }\n                    });\n                }, 1000);\n                break;\n\n            // 404è¯·æ±‚ä¸å­˜åœ¨\n            case 404:\n                this.$message({\n                    message: 'ç½‘ç»œè¯·æ±‚ä¸å­˜åœ¨',\n                    duration: 1500,\n                    type: 'success'\n\n                });\n                break;\n            // å…¶ä»–é”™è¯¯ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯æç¤º\n            default:\n                this.$message({\n                    message: error.response.data.message,\n                    duration: 1500,\n                    type: 'success'\n\n                });\n        }\n        return Promise.reject(error.response);\n    }\n});\n\n/** \n * getæ–¹æ³•ï¼Œå¯¹åº”getè¯·æ±‚ \n * @param {String} url [è¯·æ±‚çš„urlåœ°å€] \n * @param {Object} params [è¯·æ±‚æ—¶æºå¸¦çš„å‚æ•°] \n */\nexport function get(url, params) {\n    return new Promise((resolve, reject) =&gt; {\n        instance.get(url, {\n            params: params\n        })\n            .then(res =&gt; {\n                resolve(res.data);\n            })\n            .catch(err =&gt; {\n                reject(err.data)\n            })\n    });\n}\n/** \n * postæ–¹æ³•ï¼Œå¯¹åº”postè¯·æ±‚ \n * @param {String} url [è¯·æ±‚çš„urlåœ°å€] \n * @param {Object} params [è¯·æ±‚æ—¶æºå¸¦çš„å‚æ•°] \n */\nexport function post(url, params, headers) {\n    return new Promise((resolve, reject) =&gt; {\n        instance.post(url, QS.stringify(params), headers)\n            .then(res =&gt; {\n                resolve(res.data);\n            })\n            .catch(err =&gt; {\n                reject(err.data)\n            })\n    });\n}\n\n</code></pre>\n<p>è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢çš„this.$messageæ–¹æ³•ï¼Œæ˜¯æˆ‘å¼•å…¥çš„elementåº“ä¸­çš„è½»æç¤ºç»„ä»¶ï¼Œä½ æ ¹æ®ä½ çš„uiåº“ï¼Œå¯¹åº”ä½¿ç”¨ä½ çš„ä¸€ä¸ªæç¤ºç»„ä»¶ã€‚ </p>\n<p>è¿™é‡Œè¯´ä¸€ä¸‹tokenï¼Œä¸€èˆ¬æ˜¯åœ¨ç™»å½•å®Œæˆä¹‹åï¼Œå°†ç”¨æˆ·çš„tokené€šè¿‡localStorageæˆ–è€…cookieå­˜åœ¨æœ¬åœ°ï¼Œç„¶åç”¨æˆ·æ¯æ¬¡åœ¨è¿›å…¥é¡µé¢çš„æ—¶å€™ï¼ˆå³åœ¨main.jsä¸­ï¼‰ï¼Œä¼šé¦–å…ˆä»æœ¬åœ°å­˜å‚¨ä¸­è¯»å–tokenï¼Œå¦‚æœtokenå­˜åœ¨è¯´æ˜ç”¨æˆ·å·²ç»ç™»é™†è¿‡ï¼Œåˆ™æ›´æ–°vuexä¸­çš„tokençŠ¶æ€ã€‚ç„¶åï¼Œåœ¨æ¯æ¬¡è¯·æ±‚æ¥å£çš„æ—¶å€™ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚çš„headerä¸­æºå¸¦tokenï¼Œåå°äººå‘˜å°±å¯ä»¥æ ¹æ®ä½ æºå¸¦çš„tokenæ¥åˆ¤æ–­ä½ çš„ç™»å½•æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ²¡æœ‰æºå¸¦ï¼Œåˆ™è¯´æ˜æ²¡æœ‰ç™»å½•è¿‡ã€‚</p>\n<blockquote>\n<p>axios.get()æ–¹æ³•å’Œaxios.post()åœ¨æäº¤æ•°æ®æ—¶å‚æ•°çš„ä¹¦å†™æ–¹å¼è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚åŒºåˆ«å°±æ˜¯ï¼Œgetçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª{}ï¼Œç„¶åè¿™ä¸ªå¯¹è±¡çš„paramså±æ€§å€¼æ˜¯ä¸€ä¸ªå‚æ•°å¯¹è±¡çš„ã€‚è€Œpostçš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªå‚æ•°å¯¹è±¡ã€‚ä¸¤è€…ç•¥å¾®çš„åŒºåˆ«è¦ç•™æ„å“¦ï¼</p>\n</blockquote>\n<h2 id=\"api.js%E7%9A%84%E4%BD%9C%E7%94%A8%C2%A0\">api.jsçš„ä½œç”¨ </h2>\n<p><strong>è¿™é‡Œæˆ‘ä»¬è¡¥å……ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</strong></p>\n<p>apiæ–‡ä»¶çš„ä½œç”¨å°±æ˜¯æ¥å£ç»Ÿä¸€ç®¡ç†</p>\n<p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªpostLoginæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°pï¼Œpæ˜¯æˆ‘ä»¬è¯·æ±‚æ¥å£æ—¶æºå¸¦çš„å‚æ•°å¯¹è±¡ã€‚è€Œåè°ƒç”¨äº†æˆ‘ä»¬å°è£…çš„postæ–¹æ³•ï¼Œpostæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬çš„æ¥å£åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯postLoginçš„på‚æ•°ï¼Œå³è¯·æ±‚æ¥å£æ—¶æºå¸¦çš„å‚æ•°å¯¹è±¡ã€‚æœ€åé€šè¿‡exportç»Ÿä¸€å¯¼å‡ºapiFunå¯¹è±¡</p>\n<pre><code class=\"language-javascript\">import {get,post} from './request'\n\nlet apiFun = null;\napiFun.postLogin = p =&gt; post('api/v1/users/my_address/address_edit_before', p)\nexport default apiFun;\n</code></pre>\n<p>ç„¶ååœ¨æˆ‘ä»¬çš„mian.jsæ–‡ä»¶ä¸­å®šä¹‰æˆå…¨å±€å˜é‡ï¼Œæ–¹ä¾¿è°ƒç”¨</p>\n<pre><code class=\"language-javascript\">import apiFun from \"./network/api\";\n\nVue.prototype.$apiFun = apiFun;//è¯·æ±‚æ¥å£api</code></pre>\n<p>ç„¶ååœ¨æˆ‘ä»¬çš„é¡µé¢ä¸­å¯ä»¥è¿™æ ·è°ƒç”¨æˆ‘ä»¬çš„apiæ¥å£ï¼š</p>\n<pre><code class=\"language-javascript\">// è°ƒç”¨apiæ¥å£ï¼Œå¹¶ä¸”æä¾›äº†ä¸¤ä¸ªå‚æ•°                \n           this.$apiFun.postLogin({                    \n                type: 0,                    \n                sort: 1                \n            }).then(res =&gt; {\n                // è·å–æ•°æ®æˆåŠŸåçš„å…¶ä»–æ“ä½œ\n                â€¦â€¦â€¦â€¦â€¦â€¦                \n            })  </code></pre>\n<p>apiæ¥å£ç®¡ç†çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œæˆ‘ä»¬æŠŠapiç»Ÿä¸€é›†ä¸­èµ·æ¥ï¼Œå¦‚æœåæœŸéœ€è¦ä¿®æ”¹æ¥å£ï¼Œæˆ‘ä»¬å°±ç›´æ¥åœ¨api.jsä¸­æ‰¾åˆ°å¯¹åº”çš„ä¿®æ”¹å°±å¥½äº†ï¼Œè€Œä¸ç”¨å»æ¯ä¸€ä¸ªé¡µé¢æŸ¥æ‰¾æˆ‘ä»¬çš„æ¥å£ç„¶åå†ä¿®æ”¹ä¼šå¾ˆéº»çƒ¦.</p>\n<h1 id=\"%E5%9B%9B%E3%80%81%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA\">å››ã€è·¯ç”±æ‹¦æˆª</h1>\n<pre><code class=\"language-javascript\">import Vue from \"vue\"\nimport Router from \"vue-router\"\nimport Home from '../views/Home.vue'\nimport store from '../store/index'\n\nVue.use(Router)\nlet routes = [\n\n    {\n        path: '/',\n        name: 'Home',\n        component: Home,\n        // é‡å®šå‘\n        redirect: '/publiccloud',\n        children: [\n            {\n                path: '/publiccloud',\n                name: 'å…¬æœ‰äº‘ç”¨æˆ·ç®¡ç†',\n                component: () =&gt; import('../views/publicCloud/PublicCloud.vue')\n            },\n            {\n                path: '/admin',\n                name: 'ç®¡ç†å‘˜ç®¡ç†',\n                component: () =&gt; import('../views/admin/Admin.vue')\n            }\n        ]\n    },\n    // ç™»é™†é¡µé¢\n    {\n        path: \"/Login\",\n        name: \"ç™»å½•é¡µé¢\",\n        component: () =&gt; import('../views/login/Login.vue')\n    },\n];\n\nlet router = new Router({\n    routes,\n    mode: 'history',\n    // å…¨å±€é…ç½®æ¿€æ´»è·¯ç”±çš„classç±»åï¼Œå¤„ä¸æ´»è·ƒï¼ˆåŠ¨æ€ï¼‰å°±ä¼šç”¨ä¸Šè¿™ä¸ªç±»å\n    linkActiveClass: 'active'\n})\n\n\n// è®¾ç½®è·¯ç”±å®ˆå«ï¼Œåœ¨è¿›é¡µé¢ä¹‹å‰ï¼Œåˆ¤æ–­æœ‰tokenï¼Œæ‰è¿›å…¥é¡µé¢ï¼Œå¦åˆ™è¿”å›ç™»å½•é¡µé¢\nif (storage.get(\"token\")) {\n    store.commit(\"setToken\", localStorage.getItem(\"token\"));\n  }\nrouter.beforeEach((to, from, next) =&gt; {\n    // è®¾ç½®è·¯ç”±å®ˆå«ï¼Œåœ¨è¿›é¡µé¢ä¹‹å‰ï¼Œåˆ¤æ–­æœ‰tokenï¼Œæ‰è¿›å…¥é¡µé¢\n        if (token) {\n            next('/')\n        } else {\n            // æ²¡æœ‰tokenå°±è°ƒç”¨åç«¯æ¥å£ï¼Œè·³è½¬åœ°å€\n            getAddress().then((res) =&gt; {\n              if (res.data.code === 200) {\n                location.href = res.data.data.redirectUri\n              }\n            })\n        }\n});\nexport default router</code></pre>\n<h1 id=\"%E4%BA%94%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8\">äº”ã€ç™»å½•é¡µé¢å®é™…ä½¿ç”¨</h1>\n<pre><code class=\"language-javascript\">\n\nsubmitForm(formName) {\n      this.$refs[formName].validate(valid =&gt; {\n        if (valid) {\n          let that = this;\n          // console.log('username',this.loginForm.username)\n          // é€šè¿‡æ ¡éªŒè§„åˆ™åè¿›å…¥æ ¡éªŒç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®\n          // æ²¡æœ‰åå°æ¥å£å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥æ¨¡æ‹Ÿï¼Œæ›¿æ¢postLogin\n          this.$apiFun.postLogin(this.loginForm.username, this.loginForm.password)\n            .then(res =&gt; {\n              console.log(res);\n              \n               that.$store.commit(\"setToken\", res.data.token);\n               that.$store.commit(\"setUserInfo\", res.data.account);\n\n              this.$notify({\n                title: \"ç™»å½•æˆåŠŸ\",\n                type: \"success\",\n                showClose: false,\n                duration: 1000\n              });\n              setTimeout(() =&gt; {\n                // æ­¤æ—¶è¦åˆ¤æ–­/loginåé¢çš„å‚æ•°redirectï¼Œè‹¥æ— å‚æ•°ï¼Œè¿›å…¥ä¸»é¡µï¼›\n                this.$router.push(\"/index\");\n                // è‹¥æœ‰å‚æ•°åˆ™å‚æ•°ä¸ºæœªæœ‰æƒé™çš„é‚£ä¸ªè·¯ç”±ï¼Œè·³è½¬åˆ°é‚£ä¸ªè·¯ç”±\n                // this.$router.push(***); -- å…·ä½“è¦è‡ªå·±åœ¨è¿™å®ç°\n              }, 1000);\n            })\n            .catch(error =&gt; {\n            // é”™è¯¯åˆ†ä¸º status-è¯·æ±‚é”™è¯¯ å’Œ code-è´¦å·å¯†ç é”™è¯¯\n              this.$message.error(error);\n              console.log(error);\n            });\n        } else {\n        // ä¸ç¬¦åˆå‰ç«¯æ ¡éªŒ\n          this.$message.error('format errorï¼š'+error);\n          console.log('format errorï¼š',error);\n          return false;\n        }\n      });\n    }\n</code></pre>\n<p>å¦‚æœå–œæ¬¢ï¼Œå°±ç»™ä¸ªâ¤å§</p>\n<p>æƒ³è®¤è¯†åšä¸»çš„è¯è¿™é‡Œå“¦ğŸ‘‡</p>\n</div>\n</div>"}