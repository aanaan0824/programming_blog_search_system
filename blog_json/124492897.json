{"blogid": "124492897", "writerAge": "码龄7年", "writerBlogNum": "291", "writerCollect": "1639", "writerComment": "132", "writerFan": "11027", "writerGrade": "6级", "writerIntegral": "4863", "writerName": "一个写湿的程序猿", "writerProfileAdress": "writer_image\\profile_124492897.jpg", "writerRankTotal": "9205", "writerRankWeekly": "4429", "writerThumb": "940", "writerVisitNum": "285858", "blog_read_count": "4604", "blog_time": "于 2022-04-29 14:01:49 发布", "blog_title": "MySQL出现You can‘t specify target table for update in FROM clause错误的解决方法", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>MySQL出现You can‘t specify target table for update in FROM clause错误的解决方法</h3>\n<ul><li><a href=\"#_2\">分析原因</a></li><li><a href=\"#_46\">解决方法</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"_2\"></a>分析原因</h1>\n<p>在MySQL中，可能会遇到<code>You can't specify target table '表名' for update in FROM clause</code>这样的错误</p>\n<p>它的意思是说，<font color=\"red\">不能在同一语句中，先select出同一表中的某些值，再update这个表</font>，即不能依据某字段值做判断再来更新某字段的值。</p>\n<p>这个问题在MySQL官网中有提到解决方案：<a href=\"https://dev.mysql.com/doc/refman/5.6/en/update.html\">MySQL-UPDATE- 拉到文档下面</a></p>\n<p>例如下面这张<code>t_message</code>表</p>\n<pre><code class=\"prism language-sql\"><span class=\"token operator\">+</span><span class=\"token comment\">----+-----+-----------+---------------------+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> uid <span class=\"token operator\">|</span> content   <span class=\"token operator\">|</span> addtime             <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-----+-----------+---------------------+</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span>   <span class=\"token number\">1</span> <span class=\"token operator\">|</span> content1  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">01</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span>   <span class=\"token number\">2</span> <span class=\"token operator\">|</span> content2  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">02</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">3</span> <span class=\"token operator\">|</span>   <span class=\"token number\">3</span> <span class=\"token operator\">|</span> content3  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">03</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">4</span> <span class=\"token operator\">|</span>   <span class=\"token number\">1</span> <span class=\"token operator\">|</span> content4  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">04</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">5</span> <span class=\"token operator\">|</span>   <span class=\"token number\">3</span> <span class=\"token operator\">|</span> content5  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">05</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">6</span> <span class=\"token operator\">|</span>   <span class=\"token number\">2</span> <span class=\"token operator\">|</span> content6  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">06</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">7</span> <span class=\"token operator\">|</span>   <span class=\"token number\">2</span> <span class=\"token operator\">|</span> content7  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">07</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">8</span> <span class=\"token operator\">|</span>   <span class=\"token number\">4</span> <span class=\"token operator\">|</span> content8  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">08</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">9</span> <span class=\"token operator\">|</span>   <span class=\"token number\">4</span> <span class=\"token operator\">|</span> content9  <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">09</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token number\">10</span> <span class=\"token operator\">|</span>   <span class=\"token number\">1</span> <span class=\"token operator\">|</span> content10 <span class=\"token operator\">|</span> <span class=\"token number\">2022</span><span class=\"token operator\">-</span><span class=\"token number\">04</span><span class=\"token operator\">-</span><span class=\"token number\">26</span> <span class=\"token number\">00</span>:<span class=\"token number\">00</span>:<span class=\"token number\">10</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-----+-----------+---------------------+</span>\n</code></pre>\n<p>我想将每个用户第一条消息的内容更新为<code>Hello World</code></p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">UPDATE</span> t_message \n<span class=\"token keyword\">SET</span> content <span class=\"token operator\">=</span> <span class=\"token string\">'Hello World'</span> \n<span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span> \n\t\t\t <span class=\"token keyword\">SELECT</span> <span class=\"token function\">min</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> t_message <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> uid \n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>会出现下面错误：</p>\n<pre><code class=\"prism language-sql\">ERROR <span class=\"token number\">1093</span>: You can<span class=\"token string\">'t specify target table '</span>t_message' <span class=\"token keyword\">for</span> <span class=\"token keyword\">update</span> <span class=\"token operator\">in</span> <span class=\"token keyword\">FROM</span> clause\n</code></pre>\n<p>因为在同一个sql语句中，先<code>select</code>出<code>t_message</code>表中每个用户消息的最小<code>id</code>值，然后再更新<code>t_message</code>表，因此会出现 <code>ERROR 1093 : You can’t specify target table ‘message’ for update in FROM clause</code> 这个错误。</p>\n<h1><a id=\"_46\"></a>解决方法</h1>\n<p>解决方法：<font color=\"green\"><code>select</code> 的结果再通过一个中间表 <code>select</code> 多一次，就可以避免这个错误</font></p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">UPDATE</span> message \n<span class=\"token keyword\">SET</span> content <span class=\"token operator\">=</span> <span class=\"token string\">'Hello World'</span> \n<span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">IN</span> <span class=\"token punctuation\">(</span> \n\t\t\t<span class=\"token keyword\">SELECT</span> min_id <span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span> \n\t\t\t\t  <span class=\"token keyword\">SELECT</span> <span class=\"token function\">min</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> min_id <span class=\"token keyword\">FROM</span> t_message <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> uid \n\t\t\t\t\t\t\t\t<span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> a \n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}