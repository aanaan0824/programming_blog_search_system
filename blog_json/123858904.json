{"blogid": "123858904", "writerAge": "码龄1年", "writerBlogNum": "14", "writerCollect": "250", "writerComment": "2", "writerFan": "1044", "writerGrade": "2级", "writerIntegral": "230", "writerName": "热爱画家夫人", "writerProfileAdress": "writer_image\\profile_123858904.jpg", "writerRankTotal": "74480", "writerRankWeekly": "6554", "writerThumb": "75", "writerVisitNum": "25096", "blog_read_count": "9795", "blog_time": "已于 2022-03-30 23:51:19 修改", "blog_title": "php一句话木马", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>测试靶场 pikachu-master</p>\n<p><img alt=\"\" height=\"779\" src=\"image\\23edadd570bd404e9bd61a9f15aca9a3.png\" width=\"1200\"/></p>\n<p>pikachu漏洞平台文件上传漏洞概述</p>\n<p><img alt=\"\" height=\"779\" src=\"image\\962f8ced606c40a18bbca8d67fdb412f.png\" width=\"1200\"/></p>\n<p> 即将进行利用的文件上传漏洞界面</p>\n<pre><code class=\"language-php\">$SELF_PAGE = substr($_SERVER['PHP_SELF'],strrpos($_SERVER['PHP_SELF'],'/')+1);\n\nif ($SELF_PAGE = \"clientcheck.php\"){\n    $ACTIVE = array('','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','active open','','','','active','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','');\n}\n$PIKA_ROOT_DIR =  \"../../\";\ninclude_once $PIKA_ROOT_DIR . 'header.php';\ninclude_once $PIKA_ROOT_DIR.'inc/uploadfunction.php';\n\n$html='';\nif(isset($_POST['submit'])){\n    $type=array('jpg','jpeg','png');//指定类型\n    $mime=array('image/jpg','image/jpeg','image/png');\n    $save_path='uploads'.date('/Y/m/d/');//根据当天日期生成一个文件夹\n    $upload=upload('uploadfile','512000',$type,$mime,$save_path);//调用函数\n    if($upload['return']){\n        $html.=\"&lt;p class='notice'&gt;文件上传成功&lt;/p&gt;&lt;p class='notice'&gt;文件保存的路径为：{$upload['save_path']}&lt;/p&gt;\";\n    }else{\n        $html.=\"&lt;p class=notice&gt;{$upload['error']}&lt;/p&gt;\";\n\n    }\n}</code></pre>\n<p>后台getimagesize.php文件的主要内容</p>\n<p><img alt=\"\" height=\"117\" src=\"image\\280fbc9045364bc388cc69af30dc17f7.png\" width=\"105\"/><img alt=\"\" height=\"310\" src=\"image\\42c1b64cce654a53a730e77375348370.png\" width=\"755\"/></p>\n<p> 随意上传一张普通图片，显示上传成功</p>\n<p></p>\n<pre><code class=\"language-php\">&lt;?php phpinfo();?&gt;</code></pre>\n<p>尝试上传php文件，其中文件内容如上</p>\n<p><span style=\"color:#956fe7;\">（构造一句话木马的方式以及具体代码有很多很多，由个人需求而定，CSDN上搜一句话木马php有很多文章，在下在这方面的知识尚不深刻，就不在这班门弄斧了）</span></p>\n<p><img alt=\"\" height=\"240\" src=\"image\\ab8e062e66024661b36308923e733a3f.png\" width=\"757\"/>反馈结果如上</p>\n<p> 对a.php内容不做修改，直接将后缀名改为png，用burpsuite抓包，并将png改成php</p>\n<p>（</p>\n<p><img alt=\"\" height=\"74\" src=\"image\\8cd121266b70470aafebbee268e90b64.png\" width=\"792\"/></p>\n<p><img alt=\"\" height=\"79\" src=\"image\\8c72e7eba9ce4582b1652a01aa480981.png\" width=\"741\"/>修改后点击上传</p>\n<p></p>\n<p><img alt=\"\" height=\"245\" src=\"image\\300188b8bb6142048c50be3739e4d48b.png\" width=\"687\"/></p>\n<p> 可以看到仍然和前面是一样的显示结果</p>\n<p>修改后缀名但是不抓包修改内容尝试上传</p>\n<p> <img alt=\"\" height=\"244\" src=\"image\\cfef239fb8bd4b6bacbc54b6572aa415.png\" width=\"762\"/></p>\n<p>被识破了哈哈 （第一关如上所示可以绕过后端验证，第二关抓包修改请求头里Content-Type的值可以绕过验证）</p>\n<p>怎么绕过后端的检测呢，有很多种办法</p>\n<p>在这里只介绍<a class=\"link-info\" href=\"https://blog.csdn.net/piaolankeke/article/details/5872876?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_ecpm_v1~rank_v31_ecpm-2-5872876.pc_agg_new_rank&amp;utm_term=%E6%96%87%E4%BB%B6%E5%A4%B4gif89a%E5%8F%AF%E4%BB%A5%E4%BC%AA%E8%A3%85%E6%88%90%E4%BB%A5%E4%B8%8B%E5%93%AA%E7%A7%8D%E5%9B%BE%E7%89%87%E7%9A%84%E6%A0%BC%E5%BC%8F&amp;spm=1000.2123.3001.4430\" title=\"GIF89a图片头文件欺骗，\">GIF89a图片头文件欺骗，</a><span style=\"color:#0d0016;\">这里不一一赘述，好，开搞！</span></p>\n<pre><code class=\"language-php\">GIF89a&lt;?php phpinfo();?&gt;</code></pre>\n<p>将a.png中的内容改成如上图，即在代码前加上了<span style=\"color:#fe2c24;\">GIF89a</span>。 </p>\n<p><img alt=\"\" height=\"295\" src=\"image\\c92835944ae24804894cb9b934c10591.png\" width=\"834\"/></p>\n<p></p>\n<p> 上传成功了，那我们应该怎么检验呢</p>\n<p><img alt=\"\" height=\"593\" src=\"image\\198b9c5d06c648d28315ac9547d50fbc.png\" width=\"1200\"/></p>\n<p>我们在pikachu看到了使用了include函数的另外一个模块（文件包含漏洞），这就好办了</p>\n<p>根据pikachu中多个模块的url分析，最终得出以下路径</p>\n<pre><code>../../unsafeupload/uploads/2022/03/30/50444362447a43ad5d8128997197.png</code></pre>\n<p><img alt=\"\" height=\"1080\" src=\"image\\67e89911e36743d2b500249138237fb1.png\" width=\"1200\"/></p>\n<p> 拼接在File Inclusion模块中就可以得到我们想要的结果，  phpinfo函数可以显示出PHP 所有相关信息。是排查配置php是是否出错或漏配置模块的主要方式之一，只要访问到phpinfo()函数的web页面，即返回php的所有相关信息。</p>\n<p></p>\n<p></p>\n<p></p>\n</div>\n</div>"}