{"blogid": "126598308", "writerAge": "ç é¾„55å¤©", "writerBlogNum": "119", "writerCollect": "201", "writerComment": "19", "writerFan": "99", "writerGrade": "4çº§", "writerIntegral": "1274", "writerName": "Mr_DC_IT", "writerProfileAdress": "writer_image\\profile_126598308.jpg", "writerRankTotal": "15794", "writerRankWeekly": "1121", "writerThumb": "36", "writerVisitNum": "22581", "blog_read_count": "1060", "blog_time": "äºÂ 2022-08-30 11:25:35Â å‘å¸ƒ", "blog_title": "ã€æ¯•ä¸šè®¾è®¡ã€‘æ·±åº¦å­¦ä¹ äººè„¸è¡¨æƒ…è¯†åˆ«ç³»ç»Ÿ - python OpenCV", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>æ–‡ç« ç›®å½•</h3>\n<ul><li><a href=\"#0__6\">0 å‰è¨€</a></li><li><a href=\"#1__33\">1 æŠ€æœ¯ä»‹ç»</a></li><li><ul><li><a href=\"#11__34\">1.1 æŠ€æœ¯æ¦‚æ‹¬</a></li><li><a href=\"#12__44\">1.2 ç›®å‰è¡¨æƒ…è¯†åˆ«å®ç°æŠ€æœ¯</a></li></ul>\n</li><li><a href=\"#2__48\">2 å®ç°æ•ˆæœ</a></li><li><a href=\"#3__57\">3 æ·±åº¦å­¦ä¹ è¡¨æƒ…è¯†åˆ«å®ç°è¿‡ç¨‹</a></li><li><ul><li><a href=\"#31__58\">3.1 ç½‘ç»œæ¶æ„</a></li><li><a href=\"#32__66\">3.2 æ•°æ®</a></li><li><a href=\"#33__74\">3.3 å®ç°æµç¨‹</a></li><li><a href=\"#34__78\">3.4 éƒ¨åˆ†å®ç°ä»£ç </a></li></ul>\n</li></ul>\n</div>\n<p></p>\n<hr color=\"#000000\" size='1\"'/>\n<h1><a id=\"0__6\"></a>0 å‰è¨€</h1>\n<p>ğŸ”¥ Hiï¼Œå¤§å®¶å¥½ï¼Œè¿™é‡Œæ˜¯ä¸¹æˆå­¦é•¿çš„æ¯•è®¾ç³»åˆ—æ–‡ç« ï¼</p>\n<p>ğŸ”¥ å¯¹æ¯•è®¾æœ‰ä»»ä½•ç–‘é—®éƒ½å¯ä»¥é—®å­¦é•¿å“¦!</p>\n<p>è¿™ä¸¤å¹´å¼€å§‹ï¼Œå„ä¸ªå­¦æ ¡å¯¹æ¯•è®¾çš„è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œéš¾åº¦ä¹Ÿè¶Šæ¥è¶Šå¤§â€¦ æ¯•ä¸šè®¾è®¡è€—è´¹æ—¶é—´ï¼Œè€—è´¹ç²¾åŠ›ï¼Œç”šè‡³æœ‰äº›é¢˜ç›®å³ä½¿æ˜¯ä¸“ä¸šçš„è€å¸ˆæˆ–è€…ç¡•å£«ç”Ÿä¹Ÿéœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œæ‰€ä»¥ä¸€æ—¦å‘ç°é—®é¢˜ï¼Œä¸€å®šè¦æå‰å‡†å¤‡ï¼Œé¿å…åˆ°åé¢æªæ‰‹ä¸åŠï¼Œè‰è‰äº†äº‹ã€‚</p>\n<p>ä¸ºäº†å¤§å®¶èƒ½å¤Ÿé¡ºåˆ©ä»¥åŠæœ€å°‘çš„ç²¾åŠ›é€šè¿‡æ¯•è®¾ï¼Œå­¦é•¿åˆ†äº«ä¼˜è´¨æ¯•ä¸šè®¾è®¡é¡¹ç›®ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ–°é¡¹ç›®æ˜¯</p>\n<p>ğŸš© <strong>åŸºäºæ·±åº¦å­¦ä¹ çš„äººè„¸è¡¨æƒ…è¯†åˆ«</strong></p>\n<p>ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)</p>\n<ul><li>éš¾åº¦ç³»æ•°ï¼š4åˆ†</li><li>å·¥ä½œé‡ï¼š4åˆ†</li><li>åˆ›æ–°ç‚¹ï¼š3åˆ†</li></ul>\n<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p>\n<p><a href=\"https://blog.csdn.net/Mr_DC_IT/article/details/126460477\">https://blog.csdn.net/Mr_DC_IT/article/details/126460477</a></p>\n<h1><a id=\"1__33\"></a>1 æŠ€æœ¯ä»‹ç»</h1>\n<h2><a id=\"11__34\"></a>1.1 æŠ€æœ¯æ¦‚æ‹¬</h2>\n<p>é¢éƒ¨è¡¨æƒ…è¯†åˆ«æŠ€æœ¯æºäº1971å¹´å¿ƒç†å­¦å®¶Ekmanå’ŒFriesençš„ä¸€é¡¹ç ”ç©¶ï¼Œä»–ä»¬æå‡ºäººç±»ä¸»è¦æœ‰å…­ç§åŸºæœ¬æƒ…æ„Ÿï¼Œæ¯ç§æƒ…æ„Ÿä»¥å”¯ä¸€çš„è¡¨æƒ…æ¥åæ˜ å½“æ—¶çš„å¿ƒç†æ´»åŠ¨ï¼Œè¿™å…­ç§æƒ…æ„Ÿåˆ†åˆ«æ˜¯æ„¤æ€’ï¼ˆangerï¼‰ã€é«˜å…´(happiness)ã€æ‚²ä¼¤ (sadness)ã€æƒŠè®¶(surprise)ã€åŒæ¶(disgust)å’Œææƒ§(fear)ã€‚</p>\n<p>å°½ç®¡äººç±»çš„æƒ…æ„Ÿç»´åº¦å’Œè¡¨æƒ…å¤æ‚åº¦è¿œä¸æ˜¯æ•°å­—6å¯ä»¥é‡åŒ–çš„ï¼Œä½†æ€»ä½“è€Œè¨€ï¼Œè¿™6ç§ä¹Ÿå·®ä¸å¤šå¤Ÿæè¿°äº†ã€‚</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\20210128172500745.png\"/></p>\n<h2><a id=\"12__44\"></a>1.2 ç›®å‰è¡¨æƒ…è¯†åˆ«å®ç°æŠ€æœ¯</h2>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\2021012817182873.png\"/><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\20210128171840815.png\"/></p>\n<h1><a id=\"2__48\"></a>2 å®ç°æ•ˆæœ</h1>\n<p>åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šå®ç°æ•ˆæœ</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\20210129101340491.png\"/><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\20210129101433120.png\"/></p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\20210129101441129.png\"/></p>\n<h1><a id=\"3__57\"></a>3 æ·±åº¦å­¦ä¹ è¡¨æƒ…è¯†åˆ«å®ç°è¿‡ç¨‹</h1>\n<h2><a id=\"31__58\"></a>3.1 ç½‘ç»œæ¶æ„</h2>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\20210128173019436.png\"/><br/> é¢éƒ¨è¡¨æƒ…è¯†åˆ«CNNæ¶æ„ï¼ˆæ”¹ç¼–è‡ª åŸƒå› éœèŠ¬ç†å·¥å¤§å­¦PARsEç»“æ„å›¾ï¼‰</p>\n<p>å…¶ä¸­ï¼Œé€šè¿‡å·ç§¯æ“ä½œæ¥åˆ›å»ºç‰¹å¾æ˜ å°„ï¼Œå°†å·ç§¯æ ¸æŒ¨ä¸ªä¸å›¾åƒè¿›è¡Œå·ç§¯ï¼Œä»è€Œåˆ›å»ºä¸€ç»„è¦ç´ å›¾ï¼Œå¹¶åœ¨å…¶åé€šè¿‡æ± åŒ–ï¼ˆpoolingï¼‰æ“ä½œæ¥é™ç»´ã€‚</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\20210128173114380.png\"/></p>\n<h2><a id=\"32__66\"></a>3.2 æ•°æ®</h2>\n<p>ä¸»è¦æ¥æºäºkaggleæ¯”èµ›ï¼Œä¸‹è½½åœ°å€ã€‚<br/> æœ‰ä¸ƒç§è¡¨æƒ…ç±»åˆ«ï¼š (0=Angry, 1=Disgust, 2=Fear, 3=Happy, 4=Sad, 5=Surprise, 6=Neutral).<br/> æ•°æ®æ˜¯48x48 ç°åº¦å›¾ï¼Œæ ¼å¼æ¯”è¾ƒå¥‡è‘©ã€‚<br/> ç¬¬ä¸€åˆ—æ˜¯æƒ…ç»ªåˆ†ç±»ï¼Œç¬¬äºŒåˆ—æ˜¯å›¾åƒçš„numpyï¼Œç¬¬ä¸‰åˆ—æ˜¯train or testã€‚</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\20210128172732635.png\"/></p>\n<h2><a id=\"33__74\"></a>3.3 å®ç°æµç¨‹</h2>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\202101281739040.png\"/></p>\n<h2><a id=\"34__78\"></a>3.4 éƒ¨åˆ†å®ç°ä»£ç </h2>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">from</span> keras<span class=\"token punctuation\">.</span>models <span class=\"token keyword\">import</span> model_from_json\n\n\nemotions <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'angry'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fear'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'happy'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sad'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'surprise'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'neutral'</span><span class=\"token punctuation\">]</span>\ncascPath <span class=\"token operator\">=</span> sys<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\nfaceCascade <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>CascadeClassifier<span class=\"token punctuation\">(</span>cascPath<span class=\"token punctuation\">)</span>\nnoseCascade <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>CascadeClassifier<span class=\"token punctuation\">(</span>cascPath<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># load json and create model arch</span>\njson_file <span class=\"token operator\">=</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'model.json'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span>\nloaded_model_json <span class=\"token operator\">=</span> json_file<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\njson_file<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmodel <span class=\"token operator\">=</span> model_from_json<span class=\"token punctuation\">(</span>loaded_model_json<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># load weights into new model</span>\nmodel<span class=\"token punctuation\">.</span>load_weights<span class=\"token punctuation\">(</span><span class=\"token string\">'model.h5'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># overlay meme face</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">overlay_memeface</span><span class=\"token punctuation\">(</span>probs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span>probs<span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">:</span>\n        emotion <span class=\"token operator\">=</span> emotions<span class=\"token punctuation\">[</span>np<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span>probs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'meme_faces/{}-{}.png'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>emotion<span class=\"token punctuation\">,</span> emotion<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        index1<span class=\"token punctuation\">,</span> index2 <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>argsort<span class=\"token punctuation\">(</span>probs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n        emotion1 <span class=\"token operator\">=</span> emotions<span class=\"token punctuation\">[</span>index1<span class=\"token punctuation\">]</span>\n        emotion2 <span class=\"token operator\">=</span> emotions<span class=\"token punctuation\">[</span>index2<span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">'meme_faces/{}-{}.png'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>emotion1<span class=\"token punctuation\">,</span> emotion2<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">predict_emotion</span><span class=\"token punctuation\">(</span>face_image_gray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># a single cropped face</span>\n    resized_img <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>face_image_gray<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span><span class=\"token number\">48</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> interpolation <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>INTER_AREA<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># cv2.imwrite(str(index)+'.png', resized_img)</span>\n    image <span class=\"token operator\">=</span> resized_img<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">)</span>\n    list_of_list <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> verbose<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    angry<span class=\"token punctuation\">,</span> fear<span class=\"token punctuation\">,</span> happy<span class=\"token punctuation\">,</span> sad<span class=\"token punctuation\">,</span> surprise<span class=\"token punctuation\">,</span> neutral <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>prob <span class=\"token keyword\">for</span> lst <span class=\"token keyword\">in</span> list_of_list <span class=\"token keyword\">for</span> prob <span class=\"token keyword\">in</span> lst<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>angry<span class=\"token punctuation\">,</span> fear<span class=\"token punctuation\">,</span> happy<span class=\"token punctuation\">,</span> sad<span class=\"token punctuation\">,</span> surprise<span class=\"token punctuation\">,</span> neutral<span class=\"token punctuation\">]</span>\n\nvideo_capture <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>VideoCapture<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Capture frame-by-frame</span>\n    ret<span class=\"token punctuation\">,</span> frame <span class=\"token operator\">=</span> video_capture<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    img_gray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n\n    faces <span class=\"token operator\">=</span> faceCascade<span class=\"token punctuation\">.</span>detectMultiScale<span class=\"token punctuation\">(</span>\n        img_gray<span class=\"token punctuation\">,</span>\n        scaleFactor<span class=\"token operator\">=</span><span class=\"token number\">1.1</span><span class=\"token punctuation\">,</span>\n        minNeighbors<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n        minSize<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        flags<span class=\"token operator\">=</span>cv2<span class=\"token punctuation\">.</span>cv<span class=\"token punctuation\">.</span>CV_HAAR_SCALE_IMAGE\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Draw a rectangle around the faces</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> faces<span class=\"token punctuation\">:</span>\n\n        face_image_gray <span class=\"token operator\">=</span> img_gray<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">:</span>y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">]</span>\n        filename <span class=\"token operator\">=</span> overlay_memeface<span class=\"token punctuation\">(</span>predict_emotion<span class=\"token punctuation\">(</span>face_image_gray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">print</span> filename\n        meme <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span>filename<span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># meme = (meme/256).astype('uint8')</span>\n        <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n            meme<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">except</span><span class=\"token punctuation\">:</span>\n            meme <span class=\"token operator\">=</span> meme<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span>meme<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> meme<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># print meme.dtype</span>\n        <span class=\"token comment\"># print meme.shape</span>\n        orig_mask <span class=\"token operator\">=</span> meme<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n        <span class=\"token comment\"># print orig_mask.shape</span>\n        <span class=\"token comment\"># memegray = cv2.cvtColor(orig_mask, cv2.COLOR_BGR2GRAY)</span>\n        ret1<span class=\"token punctuation\">,</span> orig_mask <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">(</span>orig_mask<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>THRESH_BINARY<span class=\"token punctuation\">)</span>\n        orig_mask_inv <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>bitwise_not<span class=\"token punctuation\">(</span>orig_mask<span class=\"token punctuation\">)</span>\n        meme <span class=\"token operator\">=</span> meme<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n        origMustacheHeight<span class=\"token punctuation\">,</span> origMustacheWidth <span class=\"token operator\">=</span> meme<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\n        roi_gray <span class=\"token operator\">=</span> img_gray<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">:</span>y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">]</span>\n        roi_color <span class=\"token operator\">=</span> frame<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">:</span>y<span class=\"token operator\">+</span>h<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span>x<span class=\"token operator\">+</span>w<span class=\"token punctuation\">]</span>\n\n        <span class=\"token comment\"># Detect a nose within the region bounded by each face (the ROI)</span>\n        nose <span class=\"token operator\">=</span> noseCascade<span class=\"token punctuation\">.</span>detectMultiScale<span class=\"token punctuation\">(</span>roi_gray<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>nx<span class=\"token punctuation\">,</span>ny<span class=\"token punctuation\">,</span>nw<span class=\"token punctuation\">,</span>nh<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> nose<span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># Un-comment the next line for debug (draw box around the nose)</span>\n            <span class=\"token comment\">#cv2.rectangle(roi_color,(nx,ny),(nx+nw,ny+nh),(255,0,0),2)</span>\n\n            <span class=\"token comment\"># The mustache should be three times the width of the nose</span>\n            mustacheWidth <span class=\"token operator\">=</span>  <span class=\"token number\">20</span> <span class=\"token operator\">*</span> nw\n            mustacheHeight <span class=\"token operator\">=</span> mustacheWidth <span class=\"token operator\">*</span> origMustacheHeight <span class=\"token operator\">/</span> origMustacheWidth\n\n            <span class=\"token comment\"># Center the mustache on the bottom of the nose</span>\n            x1 <span class=\"token operator\">=</span> nx <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>mustacheWidth<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n            x2 <span class=\"token operator\">=</span> nx <span class=\"token operator\">+</span> nw <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>mustacheWidth<span class=\"token operator\">/</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n            y1 <span class=\"token operator\">=</span> ny <span class=\"token operator\">+</span> nh <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>mustacheHeight<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n            y2 <span class=\"token operator\">=</span> ny <span class=\"token operator\">+</span> nh <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>mustacheHeight<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># Check for clipping</span>\n            <span class=\"token keyword\">if</span> x1 <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                x1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n            <span class=\"token keyword\">if</span> y1 <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                y1 <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n            <span class=\"token keyword\">if</span> x2 <span class=\"token operator\">&gt;</span> w<span class=\"token punctuation\">:</span>\n                x2 <span class=\"token operator\">=</span> w\n            <span class=\"token keyword\">if</span> y2 <span class=\"token operator\">&gt;</span> h<span class=\"token punctuation\">:</span>\n                y2 <span class=\"token operator\">=</span> h\n\n\n            <span class=\"token comment\"># Re-calculate the width and height of the mustache image</span>\n            mustacheWidth <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>x2 <span class=\"token operator\">-</span> x1<span class=\"token punctuation\">)</span>\n            mustacheHeight <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>y2 <span class=\"token operator\">-</span> y1<span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># Re-size the original image and the masks to the mustache sizes</span>\n            <span class=\"token comment\"># calcualted above</span>\n            mustache <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>meme<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>mustacheWidth<span class=\"token punctuation\">,</span>mustacheHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> interpolation <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>INTER_AREA<span class=\"token punctuation\">)</span>\n            mask <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>orig_mask<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>mustacheWidth<span class=\"token punctuation\">,</span>mustacheHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> interpolation <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>INTER_AREA<span class=\"token punctuation\">)</span>\n            mask_inv <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>orig_mask_inv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>mustacheWidth<span class=\"token punctuation\">,</span>mustacheHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> interpolation <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>INTER_AREA<span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># take ROI for mustache from background equal to size of mustache image</span>\n            roi <span class=\"token operator\">=</span> roi_color<span class=\"token punctuation\">[</span>y1<span class=\"token punctuation\">:</span>y2<span class=\"token punctuation\">,</span> x1<span class=\"token punctuation\">:</span>x2<span class=\"token punctuation\">]</span>\n\n            <span class=\"token comment\"># roi_bg contains the original image only where the mustache is not</span>\n            <span class=\"token comment\"># in the region that is the size of the mustache.</span>\n            roi_bg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>bitwise_and<span class=\"token punctuation\">(</span>roi<span class=\"token punctuation\">,</span>roi<span class=\"token punctuation\">,</span>mask <span class=\"token operator\">=</span> mask_inv<span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># roi_fg contains the image of the mustache only where the mustache is</span>\n            roi_fg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>bitwise_and<span class=\"token punctuation\">(</span>mustache<span class=\"token punctuation\">,</span>mustache<span class=\"token punctuation\">,</span>mask <span class=\"token operator\">=</span> mask<span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># join the roi_bg and roi_fg</span>\n            dst <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>roi_bg<span class=\"token punctuation\">,</span>roi_fg<span class=\"token punctuation\">)</span>\n\n            <span class=\"token comment\"># place the joined image, saved to dst back over the original image</span>\n            roi_color<span class=\"token punctuation\">[</span>y1<span class=\"token punctuation\">:</span>y2<span class=\"token punctuation\">,</span> x1<span class=\"token punctuation\">:</span>x2<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> dst\n\n            <span class=\"token keyword\">break</span>\n\n    <span class=\"token comment\">#     cv2.rectangle(frame, (x, y), (x+w, y+h), (0, 255, 0), 2)</span>\n    <span class=\"token comment\">#     angry, fear, happy, sad, surprise, neutral = predict_emotion(face_image_gray)</span>\n    <span class=\"token comment\">#     text1 = 'Angry: {}     Fear: {}   Happy: {}'.format(angry, fear, happy)</span>\n    <span class=\"token comment\">#     text2 = '  Sad: {} Surprise: {} Neutral: {}'.format(sad, surprise, neutral)</span>\n    <span class=\"token comment\">#</span>\n    <span class=\"token comment\"># cv2.putText(frame, text1, (50, 50), cv2.FONT_HERSHEY_SIMPLEX, 2, (255, 0, 0), 3)</span>\n    <span class=\"token comment\"># cv2.putText(frame, text2, (50, 150), cv2.FONT_HERSHEY_SIMPLEX, 2, (255, 0, 0), 3)</span>\n\n    <span class=\"token comment\"># Display the resulting frame</span>\n    cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'Video'</span><span class=\"token punctuation\">,</span> frame<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> cv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF</span> <span class=\"token operator\">==</span> <span class=\"token builtin\">ord</span><span class=\"token punctuation\">(</span><span class=\"token string\">'q'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span>\n\n<span class=\"token comment\"># When everything is done, release the capture</span>\nvideo_capture<span class=\"token punctuation\">.</span>release<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>éœ€è¦å®Œæ•´ä»£ç ä»¥åŠå­¦é•¿è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œè”ç³»å­¦é•¿è·å–</strong></p>\n<br/>\n<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p>\n<p><a href=\"https://blog.csdn.net/Mr_DC_IT/article/details/126460477\">https://blog.csdn.net/Mr_DC_IT/article/details/126460477</a></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}