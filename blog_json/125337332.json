{"blogid": "125337332", "writerAge": "码龄7年", "writerBlogNum": "113", "writerCollect": "767", "writerComment": "321", "writerFan": "653", "writerGrade": "5级", "writerIntegral": "1958", "writerName": "十幺卜入", "writerProfileAdress": "writer_image\\profile_125337332.jpg", "writerRankTotal": "10147", "writerRankWeekly": "6902", "writerThumb": "311", "writerVisitNum": "219715", "blog_read_count": "774", "blog_time": "已于 2022-06-22 15:24:29 修改", "blog_title": "Unity3d C# 开发微信小游戏分享图片、朋友圈等功能实现（含源码）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"_0\"></a>广告</h1>\n<p>通过一段时间的基于minigame-unity-webgl-transform插件的开发，算是稍微完整的一小个游戏已经制作完成，具体大家可以扫码体验一下：</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\9b059c9cec4849718d0f5dc15f9b8308.jpeg\"/></p>\n<p>感谢支持！！</p>\n<h1><a id=\"_10\"></a>前言</h1>\n<p>之前编写了一篇<a href=\"https://blog.csdn.net/qq_33789001/article/details/124200300\">u3d转微信小游戏开发教程的博客</a>,虽然这个公测插件还有很多问题，我个人也在一直使用中。开发一个游戏后，最佳的宣传途径就是通过玩家关系链快速分享，所以给玩家制作一个快速分享的功能很有必要，这里就我个人研究的使用该插件的分享功能实现方式。微信小游戏不推荐强制分享，这点都注意。本文重点讲分享菜单和主动调起分享功能。部分功能可能只支持Android手机，具体参照官网由于插件一直在更新中，接口和实现可能随时间变化会差异，本分享博文仅供参考。</p>\n<h1><a id=\"Menu_14\"></a>Menu分享</h1>\n<p>先看看效果：<br/> <img alt=\"在这里插入图片描述\" src=\"https://img-blog.csdnimg.cn/4fb435c6a8ed46e288a15ff0adc87ac1.gif#pic_center\"/></p>\n<p>接口：</p>\n<pre><code class=\"prism language-csharp\">        <span class=\"token comment\">//显示接口</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ShowShareMenu</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ShowShareMenuOption</span> callback<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            WXSDKManagerHandler<span class=\"token punctuation\">.</span>Instance<span class=\"token punctuation\">.</span><span class=\"token function\">ShowShareMenu</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n\n        <span class=\"token comment\">//关闭接口</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">HideShareMenu</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HideShareMenuOption</span> callback<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            WXSDKManagerHandler<span class=\"token punctuation\">.</span>Instance<span class=\"token punctuation\">.</span><span class=\"token function\">HideShareMenu</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>两个接口分别对应<a href=\"https://developers.weixin.qq.com/minigame/dev/api/share/wx.showShareMenu.html\">wx.showShareMenu(Object object)</a>和 <a href=\"https://developers.weixin.qq.com/minigame/dev/api/share/wx.hideShareMenu.html\">wx.hideShareMenu(Object object)</a><br/> 可以前往查看详细说明。</p>\n<p>这里的调用代码：</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token class-name\">ShowShareMenuOption</span> ssmo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ShowShareMenuOption</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nssmo<span class=\"token punctuation\">.</span>menus <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token string\">\"shareAppMessage\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"shareTimeline\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nWX<span class=\"token punctuation\">.</span><span class=\"token function\">ShowShareMenu</span><span class=\"token punctuation\">(</span>ssmo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token class-name\">HideShareMenuOption</span> hsmo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">HideShareMenuOption</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nhsmo<span class=\"token punctuation\">.</span>menus <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token string\">\"shareAppMessage\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"shareTimeline\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\nWX<span class=\"token punctuation\">.</span><span class=\"token function\">HideShareMenu</span><span class=\"token punctuation\">(</span>hsmo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h1><a id=\"_48\"></a>主动分享</h1>\n<p>效果：<br/> <img alt=\"在这里插入图片描述\" src=\"https://img-blog.csdnimg.cn/7942b60e57f54dc2bb88554902e20c31.gif#pic_center\"/></p>\n<p>接口：</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ShareAppMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ShareAppMessageOption</span> option<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    WXSDKManagerHandler<span class=\"token punctuation\">.</span>Instance<span class=\"token punctuation\">.</span><span class=\"token function\">ShareAppMessage</span><span class=\"token punctuation\">(</span>option<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>对应原生<a href=\"https://developers.weixin.qq.com/minigame/dev/api/share/wx.shareAppMessage.html\">wx.shareAppMessage(Object object)</a>接口</p>\n<p>主动拉起转发，进入选择通讯录界面。这里的主动分享功能是给好友或者群分享消息，可以用于分享给奖励等场景。</p>\n<p>接口调用：</p>\n<pre><code class=\"prism language-csharp\">     <span class=\"token class-name\">ShareAppMessageOption</span> samo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ShareAppMessageOption</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n     samo<span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">\"这是标题\"</span><span class=\"token punctuation\">;</span>\n     <span class=\"token comment\">//samo.imageUrl = \"这是图片路径\";</span>\n     <span class=\"token comment\">//samo.imageUrlId = \"这是图片路径ID\";</span>\n     <span class=\"token comment\">//samo.path =\"独立分包路径\";</span>\n  WX<span class=\"token punctuation\">.</span><span class=\"token function\">ShareAppMessage</span><span class=\"token punctuation\">(</span>samo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>要注意的是为了<mark>防止分享滥用</mark>（早期各种小程序分享消息满天飞都体验过了吧），已经不能获取到用户的分享结果如：成功、失败、取消等。<br/> 这里的imageUrl 是本地或者临时图片路径，比如在导出的包路径***\\minigame\\ 下放一个xx.png图片，分享路径是”xx.png”.<br/> imageUrlId 是审核通过的转发图片id，可以<a href=\"https://developers.weixin.qq.com/minigame/dev/guide/open-ability/share/share.html#%E4%BD%BF%E7%94%A8%E5%AE%A1%E6%A0%B8%E9%80%9A%E8%BF%87%E7%9A%84%E8%BD%AC%E5%8F%91%E5%9B%BE%E7%89%87\">[看看说明]</a><br/> path是独立分包路径，具体<a href=\"https://developers.weixin.qq.com/minigame/dev/guide/base-ability/independent-sub-packages.html\">看说明</a></p>\n<h1><a id=\"_79\"></a>图片菜单分享</h1>\n<p>效果：<br/> <img alt=\"在这里插入图片描述\" src=\"https://img-blog.csdnimg.cn/775263ba1e0a4a72b8ed5f990df60b8c.gif#pic_center\"/></p>\n<p>接口：</p>\n<pre><code class=\"prism language-csharp\">        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ShowShareImageMenu</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ShowShareImageMenuOption</span> callback<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            WXSDKManagerHandler<span class=\"token punctuation\">.</span>Instance<span class=\"token punctuation\">.</span><span class=\"token function\">ShowShareImageMenu</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>该功能是打开分享图片弹窗，可以将图片发送给朋友、收藏或下载。<br/> 对应原生<br/> <a href=\"https://developers.weixin.qq.com/minigame/dev/api/share/wx.showShareImageMenu.html\">wx.showShareImageMenu(Object object)</a>接口<br/> 调用代码：</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token class-name\">ShowShareImageMenuOption</span> ssimo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ShowShareImageMenuOption</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nssimo<span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> <span class=\"token string\">\"Share.png\"</span><span class=\"token punctuation\">;</span>\nWX<span class=\"token punctuation\">.</span><span class=\"token function\">ShowShareImageMenu</span><span class=\"token punctuation\">(</span>ssimo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>这里的path 是本地或者临时图片路径，比如在导出的包路径***\\minigame\\ 下放一个xx.png图片，分享本地路径是”xx.png”.</p>\n<h1><a id=\"beta_107\"></a>分享朋友圈（beta）</h1>\n<p>该功能通过Menu分享实现的，ShowShareMenuOption 设置menus =new string[] { “shareAppMessage”, “shareTimeline” };即是朋友圈分享了，这里要注意的是：\"shareAppMessage\"表示“发送给朋友”按钮，\"shareTimeline\"表示“分享到朋友圈”按钮。显示“分享到朋友圈”按钮时必须同时显示“发送给朋友”按钮，显示“发送给朋友”按钮时则允许不显示“分享到朋友圈”按钮。</p>\n<h1><a id=\"_113\"></a>指定好友分享</h1>\n<p>接口：</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">ShareMessageToFriend</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ShareMessageToFriendOption</span> callback<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    WXSDKManagerHandler<span class=\"token punctuation\">.</span>Instance<span class=\"token punctuation\">.</span><span class=\"token function\">ShareMessageToFriend</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>该接口对应<a href=\"https://developers.weixin.qq.com/minigame/dev/api/open-api/data/wx.shareMessageToFriend.html\">wx.shareMessageToFriend(Object object)</a><br/> 这个接口这里没做演示因为暂未用到。 不过该接口只可在开放数据域下使用。游戏域和开放数据域的概念可以在官网中查阅，如果用开放数据域做排行榜肯定都明白。</p>\n<h1><a id=\"_128\"></a>游戏回放分享</h1>\n<p>该功能在cocos creator开发微信小游戏时用到过，目前翻遍文档暂未发现支持，具体可以看文档（https://developers.weixin.qq.com/minigame/dev/guide/open-ability/game-recorder.html），只能等待插件开发者更新支持了。</p>\n<h1><a id=\"_133\"></a>源码</h1>\n<p>需要填写自己的appid，并转换微信小程序。<br/> <a href=\"https://download.csdn.net/download/qq_33789001/85675446\">https://download.csdn.net/download/qq_33789001/85675446</a><br/> 如果打不开是审核暂未通过。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}