{"blogid": "126673483", "writerAge": "ç é¾„4å¹´", "writerBlogNum": "14", "writerCollect": "296", "writerComment": "463", "writerFan": "624", "writerGrade": "4çº§", "writerIntegral": "1025", "writerName": "KinHKin", "writerProfileAdress": "writer_image\\profile_126673483.jpg", "writerRankTotal": "20236", "writerRankWeekly": "172", "writerThumb": "344", "writerVisitNum": "4291", "blog_read_count": "941", "blog_time": "å·²äºÂ 2022-09-04 09:30:44Â ä¿®æ”¹", "blog_title": "çŒ¿åˆ›å¾æ–‡ï½œvueä¸­ä½¿ç”¨Axiosæœ€ä½³å®è·µ", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<blockquote>\n<p>æ¸©é¦¨æç¤ºï¼šä¸€æ–‡ææ‡‚å‰ç«¯ç½‘ç»œè¯·æ±‚ä¹‹axiosï¼Œå…¨æ–‡8åƒå­—ï¼Œä¼°è®¡è€—æ—¶10-12åˆ†é’Ÿ</p>\n<p>åšä¸»ä¸»é¡µï¼š<a href=\"https://blog.csdn.net/weixin_42974827?spm=1010.2135.3001.5421\" title=\"KinHKinçš„åšå®¢_CSDNåšå®¢-vue,æ€§èƒ½ä¼˜åŒ–,ç±»å‹è½¬æ¢é¢†åŸŸåšä¸»\">KinHKinçš„åšå®¢_CSDNåšå®¢-vue,æ€§èƒ½ä¼˜åŒ–,ç±»å‹è½¬æ¢é¢†åŸŸåšä¸»</a></p>\n<p><strong>æç¤ºï¼š</strong>å®Œæ•´ä»£ç æˆ‘å·²ç»å‹ç¼©æ”¾åœ¨ä¸ªäººä¸»é¡µçš„èµ„æºé‡Œï¼Œä¾›å¤§å®¶å…è´¹ä¸‹è½½ğŸ’—</p>\n</blockquote>\n<p id=\"main-toc\"><strong>ç›®å½•</strong></p>\n<p id=\"1.%E5%89%8D%E8%A8%80-toc\" style=\"margin-left:0px;\"><a href=\"#1.%E5%89%8D%E8%A8%80\">1.å‰è¨€</a></p>\n<p id=\"2.%E4%BD%BF%E7%94%A8-toc\" style=\"margin-left:0px;\"><a href=\"#2.%E4%BD%BF%E7%94%A8\">2.ä½¿ç”¨</a></p>\n<p id=\"2.1%E5%AE%89%E8%A3%85-toc\" style=\"margin-left:40px;\"><a href=\"#2.1%E5%AE%89%E8%A3%85\">2.1å®‰è£…</a></p>\n<p id=\"2.2%E5%9F%BA%E6%9C%AC%E7%94%A8%E4%BE%8B-toc\" style=\"margin-left:40px;\"><a href=\"#2.2%E5%9F%BA%E6%9C%AC%E7%94%A8%E4%BE%8B\">2.2åŸºæœ¬ç”¨ä¾‹</a></p>\n<p id=\"2.2.1%20get%E8%AF%B7%E6%B1%82-toc\" style=\"margin-left:80px;\"><a href=\"#2.2.1%20get%E8%AF%B7%E6%B1%82\">2.2.1 getè¯·æ±‚</a></p>\n<p id=\"2.2.2%C2%A0post%E8%AF%B7%E6%B1%82-toc\" style=\"margin-left:80px;\"><a href=\"#2.2.2%C2%A0post%E8%AF%B7%E6%B1%82\">2.2.2 postè¯·æ±‚</a></p>\n<p id=\"3.%E9%85%8D%E7%BD%AE-toc\" style=\"margin-left:0px;\"><a href=\"#3.%E9%85%8D%E7%BD%AE\">3.é…ç½®</a></p>\n<p id=\"3.1%E8%AF%AD%E6%B3%95-toc\" style=\"margin-left:40px;\"><a href=\"#3.1%E8%AF%AD%E6%B3%95\">3.1è¯­æ³•</a></p>\n<p id=\"3.2%E5%88%AB%E5%90%8D%C2%A0-toc\" style=\"margin-left:40px;\"><a href=\"#3.2%E5%88%AB%E5%90%8D%C2%A0\">3.2åˆ«å </a></p>\n<p id=\"4.Axios%E5%AE%9E%E4%BE%8B-toc\" style=\"margin-left:0px;\"><a href=\"#4.Axios%E5%AE%9E%E4%BE%8B\">4.Axioså®ä¾‹</a></p>\n<p id=\"4.1%E8%AF%AD%E6%B3%95-toc\" style=\"margin-left:40px;\"><a href=\"#4.1%E8%AF%AD%E6%B3%95\">4.1è¯­æ³•</a></p>\n<p id=\"4.2%E8%AF%B7%E6%B1%82%E9%85%8D%E7%BD%AE-toc\" style=\"margin-left:40px;\"><a href=\"#4.2%E8%AF%B7%E6%B1%82%E9%85%8D%E7%BD%AE\">4.2è¯·æ±‚é…ç½®</a></p>\n<p id=\"4.3%E5%93%8D%E5%BA%94%E7%9A%84%E9%85%8D%E7%BD%AE-toc\" style=\"margin-left:40px;\"><a href=\"#4.3%E5%93%8D%E5%BA%94%E7%9A%84%E9%85%8D%E7%BD%AE\">4.3å“åº”çš„é…ç½®</a></p>\n<p id=\"pei-zhi-de-you-xian-ji-toc\" style=\"margin-left:80px;\"><a href=\"#pei-zhi-de-you-xian-ji\">é…ç½®çš„ä¼˜å…ˆçº§</a></p>\n<p id=\"5.%E6%8B%A6%E6%88%AA%E5%99%A8-toc\" style=\"margin-left:0px;\"><a href=\"#5.%E6%8B%A6%E6%88%AA%E5%99%A8\">5.æ‹¦æˆªå™¨</a></p>\n<p id=\"6.%E9%94%99%E8%AF%AF%E6%8B%A6%E6%88%AA-toc\" style=\"margin-left:0px;\"><a href=\"#6.%E9%94%99%E8%AF%AF%E6%8B%A6%E6%88%AA\">6.é”™è¯¯æ‹¦æˆª</a></p>\n<p id=\"%C2%A07%EF%BC%8C%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82-toc\" style=\"margin-left:0px;\"><a href=\"#%C2%A07%EF%BC%8C%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82\"> 7.å–æ¶ˆè¯·æ±‚</a></p>\n<p id=\"8.%E5%AE%8C%E6%95%B4%E5%B0%81%E8%A3%85%C2%A0-toc\" style=\"margin-left:0px;\"><a href=\"#8.%E5%AE%8C%E6%95%B4%E5%B0%81%E8%A3%85%C2%A0\">8.å®Œæ•´å°è£… </a></p>\n<p id=\"9.%E6%80%BB%E7%BB%93-toc\" style=\"margin-left:0px;\"><a href=\"#9.%E6%80%BB%E7%BB%93\">9.æ€»ç»“</a></p>\n<hr id=\"hr-toc\"/>\n<h1>1.å‰è¨€</h1>\n<p>æœ€è¿‘åœ¨å†™vue3çš„é¡¹ç›®ï¼Œéœ€è¦é‡æ–°æ­å»ºè„šæ‰‹æ¶å¹¶ä¸”ä½¿ç”¨ç½‘ç»œè¯·æ±‚æ¥å£ï¼Œå¯¹äºjsçš„ç½‘ç»œè¯·æ±‚æ¥å£çš„ä¸€èˆ¬æœ‰å‡ ç§å¸¸ç”¨çš„æ–¹å¼ï¼š</p>\n<ol><li>fetch</li><li>XMLHttpRequests</li><li>ajax ï¼ˆåŸç”Ÿï¼‰</li><li>axios ï¼ˆå¼€æºï¼‰</li></ol>\n<p>Axios æ˜¯ä¸€ä¸ªåŸºäº promise çš„ç½‘ç»œè¯·æ±‚åº“ï¼Œå¯ä»¥ç”¨äºæµè§ˆå™¨å’Œ node.jsã€‚Axios ä½¿ç”¨ç®€å•,åŒ…å°ºå¯¸å°ä¸”æä¾›äº†æ˜“äºæ‰©å±•çš„æ¥å£ã€‚åœ¨æœåŠ¡ç«¯å®ƒä½¿ç”¨åŸç”Ÿ node.js <code>http</code> æ¨¡å—, è€Œåœ¨å®¢æˆ·ç«¯ (æµè§ˆç«¯) åˆ™ä½¿ç”¨ XMLHttpRequestsã€‚</p>\n<blockquote>\n<p>ç®€å•ç¤ºä¾‹ï¼š</p>\n<p>import axios from \"axios\";<br/> axios.get('/users')<br/> .then(res =&gt; {<!-- --><br/> console.log(res.data);<br/> });</p>\n</blockquote>\n<h1 id=\"2.%E4%BD%BF%E7%94%A8\">2.ä½¿ç”¨</h1>\n<h2 id=\"2.1%E5%AE%89%E8%A3%85\">2.1å®‰è£…</h2>\n<pre><code>npm install axios</code></pre>\n<h2 id=\"2.2%E5%9F%BA%E6%9C%AC%E7%94%A8%E4%BE%8B\">2.2åŸºæœ¬ç”¨ä¾‹</h2>\n<blockquote>\n<p>åœ¨commonJsä¸­ä½¿ç”¨axiosæ—¶å€™ï¼šä½¿ç”¨require()å¯¼å…¥çš„æ—¶å€™è·å¾—tsçš„ç±»å‹æ¨æ–­ï¼›ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>\n<p><strong>const axios = require('axios').default; </strong></p>\n<p><strong>// axios.&lt;method&gt; èƒ½å¤Ÿæä¾›è‡ªåŠ¨å®Œæˆå’Œå‚æ•°ç±»å‹æ¨æ–­åŠŸèƒ½</strong></p>\n</blockquote>\n<h3 id=\"2.2.1%20get%E8%AF%B7%E6%B1%82\">2.2.1 getè¯·æ±‚</h3>\n<p>å‘é€ä¸€ä¸ªgetè¯·æ±‚</p>\n<pre><code>import axios from \"axios\"; \naxios\n    .get(\"/getData\")\n    .then((res) =&gt; {\n      console.log(res);\n      list.value = res.data.list;\n    })\n    .catch(function (error) {\n      // å¤„ç†é”™è¯¯æƒ…å†µ\n      console.log(error);\n    })\n    .then(function () {\n      // æ€»æ˜¯ä¼šæ‰§è¡Œ\n    });</code></pre>\n<blockquote>\n<p>æ”¯æŒå¼‚æ­¥æ“ä½œ async/awaitç”¨æ³•</p>\n</blockquote>\n<pre><code>const list = ref&lt;ListModel[]&gt;([]);\nasync function getUrl() {\n  const res = await axios.get(\"/getData\", {\n    params: {\n      id: 1, //éœ€è¦æºå¸¦å‚æ•°\n    },\n  });\n  list.value = res.data.list;\n}\ngetUrl();</code></pre>\n<p></p>\n<h3 id=\"2.2.2%C2%A0post%E8%AF%B7%E6%B1%82\">2.2.2 postè¯·æ±‚</h3>\n<p>å‘é€ä¸€ä¸ªpostè¯·æ±‚</p>\n<pre><code>function postUrl() {\n  axios\n    .post(\"/postData\", {\n      name: \"Fred\",\n      age: 18,\n    })\n    .then(function (response) {\n      console.log(response.data.message);\n    })\n    .catch(function (error) {\n      console.log(error);\n    });\n}\npostUrl();</code></pre>\n<p> å‘èµ·å¤šä¸ªå¹¶å‘è¯·æ±‚</p>\n<pre><code>// å‘é€å¤šä¸ªå¹¶å‘è¯·æ±‚\nfunction getUserInfo() {\n  return axios.get(\"/userInfo\");\n}\nfunction getToken() {\n  return axios.get(\"/getToken\");\n}\n//åŒæ­¥\nPromise.all([getUserInfo(), getToken()]).then((res) =&gt; {\n  console.log(res, \"res\");\n});\n//å¼‚æ­¥\nPromise.race([getUserInfo(), getToken()]).then((res) =&gt; {\n  console.log(res, \"res1111\");\n});</code></pre>\n<h1 id=\"3.%E9%85%8D%E7%BD%AE\">3.é…ç½®</h1>\n<h2 id=\"3.1%E8%AF%AD%E6%B3%95\">3.1è¯­æ³•</h2>\n<p>axios(config)</p>\n<blockquote>\n<p>// å‘èµ·ä¸€ä¸ªpostè¯·æ±‚</p>\n<p>axios({ method: 'post', url: '/user/12345', data: { firstName: 'Fred', lastName: 'Flintstone' } });</p>\n</blockquote>\n<p>é»˜è®¤è¯·æ±‚æ–¹å¼ï¼š</p>\n<p>// å‘èµ·ä¸€ä¸ª GET è¯·æ±‚ (é»˜è®¤è¯·æ±‚æ–¹å¼) axios('/user/12345');</p>\n<h2 id=\"3.2%E5%88%AB%E5%90%8D%C2%A0\">3.2åˆ«å </h2>\n<p>axios.request(config)</p>\n<h1 id=\"4.Axios%E5%AE%9E%E4%BE%8B\">4.Axioså®ä¾‹</h1>\n<h2 id=\"4.1%E8%AF%AD%E6%B3%95\">4.1è¯­æ³•</h2>\n<p>axios.create([config])</p>\n<pre><code>const instance = axios.create({\n  baseURL: 'https://some-domain.com/api/',\n  timeout: 1000,\n  headers: {'X-Custom-Header': 'foobar'}\n});</code></pre>\n<h2 id=\"4.2%E8%AF%B7%E6%B1%82%E9%85%8D%E7%BD%AE\">4.2è¯·æ±‚é…ç½®</h2>\n<p>è¿™äº›æ˜¯åˆ›å»ºè¯·æ±‚æ—¶å¯ä»¥ç”¨çš„é…ç½®é€‰é¡¹ã€‚åªæœ‰ <code>url</code> æ˜¯å¿…éœ€çš„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š <code>method</code>ï¼Œè¯·æ±‚å°†é»˜è®¤ä½¿ç”¨ <code>GET</code> æ–¹æ³•ã€‚</p>\n<pre><code>{\n  // `url` æ˜¯ç”¨äºè¯·æ±‚çš„æœåŠ¡å™¨ URL\n  url: '/user',\n\n  // `method` æ˜¯åˆ›å»ºè¯·æ±‚æ—¶ä½¿ç”¨çš„æ–¹æ³•\n  method: 'get', // é»˜è®¤å€¼\n\n  // `baseURL` å°†è‡ªåŠ¨åŠ åœ¨ `url` å‰é¢ï¼Œé™¤é `url` æ˜¯ä¸€ä¸ªç»å¯¹ URLã€‚\n  // å®ƒå¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ª `baseURL` ä¾¿äºä¸º axios å®ä¾‹çš„æ–¹æ³•ä¼ é€’ç›¸å¯¹ URL\n  baseURL: 'https://some-domain.com/api/',\n\n  // `transformRequest` å…è®¸åœ¨å‘æœåŠ¡å™¨å‘é€å‰ï¼Œä¿®æ”¹è¯·æ±‚æ•°æ®\n  // å®ƒåªèƒ½ç”¨äº 'PUT', 'POST' å’Œ 'PATCH' è¿™å‡ ä¸ªè¯·æ±‚æ–¹æ³•\n  // æ•°ç»„ä¸­æœ€åä¸€ä¸ªå‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ ä¸€ä¸ªBufferå®ä¾‹ï¼ŒArrayBufferï¼ŒFormDataï¼Œæˆ– Stream\n  // ä½ å¯ä»¥ä¿®æ”¹è¯·æ±‚å¤´ã€‚\n  transformRequest: [function (data, headers) {\n    // å¯¹å‘é€çš„ data è¿›è¡Œä»»æ„è½¬æ¢å¤„ç†\n\n    return data;\n  }],\n\n  // `transformResponse` åœ¨ä¼ é€’ç»™ then/catch å‰ï¼Œå…è®¸ä¿®æ”¹å“åº”æ•°æ®\n  transformResponse: [function (data) {\n    // å¯¹æ¥æ”¶çš„ data è¿›è¡Œä»»æ„è½¬æ¢å¤„ç†\n\n    return data;\n  }],\n\n  // è‡ªå®šä¹‰è¯·æ±‚å¤´\n  headers: {'X-Requested-With': 'XMLHttpRequest'},\n\n  // `params` æ˜¯ä¸è¯·æ±‚ä¸€èµ·å‘é€çš„ URL å‚æ•°\n  // å¿…é¡»æ˜¯ä¸€ä¸ªç®€å•å¯¹è±¡æˆ– URLSearchParams å¯¹è±¡\n  params: {\n    ID: 12345\n  },\n\n  // `data` æ˜¯ä½œä¸ºè¯·æ±‚ä½“è¢«å‘é€çš„æ•°æ®\n  // ä»…é€‚ç”¨ 'PUT', 'POST', 'DELETE å’Œ 'PATCH' è¯·æ±‚æ–¹æ³•\n  // åœ¨æ²¡æœ‰è®¾ç½® `transformRequest` æ—¶ï¼Œåˆ™å¿…é¡»æ˜¯ä»¥ä¸‹ç±»å‹ä¹‹ä¸€:\n  // - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams\n  // - æµè§ˆå™¨ä¸“å±: FormData, File, Blob\n  // - Node ä¸“å±: Stream, Buffer\n  data: {\n    firstName: 'Fred'\n  },\n  \n  // `timeout` æŒ‡å®šè¯·æ±‚è¶…æ—¶çš„æ¯«ç§’æ•°ã€‚\n  // å¦‚æœè¯·æ±‚æ—¶é—´è¶…è¿‡ `timeout` çš„å€¼ï¼Œåˆ™è¯·æ±‚ä¼šè¢«ä¸­æ–­\n  timeout: 1000, // é»˜è®¤å€¼æ˜¯ `0` (æ°¸ä¸è¶…æ—¶)\n\n  // `withCredentials` è¡¨ç¤ºè·¨åŸŸè¯·æ±‚æ—¶æ˜¯å¦éœ€è¦ä½¿ç”¨å‡­è¯\n  withCredentials: false, // default\n\n\n  // `auth` HTTP Basic Auth\n  auth: {\n    username: 'janedoe',\n    password: 's00pers3cret'\n  },\n\n  // `responseType` è¡¨ç¤ºæµè§ˆå™¨å°†è¦å“åº”çš„æ•°æ®ç±»å‹\n  // é€‰é¡¹åŒ…æ‹¬: 'arraybuffer', 'document', 'json', 'text', 'stream'\n  // æµè§ˆå™¨ä¸“å±ï¼š'blob'\n  responseType: 'json', // é»˜è®¤å€¼\n\n  // `responseEncoding` è¡¨ç¤ºç”¨äºè§£ç å“åº”çš„ç¼–ç  (Node.js ä¸“å±)\n  // æ³¨æ„ï¼šå¿½ç•¥ `responseType` çš„å€¼ä¸º 'stream'ï¼Œæˆ–è€…æ˜¯å®¢æˆ·ç«¯è¯·æ±‚\n  // Note: Ignored for `responseType` of 'stream' or client-side requests\n  responseEncoding: 'utf8', // é»˜è®¤å€¼\n\n  // `xsrfCookieName` æ˜¯ xsrf token çš„å€¼ï¼Œè¢«ç”¨ä½œ cookie çš„åç§°\n  xsrfCookieName: 'XSRF-TOKEN', // é»˜è®¤å€¼\n\n  // `xsrfHeaderName` æ˜¯å¸¦æœ‰ xsrf token å€¼çš„http è¯·æ±‚å¤´åç§°\n  xsrfHeaderName: 'X-XSRF-TOKEN', // é»˜è®¤å€¼\n\n  // `onUploadProgress` å…è®¸ä¸ºä¸Šä¼ å¤„ç†è¿›åº¦äº‹ä»¶\n  // æµè§ˆå™¨ä¸“å±\n  onUploadProgress: function (progressEvent) {\n    // å¤„ç†åŸç”Ÿè¿›åº¦äº‹ä»¶\n  },\n\n  // `onDownloadProgress` å…è®¸ä¸ºä¸‹è½½å¤„ç†è¿›åº¦äº‹ä»¶\n  // æµè§ˆå™¨ä¸“å±\n  onDownloadProgress: function (progressEvent) {\n    // å¤„ç†åŸç”Ÿè¿›åº¦äº‹ä»¶\n  },\n\n  // `maxContentLength` å®šä¹‰äº†node.jsä¸­å…è®¸çš„HTTPå“åº”å†…å®¹çš„æœ€å¤§å­—èŠ‚æ•°\n  maxContentLength: 2000,\n\n  // `maxBodyLength`ï¼ˆä»…Nodeï¼‰å®šä¹‰å…è®¸çš„httpè¯·æ±‚å†…å®¹çš„æœ€å¤§å­—èŠ‚æ•°\n  maxBodyLength: 2000,\n\n  // `validateStatus` å®šä¹‰äº†å¯¹äºç»™å®šçš„ HTTPçŠ¶æ€ç æ˜¯ resolve è¿˜æ˜¯ reject promiseã€‚\n  // å¦‚æœ `validateStatus` è¿”å› `true` (æˆ–è€…è®¾ç½®ä¸º `null` æˆ– `undefined`)ï¼Œ\n  // åˆ™promise å°†ä¼š resolvedï¼Œå¦åˆ™æ˜¯ rejectedã€‚\n  validateStatus: function (status) {\n    return status &gt;= 200 &amp;&amp; status &lt; 300; // é»˜è®¤å€¼\n  },\n\n  // `maxRedirects` å®šä¹‰äº†åœ¨node.jsä¸­è¦éµå¾ªçš„æœ€å¤§é‡å®šå‘æ•°ã€‚\n  // å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡Œé‡å®šå‘\n  maxRedirects: 5, // é»˜è®¤å€¼\n\n  // `proxy` å®šä¹‰äº†ä»£ç†æœåŠ¡å™¨çš„ä¸»æœºåï¼Œç«¯å£å’Œåè®®ã€‚\n  // æ‚¨å¯ä»¥ä½¿ç”¨å¸¸è§„çš„`http_proxy` å’Œ `https_proxy` ç¯å¢ƒå˜é‡ã€‚\n  // ä½¿ç”¨ `false` å¯ä»¥ç¦ç”¨ä»£ç†åŠŸèƒ½ï¼ŒåŒæ—¶ç¯å¢ƒå˜é‡ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚\n  // `auth`è¡¨ç¤ºåº”ä½¿ç”¨HTTP Basic authè¿æ¥åˆ°ä»£ç†ï¼Œå¹¶ä¸”æä¾›å‡­æ®ã€‚\n  // è¿™å°†è®¾ç½®ä¸€ä¸ª `Proxy-Authorization` è¯·æ±‚å¤´ï¼Œå®ƒä¼šè¦†ç›– `headers` ä¸­å·²å­˜åœ¨çš„è‡ªå®šä¹‰ `Proxy-Authorization` è¯·æ±‚å¤´ã€‚\n  // å¦‚æœä»£ç†æœåŠ¡å™¨ä½¿ç”¨ HTTPSï¼Œåˆ™å¿…é¡»è®¾ç½® protocol ä¸º`https`\n  proxy: {\n    protocol: 'https',\n    host: '127.0.0.1',\n    port: 9000,\n    auth: {\n      username: 'mikeymike',\n      password: 'rapunz3l'\n    }\n  },\n\n  // see https://axios-http.com/zh/docs/cancellation\n  cancelToken: new CancelToken(function (cancel) {\n  }),\n\n}</code></pre>\n<h2 id=\"4.3%E5%93%8D%E5%BA%94%E7%9A%84%E9%85%8D%E7%BD%AE\">4.3å“åº”çš„é…ç½®</h2>\n<p>ä¸€ä¸ªè¯·æ±‚çš„å“åº”åŒ…å«ä»¥ä¸‹ä¿¡æ¯</p>\n<pre><code>{\n  // `data` ç”±æœåŠ¡å™¨æä¾›çš„å“åº”\n  data: {},\n\n  // `status` æ¥è‡ªæœåŠ¡å™¨å“åº”çš„ HTTP çŠ¶æ€ç \n  status: 200,\n\n  // `statusText` æ¥è‡ªæœåŠ¡å™¨å“åº”çš„ HTTP çŠ¶æ€ä¿¡æ¯\n  statusText: 'OK',\n\n  // `headers` æ˜¯æœåŠ¡å™¨å“åº”å¤´\n  // æ‰€æœ‰çš„ header åç§°éƒ½æ˜¯å°å†™ï¼Œè€Œä¸”å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·è¯­æ³•è®¿é—®\n  // ä¾‹å¦‚: `response.headers['content-type']`\n  headers: {},\n\n  // `config` æ˜¯ `axios` è¯·æ±‚çš„é…ç½®ä¿¡æ¯\n  config: {},\n\n  // `request` æ˜¯ç”Ÿæˆæ­¤å“åº”çš„è¯·æ±‚\n  // åœ¨node.jsä¸­å®ƒæ˜¯æœ€åä¸€ä¸ªClientRequestå®ä¾‹ (in redirects)ï¼Œ\n  // åœ¨æµè§ˆå™¨ä¸­åˆ™æ˜¯ XMLHttpRequest å®ä¾‹\n  request: {}\n}</code></pre>\n<h3 id=\"pei-zhi-de-you-xian-ji\">é…ç½®çš„ä¼˜å…ˆçº§</h3>\n<p>é…ç½®å°†ä¼šæŒ‰ä¼˜å…ˆçº§è¿›è¡Œåˆå¹¶ã€‚å®ƒçš„é¡ºåºæ˜¯ï¼šåœ¨<a href=\"https://github.com/axios/axios/blob/master/lib/defaults.js#L28\" title=\"lib/defaults.js\">lib/defaults.js</a>ä¸­æ‰¾åˆ°çš„åº“é»˜è®¤å€¼ï¼Œç„¶åæ˜¯å®ä¾‹çš„ <code>defaults</code> å±æ€§ï¼Œæœ€åæ˜¯è¯·æ±‚çš„ <code>config</code> å‚æ•°ã€‚åé¢çš„ä¼˜å…ˆçº§è¦é«˜äºå‰é¢çš„ã€‚ä¸‹é¢æœ‰ä¸€ä¸ªä¾‹å­ã€‚</p>\n<pre><code>// ä½¿ç”¨åº“æä¾›çš„é»˜è®¤é…ç½®åˆ›å»ºå®ä¾‹\n// æ­¤æ—¶è¶…æ—¶é…ç½®çš„é»˜è®¤å€¼æ˜¯ `0`\nconst instance = axios.create();\n\n// é‡å†™åº“çš„è¶…æ—¶é»˜è®¤å€¼\n// ç°åœ¨ï¼Œæ‰€æœ‰ä½¿ç”¨æ­¤å®ä¾‹çš„è¯·æ±‚éƒ½å°†ç­‰å¾…2.5ç§’ï¼Œç„¶åæ‰ä¼šè¶…æ—¶\ninstance.defaults.timeout = 2500;\n\n// é‡å†™æ­¤è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œå› ä¸ºè¯¥è¯·æ±‚éœ€è¦å¾ˆé•¿æ—¶é—´\ninstance.get('/longRequest', {\n  timeout: 5000\n});</code></pre>\n<h1 id=\"5.%E6%8B%A6%E6%88%AA%E5%99%A8\">5.æ‹¦æˆªå™¨</h1>\n<p>åœ¨è¯·æ±‚æˆ–å“åº”è¢« then æˆ– catch å¤„ç†å‰æ‹¦æˆªå®ƒä»¬ã€‚</p>\n<pre><code>// ç”Ÿæˆå®ä¾‹\nconst instance = axios.create({\n  baseURL: \"/\",\n  timeout: 1000,\n  headers: { \"Content-Type\": \"multipart/form-data;charset=utf-8\" },\n});\n// è¯·æ±‚çš„æ‹¦æˆªå™¨\ninstance.interceptors.request.use(\n  function (config) {\n    // åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ\n    console.log(config, \"config\");\n    return config;\n  },\n  function (error) {\n    // å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ\n    return Promise.reject(error);\n  }\n);\n// è¿”å›çš„æ‹¦æˆªå™¨\ninstance.interceptors.response.use(\n  function (res) {\n    // 2xx èŒƒå›´å†…çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘è¯¥å‡½æ•°ã€‚\n    // å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆ\n    console.log(res, \"res\");\n\n    return res;\n  },\n  function (error) {\n    // è¶…å‡º 2xx èŒƒå›´çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘è¯¥å‡½æ•°ã€‚\n    // å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ\n    return Promise.reject(error);\n  }\n);</code></pre>\n<h1 id=\"6.%E9%94%99%E8%AF%AF%E6%8B%A6%E6%88%AA\">6.é”™è¯¯æ‹¦æˆª</h1>\n<pre><code>axios.get('/getData')\n  .catch(function (error) {\n    if (error.response) {\n      // è¯·æ±‚æˆåŠŸå‘å‡ºä¸”æœåŠ¡å™¨ä¹Ÿå“åº”äº†çŠ¶æ€ç ï¼Œä½†çŠ¶æ€ä»£ç è¶…å‡ºäº† 2xx çš„èŒƒå›´\n      console.log(error.response.data);\n      console.log(error.response.status);\n      console.log(error.response.headers);\n    } else if (error.request) {\n      // è¯·æ±‚å·²ç»æˆåŠŸå‘èµ·ï¼Œä½†æ²¡æœ‰æ”¶åˆ°å“åº”\n      // `error.request` åœ¨æµè§ˆå™¨ä¸­æ˜¯ XMLHttpRequest çš„å®ä¾‹ï¼Œ\n      // è€Œåœ¨node.jsä¸­æ˜¯ http.ClientRequest çš„å®ä¾‹\n      console.log(error.request);\n    } else {\n      // å‘é€è¯·æ±‚æ—¶å‡ºäº†ç‚¹é—®é¢˜\n      console.log('Error', error.message);\n    }\n    console.log(error.config);\n  });\n</code></pre>\n<p>ä½¿ç”¨ <code>validateStatus</code> é…ç½®é€‰é¡¹ï¼Œå¯ä»¥è‡ªå®šä¹‰æŠ›å‡ºé”™è¯¯çš„ HTTP codeã€‚</p>\n<pre><code>axios.get('/getData', {\n  validateStatus: function (status) {\n    return status &lt; 500; // å¤„ç†çŠ¶æ€ç å°äº500çš„æƒ…å†µ\n  }\n})\n</code></pre>\n<p>ä½¿ç”¨ <code>toJSON</code> å¯ä»¥è·å–æ›´å¤šå…³äºHTTPé”™è¯¯çš„ä¿¡æ¯ã€‚</p>\n<pre><code>axios.get('/getData')\n  .catch(function (error) {\n    console.log(error.toJSON());\n  });</code></pre>\n<h1 id=\"%C2%A07%EF%BC%8C%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82\"> 7.å–æ¶ˆè¯·æ±‚</h1>\n<p>ä»v0.22.0ä»¥åï¼ŒCancelTokenå–æ¶ˆè¯·æ±‚çš„æ–¹å¼è¢«å¼ƒç”¨ï¼ŒAxios æ”¯æŒä»¥ fetch API æ–¹å¼â€”â€” <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/AbortController\" title=\"AbortController\">AbortController</a> å–æ¶ˆè¯·æ±‚ï¼š</p>\n<pre><code>const controller = new AbortController();\n\naxios.get('/getData', {\n   signal: controller.signal\n}).then(function(response) {\n   //...\n});\n// å–æ¶ˆè¯·æ±‚\ncontroller.abort()</code></pre>\n<h1 id=\"8.%E5%AE%8C%E6%95%B4%E5%B0%81%E8%A3%85%C2%A0\">8.å®Œæ•´å°è£… </h1>\n<ol><li>å»ºç«‹http.tsæ–‡ä»¶</li><li> ç¼–å†™clas Httpç±»</li></ol>\n<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œäº²è‡ªæµ‹è¯•é€šè¿‡ï¼š<img alt=\"\" height=\"338\" src=\"image\\e3b9bfee5d45450abc7e1e29ac59cad3.png\" width=\"970\"/></p>\n<p>http.tsæ–‡ä»¶å…¨éƒ¨ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code>import type { AxiosInstance, AxiosRequestConfig } from \"axios\";\nimport axios from \"axios\";\n\nclass Http {\n  private readonly options: AxiosRequestConfig;\n  private axiosInstance: AxiosInstance;\n\n  // æ„é€ å‡½æ•° å‚æ•° options\n  constructor(params: AxiosRequestConfig) {\n    this.options = params;\n    this.axiosInstance = axios.create(params); // ç”Ÿæˆå®ä¾‹\n    this.setupInterceptors();\n  }\n  private setupInterceptors() {\n    this.axiosInstance.defaults.baseURL = \"/\";\n    this.axiosInstance.defaults.headers.post[\"Content-Type\"] =\n      \"application/json\";\n    this.axiosInstance.interceptors.request.use(\n      (config) =&gt; {\n        if (!config.headers) {\n          config.headers = {};\n        }\n        // config.headers.Authorization = CSRF_TOKEN;\n        return config;\n      },\n      () =&gt; {\n        return Promise.reject({\n          code: 1,\n          message: \"è¯·æ±‚é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜\",\n        });\n      }\n    );\n\n    this.axiosInstance.interceptors.response.use(\n      (response) =&gt; {\n        return Promise.resolve(response);\n      },\n      (error) =&gt; {\n        let message = \"\";\n        if (error.response) {\n          switch (error.response.status) {\n            case 2:\n              message = \"æœªç™»å½•ï¼Œç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µé¢\";\n              break;\n            case 3:\n              message = \"TOKENè¿‡æœŸï¼Œæ‹’ç»è®¿é—®ï¼Œç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µé¢\";\n              break;\n            case 4:\n              message = \"è¯·æ±‚è·¯å¾„é”™è¯¯\";\n              break;\n            case 5:\n              message = \"ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»ç®¡ç†å‘˜\";\n              break;\n            default:\n              message = \"æœªçŸ¥é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜\";\n              break;\n          }\n        } else {\n          if (error.code &amp;&amp; error.code == \"ECONNABORTED\") {\n            message = \"è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘æ˜¯å¦æ­£å¸¸\";\n          } else {\n            message = \"æœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åå†è¯•\";\n          }\n        }\n        return Promise.reject({\n          code: -1,\n          message: message,\n        });\n      }\n    );\n  }\n  /**\n   * Http get\n   * @param url è¯·æ±‚è·¯å¾„\n   * @param config é…ç½®ä¿¡æ¯\n   * @returns Promise\n   */\n  get(url: string, config?: any): Promise&lt;any&gt; {\n    return new Promise((resolve, reject) =&gt; {\n      this.axiosInstance\n        .get(url, config)\n        .then((response) =&gt; {\n          resolve(response.data);\n        })\n        .catch((error) =&gt; {\n          reject(error);\n        });\n    });\n  }\n  /**\n   * Http post\n   * @param url è¯·æ±‚è·¯å¾„\n   * @param data è¯·æ±‚æ•°æ®\n   * @param config é…ç½®\n   * @returns Promise\n   */\n  post(url: string, data?: any, config?: any): Promise&lt;any&gt; {\n    return new Promise((reslove, reject) =&gt; {\n      this.axiosInstance\n        .post(url, data, config)\n        .then((response) =&gt; {\n          reslove(response.data);\n        })\n        .catch((error) =&gt; {\n          reject(error);\n        });\n    });\n  }\n}\nconst http = new Http({\n  timeout: 1000 * 5,\n});\nexport default http;\n</code></pre>\n<h1 id=\"9.%E6%80%BB%E7%BB%93\">9.æ€»ç»“</h1>\n<p>ä¸ªäººç»è¿‡vue3é¡¹ç›®å®è·µï¼Œé…åˆmockæ•°æ®ï¼Œä½¿ç”¨axiosè¯·æ±‚åŸºæœ¬æ»¡è¶³å‰ç«¯æ—¥å¸¸å¼€å‘çš„è¯·æ±‚æ–¹å¼ï¼Œè‡³äºæ–‡ä»¶ä¸Šä¼ ï¼Œä¸‹è½½è¯·æ±‚ï¼Œåªéœ€è¦ä¿®æ”¹è¯·æ±‚ç±»å‹ç¬¦åˆå‰åç«¯è”è°ƒçš„åŠŸèƒ½å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå¯¹äºç¯å¢ƒçš„é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨base_urlä¸Šé¢ä¿®æ”¹æŒ‡å®šçš„åŸŸåç¯å¢ƒï¼Œè¿™ç§å¯ä»¥åšæˆé…ç½®é¡¹ï¼Œæ¯”å¦‚åœ¨process.env.NODE_ENVå¡«å†™ç¯å¢ƒé…ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘å°†é…åˆhttpçš„è¯·æ±‚æ–¹å¼è¯¦ç»†è®²è§£ç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹ï¼Œè°¢è°¢å¤§å®¶çš„æ”¯æŒï¼Œç å­—ä¸æ˜“ï¼Œå¸Œæœ›å¤šå¤šä¸‰è¿æ”¯æŒğŸ’—ğŸ’—ğŸ’—</p>\n</div>\n</div>"}