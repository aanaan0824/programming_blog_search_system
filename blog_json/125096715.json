{"blogid": "125096715", "writerAge": "码龄14年", "writerBlogNum": "389", "writerCollect": "2576", "writerComment": "225", "writerFan": "16383", "writerGrade": "6级", "writerIntegral": "5324", "writerName": "恒悦sunsite", "writerProfileAdress": "writer_image\\profile_125096715.jpg", "writerRankTotal": "2789", "writerRankWeekly": "611", "writerThumb": "451", "writerVisitNum": "865318", "blog_read_count": "2926", "blog_time": "于 2022-06-27 15:41:29 发布", "blog_title": "Linux之python版本升级", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"_0\"></a>一、前言</h1>\n<p>  升级glibc的时候根据INSTALL升级说明，要求python版本3.4以上。所以需要对python版本进行升级。centos7默认安装的python版本为2.7.5，python通过yum安装也只能安装2.7.5版本，python3可以通过yum安装3.6.8版本。如果需要更高的版本，只能通过源码编译安装。此博文介绍源码安装方式升级python和python3版本，源码编译安装要求操作系统已经安装了gcc。环境说明如下：</p>\n<ul><li>操作系统：centos7.6</li><li>python版本：升级前版本2.7.5，升级后2.7.18</li><li>python3版本：升级前3.6.8，升级后版本3.8.8</li></ul>\n<h1><a id=\"python_5\"></a>二、python安装步骤</h1>\n<h2><a id=\"1python_6\"></a>1、查看当前python版本</h2>\n<blockquote>\n<p>[root@s143 ~]# python -V<br/> Python 2.7.5</p>\n</blockquote>\n<h2><a id=\"2yumpython_9\"></a>2、yum安装python</h2>\n<blockquote>\n<p>[root@s143 ~]# yum install -y python2<br/> Loaded plugins: fastestmirror<br/> Loading mirror speeds from cached hostfile<br/> * base: mirrors.aliyun.com<br/> * extras: mirrors.aliyun.com<br/> * updates: mirrors.aliyun.com<br/> Package python-2.7.5-90.el7.x86_64 already installed and latest version<br/> Nothing to do</p>\n</blockquote>\n<h2><a id=\"3yumpython3_18\"></a>3、yum安装python3</h2>\n<blockquote>\n<p>[root@s143 ~]# yum install -y python3<br/> Loaded plugins: fastestmirror<br/> Loading mirror speeds from cached hostfile<br/> Installed:<br/> python3.x86_64 0:3.6.8-18.el7<br/> <br/> Dependency Installed:<br/> libtirpc.x86_64 0:0.2.4-0.16.el7 python3-libs.x86_64 0:3.6.8-18.el7 python3-pip.noarch 0:9.0.3-8.el7 python3-setuptools.noarch 0:39.2.0-10.el7<br/> <br/> Complete!</p>\n</blockquote>\n<h1><a id=\"python2_29\"></a>三、python2升级步骤</h1>\n<h2><a id=\"0_30\"></a>0、查找需要升级的版本</h2>\n<p>python官网（包括python和python3所有的版本）查找需要安装或者升级的版本。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\b43795be3875425c9ae6c6c161e9894a.png\"/></p>\n<h2><a id=\"1python_34\"></a>1、下载python新版本</h2>\n<blockquote>\n<p>[root@s143 opt]# wget https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz</p>\n</blockquote>\n<h2><a id=\"2_36\"></a>2、解压软件包</h2>\n<blockquote>\n<p>[root@s143 opt]# tar -zxvf Python-2.7.18.tgz</p>\n</blockquote>\n<h2><a id=\"3_38\"></a>3、预编译软件包</h2>\n<blockquote>\n<p>[root@s143 opt]# cd Python-2.7.18<br/> [root@s143 Python-2.7.18]# ./configure --prefix=/usr</p>\n</blockquote>\n<h2><a id=\"4_41\"></a>4、编译软件包</h2>\n<blockquote>\n<p>[root@s143 Python-2.7.18]# make<br/> …<br/> running build_scripts<br/> creating build/scripts-2.7<br/> copying and adjusting /opt/Python-2.7.18/Tools/scripts/pydoc -&gt; build/scripts-2.7<br/> copying and adjusting /opt/Python-2.7.18/Tools/scripts/idle -&gt; build/scripts-2.7<br/> copying and adjusting /opt/Python-2.7.18/Tools/scripts/2to3 -&gt; build/scripts-2.7<br/> copying and adjusting /opt/Python-2.7.18/Lib/smtpd.py -&gt; build/scripts-2.7<br/> changing mode of build/scripts-2.7/pydoc from 644 to 755<br/> changing mode of build/scripts-2.7/idle from 644 to 755<br/> changing mode of build/scripts-2.7/2to3 from 644 to 755<br/> changing mode of build/scripts-2.7/smtpd.py from 644 to 755<br/> /usr/bin/install -c -m 644 ./Tools/gdb/libpython.py python-gdb.py</p>\n</blockquote>\n<h2><a id=\"5_55\"></a>5、安装软件包</h2>\n<blockquote>\n<p>[root@s143 Python-2.7.18]# make install</p>\n</blockquote>\n<h2><a id=\"6_57\"></a>6、检查升级后的版本</h2>\n<blockquote>\n<p>[root@s143 Python-2.7.18]# python -V<br/> Python 2.7.18</p>\n</blockquote>\n<h1><a id=\"python3_60\"></a>四、python3升级步骤</h1>\n<h2><a id=\"1_61\"></a>1、下载安装包</h2>\n<blockquote>\n<p>[root@s143 opt]# wget https://www.python.org/ftp/python/3.8.8/Python-3.8.8.tgz</p>\n</blockquote>\n<h2><a id=\"2_63\"></a>2、解压软件包</h2>\n<blockquote>\n<p>[root@s143 opt]# tar -zxvf Python-3.8.8.tgz</p>\n</blockquote>\n<h2><a id=\"3_65\"></a>3、预编译</h2>\n<p>注意在编译结束后会有提示\"If you want a release build with all stable optimizations active (PGO, etc),please run ./configure --enable-optimizations\"，加上–enable-optimizations预编译的话后续编译会报错“Could not import runpy module ”，原因是gcc版本太低，enable-optimizations参数要求gcc版本8.1.0以上。</p>\n<blockquote>\n<p>[root@s143 opt]# cd Python-3.8.8<br/> [root@s143 Python-3.8.8]# ./configure</p>\n</blockquote>\n<h2><a id=\"4_69\"></a>4、编译</h2>\n<blockquote>\n<p>[root@s143 Python-3.8.8]# make<br/> …<br/> if test `uname -s` = Darwin; then <br/> cp python-config.py python-config; <br/> fi</p>\n</blockquote>\n<h2><a id=\"5_75\"></a>5、编译安装</h2>\n<blockquote>\n<p>[root@s143 Python-3.8.8]# make install<br/> …<br/> Collecting setuptools<br/> Collecting pip<br/> Installing collected packages: setuptools, pip<br/> Successfully installed pip-18.1 setuptools-40.6.2</p>\n</blockquote>\n<h2><a id=\"6_82\"></a>6、升级后版本检查</h2>\n<blockquote>\n<p>[root@s143 Python-3.6.10]# python3 -V<br/> Python 3.8.8</p>\n</blockquote>\n<h1><a id=\"QA_85\"></a>五、QA</h1>\n<h2><a id=\"1python388zlib_not_available_86\"></a>1、安装python3.8.8的时候报错zlib not available</h2>\n<ul><li>报错信息：zipimport.ZipImportError: can’t decompress data; zlib not available</li><li>报错原因：没有安装zlib模块</li><li>解决方案：安装zlib模块<br/> [root@s143 bin]# yum install -y zlib*</li></ul>\n<h2><a id=\"2pythonyumFile_usrbinyum_line_30_91\"></a>2、安装完python之后yum报错File “/usr/bin/yum”, line 30</h2>\n<ul><li>报错信息：File “/usr/bin/yum”, line 30<br/> <img alt=\"在这里插入图片描述\" src=\"image\\57cc959f71924fa589a41b87af3ff6ab.png\"/></li><li>报错原因：python软连接指向了python3版本，而yum要求python2版本。</li><li>解决方案1：修改python命令软连接到python2<br/> [root@s143 bin]# sln python2 python<br/> [root@s143 bin]# python -V<br/> Python 2.7.5</li><li>解决方案2：修改/usr/bin/yum文件，将python改为python2<br/> <img alt=\"在这里插入图片描述\" src=\"image\\2d3b4ddc2f784b3e8bf76d84e4dbf74a.png\"/></li></ul>\n<h2><a id=\"3pythonyumFile_usrlibexecurlgrabberextdown_line_28_102\"></a>3、安装完成python之后yum安装报错File “/usr/libexec/urlgrabber-ext-down”, line 28</h2>\n<ul><li>报错信息：File “/usr/libexec/urlgrabber-ext-down”, line 28</li><li>报错原因：yum下载程序依赖python2</li><li>解决方案1：修改python命令软连接到python2</li><li>解决方案2：修改/usr/libexec/urlgrabber-ext-down文件，将python改为python2<br/> <img alt=\"在这里插入图片描述\" src=\"image\\39bba277f54645c3b1b2c04c046498a6.png\"/></li></ul>\n<h2><a id=\"4python2718No_module_named_rpm_108\"></a>4、升级到python2.7.18后报错No module named rpm</h2>\n<ul><li>报错信息：There was a problem importing one of the Python modules required to run yum. The error leading to this problem was:<br/> No module named rpm<br/> <img alt=\"在这里插入图片描述\" src=\"image\\e6f3403854384561b4c197ecbee95b48.png\"/></li><li>报错原因：python2.7.18是python2的最新版本，已经移除了对yum的支持，centos8默认使用dnf软件包安装工具。</li><li>解决方案：从其他centos7服务器拷贝一个python2.7.5到服务器/usr/bin目录下，然后重建python软链接。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\70fd4f90085847f08a01421d8c5d5595.png\"/></li></ul>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}