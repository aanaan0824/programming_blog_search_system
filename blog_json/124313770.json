{"blogid": "124313770", "writerAge": "码龄10年", "writerBlogNum": "15", "writerCollect": "146", "writerComment": "39", "writerFan": "17", "writerGrade": "4级", "writerIntegral": "961", "writerName": "吱夏cz", "writerProfileAdress": "writer_image\\profile_124313770.jpg", "writerRankTotal": "22040", "writerRankWeekly": "35691", "writerThumb": "49", "writerVisitNum": "142679", "blog_read_count": "15131", "blog_time": "已于 2022-04-21 11:36:44 修改", "blog_title": "JS获取本机IP地址的方法", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1></h1>\n<p>1.获取本机IP地址方法1：</p>\n<p>if(typeof window != 'undefined'){<!-- --></p>\n<p>    var RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;</p>\n<p>    if (RTCPeerConnection) (()=&gt;{<!-- --></p>\n<p>        var rtc = new RTCPeerConnection()</p>\n<p>        rtc.createDataChannel(''); //创建一个可以发送任意数据的数据通道</p>\n<p>        rtc.createOffer( offerDesc =&gt; { //创建并存储一个sdp数据</p>\n<p>        rtc.setLocalDescription(offerDesc)</p>\n<p>    }, e =&gt; { console.log(e)})</p>\n<p>    rtc.onicecandidate =(evt) =&gt; { //监听candidate事件</p>\n<p>        if (evt.candidate) {<!-- --></p>\n<p>            console.log('evt:',evt.candidate)</p>\n<p>            let ip_rule = /([0-9]{1,3}(\\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/</p>\n<p>            var ip_addr = ip_rule.exec(evt.candidate.candidate)[1]</p>\n<p>            console.log('ip_addr:',ip_addr)   //打印获取的IP地址</p>\n<p>        }}</p>\n<p>    })()</p>\n<p>    else{console.log(\"没有找到\")}</p>\n<p>}</p>\n<p>2.获取本机IP地址方法2</p>\n<pre><code>   //获取用户本地ip的方法\nconst getUserIP= (onNewIP)=&gt; {\n  let MyPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;\n  let pc = new MyPeerConnection({\n    iceServers: []\n  });\n  let noop = () =&gt; {\n  };\n  let localIPs = {};\n  let ipRegex = /([0-9]{1,3}(\\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g;\n  let iterateIP = (ip) =&gt; {\n    if (!localIPs[ip]) onNewIP(ip);\n    localIPs[ip] = true;\n  };\n  pc.createDataChannel('');\n  pc.createOffer().then((sdp) =&gt; {\n    sdp.sdp.split('\\n').forEach(function (line) {\n      if (line.indexOf('candidate') &lt; 0) return;\n      line.match(ipRegex).forEach(iterateIP);\n    });\n    pc.setLocalDescription(sdp, noop, noop);\n  }).catch((reason) =&gt; {\n  });\n  pc.onicecandidate = (ice) =&gt; {\n    if (!ice || !ice.candidate || !ice.candidate.candidate || !ice.candidate.candidate.match(ipRegex)) return;\n    ice.candidate.candidate.match(ipRegex).forEach(iterateIP);\n  };\n}\n\n\n\n\n  getUserIP((ip) =&gt; {\n   state.ip=ip\n      console.log(ip)\n      console.log(state.ip)\n  });</code></pre>\n<p>如果电脑没获取到，基本上是因为浏览器限制了，解除方法如下：</p>\n<p>解决方案：</p>\n<ul><li>火狐(FireFox) 删除隐藏IP</li></ul>\n<p>浏览器输入 about:config</p>\n<p>搜索配置 media.peerconnection.enabled 改为false ( 刷新程序,IP正常显示 )</p>\n<ul><li>谷歌(Chrome) 删除隐藏IP</li></ul>\n<p>浏览器输入：chrome://flags/#enable-webrtc-hide-local-ips-with-mdns</p>\n<p>把 Anonymize local IPs exposed by WebRTC 设置为 disabled ( 刷新程序,IP正常显示 )</p>\n<ul><li>eage浏览器删除隐藏ip</li></ul>\n<p>浏览器输入: edge://flags/#enable-webrtc-hide-local-ips-with-mdns</p>\n<p>把 Anonymize local IPs exposed by WebRTC 设置为 disabled ( 刷新程序,IP正常显示 )</p>\n<p></p>\n</div>\n</div>"}