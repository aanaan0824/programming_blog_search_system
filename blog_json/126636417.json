{"blogid": "126636417", "writerAge": "码龄5年", "writerBlogNum": "101", "writerCollect": "1265", "writerComment": "51", "writerFan": "6415", "writerGrade": "5级", "writerIntegral": "3404", "writerName": "老王机器人", "writerProfileAdress": "writer_image\\profile_126636417.jpg", "writerRankTotal": "5739", "writerRankWeekly": "2431", "writerThumb": "204", "writerVisitNum": "236583", "blog_read_count": "101", "blog_time": "于 2022-09-06 08:06:59 发布", "blog_title": "ubuntu20.04搭建QGC4.2编译环境", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#_2\">前言</a></li><li><a href=\"#qt_6\">一、安装qt</a></li><li><a href=\"#QGC_34\">二、编译QGC</a></li><li><ul><li><a href=\"#_36\">安装依赖</a></li><li><a href=\"#GStreamer_42\">安装GStreamer</a></li></ul>\n</li><li><a href=\"#QGC_77\">三、编译安卓版QGC</a></li><li><ul><li><a href=\"#jdk11_79\">安装jdk11</a></li><li><a href=\"#Qt_creator_87\">配置Qt creator</a></li><li><a href=\"#_101\">配置手机</a></li><li><a href=\"#_136\">配置遥控器</a></li></ul>\n</li></ul>\n</div>\n<p></p>\n<h1><a id=\"_2\"></a>前言</h1>\n<p>Ubuntu20.04<br/> QGC 4.2<br/> ubuntu18.04也可以编译QGC4.2，但是由于GLBC版本较低，无法使用最新版的QTCreator，Ubuntu20.04可以使用最新版QTCreator。</p>\n<h1><a id=\"qt_6\"></a>一、安装qt</h1>\n<p>推荐使用在线安装，下载地址：<a href=\"https://download.qt.io/official_releases/online_installers/\">https://download.qt.io/official_releases/online_installers/</a></p>\n<p>我这里下载的是<code>qt-unified-linux-x64-4.4.1-online.run</code></p>\n<p>下载后添加可执行权限并双击运行，如果双击打不开这个软件，在该软件所在目录打开终端执行</p>\n<pre><code>./qt-unified-linux-x64-4.4.1-online.run \n</code></pre>\n<p>出现下面的报错：</p>\n<blockquote>\n<p>./qt-unified-linux-x64-4.4.1-online.run: error while loading shared<br/> libraries: libxcb-xinerama.so.0: cannot open shared object file: No<br/> such file or directory</p>\n</blockquote>\n<p>执行下面的命令解决：</p>\n<pre><code>sudo apt install --reinstall libxcb-xinerama0\n</code></pre>\n<p>执行完之后就可以打开安装程序，然后一直下一步。直到下面这页面，选择需要安装的qt版本，然后一直下一步安装，<strong>注意勾选LTS和Arhive，否则编译QGC时可能会报错</strong></p>\n<p><img alt=\"请添加图片描述\" src=\"image\\7beaea970a4b42a7a5f5d5d82fac8690.png\"/><br/> java.lang.NoClassDefFoundError: Could not initialize class org.codehaus.groovy.vmplugin.v7.Java7<br/> at org.codehaus.groovy.vmplugin.VMPluginFactory.(VMPluginFactory.java:43)<br/> at org.codehaus.groovy.reflection.GroovyClassValueFactory.(GroovyClassValueFactory.java:35)</p>\n<h1><a id=\"QGC_34\"></a>二、编译QGC</h1>\n<h2><a id=\"_36\"></a>安装依赖</h2>\n<pre><code>sudo apt-get install speech-dispatcher libudev-dev libsdl2-dev patchelf\n</code></pre>\n<h2><a id=\"GStreamer_42\"></a>安装GStreamer</h2>\n<p>GStreamer是视频相关的组件，如果不装的话虽然不影响编译，但编译出来的地面站会无法显示摄像头图像，如下：</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\17429c38cfd24fada636c39648a2aa19.png\"/><br/> 参考下面网址安装：<br/> <a href=\"https://github.com/mavlink/qgroundcontrol/blob/master/src/VideoReceiver/README.md\">https://github.com/mavlink/qgroundcontrol/blob/master/src/VideoReceiver/README.md</a><br/> 编译ubuntu地面站需要用下面命令安装</p>\n<pre><code>list=$(apt-cache --names-only search ^gstreamer1.0-* | awk '{ print $1 }' | sed -e /-doc/d | grep -v gstreamer1.0-hybris)\nsudo apt-get install $list\nsudo apt-get install libgstreamer-plugins-base1.0-dev\nsudo apt-get install libgstreamer-plugins-bad1.0-dev \n</code></pre>\n<p>编译安卓地面站需要下载gstreamer-1.0-android-universal-1.18.5.tar.xz<br/> 下载地址：<br/> 链接: https://pan.baidu.com/s/1DGqsdTKbFFl-erZZjzPHHQ 提取码: 3vsx<br/> –来自百度网盘超级会员v5的分享</p>\n<p>下载后在qgroundcontrol目录下解压，解压后<strong>清除重新编译地面站</strong>(不清除重新编译可能会报错)后即可编译出可以显示视频的安卓QGC:<img alt=\"在这里插入图片描述\" src=\"image\\ff8bc5b45da74965b0d4a2c7d91bce6d.png\"/><br/> 如果用qt5.15.2编译qgc4.2.0时出现下面的报错<br/> <img alt=\"在这里插入图片描述\" src=\"image\\31b7c6cfc2094f17b2911857e01ee197.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\5bfb0c1995894867a832d7500010f64a.png\"/><br/> 下载下面的压缩包并解压<br/> 链接: https://pan.baidu.com/s/1kFlph1IKEG8aqF4dqUrBSg 提取码: sq00<br/> –来自百度网盘超级会员v5的分享<br/> 将下面目录的中内容删除，并用压缩包里面的内容替换，然后重新编译即可<br/> <img alt=\"在这里插入图片描述\" src=\"image\\100b6fdc323a43b28d1c0b89510ffbc4.png\"/><br/> 编译完出现如下提示<br/> <img alt=\"在这里插入图片描述\" src=\"image\\20201009205507704.png\"/>执行</p>\n<pre><code class=\"prism language-c\">sudo usermod <span class=\"token operator\">-</span>a <span class=\"token operator\">-</span>G dialout $USER\nsudo apt<span class=\"token operator\">-</span>get remove modemmanager\n</code></pre>\n<p><strong>上面这两条命令后需要重启电脑，重启之后地面站才能连接飞控</strong></p>\n<h1><a id=\"QGC_77\"></a>三、编译安卓版QGC</h1>\n<h2><a id=\"jdk11_79\"></a>安装jdk11</h2>\n<p>笔者曾使用jdk18，编译会报错，这里建议安装jdk11</p>\n<pre><code>sudo apt-get install openjdk-11-jdk\n</code></pre>\n<h2><a id=\"Qt_creator_87\"></a>配置Qt creator</h2>\n<p>点击工具-&gt;外部-&gt;Configure<br/> <img alt=\"请添加图片描述\" src=\"image\\ec1fae36f9f4437a8c32a8d724ec5173.png\"/><br/> 打开设备那一栏，点击JDK location右边的浏览，<br/> <img alt=\"请添加图片描述\" src=\"image\\f38c1d3108b94452a314adb627960fdf.png\"/><br/> 选择下面的目录<br/> <img alt=\"请添加图片描述\" src=\"image\\2e20df17e79143938bb64cfaebe5db90.png\"/><br/> 然后点击Set up SDK，等待自动安装和配置，安装过程中所以的确认选项选是<br/> <img alt=\"请添加图片描述\" src=\"image\\1aed975a8f1d4aad9033006cb1dc76e9.png\"/><br/> 安装成功后如下图，正常的话OpenSSL是正常配置的，如果没有正常配置，点击右侧的Download OpenSSL进行配置，最后点击应用，然后点击确定。<br/> <img alt=\"请添加图片描述\" src=\"image\\0ae035723cd84e29ba77106e377fecde.png\"/><br/> QGC的AndroidManifest.xml设置成API31<br/> <img alt=\"在这里插入图片描述\" src=\"image\\448cdf183422402aab92b777e3d712ff.png\"/></p>\n<h2><a id=\"_101\"></a>配置手机</h2>\n<p>选择编译套件为安卓<br/> <img alt=\"请添加图片描述\" src=\"image\\f10108c87f7e42ca85a04261d8938342.png\"/><br/> 如果没有连接实体手机或者虚拟手机,手机图标右下角为红点<br/> <img alt=\"请添加图片描述\" src=\"image\\9806704e5a514a6bb473962487a6d22e.png\"/><br/> 这时在编译安卓版QGC时,会出现下图提示，需要连接手机设备。</p>\n<pre><code>10:06:46: The deployment device \"22041211AC\" is disconnected.\nError while building/deploying project qgroundcontrol (kit: Android Qt 5.15.2 Clang Multi-Abi)\nWhen executing step \"Deploy to Android device\"\n</code></pre>\n<p>笔者用实体手机测试,再测试前,需要对手机进行设置.<br/> 笔者所用手机为redme note8 pro 5G版.<br/> 设置-&gt;我的设备-&gt;全部参数<br/> 找到如下图所示\"MIUI版本\"连续点击6次,进入开发者模式.<br/> <img alt=\"在这里插入图片描述\" src=\"image\\1374ddbfa45b47c7bad6d2293b131a64.png\"/><br/> 然后点击设置-&gt;更多设置-&gt;开发者选项<br/> 授权以下三项.<br/> <img alt=\"在这里插入图片描述\" src=\"image\\b5326398beb2453e851f0c6763ceb4f3.png\"/><br/> 然后用USB线将手机连接至电脑,此时手机端会弹出下图提示,<strong>选择\"传输文件\"</strong><br/> <img alt=\"在这里插入图片描述\" src=\"image\\cb968f34ca51486197933323a8ee88f9.png\"/><br/> 设置好之后将手机通过USB连接电脑，正常的话电脑能识别到手机设备，在QT中将设备设置为手机，确认手机状态为Ready to use<br/> <img alt=\"请添加图片描述\" src=\"image\\832fe23fc1684ce4b01991b1c4100c55.png\"/>可以看到手机图标右下角变成了绿色，然后点击三角形编译<br/> <img alt=\"请添加图片描述\" src=\"image\\534f56360de5464b8de68effc144cb40.png\"/><br/> 如果手机图标右下角是黄色，状态为connected，<br/> <img alt=\"在这里插入图片描述\" src=\"image\\636d471613054557b64605ae78988cb4.png\"/><br/> 点击下图的Refresh即可变成绿色<br/> <img alt=\"在这里插入图片描述\" src=\"image\\580c383de27a40609d2e282425b43661.png\"/><br/> 编译后会自动安装QGC到手机，如果编译后出现下面的提示，原因是手机上已经安装了其他版本的QGC，可以卸载后再重新编译安装即可。<br/> <img alt=\"请添加图片描述\" src=\"image\\9742e95b9c9c4688ab531a192625f821.png\"/><br/> 编译过程中如果出现下面提示，选是即可<br/> <img alt=\"在这里插入图片描述\" src=\"image\\3ec576daa9ce49be8d40b20dacd019a6.png\"/></p>\n<h2><a id=\"_136\"></a>配置遥控器</h2>\n<p>如果想在带安卓系统的遥控器上安装地面站，设置方法和手机相似，以云卓H16遥控器为例，打开设置-&gt;开发者选项-&gt;使能USB调试<br/> <img alt=\"在这里插入图片描述\" src=\"image\\7304a3a678064cf9ae8f4e90d87be5ba.png\"/><br/> 选择USB配置为MTP<br/> <img alt=\"在这里插入图片描述\" src=\"image\\355e9b889f3342e5afa50b2247cbf601.png\"/><br/> 设置完成后电脑就可以识别到遥控器，选择遥控设备后就可以编译。<br/> <img alt=\"在这里插入图片描述\" src=\"image\\ce601f78f3cb459b82c539ba1c9901f4.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}