{"blogid": "125584670", "writerAge": "码龄6年", "writerBlogNum": "15", "writerCollect": "35", "writerComment": "2", "writerFan": "4", "writerGrade": "3级", "writerIntegral": "777", "writerName": "qq_37200336", "writerProfileAdress": "writer_image\\profile_125584670.jpg", "writerRankTotal": "26160", "writerRankWeekly": "83768", "writerThumb": "12", "writerVisitNum": "99291", "blog_read_count": "1421", "blog_time": "于 2022-07-03 15:53:27 发布", "blog_title": "MacBook(m1) 通过brew安装PHP环境", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>新买的mac本，记录一次从零开始安装运行环境。如果电脑没有默认安装则需要自己单独安装brew</p>\n<p></p>\n<h1><strong>一、安装 brew</strong>（可能会遇到问题，因此需要一个一个解决）</h1>\n<p><strong>1、安装javaSDK （可能需要javaSDK依赖 下载DMG安装程序 直接安装 没什么可说的）</strong></p>\n<p><a href=\"https://www.oracle.com/java/technologies/downloads/#java18\" title=\"Java Downloads | Oracle\">Java Downloads | Oracle</a></p>\n<p><strong>2、出现 Bad CPU type in executable 的解决办法</strong></p>\n<p>mac M1用的是arm架构，adb好像还没适配，M1运行x86的需要安装Rosetta2转译。安装完后一切正常。</p>\n<p>安装Rosetta2的命令。其实安装一个x86的应用，也会提示安装</p>\n<pre><code>softwareupdate --install-rosetta\n/usr/sbin/softwareupdate --install-rosetta --agree-to-license</code></pre>\n<p><strong>3、安装git  到官网下载安装即可</strong></p>\n<p><a href=\"https://git-scm.com/download/mac\" title=\"Git - Downloading Package\">Git - Downloading Package</a> </p>\n<p><strong>4、开始安装 brew  正常一条命令就解决 不过有可能很慢导致无法成功 因此需要修改hosts</strong></p>\n<p>1) 复制文件 /etc/hosts 到桌面</p>\n<p>2) 打开添加hosts添加如下信息</p>\n<p>（可根据 <a href=\"https://ipaddress.com/website/raw.githubusercontent.com\" title=\"https://ipaddress.com/website/raw.githubusercontent.com\">https://ipaddress.com/website/raw.githubusercontent.com</a> 查找ip）</p>\n<pre><code>185.199.108.133 raw.githubusercontent.com\n\n185.199.109.133 raw.githubusercontent.com\n\n185.199.110.133 raw.githubusercontent.com\n\n185.199.111.133 raw.githubusercontent.com\n\n#GitHub Start\n\n140.82.113.3 github.com\n\n140.82.114.4 github.com\n\n199.232.69.194 github.global.ssl.Fastly.net\n\n#GitHub End</code></pre>\n<p>3) 复制桌面的hosts 到 /etc 下</p>\n<p>4) 重启后 执行下面命令</p>\n<pre><code>​/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n</code></pre>\n<h3><span style=\"color:#fe2c24;\"><strong>如果以上还是安装不成， 下面来终极安装方法：</strong></span></h3>\n<p>1)、下载安装文件 如果出现433 就多试几次</p>\n<pre><code class=\"language-bash\">curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh &gt;&gt; brew_install</code></pre>\n<p>2)、打开下载的安装文件，替换git源 根据情况自己定</p>\n<p>网上说事替换关键字 BREW_REPO 的地址 但是我下载的安装文件没有这个关键字</p>\n<p>我的文件替换是这样的 替换成国内清华源</p>\n<p>关键字 HOMEBREW_BREW_DEFAULT_GIT_REMOTE 和 HOMEBREW_CORE_DEFAULT_GIT_REMOTE</p>\n<pre><code>HOMEBREW_BREW_DEFAULT_GIT_REMOTE=\"https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git\"\nHOMEBREW_CORE_DEFAULT_GIT_REMOTE=\"https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git\"</code></pre>\n<p>3)、执行脚本</p>\n<pre><code>sh brew_install</code></pre>\n<p>如果出现如下错误</p>\n<pre><code>brew_install: line 395: syntax error near unexpected token `('\nbrew_install: line 395: `  done &lt;&lt;(which -a \"$1\")'</code></pre>\n<p>把395行修改成 done &lt; &lt;(which -a \"$1\") 删除掉</p>\n<p>替换成 done &lt;&lt;&lt;`which -a \"$1\"` 保存退出</p>\n<p>在执行 sh brew_install</p>\n<p>出现 Installation successful! 表示成功</p>\n<p>4)、配置Homebrew  （下面是我自己的 执行下就ok了  根据自己最后安装成功后的提示运行命令！！！）</p>\n<pre><code> Next steps:\n- Run these two commands in your terminal to add Homebrew to your PATH:\necho 'eval \"$(/opt/homebrew/bin/brew shellenv)\"' &gt;&gt; /Users/zha****an/.zprofile\neval \"$(/opt/homebrew/bin/brew shellenv)\"</code></pre>\n<p>5)、测试一下</p>\n<pre><code>brew -v</code></pre>\n<p>6)、brew出现 fatal: Could not resolve HEAD to a revision 的解决办法</p>\n<p>第一步</p>\n<pre><code>brew update --verbose</code></pre>\n<p>第二步：解决报错<br/>  </p>\n<pre><code>cd /opt/homebrew/Library/Taps/homebrew/homebrew-core\n\ngit fetch --prune origin\n\ngit pull --rebase origin master</code></pre>\n<p>第三步：再次更新</p>\n<pre><code>brew update</code></pre>\n<p></p>\n<h1>二、安装运行环境 有了brew安装就非常简单了</h1>\n<p>1、安装composer</p>\n<pre><code>brew install composer</code></pre>\n<p>2、安装redis</p>\n<pre><code>brew install redis\nbrew services start redis\nredis-server\nredis-cli  -h 127.0.0.1 -p 6379</code></pre>\n<p>3、安装 nginx</p>\n<pre><code>brew install nginx</code></pre>\n<p>4、php 安装运行</p>\n<pre><code>brew install php@8.0</code></pre>\n<p>5、刷新php连接  </p>\n<pre><code>brew link php@8.0</code></pre>\n<p>6、查看php版本</p>\n<pre><code>php -v</code></pre>\n<p>7、查看安装的扩展</p>\n<pre><code>php -m</code></pre>\n<p>8、查看PHP的服务</p>\n<pre><code>brew services list</code></pre>\n<p>9、停止老的PHP版本，启用新的php版本</p>\n<pre><code>#停止\nbrew services stop php@7.2\n#启动\nbrew services start php@8.0</code></pre>\n<p>10、安装php扩展 pecl方式或手动</p>\n<pre><code>pecl install redis</code></pre>\n<p>1）缺少 igbinary 就安装</p>\n<pre><code>pecl install igbinary</code></pre>\n<p>2）报错 configure: error: Please reinstall the libzstd distribution </p>\n<p>就决办法</p>\n<pre><code>pecl install zstd\nbrew install zstd</code></pre>\n<p>如果安装不上可手动安装扩展（其他扩展一样的安装方式）</p>\n<pre><code># redis\n缺少igbinary 安装redis的扩展依赖\npecl install igbinary\n安装开始\npecl install https://pecl.php.net/get/redis-5.3.7.tgz\ncd /private/tmp/pear/download\nsudo tar -zxvf redis-5.3.7.tgz\nsudo mv redis-5.3.7.tgz redis\ncd redis\nsudo phpize\nsudo ./configure\nsudo make &amp;&amp; sudo make install\n\n# memcache\n需要zlib支持\nbrew install zlib\n安装开始\npecl install memcache\ncd /private/tmp/pear/download\nsudo tar -zxvf memcache-8.0.tgz\nsudo mv memcache-8.0.tgz memcache\ncd memcache\nsudo phpize\nsudo ./configure --with-zlib-dir=/opt/homebrew/Cellar/zlib/1.2.12/\nsudo make &amp;&amp; sudo make install\n\n# swoole\n需要openssl支持\nbrew install openssl\n开始安装\npecl install swoole\n1、缺少openssl/ssh.h时 添加 --with-openssl-dir \n或者 /opt/homebrew/Cellar/php/8.1.7/include/php/ext/swoole 创建软连接\nenable openssl support? [no] : yes --with-openssl-dir=/opt/homebrew/Cellar/openssl@3/3.0.3\n2、缺少pcre2.h时 创建软连接\nln -s /opt/homebrew/Cellar/pcre2/10.40/include/pcre2.h /opt/homebrew/Cellar/php/8.1.7/include/php/ext/pcre/pcre2.h\n</code></pre>\n<p>11、配置下php.ini</p>\n<pre><code>PHP -i | grep php.ini  查找位置\n在 /opt/homebrew/etc/php/8.1/conf.d 下创建 ext-redis.ini\n添加如下内容：\n[redis]\nextension=\"/opt/homebrew/Cellar/php/8.1.7/pecl/20210902/redis.so\"\n保存后重启php\nbrew service restart php\n查看是否安装成功\nphp -m | grep redis</code></pre>\n<p></p>\n</div>\n</div>"}