{"blogid": "125762260", "writerAge": "码龄2年", "writerBlogNum": "2", "writerCollect": "30", "writerComment": "48", "writerFan": "98", "writerGrade": "1级", "writerIntegral": "71", "writerName": "用猪头过日子.", "writerProfileAdress": "writer_image\\profile_125762260.jpg", "writerRankTotal": "117262", "writerRankWeekly": "1186694", "writerThumb": "19", "writerVisitNum": "3583", "blog_read_count": "2077", "blog_time": "已于 2022-07-13 15:41:31 修改", "blog_title": "用YOLOv5ds训练自己的数据集，注意点！", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>        这两天打算使用YOLOv5做一下实例分割，找到</p>\n<p><a href=\"https://blog.csdn.net/qq_57076285/article/details/124265887\" title=\"用YOLOv5ds训练自己的数据集——同时检测和分割_2021黑白灰的博客-CSDN博客_yolov5图像分割\">用YOLOv5ds训练自己的数据集——同时检测和分割_2021黑白灰的博客-CSDN博客_yolov5图像分割</a><br/><br/><a href=\"https://blog.csdn.net/IEEE_FELLOW/article/details/121912670\" title=\"Yolov5同时进行目标检测和分割分割_LeeCW2022的博客-CSDN博客_yolov5分割\">Yolov5同时进行目标检测和分割分割_LeeCW2022的博客-CSDN博客_yolov5分割</a></p>\n<p>这两篇文章当参考，但是中间的问题多多。</p>\n<hr/>\n<p>        首先，训练参数的设置，按照黑白灰大佬的参数设置大体上没错，但是会容易出现<strong><span style=\"color:#fe2c24;\">RuntimeError: weight tensor should be defined either for all or no classes</span></strong> 这个问题。</p>\n<p>        分析原因主要是分割头输入输出的类别数目不一样。那么我们就只用修改segheads.yaml里的segnc，为自己的类别数+1。<img alt=\"\" height=\"432\" src=\"image\\d65f37c0ded24dfab261f13a19a72f2c.png\" width=\"627\"/></p>\n<p>       </p>\n<p></p>\n<p>        同时，对于voc.yaml里面的类别数务必只改为自己的类别数，不能+1，<span style=\"background-color:#ff9900;\">里面的segnc也千万不能+1，因为+1后可以跑但是在detect的时候会超过类别索引</span>，导致预测不了！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！大家也不想大半段时间白跑把。报错为：<strong><span style=\"color:#fe2c24;\">IndexError: index 3 is out of bounds for axis 0 with size 3</span></strong>。</p>\n<p>       补充：在预测是还是报这个错，需要更改detectds.py中的颜色数量，数量需要加上1，所以更改115行为：<img alt=\"\" height=\"199\" src=\"image\\0367f05dd81c4418afe02e27baa2f280.png\" width=\"895\"/></p>\n<p> 接下来就可以进行分割的预测了。</p>\n<hr/>\n<p>        最后，在使用detectds.py文件进行预测时，如果出现</p>\n<p><strong><span style=\"color:#fe2c24;\">RuntimeError: Input type (torch.cuda.HalfTensor) and weight type (torch.HalfTensor)</span></strong>这一报错，原因是你输入模型的数据和模型的数据类型不一样，输入数据是cuda类型的，而模型不是cuda类型的。解决办法就是找到Load model的地方，也就是detectds.py的第103行开始，在model赋值一行下面补充model = model.cuda（），这样加载的模型就是cuda类型的了，就能顺利预测了。</p>\n<p><img alt=\"\" height=\"243\" src=\"image\\a71b1ad476b94d9a845fce04b93f9dd7.png\" width=\"668\"/></p>\n<p></p>\n<p>        其他的就按照黑白灰大佬的步骤制作数据集和调参就行，目前只遇到了这些比较难搞的问题，有其他问题再说。</p>\n<hr/>\n<p>        补充：<strong><span style=\"color:#fe2c24;\">AttributeError: 'tuple' object has no attribute 'shape'</span></strong></p>\n<p>        使用detect.py时候报错。原因是啥我也不清楚，但是我看<img alt=\"\" height=\"131\" src=\"image\\d8f576d1ea7e494284d5ce009dcdcc38.png\" width=\"970\"/></p>\n<p>这一块的时候看到他在detectds.py中的第一个参数的应用是不一样的， <img alt=\"\" height=\"210\" src=\"image\\3b103c540ec840c4acde107d0d0c02c0.png\" width=\"888\"/></p>\n<p>那我就试着在detect.py中加上[0][0]显示超出，去掉一个[0]，预测成功，碰到死耗子了，可用，有大佬清楚原因可以评论区留言分享一下，感谢。 </p>\n</div>\n</div>"}