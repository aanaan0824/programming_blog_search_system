{"blogid": "124812776", "writerAge": "码龄6年", "writerBlogNum": "219", "writerCollect": "158", "writerComment": "4", "writerFan": "48", "writerGrade": "5级", "writerIntegral": "2213", "writerName": "qq_37705525", "writerProfileAdress": "writer_image\\profile_124812776.jpg", "writerRankTotal": "9878", "writerRankWeekly": "119338", "writerThumb": "17", "writerVisitNum": "122937", "blog_read_count": "5296", "blog_time": "已于 2022-05-17 10:15:51 修改", "blog_title": "SQL如何删除重复数据", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>SQL去重</h3>\n<ul><li><a href=\"#1_SQL_1\">1 SQL去重</a></li><li><a href=\"#2_distinct_3\">2 distinct</a></li><li><a href=\"#3_group_by_14\">3 group by</a></li><li><a href=\"#4__67\">4 总结</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"1_SQL_1\"></a>1 SQL去重</h1>\n<p>SQL中去除完全相同数据可以用distinct关键字，任意字段去重可以用group by，以下面的数据表为例。</p>\n<h1><a id=\"2_distinct_3\"></a>2 distinct</h1>\n<p>存在两条完全相同的纪录，用关键字distinct就可以去掉<br/> 根据单个字段去重，能精确去重;<br/> 作用在多个字段时，只有当这几个字段的完全相同时，才能去重;<br/> 关键字distinct只能放在SQL语句中的第一个，才会起作用</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\9bdab65a465347a3b7867e1e5710b9e7.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\ec783ce185f9424ebe7d71f53fb10969.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\292b65a81422494bb77ebeb8a44a5752.png\"/><br/> 一般用来返回不重复的记录条数，返回不重复的条数(去掉test重复的，就剩下6条)<br/> <img alt=\"在这里插入图片描述\" src=\"image\\92a8dffabbac452c9ae60b1cfe7dded4.png\"/></p>\n<h1><a id=\"3_group_by_14\"></a>3 group by</h1>\n<pre><code>1. 查询根据名字去重后数据(名字相同取id值大的)\n</code></pre>\n<pre><code>SELECT * FROM stu WHERE id IN (SELECT MAX(id) FROM stu GROUP BY `name`)\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\a6f0bf5ba7af46249980f02f9fd96407.png\"/><br/> 2. 删除名字相同数据(名字相同保留id值大的)<br/> group by + count + max去掉重复数据</p>\n<p>1）SELECT * FROM stu<br/> <img alt=\"在这里插入图片描述\" src=\"image\\62398a82f7274e3896efce956f3351af.png\"/><br/> 2）加上group by 后，会将重复的数据去掉了<br/> <img alt=\"在这里插入图片描述\" src=\"image\\9608fe9ccfbc4a9db1492400f63bec66.png\"/><br/> 3) 条件(名字)是数量大于1的重复数据</p>\n<pre><code>SELECT `name` FROM stu GROUP BY `name` HAVING COUNT(`name`) &gt; 1\n\n#条件是数量大于1的重复数据\nSELECT * FROM stu WHERE `name` IN(\nSELECT `name` FROM stu GROUP BY `name` HAVING COUNT(`name`)&gt;1 \n)\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\9e9878b714694f94adeff54496bc001f.png\"/><br/> 4）查看某字段重复数据的id</p>\n<pre><code>SELECT id, COUNT(*) FROM stu \nGROUP BY NAME DESC HAVING(COUNT(*) &gt; 0)\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\18871faf79cf4e75bbe22be46eed9d52.png\"/></p>\n<p>5）查询所有重复数据</p>\n<pre><code>SELECT * FROM stu WHERE NAME IN (SELECT `name` FROM stu GROUP BY `name` HAVING COUNT(`name`) &gt; 1)\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\d90131fbc73e4d129c5e36e76018bb3c.png\"/><br/> 5) 去重<br/> 可以使用distinct去重（返回不重复的用户名）<br/> 删除多余的重复记录（name），只保留id最大的记录。</p>\n<pre><code>DELETE FROM stu \nWHERE id NOT IN ( SELECT a.id FROM ( SELECT MAX( id ) AS id FROM stu GROUP BY `name` )a )\n</code></pre>\n<p>或者</p>\n<pre><code> DELETE FROM stu WHERE `name` IN (SELECT `name` FROM (SELECT `name` FROM stu GROUP BY `name` HAVING COUNT(`name`)&gt;1) e)\n AND id NOT IN (SELECT id FROM (SELECT MAX(id) AS id FROM stu GROUP BY `name` HAVING COUNT(`name`)&gt;1) t)\n #查询显示重复的数据都是显示最前面的几条，因此不需要查询是否最小值\n</code></pre>\n<p>错误删除<br/> DELETE FROM stu WHERE <code>name</code> IN (SELECT <code>name</code> FROM stu GROUP BY <code>name</code> HAVING COUNT(<code>name</code>)&gt;1)<br/> AND id NOT IN (SELECT MAX(id) FROM stu GROUP BY <code>stu</code> HAVING COUNT(<code>name</code>)&gt;1)<br/> 原因是：不能将直接查处来的数据当做删除数据的条件，我们应该先把查出来的数据新建一个临时表，然后再把临时表作为条件进行删除功能</p>\n<h1><a id=\"4__67\"></a>4 总结</h1>\n<ol><li>去重后名字记录</li></ol>\n<pre><code>SELECT `name` FROM stu \nGROUP BY NAME HAVING(COUNT(*) &gt; 0)\n</code></pre>\n<p>2）<br/> 所有重复名字的记录</p>\n<pre><code>SELECT `name` FROM stu \nGROUP BY NAME HAVING COUNT(*) &gt; 1\n</code></pre>\n<p>3）把所有重复的记录都删了<br/> DELETE FROM stu WHERE <code>name</code> IN<br/> (SELECT <code>name</code> FROM stu GROUP BY <code>name</code> HAVING COUNT(*)&gt;1)<br/> <img alt=\"在这里插入图片描述\" src=\"image\\85a74cf9016e4ae999b9ddea3cd64f1c.png\"/><br/> 无法在删除时同时查询这张表，这个问题只在MySQL中出现，oracle没有。怎么解决？我们只需要在查出结果以后加一张中间表。让执行器认为我们要查的数据不是来自正在删的这张表就可以了。</p>\n<pre><code>DELETE FROM stu WHERE `name` IN \n    (SELECT a.name FROM \n        (SELECT `name` FROM stu GROUP BY `name` HAVING COUNT(*)&gt;1) a)\n</code></pre>\n<p>所有重复数据都删除, 就剩王五一条数据了<br/> <img alt=\"在这里插入图片描述\" src=\"image\\79398dfa31034133961748011d7c988c.png\"/><br/> 4) 现在删除所有重复数据数据做完了，考虑怎么保留重复数据中id最小的。只需要在删除时让删除该条的记录id不在重复数据id最小的当中就可以了。</p>\n<pre><code>DELETE FROM stu WHERE `name` IN \n    (SELECT a.name FROM \n        (SELECT `name` FROM stu GROUP BY `name` HAVING COUNT(*)&gt;1) a)\n     AND id NOT IN \n    (SELECT b.id FROM \n        (SELECT MIN(id) id FROM stu \n            GROUP BY `name` HAVING COUNT(*)&gt;1) b);\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\b282f9d892a442b08ca4adca843d4df2.png\"/><br/> 还有简单办法 算出去重后所有数据（保留最小ID），然后删除id不在该数组里的</p>\n<pre><code> DELETE FROM stu WHERE id NOT IN (SELECT t.id FROM (SELECT MIN(id) AS id FROM stu GROUP BY `name`)t)\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}