{"blogid": "126605196", "writerAge": "码龄13年", "writerBlogNum": "52", "writerCollect": "254", "writerComment": "40", "writerFan": "21", "writerGrade": "5级", "writerIntegral": "1657", "writerName": "羞羞的铁脚", "writerProfileAdress": "writer_image\\profile_126605196.jpg", "writerRankTotal": "12680", "writerRankWeekly": "25892", "writerThumb": "40", "writerVisitNum": "165521", "blog_read_count": "462", "blog_time": "于 2022-08-30 15:36:09 发布", "blog_title": "C# 程序开机自动启动", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>1 非管理员运行的程序最简单的是在C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp 路径下放入超链接即可</p>\n<p>2 默认管理员运行的程序</p>\n<p>  （1）在程序的app.manifest中设置如下</p>\n<pre><code class=\"language-cs\"> &lt;requestedExecutionLevel level=\"requireAdministrator\" uiAccess=\"false\" /&gt;</code></pre>\n<p>   （2）在程序的启动时调用如下代码</p>\n<p>   </p>\n<pre><code class=\"language-cs\"> var starupPath = GetType().Assembly.Location;//获得程序路径其他方式也可以\n            try\n            {\n                var fileName = starupPath;\n                var shortFileName = fileName.Substring(fileName.LastIndexOf('\\\\') + 1);\n                //打开子键节点\n                var myReg = Registry.LocalMachine.OpenSubKey(\n                    \"SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\", RegistryKeyPermissionCheck.ReadWriteSubTree,\n                    RegistryRights.FullControl);\n                if (myReg == null)\n                {\n                    //如果子键节点不存在，则创建之\n                    myReg = Registry.LocalMachine.CreateSubKey(\"SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\");\n                }\n                if (myReg != null &amp;&amp; myReg.GetValue(shortFileName) != null)\n                {\n                    //在注册表中设置自启动程序\n                    myReg.DeleteValue(shortFileName);\n                    myReg.SetValue(shortFileName, fileName);\n\n                }\n                else if (myReg != null &amp;&amp; myReg.GetValue(shortFileName) == null)\n                {\n                    myReg.SetValue(shortFileName, fileName);\n\n                }\n            }\n            catch\n            {\n\n            }</code></pre>\n<p>这里需要注意的是</p>\n<p>（1）你的程序是32位的注册表路径是<br/>           \"SOFTWARE\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"</p>\n<p>（2） 你的程序是64位的注册表路径是</p>\n<p>          \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"</p>\n<p>这样设置后你的程序仍然没有启动？</p>\n<p>这时可能和你的程序调用了你程序文件夹下的文件有关系，这时可以写一个run.bat脚本，在脚本中先cd到你的程序路径，然后启动程序，最后把run.bat的超链接放在C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp中</p>\n<p>bat的内容例子如下：</p>\n<pre><code class=\"language-cs\">C:\ncd C:\\Users\\user\\Desktop\\Debug\nchcp 65001\n@setlocal enableextensions enabledelayedexpansion\n\n@echo off\nset m_path=\"C:\\Users\\user\\Desktop\\Debug\\program.exe\"\necho !m_path!\n\necho 开始启动...\nstart  \"\" !m_path!\necho \"结束\"\nexit</code></pre>\n<p></p>\n</div>\n</div>"}