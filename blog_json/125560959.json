{"blogid": "125560959", "writerAge": "ç é¾„1å¹´", "writerBlogNum": "25", "writerCollect": "2049", "writerComment": "1518", "writerFan": "2633", "writerGrade": "6çº§", "writerIntegral": "4561", "writerName": "çŒ¿åŠ›çŒª", "writerProfileAdress": "writer_image\\profile_125560959.jpg", "writerRankTotal": "4640", "writerRankWeekly": "15864", "writerThumb": "1555", "writerVisitNum": "113013", "blog_read_count": "1494", "blog_time": "å·²äºÂ 2022-07-13 12:16:32Â ä¿®æ”¹", "blog_title": "ã€Linuxç½‘ç»œç¼–ç¨‹ã€‘é«˜å¹¶å‘æœåŠ¡å™¨æ¡†æ¶ çº¿ç¨‹æ± ä»‹ç»+çº¿ç¨‹æ± å°è£…", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1 id=\"%E7%9B%AE%E5%BD%95\">ç›®å½•</h1>\n<p id=\"%E5%89%8D%E8%A8%80-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%89%8D%E8%A8%80\">å‰è¨€</a></p>\n<p id=\"%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%C2%A0-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%C2%A0\">ä¸€ã€çº¿ç¨‹æ± ä»‹ç»</a></p>\n<p id=\"%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\">ğŸ’»çº¿ç¨‹æ± åŸºæœ¬æ¦‚å¿µ</a></p>\n<p id=\"%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86\">ğŸ’»çº¿ç¨‹æ± ç»„æˆéƒ¨åˆ†</a></p>\n<p id=\"%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%C2%A0-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%C2%A0\">ğŸ’»çº¿ç¨‹æ± å·¥ä½œåŸç† </a></p>\n<p id=\"%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BB%A3%E7%A0%81%E5%B0%81%E8%A3%85-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BB%A3%E7%A0%81%E5%B0%81%E8%A3%85\">äºŒã€çº¿ç¨‹æ± ä»£ç å°è£…</a></p>\n<p id=\"main.cpp-toc\" style=\"margin-left:40px;\"><a href=\"#main.cpp\">ğŸŒˆmain.cpp</a></p>\n<p id=\"%C2%A0ThreadPool.h-toc\" style=\"margin-left:40px;\"><a href=\"#%C2%A0ThreadPool.h\">ğŸŒˆThreadPool.h</a></p>\n<p id=\"%C2%A0%C2%A0ThreadPool.cpp-toc\" style=\"margin-left:40px;\"><a href=\"#%C2%A0%C2%A0ThreadPool.cpp\">ğŸŒˆThreadPool.cpp</a></p>\n<p id=\"%C2%A0ChildTask.h%C2%A0-toc\" style=\"margin-left:40px;\"><a href=\"#%C2%A0ChildTask.h%C2%A0\">ğŸŒˆChildTask.h </a></p>\n<p id=\"%C2%A0ChildTask.cpp-toc\" style=\"margin-left:40px;\"><a href=\"#%C2%A0ChildTask.cpp\">ğŸŒˆChildTask.cpp</a></p>\n<p id=\"%C2%A0BaseTask.h-toc\" style=\"margin-left:40px;\"><a href=\"#%C2%A0BaseTask.h\">ğŸŒˆBaseTask.h</a></p>\n<p id=\"%C2%A0BaseTask.cpp-toc\" style=\"margin-left:40px;\"><a href=\"#%C2%A0BaseTask.cpp\">ğŸŒˆBaseTask.cpp</a></p>\n<p id=\"%E4%B8%89%E3%80%81%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%89%E3%80%81%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C\">ä¸‰ã€æµ‹è¯•æ•ˆæœ</a></p>\n<p id=\"%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93\">å››ã€æ€»ç»“</a></p>\n<p id=\"%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84-toc\" style=\"margin-left:40px;\"><a href=\"#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84\">ğŸ“Œåˆ›å»ºçº¿ç¨‹æ± çš„å¥½å¤„</a></p>\n<hr/>\n<h1 id=\"%E5%89%8D%E8%A8%80\">å‰è¨€</h1>\n<p>æœ¬æ–‡ä¸»è¦å­¦ä¹ <span style=\"color:#be191c;\"><strong>Linuxå†…æ ¸ç¼–ç¨‹</strong></span>ï¼Œç»“åˆ<span style=\"color:#be191c;\"><strong>Visual Studio 2019</strong></span>è¿›è¡Œè·¨å¹³å°ç¼–ç¨‹ï¼Œå†…å®¹åŒ…æ‹¬çº¿ç¨‹æ± ä»‹ç»ä»¥åŠçº¿ç¨‹æ± å°è£…</p>\n<h1 id=\"%E4%B8%80%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%C2%A0\">ä¸€ã€çº¿ç¨‹æ± ä»‹ç»</h1>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"405\" src=\"image\\25b11019e4bd498192bac62084213f54.png\" width=\"461\"/></p>\n<h2 id=\"%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\">ğŸ’»çº¿ç¨‹æ± åŸºæœ¬æ¦‚å¿µ</h2>\n<ul><li><span style=\"color:#be191c;\"><strong>çº¿ç¨‹æ± </strong></span>æ˜¯é¢„å…ˆåˆ›å»ºçº¿ç¨‹çš„ä¸€ç§æŠ€æœ¯ ï¼ˆæœåŠ¡å™¨çœŸæ­£æ„ä¹‰ä¸Šå®ç°é«˜å¹¶å‘å°±å¿…é¡»ç”¨çº¿ç¨‹æ± ï¼‰</li><li>ğŸŒ°ä¸¾ä¸ªä¾‹å­ï¼šç”Ÿæ´»ä¸­çš„æ°´æ± ï¼Œæ˜¯è£…ä¸œè¥¿çš„å®¹å™¨ï¼Œç”¨æ¥è£…æ°´çš„ï¼Œçº¿ç¨‹æ± å½“ç„¶å°±æ˜¯æ‹¿æ¥è£…çº¿ç¨‹çš„</li></ul>\n<blockquote>\n<ul><li>çº¿ç¨‹æ± åœ¨ä»»åŠ¡è¿˜æ²¡æœ‰åˆ°æ¥ä¹‹å‰ï¼Œåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹ï¼Œæ”¾å…¥ç©ºé—²é˜Ÿåˆ—ä¸­ï¼Œè¿™äº›çº¿ç¨‹éƒ½æ˜¯å¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸æ¶ˆè€—CPUï¼Œä½†å ç”¨è¾ƒå°çš„å†…å­˜ç©ºé—´</li><li>å½“æ–°ä»»åŠ¡åˆ°æ¥æ—¶ï¼Œç¼“å†²æ± é€‰æ‹©ä¸€ä¸ªç©ºé—²çº¿ç¨‹ï¼ŒæŠŠä»»åŠ¡ä¼ å…¥æ­¤çº¿ç¨‹ä¸­è¿è¡Œï¼Œå¦‚æœç¼“å†²æ± å·²ç»æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™æ–°å»ºè‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œå½“ç³»ç»Ÿæ¯”è¾ƒç©ºé—²æ—¶ï¼Œå¤§éƒ¨åˆ†çº¿ç¨‹éƒ½ä¸€ç›´å¤„äºæš‚åœçŠ¶æ€ï¼Œçº¿ç¨‹æ± è‡ªåŠ¨é”€æ¯ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼Œå›æ”¶ç³»ç»Ÿèµ„æº</li></ul>\n</blockquote>\n<h2 id=\"%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86\">ğŸ’»<strong>çº¿ç¨‹æ± ç»„æˆéƒ¨åˆ†</strong></h2>\n<blockquote>\n<ul><li><strong>çº¿ç¨‹æ± ç±»</strong></li></ul>\n<p>        ç»´æŠ¤å·¥ä½œè€…çº¿ç¨‹é˜Ÿåˆ—ï¼ˆåŒ…æ‹¬ç©ºé—²ä¸å¿™ç¢Œé˜Ÿåˆ—ï¼‰</p>\n<p>        ç»´æŠ¤ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—</p>\n<p>        ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹æ± è°ƒåº¦å™¨æŒ‡é’ˆ</p>\n<ul><li><strong>çº¿ç¨‹æ± è°ƒåº¦å™¨</strong>ï¼ˆæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼‰</li></ul>\n<p>        è´Ÿè´£çº¿ç¨‹è°ƒåº¦</p>\n<p>        è´Ÿè´£ä»»åŠ¡åˆ†é…</p>\n<ul><li><strong>å·¥ä½œè€…çº¿ç¨‹ç±»</strong>ï¼ˆçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ç±»çš„å°è£…ï¼‰</li><li><strong>ä»»åŠ¡é˜Ÿåˆ—</strong></li><li><strong>ä»»åŠ¡æ¥å£</strong>ï¼ˆå®é™…çš„ä¸šåŠ¡é€»è¾‘éƒ½ç»§æ‰¿è‡ªè¯¥æ¥å£ï¼‰</li></ul>\n</blockquote>\n<h2 id=\"%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%C2%A0\">ğŸ’»<strong>çº¿ç¨‹æ± å·¥ä½œåŸç† </strong></h2>\n<p>æ ¹æ®æœåŠ¡å™¨çš„éœ€è¦ï¼Œæ¥è®¾ç½®çº¿ç¨‹çš„æ•°é‡ï¼Œå¯èƒ½æ˜¯10æ¡ã€20æ¡ã€30æ¡ï¼Œæ ¹æ®æœåŠ¡å™¨çš„æ‰¿è½½ï¼Œ10æ¡ä¸ä»£è¡¨åªèƒ½åš10ä¸ªä»»åŠ¡ï¼Œæ€»æœ‰ä»»åŠ¡åšçš„å¿«ï¼Œæœ‰çš„åšçš„æ…¢ï¼Œå¯èƒ½å¯ä»¥å®Œæˆ20ä¸ªä»»åŠ¡ </p>\n<p><img alt=\"\" height=\"1074\" src=\"https://img-blog.csdnimg.cn/e1e608aeaca24f439da26619725121cc.gif\" width=\"1200\"/></p>\n<p>ğŸŒ°ä¸¾ä¸ªä¾‹å­ï¼šå¦‚ä¸ŠåŠ¨å›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬æœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªæ³¨å†Œä¸šåŠ¡ï¼Œæ˜¯ä¸€ä¸ªæœåŠ¡å™¨è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®ƒä¼šè¿›å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºï¼Œé¡ºæ¬¡æ‰§è¡Œï¼Œä»»åŠ¡ä¼šå”¤é†’ç©ºé—²åˆ—è¡¨å½“ä¸­çš„ä¸€ä¸ªç©ºé—²çš„çº¿ç¨‹ï¼Œæ¥åˆ°ä»»åŠ¡ä¹‹åï¼Œç©ºé—²çº¿ç¨‹ä¼šä»ç©ºé—²åˆ—è¡¨ä¸­æ¶ˆå¤±ï¼Œè¿›å…¥åˆ°å¿™ç¢Œåˆ—è¡¨ï¼Œå»å®Œæˆå¯¹åº”çš„ä»»åŠ¡ï¼Œå®Œæˆä»»åŠ¡åï¼Œä»å¿™ç¢Œåˆ—è¡¨ä¸­å‡ºå»ï¼Œåˆ°ç©ºé—²åˆ—è¡¨ç»§ç»­ç­‰å¾…æ–°ä»»åŠ¡</p>\n<p>å¦‚æœï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨å¿™ï¼Œéƒ½åœ¨åšä»»åŠ¡ï¼Œè¿™æ—¶å€™ç™»å½•è¿›æ¥ï¼Œå…ˆè¿›å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ¥è¿™ä¸ªä»»åŠ¡ï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½å®Œæˆä»»åŠ¡ï¼Œå›åˆ°ç©ºé—²åˆ—è¡¨åï¼Œæ–°åˆ›å»ºçš„çº¿ç¨‹é”€æ¯ï¼Œç•™ä¸‹åŸå…ˆè®¾ç½®çš„å¯¹åº”æ•°é‡çº¿ç¨‹ï¼ˆç±»ä¼¼ï¼Œä¿ç•™è€å‘˜å·¥ï¼ŒæŠŠå®ä¹ ç”Ÿè£å‘˜ï¼‰</p>\n<blockquote>\n<ul><li><strong>é˜Ÿåˆ—ï¼š</strong>å…ˆè¿›å…ˆå‡º</li><li><strong>ç©ºé—²åˆ—è¡¨ï¼ˆé“¾è¡¨ï¼‰ï¼š</strong>ä¸å®šé•¿ï¼ˆæœ‰çš„æ—¶å€™å¯èƒ½éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹æ¥æ¥ä»»åŠ¡ï¼‰</li><li><strong>å¿™ç¢Œåˆ—è¡¨ï¼ˆé“¾è¡¨ï¼‰ï¼š</strong>ä¸å®šé•¿ï¼ˆæœ‰çš„æ—¶å€™å¯èƒ½éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹æ¥æ¥ä»»åŠ¡ï¼‰</li></ul>\n</blockquote>\n<p>è¯ä¸å¤šè¯´ï¼Œå’±ä»¬ä¸Šå·ï¼Œå°è£…ä¸€ä¸‹çº¿ç¨‹æ± ç›¸å…³å‡½æ•°ï¼Œæ¥è¿›è¡Œæµ‹è¯• </p>\n<p><img alt=\"\" height=\"673\" src=\"image\\ebb9ac75e7d74284b42cacac2fff41fd.png\" width=\"1200\"/></p>\n<h1 id=\"%E4%BA%8C%E3%80%81%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BB%A3%E7%A0%81%E5%B0%81%E8%A3%85\">äºŒã€çº¿ç¨‹æ± ä»£ç å°è£…</h1>\n<h2 id=\"main.cpp\">ğŸŒˆmain.cpp</h2>\n<ul><li>ä¸»å‡½æ•°ï¼Œè®¾ç½®10æ¡çº¿ç¨‹ï¼Œæ¥æ‰§è¡Œ30ä¸ªä»»åŠ¡ </li></ul>\n<pre><code class=\"language-cpp\">#include &lt;iostream&gt;\n#include &lt;stdio.h&gt;\n#include \"ThreadPool.h\"\n#include \"ChildTask.h\"\nusing namespace std;\n\nint main()\n{\n\tThreadPool* pool = new ThreadPool(10);//10æ¡çº¿ç¨‹\n\n\tfor (int i = 0; i &lt; 30; i++)//è®¾ç½®30ä¸ªä»»åŠ¡\n\t{\n\t\tchar buf[40] = { 0 };//åˆå§‹åŒ–\n\t\tsprintf(buf, \"%s%d\", \"ä»»åŠ¡\", i);\n\n\t\tBaseTask* task = new ChildTask(buf);\n\t\tpool-&gt;pushTask(task);\n\t}\n\n\twhile (1) {}\n\n\treturn 0;\n}</code></pre>\n<h2 id=\"%C2%A0ThreadPool.h\">ğŸŒˆThreadPool.h</h2>\n<ul><li>å¯¹çº¿ç¨‹æ± è¿›è¡Œè®¾è®¡ï¼Œæ ¸å¿ƒåŒ…æ‹¬<strong>æœ€å¤§ã€æœ€å°çº¿ç¨‹æ•°</strong>ï¼Œ<strong>å¿™ç¢Œåˆ—è¡¨</strong>ï¼Œ<strong>ç©ºé—²åˆ—è¡¨</strong>ï¼Œ<strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼Œ<strong>äº’æ–¥é‡</strong>ï¼Œ<strong>æ¡ä»¶å˜é‡</strong>ï¼Œä»¥åŠ<strong>çº¿ç¨‹æ‰§è¡Œå‡½æ•°</strong></li></ul>\n<pre><code class=\"language-cpp\">#pragma once\n#include &lt;queue&gt;//é˜Ÿåˆ—\n#include &lt;list&gt;//é“¾è¡¨å¤´æ–‡ä»¶\n#include &lt;pthread.h&gt;//çº¿ç¨‹å¤´æ–‡ä»¶\n#include &lt;algorithm&gt;//findæŸ¥æ‰¾\n#include &lt;iostream&gt;\n#include \"BaseTask.h\"\n\nusing namespace std;\n\n#define MIN_NUM 10//æœ€å°å€¼ é»˜è®¤å‚æ•°\n\nclass ThreadPool\n{\npublic:\n\tThreadPool(const int num = MIN_NUM);\n\t~ThreadPool();\n\n\t//åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º\n\tbool QueueIsEmpty();\n\t//çº¿ç¨‹äº’æ–¥é‡åŠ é”è§£é”\n\tvoid Lock();\n\tvoid Unlock();\n\t//çº¿ç¨‹æ¡ä»¶å˜é‡ç­‰å¾…å’Œå”¤é†’\n\tvoid Wait();\n\tvoid WakeUp();\n\n\t//æ·»åŠ ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—\n\tvoid pushTask(BaseTask* task);\n\t//ä»ä»»åŠ¡é˜Ÿåˆ—ç§»é™¤ä»»åŠ¡\n\tBaseTask* popTask(BaseTask* task);\n\n\t//ä»å¿™ç¢Œå›åˆ°ç©ºé—² å·¥ä½œç»“æŸ\n\tvoid MoveToIdle(pthread_t id);\n\n\t//ä»ç©ºé—²åˆ°å¿™ç¢Œ å·¥ä½œå¼€å§‹\n\tvoid MoveToBusy(pthread_t id);\n\n\t//çº¿ç¨‹æ‰§è¡Œå‡½æ•°\n\tstatic void* RunTime(void* vo);\n\nprivate:\n\tint threadMinNum;//æœ€å¤§çº¿ç¨‹æ•°é‡\n\tint threadMaxNum;//æœ€å°çº¿ç¨‹æ•°é‡\n\tqueue&lt;BaseTask*&gt;taskQueue;//ä»»åŠ¡é˜Ÿåˆ—\n\tlist&lt;pthread_t&gt;busyList;//çº¿ç¨‹å¿™ç¢Œåˆ—è¡¨\n\tlist&lt;pthread_t&gt;idleList;//çº¿ç¨‹ç©ºé—²åˆ—è¡¨\n\tpthread_mutex_t mutex;//äº’æ–¥é‡ï¼šåšé”\n\tpthread_cond_t cond;//æ¡ä»¶å˜é‡ï¼šè®©çº¿ç¨‹ç­‰å¾…æˆ–è€…å”¤é†’\n};\n\n</code></pre>\n<h2 id=\"%C2%A0%C2%A0ThreadPool.cpp\">ğŸŒˆThreadPool.cpp</h2>\n<ul><li>å¯¹å‡½æ•°è¿›è¡Œå‚æ•°çš„è®¾ç½®ï¼Œæ ¸å¿ƒåœ¨äºçº¿ç¨‹æ‰§è¡Œå‡½æ•°ä¸Šçš„è®¾ç½®ï¼Œåœ¨å·¥ä½œå‰å’Œå·¥ä½œå®Œè®¾ç½®æ‰“å°ï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œè§‚å¯Ÿ</li></ul>\n<pre><code class=\"language-cpp\">#include \"ThreadPool.h\"\n\nThreadPool::ThreadPool(const int num)\n{\n\tthis-&gt;threadMinNum = num;\n\n\t//æ¡ä»¶å˜é‡ã€äº’æ–¥é‡åˆå§‹åŒ–\n\tpthread_mutex_init(&amp;this-&gt;mutex, NULL);\n\tpthread_cond_init(&amp;this-&gt;cond, NULL);\n\n\tpthread_t id;\n\t//çº¿ç¨‹numæ¡åˆ›å»º\n\tfor (int i = 0; i &lt; this-&gt;threadMinNum; i++)\n\t{\n\t\t//çº¿ç¨‹åˆ›å»º\n\t\tpthread_create(&amp;id, NULL, RunTime, this);\n\t\tthis-&gt;idleList.push_back(id);//çº¿ç¨‹å­˜å…¥ç©ºé—²åˆ—è¡¨\n\t}\n}\n\nThreadPool::~ThreadPool()\n{\n}\n//ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º\nbool ThreadPool::QueueIsEmpty()\n{\n\treturn this-&gt;taskQueue.empty();\n}\n//çº¿ç¨‹åŠ é”\nvoid ThreadPool::Lock()\n{\n\tpthread_mutex_lock(&amp;this-&gt;mutex);\n}\n//çº¿ç¨‹è§£é”\nvoid ThreadPool::Unlock()\n{\n\tpthread_mutex_unlock(&amp;this-&gt;mutex);\n}\n//çº¿ç¨‹ç­‰å¾…\nvoid ThreadPool::Wait()\n{\n\tpthread_cond_wait(&amp;this-&gt;cond, &amp;this-&gt;mutex);\n}\n//çº¿ç¨‹å”¤é†’\nvoid ThreadPool::WakeUp()\n{\n\tpthread_cond_signal(&amp;this-&gt;cond);\n}\n//æ·»åŠ ä»»åŠ¡åˆ°ä»»åŠ¡é˜Ÿåˆ—\nvoid ThreadPool::pushTask(BaseTask* task)\n{\n\tLock();\n\ttaskQueue.push(task);\n\tUnlock();\n\tWakeUp();\n}\n//ä»ä»»åŠ¡é˜Ÿåˆ—ç§»é™¤ä»»åŠ¡\nBaseTask* ThreadPool::popTask(BaseTask* task)\n{\n\ttask = this-&gt;taskQueue.front();//ä»é˜Ÿåˆ—å¤´å–\n\tthis-&gt;taskQueue.pop();//åˆ é™¤é˜Ÿåˆ—å¤´\n\n\treturn task;\n}\n//ä»å¿™ç¢Œå›åˆ°ç©ºé—² å·¥ä½œç»“æŸ\nvoid ThreadPool::MoveToIdle(pthread_t id)\n{\n\tlist&lt;pthread_t&gt;::iterator iter;\n\titer = find(busyList.begin(), busyList.end(), id);\n\n\tif (iter != busyList.end())\n\t{\n\t\t//ä»å¿™ç¢Œç§»é™¤\n\t\tthis-&gt;busyList.erase(iter);\n\t\t//æ·»åŠ åˆ°ç©ºé—²\n\t\tthis-&gt;idleList.push_back(*iter);//this-&gt;idleList.push_back(id)\n\t}\n}\n//ä»ç©ºé—²åˆ°å¿™ç¢Œ å·¥ä½œå¼€å§‹\nvoid ThreadPool::MoveToBusy(pthread_t id)\n{\n\tlist&lt;pthread_t&gt;::iterator iter;\n\titer = find(idleList.begin(), idleList.end(), id);\n\n\tif (iter != idleList.end())\n\t{\n\t\t//ä»ç©ºé—²ç§»é™¤\n\t\tthis-&gt;idleList.erase(iter);\n\t\t//æ·»åŠ åˆ°å¿™ç¢Œ\n\t\tthis-&gt;busyList.push_back(*iter);//this-&gt;idleList.push_back(id)\n\t}\n}\n//çº¿ç¨‹æ‰§è¡Œå‡½æ•°\nvoid* ThreadPool::RunTime(void* vo)\n{\n\t//æ‹¿åˆ°æ‰§è¡Œçº¿ç¨‹è‡ªå·±çš„id å› ä¸ºåé¢è¦å¤„ç†å¿™ç¢Œå’Œç©ºé—²çš„æƒ…å†µ\n\tpthread_t id = pthread_self();\n\t//ç¡®ä¿ä¸»çº¿ç¨‹ä¸å­çº¿ç¨‹åˆ†ç¦»ï¼Œå­çº¿ç¨‹ç»“æŸåï¼Œèµ„æºè‡ªåŠ¨å›æ”¶\n\tpthread_detach(id);\n\t//çº¿ç¨‹å‚æ•°è·å–\n\tThreadPool* argThis = (ThreadPool*)vo;\n\n\twhile (true)\n\t{\n\t\targThis-&gt;Lock();\n\t\t//å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ºç©º çº¿ç¨‹åˆ™ä¸€ç›´ç­‰å¾… \n\t\t//çŸ¥é“ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºç©ºåˆ™ä¼šè¢«pushTaskå‡½æ•°å”¤é†’çº¿ç¨‹\n\t\twhile (argThis-&gt;QueueIsEmpty())\n\t\t{\n\t\t\targThis-&gt;Wait();\n\t\t}\n\t\targThis-&gt;MoveToBusy(id);\n\n\t\tcout &lt;&lt; \"å·¥ä½œå‰  ä»»åŠ¡æ•°:\" &lt;&lt; argThis-&gt;taskQueue.size() &lt;&lt; endl;\n\t\tcout &lt;&lt; \"å·¥ä½œå‰  busy:\" &lt;&lt; argThis-&gt;busyList.size() &lt;&lt; endl;\n\t\tcout &lt;&lt; \"å·¥ä½œå‰  idle:\" &lt;&lt; argThis-&gt;idleList.size() &lt;&lt; endl;\n\t\tcout &lt;&lt; \"-----------------------------------------------\" &lt;&lt; endl;\n\t\t//å–ä»»åŠ¡\n\t\tBaseTask* task;\n\t\ttask = argThis-&gt;popTask(task);\n\n\t\targThis-&gt;Unlock();\n\n\t\t//ä»»åŠ¡å·¥ä½œ\n\t\ttask-&gt;working();\n\n\t\t//å·¥ä½œç»“æŸ\n\t\targThis-&gt;Lock();\n\t\targThis-&gt;MoveToIdle(id);\n\t\targThis-&gt;Unlock();\n\n\t\tcout &lt;&lt; \"å·¥ä½œå®Œ  ä»»åŠ¡æ•°:\" &lt;&lt; argThis-&gt;taskQueue.size() &lt;&lt; endl;\n\t\tcout &lt;&lt; \"å·¥ä½œå®Œ  busy:\" &lt;&lt; argThis-&gt;busyList.size() &lt;&lt; endl;\n\t\tcout &lt;&lt; \"å·¥ä½œå®Œ  idle:\" &lt;&lt; argThis-&gt;idleList.size() &lt;&lt; endl;\n\t\tcout &lt;&lt; \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;\" &lt;&lt; endl;\n\t}\n\n\treturn nullptr;\n}\n</code></pre>\n<h2 id=\"%C2%A0ChildTask.h%C2%A0\">ğŸŒˆChildTask.h </h2>\n<ul><li>å­ç±»é…ç½® </li></ul>\n<pre><code class=\"language-cpp\">#pragma once\n#include \"BaseTask.h\"\n#include &lt;iostream&gt;\n#include &lt;unistd.h&gt;//sleepå¤´æ–‡ä»¶\nusing namespace std;\n\nclass ChildTask :\n\tpublic BaseTask\n{\npublic:\n\tChildTask(char* data);\n\t~ChildTask();\n\tvoid working();\n};\n</code></pre>\n<h2 id=\"%C2%A0ChildTask.cpp\">ğŸŒˆChildTask.cpp</h2>\n<ul><li>å­ç±»è®¾ç½®å»¶æ—¶æ¨¡æ‹Ÿåšä»»åŠ¡çš„æ—¶é—´æ¯”è¾ƒé•¿ </li></ul>\n<pre><code class=\"language-cpp\">#include \"ChildTask.h\"\n\nChildTask::ChildTask(char* data) :BaseTask(data)//å‚æ•°ä¼ ç»™çˆ¶ç±»\n{\n}\n\nChildTask::~ChildTask()\n{\n}\n\nvoid ChildTask::working()\n{\n\tcout &lt;&lt; this-&gt;data &lt;&lt; \"æ­£åœ¨æ‰§è¡Œ......\" &lt;&lt; endl;\n\tsleep(3);//å»¶æ—¶3ç§’ ï¼ˆæ¨¡æ‹Ÿåšä¸šåŠ¡çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼‰\n}\n</code></pre>\n<h2 id=\"%C2%A0BaseTask.h\">ğŸŒˆBaseTask.h</h2>\n<ul><li>åŸºç±»è®¾ç½®ç»“æ„ä½“æ¥è£…ä¸šåŠ¡ </li></ul>\n<pre><code class=\"language-cpp\">#pragma once\n#include &lt;string.h&gt;\nclass BaseTask\n{\npublic:\n\tBaseTask(char* data);\n\t~BaseTask();\n\tchar data[1024]; //è£…ä¸šåŠ¡\n\tvirtual void working() = 0;//è™šå‡½æ•°\n};\n\n</code></pre>\n<h2 id=\"%C2%A0BaseTask.cpp\">ğŸŒˆBaseTask.cpp</h2>\n<ul><li>åŸºç±»é…ç½® </li></ul>\n<pre><code class=\"language-cpp\">#include \"BaseTask.h\"\n\nBaseTask::BaseTask(char* data)\n{\n\tbzero(this-&gt;data, sizeof(this-&gt;data));//æ¸…ç©º\n\tmemcpy(this-&gt;data, data, sizeof(data));\n}\n\nBaseTask::~BaseTask()\n{\n\tdelete this-&gt;data;//æ¸…é™¤é‡Šæ”¾\n}\n</code></pre>\n<h1 id=\"%E4%B8%89%E3%80%81%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C\">ä¸‰ã€æµ‹è¯•æ•ˆæœ</h1>\n<ul><li>é€šè¿‡Linuxè¿æ¥VSè¿›è¡Œè·¨å¹³å°ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°æœ‰å‡ ä¸ªçº¿ç¨‹æ˜¯åœ¨åšä»»åŠ¡ï¼Œå‡ ä¸ªçº¿ç¨‹æ˜¯ç©ºé—²çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±å¾ˆæ¸…æ™°ç›´è§‚çš„å±•ç°å‡ºæ¥äº†ï¼Œå¦‚ä¸‹åŠ¨å›¾æ‰€ç¤ºï¼š </li></ul>\n<p><img alt=\"\" height=\"1008\" src=\"https://img-blog.csdnimg.cn/e6c67342a32a47cfa29a80ec5ac9ef23.gif\" width=\"1200\"/></p>\n<ul><li>10æ¡çº¿ç¨‹åš30ä¸ªä»»åŠ¡çš„å…¨éƒ¨è®°å½•ï¼Œå¦‚ä¸‹å¦‚æ‰€ç¤ºï¼š</li></ul>\n<p><img alt=\"\" height=\"1200\" src=\"image\\db32f20cc97e4fa79238cc50ae787596.png\" width=\"963\"/></p>\n<h1 id=\"%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93\">å››ã€æ€»ç»“</h1>\n<h2 id=\"%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%A5%BD%E5%A4%84\">ğŸ“Œåˆ›å»ºçº¿ç¨‹æ± çš„å¥½å¤„</h2>\n<ul><li>çº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œèƒ½è®©æˆ‘ä»¬æ­å»ºçš„é«˜å¹¶å‘æœåŠ¡å™¨çœŸæ­£æ„ä¹‰ä¸Šåšåˆ°é«˜å¹¶å‘</li></ul>\n<blockquote>\n<ul><li><strong><span style=\"color:#956fe7;\">é™ä½èµ„æºæ¶ˆè€—</span></strong></li></ul>\n<p>        é€šè¿‡é‡å¤åˆ©ç”¨è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—</p>\n<ul><li><strong><span style=\"color:#956fe7;\">æé«˜å“åº”é€Ÿåº¦</span></strong></li></ul>\n<p>        å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯å°±èƒ½ç«‹å³æ‰§è¡Œ</p>\n<ul><li><span style=\"color:#956fe7;\"><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</strong></span></li></ul>\n<p>        çº¿ç¨‹å¼ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™çš„åˆ›å»ºçº¿ç¨‹ï¼Œä¸ä»…ä¼šæ¶ˆè€—èµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§</p>\n<p>        ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§</p>\n</blockquote>\n<p></p>\n<p><span style=\"color:#38d8f0;\"><strong><em>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹å•¦ï¼å¦‚æœå¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œéº»çƒ¦ç‚¹èµå•¦ï¼æ”¶è—å•¦ï¼æ¬¢è¿å„ä½è¯„è®ºåŒºç•™è¨€</em>ï¼ï¼ï¼</strong></span></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"375\" src=\"https://img-blog.csdnimg.cn/d65b1c3c42934093b5517179f115e8d1.gif\" width=\"667\"/></p>\n<p></p>\n</div>\n</div>"}