{"blogid": "126148501", "writerAge": "ç é¾„3å¹´", "writerBlogNum": "85", "writerCollect": "2338", "writerComment": "2028", "writerFan": "4579", "writerGrade": "6çº§", "writerIntegral": "6215", "writerName": "èµµå››å¸æœº", "writerProfileAdress": "writer_image\\profile_126148501.jpg", "writerRankTotal": "2434", "writerRankWeekly": "19", "writerThumb": "2058", "writerVisitNum": "204078", "blog_read_count": "953", "blog_time": "å·²äºÂ 2022-08-17 09:26:43Â ä¿®æ”¹", "blog_title": "ã€Spring Cloudã€‘æ–°é—»å¤´æ¡å¾®æœåŠ¡é¡¹ç›®ï¼šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸMinIOå®ç°æ–‡ç« é¡µé¢å­˜å–", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p> <img alt=\"8420b26844034fab91b6df661ae68671.png\" src=\"image\\8420b26844034fab91b6df661ae68671.png\"/></p>\n<p><strong>ä¸ªäººç®€ä»‹ï¼š </strong></p>\n<blockquote>\n<p>&gt; ğŸ“¦ä¸ªäººä¸»é¡µï¼š<a href=\"https://blog.csdn.net/weixin_45750572?type=blog\" title=\"èµµå››å¸æœº\">èµµå››å¸æœº</a><br/> &gt; ğŸ†å­¦ä¹ æ–¹å‘ï¼šJAVAåç«¯å¼€å‘ <br/> &gt; ğŸ“£ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ï¼<br/> &gt; â°å¾€æœŸæ–‡ç« ï¼š<a href=\"https://blog.csdn.net/weixin_45750572/article/details/125534014\" title=\"SpringBooté¡¹ç›®æ•´åˆå¾®ä¿¡æ”¯ä»˜\">SpringBooté¡¹ç›®æ•´åˆå¾®ä¿¡æ”¯ä»˜</a><br/> &gt; ğŸ§¡å–œæ¬¢çš„è¯éº»çƒ¦ç‚¹ç‚¹å…³æ³¨å–”ï¼Œä½ ä»¬çš„æ”¯æŒæ˜¯æˆ‘çš„æœ€å¤§åŠ¨åŠ›ã€‚</p>\n</blockquote>\n<p><strong>å‰è¨€ï¼š</strong></p>\n<blockquote>\n<p>æœ€è¿‘åœ¨åšä¸€ä¸ªåŸºäºSpringCloud+Springboot+Dockerçš„æ–°é—»å¤´æ¡å¾®æœåŠ¡é¡¹ç›®ï¼Œç°åœ¨é¡¹ç›®å¼€å‘è¿›å…¥äº†å°¾å£°ï¼Œæˆ‘æ‰“ç®—é€šè¿‡å†™æ–‡ç« çš„å½¢å¼è¿›è¡Œæ¢³ç†ä¸€éï¼Œå¹¶ä¸”ä¼šå°†æ¢³ç†è¿‡ç¨‹ä¸­å‘ç°çš„Bugè¿›è¡Œä¿®å¤ï¼Œæœ‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹æˆ‘ä¹Ÿä¼šç»§ç»­åšå‡ºæ”¹è¿›ã€‚è¿™ä¸€ç³»åˆ—çš„æ–‡ç« æˆ‘å°†ä¼šæ”¾å…¥å¾®æœåŠ¡é¡¹ç›®ä¸“æ ä¸­ï¼Œè¿™ä¸ªé¡¹ç›®é€‚åˆåˆšæ¥è§¦å¾®æœåŠ¡çš„äººä½œä¸ºç»ƒæ‰‹é¡¹ç›®ï¼Œå‡å¦‚ä½ å¯¹è¿™ä¸ªé¡¹ç›®æ„Ÿå…´è¶£ä½ å¯ä»¥è®¢é˜…æˆ‘çš„ä¸“æ è¿›è¡ŒæŸ¥çœ‹ï¼Œéœ€è¦èµ„æ–™å¯ä»¥ç§ä¿¡æˆ‘ï¼Œå½“ç„¶è¦æ˜¯èƒ½ç»™æˆ‘ç‚¹ä¸ªå°å°çš„å…³æ³¨å°±æ›´å¥½äº†ï¼Œä½ ä»¬çš„æ”¯æŒæ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚</p>\n</blockquote>\n<p><strong>ç›®å½•</strong></p>\n<p style=\"margin-left:0px;\"> </p>\n<p style=\"margin-left:0px;\"><a href=\"#%E4%B8%80%EF%BC%9A%E6%A6%82%E8%BF%B0\">ä¸€ï¼šæ¦‚è¿°</a></p>\n<p style=\"margin-left:0px;\"><a href=\"#%E4%BA%8C%EF%BC%9A%E4%B8%BA%E4%BD%95%E9%80%89%E7%94%A8MinIO\">äºŒï¼šä¸ºä½•é€‰ç”¨MinIO</a></p>\n<p style=\"margin-left:0px;\"><a href=\"#%E4%B8%89%EF%BC%9AMinIO%E7%89%B9%E7%82%B9\">ä¸‰ï¼šMinIOç‰¹ç‚¹</a></p>\n<p style=\"margin-left:0px;\"><a href=\"#%E5%9B%9B%EF%BC%9A%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88\">å››ï¼šå®ç°æ–¹æ¡ˆ</a></p>\n<p style=\"margin-left:0px;\"><a href=\"#%E4%BA%94%EF%BC%9A%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0\">äº”ï¼šåŠŸèƒ½å®ç°</a></p>\n<p style=\"margin-left:40px;\"><a href=\"#1.%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8\">1.åˆ›å»ºå®¹å™¨</a></p>\n<p style=\"margin-left:80px;\"><a href=\"#%EF%BC%881%EF%BC%89%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F\">ï¼ˆ1ï¼‰æ‹‰å–é•œåƒ</a></p>\n<p style=\"margin-left:80px;\"><a href=\"#%EF%BC%882%EF%BC%89%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8\">ï¼ˆ2ï¼‰å¯åŠ¨å®¹å™¨</a></p>\n<p style=\"margin-left:80px;\"><a href=\"#%EF%BC%883%EF%BC%89%E7%AE%A1%E7%90%86%E6%8E%A7%E5%88%B6%E5%8F%B0\">ï¼ˆ3ï¼‰ç®¡ç†æ§åˆ¶å°</a></p>\n<p style=\"margin-left:80px;\"><a href=\"#%EF%BC%884%EF%BC%89%E5%88%9B%E5%BB%BA%E6%A1%B6\">ï¼ˆ4ï¼‰åˆ›å»ºæ¡¶</a></p>\n<p style=\"margin-left:40px;\"><a href=\"#2.%E5%B0%81%E8%A3%85MinIO%E4%B8%BAStart\">2.å°è£…MinIOä¸ºStart</a></p>\n<p style=\"margin-left:80px;\"><a href=\"#%EF%BC%881%EF%BC%89%E6%A8%A1%E5%9D%97%E5%88%9B%E5%BB%BA\">ï¼ˆ1ï¼‰æ¨¡å—åˆ›å»º</a></p>\n<p style=\"margin-left:80px;\"><a href=\"#%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E7%B1%BB\">ï¼ˆ2ï¼‰é…ç½®ç±»</a></p>\n<p style=\"margin-left:80px;\"><a href=\"#%EF%BC%883%EF%BC%89%E5%B0%81%E8%A3%85%E6%93%8D%E4%BD%9CMinIO%E7%B1%BB\">ï¼ˆ3ï¼‰å°è£…æ“ä½œMinIOç±»</a></p>\n<p style=\"margin-left:80px;\"><a href=\"#%EF%BC%884%EF%BC%89%E5%AF%B9%E5%A4%96%E5%8A%A0%E5%85%A5%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE\">ï¼ˆ4ï¼‰å¯¹å¤–åŠ å…¥è‡ªåŠ¨é…ç½®</a></p>\n<hr/>\n<p> </p>\n<h1>ä¸€ï¼šæ¦‚è¿°</h1>\n<p>        MinIOåŸºäºApache License v2.0å¼€æºåè®®çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå¯ä»¥åšä¸ºäº‘å­˜å‚¨çš„è§£å†³æ–¹æ¡ˆç”¨æ¥ä¿å­˜æµ·é‡çš„å›¾ç‰‡ï¼Œè§†é¢‘ï¼Œæ–‡æ¡£ã€‚ç”±äºé‡‡ç”¨Golangå®ç°ï¼ŒæœåŠ¡ç«¯å¯ä»¥å·¥ä½œåœ¨Windows,Linux, OS Xå’ŒFreeBSDä¸Šã€‚é…ç½®ç®€å•ï¼ŒåŸºæœ¬æ˜¯å¤åˆ¶å¯æ‰§è¡Œç¨‹åºï¼Œå•è¡Œå‘½ä»¤å¯ä»¥è¿è¡Œèµ·æ¥ã€‚</p>\n<p>        MinIOå…¼å®¹äºšé©¬é€ŠS3äº‘å­˜å‚¨æœåŠ¡æ¥å£ï¼Œéå¸¸é€‚åˆäºå­˜å‚¨å¤§å®¹é‡éç»“æ„åŒ–çš„æ•°æ®ï¼Œä¾‹å¦‚å›¾ç‰‡ã€è§†é¢‘ã€æ—¥å¿—æ–‡ä»¶ã€å¤‡ä»½æ•°æ®å’Œå®¹å™¨/è™šæ‹Ÿæœºé•œåƒç­‰ï¼Œè€Œä¸€ä¸ªå¯¹è±¡æ–‡ä»¶å¯ä»¥æ˜¯ä»»æ„å¤§å°ï¼Œä»å‡ kbåˆ°æœ€å¤§5Tä¸ç­‰ã€‚</p>\n<h1>äºŒï¼šä¸ºä½•é€‰ç”¨MinIO</h1>\n<p>        å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ–‡ç« idåˆ°æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°è¯¥æ–‡ç« ç„¶åå†é€šè¿‡æ¨¡æ¿å¼•æ“ç”Ÿæˆé™æ€é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ï¼Œè¿™ç§æ–¹å¼å¼€å‘ä¾¿æ·ï¼Œæˆæœ¬è¾ƒä½ï¼Œä½†æ˜¯å°†æ¥è¦æ‰©å±•ä¸šåŠ¡çš„è¯æ¯”è¾ƒå›°éš¾ã€‚é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥é‡‡ç”¨ç¬¬ä¸‰æ–¹å­˜å‚¨æŠ€æœ¯ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘ã€ä¸ƒç‰›äº‘ç­‰ï¼Œè¿™ç§æ–¹æ¡ˆå¼€å‘ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”ä¸ç”¨è‡ªå·±ç»´æŠ¤ï¼Œç¼ºç‚¹å°±æ˜¯è¦æ”¶è´¹ã€‚æœ€åï¼Œè¿˜å¯ä»¥é€‰ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ¥è¿›è¡Œå­˜å‚¨ï¼Œå…¶ä¼˜ç‚¹æ˜¯å®¹æ˜“å®ç°æ‰©å®¹ï¼Œä½†æ˜¯å¤æ‚åº¦è¾ƒé«˜ï¼Œå¸¸ç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæœ‰FastDFSï¼Œå…¶æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p>\n<ul><li>ä¸»ä»å¤‡ä»½ï¼Œé«˜å¯ç”¨</li><li>æ”¯æŒä¸»ä»æ–‡ä»¶ï¼Œæ”¯æŒè‡ªå®šä¹‰æ‰©å±•å</li><li>æ”¯æŒåŠ¨æ€æ‰©å®¹</li></ul>\n<p>å…¶ç¼ºç‚¹å°±æ˜¯æ²¡æœ‰å®Œå¤‡çš„å®˜æ–¹æ–‡æ¡£ï¼Œè¿‘å‡ å¹´éƒ½æ²¡æœ‰è¿›è¡Œè¿‡æ›´æ–°ï¼Œè€Œä¸”ç¯å¢ƒæ­å»ºèµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚</p>\n<p>è€Œå¦å¤–ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬ç”¨åˆ°çš„MinIOï¼Œå…¶ä¼˜ç‚¹å¦‚ä¸‹</p>\n<ul><li> æ€§èƒ½é«˜ï¼Œå‡†ç¡¬ä»¶æ¡ä»¶ä¸‹ä»–èƒ½è¾¾åˆ°55GB/sçš„è¯»ï¼Œ35GB/sçš„å†™é€Ÿç‡</li><li>éƒ¨ç½²è‡ªå¸¦ç®¡ç†é¡µé¢</li><li>å®ƒæ˜¯MinIO.Incè¿è¥çš„å¼€æºé¡¹ç›®ï¼Œç¤¾åŒºæ´»è·ƒåº¦é«˜</li><li>æä¾›äº†æ‰€æœ‰ä¸»æµå¼€å‘è¯­è¨€çš„SDK</li></ul>\n<p>å½“ç„¶å…¶ç¼ºç‚¹å°±æ˜¯ä¸æ”¯æŒåŠ¨æ€å¢åŠ èŠ‚ç‚¹ã€‚ </p>\n<h1>ä¸‰ï¼šMinIOç‰¹ç‚¹</h1>\n<ul><li> <p>æ•°æ®ä¿æŠ¤</p> <p>Minioä½¿ç”¨Minio Erasure Codeï¼ˆçº åˆ ç ï¼‰æ¥é˜²æ­¢ç¡¬ä»¶æ•…éšœã€‚å³ä¾¿æŸåä¸€åŠä»¥ä¸Šçš„driverï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥ä»ä¸­æ¢å¤ã€‚</p> </li><li> <p>é«˜æ€§èƒ½</p> <p>ä½œä¸ºé«˜æ€§èƒ½å¯¹è±¡å­˜å‚¨ï¼Œåœ¨æ ‡å‡†ç¡¬ä»¶æ¡ä»¶ä¸‹å®ƒèƒ½è¾¾åˆ°55GB/sçš„è¯»ã€35GB/sçš„å†™é€Ÿç‡</p> </li><li> <p>å¯æ‰©å®¹</p> <p>ä¸åŒMinIOé›†ç¾¤å¯ä»¥ç»„æˆè”é‚¦ï¼Œå¹¶å½¢æˆä¸€ä¸ªå…¨å±€çš„å‘½åç©ºé—´ï¼Œå¹¶è·¨è¶Šå¤šä¸ªæ•°æ®ä¸­å¿ƒ</p> </li><li> <p>SDKæ”¯æŒ</p> <p>åŸºäºMinioè½»é‡çš„ç‰¹ç‚¹ï¼Œå®ƒå¾—åˆ°ç±»ä¼¼Javaã€Pythonæˆ–Goç­‰è¯­è¨€çš„sdkæ”¯æŒ</p> </li><li> <p>æœ‰æ“ä½œé¡µé¢</p> <p>é¢å‘ç”¨æˆ·å‹å¥½çš„ç®€å•æ“ä½œç•Œé¢ï¼Œéå¸¸æ–¹ä¾¿çš„ç®¡ç†BucketåŠé‡Œé¢çš„æ–‡ä»¶èµ„æº</p> </li><li> <p>åŠŸèƒ½ç®€å•</p> <p>è¿™ä¸€è®¾è®¡åŸåˆ™è®©MinIOä¸å®¹æ˜“å‡ºé”™ã€æ›´å¿«å¯åŠ¨</p> </li><li> <p>ä¸°å¯Œçš„API</p> <p>æ”¯æŒæ–‡ä»¶èµ„æºçš„åˆ†äº«è¿æ¥åŠåˆ†äº«é“¾æ¥çš„è¿‡æœŸç­–ç•¥ã€å­˜å‚¨æ¡¶æ“ä½œã€æ–‡ä»¶åˆ—è¡¨è®¿é—®åŠæ–‡ä»¶ä¸Šä¼ ä¸‹è½½çš„åŸºæœ¬åŠŸèƒ½ç­‰ã€‚</p> </li><li> <p>æ–‡ä»¶å˜åŒ–ä¸»åŠ¨é€šçŸ¥</p> <p>å­˜å‚¨æ¡¶ï¼ˆBucketï¼‰å¦‚æœå‘ç”Ÿæ”¹å˜,æ¯”å¦‚ä¸Šä¼ å¯¹è±¡å’Œåˆ é™¤å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨å­˜å‚¨æ¡¶äº‹ä»¶é€šçŸ¥æœºåˆ¶è¿›è¡Œç›‘æ§ï¼Œå¹¶é€šè¿‡ä»¥ä¸‹æ–¹å¼å‘å¸ƒå‡ºå»:AMQPã€MQTTã€Elasticsearchã€Redisã€NATSã€MySQLã€Kafkaã€Webhooksç­‰ã€‚</p> </li></ul>\n<h1>å››ï¼šå®ç°æ–¹æ¡ˆ</h1>\n<p><img alt=\"3e445182f2ee4b15b758d25b9d1c3f2b.png\" src=\"image\\3e445182f2ee4b15b758d25b9d1c3f2b.png\"/></p>\n<p>        é¦–å…ˆæ ¹æ®æ–‡ç« å†…å®¹é€šè¿‡æ¨¡æ¿å¼•æ“æŠ€æœ¯ç”Ÿæˆé™æ€htmlæ–‡ä»¶ä¹‹åï¼ŒæŠŠç”Ÿæˆçš„htmlæ–‡ä»¶è®¿é—®è·¯å¾„å­˜å…¥åˆ°æ–‡ç« æ•°æ®åº“ä¸­ï¼Œå¹¶åŒæ—¶æŠŠæ–‡ä»¶å­˜å…¥åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸMinIOï¼Œå½“ç”¨æˆ·è®¿é—®æŸä¸€ç¯‡æ–‡ç« æ—¶å€™å°±ä¼šæ ¹æ®æ–‡ç« idæŸ¥è¯¢åˆ°æ•°æ®åº“ä¸­è¯¥æ–‡ç« çš„URLåœ°å€ï¼Œç„¶åå†æ ¹æ®è¯¥åœ°å€ä»MinIOè·å–æ–‡ä»¶å¹¶è¿”å›ã€‚ </p>\n<h1>äº”ï¼šåŠŸèƒ½å®ç°</h1>\n<h2>1.åˆ›å»ºå®¹å™¨</h2>\n<h3>ï¼ˆ1ï¼‰æ‹‰å–é•œåƒ</h3>\n<pre><code>docker pull minio/minio server</code></pre>\n<h3>ï¼ˆ2ï¼‰å¯åŠ¨å®¹å™¨</h3>\n<pre><code>docker run -p 9000:9000 -p 9090:9090 --name minio -d --restart=always -e \"MINIO_ROOT_USER=minio\" -e \"MINIO_ROOT_PASSWORD=minio123\" -v /home/data:/data -v /home/config:/root/.minio minio/minio server /data --console-address \":9090\"</code></pre>\n<h3>ï¼ˆ3ï¼‰ç®¡ç†æ§åˆ¶å°</h3>\n<p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥http://ä½ çš„ip:9090/loginå³å¯è¿›è¡Œç™»å½•ï¼Œè´¦å·ä¸ºminioï¼Œå¯†ç ä¸ºminio123</p>\n<p><img alt=\"98e098aa6629444985d5d481d4b9248d.png\" src=\"image\\98e098aa6629444985d5d481d4b9248d.png\"/></p>\n<h3>ï¼ˆ4ï¼‰åˆ›å»ºæ¡¶</h3>\n<p><img alt=\"8593848162174684b877547d192cc1fe.png\" src=\"image\\8593848162174684b877547d192cc1fe.png\"/></p>\n<p>ç‚¹å‡»Create Bucketåˆ›å»ºä¸€ä¸ªåä¸ºheadlinesçš„æ¡¶</p>\n<h2>2.å°è£…MinIOä¸ºStart</h2>\n<h3>ï¼ˆ1ï¼‰æ¨¡å—åˆ›å»º</h3>\n<p><img alt=\"afc12cf911a84ad5857644b0ea4490ad.png\" src=\"image\\afc12cf911a84ad5857644b0ea4490ad.png\"/></p>\n<p>å¯¼å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p>\n<pre><code class=\"language-XML\">&lt;dependencies&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;io.minio&lt;/groupId&gt;\n        &lt;artifactId&gt;minio&lt;/artifactId&gt;\n        &lt;version&gt;7.1.0&lt;/version&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;\n        &lt;optional&gt;true&lt;/optional&gt;\n    &lt;/dependency&gt;\n    &lt;dependency&gt;\n        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;\n    &lt;/dependency&gt;\n&lt;/dependencies&gt;</code></pre>\n<h3>ï¼ˆ2ï¼‰é…ç½®ç±»</h3>\n<p>MinIOConfigProperties</p>\n<pre><code class=\"language-java\">package com.my.file.config;\n\n\nimport lombok.Data;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\n\nimport java.io.Serializable;\n\n@Data\n@ConfigurationProperties(prefix = \"minio\")  // æ–‡ä»¶ä¸Šä¼  é…ç½®å‰ç¼€file.oss\npublic class MinIOConfigProperties implements Serializable {\n\n    private String accessKey;\n    private String secretKey;\n    private String bucket;\n    private String endpoint;\n    private String readPath;\n}\n</code></pre>\n<p>MinIOConfig </p>\n<pre><code class=\"language-java\">package com.my.file.config;\n\nimport com.my.file.service.FileStorageService;\nimport io.minio.MinioClient;\nimport lombok.Data;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n\n@Data\n@Configuration\n@EnableConfigurationProperties({MinIOConfigProperties.class})\n//å½“å¼•å…¥FileStorageServiceæ¥å£æ—¶\n@ConditionalOnClass(FileStorageService.class)\npublic class MinIOConfig {\n\n    @Autowired\n    private MinIOConfigProperties minIOConfigProperties;\n\n    @Bean\n    public MinioClient buildMinioClient() {\n        return MinioClient\n                .builder()\n                .credentials(minIOConfigProperties.getAccessKey(), minIOConfigProperties.getSecretKey())\n                .endpoint(minIOConfigProperties.getEndpoint())\n                .build();\n    }\n}</code></pre>\n<h3>ï¼ˆ3ï¼‰å°è£…æ“ä½œMinIOç±»</h3>\n<p> FileStorageService</p>\n<pre><code class=\"language-java\">package com.my.file.service;\n\nimport java.io.InputStream;\n\n/**\n * @author itheima\n */\npublic interface FileStorageService {\n\n\n    /**\n     *  ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶\n     * @param prefix  æ–‡ä»¶å‰ç¼€\n     * @param filename  æ–‡ä»¶å\n     * @param inputStream æ–‡ä»¶æµ\n     * @return  æ–‡ä»¶å…¨è·¯å¾„\n     */\n    public String uploadImgFile(String prefix, String filename,InputStream inputStream);\n\n    /**\n     *  ä¸Šä¼ htmlæ–‡ä»¶\n     * @param prefix  æ–‡ä»¶å‰ç¼€\n     * @param filename   æ–‡ä»¶å\n     * @param inputStream  æ–‡ä»¶æµ\n     * @return  æ–‡ä»¶å…¨è·¯å¾„\n     */\n    public String uploadHtmlFile(String prefix, String filename,InputStream inputStream);\n\n    /**\n     * åˆ é™¤æ–‡ä»¶\n     * @param pathUrl  æ–‡ä»¶å…¨è·¯å¾„\n     */\n    public void delete(String pathUrl);\n\n    /**\n     * ä¸‹è½½æ–‡ä»¶\n     * @param pathUrl  æ–‡ä»¶å…¨è·¯å¾„\n     * @return\n     *\n     */\n    public byte[]  downLoadFile(String pathUrl);\n\n}\n</code></pre>\n<pre>MinIOFileStorageService</pre>\n<pre><code class=\"language-java\">package com.my.file.service.impl;\n\n\nimport com.my.file.config.MinIOConfig;\nimport com.my.file.config.MinIOConfigProperties;\nimport com.my.file.service.FileStorageService;\nimport io.minio.GetObjectArgs;\nimport io.minio.MinioClient;\nimport io.minio.PutObjectArgs;\nimport io.minio.RemoveObjectArgs;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.boot.context.properties.EnableConfigurationProperties;\nimport org.springframework.context.annotation.Import;\nimport org.springframework.stereotype.Service;\nimport org.springframework.util.StringUtils;\n\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.text.SimpleDateFormat;\nimport java.util.Date;\n\n@Slf4j\n@EnableConfigurationProperties(MinIOConfigProperties.class)\n@Import(MinIOConfig.class)\n@Service\npublic class MinIOFileStorageService implements FileStorageService {\n\n    @Autowired\n    private MinioClient minioClient;\n\n    @Autowired\n    private MinIOConfigProperties minIOConfigProperties;\n\n    private final static String separator = \"/\";\n\n    /**\n     * @param dirPath\n     * @param filename  yyyy/mm/dd/file.jpg\n     * @return\n     */\n    public String builderFilePath(String dirPath,String filename) {\n        StringBuilder stringBuilder = new StringBuilder(50);\n        if(!StringUtils.isEmpty(dirPath)){\n            stringBuilder.append(dirPath).append(separator);\n        }\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy/MM/dd\");\n        String todayStr = sdf.format(new Date());\n        stringBuilder.append(todayStr).append(separator);\n        stringBuilder.append(filename);\n        return stringBuilder.toString();\n    }\n\n    /**\n     *  ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶\n     * @param prefix  æ–‡ä»¶å‰ç¼€\n     * @param filename  æ–‡ä»¶å\n     * @param inputStream æ–‡ä»¶æµ\n     * @return  æ–‡ä»¶å…¨è·¯å¾„\n     */\n    @Override\n    public String uploadImgFile(String prefix, String filename,InputStream inputStream) {\n        String filePath = builderFilePath(prefix, filename);\n        try {\n            PutObjectArgs putObjectArgs = PutObjectArgs.builder()\n                    .object(filePath)\n                    .contentType(\"image/jpg\")\n                    .bucket(minIOConfigProperties.getBucket()).stream(inputStream,inputStream.available(),-1)\n                    .build();\n            minioClient.putObject(putObjectArgs);\n            StringBuilder urlPath = new StringBuilder(minIOConfigProperties.getReadPath());\n            urlPath.append(separator+minIOConfigProperties.getBucket());\n            urlPath.append(separator);\n            urlPath.append(filePath);\n            return urlPath.toString();\n        }catch (Exception ex){\n            log.error(\"minio put file error.\",ex);\n            throw new RuntimeException(\"ä¸Šä¼ æ–‡ä»¶å¤±è´¥\");\n        }\n    }\n\n    /**\n     *  ä¸Šä¼ htmlæ–‡ä»¶\n     * @param prefix  æ–‡ä»¶å‰ç¼€\n     * @param filename   æ–‡ä»¶å\n     * @param inputStream  æ–‡ä»¶æµ\n     * @return  æ–‡ä»¶å…¨è·¯å¾„\n     */\n    @Override\n    public String uploadHtmlFile(String prefix, String filename,InputStream inputStream) {\n        String filePath = builderFilePath(prefix, filename);\n        try {\n            PutObjectArgs putObjectArgs = PutObjectArgs.builder()\n                    .object(filePath)\n                    .contentType(\"text/html\")\n                    .bucket(minIOConfigProperties.getBucket()).stream(inputStream,inputStream.available(),-1)\n                    .build();\n            minioClient.putObject(putObjectArgs);\n            StringBuilder urlPath = new StringBuilder(minIOConfigProperties.getReadPath());\n            urlPath.append(separator+minIOConfigProperties.getBucket());\n            urlPath.append(separator);\n            urlPath.append(filePath);\n            return urlPath.toString();\n        }catch (Exception ex){\n            log.error(\"minio put file error.\",ex);\n            ex.printStackTrace();\n            throw new RuntimeException(\"ä¸Šä¼ æ–‡ä»¶å¤±è´¥\");\n        }\n    }\n\n    /**\n     * åˆ é™¤æ–‡ä»¶\n     * @param pathUrl  æ–‡ä»¶å…¨è·¯å¾„\n     */\n    @Override\n    public void delete(String pathUrl) {\n        String key = pathUrl.replace(minIOConfigProperties.getEndpoint()+\"/\",\"\");\n        int index = key.indexOf(separator);\n        String bucket = key.substring(0,index);\n        String filePath = key.substring(index+1);\n        // åˆ é™¤Objects\n        RemoveObjectArgs removeObjectArgs = RemoveObjectArgs.builder().bucket(bucket).object(filePath).build();\n        try {\n            minioClient.removeObject(removeObjectArgs);\n        } catch (Exception e) {\n            log.error(\"minio remove file error.  pathUrl:{}\",pathUrl);\n            e.printStackTrace();\n        }\n    }\n\n\n    /**\n     * ä¸‹è½½æ–‡ä»¶\n     * @param pathUrl  æ–‡ä»¶å…¨è·¯å¾„\n     * @return  æ–‡ä»¶æµ\n     *\n     */\n    @Override\n    public byte[] downLoadFile(String pathUrl)  {\n        String key = pathUrl.replace(minIOConfigProperties.getEndpoint()+\"/\",\"\");\n        int index = key.indexOf(separator);\n        String bucket = key.substring(0,index);\n        String filePath = key.substring(index+1);\n        InputStream inputStream = null;\n        try {\n            inputStream = minioClient.getObject(GetObjectArgs.builder().bucket(minIOConfigProperties.getBucket()).object(filePath).build());\n        } catch (Exception e) {\n            log.error(\"minio down file error.  pathUrl:{}\",pathUrl);\n            e.printStackTrace();\n        }\n\n        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();\n        byte[] buff = new byte[100];\n        int rc = 0;\n        while (true) {\n            try {\n                if (!((rc = inputStream.read(buff, 0, 100)) &gt; 0)) break;\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n            byteArrayOutputStream.write(buff, 0, rc);\n        }\n        return byteArrayOutputStream.toByteArray();\n    }\n}\n</code></pre>\n<h3>ï¼ˆ4ï¼‰å¯¹å¤–åŠ å…¥è‡ªåŠ¨é…ç½®</h3>\n<p>åœ¨resourcesä¸­æ–°å»º<code>META-INF/spring.factories</code>  </p>\n<pre><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\\n  com.my.file.service.impl.MinIOFileStorageService</code></pre>\n<p> </p>\n<p> </p>\n</div>\n</div>"}