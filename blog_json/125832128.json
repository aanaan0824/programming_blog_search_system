{"blogid": "125832128", "writerAge": "ç é¾„7å¹´", "writerBlogNum": "103", "writerCollect": "448", "writerComment": "155", "writerFan": "492", "writerGrade": "6çº§", "writerIntegral": "5969", "writerName": "ç‹ä¹å¹³", "writerProfileAdress": "writer_image\\profile_125832128.jpg", "writerRankTotal": "3740", "writerRankWeekly": "14378", "writerThumb": "279", "writerVisitNum": "1006831", "blog_read_count": "16085", "blog_time": "å·²äºÂ 2022-07-17 17:32:34Â ä¿®æ”¹", "blog_title": "å°ç±³ 12S Utra è±å¡æ°´å°ç”Ÿæˆåœ¨çº¿å·¥å…·", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"_0\"></a>å‰è¨€</h1>\n<p>æœ€è¿‘çœ‹åˆ°å°ç±³ 12S Utra çš„å‘å¸ƒï¼Œçœ‹äº†ä¸‹è¯¦æƒ…é¡µé¢ï¼Œå‘ç°æ¼”ç¤ºçš„ç…§ç‰‡éƒ½å¥½çœ‹çš„ï¼ŒåŒ…å«äº†å“ç‰Œã€è®¾å¤‡ã€é•œå¤´ã€ä½ç½®ç­‰ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\7f963a055a2547559ad610296fab7eae.png\"/><br/> ä½œä¸ºä¸€ä¸ªæ‘„å½±çˆ±å¥½è€…ï¼Œä¹Ÿå¸Œæœ›æŠŠè‡ªå·±çš„ç…§ç‰‡ä¹Ÿè¾“å‡ºè¿™äº›ä¿¡æ¯ã€‚</p>\n<p>ä½†ç›®å‰æ­¤ç±»æ°´å°å¥½åƒåªåœ¨å°ç±³ 12S Utra çš„ç¼–è¾‘å™¨é‡Œæœ‰ï¼Œæ²¡æœ‰å…¶ä»–é€”å¾„ã€‚</p>\n<p>äºæ˜¯å°±å†™äº†è¿™ä¸ªå°å·¥å…·ã€‚</p>\n<hr/>\n<h1><a id=\"_10\"></a>æ°´å°å·¥å…·</h1>\n<ul><li>åœ°å€ï¼š<a href=\"https://lecepin.github.io/gen-brand-photo-pictrue/\">https://lecepin.github.io/gen-brand-photo-pictrue/</a></li><li>Github ä»“åº“åœ°å€ï¼š<a href=\"https://github.com/lecepin/gen-brand-photo-pictrue\">https://github.com/lecepin/gen-brand-photo-pictrue</a></li></ul>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\fb8c528bcbd74e12b9cb150f6667f758.png\"/><br/> æ”¯æŒï¼š</p>\n<ul><li>è‡ªåŠ¨è¯»å–ç…§ç‰‡ exif æ•°æ®ï¼Œå¹¶è‡ªåŠ¨å¡«å†™åˆ°å›¾ç‰‡ä¸­ï¼ŒåŒ…æ‹¬å‹å·ã€å“ç‰Œã€ç„¦è·ã€å…‰åœˆã€å¿«é—¨ã€ISOã€æ‹æ‘„æ—¶é—´ã€GPS ä¿¡æ¯ã€‚</li><li>å¯æ‰‹åŠ¨ç¼–è¾‘æ°´å°å‚æ•°ã€‚</li><li>ç›®å‰æ”¯æŒ è‹¹æœã€ä½³èƒ½ã€å¤§ç–†ã€å¯Œå£«ã€åä¸ºã€è±å¡ã€å°ç±³ã€å°¼åº·ã€ç´¢å°¼ å“ç‰Œã€‚</li></ul>\n<h3><a id=\"_20\"></a>å®ç°</h3>\n<p>å®ç°ä¸Šæ¯”è¾ƒå®¹æ˜“ï¼Œå°±æ˜¯è¯»å–ç…§ç‰‡æ•°æ®çš„å‰ 4KB æ•°æ®ï¼Œè·å–ç…§ç‰‡çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ Exif æ•°æ®ã€‚</p>\n<p>æœ€è¿‘åˆšå¥½åœ¨ç”¨ Rustï¼Œäºå°±æ˜¯å°± Rust å†™äº† WebAssembly è¿›è¡Œ Exif æ•°æ®çš„è¯»å–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"prism language-rust\"><span class=\"token attribute attr-name\">#[wasm_bindgen]</span>\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">get_exif</span><span class=\"token punctuation\">(</span>raw<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">u8</span><span class=\"token operator\">&gt;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-&gt;</span> <span class=\"token class-name\">JsValue</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> exif_data<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">ExifData</span><span class=\"token operator\">&gt;</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> exifreader <span class=\"token operator\">=</span> <span class=\"token namespace\">exif<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Reader</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> bufreader <span class=\"token operator\">=</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>io<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Cursor</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>raw<span class=\"token punctuation\">.</span><span class=\"token function\">as_slice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> exif <span class=\"token operator\">=</span> exifreader<span class=\"token punctuation\">.</span><span class=\"token function\">read_from_container</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token keyword\">mut</span> bufreader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> field <span class=\"token keyword\">in</span> exif<span class=\"token punctuation\">.</span><span class=\"token function\">fields</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> <span class=\"token class-name\">Some</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> field<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Tag(Exif\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Make\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Model\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>field<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">as_str</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            exif_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExifData</span> <span class=\"token punctuation\">{<!-- --></span>\n                tag<span class=\"token punctuation\">:</span> field<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                value<span class=\"token punctuation\">:</span> field\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">display_value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n                        <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span>item<span class=\"token punctuation\">:</span> <span class=\"token keyword\">char</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\\\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\",\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">as_str</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                value_with_unit<span class=\"token punctuation\">:</span> field\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">display_value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">with_unit</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>exif<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token char\">'\"'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        exif_data<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExifData</span> <span class=\"token punctuation\">{<!-- --></span>\n            tag<span class=\"token punctuation\">:</span> field<span class=\"token punctuation\">.</span>tag<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            value<span class=\"token punctuation\">:</span> field<span class=\"token punctuation\">.</span><span class=\"token function\">display_value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            value_with_unit<span class=\"token punctuation\">:</span> field<span class=\"token punctuation\">.</span><span class=\"token function\">display_value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">with_unit</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>exif<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token class-name\">JsValue</span><span class=\"token punctuation\">::</span><span class=\"token function\">from_serde</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>exif_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>æµ‹è¯•äº†ä¸€ä¸‹ç”¨ Rust Exif ä¸ npm exif çš„æ‰§è¡Œé€Ÿåº¦ï¼š</p>\n<ul><li>Rust WebAssemblyï¼š0.6ms</li><li>Npm exif åŒ…ï¼š5.6ms</li></ul>\n<p>å¤§çº¦å¿« 10å€å·¦å³ï¼Œè¿˜æ˜¯å¾ˆå¤¸å¼ çš„ã€‚</p>\n<h3><a id=\"_76\"></a>å…¶å®ƒç¤ºä¾‹</h3>\n<p>æœ€åçœ‹ä¸‹ï¼Œä½¿ç”¨è¿™ä¸ªå·¥å…·ç”Ÿæˆçš„ç…§ç‰‡å§ã€‚</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\95c1458506bb444f8cd3e2a48b2d1e11.png\"/></p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\e7c29541793f464dac80323284b52f78.png\"/></p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\c98fc5510d9645b18c142b3439794c1f.png\"/></p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\f28b1a6a83c242fa9d93098ab2d76495.png\"/></p>\n<blockquote>\n<p><a href=\"https://github.com/lecepin/blog/blob/main/%E4%BD%BF%E7%94%A8%20Rust%20Wasm%20%E5%BC%80%E5%8F%91%E5%B0%8F%E7%B1%B3%2012S%20Utra%20%E8%8E%B1%E5%8D%A1%E6%B0%B4%E5%8D%B0%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7.md\">ğŸŒŸ Github åŸæ–‡åœ°å€</a></p>\n</blockquote>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}