{"blogid": "126735734", "writerAge": "码龄3年", "writerBlogNum": "109", "writerCollect": "2257", "writerComment": "2880", "writerFan": "10744", "writerGrade": "6级", "writerIntegral": "8239", "writerName": "农民工老王", "writerProfileAdress": "writer_image\\profile_126735734.jpg", "writerRankTotal": "1606", "writerRankWeekly": "941", "writerThumb": "2900", "writerVisitNum": "591626", "blog_read_count": "35", "blog_time": "已于 2022-09-06 23:19:18 修改", "blog_title": "故障排查：k8s节点不可用（rancher/hyperkube:v1.21.14-rancher1 Restarting）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p><strong>博客主页：https://tomcat.blog.csdn.net</strong><br/> <strong>博主昵称：农民工老王</strong><br/> <strong>主要领域：Java、Linux、K8S</strong><br/> <strong>期待大家的关注💖点赞👍收藏⭐留言💬</strong><br/> <img alt=\"家乡\" src=\"image\\2840c267020641cebbad240f854e7792.png\"/></p>\n</blockquote>\n<p></p>\n<div class=\"toc\">\n<h3>目录</h3>\n<ul><li><a href=\"#_9\">故障详情</a></li><li><a href=\"#_17\">问题原因</a></li><li><a href=\"#_20\">解决办法</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"_9\"></a>故障详情</h1>\n<p>最近在维护k8s时，遇到某一节点不可用。集群管理界面提示kubelet未启动。该集群是由rancher部署的，最近也只是重启过服务器。</p>\n<p>我登录该节点，查看了docker容器的状态，发现其中有一个镜像名为<code>rancher/hyperkube:v1.21.14-rancher1</code>的容器一直处于重启中，显示的状态为<code> Restarting (1) xx seconds ago</code>。再查看该容器的日志，看到了这样一条信息：</p>\n<blockquote>\n<p>“Failed to start ContainerManager” err=“failed to build map of initial containers from runtime: no PodsandBox found with Id ‘xxxxxxx’”</p>\n</blockquote>\n<h1><a id=\"_17\"></a>问题原因</h1>\n<p>可能的原因是，之前关闭服务器的时候比较直接，用的init 0，没有先停止docker，导致原有容器在有一定的残留文件。</p>\n<h1><a id=\"_20\"></a>解决办法</h1>\n<p>依次运行以下命令，可以解决问题。</p>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\"># 清理docker的垃圾</span>\n<span class=\"token function\">docker</span> system prune\n<span class=\"token comment\"># 重启docker</span>\nsystemctl restart <span class=\"token function\">docker</span>\n</code></pre>\n<hr/>\n<p>如需转载，请注明本文的出处：农民工老王的CSDN博客https://blog.csdn.net/monarch91 。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}