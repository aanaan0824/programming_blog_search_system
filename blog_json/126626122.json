{"blogid": "126626122", "writerAge": "ç é¾„2å¹´", "writerBlogNum": "73", "writerCollect": "1892", "writerComment": "1114", "writerFan": "6563", "writerGrade": "5çº§", "writerIntegral": "3872", "writerName": "å°è¾¹å°è¾¹ä¸ç§ƒå¤´", "writerProfileAdress": "writer_image\\profile_126626122.jpg", "writerRankTotal": "4370", "writerRankWeekly": "4004", "writerThumb": "1844", "writerVisitNum": "101934", "blog_read_count": "275", "blog_time": "å·²äºÂ 2022-09-05 19:39:55Â ä¿®æ”¹", "blog_title": "ã€Linuxã€‘å¤šçº¿ç¨‹ â€”â€” çº¿ç¨‹æ¦‚å¿µ | çº¿ç¨‹æ§åˆ¶", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-kimbie-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>å¤šçº¿ç¨‹</h3>\n<ul><li><a href=\"#1__24\">1. çº¿ç¨‹æ¦‚å¿µ</a></li><li><ul><li><a href=\"#11_Linux_26\">1.1 Linuxçº¿ç¨‹ä¸æ¥å£å…³ç³»çš„è®¤è¯†</a></li><li><a href=\"#12____39\">1.2 çº¿ç¨‹çš„ç§æœ‰ &amp; å…±æœ‰èµ„æº</a></li><li><a href=\"#13__65\">1.3 çº¿ç¨‹çš„ä¼˜ç¼ºç‚¹</a></li><li><a href=\"#14__110\">1.4 çº¿ç¨‹çš„å¼‚å¸¸</a></li></ul>\n</li><li><a href=\"#2__117\">2. çº¿ç¨‹æ§åˆ¶</a></li><li><ul><li><a href=\"#21_pthread_create__119\">2.1 pthread_create åˆ›å»ºçº¿ç¨‹</a></li><li><a href=\"#22_pthread_join__329\">2.2 pthread_join çº¿ç¨‹ç­‰å¾…</a></li><li><a href=\"#23__404\">2.3 çº¿ç¨‹ç»ˆæ­¢çš„æ–¹æ¡ˆ</a></li><li><a href=\"#24_pthrerad_detach__580\">2.4 pthrerad_detach çº¿ç¨‹åˆ†ç¦»</a></li></ul>\n</li></ul>\n</div>\n<p></p>\n<blockquote>\n<p><em>a zing never lies</em></p>\n</blockquote>\n<p>æ­£æ–‡å¼€å§‹@å°è¾¹å°è¾¹åˆ«å‘æ„</p>\n<blockquote>\n<p>çº¿ç¨‹ï¼Œæ˜¯åœ¨è¿›ç¨‹<strong>å†…éƒ¨</strong>è¿è¡Œçš„ä¸€ä¸ªæ‰§è¡Œåˆ†æ”¯(æ‰§è¡Œæµ)ï¼Œå±äºè¿›ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œç²’åº¦è¦æ¯”è¿›ç¨‹æ›´åŠ ç»†å’Œè½»é‡åŒ–ã€‚</p>\n</blockquote>\n<p>ä¸€ä¸ªè¿›ç¨‹å†…ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œè¿›ç¨‹:çº¿ç¨‹ = 1:nï¼Œæ“ä½œç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨æ›´å¤šçš„çº¿ç¨‹ï¼ŒOSå°±è¦ç®¡ç†çº¿ç¨‹ â€”â€” å…ˆæè¿°ï¼Œå†ç»„ç»‡ã€‚çº¿ç¨‹ä¹Ÿåº”è¯¥æœ‰<strong>çº¿ç¨‹æ§åˆ¶å—</strong> â€”â€” TCB(thread control block)ï¼Œå¦‚ä¸Šæ‰€è¯´æ˜¯å¸¸è§„OSçš„åšæ³•ï¼Œä¾‹å¦‚windowsï¼Œä½†æ˜¯Linuxçš„å®ç°æœ‰æ‰€ä¸åŒã€‚</p>\n<img alt=\"image-20220830212639628\" src=\"image\\image-20220830212639628.png\"/>\n<p>Linuxä¸­æ²¡æœ‰ä¸“é—¨ä¸ºçº¿ç¨‹è®¾è®¡PCBï¼Œè€Œæ˜¯<strong>ç”¨è¿›ç¨‹PCBæ¥æ¨¡æ‹Ÿã€‚</strong></p>\n<p>è¿™æ ·ä»¥æ¥ï¼Œå°±ä¸ç”¨ç»´æŠ¤è¿›ç¨‹å’Œçº¿ç¨‹å¤æ‚çš„å…³ç³»ï¼Œä¸ç”¨å•ç‹¬ä¸ºçº¿ç¨‹æ¶‰åŠä»»ä½•ç®—æ³•ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨è¿›ç¨‹çš„ä¸€å¥—ç›¸å…³ç®—æ³•ï¼ŒOSåªéœ€è¦èšç„¦åœ¨çº¿ç¨‹é—´çš„èµ„æºåˆ†é…ä¸Šã€‚</p>\n<blockquote>\n<p>çº¿ç¨‹ï¼Œæ˜¯åœ¨è¿›ç¨‹<u>å†…éƒ¨</u>(çº¿ç¨‹åœ¨è¿›ç¨‹çš„åœ°å€ç©ºé—´å†…æ‰§è¡Œ)è¿è¡Œçš„ä¸€ä¸ª<u>æ‰§è¡Œåˆ†æ”¯</u>(æ‰§è¡Œæµ)(CPUè°ƒåº¦æ—¶åªçœ‹PCBï¼Œæ¯ä¸€ä¸ªPCBæ›¾ç»è¢«æŒ‡æ´¾è¿‡æŒ‡å‘æ–¹æ³•å’Œæ•°æ®ï¼ŒCPUå¯ä»¥ç›´æ¥è°ƒåº¦)ï¼Œå±äº<u>è¿›ç¨‹</u>çš„ä¸€éƒ¨åˆ†(ä»Šå¤©çš„è¿›ç¨‹vsè¿‡å»çš„è¿›ç¨‹)ï¼Œç²’åº¦è¦æ¯”è¿›ç¨‹æ›´åŠ ç»†å’Œè½»é‡åŒ–ã€‚</p>\n<p>ä¹‹å‰çš„è¿›ç¨‹ï¼Œæ˜¯å†…éƒ¨åªåŒ…å«ä¸€ä¸ªæ‰§è¡Œæµçš„è¿›ç¨‹ï¼›ä»Šå¤©çš„è¿›ç¨‹ï¼Œå†…éƒ¨å¯ä»¥å…·æœ‰å¤šä¸ªæ‰§è¡Œæµã€‚</p>\n</blockquote>\n<p>åˆ›å»ºè¿›ç¨‹éœ€è¦åˆ›å»ºPCBã€åœ°å€ç©ºé—´ã€é¡µè¡¨ï¼ŒåŠ è½½æ•°æ®å’Œä»£ç ï¼Œæ„å»ºæ˜ å°„å…³ç³»ï¼Œæ–‡ä»¶ç­‰ç­‰ï¼›è€Œåˆ›å»ºçº¿ç¨‹ï¼Œåªéœ€è¦åˆ›å»ºPCBã€‚åˆ›å»ºè¿›ç¨‹çš„æˆæœ¬(ç©ºé—´+æ—¶é—´)éå¸¸é«˜ï¼Œè¦ä½¿ç”¨çš„èµ„æºéå¸¸å¤š(0â†’1)ï¼</p>\n<p>å†…æ ¸è§†è§’ï¼šè¿›ç¨‹æ˜¯æ‰¿æ‹…åˆ†é…ç³»ç»Ÿèµ„æºçš„åŸºæœ¬å®ä½“ï¼ï¼<strong>çº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ï¼Œæ‰¿æ‹…è¿›ç¨‹èµ„æºçš„ä¸€éƒ¨åˆ†åŸºæœ¬å®ä½“ï¼Œå³è¿›ç¨‹åˆ’åˆ†èµ„æºç»™çº¿ç¨‹ã€‚</p>\n<h1><a id=\"1__24\"></a>1. çº¿ç¨‹æ¦‚å¿µ</h1>\n<h2><a id=\"11_Linux_26\"></a>1.1 Linuxçº¿ç¨‹ä¸æ¥å£å…³ç³»çš„è®¤è¯†</h2>\n<p>Linux PCB &lt;= ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„è¿›ç¨‹PCB</p>\n<ul><li>OSå±‚é¢ä¸Šï¼Œåˆ›å»ºâ€œçº¿ç¨‹â€æ—¶æ›´è½»é‡åŒ–</li><li>CPUè°ƒåº¦</li></ul>\n<p>Linuxçš„è¿›ç¨‹ï¼Œä¸€èˆ¬ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p>\n<p>Linuxå› ä¸ºæ˜¯ç”¨è¿›ç¨‹æ¨¡æ‹Ÿçš„ï¼Œæ‰€ä»¥Linux<strong>ä¸ä¼šç»™æˆ‘ä»¬æä¾›ç›´æ¥æ“ä½œçº¿ç¨‹çš„æ¥å£</strong>ï¼Œ<strong>è€Œæ˜¯</strong>ç»™æˆ‘ä»¬æä¾›åœ¨åŒä¸€ä¸ªåœ°å€ç©ºé—´åˆ›å»ºPCBçš„æ–¹æ³•ï¼Œåˆ†é…èµ„æºç»™æŒ‡å®šçš„PCBçš„æ¥å£ã€‚è¿™å¯¹ç”¨æˆ·(ç³»ç»Ÿçº§åˆ«çš„å·¥ç¨‹å¸ˆ)ç‰¹åˆ«ä¸å‹å¥½ï¼ï¼æ‰€ä»¥ä»–ä»¬åœ¨ç”¨æˆ·å±‚å¯¹Linuxè½»é‡çº§è¿›ç¨‹æ¥å£è¿›è¡Œå°è£…ï¼Œç»™æˆ‘ä»¬æ‰“åŒ…æˆåº“ï¼Œè®©æˆ‘ä»¬ç›´æ¥ä½¿ç”¨åº“æ¥å£ â€”â€” <strong>åŸç”Ÿçº¿ç¨‹åº“</strong>pthread(ç”¨æˆ·å±‚)</p>\n<h2><a id=\"12____39\"></a>1.2 çº¿ç¨‹çš„ç§æœ‰ &amp; å…±æœ‰èµ„æº</h2>\n<p>æ‰€æœ‰çš„è½»é‡çº§è¿›ç¨‹(å¯èƒ½æ˜¯â€œçº¿ç¨‹â€)ï¼Œéƒ½æ˜¯åœ¨è¿›ç¨‹çš„å†…éƒ¨è¿è¡Œ(åœ°å€ç©ºé—´ï¼šè¡¨ç¤ºè¿›ç¨‹æ‰€èƒ½çœ‹åˆ°çš„å¤§éƒ¨åˆ†èµ„æº)</p>\n<p>è¿›ç¨‹ï¼Œå…·æœ‰ç‹¬ç«‹æ€§ï¼Œå¯ä»¥æœ‰éƒ¨åˆ†å…±äº«èµ„æº(ç®¡é“ã€ipcèµ„æº)ï¼›çº¿ç¨‹ï¼Œå¤§éƒ¨åˆ†èµ„æºæ˜¯å…±äº«çš„ï¼Œä¹Ÿå¯ä»¥æœ‰éƒ¨åˆ†èµ„æºæ˜¯â€œç§æœ‰â€(pcbã€<strong>æ ˆã€ä¸Šä¸‹æ–‡</strong>)</p>\n<p><strong>çº¿ç¨‹çš„ç§æœ‰èµ„æº</strong></p>\n<ul><li>çº¿ç¨‹ID</li><li>ä¸€ç»„å¯„å­˜å™¨(<strong>ä¸Šä¸‹æ–‡</strong>)</li><li><strong>æ ˆ</strong></li><li>errno</li><li>ä¿¡å·å±è”½å­—</li><li>è°ƒåº¦ä¼˜å…ˆçº§</li></ul>\n<p><strong>çº¿ç¨‹çš„å…±äº«èµ„æº</strong></p>\n<ul><li><strong>æ–‡ä»¶æè¿°ç¬¦è¡¨</strong></li><li>æ¯ç§ä¿¡å·çš„å¤„ç†æ–¹å¼ (SIG_ IGNã€SIG_ DFLæˆ–è€…è‡ªå®šä¹‰çš„ä¿¡å·å¤„ç†å‡½æ•°)</li><li>å½“å‰å·¥ä½œç›®å½•</li><li>ç”¨æˆ·idå’Œç»„id</li></ul>\n<h2><a id=\"13__65\"></a>1.3 çº¿ç¨‹çš„ä¼˜ç¼ºç‚¹</h2>\n<p><strong>çº¿ç¨‹çš„ä¼˜ç‚¹</strong></p>\n<ul><li> <p>åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹çš„ä»£ä»·è¦æ¯”åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹å°å¾—å¤š</p> </li><li> <p>ä¸è¿›ç¨‹ä¹‹é—´çš„åˆ‡æ¢ç›¸æ¯”ï¼Œçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éœ€è¦æ“ä½œç³»ç»Ÿåšçš„å·¥ä½œè¦å°‘å¾ˆå¤š</p> </li><li> <p>çº¿ç¨‹å ç”¨çš„èµ„æºè¦æ¯”è¿›ç¨‹å°‘å¾ˆå¤š</p> </li><li> <p>èƒ½å……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨çš„å¯å¹¶è¡Œæ•°é‡(å¤šè¿›ç¨‹)</p> </li><li> <p>åœ¨ç­‰å¾…æ…¢é€ŸI/Oæ“ä½œç»“æŸçš„åŒæ—¶ï¼Œç¨‹åºå¯æ‰§è¡Œå…¶ä»–çš„è®¡ç®—ä»»åŠ¡(å¤šè¿›ç¨‹)</p> </li><li> <p><strong>è®¡ç®—å¯†é›†å‹</strong>åº”ç”¨ (åŠ å¯†ã€å¤§æ•°æ®è¿ç®—ç­‰ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯CPUèµ„æº)ï¼Œä¸ºäº†èƒ½åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šè¿è¡Œï¼Œå°†è®¡ç®—åˆ†è§£åˆ°å¤šä¸ªçº¿ç¨‹ä¸­å®ç°ã€‚çº¿ç¨‹æ˜¯è¶Šå¤šè¶Šå¥½å˜›ï¼Ÿä¸ä¸€å®šçš„ï¼Œå¦‚æœçº¿ç¨‹å¤ªå¤šä¼šå¯¼è‡´çº¿ç¨‹è¢«è¿‡åº¦è°ƒåº¦åˆ‡æ¢ï¼Œè¿™ä¹Ÿæ˜¯æœ‰æˆæœ¬çš„ã€‚</p> </li><li> <p><strong>I/Oå¯†é›†å‹</strong>åº”ç”¨ (ç½‘ç»œä¸‹è½½ã€äº‘ç›˜ã€SSHã€åœ¨çº¿ç›´æ’­ã€çœ‹ç”µå½±ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯å†…å­˜å’Œå¤–è®¾çš„IOèµ„æº)ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå°†å„çº¿ç¨‹ç­‰å¾…I/Oæ“ä½œçš„æ—¶é—´é‡å ã€‚çº¿ç¨‹å¯ä»¥åŒæ—¶ç­‰å¾…ä¸åŒçš„I/Oæ“ä½œã€‚çº¿ç¨‹æ˜¯ä¸æ˜¯è¶Šå¤šè¶Šå¥½å‘¢ï¼Ÿä¸ä¸€å®šå•Šå–‚ï¼Œä¸è¿‡IOå…è®¸å¤šä¸€äº›çº¿ç¨‹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†çš„æ—¶é—´æ˜¯ç­‰å¾…IOå°±ç»ªçš„ã€‚</p> <p>å¾ˆå¤šåº”ç”¨éƒ½æ˜¯CPU_IOå¯†é›†å‹çš„ï¼Œä¾‹å¦‚ç½‘ç»œæ¸¸æˆ</p> </li></ul>\n<p><strong>çº¿ç¨‹çš„ç¼ºç‚¹</strong></p>\n<ul><li> <p>æ€§èƒ½æŸå¤±</p> <p>ä¸€ä¸ªå¾ˆå°‘è¢«å¤–éƒ¨äº‹ä»¶é˜»å¡çš„è®¡ç®—å¯†é›†å‹çº¿ç¨‹å¾€å¾€æ— æ³•ä¸å…±å®ƒçº¿ç¨‹å…±äº«åŒä¸€ä¸ªå¤„ç†å™¨ã€‚å¦‚æœè®¡ç®—å¯†é›†å‹çº¿ç¨‹çš„æ•°é‡æ¯”å¯ç”¨çš„å¤„ç†å™¨å¤šï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæœ‰è¾ƒå¤§çš„æ€§èƒ½æŸå¤±ï¼Œè¿™é‡Œçš„æ€§èƒ½æŸå¤±æŒ‡çš„æ˜¯å¢åŠ äº†é¢å¤–çš„åŒæ­¥å’Œè°ƒåº¦å¼€é”€ï¼Œè€Œå¯ç”¨çš„èµ„æºä¸å˜(å¤šè¿›ç¨‹)</p> </li><li> <p><strong>å¥å£®æ€§é™ä½</strong> (compared withè¿›ç¨‹ - ç‹¬ç«‹æ€§)</p> <p>ç¼–å†™å¤šçº¿ç¨‹éœ€è¦æ›´å…¨é¢æ›´æ·±å…¥çš„è€ƒè™‘ï¼Œåœ¨ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºé‡Œï¼Œå› æ—¶é—´åˆ†é…ä¸Šçš„ç»†å¾®åå·®æˆ–è€…å› å…±äº«äº†ä¸è¯¥å…±äº«çš„å˜é‡è€Œé€ æˆä¸è‰¯å½±å“çš„å¯èƒ½æ€§æ˜¯å¾ˆå¤§çš„ï¼Œæ¢å¥è¯è¯´çº¿ç¨‹ä¹‹é—´æ˜¯ç¼ºä¹ä¿æŠ¤çš„ã€‚åæ–‡éªŒè¯ã€‚</p> </li><li> <p>ç¼ºä¹è®¿é—®æ§åˆ¶</p> <p>è¿›ç¨‹æ˜¯è®¿é—®æ§åˆ¶çš„åŸºæœ¬ç²’åº¦ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨æŸäº›OSå‡½æ•°ä¼šå¯¹æ•´ä¸ªè¿›ç¨‹é€ æˆå½±å“ã€‚</p> </li><li> <p>ç¼–ç¨‹éš¾åº¦æé«˜</p> <p>ç¼–å†™ä¸<u>è°ƒè¯•</u>ä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºæ¯”å•çº¿ç¨‹ç¨‹åºå›°éš¾å¾—å¤š</p> </li><li> <p>åˆç†çš„ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œèƒ½æé«˜CPUå¯†é›†å‹ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡</p> </li><li> <p>åˆç†çš„ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œèƒ½æé«˜IOå¯†é›†å‹ç¨‹åºçš„ç”¨æˆ·ä½“éªŒï¼ˆå¦‚ç”Ÿæ´»ä¸­æˆ‘ä»¬ä¸€è¾¹å†™ä»£ç ä¸€è¾¹ä¸‹è½½å¼€å‘å·¥å…·ï¼Œå°±æ˜¯å¤šçº¿ç¨‹è¿è¡Œçš„ä¸€ç§è¡¨ç°ï¼‰</p> </li></ul>\n<h2><a id=\"14__110\"></a>1.4 çº¿ç¨‹çš„å¼‚å¸¸</h2>\n<ul><li><strong>å•ä¸ªçº¿ç¨‹å´©æºƒ</strong>(å¦‚æœå‡ºç°é™¤é›¶ï¼Œé‡æŒ‡é’ˆé—®é¢˜)ï¼Œè¿›ç¨‹ä¹Ÿä¼šéšç€å´©æºƒï¼Œå› ä¸ºç»ˆæ­¢è¿›ç¨‹æ˜¯å‘é€ä¿¡å·çš„ï¼Œä¿¡å·æ˜¯å‘ç»™è¿›ç¨‹çš„ï¼Œè¿›ç¨‹çš„èµ„æºå°±è¢«é‡Šæ”¾äº†ã€‚</li><li>çº¿ç¨‹æ˜¯è¿›ç¨‹çš„æ‰§è¡Œåˆ†æ”¯ï¼Œçº¿ç¨‹å‡ºå¼‚å¸¸ï¼Œå°±ç±»ä¼¼è¿›ç¨‹å‡ºå¼‚å¸¸ï¼Œè¿›è€Œè§¦å‘ä¿¡å·æœºåˆ¶ï¼Œç»ˆæ­¢è¿›ç¨‹ï¼Œè¿›ç¨‹ç»ˆæ­¢ï¼Œè¯¥è¿›ç¨‹å†…çš„æ‰€æœ‰çº¿ç¨‹ä¹Ÿå°±éšå³é€€å‡º</li></ul>\n<h1><a id=\"2__117\"></a>2. çº¿ç¨‹æ§åˆ¶</h1>\n<h2><a id=\"21_pthread_create__119\"></a>2.1 pthread_create åˆ›å»ºçº¿ç¨‹</h2>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;pthread.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">pthread_t</span> <span class=\"token operator\">*</span>thread<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\">pthread_attr_t</span> <span class=\"token operator\">*</span>attr<span class=\"token punctuation\">,</span>\n                  <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>start_routine<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>Compile and link with -pthread. äº‹å®ä¸Šè¿™å°±æ˜¯ç¬¬ä¸‰æ–¹åº“</p>\n<p>è¿”å›å€¼ï¼šOn success, pthread_create() returns 0; on error, it returns an error number</p>\n<p>å‚æ•°ï¼š</p>\n<ul><li><code>thread</code>ï¼šçº¿ç¨‹IDï¼Œæ— ç¬¦å·(é•¿)æ•´æ•°ï¼Œä¸åŒæ“ä½œç³»ç»Ÿæœ‰å·®åˆ«ã€‚</li><li><code>attr</code>ï¼šçº¿ç¨‹å±æ€§ã€‚è®¾ä¸º<code>NULL</code>ï¼Œäº¤ç»™æ“ä½œç³»ç»Ÿæ¥è®¾ç½®ã€‚</li><li><code>start_routine</code>ï¼šçº¿ç¨‹çš„å›è°ƒå‡½æ•°</li><li><code>arg</code>ï¼šå…¶å®å°±æ˜¯ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚</li></ul>\n<p>æ­¤æ—¶ä¾æ—§åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯è¿›ç¨‹å†…éƒ¨ä¸€å®šå…·æœ‰ä¸¤ä¸ªæ‰§è¡Œæµã€‚å‘é€<code>kill</code>ä¿¡å·ï¼Œéƒ½è¢«å¹²æ‰äº†ï¼Œè¯´æ˜ä¿¡å·æ˜¯å‘é€ç»™è¿›ç¨‹çš„ã€‚</p>\n<pre><code class=\"prism language-c\">ps <span class=\"token operator\">-</span>aL\t<span class=\"token comment\">//-LæŸ¥çœ‹è½»é‡çº§è¿›ç¨‹</span>\n</code></pre>\n<p>æˆ‘ä»¬å‘ç°ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹çš„PIDç›¸åŒï¼Œä½†ä¸åŒçš„æ˜¯<strong>LWP</strong>(light weight process è½»é‡çº§è¿›ç¨‹)ã€‚äº‹å®ä¸Šï¼ŒLinux OSè°ƒåº¦æ—¶çœ‹çš„æ˜¯LWPã€‚</p>\n<p>è¿™ä¸æˆ‘ä»¬ä¹‹å‰å•ç‹¬ä¸€ä¸ªè¿›ç¨‹çš„æƒ…å†µå¹¶ä¸çŸ›ç›¾ï¼ŒPID = LWP â†’ ä¸»çº¿ç¨‹ã€‚</p>\n<pre><code class=\"prism language-c\"><span class=\"token comment\">//obtain ID of the calling thread</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;pthread.h&gt;</span></span>\n\n<span class=\"token class-name\">pthread_t</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> id <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>args<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d: æˆ‘æ˜¯æ–°çº¿ç¨‹%s, æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>tid<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token string\">\"thread 1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d: æˆ‘æ˜¯mainçº¿ç¨‹, æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu, æˆ‘åˆ›å»ºçš„çº¿ç¨‹IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> tid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>æˆ‘ä»¬å‘ç°æ–°åˆ›å»ºçš„thread 1çº¿ç¨‹IDæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œä¸æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„LWPå¹¶ä¸ç›¸åŒ â€”â€”</p>\n<img alt=\"image-20220830212708130\" src=\"image\\image-20220830212708130.png\"/>\n<p>( è¿™æ˜¯å†…æ ¸LWPï¼Œå’Œè¿™äº›é•¿æ•´æ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ“ä½œç³»ç»Ÿå’Œçº¿ç¨‹åº“ä¸­çš„çº¿ç¨‹IDæ²¡è§„å®šå¿…é¡»ä¸€æ ·~~)</p>\n<blockquote>\n<p>ä¸‹é¢éªŒè¯ä¸€ä¸‹è¿™ä¸ªé•¿æ•´æ•°æ˜¯ä»€ä¹ˆï¼Ÿ</p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdlib.h&gt;</span></span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">{<!-- --></span>\n     <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"new thread: 0x%x\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n     <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">;</span>\n <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>tid<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token string\">\"new thread\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">{<!-- --></span>\n     <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main thread: 0x%x\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n     <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<img alt=\"image-20220830212752537\" src=\"image\\image-20220830212752537.png\"/>\n<p>æˆ‘ä»¬æŸ¥çœ‹åˆ°çš„çº¿ç¨‹IDæ˜¯pthreadåº“çš„çº¿ç¨‹IDï¼Œä¸æ˜¯Linuxå†…æ ¸ä¸­çš„LWPï¼Œpthreadåº“æ˜¯ä¸€ä¸ª<strong>å†…å­˜åœ°å€</strong>ï¼é‚£ä¸€å®šæ˜¯è™šæ‹Ÿåœ°å€ã€‚</p>\n<p>å¯ä»¥å¿«é€Ÿæ‹¿åˆ°çº¿ç¨‹çš„å±æ€§ï¼šæ˜¯ä¸€ä¸ªè¢«æ˜ å°„è¿›è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œpthreadåº“ä¸­çš„åœ°å€ â†’ çº¿ç¨‹ID</p>\n<img alt=\"image-20220831155747285\" src=\"image\\image-20220831155747285.png\"/>\n<p>é‚£ä¹ˆ â€”â€”</p>\n<img alt=\"image-20220831160334845\" src=\"image\\image-20220831160334845.png\"/>\n</blockquote>\n<p>æˆ‘ä»¬å½“ç„¶è¿˜å¯ä»¥åˆ›å»ºä¸€æ‰¹çº¿ç¨‹ â€”â€”</p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> id <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>args<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token comment\">// printf(\"%d: æˆ‘æ˜¯æ–°çº¿ç¨‹%s, æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu\\n\", getpid(), id, pthread_self());</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">5</span> <span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span>tid<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token string\">\"new thread\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯ä¸»çº¿ç¨‹, æˆ‘çš„thread_IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"=====================begin=======================\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">5</span> <span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘åˆ›å»ºçš„çº¿ç¨‹[%d]æ˜¯ï¼š%lu\\n\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> tid<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"======================end========================\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<img alt=\"image-20220831152038173\" src=\"image\\image-20220831152038173.png\"/>\n<p>æˆ‘ä»¬å†æ¥éªŒè¯ä¸€ä¸‹ï¼Œ<strong>ä¸€ä¸ªçº¿ç¨‹å´©æºƒï¼Œæ•´ä¸ªè¿›ç¨‹ç»ˆæ­¢</strong>ï¼Œå†™ä¸€æ®µä¸å¤ªä¼˜é›…çš„ä»£ç  â€”â€”</p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>args<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯æ–°çº¿ç¨‹[%d], æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>num <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token comment\">//æ•…æ„è®¾ç½®äº†é‡æŒ‡é’ˆé—®é¢˜ - å´©æºƒ</span>\n            <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"thread number: %d quit...\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">int</span><span class=\"token operator\">*</span> p <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n            <span class=\"token operator\">*</span>p <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">5</span> <span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span>tid<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<img alt=\"image-20220830213055028\" src=\"image\\image-20220830213055028.png\"/>\n<p>ç”±æ­¤å¯è§ï¼Œå¤šçº¿ç¨‹å¥å£®æ€§ä¸å¼ºã€‚</p>\n<h2><a id=\"22_pthread_join__329\"></a>2.2 pthread_join çº¿ç¨‹ç­‰å¾…</h2>\n<p>ä¸€èˆ¬è€Œè¨€ï¼Œçº¿ç¨‹ä¹Ÿæ˜¯éœ€è¦è¢«ç­‰å¾…çš„ï¼Œå¦‚æœä¸ç­‰å¾…ï¼Œ<u>å¯èƒ½</u>ä¼šå¯¼è‡´ç±»ä¼¼â€œåƒµå°¸è¿›ç¨‹â€çš„é—®é¢˜ã€‚</p>\n<p>è¿›ç¨‹éœ€è¦ç­‰å¾…ï¼ŒåŒæ ·çš„ï¼Œåˆ›å»ºçº¿ç¨‹çš„ç›®çš„ä¹Ÿæ˜¯è®©ä»–å¸®æˆ‘åŠäº‹å„¿ï¼ŒåŠçš„æ€ä¹ˆæ ·ä¹Ÿéœ€è¦çŸ¥é“ï¼›å¦å¤–ï¼Œçº¿ç¨‹å¤ç”¨äº†PCBç»“æ„ï¼Œé€€å‡ºç é€€å‡ºä¿¡å·ä¹Ÿéœ€è¦å¡«å…¥PCBã€‚</p>\n<p>ğŸ’› â€‹<strong>join with a terminated thread</strong></p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;pthread.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">pthread_join</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">pthread_t</span> thread<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token operator\">*</span>retval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nCompile and link with <span class=\"token operator\">-</span>pthread<span class=\"token punctuation\">.</span>\n</code></pre>\n<p>è¿”å›å€¼ï¼šOn success, pthread_join() returns <strong>0</strong>; on error, it returns an error number.</p>\n<p>å‚æ•°ï¼š</p>\n<ul><li> <p><code>thread</code>ï¼šç­‰å¾…å“ªä¸ªçº¿ç¨‹ã€‚å°±æ˜¯æˆ‘ä»¬åˆšæ‰pthread_self()è·å–çš„é•¿æ•´æ•°ã€‚</p> </li><li> <p><code>retval</code>ï¼šè¾“å‡ºå‹å‚æ•°ï¼Œç”¨äº<strong>è·å–</strong>æ–°çº¿ç¨‹<strong>é€€å‡ºæ—¶çš„è¿”å›å€¼</strong> â†“ å½“ç„¶äº†~ ä¸è¦è®¤ä¸ºè¿™å„¿çš„è¿”å›å€¼åªæ˜¯æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å˜é‡/å¯¹è±¡çš„åœ°å€ï¼Œä½†ä¸èƒ½æ˜¯ä¸´æ—¶çš„ã€‚</p> <p>æˆ‘ä»¬çŸ¥é“è¿›ç¨‹é€€å‡ºæ— éä¸‰ç§æƒ…å†µï¼šâ‘ ä»£ç è·‘å®Œç»“æœå¯¹ â‘¡ä»£ç è·‘å®Œç»“æœä¸å¯¹ â‘¢å¼‚å¸¸ã€‚è¿›ç¨‹é‚£é‡Œæœ‰é€€å‡ºç ï¼Œåœ¨å¤šè¿›ç¨‹è¿™å„¿å°±æ˜¯é€šè¿‡**<code>void*</code>è¿”å›å€¼<strong>å¾—çŸ¥</strong>æ‰§è¡Œç»“æœ**ã€‚é‚£ä¹ˆä»£ç å¼‚å¸¸å¦‚ä½•å¤„ç†ï¼Ÿäº‹å®ä¸Šï¼Œæ ¹æœ¬ä¸éœ€è¦å¤„ç†ï¼Œå› ä¸ºè¿™æ˜¯è¿›ç¨‹çš„äº‹å„¿ã€‚</p> </li></ul>\n<p>é‚£ä¹ˆå½“ç„¶å°±å¯ä»¥é€šè¿‡è¿”å›å€¼å¾—çŸ¥çº¿ç¨‹æ‰§è¡Œçš„æ€ä¹ˆæ ·äº† â€”â€”</p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>args<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯æ–°çº¿ç¨‹[%d], æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//æ–°çº¿ç¨‹è·‘å®Œ</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">111</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">NUM</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">[</span>NUM<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> NUM <span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span>tid<span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//void* - å 8ä¸ªå­—èŠ‚ - æŒ‡é’ˆå˜é‡ï¼Œæœ¬èº«å°±å¯ä»¥å……å½“æŸç§å®¹å™¨ä¿å­˜æ•°æ®</span>\n    <span class=\"token keyword\">void</span><span class=\"token operator\">*</span> status  <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">pthread_join</span><span class=\"token punctuation\">(</span>tid<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ret: %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h2><a id=\"23__404\"></a>2.3 çº¿ç¨‹ç»ˆæ­¢çš„æ–¹æ¡ˆ</h2>\n<ol><li>å‡½æ•°ä¸­return \n  <ul><li>mainå‡½æ•°returnçš„æ—¶å€™ä»£è¡¨ä¸»çº¿ç¨‹/è¿›ç¨‹é€€å‡º</li><li>å…¶ä»–çº¿ç¨‹å‡½æ•°returnåªä»£è¡¨å½“å‰çº¿ç¨‹é€€å‡º</li></ul> </li><li>æ–°çº¿ç¨‹é€šè¿‡pthread_exit()ç»ˆæ­¢è‡ªå·±</li></ol>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;pthread.h&gt;</span></span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">pthread_exit</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>retval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>terminate calling thread ç›¸å½“äºreturn</p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdlib.h&gt;</span></span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>args<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯æ–°çº¿ç¨‹[%d], æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//æ–°çº¿ç¨‹è·‘å®Œ</span>\n    <span class=\"token function\">pthread_exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">123</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">NUM</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">[</span>NUM<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> NUM <span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span>tid<span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">void</span><span class=\"token operator\">*</span> status  <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">pthread_join</span><span class=\"token punctuation\">(</span>tid<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ret: %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<img alt=\"image-20220830213110446\" src=\"image\\image-20220830213110446.png\"/>\n<p>è¿™å’Œæˆ‘ä»¬ä¹‹å‰çš„exit()æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ<strong>exitæ˜¯ç»ˆæ­¢è¿›ç¨‹</strong>ï¼Œå¦‚æœä½ åªæƒ³ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹çš„è¯ï¼Œä¸è¦åœ¨å…¶å®ƒçº¿ç¨‹ä¸­è°ƒç”¨ã€‚</p>\n<ol start=\"3\"><li>å–æ¶ˆç›®æ ‡è¿›ç¨‹ send a cancellation request to a thread</li></ol>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;pthread.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">pthread_cancel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">pthread_t</span> thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nCompile and link with <span class=\"token operator\">-</span>pthread<span class=\"token punctuation\">.</span>\n</code></pre>\n<p>æˆ‘ä»¬å‘ç°ï¼Œè¿›ç¨‹è¢«å–æ¶ˆæ—¶ï¼Œè¿”å›å€¼æ˜¯-1</p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>args<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯æ–°çº¿ç¨‹[%d], æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// break;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//æ–°çº¿ç¨‹è·‘å®Œ</span>\n    <span class=\"token comment\">// return (void*)111;</span>\n    <span class=\"token comment\">// pthread_exit((void*)123);</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">NUM</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">[</span>NUM<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> NUM <span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span>tid<span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wait sub thread...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cancal sub thread...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token function\">pthread_cancel</span><span class=\"token punctuation\">(</span>tid<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">void</span><span class=\"token operator\">*</span> status  <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">pthread_join</span><span class=\"token punctuation\">(</span>tid<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ret: %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<img alt=\"image-20220830213157633\" src=\"image\\image-20220830213157633.png\"/>\n<p>é‚£å¦‚æœç”¨æ–°çº¿ç¨‹å–æ¶ˆä¸»çº¿ç¨‹å‘¢ï¼Ÿ</p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n\n<span class=\"token class-name\">pthread_t</span> g_id<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>args<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯æ–°çº¿ç¨‹[%d], æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">pthread_cancel</span><span class=\"token punctuation\">(</span>g_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">NUM</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    g_id <span class=\"token operator\">=</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">[</span>NUM<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> NUM <span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span>tid<span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wait sub thread...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cancal sub thread...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token function\">pthread_cancel</span><span class=\"token punctuation\">(</span>tid<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span><span class=\"token operator\">*</span> status  <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">pthread_join</span><span class=\"token punctuation\">(</span>tid<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ret: %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>æˆ‘ä»¬å‘ç°ä¸»çº¿ç¨‹å˜ä¸º &lt; defunct &gt;ï¼Œç±»ä¼¼äºåƒµå°¸è¿›ç¨‹ï¼Œè€Œæ–°çº¿ç¨‹è¿˜æ„‰å¿«çš„è·‘ç€ï¼Œè¿™ä¸ä¸»å‡½æ•°returnä¸åŒï¼Œä½†æˆ‘ä»¬ä¸å»ºè®®ä¹Ÿæå°‘æœ‰æƒ…å†µéœ€è¦è¿™æ ·åš â€”â€”</p>\n<img alt=\"image-20220830213233370\" src=\"image\\image-20220830213233370.png\"/>\n<h2><a id=\"24_pthrerad_detach__580\"></a>2.4 pthrerad_detach çº¿ç¨‹åˆ†ç¦»</h2>\n<p>ç­‰å¾…ï¼Œå¦‚æœæˆ‘ä¸æƒ³ç­‰å‘¢ï¼Ÿâ€”â€” çº¿ç¨‹åˆ†ç¦»ï¼Œåˆ†ç¦»åçš„çº¿ç¨‹ä¸éœ€è¦è¢«joinï¼Œè¿è¡Œå®Œæ¯•åï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾Z-pcbï¼Œç±»æ¯”<code>signal(SIGCHLD, SIG_IGN)</code>ï¼Œç›¸å½“äºåŒä¸€å±‹æªä¸‹çš„é™Œç”Ÿäººï¼Œä½ ä¸è¦å…³å¿ƒæˆ‘å•¦ã€‚</p>\n<p>å¦‚ä½•åˆ†ç¦»ï¼Ÿ</p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;pthread.h&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">pthread_detach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">pthread_t</span> thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nCompile and link with <span class=\"token operator\">-</span>pthread<span class=\"token punctuation\">.</span>\n</code></pre>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;stdio.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;pthread.h&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span><span class=\"token string\">&lt;unistd.h&gt;</span></span>\n\n<span class=\"token class-name\">pthread_t</span> g_id<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span><span class=\"token operator\">*</span> <span class=\"token function\">thread_run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span> args<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function\">pthread_detach</span><span class=\"token punctuation\">(</span><span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> num <span class=\"token operator\">=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>args<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æˆ‘æ˜¯æ–°çº¿ç¨‹[%d], æˆ‘çš„çº¿ç¨‹IDæ˜¯%lu\\n\"</span><span class=\"token punctuation\">,</span> num<span class=\"token punctuation\">,</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">//æ–°çº¿ç¨‹è·‘å®Œ</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">111</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// pthread_exit((void*)123);</span>\n<span class=\"token punctuation\">}</span> \n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">NUM</span> <span class=\"token expression\"><span class=\"token number\">1</span></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    g_id <span class=\"token operator\">=</span> <span class=\"token function\">pthread_self</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">pthread_t</span> tid<span class=\"token punctuation\">[</span>NUM<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> NUM <span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span>tid<span class=\"token operator\">+</span>i<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> thread_run<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wait sub thread...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cancal sub thread...\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// pthread_cancel(tid[0]);</span>\n    <span class=\"token comment\">//void* - å 8ä¸ªå­—èŠ‚ - æŒ‡é’ˆå˜é‡ï¼Œæœ¬èº«å°±å¯ä»¥å……å½“æŸç§å®¹å™¨ä¿å­˜æ•°æ®</span>\n    <span class=\"token keyword\">void</span><span class=\"token operator\">*</span> status  <span class=\"token operator\">=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">int</span> ret <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> NUM<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        ret <span class=\"token operator\">=</span> <span class=\"token function\">pthread_join</span><span class=\"token punctuation\">(</span>tid<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ret: %d, status: %d\\n\"</span><span class=\"token punctuation\">,</span> ret<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>è¯´æ˜æˆ‘ä»¬<strong>pthread_joinæ˜¯å¤±è´¥çš„</strong>ï¼Œstatusä¹Ÿæ²¡æ‹¿åˆ°é€€å‡ºç»“æœ â€”â€”</p>\n<img alt=\"image-20220830213247545\" src=\"image\\image-20220830213247545.png\"/>\n<p>ä¸€ä¸ªçº¿ç¨‹è¢«è®¾ä¸ºåˆ†ç¦»åï¼Œç»å¯¹ä¸èƒ½å†joinäº†ï¼åˆ†äº†å°±æ˜¯åˆ†äº†ï¼Œåˆ«å†ç­‰æˆ‘å•¦~</p>\n<p>ä¸€èˆ¬åœºæ™¯æ˜¯ä¸»çº¿ç¨‹ä¸é€€å‡ºï¼Œæ–°çº¿ç¨‹ä¸šåŠ¡å¤„ç†å®Œæ¯•åå†é€€å‡ºã€‚</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}