{"blogid": "126710883", "writerAge": "码龄103天", "writerBlogNum": "55", "writerCollect": "4", "writerComment": "4", "writerFan": "48", "writerGrade": "3级", "writerIntegral": "557", "writerName": "1701y", "writerProfileAdress": "writer_image\\profile_126710883.jpg", "writerRankTotal": "34803", "writerRankWeekly": "7828", "writerThumb": "2", "writerVisitNum": "7033", "blog_read_count": "196", "blog_time": "于 2022-09-05 18:24:38 发布", "blog_title": "Nginx+Tomcat", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"NginxTomcat_0\"></a>Nginx+Tomcat</h1>\n<p>准备两台Tomcat和一台Nginx</p>\n<p>Nginx:192.168.116.134</p>\n<p>Tomcat1:192.168.116.131</p>\n<p>Tomcat2:192.168.116.128</p>\n<h2><a id=\"Nginx_10\"></a>编译安装Nginx</h2>\n<p>关闭防火墙</p>\n<pre><code>systemctl stop firewalld  关闭防火墙\nsystemctl disable firewalld 禁止防火墙开机自启\nsetenforce 0  关闭核心防护\n</code></pre>\n<p>安装依赖环境</p>\n<pre><code>yum -y install gcc gcc-c++ pcre-devel zlib-devel make\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-7MYgWqAo-1662373233726)(F:\\typorase\\jpg\\99.png)]\" src=\"image\\ee5cfd5481c04eddaee34710a22fc8a1.png\"/></p>\n<p>创建运行用户和组并将需要安装的软件包上传到/opt下</p>\n<pre><code>useradd -M -s /sbin/nologin nginx\n</code></pre>\n<pre><code>tar xzvf nginx-1.15.9.tar.gz\ncd nginx-1.15.9/\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-U1igJVVB-1662373233727)(F:\\typorase\\jpg\\100.png)]\" src=\"image\\c11868565ff94758be20d5e67608122b.png\"/></p>\n<pre><code>cd nginx-1.15.9/\n./configure \\\n--prefix=/usr/local/nginx \\\n--user=nginx \\\n--group=nginx \\\n--with-file-aio \\\n--with-http_stub_status_module \\\n--with-http_gzip_static_module \\\n--with-http_flv_module \\\n--with-http_ssl_module\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-rUenkrBW-1662373233727)(F:\\typorase\\jpg\\101.png)]\" src=\"image\\83be407909c548b0b1dfe37d023c7b75.png\"/></p>\n<pre><code>make &amp;&amp; make install      ##编译安装\n</code></pre>\n<p>路径优化</p>\n<p>使 Nginx 服务器的运行更加方便以便管理员直接执行“nginx”命令就可以调用 Nginx 的主程序</p>\n<pre><code>cp -r /usr/local/nginx/sbin/nginx /usr/local/sbin/nginx\n</code></pre>\n<p>添加nginx系统服务</p>\n<p>为了使 Nginx 服务的启动、停止、重载等操作更加方便，可以编写基于 CentOS 7.6 的<br/> Nginx 服务控制文件使用 systemctl 工具来进行管理,CentOS7.6 系统的管理习惯</p>\n<pre><code>vim /lib/systemd/system/nginx.service\n\n[Unit]\nDescription=nginx                    \t\t\t\t\t  ####描述\nAfter=network.target                 \t\t\t\t\t  ####描述服务类别\n[Service]\nType=forking                                              ###后台运行形式\nPIDFile=/usr/local/nginx/logs/nginx.pid                   ###PID文件位置\nExecStart=/usr/local/nginx/sbin/nginx                     ###启动服务\nExecReload=/usr/bin/kill -s HUP $MAINPID             ###根据PID重载配置\nExecStop=/usr/bin/kill -s QUIT $MAINPID                ###根据PID终止进程\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<pre><code>chmod 754 /lib/systemd/system/nginx.service\nsystemctl daemon-reload\nsystemctl start nginx.service      #开启 \nsystemctl enable nginx.service     #开启开机自启\n\n</code></pre>\n<p>在浏览器输入自己的IP地址查看</p>\n<p><img alt=\"## [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-P2UUibQa-1662373233727)(F:\\typorase\\jpg\\102.png)]\" src=\"image\\bba889f709b144d2baebcc5aff99fafa.png\"/></p>\n<h2><a id=\"Tomcat_106\"></a>Tomcat部署</h2>\n<pre><code>systemctl stop firewalld.service \nsystemctl disable firewalld.service \nsetenforce 0\n\n</code></pre>\n<p>将需要的软件包上传到/opt目录</p>\n<p>安装JDK</p>\n<pre><code>rpm -ivh jdk-8u201-linux-x64.rpm\njava -version    #查看当前系统下的java版本\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qMaf04Xe-1662373233728)(F:\\typorase\\jpg\\201.png)]\" src=\"image\\a5fcc296c9e3419eb9900e76ae3d3adb.png\"/></p>\n<p>设置JDK的环境变量</p>\n<pre><code>vim /etc/profile.d/java.sh        #/etc/profile.d/环境变量脚本目录\n\nexport JAVA_HOME=/usr/java/jdk1.8.0_201-amd64\nexport CLASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar\nexport PATH=$JAVA_HOME/bin:$PATH\n\nCLASSPATH：编译、运行Java程序时（tomcat），JRE 会去该变量指定的路径中搜索所需的类( .class)文件。\ndt.jar：是关于运行环境的类库，主要是swing 的包。\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-SnxQ8UWR-1662373233728)(F:\\typorase\\jpg\\202.png)]\" src=\"image\\58041a99ee9c4c159b99df17b26d34fb.png\"/></p>\n<p>加载一下环境，查看版本</p>\n<pre><code>source /etc/profile.d/java.sh\njava -version\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-YCIlN282-1662373233728)(F:\\typorase\\jpg\\203.png)]\" src=\"image\\6aa54e0ffd0d486cb981c2e19b2abb2e.png\"/></p>\n<p>安装tomcat软件包</p>\n<p>先解压</p>\n<pre><code>cd /opt\ntar zxvf apache-tomcat-9.0.16.tar.gz\nmv apache-tomcat-9.0.16 /usr/local/tomcat\n\ncd /usr/local/\ncd tomcat\ncatalina.sh（管理执行severlet操作）可以进行tomcat的调优——》在catalina脚本中进行-Xms -Xmx （最小和最大内存）\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-7HtnIKeR-1662373233728)(F:\\typorase\\jpg\\204.png)]\" src=\"image\\3cc269b7afdf4576a2a94f01f42cf212.png\"/></p>\n<p>目录说明：</p>\n<table><thead><tr><th>目录名称</th><th>说明</th></tr></thead><tbody><tr><td>bin</td><td>存放启动和关闭Tomcat 的脚本文件，比较常用的是catalina.sh、startup.sh、 shutdown.sh 三个文件</td></tr><tr><td>conf</td><td>存放Tomcat 服务器的各种配置文件，比较常用的是server.xml、context.xml、tomcat-users.xml web. xml 四个文件</td></tr><tr><td>lib</td><td>存放Tomcat服务器的jar 包，一般不作任何改动，除非连接第三方服务，比如redis， 那就需要添加相对应的jar包</td></tr><tr><td>logs</td><td>存放Tomcat 日志</td></tr><tr><td><strong>temp</strong></td><td><strong>存放Tomcat 运行时产生的文件</strong></td></tr><tr><td><strong>webapps</strong></td><td><strong>存放项目资源的目录</strong></td></tr><tr><td>work</td><td>Tomcat 工作目录，一般清除 Tomcat 缓存的时候会使用到</td></tr></tbody></table>\n<p>Tomcat配置文件</p>\n<table><thead><tr><th>文件名</th><th>说明</th></tr></thead><tbody><tr><td>catalina.policy</td><td>权限控制配置文件</td></tr><tr><td>catalina.properties</td><td>Tomcat的属性配置文件</td></tr><tr><td><strong>context.xml</strong></td><td><strong>上下文配置文件</strong></td></tr><tr><td>logging.properties</td><td>日志相关配置文件 log4j</td></tr><tr><td><strong>server.xml</strong></td><td><strong>主配置文件，通过配置文件，可以修改tomcat的启动端口、网站目录、虚拟主机、开启https等功能</strong></td></tr><tr><td>tomcat-user.xml/.xsd</td><td>管理用户配置文件</td></tr><tr><td>web.xml</td><td>Tomcat的servlet、servlet-mapping、filter、MIME等相关配置</td></tr></tbody></table>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-VEhhQ3vt-1662373233729)(F:\\typorase\\jpg\\206.png)]\" src=\"image\\0bfc155c59454fd2aa9c71742c1f032a.png\"/></p>\n<p>优化管理</p>\n<pre><code>ln -s /usr/local/tomcat/bin/startup.sh /usr/local/bin/\nln -s /usr/local/tomcat/bin/shutdown.sh /usr/local/bin/\n\n</code></pre>\n<p>开启服务</p>\n<pre><code>startup.sh\nnetstat -natp | grep  8080\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-vZp43lov-1662373233729)(F:\\typorase\\jpg\\207.png)]\" src=\"image\\93820928be584a41a7d2f3da4cff45ca.png\"/></p>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-SUM8W72m-1662373233729)(F:\\typorase\\jpg\\208.png)]\" src=\"image\\7072cc2dc3cc47e0a24df7c3187cc114.png\"/></p>\n<h1><a id=\"_223\"></a>动静分离配置</h1>\n<h2><a id=\"Ningx_225\"></a>Ningx配置</h2>\n<pre><code>准备静态网页\nvim /usr/local/nginx/html/index.html\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-5FUbUDhH-1662373233729)(F:\\typorase\\jpg\\219.png)]\" src=\"image\\cfa3fa9af9364db7a7689baa14f9ccb3.png\"/></p>\n<pre><code>vim /usr/local/nginx/conf/nginx.conf\n\n    #gzip  on;\n\n        upstream tomcat  {\n      server 192.168.116.131:8080 weight=1;\n      server 192.168.116.128:8080 weight=1;\n    }\n\n    server {\n        listen       80;\n        server_name  www.yan.com;\n\n        #charset koi8-r;\n\n        #access_log  logs/host.access.log  main;\n    location ~ .*\\.jsp$ {\n        proxy_pass http://tomcat;\n        proxy_set_header HOST $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n     }\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-IOLrNxsJ-1662373233730)(F:\\typorase\\jpg\\221.png)]\" src=\"image\\97b4c1b35bc647af8f80006923aba994.png\"/></p>\n<p>准备好之后 开启服务</p>\n<pre><code>systemctl start nginx  \n\n</code></pre>\n<h2><a id=\"Tomcat1_278\"></a>Tomcat1配置</h2>\n<pre><code>mkdir /usr/local/tomcat/webapps/yan     \nvim /usr/local/tomcat/webapps/yan/index.jsp  #动态页面的配置\n\n&lt;%@ page language=\"java\" import=\"java.util.*\" pageEncoding=\"UTF-8\"%&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;JSP test1 page&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;% out.println(\"小严\");%&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Zk9nTwZS-1662373233730)(F:\\typorase\\jpg\\222.png)]\" src=\"image\\70ddf021165c411186927cd51a0e6b06.png\"/></p>\n<pre><code>vim /usr/local/tomcat/conf/server.xml   #修改配置文件\n\n删除原host端和valve端\n新增一下\n\n&lt;Host name=\"localhost\"  appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\" xmlValidation=\"false\" xmlNamespaceAware=\"false\"&gt;\n   &lt;Context docBase=\"/usr/local/tomcat/webapps/yan\" path=\"\" reloadable=\"true\" /&gt;\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-8zhUR92W-1662373233731)(F:\\typorase\\jpg\\223.png)]\" src=\"image\\d75a390349604222845d99468097a148.png\"/></p>\n<pre><code>shutdown.sh       #重启服务\nstartup.sh\n\n</code></pre>\n<h2><a id=\"Tomcat2_320\"></a>Tomcat2配置</h2>\n<pre><code>mkdir /usr/local/tomcat/webapps/yan\nvim /usr/local/tomcat/webapps/yan/index.jsp\n\n&lt;%@ page language=\"java\" import=\"java.util.*\" pageEncoding=\"UTF-8\"%&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;JSP test2 page&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;   \n&lt;% out.println(\"小芸\");%&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-XBA4fzzh-1662373233731)(F:\\typorase\\jpg\\224.png)]\" src=\"image\\1507a53121d24c22b84a86d3d47d26b3.png\"/></p>\n<pre><code>vim /usr/local/tomcat/conf/server.xml    #修改配置文件 \n\n删除原host端和valve端\n新增一下\n\n&lt;Host name=\"localhost\"  appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\" xmlValidation=\"false\" xmlNamespaceAware=\"false\"&gt;\n   &lt;Context docBase=\"/usr/local/tomcat/webapps/yan\" path=\"\" reloadable=\"true\" /&gt;\n\n</code></pre>\n<p><img alt=\"[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-f3kFAJ4S-1662373233731)(F:\\typorase\\jpg\\225.png)]\" src=\"image\\7b20956943594502836649cc2b2e6bdf.png\"/></p>\n<pre><code>shutdown.sh        #重启服务\nstartup.sh\n\n</code></pre>\n<p>进行测试</p>\n<p>访问http://192.168.192.134，会出现Nginx的静态页面</p>\n<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-EiDhg7zE-1662373233731)(F:\\typorase\\jpg\\226.png)\\</p>\n<p>访问http://192.168.192.134/index.jsp</p>\n<p>会动态的在Tomcat1和Tomcat2之间进行切换访问</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\3ae3e4538d0a47139a112733d782eb47.png\"/></p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\ba3e9ff0007c495788de56cf55dc2700.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}