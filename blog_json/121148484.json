{"blogid": "121148484", "writerAge": "码龄5年", "writerBlogNum": "15", "writerCollect": "234", "writerComment": "8", "writerFan": "24", "writerGrade": "2级", "writerIntegral": "343", "writerName": "取名好难。。。", "writerProfileAdress": "writer_image\\profile_121148484.jpg", "writerRankTotal": "405985", "writerRankWeekly": "233600", "writerThumb": "28", "writerVisitNum": "23792", "blog_read_count": "2730", "blog_time": "于 2021-11-04 18:35:13 发布", "blog_title": "FTP服务器搭建及C#实现FTP文件的上传", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p></p>\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"%C2%A01.ftp%E7%AE%80%E4%BB%8B-toc\" style=\"margin-left:0px;\"><a href=\"#%C2%A01.ftp%E7%AE%80%E4%BB%8B\" title=\" 1.ftp简介\"> 1.ftp简介</a></p>\n<p id=\"2.%E6%90%AD%E5%BB%BAFTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%AD%A5%E9%AA%A4%EF%BC%88win10%E4%B8%BA%E4%BE%8B%EF%BC%89-toc\" style=\"margin-left:0px;\"><a href=\"#2.%E6%90%AD%E5%BB%BAFTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%AD%A5%E9%AA%A4%EF%BC%88win10%E4%B8%BA%E4%BE%8B%EF%BC%89\" title=\"2.搭建FTP服务器步骤（win10为例）\">2.搭建FTP服务器步骤（win10为例）</a></p>\n<p id=\"2.1%E5%BC%80%E5%90%AFftp%E5%8A%9F%E8%83%BD-toc\" style=\"margin-left:40px;\"><a href=\"#2.1%E5%BC%80%E5%90%AFftp%E5%8A%9F%E8%83%BD\" title=\"2.1开启ftp功能\">2.1开启ftp功能</a></p>\n<p id=\"%C2%A02.2%E7%99%BB%E5%BD%95%E6%B5%8B%E8%AF%95-toc\" style=\"margin-left:40px;\"><a href=\"#%C2%A02.2%E7%99%BB%E5%BD%95%E6%B5%8B%E8%AF%95\" title=\" 2.2登录测试\"> 2.2登录测试</a></p>\n<p id=\"2.2.1%E4%BB%8E%E7%BD%91%E9%A1%B5%E7%99%BB%E5%BD%95-toc\" style=\"margin-left:80px;\"><a href=\"#2.2.1%E4%BB%8E%E7%BD%91%E9%A1%B5%E7%99%BB%E5%BD%95\" title=\"2.2.1从网页登录\">2.2.1从网页登录</a></p>\n<p id=\"%C2%A02.2.2%E9%80%9A%E8%BF%87cmd%E5%91%BD%E4%BB%A4-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A02.2.2%E9%80%9A%E8%BF%87cmd%E5%91%BD%E4%BB%A4\" title=\" 2.2.2通过cmd命令\"> 2.2.2通过cmd命令</a></p>\n<p id=\"3.%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0FTP%E6%9C%8D%E5%8A%A1%E5%99%A8-toc\" style=\"margin-left:0px;\"><a href=\"#3.%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0FTP%E6%9C%8D%E5%8A%A1%E5%99%A8\" title=\"3.上传文件到FTP服务器\">3.上传文件到FTP服务器</a></p>\n<p id=\"3.1%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%BA%93-toc\" style=\"margin-left:40px;\"><a href=\"#3.1%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%BA%93\" title=\"3.1创建类库\">3.1创建类库</a></p>\n<p id=\"3.2%E8%B0%83%E7%94%A8%EF%BC%9A-toc\" style=\"margin-left:40px;\"><a href=\"#3.2%E8%B0%83%E7%94%A8%EF%BC%9A\" title=\"3.2调用\">3.2调用</a></p>\n<hr id=\"hr-toc\"/>\n<h1 id=\"%C2%A01.ftp%E7%AE%80%E4%BB%8B\"> 1.ftp简介</h1>\n<p>        FTP是File Transfer Protocol（文件传输协议）的英文简称，而中文简称为“文本协议”。用于Internet上的控制文件的双向传输。同时，它也是一个应用程序（Application）。基于不同的操作系统有不同的FTP应用程序，而所有这些应用程序都遵守同一种协议以传输文件。在ftp的使用当中，用户经常遇到两个概念：“下载”（Download）和“上传”（upload）。“下载”文件就是从远程主机拷贝文件至自己的计算机上；“上传”文件就是将文件从自己的计算机中拷贝至远程主机上。用Internet语言来说，用户可通过客户机程序向（从）远程主机上传（下载）文件。</p>\n<h1 id=\"2.%E6%90%AD%E5%BB%BAFTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%AD%A5%E9%AA%A4%EF%BC%88win10%E4%B8%BA%E4%BE%8B%EF%BC%89\">2.搭建FTP服务器步骤（win10为例）</h1>\n<h2 id=\"2.1%E5%BC%80%E5%90%AFftp%E5%8A%9F%E8%83%BD\">2.1开启ftp功能</h2>\n<p>        控制面板——》程序和功能——》打开或关闭Windows功能将如图的选框选中</p>\n<p><img alt=\"\" height=\"479\" src=\"image\\3941e2cf34824869844417ea9bcf63cf.png\" width=\"419\"/></p>\n<p> 2.1.2添加FTP站点</p>\n<p>        控制面板——》管理工具——》双击Internet信息服务（IIS）管理器如下图添加FTP站点</p>\n<p><img alt=\"\" height=\"392\" src=\"image\\ee6cf032061c48bdabe0fc6cc6858fa8.png\" width=\"900\"/></p>\n<p> 2.1.3设置站点名称和想要公开的路径</p>\n<p><img alt=\"\" height=\"575\" src=\"image\\67f0f130d3774b5093423ebadd903e50.png\" width=\"671\"/></p>\n<p> 2.1.4绑定IP地址和ssl设置</p>\n<p>IP地址填本机地址，端口默认21，ssl是一种数字加密证书，可申请，在此没有可选择无。</p>\n<p> <img alt=\"\" height=\"579\" src=\"image\\709ff988b0324380b075d5dde088a02b.png\" width=\"673\"/></p>\n<p> 2.1.5设置权限，建议设置成读取状态，点击完成即可。</p>\n<p><img alt=\"\" height=\"572\" src=\"image\\63199f45b50e4cc9adfcb42efe9b92a3.png\" width=\"669\"/></p>\n<p>2.1.6添加用户</p>\n<p>右击计算机——》管理——》本地用户和组——》用户 </p>\n<p><img alt=\"\" height=\"278\" src=\"image\\9a41d90b2e474dc08d114567f9b58243.png\" width=\"307\"/>       <img alt=\"\" height=\"376\" src=\"image\\fa093ffcc3ee4d30beda5d1ba5fd8d96.png\" width=\"337\"/></p>\n<p></p>\n<h2 id=\"%C2%A02.2%E7%99%BB%E5%BD%95%E6%B5%8B%E8%AF%95\"> 2.2登录测试</h2>\n<h3 id=\"2.2.1%E4%BB%8E%E7%BD%91%E9%A1%B5%E7%99%BB%E5%BD%95\">2.2.1从网页登录</h3>\n<p>        浏览器中输入命令ftp://本地IP，如下图所示，输入用户名密码</p>\n<p><img alt=\"\" height=\"252\" src=\"image\\03a7b3b3d4644151a0f90c356e0dca0c.png\" width=\"451\"/></p>\n<p> 用户名和密码输入正确的话就会出现公开的路径。</p>\n<p><img alt=\"\" height=\"238\" src=\"image\\0a01cf787f224a27b29bd8884902bde2.png\" width=\"430\"/></p>\n<h3 id=\"%C2%A02.2.2%E9%80%9A%E8%BF%87cmd%E5%91%BD%E4%BB%A4\"> 2.2.2通过cmd命令</h3>\n<p>        通过出门的命令进入ftp来上传或下载</p>\n<ul><li>输入“ftp”切换到ftp下面，然后输入“open 服务器地址” </li><li>此时要求输入用户名密<img alt=\"\" height=\"279\" src=\"image\\5479c89b20d54805a109ac5f72a058bf.png\" width=\"622\"/></li><li>上传文件，利用put '本地文件路径',来上传</li></ul>\n<p> <img alt=\"\" height=\"417\" src=\"image\\b69a7920a11e4161b419a722ef66971f.png\" width=\"634\"/></p>\n<p> 总结：</p>\n<p>┏━━━━━━━━━━━━━━━━━━━━━┓<br/> ┃ftp ┃<br/> ┃c:\\ftp ┃<br/> ┃ftp:\\open 主机IP+端口 (也可以不用写端口） ┃<br/> ┃当显示****logged in时，就说明登入成功了。 ┃<br/> ┃dir 查看FTP上的文件 ┃<br/> ┃CD 进入某个文件夹 ┃<br/> ┃GET 下载文件到本地 ┃<br/> ┃PUT 上传文件到FTP ┃<br/> ┃delete 删除FTP上的文件 ┃<br/> ┃bye 退出连接 ┃<br/> ┃quit 同上 ┃<br/> ┗━━━━━━━━━━━━━━━━━━━━━┛</p>\n<h1 id=\"3.%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0FTP%E6%9C%8D%E5%8A%A1%E5%99%A8\">3.上传文件到FTP服务器</h1>\n<h2 id=\"3.1%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%BA%93\">3.1创建类库</h2>\n<pre><code class=\"language-cs\">using System;\nusing System.Collections.Generic;\nusing System.IO;\nusing System.Linq;\nusing System.Text;\nusing System.Threading.Tasks;\nusing System.Net;\n\nnamespace PrintDBSQL.Framework.Utility\n{\n    public class FTPHelper\n    {\n        /// &lt;summary&gt;\n        /// FTP的服务器地址，格式为ftp://192.168.1.234:8021/。\n        /// &lt;/summary&gt;\n        private string FTPCONSTR { get; set; }\n        /// &lt;summary&gt;\n        /// //FTP服务器的用户名\n        /// &lt;/summary&gt;\n        private string FTPUSERNAME { get; set; }\n        /// &lt;summary&gt;\n        /// //FTP服务器的密码\n        /// &lt;/summary&gt;\n        private string FTPPASSWORD { get; set; }\n        public FTPHelper(string ip, string username, string password, string port=\"21\")\n        {\n            FTPCONSTR = string.Format(\"{0}://{1}:{2}/\", \"ftp\", ip, port);\n            FTPUSERNAME = username;\n            FTPPASSWORD = password;\n        }\n        #region 本地文件上传到FTP服务器\n        /// &lt;summary&gt;\n        /// 上传文件到远程ftp\n        /// &lt;/summary&gt;\n        /// &lt;param name=\"path\"&gt;本地的文件目录&lt;/param&gt;\n        /// &lt;param name=\"name\"&gt;文件名称&lt;/param&gt;\n        /// &lt;returns&gt;&lt;/returns&gt;\n        public bool UploadFile(string path, string name)\n        {\n            FileInfo f = new FileInfo(path);\n            path = FTPCONSTR + name;//这个路径是我要传到ftp目录下的这个目录下\n            FtpWebRequest reqFtp = (FtpWebRequest)FtpWebRequest.Create(new Uri(path));\n            reqFtp.Method = WebRequestMethods.Ftp.UploadFile;\n            reqFtp.UsePassive = false;//只需要添加这一句话\n            reqFtp.UseBinary = true;\n            reqFtp.Credentials = new NetworkCredential(FTPUSERNAME, FTPPASSWORD);\n            reqFtp.KeepAlive = false;\n            reqFtp.Method = WebRequestMethods.Ftp.UploadFile;\n            reqFtp.ContentLength = f.Length;\n            int buffLength = 2048;\n            byte[] buff = new byte[buffLength];\n            int contentLen;\n            FileStream fs = f.OpenRead();\n            try\n            {\n                Stream strm = reqFtp.GetRequestStream();\n                contentLen = fs.Read(buff, 0, buffLength);\n                while (contentLen != 0)\n                {\n                    strm.Write(buff, 0, contentLen);\n                    contentLen = fs.Read(buff, 0, buffLength);\n                }\n                strm.Close();\n                fs.Close();\n                return true;\n            }\n            catch (Exception ex)\n            {\n                return false;\n            }\n        }\n       \n        #endregion\n\n    }\n}</code></pre>\n<h2 id=\"3.2%E8%B0%83%E7%94%A8%EF%BC%9A\"><strong>3.2调用</strong>：</h2>\n<p>        FTP服务器中ftp站点的 物理路径为：C:\\\\ftpFileLocation。如果将logo.png图片上传至ftp服务器中的MPS文件夹下（即：C:\\\\ftpFileLocation\\MPS\\logo.png），调用如下：</p>\n<pre><code class=\"language-cs\">string ftpIP= \"192.168.11.196\";\nstring ftpPort= \"21\";\nstring ftpUserName= \"test\";\nstring ftpPassword= \"123\";\nstring localPath = \"G:\\\\Project\\\\logo.png\";\nstring remotePath = \"/MPS/logo.png\";\nFTPHelper FTPHelper = new FTPHelper(ftpIP, ftpUserName, ftpPassword, ftpPort);\nbool uploadresult = FTPHelper.UploadFile(localPath , remotePath);</code></pre>\n<p></p>\n</div>\n</div>"}