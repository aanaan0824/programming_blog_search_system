{"blogid": "126683968", "writerAge": "码龄3年", "writerBlogNum": "58", "writerCollect": "30", "writerComment": "3", "writerFan": "291", "writerGrade": "3级", "writerIntegral": "622", "writerName": "群马视觉", "writerProfileAdress": "writer_image\\profile_126683968.jpg", "writerRankTotal": "32713", "writerRankWeekly": "2715", "writerThumb": "39", "writerVisitNum": "5940", "blog_read_count": "936", "blog_time": "已于 2022-09-03 23:41:13 修改", "blog_title": "Python基于OpenCV监控老鼠蟑螂检测系统[完整源码＆部署教程]", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"1_0\"></a><strong>1.视频演示：</strong></h1>\n<p><a href=\"https://www.bilibili.com/video/BV1ZG41157Pj/?vd_source=bc9aec86d164b67a7004b996143742dc\">[项目分享]Python基于OpenCV监控老鼠蟑螂检测系统[完整源码＆部署教程]_哔哩哔哩_bilibili</a></p>\n<h1><a id=\"2_6\"></a><strong>2.图片演示：</strong></h1>\n<p><img alt=\"2.png\" src=\"image\\f5ec3b156757bbc29bdda24852d0850a.png\"/></p>\n<p><img alt=\"3.png\" src=\"image\\c49b95eb00ba38e459411ac1b7fbe860.png\"/></p>\n<p><img alt=\"4.png\" src=\"image\\86eb3c6a659d1e5f899052a7004a6228.png\"/></p>\n<h1><a id=\"3_12\"></a><strong>3.明厨亮灶：</strong></h1>\n<p>餐饮企业的厨房卫生状况一直饱受消费者诟病，许多宾馆饭店大厅、包间富丽堂皇，然而，厨房却往往惨不忍睹。尤其是餐厅中出现老鼠的事故，最近几年频繁发生。有媒体曾经爆料过，著名的海底捞餐厅，甚至是快餐领域的巨头肯德基和麦当劳的厨房都出现了老鼠的踪迹。</p>\n<p>明厨亮灶是国家食品药品监督管理局推行的一项利民工程，即让消费者坐在饭店 大厅或者包间，就可以通过透明玻璃或大屏幕将后厨的一举一动尽收眼底。此举既是督促 餐饮单位加强自律，也是鼓励他律，使餐饮单位全面接受消费者监督，主动保障饮食安全。随着视频分析以及人工智能技术的发展与进步，越来越多的事件可以通过视频监控实时进行检测与识别，通过视频分析可以对监控场景中的老鼠进行检测，同时可以实现对老鼠的踪迹进行记录、提前侦测深圳进行报警。</p>\n<h2><a id=\"_16\"></a>老鼠检测算法方案：</h2>\n<p>老鼠体积较小，另外厨房内安装的摄像头要同时兼顾监控录像功能，所以镜头几乎不会太大，即要看的场景视角要宽阔，所以送到算法模块中的帧图像中老鼠的成像面积都是很小的，所以基于这些限制条件，那么对于熟悉算法的人来说，几乎只有一种方案可选了。那就是：“运动目标检测+目标跟踪+目标分类”。<br/> 运动目标检测算法离不开背景建模，具体背景建模算法可以参考之前的文章：https://zhuanlan.zhihu.com/p/266800330</p>\n<p>目标跟踪算法离不开简单使用的kalman，具体的跟踪算法可以参考之前的文章：</p>\n<p>https://zhuanlan.zhihu.com/p/268758079</p>\n<p>老鼠分类算法，基于传统的机器学习方法：adaboost、svm、dpm、xgboost等，速度快，但是准确率很难再提升上去；建议采用深度学习方法，比如resnet系列的网络，自己独立设计几层小网络，即可达到很好的效果。</p>\n<p>老鼠加测分类网络，最近在github上查到一个较好的贡献，包括背景建模、分类模型、测试视频等全过程代码，非常感谢这位贡献者，但是实测下来，模型分类效果还是存在误报，所以距离落地还是有一定差距，关键是训练数据，因为夜间老鼠的数据还是很稀有的。Github链接：</p>\n<p>https://github.com/isyanan1024/Mouse-detect<br/> ​github.com/isyanan1024/Mouse-detect</p>\n<h1><a id=\"4_31\"></a><strong>4.现有算法存在的缺陷：</strong></h1>\n<p>老鼠检测在明初亮灶项目上几乎是必须的，虽然貌似比较简单，但是真正做到实用落地还是比较难的，所有人都知道背景建模误报多，但是还是离不开它，但是你要想在背景建模的算法上做出花样来，那几乎又不是太可能的，所以老鼠检测算法的方案也是把整个CV方案能用到的模块都遍历到了，至于最终效果，就需要一定的工程trick、策略等等。明厨亮灶：老鼠检测算法应用的几个落地难点介绍如下，后续有机会更新解决方法。</p>\n<h2><a id=\"1__33\"></a>1、 老鼠样本数据少</h2>\n<p>厨房白天有人，老鼠不出来，所以老鼠检测都是没人的晚上用。晚上的厨房一般都是关灯的，几乎没有光线，需要摄像头红外补光来或许图像，所以真实应用时，摄像头图片都是灰度的，老鼠的两个眼睛都是白亮白亮的。因为数据的稀缺性，这就严重影响了算法的性能。</p>\n<h2><a id=\"2__37\"></a>2、 误报多</h2>\n<p>其实算法初期的几个版本，误报多的几乎惨不忍睹，背景建模的副作用还是很大的，另外前期训练数据较少，分类效果不佳，去误报模块策略不完备，所以误报较多。</p>\n<h2><a id=\"3__41\"></a>3、 应用推广难</h2>\n<p>其实这个需求，作为各个餐馆、食品厂的个体户或者老板，肯定是不希望安装这个老鼠检测的，因为会罚款。那么这个需求是谁提的呢，其实是各个地区的食药监，其实这个应用的真实需求是政府，那么想拿到这个需求单子就要政府打交道了，这就不是一般的集成商或者工程商可以拿到的了，所以也限制了一些算法公司开发的积极性。</p>\n<h1><a id=\"5_45\"></a><strong>5.本文算法原理：</strong></h1>\n<p>为了解决上述困难，本文采用帧间差分法，又称移动侦测。移动侦测即是根据视频每帧或者几帧之间像素的差异，对差异值设置阈值，筛选大于阈值的像素点，做掩模图即可选出视频中存在变化的桢。帧差法较为简单的视频中物体移动侦测，帧差法分为：单帧差、两桢差、和三桢差。随着帧数的增加是防止检测结果的重影。</p>\n<h4><a id=\"Temporal_Difference_48\"></a>帧间差分法(Temporal Difference)</h4>\n<p>由于场景中的目标在运动，目标的影像在不同图像帧中的位置不同。该类算法对时间上连续的两帧或三帧图像进行差分运算，不同帧对应的像素点相减，判断灰度差的绝对值，当绝对值超过一定阈值时，即可判断为运动目标，从而实现目标的检测功能。</p>\n<h1><a id=\"6_51\"></a><strong>6.算法流程图：</strong></h1>\n<p><img alt=\"b.png\" src=\"image\\63a27a2c25b623e7d9cbe4401eea9168.png\"/></p>\n<h1><a id=\"7_54\"></a><strong>7.代码实现：</strong></h1>\n<pre><code>def threh(video,save_video,thres1,area_threh):\n cam = cv2.VideoCapture(video)#打开一个视频\n input_fps = cam.get(cv2.CAP_PROP_FPS)\n ret_val, input_image = cam.read()\n index=[]\n images=[]\n images.append(input_image)\n video_length = int(cam.get(cv2.CAP_PROP_FRAME_COUNT))\n input_image=cv2.resize(input_image,(512,512))\n ending_frame = video_length\n fourcc = cv2.VideoWriter_fourcc(*'XVID')\n out = cv2.VideoWriter(save_video,fourcc, input_fps, (512, 512))\n gray_lwpCV = cv2.cvtColor(input_image, cv2.COLOR_BGR2GRAY)\n gray_lwpCV = cv2.GaussianBlur(gray_lwpCV, (21, 21), 0)\n background=gray_lwpCV\n\n# es = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (9, 4))\n\n i = 0 # default is 0\n outt=[]\n while(cam.isOpened()) and ret_val == True and i &lt;2999:\n  ## if i % 2==1:\n  ret_val, input_image = cam.read()\n  input_image=cv2.resize(input_image,(512,512))\n  gray_lwpCV = cv2.cvtColor(input_image, cv2.COLOR_BGR2GRAY)\n  gray_lwpCV = cv2.GaussianBlur(gray_lwpCV, (21, 21), 0)\n  diff = cv2.absdiff(background, gray_lwpCV)\n  outt.append(diff)\n  #跟着图像变换背景\n  tem_diff=diff.flatten()\n  tem_ds=pd.Series(tem_diff)\n  tem_per=1-len(tem_ds[tem_ds==0])/len(tem_ds)\n  if (tem_per &lt;0.2 )| (tem_per&gt;0.75):\n   background=gray_lwpCV\n  else:\n   diff = cv2.threshold(diff, thres1, 255, cv2.THRESH_BINARY)[1]\n   ret,thresh = cv2.threshold(diff.copy(),150,255,0)\n   contours, hierarchy = cv2.findContours(thresh,cv2.RETR_EXTERNAL,cv2.CHAIN_APPROX_SIMPLE)\n  #  contours, hierarchy = cv2.findContours(diff.copy(), cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)\n   for c in contours:\n    if (cv2.contourArea(c) &lt; area_threh) | (cv2.contourArea(c) &gt;int(512*512*0.3) ) :  # 对于矩形区域，只显示大于给定阈值的轮廓（去除微小的变化等噪点）\n     continue\n    (x, y, w, h) = cv2.boundingRect(c) # 该函数计算矩形的边界框\n    cv2.rectangle(input_image, (x, y), (x+w, y+h), (0, 255, 0), 2) \n    index.append(i)\n  #  cv2.imshow('contours', input_image)\n  #  cv2.imshow('dis', diff)\n  out.write(input_image)\n  images.append(input_image)\n  i = i+1\n out.release()\n cam.release()\n return outt,index,images```\n##调取函数\noutt=threh('new_video.mp4','test6.mp4',25,3000)\n</code></pre>\n<h1><a id=\"8_112\"></a><strong>8.系统整合：</strong></h1>\n<p><img alt=\"1.png\" src=\"image\\2cee553250af258f57efc2d9aa0906fc.png\"/></p>\n<h1><a id=\"9UI_116\"></a><strong>9.完整源码&amp;环境部署视频教程&amp;自定义UI界面：</strong></h1>\n<p><a href=\"https://mianbaoduo.com/o/bread/Y5WWkpps\">Python基于OpenCV监控老鼠蟑螂检测系统[完整源码＆部署教程] (mianbaoduo.com)</a></p>\n<h1><a id=\"10_123\"></a><strong>10.参考文献：</strong></h1>\n<hr/>\n<ul><li><em>[1]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=ZGTB202009002&amp;dbcode=CJFD&amp;dbname=CJFDTEMP&amp;v=rnRpPjnqSLWDWhz-76y73RennxMJMCC63eAjYbMMgzdyNewn_MaR1oWQD0mb2UOt\">红外弱小目标检测算法综述</a>[J]. 李俊宏,张萍,王晓玮,黄世泽. 中国图象图形学报. 2020(09)</li><li><em>[2]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=HWYJ202006026&amp;dbcode=DKFX&amp;dbname=DKFXTEMP&amp;v=KpvNimGLlzS6znKVLpFaN451R7eQpXbpHNQrXNyTEmPdJEM6OtuLAIixZKuqSjcD\">新型光电探测技术在精确制导武器上的应用研究(特约)</a>[J]. 宋闯,姜鹏,段磊,孙剑峰,范之国. 红外与激光工程. 2020(06)</li><li><em>[3]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=HWJS202006009&amp;dbcode=CJFD&amp;dbname=CJFDTEMP&amp;v=KMA_axLyS4uSOAnAqKBuceSUAnZwXQCsIy6o83MDOcEvx18y8_xdGakZ9E3mAko4\">基于FPGA的红外弱小目标检测算法</a>[J]. 张延苏,吴滢跃. 红外技术. 2020(06)</li><li><em>[4]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=ZHKZ202002013&amp;dbcode=CJFD&amp;dbname=CJFDTEMP&amp;v=npgJx00qXazQJjhc_Llz18EWSXWWfMaA0UBoEPr2TRlwGde1vP0_7bblBd2m2kyM\">一种基于差分滤波的红外舰船目标检测方法</a>[J]. 修炳楠,吕俊伟,鹿珂珂. 指挥与控制学报. 2020(02)</li><li><em>[5]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=JGHW202005019&amp;dbcode=CJFD&amp;dbname=CJFDTEMP&amp;v=PgIZtnr_vlqzXFmj-cESOLTFgnBBlAy0ldBmc9RWkHRNXOj5K6FZo6RzylIyQy8G\">激光干扰红外预警卫星的有效压制区研究</a>[J]. 王枭,张宇令,李云成. 激光与红外. 2020(05)</li><li><em>[6]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=HWYJ202002021&amp;dbcode=CJFD&amp;dbname=CJFDTEMP&amp;v=KpvNimGLlzRwF8U6WqFTNEPshSILyDhBzJ4q73h0rQwILk2Q8tCc8-uJUsjmMABt\">基于匹配滤波的Gm-APD激光雷达三维重构算法研究</a>[J]. 马乐,陆威,姜鹏,刘迪,王鹏辉,孙剑峰. 红外与激光工程. 2020(02)</li><li><em>[7]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=JGHW201901020&amp;dbcode=CJFD&amp;dbname=CJFDTEMP&amp;v=pm7dIz7lJJSlSgb7OiQqUeR0hXGAuUF6-3il1R-T5yM7UYPH7eeyNXQ2x8QzhZPz\">基于改进候选区域网络的红外飞机检测</a>[J]. 姜晓伟,王春平,付强. 激光与红外. 2019(01)</li><li><em>[8]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=DGKQ201904018&amp;dbcode=CJFD&amp;dbname=CJFDTEMP&amp;v=tDRCCfDRo1Ri5xRcQnOFFMOrK8xho_YM88rypMMSe4iQVTBQA1Hj6hELi-8-0PLz\">红外搜索跟踪系统探测距离缩比测试方法</a>[J]. 谢飞,周德召,胡磊力,杜保林. 电光与控制. 2019(04)</li><li><em>[9]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=HWJS201805014&amp;dbcode=CJFD&amp;dbname=CJFD2018&amp;v=x1ePX1F4xrSu7Wxc1N--XAtjD0lUnpvRfi33Ds2O9wg_woAE4nq5e9-ZZUQiftSV\">红外成像/被动微波复合制导技术研究</a>[J]. 夏团结,申涛,方珉,宋敏敏,刘会文. 红外技术. 2018(05)</li><li><em>[10]</em><a href=\"https://kns.cnki.net/kcms/detail/detail.aspx?filename=JGHW201805010&amp;dbcode=CJFD&amp;dbname=CJFD2018&amp;v=UsZgNaRI7-V9WysLcmA6v8oQfjfgyI42w6G0XQhtwhRnUUM9uYLUh4DA-D8I2uWv\">机载红外搜索跟踪系统有效探测区域研究</a>[J]. 王芳,罗寰,王海晏,寇添,寇人可. 激光与红外. 2018(05)</li></ul>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}