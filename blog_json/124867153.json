{"blogid": "124867153", "writerAge": "码龄3年", "writerBlogNum": "29", "writerCollect": "72", "writerComment": "35", "writerFan": "6", "writerGrade": "4级", "writerIntegral": "801", "writerName": "iwlnner", "writerProfileAdress": "writer_image\\profile_124867153.jpg", "writerRankTotal": "47497", "writerRankWeekly": "91538", "writerThumb": "71", "writerVisitNum": "58764", "blog_read_count": "1895", "blog_time": "已于 2022-06-08 10:22:53 修改", "blog_title": "数据库-根据某个字段去重/分组并查询最新的一条记录", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>今天在工作中，遇到一个业务：根据某个字段去重查询最新的记录列表，于是建了一张测试表，并记录下两种不同类型数据库下的查询方式（postgresql/mysql），如果不想看中间博主的思路和分析，直接跳到文章末尾看总结部分即可</p>\n<h2><a id=\"_2\"></a>一、准备工作</h2>\n<p>postgresql建表语句：</p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token string\">\"id\"</span> int4 <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"group_id\"</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COLLATE</span> <span class=\"token string\">\"pg_catalog\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"default\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"member_name\"</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COLLATE</span> <span class=\"token string\">\"pg_catalog\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"default\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"join_time\"</span> <span class=\"token keyword\">timestamp</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"level\"</span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">COLLATE</span> <span class=\"token string\">\"pg_catalog\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"default\"</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">COMMENT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">COLUMN</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"id\"</span> <span class=\"token operator\">IS</span> <span class=\"token string\">'主键'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">COMMENT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">COLUMN</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"group_id\"</span> <span class=\"token operator\">IS</span> <span class=\"token string\">'组织编号'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">COMMENT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">COLUMN</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"member_name\"</span> <span class=\"token operator\">IS</span> <span class=\"token string\">'成员姓名'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">COMMENT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">COLUMN</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"join_time\"</span> <span class=\"token operator\">IS</span> <span class=\"token string\">'加入时间'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">COMMENT</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">COLUMN</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"level\"</span> <span class=\"token operator\">IS</span> <span class=\"token string\">'等级（1，2，3）'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'001'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'鸣人'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-17 17:37:56'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'002'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'路飞'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-17 13:35:11'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'003'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'孙悟空'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-17 17:50:14'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'001'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'自来也'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-10 17:50:46'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'003'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'短笛'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-09 17:51:20'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'001'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'我爱罗'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-10 17:52:18'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'002'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'索隆'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-19 17:52:39'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'002'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'山治'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-02 17:53:41'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token string\">\"public\"</span><span class=\"token punctuation\">.</span><span class=\"token string\">\"t_group_member\"</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'003'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'孙悟饭'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-08 17:55:14'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>mysql建表语句：</p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>member_name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>join_time<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>level<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">10</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">-- ----------------------------</span>\n<span class=\"token comment\">-- Records of t_group_member</span>\n<span class=\"token comment\">-- ----------------------------</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'001'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'鸣人'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-17 17:37:56'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'002'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'路飞'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-17 13:35:11'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'003'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'孙悟空'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-17 17:50:14'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'4'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'001'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'自来也'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-10 17:50:46'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'5'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'003'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'短笛'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-09 17:51:20'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'6'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'001'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'我爱罗'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-10 17:52:18'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'7'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'002'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'索隆'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-19 17:52:39'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'002'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'山治'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-02 17:53:41'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>t_group_member<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'9'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'003'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'孙悟饭'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2022-05-08 17:55:14'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n</code></pre>\n<p>表建好之后，查看一下自己的mysql版本（<strong>这个细节很关键</strong>）</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\64e08d9d84d34c2faf632b75c2ee794b.png\"/><br/> 同样，查看postgresql的版本</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\1b95e8e87b3f4550ada37168d024ef21.png\"/></p>\n<h2><a id=\"_68\"></a>二、需求</h2>\n<p>首先看一下建好的测试表数据</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\fb6ddd825d9942098eed11fc1270c26a.png\"/></p>\n<p><strong>需求：查询每个小组最新加入的成员信息</strong></p>\n<p>（1）方式一：通过分组加排序的方式（mysql5.7.5以下）</p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> t_group_member <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> join_time <span class=\"token keyword\">DESC</span><span class=\"token punctuation\">)</span> b \n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> group_id\n</code></pre>\n<p>这样写表面看上去没啥问题，但实际查询结果却让我感到失望</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\5f035992c05f4129976816bf1cd13b45.png\"/><br/> 很明显，查出来的数据是不正确的，此时的解决办法是加上limit</p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> t_group_member <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> join_time <span class=\"token keyword\">DESC</span> <span class=\"token keyword\">limit</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> b \n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> group_id\n</code></pre>\n<p>这样，就准确的查出想要的数据了</p>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\8c99857e11134c369590e23acf72bd85.png\"/></p>\n<p><strong>但是</strong></p>\n<p>同样的sql，把它放在mysql5.7.5及以上版本，就报错了,至于报错的原因，简单来讲就是mysql从5.7.5版本开始，默认完全遵守“SQL92标准”，而该标准规定：如果select后面的字段没有全部出现在group by后面，就是非法的sql语句，除非，使用any_value()函数包裹除了在group by后面出现的字段,sql如下：</p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span>\n group_id<span class=\"token punctuation\">,</span>\n ANY_VALUE<span class=\"token punctuation\">(</span>member_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n ANY_VALUE<span class=\"token punctuation\">(</span>join_time<span class=\"token punctuation\">)</span> \n<span class=\"token keyword\">FROM</span>\n <span class=\"token punctuation\">(</span> <span class=\"token keyword\">SELECT</span> group_id<span class=\"token punctuation\">,</span> member_name<span class=\"token punctuation\">,</span> join_time <span class=\"token keyword\">FROM</span> t_group_member <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> join_time <span class=\"token keyword\">DESC</span> <span class=\"token punctuation\">)</span> b \n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> group_id\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\bf89de3010be40a98bda6690e30ee81f.png\"/></p>\n<p>此时，我们也发现这个sql的弊端了：</p>\n<ul><li>如果数据量特别大，limit 1000显得就不够用了，sql查询到的数据就不对</li><li>该方式只适用于mysql5.7.5版本以下，即便使用了any_value()函数来避免语法问题，但这种抑制语法的方式，还是不推荐</li><li>该sql在postgresql上也完全不兼容</li></ul>\n<p>所以，<strong>该方式不推荐</strong></p>\n<p>（2）方式二：通过关联查询+聚合函数的方式（mysql/postgresql）</p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span> t<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> \n<span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> group_id<span class=\"token punctuation\">,</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>join_time<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> join_time <span class=\"token keyword\">FROM</span> t_group_member <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> group_id<span class=\"token punctuation\">)</span> a \n<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> \nt_group_member t \n<span class=\"token keyword\">ON</span> t<span class=\"token punctuation\">.</span>group_id<span class=\"token operator\">=</span>a<span class=\"token punctuation\">.</span>group_id <span class=\"token keyword\">where</span> t<span class=\"token punctuation\">.</span>join_time<span class=\"token operator\">=</span>a<span class=\"token punctuation\">.</span>join_time\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\23835347953a4baeb42eef7c6d826d12.png\"/></p>\n<p>此时，我们发现，select后面的max(join_time)并没有出现在group by后面啊，这个sql会不会在mysql5.7.5以上版本也报错啊？</p>\n<p>答案是：不会</p>\n<blockquote>\n<p>因为除了方式一所说的使用any_value()函数来绕开“SQL92标准”语法外，还有一种更“正规合法”的语法是不会导致报错的，那便是聚合函数（max,min，sum等），虽然select后面的max(join_time)并没有出现在group<br/> by后面，但是join_time字段使用了max聚合函数，这种情况是符合“SQL92标准”的，所以不会出现上面方式一的错误</p>\n</blockquote>\n<p>该方式无论在mysql的高版本或者低版本，亦或者在postgresql中，均可适用，博主<strong>推荐</strong></p>\n<p>（3）方式三：通过row_number() over()函数实现（mysql5.7.5以上/postgresql）</p>\n<p>语法：<strong>row_number() over(partition by 分组列 order by 排序列 desc) as 别名</strong></p>\n<pre><code class=\"prism language-sql\"> <span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span>\n \t<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> row_number<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">over</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">PARTITION</span> <span class=\"token keyword\">BY</span> group_id <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> join_time <span class=\"token keyword\">DESC</span><span class=\"token punctuation\">)</span> rn <span class=\"token keyword\">FROM</span> t_group_member\n <span class=\"token punctuation\">)</span> t <span class=\"token keyword\">WHERE</span> t<span class=\"token punctuation\">.</span>rn <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\3d3dd3603a9d44e79d66235693a30125.png\"/></p>\n<p>该方式在mysql5.7.5以下的版本并不适用，所以可根据具体情况决定是否使用</p>\n<h2><a id=\"_157\"></a>三、总结</h2>\n<p>当遇到根据某个字段分组并取出最新一条记录时，可以套用以下sql，兼容性比较可靠</p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span> t<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> \n<span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> group_id<span class=\"token punctuation\">,</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>join_time<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> join_time <span class=\"token keyword\">FROM</span> t_group_member <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> group_id<span class=\"token punctuation\">)</span> a \n<span class=\"token keyword\">LEFT</span> <span class=\"token keyword\">JOIN</span> \nt_group_member t \n<span class=\"token keyword\">ON</span> t<span class=\"token punctuation\">.</span>group_id<span class=\"token operator\">=</span>a<span class=\"token punctuation\">.</span>group_id <span class=\"token keyword\">where</span> t<span class=\"token punctuation\">.</span>join_time<span class=\"token operator\">=</span>a<span class=\"token punctuation\">.</span>join_time\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}