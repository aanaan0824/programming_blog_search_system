{"blogid": "126557065", "writerAge": "码龄1年", "writerBlogNum": "335", "writerCollect": "2176", "writerComment": "205", "writerFan": "847", "writerGrade": "5级", "writerIntegral": "4472", "writerName": "小熊猫爱恰饭", "writerProfileAdress": "writer_image\\profile_126557065.jpg", "writerRankTotal": "3894", "writerRankWeekly": "81", "writerThumb": "516", "writerVisitNum": "201512", "blog_read_count": "1339", "blog_time": "于 2022-08-27 13:29:49 发布", "blog_title": "自动阅卷的原理很简单的，用python来简单解释一下工作原理❤", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h2><a id=\"_0\"></a>嗨害大家好鸭~我是小熊猫❤</h2>\n<p>随着现代图像处理和人工智能技术的快速发展，</p>\n<p>不少学者尝试讲CV应用到教学领域，能够<strong>代替老师去阅卷</strong>，</p>\n<p>将老师从繁杂劳累的阅卷中解放出来，</p>\n<p>从而进一步有效的推动教学质量上一个台阶。</p>\n<p>传统的人工阅卷，工作繁琐，效率低下，</p>\n<p>进度难以控制且容易出现试卷遗漏未改、登分失误等现象。</p>\n<p><img alt=\"请添加图片描述\" src=\"image\\f9453f7d05da4262b78753758659167f.png\"/></p>\n<p>现代的“机器阅卷”，<mark>工作便捷、效率高、易操作，</mark></p>\n<p>只需要一个相机（手机），拍照即可获取成绩，</p>\n<p>可以导入Excel表格便于存档管理。</p>\n<p><img alt=\"请添加图片描述\" src=\"image\\f718fa2102c745fca0c586bdfc31abcc.png\"/><br/> 下面我们从代码实现的角度来解释一下我们这个简易答题卡识别系统的工作原理。</p>\n<p><strong>第一步，导入工具包及一系列的预处理</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> argparse\n<span class=\"token keyword\">import</span> imutils\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token comment\"># 设置参数</span>\nap <span class=\"token operator\">=</span> argparse<span class=\"token punctuation\">.</span>ArgumentParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nap<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"-i\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--image\"</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">\"test_01.png\"</span><span class=\"token punctuation\">)</span>\nargs <span class=\"token operator\">=</span> <span class=\"token builtin\">vars</span><span class=\"token punctuation\">(</span>ap<span class=\"token punctuation\">.</span>parse_args<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 正确答案</span>\nANSWER_KEY <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">#</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">order_points</span><span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   <span class=\"token comment\"># 一共4个坐标点</span>\n   rect <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> dtype <span class=\"token operator\">=</span> <span class=\"token string\">\"float32\"</span><span class=\"token punctuation\">)</span>\n \n   <span class=\"token comment\"># 按顺序找到对应坐标0,1,2,3分别是 左上，右上，右下，左下</span>\n   <span class=\"token comment\"># 计算左上，右下</span>\n   s <span class=\"token operator\">=</span> pts<span class=\"token punctuation\">.</span><span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>axis <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n   rect<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pts<span class=\"token punctuation\">[</span>np<span class=\"token punctuation\">.</span>argmin<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n   rect<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pts<span class=\"token punctuation\">[</span>np<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n   <span class=\"token comment\"># 计算右上和左下</span>\n   diff <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>diff<span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">,</span> axis <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n   rect<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pts<span class=\"token punctuation\">[</span>np<span class=\"token punctuation\">.</span>argmin<span class=\"token punctuation\">(</span>diff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n   rect<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> pts<span class=\"token punctuation\">[</span>np<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span>diff<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n   <span class=\"token keyword\">return</span> rect\n \n<span class=\"token keyword\">def</span> <span class=\"token function\">four_point_transform</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> pts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   <span class=\"token comment\"># 获取输入坐标点</span>\n   rect <span class=\"token operator\">=</span> order_points<span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">(</span>tl<span class=\"token punctuation\">,</span> tr<span class=\"token punctuation\">,</span> br<span class=\"token punctuation\">,</span> bl<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> rect\n   <span class=\"token comment\"># 计算输入的w和h值</span>\n   widthA <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>br<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>bl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>br<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>bl<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   widthB <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>tr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span>tl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>tr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> tl<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">**</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   maxWidth <span class=\"token operator\">=</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>widthA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>widthB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   heightA <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>tr<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>br<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>tr<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>br<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   heightB <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>tl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>bl<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>tl<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>bl<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   maxHeight <span class=\"token operator\">=</span> <span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>heightA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>heightB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token comment\"># 变换后对应坐标位置</span>\n   dst <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span>maxWidth <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span>maxWidth <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> maxHeight <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> maxHeight <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> dtype <span class=\"token operator\">=</span> <span class=\"token string\">\"float32\"</span><span class=\"token punctuation\">)</span>\n   <span class=\"token comment\"># 计算变换矩阵</span>\n   M <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>getPerspectiveTransform<span class=\"token punctuation\">(</span>rect<span class=\"token punctuation\">,</span> dst<span class=\"token punctuation\">)</span>\n   warped <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>warpPerspective<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> M<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>maxWidth<span class=\"token punctuation\">,</span> maxHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">return</span> warped <span class=\"token comment\"># 返回变换后结果</span>\n \n<span class=\"token keyword\">def</span> <span class=\"token function\">sort_contours</span><span class=\"token punctuation\">(</span>cnts<span class=\"token punctuation\">,</span> method<span class=\"token operator\">=</span><span class=\"token string\">\"left-to-right\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    reverse <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\n    i <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">if</span> method <span class=\"token operator\">==</span> <span class=\"token string\">\"right-to-left\"</span> <span class=\"token keyword\">or</span> method <span class=\"token operator\">==</span> <span class=\"token string\">\"bottom-to-top\"</span><span class=\"token punctuation\">:</span>\n        reverse <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n    <span class=\"token keyword\">if</span> method <span class=\"token operator\">==</span> <span class=\"token string\">\"top-to-bottom\"</span> <span class=\"token keyword\">or</span> method <span class=\"token operator\">==</span> <span class=\"token string\">\"bottom-to-top\"</span><span class=\"token punctuation\">:</span>\n        i <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    boundingBoxes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>cv2<span class=\"token punctuation\">.</span>boundingRect<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> cnts<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">(</span>cnts<span class=\"token punctuation\">,</span> boundingBoxes<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span>cnts<span class=\"token punctuation\">,</span> boundingBoxes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                        key<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> b<span class=\"token punctuation\">:</span> b<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> reverse<span class=\"token operator\">=</span>reverse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> cnts<span class=\"token punctuation\">,</span> boundingBoxes\n<span class=\"token keyword\">def</span> <span class=\"token function\">cv_show</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> img<span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n \nimage <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"image\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\ncontours_img <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ngray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span>\nblurred <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>GaussianBlur<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\nedged <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>Canny<span class=\"token punctuation\">(</span>blurred<span class=\"token punctuation\">,</span> <span class=\"token number\">75</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 轮廓检测</span>\ncnts <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>findContours<span class=\"token punctuation\">(</span>edged<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>RETR_EXTERNAL<span class=\"token punctuation\">,</span>\n   cv2<span class=\"token punctuation\">.</span>CHAIN_APPROX_SIMPLE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\ncv2<span class=\"token punctuation\">.</span>drawContours<span class=\"token punctuation\">(</span>contours_img<span class=\"token punctuation\">,</span>cnts<span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\ndocCnt <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n \n<span class=\"token comment\"># 确保检测到了</span>\n<span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>cnts<span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n   <span class=\"token comment\"># 根据轮廓大小进行排序</span>\n   cnts <span class=\"token operator\">=</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>cnts<span class=\"token punctuation\">,</span> key<span class=\"token operator\">=</span>cv2<span class=\"token punctuation\">.</span>contourArea<span class=\"token punctuation\">,</span> reverse<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n   <span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> cnts<span class=\"token punctuation\">:</span> <span class=\"token comment\"># 遍历每一个轮廓</span>\n      <span class=\"token comment\"># 近似</span>\n      peri <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>arcLength<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n      approx <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>approxPolyDP<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> <span class=\"token number\">0.02</span> <span class=\"token operator\">*</span> peri<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n      <span class=\"token comment\"># 准备做透视变换</span>\n      <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>approx<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\n         docCnt <span class=\"token operator\">=</span> approx\n         <span class=\"token keyword\">break</span>\n<span class=\"token comment\"># 执行透视变换</span>\nwarped <span class=\"token operator\">=</span> four_point_transform<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> docCnt<span class=\"token punctuation\">.</span>reshape<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n \nthresh <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">(</span>warped<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span>\n   cv2<span class=\"token punctuation\">.</span>THRESH_BINARY_INV <span class=\"token operator\">|</span> cv2<span class=\"token punctuation\">.</span>THRESH_OTSU<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\nthresh_Contours <span class=\"token operator\">=</span> thresh<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 找到每一个圆圈轮廓</span>\ncnts <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>findContours<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>RETR_EXTERNAL<span class=\"token punctuation\">,</span>\n   cv2<span class=\"token punctuation\">.</span>CHAIN_APPROX_SIMPLE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\ncv2<span class=\"token punctuation\">.</span>drawContours<span class=\"token punctuation\">(</span>thresh_Contours<span class=\"token punctuation\">,</span>cnts<span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\nquestionCnts <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> cnts<span class=\"token punctuation\">:</span><span class=\"token comment\"># 遍历</span>\n   <span class=\"token comment\"># 计算比例和大小</span>\n   <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>boundingRect<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span>\n   ar <span class=\"token operator\">=</span> w <span class=\"token operator\">/</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">)</span>\n   <span class=\"token comment\"># 根据实际情况指定标准</span>\n   <span class=\"token keyword\">if</span> w <span class=\"token operator\">&gt;=</span> <span class=\"token number\">20</span> <span class=\"token keyword\">and</span> h <span class=\"token operator\">&gt;=</span> <span class=\"token number\">20</span> <span class=\"token keyword\">and</span> ar <span class=\"token operator\">&gt;=</span> <span class=\"token number\">0.9</span> <span class=\"token keyword\">and</span> ar <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1.1</span><span class=\"token punctuation\">:</span>\n      questionCnts<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 按照从上到下进行排序</span>\nquestionCnts <span class=\"token operator\">=</span> sort_contours<span class=\"token punctuation\">(</span>questionCnts<span class=\"token punctuation\">,</span>\n   method<span class=\"token operator\">=</span><span class=\"token string\">\"top-to-bottom\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\ncorrect <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token comment\"># 每排有5个选项</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>q<span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>arange<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>questionCnts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   cnts <span class=\"token operator\">=</span> sort_contours<span class=\"token punctuation\">(</span>questionCnts<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>i <span class=\"token operator\">+</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n   bubbled <span class=\"token operator\">=</span> <span class=\"token boolean\">None</span>\n   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>cnts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 遍历每一个结果</span>\n      <span class=\"token comment\"># 使用mask来判断结果</span>\n      mask <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span><span class=\"token string\">\"uint8\"</span><span class=\"token punctuation\">)</span>\n      cv2<span class=\"token punctuation\">.</span>drawContours<span class=\"token punctuation\">(</span>mask<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#-1表示填充</span>\n      <span class=\"token comment\"># 通过计算非零点数量来算是否选择这个答案</span>\n      mask <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>bitwise_and<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">,</span> thresh<span class=\"token punctuation\">,</span> mask<span class=\"token operator\">=</span>mask<span class=\"token punctuation\">)</span>\n      total <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>countNonZero<span class=\"token punctuation\">(</span>mask<span class=\"token punctuation\">)</span>\n      <span class=\"token comment\"># 通过阈值判断</span>\n      <span class=\"token keyword\">if</span> bubbled <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span> <span class=\"token keyword\">or</span> total <span class=\"token operator\">&gt;</span> bubbled<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n         bubbled <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>total<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">)</span>\n   <span class=\"token comment\"># 第二步，与正确答案进行对比</span>\n   color <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span>\n   k <span class=\"token operator\">=</span> ANSWER_KEY<span class=\"token punctuation\">[</span>q<span class=\"token punctuation\">]</span>\n   <span class=\"token comment\"># 判断正确</span>\n   <span class=\"token keyword\">if</span> k <span class=\"token operator\">==</span> bubbled<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n      color <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n      correct <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n   cv2<span class=\"token punctuation\">.</span>drawContours<span class=\"token punctuation\">(</span>warped<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>cnts<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> color<span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#绘图</span>\n \n   <span class=\"token comment\">#正确率的文本显示</span>\nscore <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>correct <span class=\"token operator\">/</span> <span class=\"token number\">5.0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[INFO] score: {:.2f}%\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>score<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>warped<span class=\"token punctuation\">,</span> <span class=\"token string\">\"{:.2f}%\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>score<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n   cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_SIMPLEX<span class=\"token punctuation\">,</span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">\"Input\"</span><span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">\"Output\"</span><span class=\"token punctuation\">,</span> warped<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong><mark>最终实现的效果如下：</mark></strong></p>\n<p><img alt=\"请添加图片描述\" src=\"image\\cbad134e25244351a3ba9e104d78792b.png\"/><br/> <img alt=\"请添加图片描述\" src=\"image\\30bd5b3cdf6046dc96a30b5873adb0ae.png\"/><br/> ==没错我是在水文章~ ~ ~ ==</p>\n<p>不知道要友友们爱看点啥~</p>\n<p>我都不知道咋摸鱼啦</p>\n<p>今天的文章就是这样啦</p>\n<h2><a id=\"_180\"></a>我是小熊猫，咱下篇文章再见啦(✿◡‿◡)</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\2b7469a7cf9442189870d43ef49dc3a0.jpeg\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}