{"blogid": "123887300", "writerAge": "码龄4年", "writerBlogNum": "68", "writerCollect": "126", "writerComment": "20", "writerFan": "27", "writerGrade": "3级", "writerIntegral": "765", "writerName": "今夜來看雪", "writerProfileAdress": "writer_image\\profile_123887300.jpg", "writerRankTotal": "28865", "writerRankWeekly": "88668", "writerThumb": "32", "writerVisitNum": "72860", "blog_read_count": "2545", "blog_time": "已于 2022-04-01 23:15:36 修改", "blog_title": "从零开始手把手教你，.net 6用EF Core基本创建表，迁移到mysql数据库", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h3><a id=\"_0\"></a>前言：</h3>\n<p>用到的迁移命令：<br/> Add-Migration test 生成迁移文件命令，test是迁移文件名称<br/> Update-Database 迁移更新到数据库<br/> <strong>用到的NuGet包</strong><br/> 用于绑定上下文::DbContext<br/> Pomelo.EntityFrameworkCore.MySql<br/> 用于迁移<br/> Microsoft.EntityFrameworkCore.Design<br/> Microsoft.EntityFrameworkCore.Tools</p>\n<h4><a id=\"_web_api_11\"></a>一 创建web api项目</h4>\n<p>选择asp.net core web api项目下一步<br/> <img alt=\"在这里插入图片描述\" src=\"image\\a7a1171044104820ac497608f808ac63.png\"/>框架选择.net 6，配置Https要和不要都可以，其他默认，然后点击创建<br/> <img alt=\"在这里插入图片描述\" src=\"image\\edfc14cc01a9418ca84a6fe63c8cfd3f.png\"/><br/> 创建完成后是这样的<br/> <img alt=\"在这里插入图片描述\" src=\"image\\03b321ab5e0643f9a2f12c38b436d2b3.png\"/></p>\n<h4><a id=\"__17\"></a>二 创建准备迁移的表</h4>\n<p>右键添加文件夹，创建一个Context的文件夹，用于存放创建表的类<br/> <img alt=\"在这里插入图片描述\" src=\"image\\8614b1c857f24c7583481841e626f4be.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\b67d7bb1c6f84a998781e4dbc92f5d67.png\"/><br/> 右键依赖项，点击管理NuGet程序包，搜索安装Pomelo.EntityFrameworkCore.MySql<img alt=\"在这里插入图片描述\" src=\"image\\0bfa448794f441b4b4da0be7168ff0fc.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\c2b2d6389058427ab6c36e72956bc8fe.png\"/><br/> 在Context文件夹创建City类<br/> <img alt=\"在这里插入图片描述\" src=\"image\\e73e4ae6775c4ea3a00548c64603c706.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"image\\5fe813f9d8e44f78b297953c5253d3ac.png\"/><br/> 类定义几个变量，也就是迁移到数据库的字段</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">.</span>DataAnnotations</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>ComponentModel<span class=\"token punctuation\">.</span>DataAnnotations<span class=\"token punctuation\">.</span>Schema</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">WebApplication1<span class=\"token punctuation\">.</span>Context</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">City</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Key</span></span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">int</span></span> Id <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Column</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span>TypeName <span class=\"token operator\">=</span> <span class=\"token string\">\"nvarchar(100)\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> Name <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Column</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span>TypeName <span class=\"token operator\">=</span> <span class=\"token string\">\"nvarchar(100)\"</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> AreaCode <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n</code></pre>\n<p>同样在当前Context文件夹创建DemoContext类，用于绑定上下文<br/> <img alt=\"在这里插入图片描述\" src=\"image\\594e4012fa4e4efbb35ee7801dd7d101.png\"/><br/> DemoContext类内容，记住要继承DbContext类</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>EntityFrameworkCore</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">WebApplication1<span class=\"token punctuation\">.</span>Context</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DemoContext</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">DbContext</span></span>\n    <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token comment\">//添加City类</span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">DbSet<span class=\"token punctuation\">&lt;</span>City<span class=\"token punctuation\">&gt;</span></span> Cities <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">//构造函数</span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">DemoContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DbContextOptions<span class=\"token punctuation\">&lt;</span>DemoContext<span class=\"token punctuation\">&gt;</span></span> option<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">base</span><span class=\"token punctuation\">(</span>option<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n\n        <span class=\"token punctuation\">}</span>\n \n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<h4><a id=\"__71\"></a>三 开始迁移</h4>\n<p>在appsettings.json添加字符串连接串,记得要修改Source：数据库连接地址，Database：数据库名称，User ID：用户名;Password：密码，port：端口号，改成你自己数据库的配置</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token string\">\"ConnectionStrings\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token string\">\"DbConnectionString\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\" Data Source=localhost;Database=efcodetest;AllowLoadLocalInfile=true;User ID=root;Password=123456;allowPublicKeyRetrieval=true;pooling=true;CharSet=utf8;port=3306;sslmode=none;\"</span>\n  <span class=\"token punctuation\">}</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\f43e142addb84055ad4e79f3d2d8fcbd.png\"/><br/> 在NuGet程序包上搜索安装下面这两个包，Microsoft.EntityFrameworkCore.Tools<br/> Microsoft.EntityFrameworkCore.Design<br/> 用于迁移基本迁移命令在Microsoft.EntityFrameworkCore.Tools描述下就有<br/> <img alt=\"在这里插入图片描述\" src=\"image\\c71fa84856634818a1e355c5722142e2.png\"/><br/> 在Program.cs配置添加注入下面代码</p>\n<pre><code class=\"prism language-csharp\">builder<span class=\"token punctuation\">.</span>Services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddDbContext</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>DemoContext<span class=\"token punctuation\">&gt;</span></span></span><span class=\"token punctuation\">(</span>option <span class=\"token operator\">=&gt;</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> DbConnectionString <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span>Configuration<span class=\"token punctuation\">.</span><span class=\"token function\">GetConnectionString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DbConnectionString\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    option<span class=\"token punctuation\">.</span><span class=\"token function\">UseMySql</span><span class=\"token punctuation\">(</span>DbConnectionString<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">MySqlServerVersion</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Version</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"image\\f48aa41ca4e04e0387f509262c50ac7c.png\"/><br/> 开始迁移，点击工具，NuGet包管理器，程序包管理器控制台，打开控制台<br/> <img alt=\"在这里插入图片描述\" src=\"image\\e054ca8143d34fa4b2e4a7a040270f8d.png\"/><br/> 生成迁移文件，在控制台输入 Add-Migration test 生成迁移文件命令，test是迁移文件名称，<br/> 然后回车<br/> <img alt=\"在这里插入图片描述\" src=\"image\\5ca96b7f949b44fdbef3236e6e7964dd.png\"/><br/> 生成的迁移文件<br/> <img alt=\"在这里插入图片描述\" src=\"image\\3c879039189646f6a1b4ff9b11b955f5.png\"/><br/> 迁移更新到数据库，在刚才的控制台输入Update-Database<br/> <img alt=\"在这里插入图片描述\" src=\"image\\456107ee3aaf45aebbea3f5416cab6b3.png\"/><br/> 回车确认<br/> <img alt=\"在这里插入图片描述\" src=\"image\\07e863a6575d47faa2149e453191c35d.png\"/></p>\n<p>查看数据库，有表有库，字段一样，迁移成功<br/> <img alt=\"在这里插入图片描述\" src=\"image\\aee2428383d74647aac85120105bd7ea.png\"/></p>\n<p>下篇我们來学习.net 6框架下的EF Core操作数据库基本增删改查</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}