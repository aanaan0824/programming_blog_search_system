{"blogid": "124726902", "writerAge": "码龄4年", "writerBlogNum": "31", "writerCollect": "47", "writerComment": "13", "writerFan": "20", "writerGrade": "2级", "writerIntegral": "370", "writerName": "小张zzzz", "writerProfileAdress": "writer_image\\profile_124726902.jpg", "writerRankTotal": "53288", "writerRankWeekly": "503392", "writerThumb": "41", "writerVisitNum": "27964", "blog_read_count": "864", "blog_time": "于 2022-05-12 11:16:05 发布", "blog_title": "c#导出数据库信息到excel表格", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"_0\"></a>前言`</h1>\n<p>最近在帮学弟学妹弄c#课程设计，在此分享一下封装好的模块程序！</p>\n<hr/>\n<h1><a id=\"NPOL_7\"></a>一、添加引用NPOL</h1>\n<p>很多时候，我们在进行数据导出到Excel文件时，在windows平台需要使用到office组件才可以成功导出，也就是说电脑很多时候都必须安装office才可以。今天分享的这个组件，可以在目标主机不安装office的情况下，对Word或Excel进行读写操作。</p>\n<p>NPOI的优势：<br/> 开源，可以完全免费使用<br/> 包含大部分EXCEL的特性<br/> 支持处理的文件格式包括(xls/xlsx/docx)<br/> 同时支持导入导出<br/> 基于.net 2.0/4.0也支持xlsx和docx格式<br/> 不需要在服务器或目标主机安装office<br/> 它不仅对Excel进行操作，可以对doc,ppt文件进行操作<br/> <img alt=\"在这里插入图片描述\" src=\"image\\cfc8d94eafc148c8b174de8972332b94.png\"/></p>\n<h1><a id=\"_22\"></a>二、使用步骤</h1>\n<h2><a id=\"1_23\"></a>1.引入库</h2>\n<p>添加引用：</p>\n<pre><code class=\"prism language-c\">using System<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">.</span>SqlClient<span class=\"token punctuation\">;</span>\nusing System<span class=\"token punctuation\">.</span>IO<span class=\"token punctuation\">;</span>\nusing NPOI<span class=\"token punctuation\">.</span>SS<span class=\"token punctuation\">.</span>UserModel<span class=\"token punctuation\">;</span>\nusing NPOI<span class=\"token punctuation\">.</span>HSSF<span class=\"token punctuation\">.</span>UserModel<span class=\"token punctuation\">;</span>\n</code></pre>\n<h2><a id=\"2_33\"></a>2.导入模块</h2>\n<p>代码如下：</p>\n<pre><code class=\"prism language-c\">      public <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">ExportToExcel</span><span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">.</span>DataSet ds<span class=\"token punctuation\">,</span> string path<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            StreamWriter sw <span class=\"token operator\">=</span> null<span class=\"token punctuation\">;</span>\n            try\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">long</span> totalCount <span class=\"token operator\">=</span> ds<span class=\"token punctuation\">.</span>Tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span>\n                sw <span class=\"token operator\">=</span> new <span class=\"token function\">StreamWriter</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> false<span class=\"token punctuation\">,</span> Encoding<span class=\"token punctuation\">.</span>Unicode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                StringBuilder sb <span class=\"token operator\">=</span> new <span class=\"token function\">StringBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> ds<span class=\"token punctuation\">.</span>Tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Columns<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    sb<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span>ds<span class=\"token punctuation\">.</span>Tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Columns<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>ColumnName <span class=\"token operator\">+</span> <span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                sb<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span>Environment<span class=\"token punctuation\">.</span>NewLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> ds<span class=\"token punctuation\">.</span>Tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> ds<span class=\"token punctuation\">.</span>Tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Columns<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        sb<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span>ds<span class=\"token punctuation\">.</span>Tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\t\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    sb<span class=\"token punctuation\">.</span><span class=\"token function\">Append</span><span class=\"token punctuation\">(</span>Environment<span class=\"token punctuation\">.</span>NewLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                sw<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>sb<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                sw<span class=\"token punctuation\">.</span><span class=\"token function\">Flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token function\">catch</span> <span class=\"token punctuation\">(</span>IOException ioe<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                throw ioe<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            finally\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sw <span class=\"token operator\">!=</span> null<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    sw<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        public <span class=\"token keyword\">static</span> DataSet <span class=\"token function\">Query</span><span class=\"token punctuation\">(</span>string SQLString<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">using</span> <span class=\"token punctuation\">(</span>SqlConnection connection <span class=\"token operator\">=</span> new <span class=\"token function\">SqlConnection</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"server=.;database=Hotel;uid=sa;pwd=123456\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                DataSet ds <span class=\"token operator\">=</span> new <span class=\"token function\">DataSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                try\n                <span class=\"token punctuation\">{<!-- --></span>\n                    connection<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    SqlDataAdapter command <span class=\"token operator\">=</span> new <span class=\"token function\">SqlDataAdapter</span><span class=\"token punctuation\">(</span>SQLString<span class=\"token punctuation\">,</span> connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    command<span class=\"token punctuation\">.</span>SelectCommand<span class=\"token punctuation\">.</span>CommandTimeout <span class=\"token operator\">=</span> <span class=\"token number\">1800</span><span class=\"token punctuation\">;</span>\n                    command<span class=\"token punctuation\">.</span><span class=\"token function\">Fill</span><span class=\"token punctuation\">(</span>ds<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ds\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token function\">catch</span> <span class=\"token punctuation\">(</span>System<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">.</span>SqlClient<span class=\"token punctuation\">.</span>SqlException ex<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">.</span>State <span class=\"token operator\">==</span> ConnectionState<span class=\"token punctuation\">.</span>Open<span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        connection<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    throw new <span class=\"token function\">Exception</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">.</span>Message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">return</span> ds<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>只需要把SqlConnection(“server=.;database=Hotel;uid=sa;pwd=123456”)改成自己的数据库信息即可</p>\n<h2><a id=\"3_97\"></a>3.调用模块</h2>\n<pre><code class=\"prism language-c\">\t\t\tDataSet ds <span class=\"token operator\">=</span> <span class=\"token function\">Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SELECT * FROM RoomInfo \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            DataTable dt <span class=\"token operator\">=</span> ds<span class=\"token punctuation\">.</span>Tables<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n            SaveFileDialog saveFileDialog1 <span class=\"token operator\">=</span> new <span class=\"token function\">SaveFileDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            saveFileDialog1<span class=\"token punctuation\">.</span>Title <span class=\"token operator\">=</span> <span class=\"token string\">\"保存文件\"</span><span class=\"token punctuation\">;</span>\n            saveFileDialog1<span class=\"token punctuation\">.</span>Filter <span class=\"token operator\">=</span> <span class=\"token string\">\"Excel 文件(*.xls)|*.xls|Excel 文件(*.xlsx)|*.xlsx|所有文件(*.*)|*.*\"</span><span class=\"token punctuation\">;</span>\n            saveFileDialog1<span class=\"token punctuation\">.</span>FileName <span class=\"token operator\">=</span> <span class=\"token string\">\"Book.xls\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>saveFileDialog1<span class=\"token punctuation\">.</span><span class=\"token function\">ShowDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> DialogResult<span class=\"token punctuation\">.</span>OK<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                string path <span class=\"token operator\">=</span> saveFileDialog1<span class=\"token punctuation\">.</span>FileName<span class=\"token punctuation\">;</span>\n                <span class=\"token function\">ExportToExcel</span><span class=\"token punctuation\">(</span>ds<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>只需要把DataSet ds = Query(\"SELECT * FROM RoomInfo \");中的FROM后改成自己的数据库对应的表即可。</p>\n<h1><a id=\"_114\"></a>总结</h1>\n<p>以上就是今天要讲的内容，本文仅仅简单介绍了针对单一数据库表导出excel的使用。转载请声明！</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}