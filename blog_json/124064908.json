{"blogid": "124064908", "writerAge": "码龄5年", "writerBlogNum": "448", "writerCollect": "1530", "writerComment": "400", "writerFan": "309", "writerGrade": "7级", "writerIntegral": "15366", "writerName": "GreAmbWang", "writerProfileAdress": "writer_image\\profile_124064908.jpg", "writerRankTotal": "12915", "writerRankWeekly": "25660", "writerThumb": "648", "writerVisitNum": "1358029", "blog_read_count": "1687", "blog_time": "于 2022-04-09 18:29:30 发布", "blog_title": "C#调用百度地图API，根据地名获取经纬度geocoding", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h2><span style=\"color:#ff9900;\">前言</span></h2>\n<p>公司的一个内部网站维护，需要根据地名填写经纬度，最终同echarts生成地图。</p>\n<p>之前数据比较少，直接经纬度查询查的，https://jingweidu.bmcx.com/</p>\n<p>现在数据越来越多，手动查询太麻烦，于是想到通过地图api批量查询，最后选择了百度地图API。</p>\n<p></p>\n<h2><span style=\"color:#ff9900;\">步骤</span></h2>\n<h3><span style=\"color:#ff9900;\"><strong>一、到百度地图开放平台注册认证，并创建应用，获取ak</strong></span></h3>\n<p>        百度地图开放平台：<a class=\"link-info\" href=\"https://lbsyun.baidu.com/apiconsole/key#/home\" title=\"https://lbsyun.baidu.com/apiconsole/key#/home\">https://lbsyun.baidu.com/apiconsole/key#/home</a></p>\n<p><img alt=\"\" height=\"570\" src=\"image\\5e753f9e0c55436b8c19c807b5785645.png\" width=\"1200\"/></p>\n<h3><span style=\"color:#ff9900;\"><strong>二、查看api文档</strong></span></h3>\n<p>根据地名获取经纬度的接口，可以使用逆地理编码 </p>\n<pre><code class=\"language-html\">https://api.map.baidu.com/geocoding/v3/?address=北京市海淀区上地十街10号&amp;output=json&amp;ak=您的ak&amp;callback=showLocation //GET请求</code></pre>\n<p>接口功能介绍如下<a class=\"link-info\" href=\"https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding\" title=\"https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding\">https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding</a></p>\n<p></p>\n<p><strong>查看请求参数</strong></p>\n<p>可以看到几个主要的参数address，ak，output</p>\n<p><img alt=\"\" height=\"561\" src=\"image\\9721b9a08f2042fb8b1d952d4b577f5d.png\" width=\"989\"/></p>\n<p> </p>\n<p><strong>查看返回结果参数</strong></p>\n<p>status为返回结果状态值，成功返回0，其它值都是失败</p>\n<p><img alt=\"\" height=\"302\" src=\"image\\47315631ef394be9ae2b214602c09225.png\" width=\"970\"/></p>\n<p> <img alt=\"\" height=\"532\" src=\"image\\5294c6b3c4304f55acbb5e89b69cb752.png\" width=\"967\"/></p>\n<p> </p>\n<h3><span style=\"color:#ff9900;\"><strong>三、创建GeocodingMap类，根据地名获取经纬度</strong></span></h3>\n<p>        根据api返回结果参数，创建结果模型</p>\n<div>\n<pre><code class=\"hljs language-cs\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GeocodingResult</span>\n{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">int</span> status { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; } = <span class=\"hljs-number\">-1</span>;\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">string</span> msg { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n    <span class=\"hljs-keyword\">public</span> Result result { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Result</span>\n{\n    <span class=\"hljs-keyword\">public</span> Location location { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">int</span> precise { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">int</span> confidence { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">int</span> comprehension { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">string</span> level { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Location</span>\n{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">float</span> lng { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-built_in\">float</span> lat { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; }\n}\n</code></pre>\n</div>\n<p>        创建几个类，存储ak，请求url，获取经纬度，为了演示方便，这里将几个类写在一起</p>\n<div>\n<pre><code class=\"hljs language-cs\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Config</span>\n{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-built_in\">string</span> Ak { <span class=\"hljs-keyword\">get</span>; <span class=\"hljs-keyword\">set</span>; } = <span class=\"hljs-string\">\"xxxxxxxxxxxxxx\"</span>;<span class=\"hljs-comment\">//这里根据实际填写，填写刚才申请的应用ak</span>\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HttpRequestHelper</span>\n{\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">async</span> Task&lt;<span class=\"hljs-built_in\">string</span>&gt; <span class=\"hljs-title\">RequestUrl</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">string</span> url</span>)</span>\n    {\n        <span class=\"hljs-built_in\">string</span> content = <span class=\"hljs-built_in\">string</span>.Empty;\n        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);\n        <span class=\"hljs-keyword\">using</span> (HttpWebResponse response = (HttpWebResponse)request.GetResponse())\n        {\n            <span class=\"hljs-keyword\">using</span> (StreamReader sr = <span class=\"hljs-keyword\">new</span> StreamReader(response.GetResponseStream()))\n            {\n                content = <span class=\"hljs-keyword\">await</span> sr.ReadToEndAsync();\n            }\n        }\n        <span class=\"hljs-keyword\">return</span> content;\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GeocodingMap</span>\n{\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">async</span> Task&lt;GeocodingResult&gt; <span class=\"hljs-title\">GetGeocoding</span>(<span class=\"hljs-params\"><span class=\"hljs-built_in\">string</span> address</span>)</span>\n    {\n        <span class=\"hljs-comment\">//API 文档：https://lbsyun.baidu.com/index.php?title=webapi/guide/webservice-geocoding</span>\n\n        <span class=\"hljs-built_in\">string</span> url = @<span class=\"hljs-string\">$\"https://api.map.baidu.com/geocoding/v3/?address=<span class=\"hljs-subst\">{address}</span>&amp;output=json&amp;ak=<span class=\"hljs-subst\">{Config.Ak}</span>\"</span>;\n        <span class=\"hljs-built_in\">string</span> strJson = <span class=\"hljs-keyword\">await</span> HttpRequestHelper.RequestUrl(url);\n        <span class=\"hljs-keyword\">var</span> requestResult = JsonSerializer.Deserialize&lt;GeocodingResult&gt;(strJson);\n        <span class=\"hljs-keyword\">return</span> requestResult;\n    }\n}\n\n</code></pre>\n</div>\n<p><span style=\"color:#ff9900;\"><strong>调用</strong></span></p>\n<pre><code class=\"language-cs\">var geocoding = await GeocodingMap.GetGeocoding(address);\nif (geocoding.status == 0)\n{\n    //经纬度\n    var axisX = geocoding.result.location.lng;\n    var axisY = geocoding.result.location.lat\n}\n</code></pre>\n<p></p>\n<p><strong>参考</strong></p>\n<p><a href=\"https://www.cnblogs.com/dengyg0710/p/9553184.html\" title=\"百度地图API根据地名获取经纬度 - 慕尼黑哲哉 - 博客园\">百度地图API根据地名获取经纬度 - 慕尼黑哲哉 - 博客园</a></p>\n</div>\n</div>"}