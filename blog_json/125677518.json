{"blogid": "125677518", "writerAge": "码龄3年", "writerBlogNum": "19", "writerCollect": "172", "writerComment": "94", "writerFan": "2477", "writerGrade": "2级", "writerIntegral": "307", "writerName": "一笑奈何LHY", "writerProfileAdress": "writer_image\\profile_125677518.jpg", "writerRankTotal": "54666", "writerRankWeekly": "4037", "writerThumb": "58", "writerVisitNum": "49967", "blog_read_count": "3488", "blog_time": "于 2022-07-08 14:27:39 发布", "blog_title": "YOLOv7 Tensorrt Python部署教程", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h2><a id=\"B_0\"></a>B站教学视频</h2>\n<p><a href=\"https://www.bilibili.com/video/BV1q34y1n7Bw/\">https://www.bilibili.com/video/BV1q34y1n7Bw/</a></p>\n<h2><a id=\"Github_4\"></a>Github仓库地址</h2>\n<p><a href=\"https://github.com/Monday-Leo/YOLOv7_Tensorrt\">https://github.com/Monday-Leo/YOLOv7_Tensorrt</a></p>\n<h2><a id=\"Introduction_6\"></a>Introduction</h2>\n<p><strong>YOLOv7</strong>是YOLOv4的原班人马(<strong>Alexey Bochkovskiy</strong>在内)创造的目标检测模型，在保证精度的同时大幅降低了参数量，本仓库实现<strong>YOLOv7的tensorrt部署</strong>。</p>\n<div align=\"center\">\n<img src=\"image\\738e90c343aa4018b9e1e5760568c63f.png\" width=\"600\"/>\n</div>\n<h2><a id=\"Environment_14\"></a>Environment</h2>\n<ul><li>Tensorrt 8.4.1.5</li><li>Cuda 10.2 Cudnn 8.4.1</li><li>onnx 1.12.0</li><li>onnx-simplifier 0.3.10</li><li>Torch 1.7.1</li></ul>\n<h2><a id=\"Benchmark_22\"></a>Benchmark</h2>\n<table><thead><tr><th align=\"center\">Model</th><th align=\"center\">Size</th><th align=\"center\">mAP<sup>test</sup> 0.5:0.95</th><th align=\"center\">GTX1650 FP16(ms)</th><th align=\"center\">GTX1650 FP32(ms)</th></tr></thead><tbody><tr><td align=\"center\">YOLOv7-tiny</td><td align=\"center\">640</td><td align=\"center\">38.7</td><td align=\"center\">8.7</td><td align=\"center\">11.6</td></tr><tr><td align=\"center\">YOLOv7</td><td align=\"center\">640</td><td align=\"center\">51.4</td><td align=\"center\">27.2</td><td align=\"center\">47.5</td></tr><tr><td align=\"center\">YOLOv7-X</td><td align=\"center\">640</td><td align=\"center\">53.1</td><td align=\"center\">44.2</td><td align=\"center\">82.9</td></tr></tbody></table>\n<p>说明：此处FP16,fp32预测时间包含<strong>preprocess+inference+nms</strong>，测速方法为warmup10次，预测100次取平均值，并未使用trtexec测速，与官方测速不同；mAP<sup>val</sup>为原始模型精度，转换后精度未测试。</p>\n<h2><a id=\"Quick_Start_32\"></a>Quick Start</h2>\n<p>下载<strong>YOLOv7</strong>仓库。</p>\n<pre><code>git clone https://github.com/WongKinYiu/yolov7\n</code></pre>\n<p>将本仓库的<strong>EfficientNMS.py</strong>和<strong>export_onnx.py</strong>复制到<strong>yolov7</strong>下，导出含有EfficientNMS的ONNX模型。</p>\n<pre><code>python export_onnx.py --weights ./weights/yolov7.pt\n</code></pre>\n<p>将生成的<strong>onnx</strong>模型复制到<strong>tensorrt/bin</strong>文件夹下，使用官方<strong>trtexec</strong>转化添加完EfficientNMS的onnx模型。<strong>FP32预测删除<code>--fp16</code>参数即可</strong>。</p>\n<pre><code>trtexec --onnx=./yolov7.onnx --saveEngine=./yolov7_fp16.engine --fp16 --workspace=200\n</code></pre>\n<p>等待生成序列化模型后，修改本仓库<strong>infer.py模型路径和图片路径</strong>。</p>\n<pre><code>trt_engine = TRT_engine(\"./trt_model/yolov7_fp16.engine\")\nimg1 = cv2.imread(\"./pictures/zidane.jpg\")\n</code></pre>\n<pre><code>python infer.py\n</code></pre>\n<div align=\"center\">\n<img src=\"image\\1b544c6095ed4efaa3d4c17a454e8767.png\" width=\"800\"/>\n</div>\n<h2><a id=\"Reference_67\"></a>Reference</h2>\n<p><a href=\"https://github.com/WongKinYiu/yolov7\">https://github.com/WongKinYiu/yolov7</a></p>\n<p><a href=\"https://github.com/ultralytics/yolov5\">https://github.com/ultralytics/yolov5</a></p>\n<p><a href=\"https://github.com/Linaom1214/tensorrt-python\">https://github.com/Linaom1214/tensorrt-python</a></p>\n<p><a href=\"https://github.com/triple-Mu\">https://github.com/triple-Mu</a></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}