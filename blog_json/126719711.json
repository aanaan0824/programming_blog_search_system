{"blogid": "126719711", "writerAge": "ç é¾„1å¹´", "writerBlogNum": "175", "writerCollect": "413", "writerComment": "299", "writerFan": "3370", "writerGrade": "5çº§", "writerIntegral": "2618", "writerName": "gh-xiaohe", "writerProfileAdress": "writer_image\\profile_126719711.jpg", "writerRankTotal": "7103", "writerRankWeekly": "3775", "writerThumb": "442", "writerVisitNum": "80454", "blog_read_count": "15", "blog_time": "äºÂ 2022-09-07 12:00:55Â å‘å¸ƒ", "blog_title": "ç‘å‰å¤–å–ä»£ç ä¼˜åŒ–", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-kimbie-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>æ–‡ç« ç›®å½•</h3>\n<ul><li><a href=\"#x1F492__6\">ğŸ’’ ä¼˜åŒ–</a></li><li><ul><li><a href=\"#x1F68F_1_8\">ğŸš 1ã€ç¼“å­˜ä¼˜åŒ–</a></li><li><ul><li><a href=\"#x1F680_1_13\">ğŸš€ 1ã€ç¯å¢ƒæ­å»º</a></li><li><ul><li><a href=\"#x1F6AC_maven_15\">ğŸš¬ mavenåæ ‡</a></li><li><a href=\"#x1F6AC__27\">ğŸš¬ é…ç½®æ–‡ä»¶</a></li><li><a href=\"#x1F6AC__41\">ğŸš¬ é…ç½®ç±»</a></li></ul>\n</li><li><a href=\"#x1F684_2_67\">ğŸš„ 2ã€ç¼“å­˜çŸ­ä¿¡éªŒè¯ç </a></li><li><ul><li><a href=\"#x1F6AC_Redis_74\">ğŸš¬ å°†éªŒè¯ç ç¼“å­˜åœ¨Redisä¸­</a></li><li><a href=\"#x1F6AC__85\">ğŸš¬ ä»£ç å®ç°</a></li></ul>\n</li><li><a href=\"#x1F692_3_181\">ğŸš’ 3ã€ç¼“å­˜èœå“æ•°æ®</a></li><li><ul><li><a href=\"#x1F6AC__183\">ğŸš¬ ç¼“å­˜ä¼˜åŒ–è¯¦è§£</a></li><li><a href=\"#x1F6AC__200\">ğŸš¬ ä»£ç å®ç°</a></li><li><ul><li><a href=\"#_DishControllerRedisTemplateRedis_202\">ğŸš­ åœ¨DishControllerä¸­æ³¨å…¥RedisTemplateå¯¹è±¡ï¼Œç”¨äºæ“ä½œRedis</a></li><li><a href=\"#_DishControllerlist_209\">ğŸš­ æ”¹é€ DishControllerçš„listæ–¹æ³•</a></li><li><a href=\"#_DishControllersave_282\">ğŸš­ æ”¹é€ DishControllerçš„saveæ–¹æ³•</a></li><li><a href=\"#_DishControllerupdate_313\">ğŸš­ æ”¹é€ DishControllerçš„updateæ–¹æ³•</a></li></ul>\n</li></ul>\n</li><li><a href=\"#x1F6A4_4Spring_Cache_343\">ğŸš¤ 4ã€Spring Cacheï¼ˆæ–°æŠ€æœ¯é‡è¦ï¼‰</a></li><li><ul><li><a href=\"#x1F6AC_Spring_Cache__348\">ğŸš¬ Spring Cache ä»‹ç»</a></li><li><a href=\"#x1F6AC_CacheManager_361\">ğŸš¬ é’ˆå¯¹ä¸åŒçš„ç¼“å­˜æŠ€æœ¯éœ€è¦å®ç°ä¸åŒçš„CacheManagerï¼š</a></li><li><a href=\"#x1F6AC_Spring_Cache__366\">ğŸš¬ Spring Cache å¸¸ç”¨æ³¨è§£</a></li><li><a href=\"#x1F6AC_Spring_Cache__375\">ğŸš¬ Spring Cache ä½¿ç”¨æ–¹å¼</a></li><li><ul><li><a href=\"#_1maven_380\">ğŸš­ 1ã€å¯¼å…¥mavenåæ ‡</a></li><li><a href=\"#_2applicationyml_394\">ğŸš­ 2ã€é…ç½®application.yml</a></li><li><a href=\"#_3EnableCaching_403\">ğŸš­ 3ã€åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</a></li><li><a href=\"#_4ControllerCacheableCacheEvict_419\">ğŸš­ 4ã€åœ¨Controllerçš„æ–¹æ³•ä¸ŠåŠ å…¥@Cacheableã€@CacheEvictç­‰æ³¨è§£ï¼Œè¿›è¡Œç¼“å­˜æ“ä½œ</a></li></ul>\n</li><li><a href=\"#x1F6AC_Spring_Cache__465\">ğŸš¬ Spring Cache ä¸Šä¸‹æ–‡æ•°æ®</a></li></ul>\n</li><li><a href=\"#x1F697_5_Spring_Cache__468\">ğŸš— 5ã€ç¼“å­˜å¥—é¤æ•°æ® ä½¿ç”¨Spring Cache æ³¨è§£å®ç°</a></li><li><ul><li><a href=\"#x1F6AC__481\">ğŸš¬ ä»£ç å®ç°</a></li><li><ul><li><a href=\"#_1maven_511\">ğŸš­ 1ã€å¯¼å…¥mavenåæ ‡</a></li><li><a href=\"#_2applicationyml_525\">ğŸš­ 2ã€é…ç½®application.yml</a></li><li><a href=\"#_3EnableCaching_534\">ğŸš­ 3ã€åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</a></li><li><a href=\"#_4SetmealControllerlistCacheable_550\">ğŸš­ 4ã€åœ¨SetmealControllerçš„listæ–¹æ³•ä¸ŠåŠ å…¥@Cacheableæ³¨è§£ï¼š</a></li><li><a href=\"#_5SetmealControllersavedeleteCacheEvict_572\">ğŸš­ 5ã€åœ¨SetmealControllerçš„saveå’Œdeleteæ–¹æ³•ä¸ŠåŠ å…¥@CacheEvictæ³¨è§£</a></li><li><a href=\"#_6R_606\">ğŸš­ 6ã€è¿”å›ç»“æœç±»Réœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ï¼š</a></li></ul>\n</li></ul>\n</li></ul>\n</li></ul>\n</li></ul>\n</div>\n<p></p>\n<blockquote>\n<p>ğŸ˜¹ <font color=\"#d71345\" size=\"3\"> ä½œè€…: gh-xiaohe<br/> ğŸ˜» <font color=\"##102b6a\" size=\"3\"> <a href=\"https://blog.csdn.net/gh_xiaohe\">gh-xiaoheçš„åšå®¢</a><br/> ğŸ˜½ <font color=\"#f26522\" size=\"3\"> è§‰å¾—åšä¸»æ–‡ç« å†™çš„ä¸é”™çš„è¯ï¼Œå¸Œæœ›å¤§å®¶ä¸‰è¿ï¼ˆâœŒå…³æ³¨ï¼ŒâœŒç‚¹èµï¼ŒâœŒè¯„è®ºï¼‰ï¼Œå¤šå¤šæ”¯æŒä¸€ä¸‹ï¼ï¼ï¼</font></font></font></p>\n</blockquote>\n<h1><a id=\"x1F492__6\"></a>ğŸ’’ ä¼˜åŒ–</h1>\n<h2><a id=\"x1F68F_1_8\"></a>ğŸš 1ã€ç¼“å­˜ä¼˜åŒ–</h2>\n<p><img alt=\"[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-kduZr3p2-1662430900182)(%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96.assets/image-20220906091031971.png)]\" src=\"image\\198ca71fae0040efb75f88f1f33b6c39.png\"/></p>\n<h3><a id=\"x1F680_1_13\"></a>ğŸš€ 1ã€ç¯å¢ƒæ­å»º</h3>\n<h4><a id=\"x1F6AC_maven_15\"></a>ğŸš¬ mavenåæ ‡</h4>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><strong>åœ¨é¡¹ç›®çš„pom.xmlæ–‡ä»¶ä¸­å¯¼å…¥spring data redisçš„mavenåæ ‡ï¼š</strong><br/> </font></p>\n<pre><code class=\"prism language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<h4><a id=\"x1F6AC__27\"></a>ğŸš¬ é…ç½®æ–‡ä»¶</h4>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><strong>åœ¨é¡¹ç›®çš„application.ymlä¸­åŠ å…¥redisç›¸å…³é…ç½®ï¼š</strong><br/> </font></p>\n<pre><code class=\"prism language-yaml\">spring\n  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> 192.168.28.129\n    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span>\n    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span>\n    <span class=\"token key atrule\">database</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n</code></pre>\n<h4><a id=\"x1F6AC__41\"></a>ğŸš¬ é…ç½®ç±»</h4>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><strong>åœ¨é¡¹ç›®ä¸­åŠ å…¥é…ç½®ç±»RedisConfigï¼š</strong><br/> </font></p>\n<pre><code class=\"prism language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cache<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">CachingConfigurerSupport</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Bean</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Configuration</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RedisConnectionFactory</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">RedisTemplate</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>serializer<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RedisConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CachingConfigurerSupport</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">redisTemplate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RedisConnectionFactory</span> connectionFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> redisTemplate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RedisTemplate</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//é»˜è®¤çš„Keyåºåˆ—åŒ–å™¨ä¸ºï¼šJdkSerializationRedisSerializer</span>\n        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setKeySerializer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">StringRedisSerializer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">setConnectionFactory</span><span class=\"token punctuation\">(</span>connectionFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> redisTemplate<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3><a id=\"x1F684_2_67\"></a>ğŸš„ 2ã€ç¼“å­˜çŸ­ä¿¡éªŒè¯ç </h3>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><strong>å‰é¢æˆ‘ä»¬å·²ç»å®ç°äº†ç§»åŠ¨ç«¯æ‰‹æœºéªŒè¯ç ç™»å½•ï¼Œéšæœºç”Ÿæˆçš„éªŒè¯ç æˆ‘ä»¬æ˜¯ä¿å­˜åœ¨HttpSessionä¸­çš„ã€‚</strong><br/> </font></p>\n<h4><a id=\"x1F6AC_Redis_74\"></a>ğŸš¬ å°†éªŒè¯ç ç¼“å­˜åœ¨Redisä¸­</h4>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><strong>å…·ä½“çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼š</strong><br/> </font></p>\n<ul><li>1ã€åœ¨æœåŠ¡ç«¯UserControllerä¸­æ³¨å…¥<strong>RedisTemplate</strong>å¯¹è±¡ï¼Œç”¨äºæ“ä½œ<strong>Redis</strong></li><li>2ã€åœ¨æœåŠ¡ç«¯UserControllerçš„<strong>sendMsg</strong>æ–¹æ³•ä¸­ï¼Œå°†éšæœºç”Ÿæˆçš„éªŒè¯ç ç¼“å­˜åˆ°<strong>Redis</strong>ä¸­ï¼Œå¹¶è®¾ç½®æœ‰æ•ˆæœŸä¸º<strong>5</strong>åˆ†é’Ÿ</li><li>3ã€åœ¨æœåŠ¡ç«¯UserControllerçš„<strong>login</strong>æ–¹æ³•ä¸­ï¼Œä»Redisä¸­è·å–ç¼“å­˜çš„éªŒè¯ç ï¼Œå¦‚æœç™»å½•æˆåŠŸåˆ™<strong>åˆ é™¤Redis</strong>ä¸­çš„éªŒè¯ç </li></ul>\n<h4><a id=\"x1F6AC__85\"></a>ğŸš¬ ä»£ç å®ç°</h4>\n<pre><code class=\"prism language-java\"><span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserController</span> <span class=\"token punctuation\">{<!-- --></span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserService</span> userService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisTemplate</span> redisTemplate<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * å‘é€æ‰‹æœºçŸ­ä¿¡éªŒè¯ç  -- æ”¹é€ åŠ å…¥åˆ°redisä¸­\n     * @param user\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/sendMsg\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">sendMsg</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token comment\">//è·å–æ‰‹æœºå·</span>\n        <span class=\"token class-name\">String</span> phone <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPhone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNotEmpty</span><span class=\"token punctuation\">(</span>phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token comment\">//ç”Ÿæˆéšæœºçš„4ä½éªŒè¯ç </span>\n            <span class=\"token class-name\">String</span> code <span class=\"token operator\">=</span> <span class=\"token class-name\">ValidateCodeUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">generateValidateCode</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code={}\"</span><span class=\"token punctuation\">,</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">//è°ƒç”¨é˜¿é‡Œäº‘æä¾›çš„çŸ­ä¿¡æœåŠ¡APIå®Œæˆå‘é€çŸ­ä¿¡</span>\n            <span class=\"token comment\">//SMSUtils.sendMessage(\"ç‘å‰å¤–å–\",\"\",phone,code);</span>\n\n            <span class=\"token comment\">//éœ€è¦å°†ç”Ÿæˆçš„éªŒè¯ç ä¿å­˜åˆ°Session</span>\n            <span class=\"token comment\">//session.setAttribute(phone,code);</span>\n\n            <span class=\"token comment\">//å°†ç”Ÿæˆçš„éªŒè¯ç ç¼“å­˜åˆ°Redisä¸­ï¼Œå¹¶ä¸”è®¾ç½®æœ‰æ•ˆæœŸä¸º5åˆ†é’Ÿ</span>\n            redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>phone<span class=\"token punctuation\">,</span>code<span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>MINUTES<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æœ‰æ•ˆæœŸäº”åˆ†é’Ÿ</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ‰‹æœºéªŒè¯ç çŸ­ä¿¡å‘é€æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"çŸ­ä¿¡å‘é€å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * ç§»åŠ¨ç«¯ç”¨æˆ·ç™»å½• -- æ”¹é€ åŠ å…¥åˆ°redisä¸­\n     * @param map\n     * @param session\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@PostMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/login\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">login</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">Map</span> map<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpSession</span> session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//è·å–æ‰‹æœºå·</span>\n        <span class=\"token class-name\">String</span> phone <span class=\"token operator\">=</span> map<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"phone\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//è·å–éªŒè¯ç </span>\n        <span class=\"token class-name\">String</span> code <span class=\"token operator\">=</span> map<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//ä»Sessionä¸­è·å–ä¿å­˜çš„éªŒè¯ç </span>\n        <span class=\"token comment\">//Object codeInSession = session.getAttribute(phone);</span>\n\n        <span class=\"token comment\">//ä»Redisä¸­è·å–ç¼“å­˜çš„éªŒè¯ç </span>\n        <span class=\"token class-name\">Object</span> codeInSession <span class=\"token operator\">=</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//è¿›è¡ŒéªŒè¯ç çš„æ¯”å¯¹ï¼ˆé¡µé¢æäº¤çš„éªŒè¯ç å’ŒSessionä¸­ä¿å­˜çš„éªŒè¯ç æ¯”å¯¹ï¼‰</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>codeInSession <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> codeInSession<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token comment\">//å¦‚æœèƒ½å¤Ÿæ¯”å¯¹æˆåŠŸï¼Œè¯´æ˜ç™»å½•æˆåŠŸ</span>\n\n            <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">&gt;</span></span> queryWrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            queryWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token operator\">::</span><span class=\"token function\">getPhone</span><span class=\"token punctuation\">,</span>phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">getOne</span><span class=\"token punctuation\">(</span>queryWrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>user <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token comment\">//åˆ¤æ–­å½“å‰æ‰‹æœºå·å¯¹åº”çš„ç”¨æˆ·æ˜¯å¦ä¸ºæ–°ç”¨æˆ·ï¼Œå¦‚æœæ˜¯æ–°ç”¨æˆ·å°±è‡ªåŠ¨å®Œæˆæ³¨å†Œ</span>\n                user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                user<span class=\"token punctuation\">.</span><span class=\"token function\">setPhone</span><span class=\"token punctuation\">(</span>phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                user<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                userService<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            session<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">//å¦‚æœç”¨æˆ·ç™»å½•æˆåŠŸï¼Œåˆ é™¤Redisä¸­ç¼“å­˜çš„éªŒè¯ç </span>\n            redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>phone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ç™»å½•å¤±è´¥\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\864dff6df6234c14b937dfcbc7ea6033.png\"/><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\403e354d7b684ee19f038793d39c5e4f.png\"/></p>\n<h3><a id=\"x1F692_3_181\"></a>ğŸš’ 3ã€ç¼“å­˜èœå“æ•°æ®</h3>\n<h4><a id=\"x1F6AC__183\"></a>ğŸš¬ ç¼“å­˜ä¼˜åŒ–è¯¦è§£</h4>\n<blockquote>\n<p>â€‚â€‚â€‚â€‚å‰é¢æˆ‘ä»¬å·²ç»å®ç°äº†<strong>ç§»åŠ¨ç«¯èœå“æŸ¥çœ‹åŠŸèƒ½</strong>ï¼Œå¯¹åº”çš„æœåŠ¡ç«¯æ–¹æ³•ä¸º<strong>DishController</strong>çš„<strong>list</strong>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šæ ¹æ®å‰ç«¯<strong>æäº¤çš„æŸ¥è¯¢æ¡ä»¶</strong>è¿›è¡Œæ•°æ®åº“<strong>æŸ¥è¯¢æ“ä½œ</strong>ã€‚åœ¨<mark>é«˜å¹¶å‘</mark>çš„æƒ…å†µä¸‹ï¼Œ<strong>é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“</strong>ä¼šå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼ŒæœåŠ¡ç«¯å“åº”æ—¶é—´å¢é•¿ã€‚ç°åœ¨éœ€è¦å¯¹æ­¤æ–¹æ³•è¿›è¡Œç¼“å­˜ä¼˜åŒ–ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>\n</blockquote>\n<p><font color=\"#f47920\" size=\"4\"><strong>å…·ä½“çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼š</strong><br/> </font></p>\n<ul><li>1ã€æ”¹é€ <strong>DishController</strong>çš„<strong>list</strong>æ–¹æ³•ï¼Œå…ˆä»<strong>Redis</strong>ä¸­<strong>è·å–èœå“æ•°æ®</strong>ï¼Œå¦‚æœ<strong>æœ‰</strong>åˆ™ç›´æ¥<strong>è¿”å›</strong>ï¼Œæ— éœ€æŸ¥è¯¢æ•°æ®åº“;å¦‚æœ<strong>æ²¡æœ‰</strong>åˆ™<strong>æŸ¥è¯¢æ•°æ®åº“</strong>ï¼Œ<strong>å¹¶</strong>å°†æŸ¥è¯¢åˆ°çš„èœå“æ•°æ®<strong>æ”¾å…¥Redis</strong>ã€‚</li><li>2ã€æ”¹é€ <strong>DishController</strong>çš„<strong>save</strong>å’Œ<strong>update</strong>æ–¹æ³•ï¼ŒåŠ å…¥<strong>æ¸…ç†ç¼“å­˜</strong>çš„é€»è¾‘ \n  <ul><li>å¦‚æœä¸è¿›è¡Œæ¸…ç†ï¼Œå°±ä¼šé€ æˆ<strong>æ•°æ®åº“</strong>çš„æ–‡ä»¶å’Œ<strong>ç¼“å­˜</strong>ä¸­æ–‡ä»¶<strong>ä¸ä¸€è‡´</strong>ï¼Œç§°ä¹‹ä¸º<strong>è„æ•°æ®</strong></li></ul> </li></ul>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\875d8d40398049a593259db293b110ed.png\"/></p>\n<p><img alt=\"[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-55i3tWnz-1662433687594)(%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96.assets/image-20220906105014480.png)]\" src=\"image\\8909e54c59944b73a7290350c27d42eb.png\"/></p>\n<h4><a id=\"x1F6AC__200\"></a>ğŸš¬ ä»£ç å®ç°</h4>\n<h5><a id=\"_DishControllerRedisTemplateRedis_202\"></a>ğŸš­ åœ¨DishControllerä¸­æ³¨å…¥RedisTemplateå¯¹è±¡ï¼Œç”¨äºæ“ä½œRedis</h5>\n<pre><code class=\"prism language-java\"><span class=\"token annotation punctuation\">@Autowired</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">RedisTemplate</span> redisTemplate<span class=\"token punctuation\">;</span>\n</code></pre>\n<h5><a id=\"_DishControllerlist_209\"></a>ğŸš­ æ”¹é€ DishControllerçš„listæ–¹æ³•</h5>\n<pre><code class=\"prism language-java\"><span class=\"token comment\">/**\n * æ ¹æ®æ¡ä»¶æŸ¥è¯¢å¯¹åº”çš„èœå“æ•°æ® -- æ”¹é€ åŠ å…¥åˆ°redisä¸­\n *\n * @param dish\n * @return\n */</span>\n<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/list\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DishDto</span><span class=\"token punctuation\">&gt;</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dish</span> dish<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DishDto</span><span class=\"token punctuation\">&gt;</span></span> dishDtoList <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//åŠ¨æ€æ„é€ key æ ¹æ®åˆ†ç±»çš„idå»åŒºåˆ† http://localhost:8080/dish/list?categoryId=1397844263642378242&amp;status=1</span>\n    <span class=\"token class-name\">String</span> key <span class=\"token operator\">=</span> <span class=\"token string\">\"dish_\"</span> <span class=\"token operator\">+</span> dish<span class=\"token punctuation\">.</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"_\"</span> <span class=\"token operator\">+</span> dish<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//dish_1397844391040167938_1</span>\n\n    <span class=\"token comment\">//å…ˆä»redisä¸­è·å–ç¼“å­˜æ•°æ®</span>\n    dishDtoList <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DishDto</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">)</span> redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dishDtoList <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token comment\">//å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œæ— éœ€æŸ¥è¯¢æ•°æ®åº“</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>dishDtoList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">//æ„é€ æŸ¥è¯¢æ¡ä»¶</span>\n    <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dish</span><span class=\"token punctuation\">&gt;</span></span> queryWrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    queryWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span>dish<span class=\"token punctuation\">.</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Dish</span><span class=\"token operator\">::</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">,</span> dish<span class=\"token punctuation\">.</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//æ·»åŠ æ¡ä»¶ï¼ŒæŸ¥è¯¢çŠ¶æ€ä¸º1ï¼ˆèµ·å”®çŠ¶æ€ï¼‰çš„èœå“</span>\n    queryWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dish</span><span class=\"token operator\">::</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//æ·»åŠ æ’åºæ¡ä»¶</span>\n    queryWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">orderByAsc</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dish</span><span class=\"token operator\">::</span><span class=\"token function\">getSort</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orderByDesc</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Dish</span><span class=\"token operator\">::</span><span class=\"token function\">getUpdateTime</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Dish</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> dishService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span>queryWrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    dishDtoList <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span> <span class=\"token operator\">-&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token class-name\">DishDto</span> dishDto <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DishDto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">BeanUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">copyProperties</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> dishDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">Long</span> categoryId <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//åˆ†ç±»id</span>\n        <span class=\"token comment\">//æ ¹æ®idæŸ¥è¯¢åˆ†ç±»å¯¹è±¡</span>\n        <span class=\"token class-name\">Category</span> category <span class=\"token operator\">=</span> categoryService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>categoryId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>category <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\">String</span> categoryName <span class=\"token operator\">=</span> category<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            dishDto<span class=\"token punctuation\">.</span><span class=\"token function\">setCategoryName</span><span class=\"token punctuation\">(</span>categoryName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">//å½“å‰èœå“çš„id</span>\n        <span class=\"token class-name\">Long</span> dishId <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DishFlavor</span><span class=\"token punctuation\">&gt;</span></span> lambdaQueryWrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        lambdaQueryWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DishFlavor</span><span class=\"token operator\">::</span><span class=\"token function\">getDishId</span><span class=\"token punctuation\">,</span> dishId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//SQL:select * from dish_flavor where dish_id = ?</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DishFlavor</span><span class=\"token punctuation\">&gt;</span></span> dishFlavorList <span class=\"token operator\">=</span> dishFlavorService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span>lambdaQueryWrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        dishDto<span class=\"token punctuation\">.</span><span class=\"token function\">setFlavors</span><span class=\"token punctuation\">(</span>dishFlavorList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> dishDto<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//å¦‚æœä¸å­˜åœ¨ï¼Œéœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æŸ¥è¯¢åˆ°çš„èœå“æ•°æ®ç¼“å­˜åˆ°Redis</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">opsForValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> dishDtoList<span class=\"token punctuation\">,</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>MINUTES<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>dishDtoList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\c869352176bf4399a8fafaaf5f671ec3.png\"/><br/> â€‚<br/> <font color=\"#f47920\" size=\"4\"><strong>æµ‹è¯•</strong> </font><br/> â€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\c456f4f455ca4f5c8325bded6f0fabbb.png\"/></p>\n<h5><a id=\"_DishControllersave_282\"></a>ğŸš­ æ”¹é€ DishControllerçš„saveæ–¹æ³•</h5>\n<ul><li><strong>å…¨éƒ¨æ¸…ç†key</strong></li><li><strong>åªæ¸…ç†ä¿®æ”¹åˆ†ç±»ä¸‹é¢çš„keyçš„ç¼“å­˜æ•°æ®</strong></li></ul>\n<pre><code class=\"prism language-java\"><span class=\"token comment\">/**\n * æ–°å¢èœå“ -- æ”¹é€ åŠ å…¥åˆ°redisä¸­\n *\n * @param dishDto\n * @return\n */</span>\n<span class=\"token annotation punctuation\">@PostMapping</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">DishDto</span> dishDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>dishDto<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    dishService<span class=\"token punctuation\">.</span><span class=\"token function\">saveWithFlavor</span><span class=\"token punctuation\">(</span>dishDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//æ¸…ç†æ‰€æœ‰èœå“çš„ç¼“å­˜æ•°æ®</span>\n    <span class=\"token comment\">//Set keys = redisTemplate.keys(\"dish_*\");// è·å¾—æ‰€æœ‰ä»¥dish_å¼€å¤´çš„key</span>\n    <span class=\"token comment\">//redisTemplate.delete(keys);</span>\n\n    <span class=\"token comment\">//æ¸…ç†æŸä¸ªåˆ†ç±»ä¸‹é¢çš„èœå“ç¼“å­˜æ•°æ®</span>\n    <span class=\"token class-name\">String</span> key <span class=\"token operator\">=</span> <span class=\"token string\">\"dish_\"</span> <span class=\"token operator\">+</span> dishDto<span class=\"token punctuation\">.</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"_1\"</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–°å¢èœå“æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h5><a id=\"_DishControllerupdate_313\"></a>ğŸš­ æ”¹é€ DishControllerçš„updateæ–¹æ³•</h5>\n<ul><li><strong>å…¨éƒ¨æ¸…ç†key</strong></li><li><strong>åªæ¸…ç†ä¿®æ”¹åˆ†ç±»ä¸‹é¢çš„keyçš„ç¼“å­˜æ•°æ®</strong></li></ul>\n<pre><code class=\"prism language-java\"><span class=\"token comment\">/**\n * ä¿®æ”¹èœå“ -- æ”¹é€ åŠ å…¥åˆ°redisä¸­\n *\n * @param dishDto\n * @return\n */</span>\n<span class=\"token annotation punctuation\">@PutMapping</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">DishDto</span> dishDto<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>dishDto<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    dishService<span class=\"token punctuation\">.</span><span class=\"token function\">updateWithFlavor</span><span class=\"token punctuation\">(</span>dishDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//æ¸…ç†æ‰€æœ‰èœå“çš„ç¼“å­˜æ•°æ®</span>\n    <span class=\"token comment\">//Set keys = redisTemplate.keys(\"dish_*\");// è·å¾—æ‰€æœ‰ä»¥dish_å¼€å¤´çš„key</span>\n    <span class=\"token comment\">//redisTemplate.delete(keys);</span>\n\n    <span class=\"token comment\">//æ¸…ç†æŸä¸ªåˆ†ç±»ä¸‹é¢çš„èœå“ç¼“å­˜æ•°æ®</span>\n    <span class=\"token class-name\">String</span> key <span class=\"token operator\">=</span> <span class=\"token string\">\"dish_\"</span> <span class=\"token operator\">+</span> dishDto<span class=\"token punctuation\">.</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"_1\"</span><span class=\"token punctuation\">;</span>\n    redisTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ä¿®æ”¹èœå“æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3><a id=\"x1F6A4_4Spring_Cache_343\"></a>ğŸš¤ 4ã€Spring Cacheï¼ˆæ–°æŠ€æœ¯é‡è¦ï¼‰</h3>\n<blockquote>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><strong>æ•´åˆç¼“å­˜çš„æ¡†æ¶ æ³¨è§£å®ç°</strong><br/> </font></p>\n</blockquote>\n<h4><a id=\"x1F6AC_Spring_Cache__348\"></a>ğŸš¬ Spring Cache ä»‹ç»</h4>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><font color=\"red\" size=\"4\"><strong>Spring Cache</strong></font>æ˜¯ä¸€ä¸ª<font color=\"red\" size=\"4\"><strong>æ¡†æ¶</strong></font>ï¼Œå®ç°äº†<font color=\"red\" size=\"4\"><strong>åŸºäºæ³¨è§£çš„ç¼“å­˜åŠŸèƒ½</strong></font>ï¼Œåªéœ€è¦<font color=\"red\" size=\"4\"><strong>ç®€å•åœ°åŠ ä¸€ä¸ªæ³¨è§£</strong></font>ï¼Œå°±èƒ½<font color=\"red\" size=\"4\"><strong>å®ç°ç¼“å­˜åŠŸèƒ½</strong></font>ã€‚<br/> </font></p>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><font color=\"red\" size=\"4\"><strong>Spring Cache</strong></font>æä¾›äº†ä¸€å±‚æŠ½è±¡ï¼Œåº•å±‚å¯ä»¥åˆ‡æ¢ä¸åŒçš„<font color=\"red\" size=\"4\"><strong>cacheå®ç°</strong></font>ã€‚å…·ä½“å°±æ˜¯é€šè¿‡<font color=\"red\" size=\"4\"><strong>CacheManageræ¥å£</strong></font>æ¥<font color=\"red\" size=\"4\"><strong>ç»Ÿä¸€ä¸åŒçš„ç¼“å­˜æŠ€æœ¯</strong></font>ã€‚</font></p>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><font color=\"red\" size=\"4\"><strong>CacheManager</strong></font>æ˜¯Springæä¾›çš„å„ç§<font color=\"red\" size=\"4\"><strong>ç¼“å­˜æŠ€æœ¯æŠ½è±¡æ¥å£</strong></font>ã€‚</font></p>\n<h4><a id=\"x1F6AC_CacheManager_361\"></a>ğŸš¬ é’ˆå¯¹ä¸åŒçš„ç¼“å­˜æŠ€æœ¯éœ€è¦å®ç°ä¸åŒçš„CacheManagerï¼š</h4>\n<p><img alt=\"[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-4BeR140u-1662446011901)(%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96.assets/image-20220905213003600.png)]\" src=\"image\\65a8aae351034608a7cc120ba3ff7fb7.png\"/></p>\n<h4><a id=\"x1F6AC_Spring_Cache__366\"></a>ğŸš¬ Spring Cache å¸¸ç”¨æ³¨è§£</h4>\n<p><img alt=\"[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-7G7CXVv8-1662446011902)(%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96.assets/image-20220905213049570.png)]\" src=\"image\\27abe3bbfa864fe2be46060fb128b04a.png\"/></p>\n<p>â€‚â€‚â€‚â€‚<font color=\"#f47920\" size=\"4\"><strong>åœ¨spring booté¡¹ç›®ä¸­ï¼Œä½¿ç”¨ç¼“å­˜æŠ€æœ¯åªéœ€åœ¨é¡¹ç›®ä¸­å¯¼å…¥ç›¸å…³ç¼“å­˜æŠ€æœ¯çš„ä¾èµ–åŒ…ï¼Œå¹¶åœ¨<font color=\"red\" size=\"4\">å¯åŠ¨ç±»ä¸Šä½¿ç”¨@EnableCachingå¼€å¯ç¼“å­˜ </font>æ”¯æŒå³å¯ã€‚</strong></font><br/> â€‚â€‚â€‚â€‚<br/> <font color=\"red\" size=\"4\"><strong>ä¾‹å¦‚ï¼š</strong></font>ä½¿ç”¨Redisä½œä¸ºç¼“å­˜æŠ€æœ¯ï¼Œåªéœ€è¦å¯¼å…¥<strong>Spring data Redis</strong>çš„<strong>maven</strong>åæ ‡å³å¯ã€‚</p>\n<h4><a id=\"x1F6AC_Spring_Cache__375\"></a>ğŸš¬ Spring Cache ä½¿ç”¨æ–¹å¼</h4>\n<p><img alt=\"[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-78iy0588-1662446011902)(%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96.assets/image-20220905213238973.png)]\" src=\"image\\add6750b1822410298ccb9cb4935cead.png\"/></p>\n<h5><a id=\"_1maven_380\"></a>ğŸš­ 1ã€å¯¼å…¥mavenåæ ‡</h5>\n<pre><code class=\"prism language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-boot-starter-cache<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<h5><a id=\"_2applicationyml_394\"></a>ğŸš­ 2ã€é…ç½®application.yml</h5>\n<pre><code class=\"prism language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">time-to-live</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1800000</span> <span class=\"token comment\">#è®¾ç½®ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´</span>\n</code></pre>\n<h5><a id=\"_3EnableCaching_403\"></a>ğŸš­ 3ã€åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</h5>\n<pre><code class=\"prism language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token annotation punctuation\">@ServletComponentScan</span>\n<span class=\"token annotation punctuation\">@EnableTransactionManagement</span>\n<span class=\"token annotation punctuation\">@EnableCaching</span> <span class=\"token comment\">//å¼€å¯Spring Cacheæ³¨è§£æ–¹å¼æ˜¯ç¼“å­˜åŠŸèƒ½</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ReggieApplication</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ReggieApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"é¡¹ç›®å¯åŠ¨æˆåŠŸ...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h5><a id=\"_4ControllerCacheableCacheEvict_419\"></a>ğŸš­ 4ã€åœ¨Controllerçš„æ–¹æ³•ä¸ŠåŠ å…¥@Cacheableã€@CacheEvictç­‰æ³¨è§£ï¼Œè¿›è¡Œç¼“å­˜æ“ä½œ</h5>\n<pre><code class=\"prism language-java\"><span class=\"token comment\">/**\n * å¥—é¤ç®¡ç†\n */</span>\n\n<span class=\"token annotation punctuation\">@RestController</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/setmeal\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SetmealController</span> <span class=\"token punctuation\">{<!-- --></span>\n\n\n    <span class=\"token comment\">/**\n     * æ–°å¢å¥—é¤\n     * @param setmealDto\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@PostMapping</span>\n    <span class=\"token annotation punctuation\">@CacheEvict</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"setmealCache\"</span><span class=\"token punctuation\">,</span>allEntries <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">SetmealDto</span> setmealDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¥—é¤ä¿¡æ¯ï¼š{}\"</span><span class=\"token punctuation\">,</span>setmealDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        setmealService<span class=\"token punctuation\">.</span><span class=\"token function\">saveWithDish</span><span class=\"token punctuation\">(</span>setmealDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–°å¢å¥—é¤æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * åˆ é™¤å¥—é¤\n     * @param ids\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@DeleteMapping</span>\n    <span class=\"token annotation punctuation\">@CacheEvict</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"setmealCache\"</span><span class=\"token punctuation\">,</span>allEntries <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">&gt;</span></span> ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ids:{}\"</span><span class=\"token punctuation\">,</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        setmealService<span class=\"token punctuation\">.</span><span class=\"token function\">removeWithDish</span><span class=\"token punctuation\">(</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¥—é¤æ•°æ®åˆ é™¤æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h4><a id=\"x1F6AC_Spring_Cache__465\"></a>ğŸš¬ Spring Cache ä¸Šä¸‹æ–‡æ•°æ®</h4>\n<p><img alt=\"[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-c1hQg8zM-1662446011903)(%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96.assets/image-20220905213301988.png)]\" src=\"image\\828d813556154652a891d477618d5c45.png\"/></p>\n<h3><a id=\"x1F697_5_Spring_Cache__468\"></a>ğŸš— 5ã€ç¼“å­˜å¥—é¤æ•°æ® ä½¿ç”¨Spring Cache æ³¨è§£å®ç°</h3>\n<blockquote>\n<p>â€‚â€‚â€‚â€‚å‰é¢æˆ‘ä»¬å·²ç»å®ç°äº†ç§»åŠ¨ç«¯å¥—é¤æŸ¥çœ‹åŠŸèƒ½ï¼Œå¯¹åº”çš„æœåŠ¡ç«¯æ–¹æ³•ä¸ºSetmealControllerçš„listæ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šæ ¹æ®å‰ç«¯æäº¤çš„æŸ¥è¯¢æ¡ä»¶è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æ“ä½œã€‚åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œé¢‘ç¹æŸ¥è¯¢æ•°æ®åº“ä¼šå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼ŒæœåŠ¡ç«¯å“åº”æ—¶é—´å¢é•¿ã€‚ç°åœ¨éœ€è¦å¯¹æ­¤æ–¹æ³•è¿›è¡Œç¼“å­˜ä¼˜åŒ–ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>\n</blockquote>\n<p><font color=\"#f47920\" size=\"4\"><strong>å…·ä½“çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼š</strong><br/> </font></p>\n<ul><li><strong>1ã€å¯¼å…¥Spring Cacheå’ŒRedisç›¸å…³mavenåæ ‡</strong></li><li><strong>2ã€åœ¨application.ymlä¸­é…ç½®ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´</strong></li><li><strong>3ã€åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</strong></li><li><strong>4ã€åœ¨SetmealControllerçš„listæ–¹æ³•ä¸ŠåŠ å…¥@Cacheableæ³¨è§£</strong></li><li><strong>5ã€åœ¨SetmealControllerçš„saveå’Œdeleteæ–¹æ³•ä¸ŠåŠ å…¥CacheEvictæ³¨è§£</strong></li></ul>\n<h4><a id=\"x1F6AC__481\"></a>ğŸš¬ ä»£ç å®ç°</h4>\n<blockquote>\n<p><font color=\"#f47920\" size=\"4\"><strong>@CachePut(value = â€œuserCacheâ€,key = â€œ#user.idâ€)</strong><br/> </font></p>\n<ul><li><strong>CachePutï¼šå°†æ–¹æ³•è¿”å›å€¼æ”¾å…¥ç¼“å­˜</strong></li><li><strong>valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</strong></li><li><strong>keyï¼šç¼“å­˜çš„key</strong></li></ul>\n<p><font color=\"#f47920\" size=\"4\"><strong>@CacheEvict(value = â€œuserCacheâ€,key = â€œ#p0â€)</strong><br/> </font><br/> <font color=\"#f47920\" size=\"4\"><strong>@CacheEvict(value = â€œuserCacheâ€,key = â€œ#root.args[0]â€)</strong><br/> </font><br/> <font color=\"#f47920\" size=\"4\"><strong>@CacheEvict(value = â€œuserCacheâ€,key = â€œ#idâ€)</strong><br/> </font></p>\n<ul><li><strong>CacheEvictï¼šæ¸…ç†æŒ‡å®šç¼“å­˜</strong></li><li><strong>valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</strong></li><li><strong>keyï¼šç¼“å­˜çš„key</strong></li><li><strong>allEntries = true åˆ é™¤è¿™ä¸ªåˆ†ç±»ä¸‹çš„æ‰€æœ‰æ•°æ®</strong></li></ul>\n<p><font color=\"#f47920\" size=\"4\"><strong>@Cacheable(value = â€œuserCacheâ€,key = â€œ#idâ€,unless = â€œ#result == nullâ€)</strong><br/> </font></p>\n<ul><li><strong>Cacheableï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰springå…ˆæŸ¥çœ‹ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ï¼›è‹¥æ²¡æœ‰æ•°æ®ï¼Œè°ƒç”¨æ–¹æ³•å¹¶å°†æ–¹æ³•è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­</strong></li><li><strong>valueï¼šç¼“å­˜çš„åç§°ï¼Œæ¯ä¸ªç¼“å­˜åç§°ä¸‹é¢å¯ä»¥æœ‰å¤šä¸ªkey</strong></li><li><strong>keyï¼šç¼“å­˜çš„key</strong></li><li><strong>conditionï¼šæ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶æ—¶æ‰ç¼“å­˜æ•°æ®</strong></li><li><strong>unlessï¼šæ»¡è¶³æ¡ä»¶åˆ™ä¸ç¼“å­˜</strong></li></ul>\n</blockquote>\n<h5><a id=\"_1maven_511\"></a>ğŸš­ 1ã€å¯¼å…¥mavenåæ ‡</h5>\n<pre><code class=\"prism language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-boot-starter-data-redis<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-boot-starter-cache<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<h5><a id=\"_2applicationyml_525\"></a>ğŸš­ 2ã€é…ç½®application.yml</h5>\n<pre><code class=\"prism language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">time-to-live</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1800000</span> <span class=\"token comment\">#è®¾ç½®ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´ 30åˆ†é’Ÿ æ¯«ç§’</span>\n</code></pre>\n<h5><a id=\"_3EnableCaching_534\"></a>ğŸš­ 3ã€åœ¨å¯åŠ¨ç±»ä¸ŠåŠ å…¥@EnableCachingæ³¨è§£ï¼Œå¼€å¯ç¼“å­˜æ³¨è§£åŠŸèƒ½</h5>\n<pre><code class=\"prism language-java\"><span class=\"token annotation punctuation\">@Slf4j</span>\n<span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token annotation punctuation\">@ServletComponentScan</span>\n<span class=\"token annotation punctuation\">@EnableTransactionManagement</span>\n<span class=\"token annotation punctuation\">@EnableCaching</span> <span class=\"token comment\">//å¼€å¯Spring Cacheæ³¨è§£æ–¹å¼æ˜¯ç¼“å­˜åŠŸèƒ½</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ReggieApplication</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ReggieApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"é¡¹ç›®å¯åŠ¨æˆåŠŸ...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h5><a id=\"_4SetmealControllerlistCacheable_550\"></a>ğŸš­ 4ã€åœ¨SetmealControllerçš„listæ–¹æ³•ä¸ŠåŠ å…¥@Cacheableæ³¨è§£ï¼š</h5>\n<pre><code class=\"prism language-java\">    <span class=\"token comment\">/**\n     * æ ¹æ®æ¡ä»¶æŸ¥è¯¢å¥—é¤æ•°æ®\n     * @param setmeal\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/list\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Cacheable</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"setmealCache\"</span><span class=\"token punctuation\">,</span>key <span class=\"token operator\">=</span> <span class=\"token string\">\"#setmeal.categoryId + '_' + #setmeal.status\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Setmeal</span><span class=\"token punctuation\">&gt;</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Setmeal</span> setmeal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Setmeal</span><span class=\"token punctuation\">&gt;</span></span> queryWrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        queryWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span>setmeal<span class=\"token punctuation\">.</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Setmeal</span><span class=\"token operator\">::</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">,</span>setmeal<span class=\"token punctuation\">.</span><span class=\"token function\">getCategoryId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        queryWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span>setmeal<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">Setmeal</span><span class=\"token operator\">::</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">,</span>setmeal<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        queryWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">orderByDesc</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Setmeal</span><span class=\"token operator\">::</span><span class=\"token function\">getUpdateTime</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Setmeal</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> setmealService<span class=\"token punctuation\">.</span><span class=\"token function\">list</span><span class=\"token punctuation\">(</span>queryWrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre>\n<h5><a id=\"_5SetmealControllersavedeleteCacheEvict_572\"></a>ğŸš­ 5ã€åœ¨SetmealControllerçš„saveå’Œdeleteæ–¹æ³•ä¸ŠåŠ å…¥@CacheEvictæ³¨è§£</h5>\n<pre><code class=\"prism language-java\"><span class=\"token comment\">/**\n * æ–°å¢å¥—é¤\n * @param setmealDto\n * @return\n */</span>\n<span class=\"token annotation punctuation\">@PostMapping</span>\n<span class=\"token annotation punctuation\">@CacheEvict</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"setmealCache\"</span><span class=\"token punctuation\">,</span>allEntries <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestBody</span> <span class=\"token class-name\">SetmealDto</span> setmealDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¥—é¤ä¿¡æ¯ï¼š{}\"</span><span class=\"token punctuation\">,</span>setmealDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    setmealService<span class=\"token punctuation\">.</span><span class=\"token function\">saveWithDish</span><span class=\"token punctuation\">(</span>setmealDto<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ–°å¢å¥—é¤æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * åˆ é™¤å¥—é¤\n * @param ids\n * @return\n */</span>\n<span class=\"token annotation punctuation\">@DeleteMapping</span>\n<span class=\"token annotation punctuation\">@CacheEvict</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"setmealCache\"</span><span class=\"token punctuation\">,</span>allEntries <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">&gt;</span></span> ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n    log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ids:{}\"</span><span class=\"token punctuation\">,</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    setmealService<span class=\"token punctuation\">.</span><span class=\"token function\">removeWithDish</span><span class=\"token punctuation\">(</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"å¥—é¤æ•°æ®åˆ é™¤æˆåŠŸ\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h5><a id=\"_6R_606\"></a>ğŸš­ 6ã€è¿”å›ç»“æœç±»Réœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ï¼š</h5>\n<blockquote>\n<p>DefaultSerializer requires a Serializable payload but received an object of type [com.itheima.reggie.common.R]<br/> â€‚<br/> ç»“æœéœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ implements Serializable</p>\n</blockquote>\n<pre><code class=\"prism language-java\"><span class=\"token comment\">/**\n * é€šç”¨è¿”å›ç»“æœï¼ŒæœåŠ¡ç«¯å“åº”çš„æ•°æ®æœ€ç»ˆéƒ½ä¼šå°è£…æˆæ­¤å¯¹è±¡\n * @param &lt;T&gt;\n */</span>\n<span class=\"token annotation punctuation\">@Data</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">R</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Serializable</span><span class=\"token punctuation\">{<!-- --></span>\n\n\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"image\\40ddad37b44d4c0d82fdb0d8327dca26.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}