{"blogid": "125644970", "writerAge": "码龄4年", "writerBlogNum": "10", "writerCollect": "39", "writerComment": "10", "writerFan": "335", "writerGrade": "2级", "writerIntegral": "267", "writerName": "Docda", "writerProfileAdress": "writer_image\\profile_125644970.jpg", "writerRankTotal": "63504", "writerRankWeekly": "214352", "writerThumb": "10", "writerVisitNum": "17191", "blog_read_count": "1824", "blog_time": "已于 2022-07-13 17:52:54 修改", "blog_title": "undetected_chromedriver的使用", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"style.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>undetected_chromedriver是专门针对浏览器识别做出来的拓展</p>\n<p>直接使用undetected_chromedriver第三方库</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n\n\t<span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver\n\t<span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>by <span class=\"token keyword\">import</span> By\n\t<span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>ui <span class=\"token keyword\">import</span> WebDriverWait\n\t<span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support <span class=\"token keyword\">import</span> expected_conditions\n\t<span class=\"token keyword\">import</span> undetected_chromedriver<span class=\"token punctuation\">.</span>v2 <span class=\"token keyword\">as</span> uc\n\t\n\tchrome_options <span class=\"token operator\">=</span> uc<span class=\"token punctuation\">.</span>ChromeOptions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-extensions\"</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-popup-blocking\"</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--profile-directory=Default\"</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--ignore-certificate-errors\"</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-plugins-discovery\"</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--incognito\"</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--no-first-run'</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--no-service-autorun'</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--no-default-browser-check'</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--password-store=basic'</span><span class=\"token punctuation\">)</span>\n\tchrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--no-sandbox'</span><span class=\"token punctuation\">)</span>\n\t\n\tdriver <span class=\"token operator\">=</span> uc<span class=\"token punctuation\">.</span>Chrome<span class=\"token punctuation\">(</span>options<span class=\"token operator\">=</span>chrome_options<span class=\"token punctuation\">,</span> executable_path<span class=\"token operator\">=</span><span class=\"token string\">'./driver/chromedriver'</span><span class=\"token punctuation\">)</span>\n\t\n\tdriver<span class=\"token punctuation\">.</span>delete_all_cookies<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tdriver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"https://accounts.google.com/signin/v2/identifier?service=accountsettings&amp;continue=https%3A%2F%2Fmyaccount.google.com%3Futm_source%3Daccount-marketing-page%26utm_medium%3Dgo-to-account-button&amp;flowName=GlifWebSignIn&amp;flowEntry=ServiceLogin\"</span><span class=\"token punctuation\">)</span>\n\t\n\tdriver<span class=\"token punctuation\">.</span>find_element_by_xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'//input[@type=\"email\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span>email<span class=\"token punctuation\">)</span>\n\t<span class=\"token builtin\">input</span> <span class=\"token operator\">=</span> WebDriverWait<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>until<span class=\"token punctuation\">(</span>expected_conditions<span class=\"token punctuation\">.</span>element_to_be_clickable<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span>XPATH<span class=\"token punctuation\">,</span> <span class=\"token string\">'//*[@id=\"identifierNext\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token builtin\">input</span><span class=\"token punctuation\">.</span>click<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\n\tWebDriverWait<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>until<span class=\"token punctuation\">(</span>expected_conditions<span class=\"token punctuation\">.</span>element_to_be_clickable<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span>XPATH<span class=\"token punctuation\">,</span> <span class=\"token string\">'//*[@id=\"password\"]/div[1]/div/div[1]/input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\tdriver<span class=\"token punctuation\">.</span>find_element_by_xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'//*[@id=\"password\"]/div[1]/div/div[1]/input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span>\n\t\n\t<span class=\"token builtin\">input</span> <span class=\"token operator\">=</span> WebDriverWait<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>until<span class=\"token punctuation\">(</span>expected_conditions<span class=\"token punctuation\">.</span>element_to_be_clickable<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span>XPATH<span class=\"token punctuation\">,</span> <span class=\"token string\">'//*[@id=\"passwordNext\"]/div/button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token builtin\">input</span><span class=\"token punctuation\">.</span>click<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ttime<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n\t\n\tcookies <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>get_cookies<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tcookies_arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> cookies<span class=\"token punctuation\">:</span>\n\t    <span class=\"token keyword\">if</span> c<span class=\"token punctuation\">[</span><span class=\"token string\">'domain'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>endswith<span class=\"token punctuation\">(</span><span class=\"token string\">'.google.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t        cookies_arr<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>c<span class=\"token punctuation\">[</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">=</span><span class=\"token interpolation\"><span class=\"token punctuation\">{<!-- --></span>c<span class=\"token punctuation\">[</span><span class=\"token string\">\"value\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n\t\n\tdriver<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"; \"</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>cookies_arr<span class=\"token punctuation\">)</span>\n</code></pre>\n<p>使用seleniumwire的undetected_chromedriver拓展，好处是可以直接获取到浏览器的请求记录</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">from</span> seleniumwire<span class=\"token punctuation\">.</span>undetected_chromedriver<span class=\"token punctuation\">.</span>v2 <span class=\"token keyword\">import</span> Chrome<span class=\"token punctuation\">,</span> ChromeOptions\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token punctuation\">}</span>\n    chrome_options <span class=\"token operator\">=</span> ChromeOptions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-gpu\"</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--incognito\"</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-dev-shm-usage\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># chrome_options.add_argument(\"--headless\")</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"--proxy-server=http://192.168.100.24:60021\"</span></span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-popup-blocking\"</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--profile-directory=Default\"</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--ignore-certificate-errors\"</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-plugins-discovery\"</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--no-first-run'</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--no-service-autorun'</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--no-default-browser-check'</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--password-store=basic'</span><span class=\"token punctuation\">)</span>\n    chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--no-sandbox'</span><span class=\"token punctuation\">)</span>\n    browser <span class=\"token operator\">=</span> Chrome<span class=\"token punctuation\">(</span>seleniumwire_options<span class=\"token operator\">=</span>options<span class=\"token punctuation\">,</span> options<span class=\"token operator\">=</span>chrome_options<span class=\"token punctuation\">,</span>executable_path<span class=\"token operator\">=</span><span class=\"token string\">'C:\\Program Files\\Google\\Chrome\\Application\\chromedriver.exe'</span><span class=\"token punctuation\">,</span>version_main<span class=\"token operator\">=</span><span class=\"token number\">101</span><span class=\"token punctuation\">)</span>\n\n    browser<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'https://portal.thecourierguy.co.za/track?ref=TCG107468416T'</span><span class=\"token punctuation\">)</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>browser<span class=\"token punctuation\">.</span>page_source<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> request <span class=\"token keyword\">in</span> browser<span class=\"token punctuation\">.</span>requests<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> request<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token string\">'shipments'</span> <span class=\"token keyword\">in</span> request<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">:</span>\n            \t<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">#获取内容为乱码可尝试用以下方法解码</span>\n            <span class=\"token comment\">#gzip.decompress(request.response.body).decode(\"utf-8\")</span>\n\n</code></pre>\n<p>其中version_main可以根据浏览器版本指定版本号<br/> <strong>注意：</strong><br/>       使用seleniumwire.undetected_chromedriver有一个大坑<br/>       输入executable_path不会生效，因为在webdriver的源码是单独引用的undetected_chromedriver<img alt=\"在这里插入图片描述\" src=\"image\\b8e2ee1b0eb0411d8eb5080e23f1a1ff.png\"/><br/> 所以不会接收到传入的executable_path。<br/> 而在undetected_chromedriver源码中，如果没有传入path就会每次启动去官网重新下载一个新的驱动器，再编译成可执行的文存放在以下目录<img alt=\"在这里插入图片描述\" src=\"image\\1a839692801a4fb98489e9c5492d09d0.png\"/><br/> <strong>解决办法：</strong><br/>       在webdriver的源码中指定executable_path<img alt=\"在这里插入图片描述\" src=\"image\\fa2b794afb624d26a007cea0d95ab370.png\"/><br/> 这个带有前缀id的chromedriver是有执行权限的可执行程序啦<br/> （直接使用官网下载的可能会没有权限，可以先直接运行一次，去到对应目录下面找到一个就可以永久使用啦&lt;其他的可以删除&gt;）</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>"}