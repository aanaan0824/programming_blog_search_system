<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-tomorrow-night" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>文章目录</h3>
<ul><li><a href="#1_Ajax_1">1. Ajax概述</a></li><li><ul><li><a href="#11_AJAX__2">1.1 AJAX 简介</a></li><li><a href="#12_XML__7">1.2 XML 简介</a></li><li><a href="#13_AJAX__31">1.3 AJAX 的特点</a></li><li><ul><li><a href="#131_AJAX__32">1.3.1 AJAX 的优点</a></li><li><a href="#132_AJAX__35">1.3.2 AJAX 的缺点</a></li></ul>
</li></ul>
</li><li><a href="#2_HTTP_41">2. HTTP相关问题</a></li><li><ul><li><a href="#21_MDN__42">2.1 MDN 文档</a></li><li><a href="#22_HTTP__44">2.2 HTTP 请求交互的基本过程</a></li><li><a href="#23_HTTP__51">2.3 HTTP 请求报文</a></li><li><ul><li><a href="#1__52">1. 请求行</a></li><li><a href="#2__56">2. 多个请求头</a></li><li><a href="#3__60">3. 请求体</a></li></ul>
</li><li><a href="#24_HTTP__64">2.4 HTTP 响应报文</a></li><li><a href="#25_post__72">2.5 post 请求体参数格式</a></li><li><a href="#26__83">2.6 常见的响应状态码</a></li><li><a href="#27__91">2.7 不同类型的请求及其作用</a></li><li><a href="#28_API__98">2.8 API 的分类</a></li><li><a href="#29__http__ajax_109">2.9 区别 一般http请求 与 ajax请求</a></li></ul>
</li><li><a href="#3_AJAX__XHR_118">3. 原生AJAX 的基本使用 XHR</a></li><li><ul><li><a href="#30__119">3.0 准备工作</a></li><li><ul><li><a href="#301_nodejs_120">3.0.1 安装node.js</a></li><li><a href="#302_express_122">3.0.2 安装express（服务端框架）</a></li><li><a href="#303_nodemon_168">3.0.3 安装nodemon自动重启工具</a></li></ul>
</li><li><a href="#31__180">3.1 理解</a></li><li><a href="#32__187">3.2 核心对象使用步骤</a></li><li><ul><li><a href="#321_XMLHttpRequest__188">3.2.1 创建XMLHttpRequest 对象</a></li><li><a href="#322_url_194">3.2.2 设置请求信息（请求方法和url）</a></li><li><a href="#323__202">3.2.3 发送请求</a></li><li><a href="#324__208">3.2.4 接收响应（事件绑定，处理服务端返回的结果）</a></li></ul>
</li><li><a href="#33__221">3.3 使用案例</a></li><li><ul><li><a href="#331_GET__223">3.3.1 GET 请求</a></li><li><ul><li><a href="#_GET__313"># GET 请求设置请求参数</a></li></ul>
</li><li><a href="#332_POST_321">3.3.2 POST请求</a></li><li><ul><li><a href="#__382"># 设置请求头信息</a></li></ul>
</li></ul>
</li><li><a href="#34_json_395">3.4 json数据请求</a></li><li><a href="#35__462">3.5 请求超时与网络异常</a></li><li><a href="#36__477">3.6 取消请求</a></li><li><a href="#37__483">3.7 请求重复发送问题</a></li><li><a href="#38__IE__487">3.8 解决 IE 缓存问题</a></li><li><a href="#39_AJAX__495">3.9 AJAX 请求状态</a></li><li><a href="#310_API_505">3.10 API总结</a></li></ul>
</li><li><a href="#4_jQuery_AJAX_524">4. jQuery 中的AJAX</a></li><li><ul><li><a href="#41_get__525">4.1 get 请求</a></li><li><a href="#42_post__534">4.2 post 请求</a></li><li><a href="#43__545">4.3 通用方法</a></li></ul>
</li><li><a href="#5__574">5. 跨域</a></li><li><ul><li><a href="#51__575">5.1 同源策略</a></li><li><a href="#52__581">5.2 如何解决跨域</a></li><li><ul><li><a href="#521_JSONP_582">5.2.1 JSONP</a></li><li><ul><li><a href="#1_JSONP__583">1) JSONP 是什么</a></li><li><a href="#2_JSONP__586">2) JSONP 怎么工作的？</a></li><li><a href="#3_JSONP__590">3) JSONP 的使用</a></li><li><ul><li><a href="#1script__592">1.动态的创建一个script 标签</a></li><li><a href="#2script_src_598">2.设置script 的src，设置回调函数</a></li><li><a href="#3script_body__607">3.将script 添加到body 中</a></li><li><a href="#4_613">4.服务器中路由的处理</a></li></ul>
</li><li><a href="#4_jQuery_JSONP_627">4) jQuery 中的JSONP</a></li></ul>
</li><li><a href="#522_CORS_663">5.2.2 CORS</a></li><li><ul><li><a href="#1_CORS__666">1) CORS 是什么？</a></li><li><a href="#2_CORS__671">2) CORS 怎么工作的？</a></li><li><a href="#3_CORS__674">3) CORS 的使用</a></li></ul>
</li></ul>
</li></ul>
</li></ul>
</div>
<p></p>
<h1><a id="1_Ajax_1"></a>1. Ajax概述</h1>
<h2><a id="11_AJAX__2"></a>1.1 AJAX 简介</h2>
<p>AJAX 全称为Asynchronous JavaScript And XML，就是异步的JS 和XML<br/> 通过AJAX 可以在浏览器中向服务器发送异步请求，最大的优势：<strong>无刷新获取数据</strong><br/> AJAX 不是新的编程语言，而是一种将现有的标准组合在一起使用的新方式</p>
<h2><a id="12_XML__7"></a>1.2 XML 简介</h2>
<p>XML 可扩展标记语言。<br/> XML 被设计用来传输和存储数据。<br/> XML 和HTML 类似，不同的是HTML 中都是预定义标签，而XML 中没有预定义标签，<br/> 全都是自定义标签，用来表示一些数据。</p>
<p>比如说我有一个学生数据：<br/> name = “孙悟空” ; age = 18 ; gender = “男” ;<br/> 用XML 表示：</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>student</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>孙悟空<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>age</span><span class="token punctuation">&gt;</span></span>18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>age</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>gender</span><span class="token punctuation">&gt;</span></span>男<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>gender</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>student</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>现在已经被JSON 取代了。</p>
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"孙悟空"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">"gender"</span><span class="token punctuation">:</span><span class="token string">"男"</span><span class="token punctuation">}</span>
</code></pre>
<h2><a id="13_AJAX__31"></a>1.3 AJAX 的特点</h2>
<h3><a id="131_AJAX__32"></a>1.3.1 AJAX 的优点</h3>
<ol><li>可以无需刷新页面而与服务器端进行通信</li><li>允许你根据用户事件来更新部分页面内容</li></ol>
<h3><a id="132_AJAX__35"></a>1.3.2 AJAX 的缺点</h3>
<ol><li>没有浏览历史，不能回退</li><li>存在跨域问题(同源)</li><li>SEO 不友好</li></ol>
<h1><a id="2_HTTP_41"></a>2. HTTP相关问题</h1>
<h2><a id="21_MDN__42"></a>2.1 MDN 文档</h2>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Overview</a></p>
<h2><a id="22_HTTP__44"></a>2.2 HTTP 请求交互的基本过程</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210302161144256.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70"/></p>
<ol><li>前后应用从浏览器端向服务器发送HTTP 请求(请求报文)</li><li>后台服务器接收到请求后, 调度服务器应用处理请求, 向浏览器端返回HTTP响应(响应报文)</li><li>浏览器端接收到响应, 解析显示响应体/调用监视回调</li></ol>
<h2><a id="23_HTTP__51"></a>2.3 HTTP 请求报文</h2>
<h3><a id="1__52"></a>1. 请求行</h3>
<p><code>method url</code><br/> <code>GET /product_detail?id=2</code><br/> <code>POST /login</code></p>
<h3><a id="2__56"></a>2. 多个请求头</h3>
<p><code>Host: www.baidu.com</code><br/> <code>Cookie: BAIDUID=AD3B0FA706E; BIDUPSID=AD3B0FA706;</code><br/> <code>Content-Type: application/x-www-form-urlencoded 或者application/json</code></p>
<h3><a id="3__60"></a>3. 请求体</h3>
<p><code>username=tom&amp;pwd=123</code><br/> <code>{"username": "tom", "pwd": 123}</code></p>
<h2><a id="24_HTTP__64"></a>2.4 HTTP 响应报文</h2>
<ol><li>响应状态行: <code>status statusText</code></li><li>多个响应头<br/> <code>Content-Type: text/html;charset=utf-8</code><br/> <code>Set-Cookie: BD_CK_SAM=1;path=/</code></li><li>响应体<br/> <code>html 文本/json 文本/js/css/图片...</code></li></ol>
<h2><a id="25_post__72"></a>2.5 post 请求体参数格式</h2>
<ol><li><code>Content-Type: application/x-www-form-urlencoded;charset=utf-8</code><br/> 用于键值对参数，参数的键值用=连接, 参数之间用&amp;连接<br/> 例如: <code>name=%E5%B0%8F%E6%98%8E&amp;age=12</code></li><li><code>Content-Type: application/json;charset=utf-8</code><br/> 用于 json 字符串参数<br/> 例如: <code>{"name": "%E5%B0%8F%E6%98%8E", "age": 12}</code></li><li><code>Content-Type: multipart/form-data</code><br/> 用于文件上传请求</li></ol>
<h2><a id="26__83"></a>2.6 常见的响应状态码</h2>
<p><code>200 OK</code> 请求成功。一般用于GET 与POST 请求<br/> <code>201 Created</code> 已创建。成功请求并创建了新的资源<br/> <code>401 Unauthorized</code> 未授权/请求要求用户的身份认证<br/> <code>404 Not Found</code> 服务器无法根据客户端的请求找到资源<br/> <code>500 Internal Server Error</code> 服务器内部错误，无法完成请求</p>
<h2><a id="27__91"></a>2.7 不同类型的请求及其作用</h2>
<ol><li><code>GET</code>: 从服务器端<strong>读取</strong>数据（查）</li><li><code>POST</code>: 向服务器端<strong>添加</strong>新数据 （增）</li><li><code>PUT</code>: <strong>更新</strong>服务器端已经数据 （改）</li><li><code>DELETE</code>: <strong>删除</strong>服务器端数据 （删）</li></ol>
<h2><a id="28_API__98"></a>2.8 API 的分类</h2>
<ol><li>REST API: restful （Representational State Transfer (资源)表现层状态转化）<br/> (1) 发送请求进行CRUD 哪个操作由请求方式来决定<br/> (2) 同一个请求路径可以进行多个操作<br/> (3) 请求方式会用到GET/POST/PUT/DELETE</li><li>非REST API: restless<br/> (1) 请求方式不决定请求的CRUD 操作<br/> (2) 一个请求路径只对应一个操作<br/> (3) 一般只有GET/POST</li></ol>
<h2><a id="29__http__ajax_109"></a>2.9 区别 一般http请求 与 ajax请求</h2>
<ol><li>ajax请求 是一种特别的 http请求</li><li>对服务器端来说, 没有任何区别, 区别在<strong>浏览器端</strong></li><li>浏览器端发请求: 只有<code>XHR</code> 或<code>fetch</code> 发出的才是ajax 请求, 其它所有的都是非ajax 请求</li><li>浏览器端接收到响应<br/> (1) 一般请求: 浏览器一般会直接显示响应体数据, 也就是我们常说的刷新/跳转页面<br/> (2) ajax请求: 浏览器不会对界面进行任何更新操作, 只是<strong>调用监视的回调函数</strong>并<strong>传入响应相关数据</strong></li></ol>
<h1><a id="3_AJAX__XHR_118"></a>3. 原生AJAX 的基本使用 XHR</h1>
<h2><a id="30__119"></a>3.0 准备工作</h2>
<h3><a id="301_nodejs_120"></a>3.0.1 安装node.js</h3>
<p><a href="http://nodejs.cn/">http://nodejs.cn/</a></p>
<h3><a id="302_express_122"></a>3.0.2 安装express（服务端框架）</h3>
<p><a href="https://www.expressjs.com.cn/">https://www.expressjs.com.cn/</a><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209164615378.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70"/></p>
<ol><li>初始化环境</li></ol>
<pre><code class="prism language-shell"><span class="token function">npm</span> init --yes
</code></pre>
<ol start="2"><li>下载express包</li></ol>
<pre><code class="prism language-shell"><span class="token function">npm</span> <span class="token function">install</span> express --save
</code></pre>
<ol start="3"><li>编写js代码</li></ol>
<pre><code class="prism language-javascript"><span class="token comment">// 1. 引入express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 创建应用对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 创建路由规则</span>
<span class="token comment">// request 是对请求报文的封装</span>
<span class="token comment">// response 是对响应报文的封装</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">//  设置响应</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello Express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4. 监听端口，启动服务</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"服务已经启动, 8000 端口监听中..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ol start="4"><li>运行js程序</li></ol>
<pre><code class="prism language-shell">node .\01express使用.js
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209165304650.png"/></p>
<ol start="5"><li> <p>打开网页显示页面<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209165339872.png"/></p> </li><li> <p>调试程序可以查看请求和响应<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2021020916541663.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209165526228.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70"/></p> </li></ol>
<h3><a id="303_nodemon_168"></a>3.0.3 安装nodemon自动重启工具</h3>
<p>文件内容有修改自动重新启动服务<br/> <a href="https://www.npmjs.com/package/nodemon">https://www.npmjs.com/package/nodemon</a><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210301205043799.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70"/><br/> 安装</p>
<pre><code class="prism language-powershell">npm install <span class="token operator">-</span>g nodemon
</code></pre>
<p>启动服务</p>
<pre><code class="prism language-powershell">ndoemon server<span class="token punctuation">.</span>js
</code></pre>
<h2><a id="31__180"></a>3.1 理解</h2>
<ol><li>使用<code>XMLHttpRequest</code> (XHR)对象可以与服务器交互, 也就是发送ajax 请求</li><li>前端可以获取到数据，而无需让整个的页面刷新。</li><li>这使得Web 页面可以只更新页面的局部，而不影响用户的操作。</li></ol>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest</a><br/> <code>XMLHttpRequest</code>，AJAX 的所有操作都是通过该对象进行的</p>
<h2><a id="32__187"></a>3.2 核心对象使用步骤</h2>
<h3><a id="321_XMLHttpRequest__188"></a>3.2.1 创建XMLHttpRequest 对象</h3>
<pre><code class="prism language-javascript"><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="322_url_194"></a>3.2.2 设置请求信息（请求方法和url）</h3>
<pre><code class="prism language-javascript"><span class="token comment">// 请求方式</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//可以设置请求头，一般不设置</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="323__202"></a>3.2.3 发送请求</h3>
<pre><code class="prism language-javascript">xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span> <span class="token comment">//get请求不传 body 参数，只有post请求使用</span>
</code></pre>
<h3><a id="324__208"></a>3.2.4 接收响应（事件绑定，处理服务端返回的结果）</h3>
<pre><code class="prism language-javascript"><span class="token comment">//xhr.responseXML 接收 xml格式 的响应数据</span>
<span class="token comment">//xhr.responseText 接收 文本格式 的响应数据</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// readyState 是 xhr对象中的属性, 表示状态 0 1 2 3 4</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">var</span> text <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="33__221"></a>3.3 使用案例</h2>
<h3><a id="331_GET__223"></a>3.3.1 GET 请求</h3>
<p>点击返回响应信息<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209170011230.gif#pic_center"/><br/> 创建两个文件，浏览器端使用的html文件和服务器端使用的js文件<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209165720344.png"/><br/> 服务器端 server.js</p>
<pre><code class="prism language-javascript"><span class="token comment">// 1. 引入express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 创建应用对象</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 创建路由规则</span>
app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/server'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 设置响应头 设置允许跨域</span>
  response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置响应体</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello Ajax"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4. 监听服务</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"服务已经启动, 8000 端口监听中..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>启动服务</p>
<pre><code class="prism language-powershell">node server<span class="token punctuation">.</span>js
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209171737175.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70"/><br/> 前端页面 html</p>
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Ajax GET 请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
    <span class="token selector">#result</span> <span class="token punctuation">{<!-- --></span>
      <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
      <span class="token property">border</span><span class="token punctuation">:</span> solid 1px #90b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>点击发送请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
    <span class="token comment">//获取button元素</span>
    <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//绑定事件</span>
    btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 1. 创建对象 </span>
      <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 2. 初始化 设置请求方法和url</span>
      xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://127.0.0.1:8000/server'</span><span class="token punctuation">)</span>
      <span class="token comment">// 3. 发送</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 4. 事件绑定 处理服务端返回的结果</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// readyState 是 xhr 对象中的属性, 表示状态 0 1 2 3 4</span>
        <span class="token comment">//判断 (服务端返回了所有的结果)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token comment">//判断响应状态码 200  404  403 401 500</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 处理结果 行 头 空行 体</span>
            <span class="token comment">// 响应</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'状态码'</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 状态码</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'状态字符串'</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 状态字符串</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'所有响应头'</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span><span class="token function">getAllResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 所有响应头</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'响应体'</span><span class="token punctuation">,</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 响应体</span>
            
            <span class="token comment">//设置 result 的文本</span>
            result<span class="token punctuation">.</span>innerHTML<span class="token operator">=</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2021020917150363.gif#pic_center"/></p>
<h4><a id="_GET__313"></a># GET 请求设置请求参数</h4>
<p>设置url参数</p>
<pre><code class="prism language-javascript">xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://127.0.0.1:8000/server?a=100&amp;b=200&amp;c=300'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209175142103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210209175221929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70"/></p>
<h3><a id="332_POST_321"></a>3.3.2 POST请求</h3>
<p>鼠标放到div中，发post请求，将响应体放在div中呈现</p>
<p>server.js添加post</p>
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/server'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 设置响应头, 设置允许跨域</span>
  response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置响应体</span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello Ajax POST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
<p>post.html</p>
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Ajax POST 请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
    <span class="token selector">#result</span> <span class="token punctuation">{<!-- --></span>
      <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
      <span class="token property">border</span><span class="token punctuation">:</span> solid 1px #903<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
    <span class="token comment">// 获取元素对象</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 绑定事件</span>
    result<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mouseover"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 1. 创建对象</span>
      <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 2. 初始化 设置类型（请求方式）与url</span>
      xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'http://127.0.0.1:8000/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 3. 发送   设置请求参数（请求体）</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'a=100&amp;b=200&amp;c=300'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 4. 事件绑定</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 判断</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span><span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 处理服务端返回的结果</span>
            result<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210218162905183.gif#pic_center"/></p>
<h4><a id="__382"></a># 设置请求头信息</h4>
<pre><code class="prism language-javascript"><span class="token comment">// 设置请求体内容的类型</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequesHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'application/x-www-from-urlencoded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 自定义头信息</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequesHeader</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'ykyk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>server.js中设置响应头允许自定义请求头 post改成all</p>
<pre><code class="prism language-javascript">response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Header'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="34_json_395"></a>3.4 json数据请求</h2>
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'/json-server'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 设置响应头, 设置允许跨域</span>
  response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 设置响应头, 设置允许自定义头信息</span>
  response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Headers'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 响应一个数据</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    name<span class="token punctuation">:</span> <span class="token string">'atguigu'</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 对 对象 进行 字符串 转换</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token comment">// 设置响应体 </span>
  response<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>JSON<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
    <span class="token selector">#result</span> <span class="token punctuation">{<!-- --></span>
      <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
      <span class="token property">border</span><span class="token punctuation">:</span> solid 1px #89b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
    <span class="token keyword">const</span> result <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 绑定键盘按下事件</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onkeydown</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 发送请求</span>
      <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// *2*.(自动转换) 设置响应体数据的类型(自动转换)</span>
      xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span><span class="token punctuation">;</span>
      <span class="token comment">// 初始化</span>
      xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://127.0.0.1:8000/json-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 发送</span>
      xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 事件绑定</span>
      xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 1. 手动对数据转化 (字符串再转换成json)</span>
            <span class="token comment">// let data = JSON.parse(xhr.response); //转换成json</span>
            <span class="token comment">// result.innerHTML = data.name;</span>
            <span class="token comment">// *2*. (自动转换)自动转换(自动转换)</span>
            result<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">//已经自动变成json</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210218175629329.gif#pic_center"/></p>
<h2><a id="35__462"></a>3.5 请求超时与网络异常</h2>
<pre><code class="prism language-javascript"><span class="token comment">// 超时设置 （2秒）</span>
xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
<span class="token comment">// 超时回调</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'网络超时，请稍后重试'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 网络异常回调</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'网络异常，请稍后重试'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="36__477"></a>3.6 取消请求</h2>
<pre><code class="prism language-javascript"><span class="token comment">// 手动取消</span>
xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2><a id="37__483"></a>3.7 请求重复发送问题</h2>
<h2><a id="38__IE__487"></a>3.8 解决 IE 缓存问题</h2>
<p><strong>问题</strong>：在一些浏览器中(IE),由于缓存机制的存在，ajax 只会发送的第一次请求，剩余多次请求不会在发送给浏览器而是直接加载缓存中的数据。<br/> <strong>解决方式</strong>：浏览器的缓存是根据url 地址来记录的，所以我们只需要修改url 地址即可避免缓存问题</p>
<pre><code class="prism language-javascript">xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">,</span><span class="token string">"/testAJAX?t="</span><span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="39_AJAX__495"></a>3.9 AJAX 请求状态</h2>
<p><code>xhr.readyState</code> 可以用来查看请求当前的状态<br/> https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/readyState<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210218121704846.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDk3MjAwOA==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>0: 表示XMLHttpRequest 实例已经生成，但是open()方法还没有被调用</li><li>1: 表示send()方法还没有被调用，仍然可以使用setRequestHeader()，设定HTTP请求的头信息</li><li>2: 表示send()方法已经执行，并且头信息和状态码已经收到</li><li>3: 表示正在接收服务器传来的body 部分的数据</li><li>4: 表示服务器数据已经完全接收，或者本次接收已经失败了</li></ul>
<h2><a id="310_API_505"></a>3.10 API总结</h2>
<ul><li><code>XMLHttpRequest()</code>：创建 XHR 对象的构造函数</li><li><code>status</code>：响应状态码值，如 200、404</li><li><code>statusText</code>：响应状态文本，如 ’ok‘、‘not found’</li><li><code>readyState</code>：标识请求状态的只读属性 0-1-2-3-4</li><li><code>onreadystatechange</code>：绑定 readyState 改变的监听</li><li><code>responseType</code>：指定响应数据类型，如果是 ‘json’，得到响应后自动解析响应</li><li><code>response</code>：响应体数据，类型取决于 responseType 的指定</li><li><code>timeout</code>：指定请求超时时间，默认为 0 代表没有限制</li><li><code>ontimeout</code>：绑定超时的监听</li><li><code>onerror</code>：绑定请求网络错误的监听</li><li><code>open()</code>：初始化一个请求，参数为：<code>(method, url[, async])</code></li><li><code>send(data)</code>：发送请求</li><li><code>abort()</code>：中断请求 （发出到返回之间）</li><li><code>getResponseHeader(name)</code>：获取指定名称的响应头值</li><li><code>getAllResponseHeaders()</code>：获取所有响应头组成的字符串</li><li><code>setRequestHeader(name, value)</code>：设置请求头</li></ul>
<h1><a id="4_jQuery_AJAX_524"></a>4. jQuery 中的AJAX</h1>
<h2><a id="41_get__525"></a>4.1 get 请求</h2>
<pre><code class="prism language-javascript">$<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>url:请求的URL 地址</li><li>data:请求携带的参数</li><li>callback:载入成功时回调函数</li><li>type:设置返回内容格式，xml, html, script, json, text, _default</li></ul>
<h2><a id="42_post__534"></a>4.2 post 请求</h2>
<pre><code class="prism language-javascript">$<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>url:请求的URL 地址</li><li>data:请求携带的参数</li><li>callback:载入成功时回调函数</li><li>type:设置返回内容格式，xml, html, script, json, text, _default</li></ul>
<h2><a id="43__545"></a>4.3 通用方法</h2>
<pre><code class="prism language-javascript">$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">// url</span>
	url<span class="token punctuation">:</span> <span class="token string">'http://127.0.0.1:8000/jquery-server'</span><span class="token punctuation">,</span>
	<span class="token comment">// 参数</span>
	data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>a<span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 请求类型</span>
	type<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
	<span class="token comment">// 响应体结果</span>
	dataType<span class="token punctuation">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
	<span class="token comment">// 成功的回调</span>
	success<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 超时时间</span>
	timeout<span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
	<span class="token comment">// 失败的回调</span>
	error<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'出错拉~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 头信息</span>
	headers<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
		d<span class="token punctuation">:</span> <span class="token number">400</span>
	<span class="token punctuation">}</span>	
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h1><a id="5__574"></a>5. 跨域</h1>
<h2><a id="51__575"></a>5.1 同源策略</h2>
<ul><li>同源策略(Same-Origin Policy)最早由Netscape 公司提出，是浏览器的一种安全策略</li><li>同源： 协议、域名、端口号必须完全相同</li><li>跨域： 违背同源策略就是<strong>跨域</strong></li></ul>
<h2><a id="52__581"></a>5.2 如何解决跨域</h2>
<h3><a id="521_JSONP_582"></a>5.2.1 JSONP</h3>
<h4><a id="1_JSONP__583"></a>1) JSONP 是什么</h4>
<p>JSONP(JSON with Padding)，是一个非官方的跨域解决方案，纯粹凭借程序员的聪明<br/> 才智开发出来，只支持get 请求。</p>
<h4><a id="2_JSONP__586"></a>2) JSONP 怎么工作的？</h4>
<p>在网页有一些标签天生具有跨域能力，比如：img link iframe script。<br/> JSONP 就是利用script 标签的跨域能力来发送请求的。</p>
<h4><a id="3_JSONP__590"></a>3) JSONP 的使用</h4>
<h5><a id="1script__592"></a>1.动态的创建一个script 标签</h5>
<pre><code class="prism language-javascript"><span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5><a id="2script_src_598"></a>2.设置script 的src，设置回调函数</h5>
<pre><code class="prism language-javascript">script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"http://localhost:3000/testAJAX?callback=abc"</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">abc</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">alert</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h5><a id="3script_body__607"></a>3.将script 添加到body 中</h5>
<pre><code class="prism language-javascript">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5><a id="4_613"></a>4.服务器中路由的处理</h5>
<pre><code class="prism language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/testAJAX"</span> <span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req <span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"收到请求"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> callback <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>callback<span class="token punctuation">;</span>
	<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		name<span class="token punctuation">:</span><span class="token string">"孙悟空"</span><span class="token punctuation">,</span>
		age<span class="token punctuation">:</span><span class="token number">18</span>
	<span class="token punctuation">}</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>callback<span class="token operator">+</span><span class="token string">"("</span><span class="token operator">+</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="4_jQuery_JSONP_627"></a>4) jQuery 中的JSONP</h4>
<pre><code class="prism language-html"><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./jquery-1.12.3.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
			window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>
				btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					$<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">"http://api.douban.com/v2/movie/in_theaters?callback=?"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token comment">//获取所有的电影的条目</span>
						<span class="token keyword">var</span> subjects <span class="token operator">=</span> data<span class="token punctuation">.</span>subjects<span class="token punctuation">;</span>
						<span class="token comment">//遍历电影条目</span>
						<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">;</span> i<span class="token operator">&lt;</span>subjects<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
							<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#list"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;li&gt;"</span><span class="token operator">+</span>
							subjects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token operator">+</span><span class="token string">"&lt;br /&gt;"</span><span class="token operator">+</span>
							<span class="token string">"&lt;img src=\""</span><span class="token operator">+</span>subjects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>images<span class="token punctuation">.</span>large<span class="token operator">+</span><span class="token string">"\" &gt;"</span><span class="token operator">+</span>
							<span class="token string">"&lt;/li&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3><a id="522_CORS_663"></a>5.2.2 CORS</h3>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a></p>
<h4><a id="1_CORS__666"></a>1) CORS 是什么？</h4>
<p>CORS（Cross-Origin Resource Sharing），跨域资源共享。CORS 是官方的跨域解决方<br/> 案，它的特点是不需要在客户端做任何特殊的操作，完全在服务器中进行处理，支持<br/> get 和post 请求。跨域资源共享标准新增了一组HTTP 首部字段，允许服务器声明哪些<br/> 源站通过浏览器有权限访问哪些资源</p>
<h4><a id="2_CORS__671"></a>2) CORS 怎么工作的？</h4>
<p>CORS 是通过设置一个响应头来告诉浏览器，该请求允许跨域，浏览器收到该响应<br/> 以后就会对响应放行。</p>
<h4><a id="3_CORS__674"></a>3) CORS 的使用</h4>
<p>主要是服务器端的设置：</p>
<pre><code class="prism language-javascript">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/testAJAX"</span> <span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req <span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//通过res 来设置响应头，来允许跨域请求</span>
	<span class="token comment">//res.set("Access-Control-Allow-Origin","http://127.0.0.1:3000");</span>
	res<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"testAJAX 返回的响应"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>