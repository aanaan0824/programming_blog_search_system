<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>redis持久化、redis+mysql+nginx+php整合</h3>
<ul><li><a href="#reids_5">reids持久化</a></li><li><a href="#myslqredisnginxphp_13">myslq+redis+nginx+php整合</a></li><li><ul><li><ul><li><a href="#myslqredisnginxphp_32">myslq+redis+nginx+php整合</a></li><li><a href="#redismysql_110">redis与mysql的数据同步</a></li></ul>
</li></ul>
</li></ul>
</div>
<p></p>
<hr/>
<h1><a id="reids_5"></a>reids持久化</h1>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/493cf643ab554b139bdef046b8236303.png#pic_center"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b289c43125914db9a6d1d994d1abdd09.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/fc9aad1b56244f1f868dd113514649b5.png#pic_center"/></p>
<h1><a id="myslqredisnginxphp_13"></a>myslq+redis+nginx+php整合</h1>
<p>因为redis是在内存中工作的，速度快，所以 redis可以放在mysql之前，充当缓存使用。<br/> 应用需要写入数据时，就向mysql写。应用读取数据时，就从redis中读。所以就需要做好mysql与redis的自动同步。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/95333cede1814ac59a465ab29b2f920b.png#pic_center"/></p>
<p>方式一：<br/> 应用直接使用redis，在redis端需要编写代码将最终数据同步到mysql，以实现数据一致性。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/502304d2af6047c0a8366991b7590320.png#pic_center"/></p>
<p>方式二：<br/> 更适合大规模应用。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/658f0199ee03444b8b6dc0900b367388.png#pic_center"/><br/> 下面的实验是使用的用户自定义函数。</p>
<h3><a id="myslqredisnginxphp_32"></a>myslq+redis+nginx+php整合</h3>
<p>server2 ---- 172.20.10.6 ---- redis master （缓冲层）<br/> server3 ---- 172.20.10.8 ---- nginx 、php、gearmand （前端）<br/> server 5 ---- 172.20.10.11 ---- mariadb （后台）</p>
<blockquote>
<p>分布式的分发框架<br/> <strong>client （server5）</strong>： MySQL发生了update事件，触发trigger。触发器会调用用户自定义udf函数json_object（用于转换数据，因为mysql与redis数据不兼容），之后把数据发给gearman（gman_server_set、gman_do_background）<br/> <strong>server （server3）</strong> ：gearmand，监听4730端口<br/> <strong>worker （server3）</strong>： 用户端自己写的代码worker.php，也可以用其他语言编写比如Java(作用就是从gearmand中获取任务，同步redis)。php要求支持两个模块：gearman模块和redis模块。。worker.php首先会通过php-gearman模块获取任务，再通过php-redis模块更新redis server，以完成redis的更新。</p>
</blockquote>
<blockquote>
<p><strong>框架中redis与mysql上数据必须是同步的，怎么样使得mysql上的数据更新之后自动同步到redis？</strong><br/> 使用触发器。<br/> mysql想要将变更数据传给远端，需要：<br/> 1、转换成json的数据结构<br/> 2、发布到分布式的分发系统上面</p>
</blockquote>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/cfa1f5c03c124ec9b59008a88dacae47.png#pic_center"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/afa7a9746e944448bb1abee4f0ddb18f.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/715f8d9b9b1f4856aca08a2c7c155614.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7e7b12c7cbdc42948fb1102764f1f546.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f21daac9d64b48c08172aa12cd1025d9.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5d6eb759e11240d685bef35d2f7c2584.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/cb948c67dbdc4985a86ae29f979b14f6.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/19cfacdaff384ed3aca7c7aa9a7ebae3.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/42772abebb674a8aa2196122fbf0a7d4.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a35ccb8494de413687afe2d812e32983.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/86b23a081073456d92b1fb38972ca341.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a84fc54ed2d14a63958364d11b1fbd03.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7873bdaacda0406ea80b74183bcecada.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ea1799ff520f445f9896f38b3ba396b7.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3dd4e88506dc4f13ad514b90735f6317.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c611928ee1b048d18ef00955274ad49c.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a71da61434f84a3cbfb208402cd3a921.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/795b6f5f91824d4fa503740ae41fea7c.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/aa558353fcaa4e459045e984aeee25a0.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7a7a275a2ae8462f903dd4f8b17e0b9d.png#pic_center"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/43082ad945b44dbfba4578390ad7fdd3.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0071bb035e6b43a8b5bc94257d7aad07.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/04ed08f433404803b1e10dd8ba3bd9ff.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c653f5b666e6451f83e08abd4b52a614.png#pic_center"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c3fcc65a8e2e4fa794e3ea33d7ba870e.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d2eb1819b72d4e28a89d7822caa3890e.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c23cbd5e83cd45c7a5f900fe5b7fe7de.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/31b6725530fe4defbeb1e4653d8e1970.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/189b8baa756f4811939b372ba47f6545.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/02208f6364ae4672b80139f0c0719bf2.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2094285b0f154f4497b16fdcf6b43892.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/46dea50fcf4348ea9751e8a6cdd9ae82.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/421b7341253d49daa164c650e5c896ba.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/31920b5c36ae41c49c4b2b15e1fe5d73.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6081bc90cc494db5b638b9ad1a468505.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/08aa132014bf48509c89c297f03cb272.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2a2a5f7feed544b083c8a2c69b4c293f.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c135822a310542c6a684febc74aa2643.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7c0ae88a318948149e2a0fa3bb418d39.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/da695ccc1ff04003ab1ddca202616b46.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/35708d0c5fb746df82dcec5fca411247.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6bd5fd22e35140cc8ca3a69ed48a5a27.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/aa14b7cb6a084347a5e362886a6e1830.png#pic_center"/></p>
<p>发现redis中只要有一个数据缺失，就会从mysql中将整体数据都加载一遍。不够优化。如何实现<strong>异步变更</strong>呢？即redis上只有这一个数据变更，那么只需要从mysql上将这一个数据加载一遍就行了。所以需要将redis和mysql同步。当mysql更新了，那么就立即更新redis。</p>
<h3><a id="redismysql_110"></a>redis与mysql的数据同步</h3>
<p><strong>到目前为止，nginx、php、redis、mysql已经可以整合一起工作了，但是还需要将redis和mysql上的数据同步。怎么样使得mysql上的数据更新之后自动同步到redis？</strong><br/> 使用触发器。<br/> mysql想要将变更数据传给远端，需要：<br/> 1、转换成json的数据结构<br/> 2、发布到分布式的分发系统上面</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9fe2bcca031e4da59dfa79000483c208.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9a68725a611546acaa5ee5c623c5622e.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/cb7ec36b5cc24d7ca636a45fcee849bc.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9d65684dcd114f9680be9c941326336d.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8ba9452656514182af50725560eeac13.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f545b8a730bd42d38741602692bad056.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0946afd5edfa46f19f958e9426ccb898.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b8a5894c9b654efc8dc9840898b7a518.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9afb125fd6db4cdd9e67a0ce763a439a.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/67d24a13be704441a9a831f3878c0a25.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/71bfaca2a6ff41ae9733489f1b9334ed.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a01ea63a1d7a499391fae82d3f2c317c.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7b072b57797c47b3a2508a3942206de4.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5734743606fd492088371c465633a106.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b0c45bd6db274d39882a6094d308acc6.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/402e01d0bac64bc3b1eb84e4b319a105.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0351049d0e8346318949184494cf1633.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3fe1283b6095446c88fe3a2af13d6834.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/cc0bc3c895c94d978cfec5f94c66a9e5.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f9542d2b1b23464d9f418108f80cef54.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6029365260484abda8e605280cc18762.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1545c4cc28454162b4812b0dd790eeaa.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0dcd9401d5094bb8b30edabc3dd0436e.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4df4f3632a6748b98fa5867d4de5c151.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1d74ac8dcdfb410fb5592aa998c481f8.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7ba24807af6e401eb627a71c0b2285f1.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/68eb0dcf3e6b48a59770c85a3b8fbbd0.png#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3396b78c1c7e493d9f420062fc08c5b3.png#pic_center"/></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>