<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<blockquote>
<p>大家好，欢迎来到👏阿提说说👏博客<br/> 该篇文章，由浅入深的介绍了Spring Boot Admin 的特性以及自定义二次开发，想要快速使用，请点击【快速开始】，想要深入了解的继续往下阅读。</p>
</blockquote>
<p></p>
<div class="toc">
<h3>Spring Boot Admin参考指南</h3>
<ul><li><a href="#1Spring_Boot_Admin_6">1.什么是Spring Boot Admin</a></li><li><a href="#2_10">2.快速开始</a></li><li><ul><li><a href="#21_Spring_Boot_Admin_Server_11">2.1 设置Spring Boot Admin Server</a></li><li><a href="#22__75">2.2 注册客户端应用程序</a></li><li><ul><li><a href="#221_Spring_Boot_Admin__77">2.2.1 Spring Boot Admin 客户端</a></li><li><a href="#222_Spring_Cloud_Discovery_113">2.2.2 Spring Cloud Discovery</a></li><li><a href="#223_PyctuatorPython_183">2.2.3 使用Pyctuator注册Python应用</a></li></ul>
</li></ul>
</li><li><a href="#3_219">3.客户端应用</a></li><li><ul><li><a href="#31_Application_220">3.1 在Application列表显示版本</a></li><li><a href="#32_JMXBean__242">3.2 JMX-Bean 管理</a></li><li><a href="#33__251">3.3 日志文件查看器</a></li><li><a href="#34__263">3.4 每个实例显示标签</a></li><li><a href="#35_Spring_Boot_Admin_Client_274">3.5 Spring Boot Admin Client</a></li></ul>
</li><li><a href="#4Spring_Boot_Admin_Server_308">4.Spring Boot Admin Server</a></li><li><ul><li><a href="#41__309">4.1 在反向代理下面运行</a></li><li><a href="#42__311">4.2 属性配置选项</a></li><li><a href="#43_Spring_Cloud_Discovery_346">4.3 Spring Cloud Discovery</a></li><li><ul><li><a href="#431_SimpleDiscoveryClient_348">4.3.1 SimpleDiscoveryClient静态配置</a></li><li><a href="#432_DiscoveryClients_373">4.3.2 其他DiscoveryClients</a></li><li><a href="#433_ServiceInstances_375">4.3.3 转换ServiceInstances</a></li><li><a href="#434_CloudFoundry_405">4.3.4 CloudFoundry</a></li></ul>
</li><li><a href="#44__418">4.4 集群</a></li><li><a href="#45__466">4.5 通知</a></li><li><ul><li><a href="#451__467">4.5.1 邮件通知</a></li><li><a href="#453_OpsGenie_1_499">4.5.3 OpsGenie通知 [^1]</a></li><li><a href="#454_Hipchat__516">4.5.4 Hipchat 通知</a></li><li><a href="#455_Slack__530">4.5.5 Slack 通知</a></li><li><a href="#456_Lets_Chat__546">4.5.6 Let's Chat 通知</a></li><li><a href="#457_Microsoft_Teams_560">4.5.7 Microsoft Teams通知</a></li><li><a href="#458_Telegram__577">4.5.8 Telegram 通知</a></li><li><a href="#459_Discord_591">4.5.9 Discord通知</a></li><li><a href="#4510__604">4.5.10 通知代理设置</a></li><li><a href="#4511__616">4.5.11 通知提醒</a></li><li><a href="#4512__641">4.5.12 过滤通知</a></li><li><a href="#4513__682">4.5.13 钉钉通知</a></li></ul>
</li></ul>
</li><li><a href="#5__694">5. 安全</a></li><li><ul><li><a href="#51_Spring_Boot_Admin_Server__695">5.1 Spring Boot Admin Server 安全</a></li><li><a href="#52_Actuator_767">5.2 保护客户端Actuator端点</a></li><li><ul><li><a href="#521_SBA_777">5.2.1 SBA客户端</a></li><li><a href="#522_SBA_788">5.2.2 SBA服务端</a></li><li><a href="#523_Eureka_815">5.2.3 Eureka</a></li><li><a href="#524_Consul_825">5.2.4 Consul</a></li><li><a href="#525_Actuator_CSRF_836">5.2.5 Actuator端点上的 CSRF</a></li></ul>
</li><li><a href="#53_Mutual_TLS_848">5.3 使用Mutual TLS</a></li></ul>
</li><li><a href="#6__862">6 自定义</a></li><li><ul><li><a href="#61__863">6.1 自定义通知</a></li><li><a href="#62_HTTP_891">6.2 注入自定义HTTP头</a></li><li><a href="#63__903">6.3 拦截请求和响应</a></li><li><a href="#64__916">6.4 链接/嵌入外部页面</a></li><li><a href="#65__930">6.5 自定义视图</a></li><li><ul><li><a href="#651__947">6.5.1 添加顶层视图</a></li><li><a href="#652__996">6.5.2 可视化自定义端点</a></li></ul>
</li><li><a href="#66_Logo_1068">6.6 自定义头部Logo和标题</a></li><li><a href="#67_Logo_1074">6.7 自定义登录Logo</a></li><li><a href="#68_Favicon_1080">6.8 自定义Favicon</a></li><li><a href="#69__1089">6.9 自定义可用语言</a></li><li><a href="#_1093">显示/隐藏视图</a></li></ul>
</li><li><a href="#7_Spring_Boot_15x_1104">7. 监控Spring Boot 1.5.x</a></li></ul>
</div>
<p></p>
<blockquote>
<p>Spring Boot Admin 2.5.1<br/> Johannes Edmeier @joshiste Version 2.5.1,23.08.2021</p>
</blockquote>
<h1><a id="1Spring_Boot_Admin_6"></a>1.什么是Spring Boot Admin</h1>
<p>codecentric 的Spring Boot Admin 是一个社区项目，能够监控和管理您的Spring Boot 应用。这些应用通过Http注册到Spring Boot Admin 或者通过Spring Cloud的注册中心(如Eureka、Consul)来发现。UI是Spring Boot Actuator端点上的Vue.js应用。</p>
<p>使用Pyctuator可以支持监控Python应用程序。</p>
<h1><a id="2_10"></a>2.快速开始</h1>
<h2><a id="21_Spring_Boot_Admin_Server_11"></a>2.1 设置Spring Boot Admin Server</h2>
<p>首先，需要设置一下服务端，只需要通过<code>start.spring.io</code>创建一个简单的Spring Boot项目。由于Spring Boot Admin Server能够做为servlet或webflux应用运行，因此您需要决定添加对应的Spring Boot Starter。在这个例子中，我们使用servlet web starter。</p>
<p>1.添加Spring Boot Admin启动器到依赖<br/> <em>pom.xml</em></p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.codecentric<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-admin-starter-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<blockquote>
<p>🚩<br/> 如果要使用snapshot版本的Spring boot Admin Server，您可能需要把spring 和 sonatype的快照仓库加到pom中<br/> <em>pom.xml</em></p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-milestone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://repo.spring.io/milestone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>spring-snapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://repo.spring.io/snapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>sonatype-nexus-snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Sonatype Nexus Snapshots<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://oss.sonatype.org/content/repositories/snapshots/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>releases</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>releases</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
</code></pre>
</blockquote>
<p>2.通过添加@EnableAdminServer配置引入Spring Boot Admin Server配置</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@EnableAdminServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBootAdminApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>SpringBootAdminApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>🚩<br/> 如果想要在war包中配置Spring Boot Admin Server，并部署在servlet容器中，请查看 <a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-war/">spring-boot-admin-sample-war</a></p>
</blockquote>
<p>另外可以参考<a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-servlet/">spring-boot-admin-sample-servlet</a>项目，该项目增加了安全性校验</p>
<h2><a id="22__75"></a>2.2 注册客户端应用程序</h2>
<p>要在Spring Boot Admin Server（后面简称SBA） 注册您的应用程序，您可以包含SBA客户端或使用Spring Cloud Discovery（如Eureka,Consul等），SBA服务端也提供静态配置选项。</p>
<h3><a id="221_Spring_Boot_Admin__77"></a>2.2.1 Spring Boot Admin 客户端</h3>
<p>每个要注册的应用程序都必须包含Spring Boot Admin Client，为了更好的保护端点，也将<code>spring-boot-starter-security</code>添加到依赖中。</p>
<p>1.将spring-boot-admin-starter-client 添加到依赖中<br/> <em>pom.xml</em></p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>de.codecentric<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-admin-starter-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2.配置SBA Server 的URL来开启SBA Client<br/> <em>application.properties</em></p>
<pre><code class="prism language-xml">#SBA Server 注册地址
spring.boot.admin.client.url=http://localhost:8080  
#公开所有端点，生产环境应该仔细选择要公开的端点
management.endpoints.web.exposure.include=*  
</code></pre>
<p>3.使actuator端点可访问</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SecurityPermitAllConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span>HttpSecurity http<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>permitAll</code>为了简洁起见，这里禁用了安全校验。查看安全部分了解如何处理安全端点。</p>
<h3><a id="222_Spring_Cloud_Discovery_113"></a>2.2.2 Spring Cloud Discovery</h3>
<p>如果您已经使用了Spring Cloud Discovery，那么不需要SBA客户端。只需要将DiscoveryClient添加到Spring Boot Admin Server中，其余部分由AutoConfiguration自动完成。</p>
<p>下面的示例使用了Eureka，但也支持其他实现了Spring Cloud Discovery的注册中心。点击链接查看<a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-consul/">Consul</a>和<a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-zookeeper/">Zookeeper</a>的例子。</p>
<p>其他，请看<a href="http://projects.spring.io/spring-cloud/spring-cloud.html">Spring Cloud 文档</a></p>
<p>1.添加spring-cloud-starter-eureka 到依赖中<br/> <em>pom.xml</em></p>
<pre><code class="prism language-java"><span class="token generics function"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics function"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics function"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>netflix<span class="token operator">-</span>eureka<span class="token operator">-</span>client<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre>
<p>2.添加<code>@EnableDiscoveryClient</code>配置来开启发现</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@EnableScheduling</span>
<span class="token annotation punctuation">@EnableAdminServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBootAdminApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>SpringBootAdminApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Configuration</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SecurityPermitAllConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span>HttpSecurity http<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
            http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>permitAll</code>为了简洁起见，这里禁用了安全校验。查看安全部分了解如何处理安全端点。</p>
<p>3.配置Eureka客户端<br/> <em>application.yml</em></p>
<pre><code class="prism language-yml"><span class="token comment">#配置eureka客户端</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>   
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">leaseRenewalIntervalInSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token key atrule">health-check-url-path</span><span class="token punctuation">:</span> /actuator/health
    <span class="token key atrule">metadata-map</span><span class="token punctuation">:</span>
      <span class="token key atrule">startup</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>random.int<span class="token punctuation">}</span>    <span class="token comment">#重新启动后需要触发信息和端点的更新</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">registryFetchIntervalSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token key atrule">serviceUrl</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>EUREKA_SERVICE_URL<span class="token punctuation">:</span>http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8761</span><span class="token punctuation">}</span>/eureka/

<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> "*"  <span class="token comment">#公开所有端点，生产环境应该仔细选择要公开的端点</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">show-details</span><span class="token punctuation">:</span> ALWAYS
</code></pre>
<p>其他参考 <a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-eureka/">spring-boot-admin-sample-eureka</a>示例。</p>
<blockquote>
<p>🚩<br/> 您可以将SBA Server包含在Eureka的服务端中，同上面的配置，另外设置<code>spring.boot.admin.context-path</code>为不同的地址，以避免SBA UI 不会与Eureka的产生冲突。</p>
</blockquote>
<blockquote>
<p>阿提说说(itsaysay)，PM：2022年7月2日01:08:02</p>
</blockquote>
<h3><a id="223_PyctuatorPython_183"></a>2.2.3 使用Pyctuator注册Python应用</h3>
<p>您可以轻松的使用Pyctuator将SBA和Flask或者FastAPI集成。</p>
<p>下面的步骤使用Flask，但是也支持其他web框架。请查看Pyctuator文档浏览支持的框架和功能列表。</p>
<p>1.安装pyctuator</p>
<pre><code class="prism language-shell">pip <span class="token function">install</span> pyctuator
</code></pre>
<p>2.开启pyctuator,将其指向Flask应用程序，并配置Spring Boot Admin地址</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> pyctuator<span class="token punctuation">.</span>pyctuator <span class="token keyword">import</span> Pyctuator

app_name <span class="token operator">=</span> <span class="token string">"Flask App with Pyctuator"</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>app_name<span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"Hello World!"</span>


Pyctuator<span class="token punctuation">(</span>
    app<span class="token punctuation">,</span>
    app_name<span class="token punctuation">,</span>
    app_url<span class="token operator">=</span><span class="token string">"http://example-app.com"</span><span class="token punctuation">,</span>
    pyctuator_endpoint_url<span class="token operator">=</span><span class="token string">"http://example-app.com/pyctuator"</span><span class="token punctuation">,</span>
    registration_url<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"SPRING_BOOT_ADMIN_URL"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>更多功能和示例，请查看<a href="https://github.com/SolarEdgeTech/pyctuator/blob/master/README.md">Pyctuator文档</a>和<a href="https://github.com/SolarEdgeTech/pyctuator/tree/master/examples">示例</a></p>
<h1><a id="3_219"></a>3.客户端应用</h1>
<h2><a id="31_Application_220"></a>3.1 在Application列表显示版本</h2>
<p>对于Spring Boot应用程序来说，显示版本最简单的办法是使用<code>spring-boot-maven-plugin</code>生成<code>build-info</code>文件<code>META-INF/build-info.properties</code>。另请参考<a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#howto-build-info">Spring Boot参考指南</a></p>
<p>对于非Spring Boot应用程序，您也可以添加version或build.version注册元数据，版本将显示在Application列表中。<br/> <em>pom.xml</em></p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>build-info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2><a id="32_JMXBean__242"></a>3.2 JMX-Bean 管理</h2>
<p>要在admin UI中使用JMX-beans，必须将Jolokia引入到您的应用程序中。由于Jolokia是基于servlet的，所以不支持响应式应用程序。如果您已经引入了<code>spring-boot-admin-starter-client</code>,它会被自动引入，如果没有就需要添加Jolokia依赖。在Spring Boot 2.2.0中，如果您想要通过JMX管理Spring beans,您需要设置<code>spring.jmx.enabled=true</code>。<br/> <em>pom.mxl</em></p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jolokia<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jolokia-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2><a id="33__251"></a>3.3 日志文件查看器</h2>
<p>默认情况下，日志文件无法通过actuator端点访问。为了开启日志文件端点，您需要配置Spring Boot 以生成日志文件，方法是设置<code>logging.file.path</code>或者<code>logging.file.name</code>。</p>
<p>SBA还支持ANSI颜色转义，您需要设置自定义日志文件，SBA 日志默认是不使用颜色的。</p>
<p><em>application.properties</em></p>
<pre><code class="prism language-xml">#日志写入目标文件
logging.file.name=/var/log/sample-boot-application.log 
#日志文件使用ANSI颜色转义
logging.pattern.file=%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID}){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx
</code></pre>
<h2><a id="34__263"></a>3.4 每个实例显示标签</h2>
<p>Tags是一种为每个实例添加可视标记的方法，它们将出现在应用程序列表以及实例视图中。默认情况下，不向实例添加任何标记，由客户端通过向元数据或信息端点添加信息来指定所需的标记。</p>
<p><em>application.properties</em></p>
<pre><code class="prism language-xml">#使用元数据
spring.boot.admin.client.instance.metadata.tags.environment=test

#使用info端点
info.tags.environment=test
</code></pre>
<h2><a id="35_Spring_Boot_Admin_Client_274"></a>3.5 Spring Boot Admin Client</h2>
<p>Spring Boot Admin Client 会向Admin 服务端注册应用程序。这是通过Client定期向Admin服务端发送HTTP POST请求来完成的。</p>
<blockquote>
<p>🚩<br/> SBA客户端注册应用程序有很多属性可以使用，如果这不符合您的需求，您可以自己实现ApplicationFactory。</p>
</blockquote>
<p><em>Table 1. Spring Boot Admin Client 属性配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.client.enabled</td><td align="left">开启 Spring Boot Admin 客户端</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.client.url</td><td align="left">要注册的SBA服务端地址列表，逗号分割。这会触发<strong>强制性</strong>自动配置</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.client.api-path</td><td align="left">管理Admin服务端上注册端点的HTTP路径</td><td align="left"><code>"instances"</code></td></tr><tr><td align="left">spring.boot.admin.client.username spring.boot.admin.client.password</td><td align="left">使用用户名和密码保护SBA服务端的API</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.client.period</td><td align="left">重复注册间隔（毫秒）</td><td align="left"><code>10,000</code></td></tr><tr><td align="left">spring.boot.admin.client.connect-timeout</td><td align="left">注册应用时的连接超时时间（毫秒）</td><td align="left"><code>5,000</code></td></tr><tr><td align="left">spring.boot.admin.client.read-timeout</td><td align="left">注册应用时的读取超时时间（毫秒）</td><td align="left"><code>5,000</code></td></tr><tr><td align="left">spring.boot.admin.client.auto-registration</td><td align="left">为true时，表示在应用程序准备就绪后通过定时任务自动注册应用</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.client.auto-deregistration</td><td align="left">ture时，启用在关闭上下文时自动注销SBA服务端上的应用，如果没有设置，但检测到正在运行的CloudPlatform时，该功能会处于活动状态</td><td align="left"><code>null</code></td></tr><tr><td align="left">spring.boot.admin.client.register-once</td><td align="left">为true，则客户端将（按照“spring.boot.admin.instance.url”定义的顺序）仅针对一个SBA服务端进行注册；如果该SBA服务端关闭，则将自动注册到下一个服务端。如果为false，将针在所有的服务端进行注册。</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.client.instance.health-url</td><td align="left">健康检测URL。如果URL不同(如：Docker)，则可以覆盖，但必须唯一</td><td align="left">Guessed based on management-url and <code>endpoints.health.id</code>.</td></tr><tr><td align="left">spring.boot.admin.client.instance.management-base-url</td><td align="left">用于计算要注册的管理URL的基本URL。该路径是在运行时推断的，并附加到基本URL</td><td align="left">Guessed based on <code>management.port</code>, service-url and <code>server.servlet-path</code>.</td></tr><tr><td align="left">spring.boot.admin.client.instance.management-url</td><td align="left">要注册的management-url。如果可访问的URL不同（例如Docker），则可以覆盖</td><td align="left">Guessed based on management-base-url and <code>management.context-path</code>.</td></tr><tr><td align="left">spring.boot.admin.client.instance.service-base-url</td><td align="left">用于计算要注册的service-url的基本URL。该路径是在运行时推断的，并附加到基本URL。在Cloudfoundry中，可以像下面这样切换到https：spring.boot.admin.client.instance.service-base-url=https://${vcap.application.uris[0]}</td><td align="left">Guessed based on hostname, <code>server.port</code>.</td></tr><tr><td align="left">spring.boot.admin.client.instance.service-url</td><td align="left">要注册的服务网址。如果可访问的URL不同（例如Docker），则可以覆盖</td><td align="left">Guessed based on service-base-url and <code>server.context-path</code>.</td></tr><tr><td align="left">spring.boot.admin.client.instance.service-path</td><td align="left">要注册的service-path，如果路径不同（如用编程方式设置的context-path），则可以覆盖。</td><td align="left">/</td></tr><tr><td align="left">spring.boot.admin.client.instance.name</td><td align="left">要注册的实例名称</td><td align="left">如果设置了<code>${spring.application.name}</code> ，那么原来的值将被覆盖</td></tr><tr><td align="left">spring.boot.admin.client.instance.prefer-ip</td><td align="left">使用ip地址而不是主机名，如果<code>server.address</code> / <code>management.address</code>已经设置，则可以使用，否则从<code>InetAddress.getLocalHost()</code>获取</td><td align="left"><code>false</code></td></tr><tr><td align="left">spring.boot.admin.client.instance.metadata.*</td><td align="left">要与此实例相关联的元数据键值对</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.client.instance.metadata.tags.*</td><td align="left">要与此实例相关联的Tags键值对</td><td align="left"></td></tr></tbody></table>
<p><em>Table 2.实例元数据</em></p>
<table><thead><tr><th align="left">Key</th><th align="left">Value</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">user.name user.password</td><td align="left">访问端点的凭证</td><td align="left"></td></tr></tbody></table>
<h1><a id="4Spring_Boot_Admin_Server_308"></a>4.Spring Boot Admin Server</h1>
<h2><a id="41__309"></a>4.1 在反向代理下面运行</h2>
<p>如果SBA 服务端运行在反向代理服务器下面，可能需要进行配置，可以通过（<code>spring.boot.admin.ui.public-url</code>）来访问服务器的公共url。另外当反向代理终止https连接时，可能需要配置<code>server.forward-headers-strategy=native</code> (also see <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-use-tomcat-behind-a-proxy-server">Spring Boot Reference Guide</a>)。</p>
<h2><a id="42__311"></a>4.2 属性配置选项</h2>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.server.enabled</td><td align="left">开启 Spring Boot Admin Server.</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.context-path</td><td align="left">用作Admin Server静态资源和API路径的前缀，相当于Dispatcher-Servlet</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.monitor.status-interval</td><td align="left">检查实例状态的时间间隔</td><td align="left">10,000ms</td></tr><tr><td align="left">spring.boot.admin.monitor.status-lifetime</td><td align="left">状态的生存期。只要最后一个状态未过期，状态就不会更新。</td><td align="left">10,000ms</td></tr><tr><td align="left">spring.boot.admin.monitor.info-interval</td><td align="left">检查实例信息的时间间隔。</td><td align="left">1m</td></tr><tr><td align="left">spring.boot.admin.monitor.info-lifetime</td><td align="left">信息的生存期。只要最后一条信息未过期，该信息就不会更新。</td><td align="left">1m</td></tr><tr><td align="left">spring.boot.admin.monitor.default-timeout</td><td align="left">发出请求时的默认超时。可以使用覆盖特定端点的单个值<code>spring.boot.admin.monitor.timeout.*</code>.</td><td align="left">10,000</td></tr><tr><td align="left">spring.boot.admin.monitor.timeout.*</td><td align="left">端点ID和超时时间的Key-Value键值对。 默认为默认超时。</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.monitor.default-retries</td><td align="left">失败请求的默认重试次数。Modyfing请求（<code>PUT，POST，PATCH，DELETE</code>）将永远不会重试。<code>spring.boot.admin.monitor.retries.*</code>可以覆盖指定端点的单个值</td><td align="left">0</td></tr><tr><td align="left">spring.boot.admin.monitor.retries.*</td><td align="left">键值对，端点ID的重试次数。默认为默认重试。Modyfing请求（<code>PUT，POST，PATCH，DELETE</code>）将永远不会重试</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.metadata-keys-to-sanitize</td><td align="left">要被过滤掉的元数据（当与正则表达式相匹配时，这些数据会在输出的json数据中过滤掉）</td><td align="left"><code>".**password$", ".\*secret$", ".\*key$", ".\*token$", ".\*credentials.**", ".*vcap_services$"</code></td></tr><tr><td align="left">spring.boot.admin.probed-endpoints</td><td align="left">Spring Boot 1.x 版本指定的检查端点，如果路径与id不同，您可以将其指定为id:path(如health:ping)</td><td align="left"><code>"health", "env", "metrics", "httptrace:trace", "threaddump:dump", "jolokia", "info", "logfile", "refresh", "flyway", "liquibase", "heapdump", "loggers", "auditevents"</code></td></tr><tr><td align="left">spring.boot.admin.instance-auth.enabled</td><td align="left">启用从spring配置属性中提取凭据</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.instance-auth.default-user-name</td><td align="left">用于对注册服务进行身份认证的默认用户名。<code>spring.boot.admin.instance-auth.enabled</code> 配置必须是<code>true</code></td><td align="left"><code>null</code></td></tr><tr><td align="left">spring.boot.admin.instance-auth.default-password</td><td align="left">用于对注册服务进行身份认证的默认用户密码。<code>spring.boot.admin.instance-auth.enabled</code> 配置必须是 <code>true</code>.</td><td align="left"><code>null</code></td></tr><tr><td align="left">spring.boot.admin.instance-auth.service-map.*.user-name</td><td align="left">用于对指定名称的注册服务进行身份验证的用户名。 <code>spring.boot.admin.instance-auth.enabled</code> 必须是 <code>true</code>.</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.instance-auth.service-map.*.user-password</td><td align="left">用于对指定名称的注册服务进行身份验证的用户密码。 <code>spring.boot.admin.instance-auth.enabled</code> 必须是 <code>true</code>.</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.instance-proxy.ignored-headers</td><td align="left">不向客户端发送的header</td><td align="left"><code>"Cookie", "Set-Cookie", "Authorization"</code></td></tr><tr><td align="left">spring.boot.admin.ui.public-url</td><td align="left">用于在ui中构建基本href的基本URL</td><td align="left">如果在反向代理后面运行（使用路径重写），则可用于进行正确的自我引用。如果省略了主机/端口，将从请求中推断出来</td></tr><tr><td align="left">spring.boot.admin.ui.brand</td><td align="left">导航栏中显示的品牌</td><td align="left"><code>"&lt;img src="assets/img/icon-spring-boot-admin.svg"&gt;&lt;span&gt;Spring Boot Admin&lt;/span&gt;"</code></td></tr><tr><td align="left">spring.boot.admin.ui.title</td><td align="left">要显示的页面标题</td><td align="left"><code>"Spring Boot Admin"</code></td></tr><tr><td align="left">spring.boot.admin.ui.login-icon</td><td align="left">登录页面上的图标</td><td align="left"><code>"assets/img/icon-spring-boot-admin.svg"</code></td></tr><tr><td align="left">spring.boot.admin.ui.favicon</td><td align="left">用作默认图标的图标，用于桌面通知的图标</td><td align="left"><code>"assets/img/favicon.png"</code></td></tr><tr><td align="left">spring.boot.admin.ui.favicon-danger</td><td align="left">当一项或多项服务关闭并用于桌面通知时，用作网站图标</td><td align="left"><code>"assets/img/favicon-danger.png"</code></td></tr><tr><td align="left">spring.boot.admin.ui.remember-me-enabled</td><td align="left">登录界面remember-me开关</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.ui.poll-timer.cache</td><td align="left">获取新缓存数据的轮询持续时间（毫秒）</td><td align="left"><code>2500</code></td></tr><tr><td align="left">spring.boot.admin.ui.poll-timer.datasource</td><td align="left">获取新数据源数据的轮询持续时间（毫秒）</td><td align="left"><code>2500</code></td></tr><tr><td align="left">spring.boot.admin.ui.poll-timer.gc</td><td align="left">获取新gc数据的轮询持续时间（毫秒）</td><td align="left"><code>2500</code></td></tr><tr><td align="left">spring.boot.admin.ui.poll-timer.process</td><td align="left">获取新过程数据的轮询持续时间（毫秒）</td><td align="left"><code>2500</code></td></tr><tr><td align="left">spring.boot.admin.ui.poll-timer.memory</td><td align="left">获取新内存数据的轮询持续时间（毫秒）</td><td align="left"><code>2500</code></td></tr><tr><td align="left">spring.boot.admin.ui.poll-timer.threads</td><td align="left">获取新线程数据的轮询持续时间（毫秒）</td><td align="left"><code>2500</code></td></tr></tbody></table>
<h2><a id="43_Spring_Cloud_Discovery_346"></a>4.3 Spring Cloud Discovery</h2>
<p>SBA 服务端能通过<code>DiscoveryClient</code>发现应用程序。优点是客户端不需要引入<code>spring-boot-admin-starter-client</code>依赖。你只需要添加一个<code>DiscoveryClient</code>的实现，其他都有AutoConfiguration自动完成。</p>
<h3><a id="431_SimpleDiscoveryClient_348"></a>4.3.1 SimpleDiscoveryClient静态配置</h3>
<p>Spring Cloud 提供了<code>SimpleDiscoveryClient</code>。它允许您通过静态配置来指定客户端应用程序。<br/> <em>pom.xml</em></p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><em>application.yml</em></p>
<pre><code class="prism language-xml">spring:
  cloud:
    discovery:
      client:
        simple:
          instances:
            test:
              - uri: http://instance1.intern:8080
                metadata:
                  management.context-path: /actuator
              - uri: http://instance2.intern:8080
                metadata:
                  management.context-path: /actuator
</code></pre>
<h3><a id="432_DiscoveryClients_373"></a>4.3.2 其他DiscoveryClients</h3>
<p>Spring Boot Admin 支持所有实现了Spring Cloud <code>DiscoveryClient</code>的组件（如Eureka, Zookeeper, Consul…）。您需要添加它到Spring Boot Admin Server中，并正确配置。</p>
<h3><a id="433_ServiceInstances_375"></a>4.3.3 转换ServiceInstances</h3>
<p>服务注册信息通过<code>ServiceInstanceConverter</code>转换，SBA附带默认转换和Eureka的转换实现。通过AutoConfiguration会自动选择一个正确的实现。</p>
<blockquote>
<p>🚩<br/> 您可以使用SBA服务端配置选项和实例的元数据来修改注册表中的信息。元数据中的值优先于服务器配置。如果配置选项不满足需求，您可以提供自己的<code>ServiceInstanceConverter</code>。</p>
</blockquote>
<blockquote>
<p>❗️ <br/> 当使用Eureka时，已经知道了<code>healthCheckUrl</code>用于Eureka监控检查，您可以在Eureka的客户端配置<code>eureka.instance.healthCheckUrl</code>。</p>
</blockquote>
<p><em>Table 3. 实例元数据选项</em></p>
<table><thead><tr><th align="left">Key</th><th align="left">Value</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">user.name user.password</td><td align="left">用于访问端点的凭据。</td><td align="left"></td></tr><tr><td align="left">management.scheme</td><td align="left">该scheme值在service URL中替换以便访问actuator端点。</td><td align="left"></td></tr><tr><td align="left">management.address</td><td align="left">该address值在service URL中替换以便访问actuator端点。</td><td align="left"></td></tr><tr><td align="left">management.port</td><td align="left">该port值在service URL中替换以便访问actuator端点。</td><td align="left"></td></tr><tr><td align="left">management.context-path</td><td align="left">该路径将会追加在service URL中，用于访问actuator端点</td><td align="left"><code>${spring.boot.admin.discovery.converter.management-context-path}</code></td></tr><tr><td align="left">health.path</td><td align="left">该路径将会追加在service URL中，用于健康检查。忽略 <code>EurekaServiceInstanceConverter</code>.</td><td align="left"><code>${spring.boot.admin.discovery.converter.health-endpoint}</code></td></tr></tbody></table>
<p><em>Table 4. Discovery配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.discovery.enabled</td><td align="left">启用对Admin 服务端的DiscoveryClient支持</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.discovery.converter.management-context-path</td><td align="left">当<code>DefaultServiceInstanceConverter</code>转换management-url时，将附加到发现服务的服务url。</td><td align="left"><code>/actuator</code></td></tr><tr><td align="left">spring.boot.admin.discovery.converter.health-endpoint-path</td><td align="left">当使用<code>DefaultServiceInstanceConverter</code>转换health-url时，将附加到management-url中。</td><td align="left"><code>"health"</code></td></tr><tr><td align="left">spring.boot.admin.discovery.ignored-services</td><td align="left">在使用发现和未注册为应用程序时，将忽略此服务。支持简单模式（例如<code>"foo*", "*bar", "foo*bar*"</code>）。</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.discovery.services</td><td align="left">在使用发现和未注册为应用程序时，将包含此服务。支持简单模式（例如<code>"foo*", "*bar", "foo*bar*"</code>）。</td><td align="left"><code>"*"</code></td></tr><tr><td align="left">spring.boot.admin.discovery.ignored-instances-metadata</td><td align="left">如果服务实例至少包含一个与此列表匹配的元数据项，则将忽略这些实例。(e.g. “discoverable=false”)</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.discovery.instances-metadata</td><td align="left">如果服务实例包含至少一个与此列表匹配的元数据项，则将包括这些实例。 (e.g. “discoverable=true”)</td><td align="left"></td></tr></tbody></table>
<h3><a id="434_CloudFoundry_405"></a>4.3.4 CloudFoundry</h3>
<p>如果您将应用部署在CloudFoundry，那么<code>vcap.application.application_id</code>和<code>vcap.application.instance_index</code>必须配置在元数据中，以便正确注册到SBA 服务中。如下是关于Eureka的简单示例：</p>
<p><em>application.yml</em></p>
<pre><code class="prism language-xml">eureka:
  instance:
    hostname: ${vcap.application.uris[0]}
    nonSecurePort: 80
    metadata-map:
      applicationId: ${vcap.application.application_id}
      instanceId: ${vcap.application.instance_index}
</code></pre>
<h2><a id="44__418"></a>4.4 集群</h2>
<p>Spring Boot Admin Server支持通过Hazelcast进行群集复制。当存在HazelcastConfig或HazelcastInstance Bean时，它会自动启用。您还可以将Hazelcast配置为持久的，以便在重新启动时保持该状态。另请参阅 <a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-hazelcast/">Spring Boot support for Hazelcast</a>。</p>
<ol><li>添加Hazelcast依赖<br/> <em>pom.xml</em></li></ol>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.hazelcast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hazelcast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<ol start="2"><li>实例化HazelcastConfig</li></ol>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> Config <span class="token function">hazelcastConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 用于存储事件的map</span>
  <span class="token comment">// 应该要可靠的保存数据，如果事件太多，Spring Boot Admin将会进行压缩</span>
  MapConfig eventStoreMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapConfig</span><span class="token punctuation">(</span>DEFAULT_NAME_EVENT_STORE_MAP<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setInMemoryFormat</span><span class="token punctuation">(</span>InMemoryFormat<span class="token punctuation">.</span>OBJECT<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setBackupCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setMergePolicyConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MergePolicyConfig</span><span class="token punctuation">(</span>PutIfAbsentMergePolicy<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 该map用于清除通知中的重复数据。</span>
 <span class="token comment">//如果此映射中的数据丢失，这应该不是一个大问题，因为这将导致多个实例发送相同的通知</span>
  MapConfig sentNotificationsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MapConfig</span><span class="token punctuation">(</span>DEFAULT_NAME_SENT_NOTIFICATIONS_MAP<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setInMemoryFormat</span><span class="token punctuation">(</span>InMemoryFormat<span class="token punctuation">.</span>OBJECT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBackupCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setEvictionConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EvictionConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setEvictionPolicy</span><span class="token punctuation">(</span>EvictionPolicy<span class="token punctuation">.</span>LRU<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">setMaxSizePolicy</span><span class="token punctuation">(</span>MaxSizePolicy<span class="token punctuation">.</span>PER_NODE<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">setMergePolicyConfig</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MergePolicyConfig</span><span class="token punctuation">(</span>PutIfAbsentMergePolicy<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Config config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  config<span class="token punctuation">.</span><span class="token function">addMapConfig</span><span class="token punctuation">(</span>eventStoreMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
  config<span class="token punctuation">.</span><span class="token function">addMapConfig</span><span class="token punctuation">(</span>sentNotificationsMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
  config<span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"hazelcast.jmx"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// WARNING: 这将设置一个本地集群，您可以根据需要对其进行更改。</span>
  config<span class="token punctuation">.</span><span class="token function">getNetworkConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMulticastConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  TcpIpConfig tcpIpConfig <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getNetworkConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTcpIpConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  tcpIpConfig<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  tcpIpConfig<span class="token punctuation">.</span><span class="token function">setMembers</span><span class="token punctuation">(</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><em>Table 5. Hazelcast 配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.hazelcast.enabled</td><td align="left">开启Hazelcast 支持</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.hazelcast.event-store</td><td align="left">用于存储事件的Hazelcast-map的名称</td><td align="left"><code>"spring-boot-admin-event-store"</code></td></tr><tr><td align="left">spring.boot.admin.hazelcast.sent-notifications</td><td align="left">用于存储去重通知的Hazelcast-map的名称</td><td align="left"><code>"spring-boot-admin-sent-notifications"</code></td></tr></tbody></table>
<h2><a id="45__466"></a>4.5 通知</h2>
<h3><a id="451__467"></a>4.5.1 邮件通知</h3>
<p>邮件通知使用Thymeleaf作为模版。要开启邮件通知，使用<code>spring-boot-starter-mail</code>配置<code>JavaMailSender</code>并设置收件人。</p>
<p><em>Figure 1. 简单的邮件通知</em></p>
<blockquote>
<p>❗️ 为了防止泄露敏感信息，默认邮件模板不显示实例的任何元数据。如果您想显示一些元数据，可以使用自定义模板。</p>
</blockquote>
<p>1.添加spring-boot-starter-mail 依赖<br/> <em>pom.xml</em></p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-mail<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2.配置JavaMailSender<br/> <em>application.properties</em></p>
<pre><code class="prism language-xml">spring.mail.host=smtp.example.com
spring.boot.admin.notify.mail.to=admin@example.com
</code></pre>
<p>3.使用以下选项配置邮件<br/> <em>Table 6. 邮件通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.mail.enabled</td><td align="left">开启邮件通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.mail.ignore-changes</td><td align="left">要忽略的状态变更: “:”。允许使用通配符</td><td align="left"><code>"UNKNOWN:UP"</code></td></tr><tr><td align="left">spring.boot.admin.notify.mail.template</td><td align="left">用于渲染的Thymeleaf模板的资源路径。</td><td align="left"><code>"classpath:/META-INF/spring-boot-admin-server/mail/status-changed.html"</code></td></tr><tr><td align="left">spring.boot.admin.notify.mail.to</td><td align="left">以逗号分隔的邮件收件人列表</td><td align="left"><code>"root@localhost"</code></td></tr><tr><td align="left">spring.boot.admin.notify.mail.cc</td><td align="left">以逗号分隔的抄送收件人列表</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.mail.from</td><td align="left">邮件发送人</td><td align="left"><code>"Spring Boot Admin &lt;noreply@localhost&gt;"</code></td></tr><tr><td align="left">spring.boot.admin.notify.mail.additional-properties</td><td align="left">可以从模板访问的其他属性</td><td align="left"></td></tr></tbody></table>
<h3><a id="453_OpsGenie_1_499"></a>4.5.3 OpsGenie通知 <sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></h3>
<p>要启用<a href="https://www.opsgenie.com/">OpsGenie</a>通知，您只需将新的JSON Rest API集成添加到您的OpsGenie帐户并设置接收的apiKey <code>spring.boot.admin.notify.opsgenie.api-key</code></p>
<p><em>Table 8. OpsGenie 通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.opsgenie.enabled</td><td align="left">开启OpsGenie 通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.ignore-changes</td><td align="left">要忽略的状态变更 <code>&lt;from-status&gt;:&lt;to-status&gt;</code>。允许使用通配符</td><td align="left"><code>"UNKNOWN:UP"</code></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.api-key</td><td align="left">opsgenie的apikey</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.url</td><td align="left">OpsGenie 告警url</td><td align="left"><code>"https://api.opsgenie.com/v2/alerts"</code></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.description</td><td align="left">描述事件的说明，支持SpEL表达式。</td><td align="left"><code>"#{instance.registration.name}/#{instance.id} is #{instance.statusInfo.status}"</code></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.actions</td><td align="left">可以执行的动作，逗号分隔</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.source</td><td align="left">用于指定警报源的字段。默认情况下，它将被分配到传入请求的IP地址。</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.tags</td><td align="left">附加到警报的标签的逗号分隔列表。</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.entity</td><td align="left">与警报相关的实体。</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.opsgenie.user</td><td align="left">执行的默认所有者。如果未指定用户，系统将成为执行的所有者。</td><td align="left"></td></tr></tbody></table>
<h3><a id="454_Hipchat__516"></a>4.5.4 Hipchat 通知</h3>
<p>开启<a href="https://www.hipchat.com/">Hipchat</a>通知，您仅仅需要用您的Hipchat账户创建一个API token，并设置正确的配置。<br/> <em>Table 9. Hipchat 通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.hipchat.enabled</td><td align="left">开启Hipchat通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.hipchat.ignore-changes</td><td align="left">要忽略的状态变更<code>&lt;from-status&gt;:&lt;to-status&gt;</code>。允许使用通配符。</td><td align="left"><code>"UNKNOWN:UP"</code></td></tr><tr><td align="left">spring.boot.admin.notify.hipchat.url</td><td align="left">HipChat 的REST API (V2) URL</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.hipchat.auth-token</td><td align="left">可访问的API Token</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.hipchat.room-id</td><td align="left">要向其发送通知的房间的ID或url-encoded的名称</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.hipchat.notify</td><td align="left">消息是否应触发用户通知</td><td align="left"><code>false</code></td></tr><tr><td align="left">spring.boot.admin.notify.hipchat.description</td><td align="left">描述事件的说明，支持SpEL表达式。</td><td align="left"><code>"&lt;strong&gt;#{instance.registration.name}&lt;/strong&gt;/#{instance.id} is &lt;strong&gt;#{event.statusInfo.status}&lt;/strong&gt;"</code></td></tr></tbody></table>
<h3><a id="455_Slack__530"></a>4.5.5 Slack 通知</h3>
<p>要启用<a href="https://slack.com/">Slack</a>通知，您需要在Slack帐户的自定义集成下添加一个传入的Webhook，并对其进行适当配置。</p>
<p><em>Table 10. Slack 通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.slack.enabled</td><td align="left">开启Slack通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.slack.ignore-changes</td><td align="left">要忽略的状态变更<code>&lt;from-status&gt;:&lt;to-status&gt;</code>。允许使用通配符。</td><td align="left"><code>"UNKNOWN:UP"</code></td></tr><tr><td align="left">spring.boot.admin.notify.slack.webhook-url</td><td align="left">发送Slack通知的 Webhook 地址</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.slack.channel</td><td align="left">可选频道名称（开头没有#）。如果与Slack Webhooks设置中的频道不同</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.slack.icon</td><td align="left">可选的icon名称（周围没有冒号）。 如果与Slack Webhooks设置中的频道不同</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.slack.username</td><td align="left">可选的发送用户名。 如果与Slack Webhooks设置中的频道不同</td><td align="left"><code>Spring Boot Admin</code></td></tr><tr><td align="left">spring.boot.admin.notify.slack.message</td><td align="left">描述事件的说明，支持SpEL表达式。</td><td align="left"><code>"*#{instance.registration.name}* (#{instance.id}) is *#{event.statusInfo.status}*"</code></td></tr></tbody></table>
<h3><a id="456_Lets_Chat__546"></a>4.5.6 Let’s Chat 通知</h3>
<p>要启用<a href="https://sdelements.github.io/lets-chat/">Let’s Chat</a>通知，您需要添加host url，并从Let’s Chat中添加API令牌和用户名。</p>
<p><em>Table 11. Let’s Chat 通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.letschat.enabled</td><td align="left">开启let´s Chat 通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.letschat.ignore-changes</td><td align="left">要忽略的状态变更<code>&lt;from-status&gt;:&lt;to-status&gt;</code>。允许使用通配符。</td><td align="left"><code>"UNKNOWN:UP"</code></td></tr><tr><td align="left">spring.boot.admin.notify.letschat.url</td><td align="left">要发送的通知的let´s Chat host地址</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.letschat.room</td><td align="left">要发送消息房间</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.letschat.token</td><td align="left">访问let´s Chat API的token</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.letschat.username</td><td align="left">创建token 的用户名</td><td align="left"><code>Spring Boot Admin</code></td></tr><tr><td align="left">spring.boot.admin.notify.letschat.message</td><td align="left">描述事件的说明，支持SpEL表达式。</td><td align="left"><code>"*#{instance.registration.name}* (#{instance.id}) is *#{event.statusInfo.status}*"</code></td></tr></tbody></table>
<h3><a id="457_Microsoft_Teams_560"></a>4.5.7 Microsoft Teams通知</h3>
<p>要启用Microsoft团队通知，您需要设置连接器的webhook url地址并设置适当的配置属性。</p>
<p><em>Table 12. Microsoft Teams 通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.ms-teams.enabled</td><td align="left">开启Microsoft Teams通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.webhook-url</td><td align="left">Microsoft Teams webhook url地址</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.deRegisteredTitle</td><td align="left">应用程序注销时Teams消息的标题。</td><td align="left">De-Registered</td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.registeredTitle</td><td align="left">应用程序注册时Teams消息的标题。</td><td align="left">Registered</td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.statusChangedTitle</td><td align="left">应用程序状态变更时Teams消息的标题</td><td align="left">Status Changed</td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.messageSummary</td><td align="left">Teams消息的摘要</td><td align="left">Spring Boot Admin Notification</td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.theme_color</td><td align="left">设置消息颜色。支持SpEL表达式</td><td align="left"><code>#{event.type == 'STATUS_CHANGED' ? (event.statusInfo.status=='UP' ? '6db33f' : 'b32d36') : '439fe0'}</code></td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.deregister_activity_subtitle</td><td align="left">应用程序注销时Teams消息活动部分的副标题。支持SpEL表达式</td><td align="left"><code>#{instance.registration.name} with id #{instance.id} has de-registered from Spring Boot Admin</code></td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.register_activity_subtitle</td><td align="left">应用程序注册时Teams消息活动部分的副标题。支持SpEL表达式</td><td align="left"><code>#{instance.registration.name} with id #{instance.id} has registered with Spring Boot Admin</code></td></tr><tr><td align="left">spring.boot.admin.notify.ms-teams.status_activity_subtitle</td><td align="left">应用程序状态变更时Teams消息活动部分的副标题。支持SpEL表达式</td><td align="left"><code>#{instance.registration.name} with id #{instance.id} changed status from #{lastStatus} to #{event.statusInfo.status}</code></td></tr></tbody></table>
<h3><a id="458_Telegram__577"></a>4.5.8 Telegram 通知</h3>
<p>要启用<a href="https://telegram.org/">Telegram</a>通知，您需要创建并授权一个机器人，并设置正确的<code>auth-token</code> 和 <code>chat-id</code></p>
<p><em>Table 13. Telegram 通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.telegram.enabled</td><td align="left">开启Telegram 通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.telegram.auth-token</td><td align="left">Telegram 机器人授权Token(如<code>123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11</code>).</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.telegram.chat-id</td><td align="left">目标聊天的唯一标识符或目标频道的用户名</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.telegram.disable-notify</td><td align="left">如果是true，用户将收到一个没有声音的通知。</td><td align="left"><code>false</code></td></tr><tr><td align="left">spring.boot.admin.notify.telegram.parse_mode</td><td align="left">发送消息的格式化模式. 当前支持HTML 和 Markdown</td><td align="left"><code>'HTML'</code></td></tr><tr><td align="left">spring.boot.admin.notify.telegram.message</td><td align="left">发送的文本。支持SpEL表达式</td><td align="left"><code>"&lt;strong&gt;#{instance.registration.name}&lt;/strong&gt;/#{instance.id} is &lt;strong&gt;#{event.statusInfo.status}&lt;/strong&gt;"</code></td></tr></tbody></table>
<h3><a id="459_Discord_591"></a>4.5.9 Discord通知</h3>
<p>要启用Discord通知，您需要创建webhook并设置适当的配置属性。</p>
<p><em>Table 14. Discord 通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.discord.enabled</td><td align="left">开启Discord通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.discord.webhook-url</td><td align="left">发送通知的webhook url</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.discord.username</td><td align="left">可选用户名</td><td align="left"><em>Default set in Discord</em></td></tr><tr><td align="left">spring.boot.admin.notify.discord.avatar-url</td><td align="left">可选的头像URL</td><td align="left"><em>Default set in Discord</em></td></tr><tr><td align="left">spring.boot.admin.notify.discord.tts</td><td align="left">文本消息是否转换成语音</td><td align="left"><code>false</code></td></tr><tr><td align="left">spring.boot.admin.notify.discord.message</td><td align="left">发送的文本。支持SpEL表达式</td><td align="left"><code>"*#{instance.registration.name}* (#{instance.id}) is *#{event.statusInfo.status}*"</code></td></tr></tbody></table>
<h3><a id="4510__604"></a>4.5.10 通知代理设置</h3>
<p>所有使用RestTemplate的通知程序都可以配置为使用代理。</p>
<p><em>Table 15. Notification Proxy 配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.proxy.host</td><td align="left">代理地址</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.proxy.port</td><td align="left">代理端口</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.proxy.username</td><td align="left">鉴权用户名(如果需要)</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.proxy.password</td><td align="left">鉴权密码(如果需要)</td><td align="left"></td></tr></tbody></table>
<h3><a id="4511__616"></a>4.5.11 通知提醒</h3>
<p><code>RemindingNotifier</code>为down/offline的应用程序发送提醒，它可以将发送通知委托给另一个应用程序。</p>
<p>应用程序默认在状态变为<code>DOWN</code>或者<code>OFFLINE</code>是触发提醒。您可以通过<code>setReminderStatuses()</code>修改该行为。当状态更改为非触发状态或相关应用程序注销时，提醒结束。</p>
<p>默认情况下，每10分钟发送一次提醒，要更改此设置，请使用<code>setReminderPeriod()</code>。提醒通知程序本身不会启动后台线程来发送提醒，您需要注意这一点，如下面的示例所示；</p>
<p><em>如何配置提醒</em></p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotifierConfiguration</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> Notifier notifier<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Primary</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>initMethod <span class="token operator">=</span> <span class="token string">"start"</span><span class="token punctuation">,</span> destroyMethod <span class="token operator">=</span> <span class="token string">"stop"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> RemindingNotifier <span class="token function">remindingNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        RemindingNotifier notifier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RemindingNotifier</span><span class="token punctuation">(</span>notifier<span class="token punctuation">,</span> repository<span class="token punctuation">)</span><span class="token punctuation">;</span>
        notifier<span class="token punctuation">.</span><span class="token function">setReminderPeriod</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        notifier<span class="token punctuation">.</span><span class="token function">setCheckReminderInverval</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">return</span> notifier<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="4512__641"></a>4.5.12 过滤通知</h3>
<p><code>FilteringNotifier</code>允许您在运行时根据规则过滤某些通知。它将通知发送委托给另一个通知程序。</p>
<p>如果您添加<code>FilteringNotifier</code>到您的<code>ApplicationContext</code>中，<code>notifications/filter</code>上的RESTful接口可用。</p>
<p>如果您不希望在部署应用程序时收到通知，则此通知程序非常有用。在停止应用程序之前，您可以通过POST请求添加（过期）过滤器。</p>
<p><em>如何配置filtering</em></p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotifierConfig</span> <span class="token punctuation">{<!-- --></span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> InstanceRepository repository<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> ObjectProvider<span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>Notifier<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> otherNotifiers<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token function">NotifierConfig</span><span class="token punctuation">(</span>InstanceRepository repository<span class="token punctuation">,</span> ObjectProvider<span class="token operator">&lt;</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>Notifier<span class="token punctuation">&gt;</span></span><span class="token operator">&gt;</span> otherNotifiers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>otherNotifiers <span class="token operator">=</span> otherNotifiers<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> FilteringNotifier <span class="token function">filteringNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
    CompositeNotifier delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompositeNotifier</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>otherNotifiers<span class="token punctuation">.</span><span class="token function">getIfAvailable</span><span class="token punctuation">(</span>Collections<span class="token operator">:</span><span class="token operator">:</span>emptyList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FilteringNotifier</span><span class="token punctuation">(</span>delegate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

	<span class="token comment">//使用FilterInNotifier作为委托，将RemindingNotifier 做为主bean</span>
  <span class="token annotation punctuation">@Primary</span>
  <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>initMethod <span class="token operator">=</span> <span class="token string">"start"</span><span class="token punctuation">,</span> destroyMethod <span class="token operator">=</span> <span class="token string">"stop"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> RemindingNotifier <span class="token function">remindingNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
    RemindingNotifier notifier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RemindingNotifier</span><span class="token punctuation">(</span><span class="token function">filteringNotifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>
    notifier<span class="token punctuation">.</span><span class="token function">setReminderPeriod</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    notifier<span class="token punctuation">.</span><span class="token function">setCheckReminderInverval</span><span class="token punctuation">(</span>Duration<span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> notifier<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>❗️ 本例结合了提醒和过滤通知。这允许您部署的应用程序在一定时间内（直到过滤器过期）没有重新启动后获取通知。</p>
</blockquote>
<h3><a id="4513__682"></a>4.5.13 钉钉通知</h3>
<p>要开启<a href="https://www.dingtalk.com/">DingTalk</a>通知，您需要创建一个钉钉机器人，并正确设置webhookUrl 和秘钥</p>
<p><em>Table 16. DingTalk 通知配置选项</em></p>
<table><thead><tr><th align="left">Property name</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">spring.boot.admin.notify.dingtalk.enabled</td><td align="left">开启钉钉通知</td><td align="left"><code>true</code></td></tr><tr><td align="left">spring.boot.admin.notify.dingtalk.webhook-url</td><td align="left">DingTalk webhook URL地址</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.dingtalk.secret</td><td align="left">消息秘钥</td><td align="left"></td></tr><tr><td align="left">spring.boot.admin.notify.dingtalk.message</td><td align="left">发送的文本。支持SpEL表达式</td><td align="left"><code>"#{instance.registration.name} #{instance.id} is #{event.statusInfo.status} "</code></td></tr></tbody></table>
<h1><a id="5__694"></a>5. 安全</h1>
<h2><a id="51_Spring_Boot_Admin_Server__695"></a>5.1 Spring Boot Admin Server 安全</h2>
<p>由于有几种方法可以解决分布式web应用程序中的身份验证和授权问题，因此Spring Boot Admin没有提供默认方法。<code>spring-boot-admin-server-ui</code>默认会提供一个登录页面和登出。</p>
<p>Spring Security配置在服务端看起来像这样：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecuritySecureConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{<!-- --></span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> AdminServerProperties adminServer<span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> SecurityProperties security<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token function">SecuritySecureConfig</span><span class="token punctuation">(</span>AdminServerProperties adminServer<span class="token punctuation">,</span> SecurityProperties security<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>adminServer <span class="token operator">=</span> adminServer<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>security <span class="token operator">=</span> security<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span>HttpSecurity http<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
    SavedRequestAwareAuthenticationSuccessHandler successHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SavedRequestAwareAuthenticationSuccessHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    successHandler<span class="token punctuation">.</span><span class="token function">setTargetUrlParameter</span><span class="token punctuation">(</span><span class="token string">"redirectTo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    successHandler<span class="token punctuation">.</span><span class="token function">setDefaultTargetUrl</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>authorizeRequests<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 
   
<span class="token comment">//授予对所有静态资产和登录页面的公共访问权限。</span>
       authorizeRequests<span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/assets/**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/actuator/info"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/actuator/health"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
            <span class="token comment">//其他请求必须验证</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span>
    <span class="token operator">/</span><span class="token operator">/</span>配置登录和登出
        <span class="token punctuation">(</span>formLogin<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> formLogin<span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">successHandler</span><span class="token punctuation">(</span>successHandler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">(</span>logout<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> logout<span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">httpBasic</span><span class="token punctuation">(</span>Customizer<span class="token punctuation">.</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token operator">/</span><span class="token operator">/</span>使用Cookie启用CSRF保护
       <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>csrf<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> csrf<span class="token punctuation">.</span><span class="token function">csrfTokenRepository</span><span class="token punctuation">(</span>CookieCsrfTokenRepository<span class="token punctuation">.</span><span class="token function">withHttpOnlyFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
       <span class="token operator">/</span><span class="token operator">/</span>禁用Spring Boot管理客户端用于（取消）注册的端点的CSRF保护。
           <span class="token punctuation">.</span><span class="token function">ignoringRequestMatchers</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/instances"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    HttpMethod<span class="token punctuation">.</span>POST<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/instances/*"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    HttpMethod<span class="token punctuation">.</span>DELETE<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                    <span class="token comment">//禁用actuator端点的CSRF保护</span>
                <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>adminServer<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token string">"/actuator/**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rememberMe<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> rememberMe<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">1209600</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Required to provide UserDetailsService for "remember functionality"</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span>AuthenticationManagerBuilder auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
    auth<span class="token punctuation">.</span><span class="token function">inMemoryAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span>security<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"{noop}"</span> <span class="token operator">+</span> security<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"USER"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>如果您使用Spring Boot Admin客户端，它需要访问服务器的凭据：<br/> <em>application.yml</em></p>
<pre><code class="prism language-xml">spring.boot.admin.client:
   username: sba-client
   password: s3cret
</code></pre>
<p>有关完整的示例，请参阅<a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-servlet/">spring-boot-admin-sample-servlet</a>。</p>
<blockquote>
<p>❗️ 如果您设置了保护<code>/instances</code>端点，那么不要忘记在SBA-Client客户端设置用户名和密码<code>spring.boot.admin.client.username</code> 和 <code>spring.boot.admin.client.password</code>。</p>
</blockquote>
<h2><a id="52_Actuator_767"></a>5.2 保护客户端Actuator端点</h2>
<p>当使用HTTP基本身份验证保护执行器端点时，SBA服务器需要凭据才能访问它们。注册应用程序时，可以在元数据中提交凭据。<code>BasicAuthHttpHeaderProvider</code>使用此元数据添加<code>Authorization</code>头以访问应用程序的执行器端点。您可以提供自己的<code>HttpHeadersProvider</code>来改变行为（例如添加一些解密）或添加额外的头。</p>
<blockquote>
<p>❗️ SBA服务端会屏蔽HTTP接口中的某些元数据，以防止敏感信息泄漏。</p>
</blockquote>
<blockquote>
<p>❗️ 通过元数据提交凭据时，应为SBA服务器或（服务注册表）配置HTTPS。</p>
</blockquote>
<blockquote>
<p>❗️使用Spring Cloud Discovery时，您必须知道，任何可以查询您的服务注册表的人都可以获得凭据。</p>
</blockquote>
<blockquote>
<p>💡使用这种方法时，SBA服务器决定用户是否可以访问已注册的应用程序。可能有更复杂的解决方案（使用OAuth2）让客户端决定用户是否可以访问端点。您可以查看示例<a href="https://github.com/joshiste/spring-boot-admin-samples">joshiste/spring-boot-admin-samples</a></p>
</blockquote>
<h3><a id="521_SBA_777"></a>5.2.1 SBA客户端</h3>
<p><em>application.yml</em></p>
<pre><code class="prism language-yml"><span class="token key atrule">spring.boot.admin.client</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8080</span>
    <span class="token key atrule">instance</span><span class="token punctuation">:</span>
      <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
        <span class="token key atrule">user.name</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.security.user.name<span class="token punctuation">}</span>
        <span class="token key atrule">user.password</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.security.user.password<span class="token punctuation">}</span>
</code></pre>
<h3><a id="522_SBA_788"></a>5.2.2 SBA服务端</h3>
<p>您可以在Admin服务端中通过配置属性指定凭据。</p>
<blockquote>
<p>💡您可以将其与<a href="https://cloud.spring.io/spring-cloud-kubernetes/1.1.x/reference/html/#secrets-propertysource">spring cloud kubernetes</a>结合使用，从<a href="https://kubernetes.io/docs/concepts/configuration/secret/">secrets</a>中提取凭据。</p>
</blockquote>
<p>启用从属性中提取凭据，<code>spring.boot.admin.instance-auth.enabled</code>必须设置为true(默认)。</p>
<blockquote>
<p>❗️如果您的客户端通过元数据提供凭据，则将使用该元数据而不是属性。</p>
</blockquote>
<p>您可以通过 <code>spring.boot.admin.instance-auth.default-user-name</code>和<code>spring.boot.admin.instance-auth.default-user-password</code>设置默认用户名和密码。（可选的）您可以提供指定服务的凭据（按名称）<code>spring.boot.admin.instance-auth.service-map.*.user-name</code>,将<code>*</code>代替为具体的服务名。</p>
<p><em>application.yml</em></p>
<pre><code class="prism language-yml"><span class="token key atrule">spring.boot.admin</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance-auth</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">default-user-name</span><span class="token punctuation">:</span> <span class="token string">"${some.user.name.from.secret}"</span>
    <span class="token key atrule">default-password</span><span class="token punctuation">:</span> <span class="token string">"${some.user.password.from.secret}"</span>
    <span class="token key atrule">service-map</span><span class="token punctuation">:</span>
      <span class="token key atrule">my-first-service-to-monitor</span><span class="token punctuation">:</span>
        <span class="token key atrule">user-name</span><span class="token punctuation">:</span> <span class="token string">"${some.user.name.from.secret}"</span>
        <span class="token key atrule">user-password</span><span class="token punctuation">:</span> <span class="token string">"${some.user.password.from.secret}"</span>
      <span class="token key atrule">my-second-service-to-monitor</span><span class="token punctuation">:</span>
        <span class="token key atrule">user-name</span><span class="token punctuation">:</span> <span class="token string">"${some.user.name.from.secret}"</span>
        <span class="token key atrule">user-password</span><span class="token punctuation">:</span> <span class="token string">"${some.user.password.from.secret}"</span>
</code></pre>
<h3><a id="523_Eureka_815"></a>5.2.3 Eureka</h3>
<p><em>application.yml</em></p>
<pre><code class="prism language-yml"><span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata-map</span><span class="token punctuation">:</span>
      <span class="token key atrule">user.name</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.security.user.name<span class="token punctuation">}</span>
      <span class="token key atrule">user.password</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.security.user.password<span class="token punctuation">}</span>
</code></pre>
<h3><a id="524_Consul_825"></a>5.2.4 Consul</h3>
<p><em>application.yml</em></p>
<pre><code class="prism language-yml"><span class="token key atrule">spring.cloud.consul</span><span class="token punctuation">:</span>
  <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
        <span class="token key atrule">user-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.security.user.name<span class="token punctuation">}</span>
        <span class="token key atrule">user-password</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.security.user.password<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>❗️ Consul 不允许<code>.</code>在元数据key中，请改用<code>-</code></p>
</blockquote>
<h3><a id="525_Actuator_CSRF_836"></a>5.2.5 Actuator端点上的 CSRF</h3>
<p>一些actuator 端点（如：<code>/loggers</code>）支持POST请求。但使用Spring Security 时，您需要忽略端点上的CSRF保护，因为当前Spring Boot Admin Server 还缺少支持。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span>HttpSecurity http<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{<!-- --></span>
    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">ignoringAntMatchers</span><span class="token punctuation">(</span><span class="token string">"/actuator/**"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<h2><a id="53_Mutual_TLS_848"></a>5.3 使用Mutual TLS</h2>
<p>SBA服务器还可以在访问执行器端点时使用客户端证书进行身份验证。如果存在自定义配置的<code>ClientHttpConnector</code>bean，Spring Boot将自动配置<code>WebClient.Builder</code>，它将被SBA使用。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> ClientHttpConnector <span class="token function">customHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    SslContextBuilder sslContext <span class="token operator">=</span> SslContextBuilder<span class="token punctuation">.</span><span class="token function">forClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//您的自定义sslContext 将转到此处</span>
    HttpClient httpClient <span class="token operator">=</span> HttpClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">secure</span><span class="token punctuation">(</span>
        ssl <span class="token operator">-</span><span class="token operator">&gt;</span> ssl<span class="token punctuation">.</span><span class="token function">sslContext</span><span class="token punctuation">(</span>sslContext<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ReactorClientHttpConnector</span><span class="token punctuation">(</span>httpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="6__862"></a>6 自定义</h1>
<h2><a id="61__863"></a>6.1 自定义通知</h2>
<p>您可以通过实现<code>Notifier</code>来自定义通知。推荐继承<code>AbstractEventNotifier</code>或者<code>AbstractStatusChangeNotifier</code>。</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomNotifier</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractEventNotifier</span> <span class="token punctuation">{<!-- --></span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Logger LOGGER <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>LoggingNotifier<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token function">CustomNotifier</span><span class="token punctuation">(</span>InstanceRepository repository<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">protected</span> Mono<span class="token generics function"><span class="token punctuation">&lt;</span>Void<span class="token punctuation">&gt;</span></span> <span class="token function">doNotify</span><span class="token punctuation">(</span>InstanceEvent event<span class="token punctuation">,</span> Instance instance<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> Mono<span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token keyword">instanceof</span> <span class="token class-name">InstanceStatusChangedEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Instance {} ({}) is {}"</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span><span class="token function">getRegistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>InstanceStatusChangedEvent<span class="token punctuation">)</span> event<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        LOGGER<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Instance {} ({}) {}"</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span><span class="token function">getRegistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            event<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<h2><a id="62_HTTP_891"></a>6.2 注入自定义HTTP头</h2>
<p>如果要在监控应用程序actuator端点的请求中加入自定义的HTTP头，可以通过<code>HttpHeadersProvider</code>轻松实现。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> HttpHeadersProvider <span class="token function">customHttpHeadersProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    HttpHeaders httpHeaders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    httpHeaders<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"X-CUSTOM"</span><span class="token punctuation">,</span> <span class="token string">"My Custom Value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> httpHeaders<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="63__903"></a>6.3 拦截请求和响应</h2>
<p>通过实现<code>InstanceExchangeFilterFunction</code>接口，可以拦截和修改对受监控应用程序的执行器端点的请求和响应。这对于审核或添加一些额外的安全检查非常有用。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> InstanceExchangeFilterFunction <span class="token function">auditLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>instance<span class="token punctuation">,</span> request<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> next<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doOnSubscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>HttpMethod<span class="token punctuation">.</span>DELETE<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> HttpMethod<span class="token punctuation">.</span>POST<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"{} for {} on {}"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="64__916"></a>6.4 链接/嵌入外部页面</h2>
<p>您可以非常简单的将链接或者外部页面添加到SBA，甚至是嵌入(<code>iframe=true</code>)</p>
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">boot</span><span class="token punctuation">:</span>
    <span class="token key atrule">admin</span><span class="token punctuation">:</span>
      <span class="token key atrule">ui</span><span class="token punctuation">:</span>
        <span class="token key atrule">external-views</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">label</span><span class="token punctuation">:</span> <span class="token string">"🚀"</span>
            <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//codecentric.de
            <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token number">2000</span>
</code></pre>
<h2><a id="65__930"></a>6.5 自定义视图</h2>
<p>可以向ui添加自定义视图。视图必须是基于<a href="https://vuejs.org/">Vue.js</a>的。</p>
<p>JavaScript包和CSS样式表必须放在<code>/META-INF/spring-boot-admin-server-ui/extensions/{name}/</code>的类路径上，以便服务器可以提取它们。</p>
<p><a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-custom-ui/">spring-boot-admin-sample-custom-ui</a> 提供了一个简单的UI，包含构建这样一个module的必要maven配置。</p>
<p>自定义扩展通过<code>SBA.use()</code>进行自我注册，并通过<code>install()</code>暴露自己，当UI设置路由时调用。<code>install()</code>函数接受以下参数以注册视图和回调。</p>
<ul><li> <p>引用<a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-server-ui/src/main/frontend/viewRegistry.js">viewRegistry</a>的对象</p> </li><li> <p>引用 <a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-server-ui/src/main/frontend/store.js">applicationStore</a>的对象</p> </li><li> <p>引用全局Vue的对象</p> </li><li> <p>引用axios的对象</p> </li></ul>
<p>如果将新的顶层路由添加到前端，后端也必须知道。在<code>/META-INF/spring-boot-admin-server-ui/extensions/{name}/routes.txt</code>中每行添加一个顶层路由。</p>
<h3><a id="651__947"></a>6.5.1 添加顶层视图</h3>
<p>下面是一个简单的顶层视图，列出了所有注册的应用程序：</p>
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">v-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stringify(applications, null, 4)<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    applications<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> 
      type<span class="token punctuation">:</span> Array<span class="token punctuation">,</span>
      required<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    stringify<span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>stringify
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<blockquote>
<p>❗️如果您定义了<code>applications</code>属性，那么将接受所有注册的应用程序</p>
</blockquote>
<blockquote>
<p>💡 有一些有用的方法，查看 <a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-server-ui/src/main/frontend/services/application.js">application.js</a> 和 <a href="https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-server-ui/src/main/frontend/services/instance.js">instance.js</a></p>
</blockquote>
<pre><code class="prism language-js"><span class="token constant">SBA</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>viewRegistry<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    viewRegistry<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//视图名称</span>
      name<span class="token punctuation">:</span> <span class="token string">'custom'</span><span class="token punctuation">,</span>
      <span class="token comment">//视图访问路径  </span>
      path<span class="token punctuation">:</span> <span class="token string">'/custom'</span><span class="token punctuation">,</span>
      <span class="token comment">//导入的自定义组件</span>
      component<span class="token punctuation">:</span> custom<span class="token punctuation">,</span>
      <span class="token comment">// 自定义视图在顶部导航栏显示的标签</span>
      label<span class="token punctuation">:</span> <span class="token string">'Custom'</span><span class="token punctuation">,</span> 
      <span class="token comment">//视图的顺序。顶部导航栏中的视图按升序排序。</span>
      order<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>在<code>routes.txt</code>中添加路由</p>
<pre><code class="prism language-xml">/custom/**
</code></pre>
<h3><a id="652__996"></a>6.5.2 可视化自定义端点</h3>
<p>以下是显示自定义端点的视图：</p>
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>custom<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Instance: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>instance.id<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Output: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果定义实例属性，组件将接收应渲染视图的实例。</span>
     instance<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span> 
        type<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
        required<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      text<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//每个实例都有一个预配置的axios实例，用于使用正确的路径和头访问端点。</span>
     <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'actuator/custom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
  <span class="token selector">.custom</span> <span class="token punctuation">{<!-- --></span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 80%<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>注册实例视图的工作方式与顶级视图类似，具有一些附加属性：</p>
<pre><code class="prism language-js"><span class="token constant">SBA</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>viewRegistry<span class="token punctuation">,</span> vueI18n<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    viewRegistry<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      name<span class="token punctuation">:</span> <span class="token string">'instances/custom'</span><span class="token punctuation">,</span>
      <span class="token comment">//父对象必须是实例</span>
      parent<span class="token punctuation">:</span> <span class="token string">'instances'</span><span class="token punctuation">,</span> 
      path<span class="token punctuation">:</span> <span class="token string">'custom'</span><span class="token punctuation">,</span>
      component<span class="token punctuation">:</span> customEndpoint<span class="token punctuation">,</span>
      label<span class="token punctuation">:</span> <span class="token string">'Custom'</span><span class="token punctuation">,</span>
      <span class="token comment">//使用组来给视图分组</span>
      group<span class="token punctuation">:</span> <span class="token string">'custom'</span><span class="token punctuation">,</span> 
      order<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
      <span class="token comment">//您可以动态确定是否应该为特定实例显示视图</span>
     isEnabled<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>instance<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> instance<span class="token punctuation">.</span><span class="token function">hasEndpoint</span><span class="token punctuation">(</span><span class="token string">'custom'</span><span class="token punctuation">)</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//自定义翻译</span>
    vueI18n<span class="token punctuation">.</span><span class="token function">mergeLocaleMessage</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> 
      sidebar<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        custom <span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
          title <span class="token punctuation">:</span> <span class="token string">"My Custom Extensions"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>❗️ 通过设置组名和名称，可以覆盖默认的视图</p>
</blockquote>
<p>PM: 2022年7月5日02:50:39</p>
<h2><a id="66_Logo_1068"></a>6.6 自定义头部Logo和标题</h2>
<p>您可以通过如下的配置，在头部显示自定义信息：</p>
<ul><li>spring.boot.admin.ui.brand： 这段HTML在头部导航中显示，默认为<code>&lt;img src="assets/img/icon-spring-boot-admin.svg"&gt;&lt;span&gt;Spring Boot Admin&lt;/span&gt;</code>。默认情况下显示SBA Logo 后面紧跟名称。如果你想要展示自定义的Logo，设置：<code>spring.boot.admin.ui.brand=&lt;img src="custom/custom-icon.png"&gt;</code>。或者您只需要将图像添加到您Jar包的<code>/META-INF/spring-boot-admin-server-ui/</code>中(SBA默认从该路径注册<code>ResourceHandler</code>),或者您必须确保图像得到正确的服务（如注册您自己的<code>ResourceHandler</code>）</li><li>spring.boot.admin.ui.title: 使用此选项可自定义浏览器窗口标题。</li></ul>
<h2><a id="67_Logo_1074"></a>6.7 自定义登录Logo</h2>
<p>您可以设置一个自定义图片显示在登录页面。</p>
<ol><li>将图像放在通过http提供服务的资源位置（如：/META-INF/spring-boot-admin-server-ui/assets/img/）</li><li>配置下面属性<br/> spring.boot.admin.ui.login-icon: 用作登录页面上的图标 (比如 assets/img/custom-login-icon.svg)</li></ol>
<h2><a id="68_Favicon_1080"></a>6.8 自定义Favicon</h2>
<p>可以使用自定义favicon，它也用于桌面通知。当一个或多个应用程序关闭时，Spring Boot Admin使用不同的图标。</p>
<ol><li> <p>放置favicon(<code>.png</code>至少192x192像素)在资源路径(比如：/META-INF/spring-boot-admin-server-ui/assets/img/)</p> </li><li> <p>配置icons<br/> - spring.boot.admin.ui.favicon: 用作默认图标. (比如 assets/img/custom-favicon.png<br/> - spring.boot.admin.ui.favicon-danger:当一个或多个服务关闭时使用。(比如 assets/img/custom-favicon-danger.png)</p> </li></ol>
<h2><a id="69__1089"></a>6.9 自定义可用语言</h2>
<p>spring.boot.admin.ui.available-languages： 要选用的语言。 (比如 en,de out of existing de,en,fr,ko,pt-BR,ru,zh)</p>
<h2><a id="_1093"></a>显示/隐藏视图</h2>
<p>您可以很简单的在导航栏中隐藏视图：</p>
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">boot</span><span class="token punctuation">:</span>
    <span class="token key atrule">admin</span><span class="token punctuation">:</span>
      <span class="token key atrule">ui</span><span class="token punctuation">:</span>
        <span class="token key atrule">view-settings</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"journal"</span>
            <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre>
<h1><a id="7_Spring_Boot_15x_1104"></a>7. 监控Spring Boot 1.5.x</h1>
<p>可以使用SBA 2.x监控 SB 1.5x的应用。旧的SBA Client 可以注册在新的服务端上。由于API略有变化，您需要在旧客户端上设置以下属性：</p>
<ol><li>在SBA Client 1.5x上重新配置 api路径<br/> <em>application.yml</em></li></ol>
<pre><code class="prism language-xml">spring.boot.admin.api-path: instances

</code></pre>
<p>随着Spring Boot 2 release 版本的发布，一些执行器端点发生了变化，并非所有选项都可用（例如/metrics端点）；对于一些端点，我们提供了转换器。</p>
<p>PM：2022年7月5日03:23:20</p>
<hr class="footnotes-sep"/>
<section class="footnotes">
<ol class="footnotes-list"><li class="footnote-item" id="fn1"><p>Atlassian出品，著名产品有Confluence <a class="footnote-backref" href="#fnref1">↩︎</a></p> </li></ol>
</section>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>