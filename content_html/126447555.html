<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p> <img alt="8420b26844034fab91b6df661ae68671.png" src="https://img-blog.csdnimg.cn/8420b26844034fab91b6df661ae68671.png"/></p>
<p><strong>ä¸ªäººç®€ä»‹ï¼š </strong></p>
<blockquote>
<p>&gt; ğŸ“¦ä¸ªäººä¸»é¡µï¼š<a href="https://blog.csdn.net/weixin_45750572?type=blog" title="èµµå››å¸æœº">èµµå››å¸æœº</a><br/> &gt; ğŸ†å­¦ä¹ æ–¹å‘ï¼šJAVAåç«¯å¼€å‘ <br/> &gt; â°å¾€æœŸæ–‡ç« ï¼š<a href="https://blog.csdn.net/weixin_45750572/article/details/125534014" title="SpringBooté¡¹ç›®æ•´åˆå¾®ä¿¡æ”¯ä»˜">SpringBooté¡¹ç›®æ•´åˆå¾®ä¿¡æ”¯ä»˜</a><br/> &gt; ğŸ””åšä¸»æ¨èç½‘ç«™ï¼š<a href="https://www.nowcoder.com/link/pc_csdncpt_zssj_sf" title="ç‰›å®¢ç½‘ åˆ·é¢˜|é¢è¯•|æ‰¾å·¥ä½œç¥å™¨">ç‰›å®¢ç½‘ åˆ·é¢˜|é¢è¯•|æ‰¾å·¥ä½œç¥å™¨</a><br/> &gt; ğŸ“£ç§ä¸€æ£µæ ‘æœ€å¥½çš„æ—¶é—´æ˜¯åå¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ï¼<br/> &gt; ğŸ’–å–œæ¬¢çš„è¯éº»çƒ¦ç‚¹ç‚¹å…³æ³¨å–”ï¼Œä½ ä»¬çš„æ”¯æŒæ˜¯æˆ‘çš„æœ€å¤§åŠ¨åŠ›ã€‚</p>
</blockquote>
<p><strong>å‰è¨€ï¼š</strong></p>
<blockquote>
<p>æœ€è¿‘åœ¨åšä¸€ä¸ªåŸºäºSpringCloud+Springboot+Dockerçš„æ–°é—»å¤´æ¡å¾®æœåŠ¡é¡¹ç›®ï¼Œç”¨çš„æ˜¯é»‘é©¬çš„æ•™ç¨‹ï¼Œç°åœ¨é¡¹ç›®å¼€å‘è¿›å…¥äº†å°¾å£°ï¼Œæˆ‘æ‰“ç®—é€šè¿‡å†™æ–‡ç« çš„å½¢å¼è¿›è¡Œæ¢³ç†ä¸€éï¼Œå¹¶ä¸”ä¼šå°†æ¢³ç†è¿‡ç¨‹ä¸­å‘ç°çš„Bugè¿›è¡Œä¿®å¤ï¼Œæœ‰éœ€è¦æ”¹è¿›çš„åœ°æ–¹æˆ‘ä¹Ÿä¼šç»§ç»­åšå‡ºæ”¹è¿›ã€‚è¿™ä¸€ç³»åˆ—çš„æ–‡ç« æˆ‘å°†ä¼šæ”¾å…¥å¾®æœåŠ¡é¡¹ç›®ä¸“æ ä¸­ï¼Œè¿™ä¸ªé¡¹ç›®é€‚åˆåˆšæ¥è§¦å¾®æœåŠ¡çš„äººä½œä¸ºç»ƒæ‰‹é¡¹ç›®ï¼Œå‡å¦‚ä½ å¯¹è¿™ä¸ªé¡¹ç›®æ„Ÿå…´è¶£ä½ å¯ä»¥è®¢é˜…æˆ‘çš„ä¸“æ è¿›è¡ŒæŸ¥çœ‹ï¼Œéœ€è¦èµ„æ–™å¯ä»¥ç§ä¿¡æˆ‘ï¼Œå½“ç„¶è¦æ˜¯èƒ½ç»™æˆ‘ç‚¹ä¸ªå°å°çš„å…³æ³¨å°±æ›´å¥½äº†ï¼Œä½ ä»¬çš„æ”¯æŒæ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚</p>
<p>å¦‚æœä½ æƒ³è¦ä¸€ä¸ªå¯ä»¥ç³»ç»Ÿå­¦ä¹ çš„ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘æ¨èçš„æ˜¯ç‰›å®¢ç½‘ï¼Œä¸ªäººæ„Ÿè§‰ç”¨ç€è¿˜æ˜¯ä¸é”™çš„ï¼Œé¡µé¢å¾ˆæ•´æ´ï¼Œè€Œä¸”å†…å®¹ä¹Ÿå¾ˆå…¨é¢ï¼Œè¯­æ³•ç»ƒä¹ ï¼Œç®—æ³•é¢˜ç»ƒä¹ ï¼Œé¢è¯•çŸ¥è¯†æ±‡æ€»ç­‰ç­‰éƒ½æœ‰ï¼Œè®ºå›ä¹Ÿå¾ˆæ´»è·ƒï¼Œä¼ é€é—¨é“¾æ¥ï¼š<a href="https://www.nowcoder.com/link/pc_csdncpt_zssj_sf" title="ç‰›å®¢åˆ·é¢˜ç¥å™¨">ç‰›å®¢åˆ·é¢˜ç¥å™¨</a></p>
</blockquote>
<p id="main-toc"><strong>ç›®å½•</strong></p>
<p id="%E4%B8%80%EF%BC%9A%E6%9C%AA%E6%9D%A5%E6%95%B0%E6%8D%AE%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0-toc" style="margin-left:0px;"><a href="#%E4%B8%80%EF%BC%9A%E6%9C%AA%E6%9D%A5%E6%95%B0%E6%8D%AE%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0">ä¸€ï¼šæœªæ¥æ•°æ®å®šæ—¶åˆ·æ–°</a></p>
<p id="1.redis%20key%E5%80%BC%E5%8C%B9%E9%85%8D-toc" style="margin-left:40px;"><a href="#1.redis%20key%E5%80%BC%E5%8C%B9%E9%85%8D">1.redis keyå€¼åŒ¹é…</a></p>
<p id="%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9Akeys%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9Akeys%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D">æ–¹æ¡ˆä¸€ï¼škeysæ¨¡ç³ŠåŒ¹é…</a></p>
<p id="%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9Ascan-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9Ascan">æ–¹æ¡ˆäºŒï¼šscan</a></p>
<p id="2.redis%E7%AE%A1%E9%81%93-toc" style="margin-left:40px;"><a href="#2.redis%E7%AE%A1%E9%81%93">2.redisç®¡é“</a></p>
<p id="3.%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%C2%A0-toc" style="margin-left:40px;"><a href="#3.%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%C2%A0">3.å®šæ—¶åˆ·æ–°åŠŸèƒ½å®ç° </a></p>
<p id="%E4%BA%8C%EF%BC%9A%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E8%A7%A3%E5%86%B3%E9%9B%86%E7%BE%A4%E4%B8%8B%E7%9A%84%E6%96%B9%E6%B3%95%E6%8A%A2%E5%8D%A0%E6%89%A7%E8%A1%8C-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%EF%BC%9A%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E8%A7%A3%E5%86%B3%E9%9B%86%E7%BE%A4%E4%B8%8B%E7%9A%84%E6%96%B9%E6%B3%95%E6%8A%A2%E5%8D%A0%E6%89%A7%E8%A1%8C">äºŒï¼šåˆ†å¸ƒå¼é”è§£å†³é›†ç¾¤ä¸‹çš„æ–¹æ³•æŠ¢å æ‰§è¡Œ</a></p>
<p id="1.%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-toc" style="margin-left:40px;"><a href="#1.%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0">1.é—®é¢˜æè¿°</a></p>
<p id="2.%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-toc" style="margin-left:40px;"><a href="#2.%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">2.åˆ†å¸ƒå¼é”</a></p>
<p id="3.redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-toc" style="margin-left:40px;"><a href="#3.redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">3.redisåˆ†å¸ƒå¼é”</a></p>
<p id="%C2%A04.%E5%AE%9E%E7%8E%B0-toc" style="margin-left:40px;"><a href="#%C2%A04.%E5%AE%9E%E7%8E%B0"> 4.å®ç°</a></p>
<p id="%EF%BC%881%EF%BC%89%E6%96%B9%E6%B3%95%E6%B7%BB%E5%8A%A0-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E6%96%B9%E6%B3%95%E6%B7%BB%E5%8A%A0">ï¼ˆ1ï¼‰æ–¹æ³•æ·»åŠ </a></p>
<p id="%EF%BC%882%EF%BC%89%20%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89%20%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9">ï¼ˆ2ï¼‰ ä»£ç ä¿®æ”¹</a></p>
<p id="5.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8C%E6%AD%A5-toc" style="margin-left:40px;"><a href="#5.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8C%E6%AD%A5">5.æ•°æ®åº“åŒæ­¥</a></p>
<p id="%E4%B8%89%EF%BC%9A%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E5%8F%91%E5%B8%83-toc" style="margin-left:0px;"><a href="#%E4%B8%89%EF%BC%9A%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E5%8F%91%E5%B8%83">ä¸‰ï¼šå»¶è¿Ÿé˜Ÿåˆ—å®ç°å®šæ—¶å‘å¸ƒ</a></p>
<p id="1.%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%A4%96%E6%8E%A5%E5%8F%A3-toc" style="margin-left:40px;"><a href="#1.%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%A4%96%E6%8E%A5%E5%8F%A3">1.æä¾›å¯¹å¤–æ¥å£</a></p>
<p id="2.%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-toc" style="margin-left:40px;"><a href="#2.%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0">2.å…·ä½“å®ç°</a></p>
<p id="%EF%BC%881%EF%BC%89%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87">ï¼ˆ1ï¼‰å‰æœŸå‡†å¤‡</a></p>
<p id="%EF%BC%882%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%BB%BB%E5%8A%A1%E5%88%B0%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%BB%BB%E5%8A%A1%E5%88%B0%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97">ï¼ˆ2ï¼‰æ·»åŠ ä»»åŠ¡åˆ°å»¶è¿Ÿé˜Ÿåˆ—</a></p>
<p id="%EF%BC%883%EF%BC%89%E4%BF%AE%E6%94%B9%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%EF%BC%883%EF%BC%89%E4%BF%AE%E6%94%B9%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E4%BB%A3%E7%A0%81">ï¼ˆ3ï¼‰ä¿®æ”¹å‘å¸ƒæ–‡ç« ä»£ç </a></p>
<p id="%EF%BC%884%EF%BC%89%E6%B6%88%E8%B4%B9%E4%BB%BB%E5%8A%A1%E8%BF%9B%E8%A1%8C%E6%96%87%E7%AB%A0%E5%AE%A1%E6%A0%B8-toc" style="margin-left:80px;"><a href="#%EF%BC%884%EF%BC%89%E6%B6%88%E8%B4%B9%E4%BB%BB%E5%8A%A1%E8%BF%9B%E8%A1%8C%E6%96%87%E7%AB%A0%E5%AE%A1%E6%A0%B8">ï¼ˆ4ï¼‰æ¶ˆè´¹ä»»åŠ¡è¿›è¡Œæ–‡ç« å®¡æ ¸</a></p>
<hr id="hr-toc"/>
<p></p>
<h1 id="%E4%B8%80%EF%BC%9A%E6%9C%AA%E6%9D%A5%E6%95%B0%E6%8D%AE%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0">ä¸€ï¼šæœªæ¥æ•°æ®å®šæ—¶åˆ·æ–°</h1>
<h2 id="1.redis%20key%E5%80%BC%E5%8C%B9%E9%85%8D">1.redis keyå€¼åŒ¹é…</h2>
<p>        å°†æœªæ¥5åˆ†é’Ÿä¹‹å†…è¦å‘å¸ƒçš„æ–‡ç« åŠ å…¥åˆ°redisä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å®šæ—¶å¯¹è¿™éƒ¨åˆ†æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯zsetä¸­çš„æ•°æ®ï¼‰è¿›è¡Œæ‰«æï¼Œä»¥ä¾¿å°†zsetä¸­æ—¶é—´åˆ°äº†æ–‡ç« å­˜å…¥listä¸­å‡†å¤‡å‘å¸ƒï¼Œä½†æ˜¯è¿™æ—¶å€™æ‰«æzsetä¸­çš„æ•°æ®æœ‰ä¸¤ç§é€‰æ‹©ï¼Œè§ä¸‹é¢åˆ†æï¼š</p>
<h3 id="%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%9Akeys%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D">æ–¹æ¡ˆä¸€ï¼škeysæ¨¡ç³ŠåŒ¹é…</h3>
<p>keysçš„æ¨¡ç³ŠåŒ¹é…åŠŸèƒ½å¾ˆæ–¹ä¾¿ä¹Ÿå¾ˆå¼ºå¤§ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒéœ€è¦æ…ç”¨ï¼å¼€å‘ä¸­ä½¿ç”¨keysçš„æ¨¡ç³ŠåŒ¹é…å´å‘ç°redisçš„CPUä½¿ç”¨ç‡æé«˜ï¼Œæ‰€ä»¥å…¬å¸çš„redisç”Ÿäº§ç¯å¢ƒå°†keyså‘½ä»¤ç¦ç”¨äº†ï¼redisæ˜¯å•çº¿ç¨‹ï¼Œä¼šè¢«å µå¡</p>
<p><img alt="" height="374" src="image\ee05414faa9a48be8e24dd2f148022d4.png" width="452"/></p>
<h3 id="%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%9Ascan">æ–¹æ¡ˆäºŒï¼šscan</h3>
<p>SCAN å‘½ä»¤æ˜¯ä¸€ä¸ªåŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼ŒSCANå‘½ä»¤æ¯æ¬¡è¢«è°ƒç”¨ä¹‹åï¼Œ éƒ½ä¼šå‘ç”¨æˆ·è¿”å›ä¸€ä¸ªæ–°çš„æ¸¸æ ‡ï¼Œ ç”¨æˆ·åœ¨ä¸‹æ¬¡è¿­ä»£æ—¶éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–°æ¸¸æ ‡ä½œä¸ºSCANå‘½ä»¤çš„æ¸¸æ ‡å‚æ•°ï¼Œ ä»¥æ­¤æ¥å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚  </p>
<p id="%E2%80%8B%E7%BC%96%E8%BE%912.redis%E7%AE%A1%E9%81%93"><img alt="" height="320" src="image\a0a27dd5a2ed43bfbe067d89deaadd00.png" width="1200"/></p>
<h2 id="2.redis%E7%AE%A1%E9%81%93">2.redisç®¡é“</h2>
<p>æ™®é€šrediså®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤äº’æ¨¡å¼</p>
<p><img alt="" height="558" src="image\c38a6c54a23b4f308d1c21855664a92b.png" width="735"/></p>
<p></p>
<p>Pipelineè¯·æ±‚æ¨¡å‹</p>
<p><img alt="" height="558" src="image\f46db6d3cdfa43f2acee6089d171ab9b.png" width="750"/></p>
<p>        ä¸¤è€…çš„åŒºåˆ«ä»å›¾ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œç¬¬ä¸€ç§æ–¹å¼å¯¹æ¯ä¸€ä¸ªå‘½ä»¤éƒ½éœ€è¦å‘æœåŠ¡ç«¯å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œå‡å¦‚å‘½ä»¤è¿‡å¤šä¼šä¸æ–­åˆ›å»ºè¿æ¥ï¼Œé™ä½æ‰§è¡Œæ•ˆç‡ï¼›è€Œç¬¬äºŒç§æ–¹å¼åˆ™æ˜¯å°†ä¸€æ‰¹å‘½ä»¤ç§¯æ”’åˆ°ä¸€èµ·å†å¼€å¯é€šé“ä¸€æ¬¡æ€§æ‰§è¡Œï¼Œå¤§å¤§å‡å°‘äº†è¿æ¥æ•°ã€‚  </p>
<h2 id="3.%E5%AE%9A%E6%97%B6%E5%88%B7%E6%96%B0%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%C2%A0">3.å®šæ—¶åˆ·æ–°åŠŸèƒ½å®ç° </h2>
<p>åœ¨taskserviceImplä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼Œå¹¶ä¸”å¼•å¯¼ç±»ä¸­å¼€å¯ä»»åŠ¡è°ƒåº¦æ³¨è§£@EnableScheduling</p>
<pre><code class="language-java">@Scheduled(cron = "0 */1 * * * ?")
public void refresh() {

    // è·å–æ‰€æœ‰æœªæ¥æ•°æ®é›†åˆçš„keyå€¼
    Set&lt;String&gt; futureKeys = cacheService.scan(ScheduleConstants.FUTURE + "*");// future_*
    for (String futureKey : futureKeys) { // future_250_250

        String topicKey = ScheduleConstants.TOPIC + futureKey.split(ScheduleConstants.FUTURE)[1];
        //è·å–è¯¥ç»„keyä¸‹å½“å‰éœ€è¦æ¶ˆè´¹çš„ä»»åŠ¡æ•°æ®
        Set&lt;String&gt; tasks = cacheService.zRangeByScore(futureKey, 0, System.currentTimeMillis());
        if (!tasks.isEmpty()) {
            //å°†è¿™äº›ä»»åŠ¡æ•°æ®æ·»åŠ åˆ°æ¶ˆè´¹è€…é˜Ÿåˆ—ä¸­
            cacheService.refreshWithPipeline(futureKey, topicKey, tasks);
            log.info("æˆåŠŸå°†{}ä¸‹çš„å½“å‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°{}",futureKey,topicKey);
        }
    }
}</code></pre>
<h1 id="%E4%BA%8C%EF%BC%9A%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E8%A7%A3%E5%86%B3%E9%9B%86%E7%BE%A4%E4%B8%8B%E7%9A%84%E6%96%B9%E6%B3%95%E6%8A%A2%E5%8D%A0%E6%89%A7%E8%A1%8C">äºŒï¼šåˆ†å¸ƒå¼é”è§£å†³é›†ç¾¤ä¸‹çš„æ–¹æ³•æŠ¢å æ‰§è¡Œ</h1>
<h2 id="1.%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0">1.é—®é¢˜æè¿°</h2>
<p>        å‡å¦‚å¯åŠ¨ä¸¤å°tbug-headlines-scheduleæœåŠ¡ï¼Œè¿™æ—¶å€™ä¸¤è€…éƒ½ä¼šå»æ‰§è¡Œrefreshæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦å…¶ä¸­ä¸€å°å»æ‰§è¡Œæ‰«æä»»åŠ¡å³å¯ï¼Œè¿™æ—¶å€™å°±éœ€è¦åŠ å…¥åˆ†å¸ƒå¼é”æ¥è¿›è¡Œæ§åˆ¶ã€‚</p>
<h2 id="2.%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">2.åˆ†å¸ƒå¼é”</h2>
<p>åˆ†å¸ƒå¼é”ï¼šæ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰åºçš„å»å¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œï¼Œé€šè¿‡äº’æ–¥æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p id="%E2%80%8B%E7%BC%96%E8%BE%913.redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><img alt="" height="280" src="image\2cfe16aac02f4bbf8e8116dc704a9884.png" width="1105"/></p>
<h2 id="3.redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">3.redisåˆ†å¸ƒå¼é”</h2>
<p>setnx ï¼ˆSet if Not Existsï¼‰ å‘½ä»¤åœ¨æŒ‡å®šçš„ key ä¸å­˜åœ¨æ—¶ï¼Œä¸º key è®¾ç½®æŒ‡å®šçš„å€¼ã€‚</p>
<p id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="315" src="image\b50852fbd18b4b00baadcf728cc3ae88.png" width="1200"/></p>
<p>è¿™ç§åŠ é”çš„æ€è·¯æ˜¯ï¼Œå¦‚æœ key ä¸å­˜åœ¨åˆ™ä¸º key è®¾ç½® valueï¼Œå¦‚æœ key å·²å­˜åœ¨åˆ™ SETNX å‘½ä»¤ä¸åšä»»ä½•æ“ä½œ</p>
<ul><li> <p>å®¢æˆ·ç«¯Aè¯·æ±‚æœåŠ¡å™¨è®¾ç½®keyçš„å€¼ï¼Œå¦‚æœè®¾ç½®æˆåŠŸå°±è¡¨ç¤ºåŠ é”æˆåŠŸ</p> </li><li> <p>å®¢æˆ·ç«¯Bä¹Ÿå»è¯·æ±‚æœåŠ¡å™¨è®¾ç½®keyçš„å€¼ï¼Œå¦‚æœè¿”å›å¤±è´¥ï¼Œé‚£ä¹ˆå°±ä»£è¡¨åŠ é”å¤±è´¥</p> </li><li> <p>å®¢æˆ·ç«¯Aæ‰§è¡Œä»£ç å®Œæˆï¼Œåˆ é™¤é”</p> </li><li> <p>å®¢æˆ·ç«¯Båœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´åå†å»è¯·æ±‚è®¾ç½®keyçš„å€¼ï¼Œè®¾ç½®æˆåŠŸ</p> </li><li> <p>å®¢æˆ·ç«¯Bæ‰§è¡Œä»£ç å®Œæˆï¼Œåˆ é™¤é”</p> </li></ul>
<h2 id="%C2%A04.%E5%AE%9E%E7%8E%B0"> 4.å®ç°</h2>
<h3 id="%EF%BC%881%EF%BC%89%E6%96%B9%E6%B3%95%E6%B7%BB%E5%8A%A0">ï¼ˆ1ï¼‰æ–¹æ³•æ·»åŠ </h3>
<p>åœ¨å·¥å…·ç±»CacheServiceä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<pre><code class="language-java">/**
 * åŠ é”
 *
 * @param name
 * @param expire
 * @return
 */
public String tryLock(String name, long expire) {
    name = name + "_lock";
    String token = UUID.randomUUID().toString();
    RedisConnectionFactory factory = stringRedisTemplate.getConnectionFactory();
    RedisConnection conn = factory.getConnection();
    try {
        //å‚è€ƒrediså‘½ä»¤ï¼š
        //set key value [EX seconds] [PX milliseconds] [NX|XX]
        Boolean result = conn.set(
                name.getBytes(),
                token.getBytes(),
                Expiration.from(expire, TimeUnit.MILLISECONDS),
                RedisStringCommands.SetOption.SET_IF_ABSENT //NX
        );
        if (result != null &amp;&amp; result)
            return token;
    } finally {
        RedisConnectionUtils.releaseConnection(conn, factory,false);
    }
    return null;
}</code></pre>
<p>å‚æ•°nameè¡¨ç¤ºé”çš„åç§°ï¼Œexpireè¡¨ç¤ºé”çš„è¿‡æœŸæ—¶é—´ï¼Œæœ€é‡è¦çš„æ˜¯setæ–¹æ³•ä¸­æœ€åä¸€ä¸ªå‚æ•°RedisStringCommands.SetOption.SET_IF_ABSENTï¼Œè¿™è¡¨ç¤ºå½“æœ‰ä¸€ä¸ªè¯·æ±‚è¿‡æ¥ä¹‹åå°±ä¼šè®¾ç½®keyå€¼è¿›è¡ŒåŠ é”ï¼Œè¿™æ ·å†æœ‰è¯·æ±‚è¿‡æ¥å°±è·å–ä¸åˆ°äº†ã€‚</p>
<h3 id="%EF%BC%882%EF%BC%89%20%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9">ï¼ˆ2ï¼‰ ä»£ç ä¿®æ”¹</h3>
<pre><code class="language-java">/**
 * å®šæ—¶å™¨ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿæ‰«æredisä¸€æ¬¡
 */
@Scheduled(cron = "0 */1 * * * ?")
public void refresh() {
    String token = cacheService.tryLock("FUTURE_TASK_SYNC", 1000 * 30);//åŠ é”ï¼Œ30ç§’è¿‡æœŸ
    if(StringUtils.isNotBlank(token)) {
        log.info("å¼€å§‹æ‰§è¡Œå®šæ—¶æ‰«æredisä»»åŠ¡...");
        
        //è·å–æ‰€æœ‰æœªæ¥æ•°æ®é›†åˆçš„keyå€¼
        Set&lt;String&gt; futureKeys = cacheService.scan(ScheduleConstants.FUTURE + "*");
        for (String futureKey : futureKeys) {
            //æˆªå–ååŠéƒ¨åˆ† future_200_100 --&gt; _200_100
            String topicKey = ScheduleConstants.TOPIC + futureKey.split(ScheduleConstants.FUTURE)[1];
            //è·å–è¯¥ç»„keyä¸‹å½“å‰éœ€è¦æ¸…ç†çš„ä»»åŠ¡æ•°æ®
            Set&lt;String&gt; tasks = cacheService.zRangeByScore(futureKey,0,System.currentTimeMillis());
            if(!tasks.isEmpty()) {
                //å°†è¿™äº›æ•°æ®æ·»åŠ åˆ°æ¶ˆè´¹é˜Ÿåˆ—ä¸­
                cacheService.refreshWithPipeline(futureKey,topicKey,tasks);
                log.info("æˆåŠŸå°†{}ä¸‹çš„å½“å‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°{}",futureKey,topicKey);
            }
        }
    }
}</code></pre>
<h2 id="5.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8C%E6%AD%A5">5.æ•°æ®åº“åŒæ­¥</h2>
<p>åœ¨å®Œæˆä¸Šè¿°æ“ä½œä¹‹åï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯redisä¸­åªæ˜¯å­˜æ”¾ç°åœ¨å°±éœ€è¦å‘å¸ƒå’Œ5åˆ†é’Ÿä¹‹å†…éœ€è¦å‘å¸ƒçš„æ–‡ç« ï¼Œè€Œé‚£äº›è¶…è¿‡5åˆ†é’Ÿä¹‹åæ‰éœ€è¦å‘å¸ƒçš„æ–‡ç« ï¼ˆæ¯”å¦‚ä¸€å¤©ä¹‹åå‘å¸ƒï¼‰æˆ‘ä»¬æ˜¯ä¸å°†å…¶å­˜å…¥redisä¸­çš„ï¼Œå®ƒä»¬åªæ˜¯å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶å€™å°±éœ€è¦å®šæ—¶å»æ‰«ææ•°æ®åº“æŸ¥çœ‹å“ªäº›æ–‡ç« éœ€è¦è¢«æ”¾å…¥redisè¿›è¡Œå¤„ç†ï¼Œæµç¨‹å›¾è¿˜å¯ä»¥å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« çš„ï¼š</p>
<p><img alt="" height="493" src="image\02b008b35f2949568e53e99038dfdbb0.png" width="1058"/></p>
<pre><code class="language-java">/**
 * æ•°æ®åº“åŒæ­¥ä»»åŠ¡ï¼Œæ¯äº”åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
 */
@PostConstruct  //è¡¨ç¤ºæœåŠ¡ä¸€å¯åŠ¨ä¾¿æ‰§è¡Œä¸€æ¬¡
@Scheduled(cron = "0 */5 * * * ?")
public void reloadData() {
    log.info("å¼€å§‹åŒæ­¥æ•°æ®åº“ä»»åŠ¡åˆ°redis...");
    //1.æ¸…ç†ç¼“å­˜ä»»åŠ¡ï¼Œé¿å…é‡å¤
    clearCache();

    //2.è·å–5åˆ†é’Ÿä¹‹åçš„æ—¶é—´
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.MINUTE,5);
    
    //3.æŸ¥çœ‹æœªæ¥æ‰€æœ‰å°äº5åˆ†é’Ÿçš„ä»»åŠ¡
    List&lt;Taskinfo&gt; tasks = taskInfoMapper.selectList
            (Wrappers.&lt;Taskinfo&gt;lambdaQuery().lt(Taskinfo::getExecuteTime, calendar.getTime()));
    if(tasks != null &amp;&amp; tasks.size() &gt; 0) {
        for (Taskinfo taskinfo : tasks) {
            Task task = new Task();
            BeanUtils.copyProperties(taskinfo,task);
            task.setExecuteTime(taskinfo.getExecuteTime().getTime());
            addTaskToCache(task);
        }
    }
}

/**
 * æ¸…ç†ç¼“å­˜ä»»åŠ¡
 */
private void clearCache() {
    log.info("å¼€å§‹æ¸…ç†ç¼“å­˜ä»»åŠ¡...");
    //è·å–ä»»åŠ¡é›†
    Set&lt;String&gt; futureKeys = cacheService.scan(ScheduleConstants.FUTURE + "*");
    Set&lt;String&gt; topicKeys = cacheService.scan(ScheduleConstants.TOPIC + "*");
    cacheService.delete(futureKeys);
    cacheService.delete(topicKeys);
}</code></pre>
<h1 id="%E4%B8%89%EF%BC%9A%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E5%8F%91%E5%B8%83">ä¸‰ï¼šå»¶è¿Ÿé˜Ÿåˆ—å®ç°å®šæ—¶å‘å¸ƒ</h1>
<h2 id="1.%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%A4%96%E6%8E%A5%E5%8F%A3">1.æä¾›å¯¹å¤–æ¥å£</h2>
<p>æä¾›è¿œç¨‹çš„feignæ¥å£ï¼Œåœ¨tbug-headlines-feign-apiç¼–å†™ç±»å¦‚ä¸‹ï¼š  </p>
<pre><code class="language-java">package com.my.apis.schedule;

import com.my.model.common.dtos.ResponseResult;
import com.my.model.schedule.dtos.Task;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;

@FeignClient(value = "headlines-schedule")
public interface IScheduleClient {
    /**
     * æ·»åŠ ä»»åŠ¡
     * @param task   ä»»åŠ¡å¯¹è±¡
     * @return       ä»»åŠ¡id
     */
    @PostMapping("/api/v1/task/add")
    ResponseResult addTask(@RequestBody Task task);

    /**
     * å–æ¶ˆä»»åŠ¡
     * @param taskId        ä»»åŠ¡id
     * @return              å–æ¶ˆç»“æœ
     */
    @GetMapping("/api/v1/task/cancel/{taskId}")
    ResponseResult cancelTask(@PathVariable("taskId") long taskId);

    /**
     * æŒ‰ç…§ç±»å‹å’Œä¼˜å…ˆçº§æ¥æ‹‰å–ä»»åŠ¡
     * @param type
     * @param priority
     * @return
     */
    @GetMapping("/api/v1/task/poll/{type}/{priority}")
    ResponseResult poll(@PathVariable("type") int type, @PathVariable("priority")  int priority);
}
</code></pre>
<p>åœ¨tbug-headlines-scheduleå¾®æœåŠ¡ä¸‹æä¾›å¯¹åº”çš„å®ç°</p>
<pre><code class="language-java">package com.my.schedule.feign;

import com.my.apis.schedule.IScheduleClient;
import com.my.model.common.dtos.ResponseResult;
import com.my.model.schedule.dtos.Task;
import com.my.schedule.service.TaskService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
public class ScheduleClient implements IScheduleClient {
    @Autowired
    private TaskService taskService;

    /**
     * æ·»åŠ ä»»åŠ¡
     * @param task   ä»»åŠ¡å¯¹è±¡
     * @return       ä»»åŠ¡id
     */
    @Override
    @PostMapping("/api/v1/task/add")
    public ResponseResult addTask(@RequestBody Task task) {
        return ResponseResult.okResult(taskService.addTask(task));
    }

    /**
     * å–æ¶ˆä»»åŠ¡
     * @param taskId        ä»»åŠ¡id
     * @return              å–æ¶ˆç»“æœ
     */
    @Override
    @GetMapping("/api/v1/task/cancel/{taskId}")
    public ResponseResult cancelTask(@PathVariable long taskId) {
        return ResponseResult.okResult(taskService.cancelTask(taskId));
    }


    /**
     * æŒ‰ç…§ç±»å‹å’Œä¼˜å…ˆçº§æ¥æ‹‰å–ä»»åŠ¡
     * @param type
     * @param priority
     * @return
     */
    @Override
    @GetMapping("/api/v1/task/poll/{type}/{priority}")
    public ResponseResult poll(@PathVariable("type") int type,@PathVariable("priority") int priority) {
        return ResponseResult.okResult(taskService.poll(type,priority));
    }
}
</code></pre>
<h2 id="2.%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0">2.å…·ä½“å®ç°</h2>
<h3 id="%EF%BC%881%EF%BC%89%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87">ï¼ˆ1ï¼‰å‰æœŸå‡†å¤‡</h3>
<p>â‘ æšä¸¾ç±»</p>
<pre><code class="language-java">package com.my.model.common.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

@Getter
@AllArgsConstructor
public enum TaskTypeEnum {

    NEWS_SCAN_TIME(1001, 1,"æ–‡ç« å®šæ—¶å®¡æ ¸"),
    REMOTEERROR(1002, 2,"ç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨å¤±è´¥ï¼Œé‡è¯•");
    private final int taskType; //å¯¹åº”å…·ä½“ä¸šåŠ¡
    private final int priority; //ä¸šåŠ¡ä¸åŒçº§åˆ«
    private final String desc; //æè¿°ä¿¡æ¯
}</code></pre>
<p>â‘¡åºåˆ—åŒ–å·¥å…·</p>
<p>        åœ¨æ·»åŠ ä»»åŠ¡åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°åºåˆ—åŒ–å·¥å…·è¿›è¡Œåºåˆ—åŒ–æ“ä½œï¼Œè€Œåœ¨ä»»åŠ¡æ¶ˆè´¹æ—¶å€™åˆéœ€è¦è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚javaå†…ç½®çš„åºåˆ—åŒ–èƒ½å°†å®ç°äº†Serilazableæ¥å£çš„å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘é€‰ç”¨çš„æ˜¯æ•ˆç‡æ›´é«˜çš„Protostuffã€‚Protostuffæ˜¯googleå¼€æºçš„ï¼Œå…¶é‡‡ç”¨æ›´ä¸ºç´§å‡‘çš„äºŒè¿›åˆ¶æ•°ç»„ï¼Œè¡¨ç°æ›´åŠ ä¼˜å¼‚ã€‚</p>
<p>å°†ProtostuffUtilæ‹·è´åˆ°tbug-headlines-utilsä¸­ï¼Œç„¶åå¯¼å…¥å¦‚ä¸‹ä¾èµ–</p>
<pre><code class="language-java">&lt;dependency&gt;
    &lt;groupId&gt;io.protostuff&lt;/groupId&gt;
    &lt;artifactId&gt;protostuff-core&lt;/artifactId&gt;
    &lt;version&gt;1.6.0&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;io.protostuff&lt;/groupId&gt;
    &lt;artifactId&gt;protostuff-runtime&lt;/artifactId&gt;
    &lt;version&gt;1.6.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
<h3 id="%EF%BC%882%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%BB%BB%E5%8A%A1%E5%88%B0%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97">ï¼ˆ2ï¼‰æ·»åŠ ä»»åŠ¡åˆ°å»¶è¿Ÿé˜Ÿåˆ—</h3>
<p>åˆ›å»ºWmNewsTaskService</p>
<pre><code class="language-java">package com.my.wemedia.service;

import java.util.Date;

public interface WmNewsTaskService {
    /**
     * æ·»åŠ ä»»åŠ¡åˆ°å»¶è¿Ÿé˜Ÿåˆ—ä¸­
     * @param id æ–‡ç« id
     * @param publishTime  æ–‡ç« å‘å¸ƒæ—¶é—´
     */
    void addNewsToTask(Integer id, Date publishTime);

    /**
     * æ¶ˆè´¹å»¶è¿Ÿé˜Ÿåˆ—æ•°æ®
     */
    void scanNewsByTask();
}
</code></pre>
<p>å®ç°ç±» </p>
<pre><code class="language-java">package com.my.wemedia.service.impl;

import com.alibaba.fastjson.JSON;
import com.my.apis.schedule.IScheduleClient;
import com.my.common.constans.ScheduleConstants;
import com.my.common.redis.CacheService;
import com.my.model.common.dtos.ResponseResult;
import com.my.model.common.enums.TaskTypeEnum;
import com.my.model.schedule.dtos.Task;
import com.my.model.wemedia.pojos.WmNews;
import com.my.utils.common.ProtostuffUtil;
import com.my.wemedia.service.WmAutoScanService;
import com.my.wemedia.service.WmNewsTaskService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.annotation.Async;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;

import java.util.Calendar;
import java.util.Date;

@Slf4j
@Service
public class WmNewsTaskServiceImpl implements WmNewsTaskService {
    @Autowired
    private IScheduleClient scheduleClient;
    /**
     * æ·»åŠ ä»»åŠ¡åˆ°å»¶è¿Ÿé˜Ÿåˆ—
     * @param id æ–‡ç« id
     * @param publishTime  æ–‡ç« å‘å¸ƒæ—¶é—´
     */
    @Override
    @Async
    public void addNewsToTask(Integer id, Date publishTime) {
        log.info("æ·»åŠ ä»»åŠ¡åˆ°å»¶è¿ŸæœåŠ¡ä¸­---begin");

        Task task = new Task();
        task.setExecuteTime(publishTime.getTime());
        task.setTaskType(TaskTypeEnum.NEWS_SCAN_TIME.getTaskType());
        task.setPriority(TaskTypeEnum.NEWS_SCAN_TIME.getPriority());
        WmNews wmNews = new WmNews();
        wmNews.setId(id);
        task.setParameters(ProtostuffUtil.serialize(wmNews));

        scheduleClient.addTask(task);

        log.info("æ·»åŠ ä»»åŠ¡åˆ°å»¶è¿ŸæœåŠ¡ä¸­---end");
    }
}
</code></pre>
<h3 id="%EF%BC%883%EF%BC%89%E4%BF%AE%E6%94%B9%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E4%BB%A3%E7%A0%81">ï¼ˆ3ï¼‰ä¿®æ”¹å‘å¸ƒæ–‡ç« ä»£ç </h3>
<p>å°†ä¹‹å‰çš„å¼‚æ­¥è°ƒç”¨å®¡æ ¸æ–‡ç« ä¿®æ”¹ä¸ºå°†æ–‡ç« æ•°æ®åŠ å…¥å»¶è¿Ÿé˜Ÿåˆ—</p>
<pre><code class="language-java">    @Autowired
    private WmAutoScanService wmAutoScanService;
    @Autowired
    private WmNewsTaskService wmNewsTaskService;
    /**
     * æäº¤æ–‡ç« 
     * @param dto
     * @return
     */
    @Override
    public ResponseResult submitNews(WmNewsDto dto) throws Exception {
        //1.å‚æ•°æ ¡éªŒ
        if(dto == null || dto.getContent().length() == 0) {
            return ResponseResult.errorResult(AppHttpCodeEnum.PARAM_INVALID);
        }

        //2.ä¿å­˜æˆ–ä¿®æ”¹æ–‡ç« 
        //2.1å±æ€§æ‹·è´
        WmNews wmNews = new WmNews();
        BeanUtils.copyProperties(dto,wmNews);

        //2.2è®¾ç½®å°é¢å›¾ç‰‡
        if(dto.getImages() != null &amp;&amp; dto.getImages().size() != 0) {
            String images = StringUtils.join(dto.getImages(), ",");
            wmNews.setImages(images);
        }

        //2.3å°é¢ç±»å‹ä¸ºè‡ªåŠ¨
        if(dto.getType().equals(WemediaConstants.WM_NEWS_TYPE_AUTO)) {
            wmNews.setType(null);
        }

        saveOrUpdateWmNews(wmNews);

        //3.åˆ¤æ–­æ˜¯å¦ä¸ºè‰ç¨¿
        if(dto.getStatus().equals(WmNews.Status.NORMAL.getCode())) {
            //ç›´æ¥ä¿å­˜ç»“æŸ
            return ResponseResult.okResult(AppHttpCodeEnum.SUCCESS);
        }

        //4.ä¸æ˜¯è‰ç¨¿
        //4.1ä¿å­˜æ–‡ç« å›¾ç‰‡ç´ æä¸æ–‡ç« å…³ç³»
        //4.1.1æå–å›¾ç‰‡ç´ æåˆ—è¡¨
        List&lt;String&gt; imagesList = getImagesList(dto);
        //4.1.2ä¿å­˜
        saveRelatedImages(imagesList,wmNews.getId(),WemediaConstants.WM_CONTENT_REFERENCE);

        //4.2ä¿å­˜å°é¢å›¾ç‰‡å’Œæ–‡ç« å…³ç³»
        saveRelatedCover(dto,imagesList,wmNews);

        //5.å®¡æ ¸æ–‡ç« (å¼‚æ­¥è°ƒç”¨)
        // wmAutoScanService.AutoScanTextAndImage(wmNews.getId());
        //5.å°†ä»»åŠ¡æ·»åŠ åˆ°å»¶è¿ŸæœåŠ¡
        wmNewsTaskService.addNewsToTask(wmNews.getId(),wmNews.getPublishTime());

        return ResponseResult.okResult(AppHttpCodeEnum.SUCCESS);
    }</code></pre>
<h3 id="%EF%BC%884%EF%BC%89%E6%B6%88%E8%B4%B9%E4%BB%BB%E5%8A%A1%E8%BF%9B%E8%A1%8C%E6%96%87%E7%AB%A0%E5%AE%A1%E6%A0%B8">ï¼ˆ4ï¼‰æ¶ˆè´¹ä»»åŠ¡è¿›è¡Œæ–‡ç« å®¡æ ¸</h3>
<p>åœ¨WmNewsTaskServiceImplä¸­æ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<pre><code class="language-java">@Autowired
private WmNewsAutoScanServiceImpl wmNewsAutoScanService;

/**
     * æ¶ˆè´¹å»¶è¿Ÿé˜Ÿåˆ—æ•°æ®
     */
@Scheduled(fixedRate = 1000)
@Override
@SneakyThrows
public void scanNewsByTask() {

    ResponseResult responseResult = scheduleClient.poll(TaskTypeEnum.NEWS_SCAN_TIME.getTaskType(), TaskTypeEnum.NEWS_SCAN_TIME.getPriority());
    if(responseResult.getCode().equals(200) &amp;&amp; responseResult.getData() != null){
        log.info("æ–‡ç« å®¡æ ¸---æ¶ˆè´¹ä»»åŠ¡æ‰§è¡Œ---begin---");

        String json_str = JSON.toJSONString(responseResult.getData());
        Task task = JSON.parseObject(json_str, Task.class);
        byte[] parameters = task.getParameters();
        WmNews wmNews = ProtostuffUtil.deserialize(parameters, WmNews.class);
        System.out.println(wmNews.getId()+"-----------");
        wmNewsAutoScanService.autoScanWmNews(wmNews.getId());

        log.info("æ–‡ç« å®¡æ ¸---æ¶ˆè´¹ä»»åŠ¡æ‰§è¡Œ---end---");

    }
    
}</code></pre>
<p>ä¸‹ç¯‡é¢„å‘Šï¼šå®šæ—¶å‘å¸ƒæ–‡ç« ä¼˜åŒ–ç­–ç•¥</p>
<p> å‹æƒ…é“¾æ¥ï¼š <a class="link-info" href="https://www.nowcoder.com/link/pc_csdncpt_zssj_sf" title="ç‰›å®¢ç½‘  åˆ·é¢˜|é¢è¯•|æ‰¾å·¥ä½œç¥å™¨">ç‰›å®¢ç½‘  åˆ·é¢˜|é¢è¯•|æ‰¾å·¥ä½œç¥å™¨</a></p>
</div>
</div>