<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>æ–‡ç« ç›®å½•</h3>
<ul><li><ul><li><a href="#1_7">1.å•åº“äº‹åŠ¡</a></li><li><a href="#2_43">2.å¤šç§Ÿæˆ·äº‹åŠ¡(å¯è·¨åº“)</a></li><li><a href="#3_47">3.è°ƒè¯•äº‹åŠ¡</a></li><li><a href="#4_59">4.è¯­æ³•ç³–</a></li><li><ul><li><a href="#41__63">4.1 è¯­æ³•ç³–ä¸€</a></li><li><a href="#42__77">4.2 è¯­æ³•ç³–äºŒ</a></li></ul>
</li><li><a href="#5_103">5.è·¨æ–¹æ³•äº‹åŠ¡</a></li><li><a href="#6CAP_106">6.CAPäº‹åŠ¡</a></li><li><a href="#7_109">7.å¼‚æ­¥äº‹åŠ¡</a></li><li><ul><li><a href="#71__113">7.1 ç”¨æ³•ä¸€</a></li><li><a href="#72__136">7.2 ç”¨æ³•äºŒ</a></li></ul>
</li><li><a href="#8_175">8.è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«</a></li><li><ul><li><a href="#81__182">8.1 å•åº“æ¨¡å¼ç”¨æ³•</a></li><li><a href="#82__199">8.2 å¤šç§Ÿæˆ·æ¨¡å¼</a></li></ul>
</li></ul>
</li></ul>
</div>
<br/>
<code>MySqlæ³¨æ„äº‹é¡¹ï¼š</code>
<p></p>
<ul><li>MYSQLä¸æ”¯æŒåˆ›å»ºè¡¨å’Œåˆ é™¤è¡¨å¤„ç†äº‹åŠ¡,åŸç”Ÿäº‹åŠ¡ä¹Ÿä¸€æ ·</li><li>MyISAM å­˜å‚¨å¼•æ“ä¸æ”¯æŒäº‹åŠ¡ éœ€è¦æ”¹æˆ InnoDB</li></ul>
<h2><a id="1_7"></a>1.å•åº“äº‹åŠ¡</h2>
<ul><li>å•åº“äº‹åŠ¡æ˜¯é’ˆä¸€ä¸ªdbæ“ä½œæ‰§è¡Œçš„äº‹åŠ¡ï¼Œæ— è®ºæ˜¯ ISqlSugarClientå’Œ SqlSugarClient ç”¨æ³•éƒ½ä¸€æ ·</li></ul>
<pre><code class="prism language-csharp">    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> Sugar<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                db<span class="token punctuation">.</span>Ado<span class="token punctuation">.</span><span class="token function">BeginTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                db<span class="token punctuation">.</span><span class="token function">Insertable</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Id <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">,</span> Name <span class="token operator">=</span><span class="token string">"hpf"</span><span class="token punctuation">,</span> SchoolId <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                 <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œå›æ»šSql</span>
                 
                db<span class="token punctuation">.</span>Ado<span class="token punctuation">.</span><span class="token function">CommitTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                db<span class="token punctuation">.</span>Ado<span class="token punctuation">.</span><span class="token function">RollbackTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<ul><li>å¦‚æœä¸€ä¸ªdbå°±ä¸€ä¸ªåº“ï¼Œé‚£ä¹ˆä½ ä¹Ÿå¯ä»¥ç”¨å¤šç§Ÿæˆ·äº‹åŠ¡èŠ‚çº¦ä»£ç ï¼Œå› ä¸º2è€…åœ¨ä¸€ä¸ªåº“çš„æƒ…å†µä¸‹ä½œç”¨ä¸€æ ·</li></ul>
<pre><code class="prism language-csharp">db<span class="token punctuation">.</span><span class="token function">BeginTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å»æ‰äº†.ado</span>
db<span class="token punctuation">.</span><span class="token function">CommitTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å»æ‰äº†.ado</span>
db<span class="token punctuation">.</span><span class="token function">RollbackTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//å»æ‰äº†.ado</span>
</code></pre>
<h2><a id="2_43"></a>2.å¤šç§Ÿæˆ·äº‹åŠ¡(å¯è·¨åº“)</h2>
<p>ç›®å‰è¿˜æ²¡æœ‰å­¦ä¹ å¤šç§Ÿæˆ·æœ‰å…³çŸ¥è¯†</p>
<h2><a id="3_47"></a>3.è°ƒè¯•äº‹åŠ¡</h2>
<ul><li>db.ContextIdä» <code>äº‹åŠ¡å¼€å§‹ã€CURDã€äº‹åŠ¡ç»“æŸ</code> å¿…é¡»ä¸€è‡´ è¿™ä¸ªäº‹åŠ¡æ‰ä¼šç”Ÿæ•ˆï¼Œå¦‚æœæ˜¯MYSQLä¹Ÿæ£€æŸ¥ä¸€ä¸‹è¡¨å¼•æ“æ˜¯å¦æ”¯æŒäº‹åŠ¡</li><li>SqlsugarClient å¯ä»¥ç”¨å˜é‡ var db=å¤–éƒ¨Db; æ‰€æœ‰æ“ä½œä½¿ç”¨dbä¿è¯ä¸€è‡´</li><li>SqlsuagrScope ï¼ˆè¯¥å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨å¯¹è±¡ï¼Œå¯ä»¥å•ä¾‹ï¼‰å¯ä»¥ç”¨å•ä¾‹æ¨¡å¼ä¿è¯ä¸€è‡´</li></ul>
<p><strong>é¡¹ç›®è¿è¡Œèµ·æ¥çš„æ—¶å€™ï¼Œåœ¨ç›‘è§†ä¸­æ‰‹åŠ¨è¾“å…¥ db.ContextId ï¼Œä»¥ä¾¿ç›‘æ§å€¼æ˜¯å¦ä¿æŒä¸å˜</strong></p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/53e4546f06714b8e9864ce5797252952.png"/></p>
<h2><a id="4_59"></a>4.è¯­æ³•ç³–</h2>
<p>ç‰¹å®šè¯­æ³•ï¼Œæ–¹ä¾¿å®ç”¨</p>
<h3><a id="41__63"></a>4.1 è¯­æ³•ç³–ä¸€</h3>
<p><code>è¿™ç§é€‚åˆå…¨å±€å¼‚å¸¸ï¼Œç›´æ¥å‡ºé”™æ‰”å‡ºå¹¶ä¸”å›æ»š</code><br/> <strong>è¿™ç§æ–¹å¼æˆ‘æ²¡æµ‹è¯•è¿‡</strong></p>
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> tran <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">UseTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//ä¸šåŠ¡ä»£ç </span>
        <span class="token comment">//é‡Œé¢ç¦æ­¢å†™ tryå¤„ç†äº‹åŠ¡é€»è¾‘ï¼Œæ ¼å¼ä¸€å®šæŒ‰ç°åœ¨çš„é£æ ¼æ¥</span>
 
        tran<span class="token punctuation">.</span><span class="token function">CommitTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">//è¦å†™ tryå¤„ç†å¼‚å¸¸å¯ä»¥å†™åœ¨å¤–é¢</span>
</code></pre>
<h3><a id="42__77"></a>4.2 è¯­æ³•ç³–äºŒ</h3>
<p><code>è¿™ç§é€‚åˆæ²¡æœ‰å¼‚å¸¸å¤„ç†çš„ï¼Œå‡å°‘äº†try å¤„ç†</code></p>
<pre><code class="prism language-csharp">    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> Sugar<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">UseTran</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                db<span class="token punctuation">.</span><span class="token function">Insertable</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Id <span class="token operator">=</span> <span class="token string">"2"</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"hpf"</span><span class="token punctuation">,</span> SchoolId<span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//throw new Exception(); //æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæµ‹è¯•äº‹åŠ¡å›æ»šåŠŸèƒ½</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>Data <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>IsSuccess <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"äº‹åŠ¡æäº¤å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"äº‹åŠ¡æäº¤å®Œæˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
            Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<h2><a id="5_103"></a>5.è·¨æ–¹æ³•äº‹åŠ¡</h2>
<p>ç›®å‰è¿˜æ²¡æœ‰ç”¨åˆ°æœ‰å…³çŸ¥è¯†</p>
<h2><a id="6CAP_106"></a>6.CAPäº‹åŠ¡</h2>
<p>ç›®å‰è¿˜æ²¡æœ‰ç”¨åˆ°æœ‰å…³çŸ¥è¯†</p>
<h2><a id="7_109"></a>7.å¼‚æ­¥äº‹åŠ¡</h2>
<p>è¯·ä¸è¦åœ¨åŒæ­¥æ–¹æ³•é‡Œé¢å†™ä¸‹é¢æ–¹ä»£ç ï¼Œå¿…é¡»æ˜¯å¼‚æ­¥æ–¹æ³•æ‰è¡Œ è¿”å›æ˜¯è¦å¸¦æœ‰Task async</p>
<h3><a id="71__113"></a>7.1 ç”¨æ³•ä¸€</h3>
<pre><code class="prism language-csharp"><span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> Sugar<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                db<span class="token punctuation">.</span><span class="token function">BeginTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">Insertable</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> StudentId<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">,</span>  Name<span class="token operator">=</span><span class="token string">"qwe"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteCommandAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">//throw new Exception(); //æ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ï¼Œæµ‹è¯•äº‹åŠ¡å›æ»šåŠŸèƒ½</span>
                db<span class="token punctuation">.</span><span class="token function">CommitTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                db<span class="token punctuation">.</span><span class="token function">RollbackTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<h3><a id="72__136"></a>7.2 ç”¨æ³•äºŒ</h3>
<p><code>æ³¨æ„ï¼š</code><br/> await db.UseTranAsync å‰é¢çš„awaitä¸è¦æ¼æ‰äº†</p>
<pre><code class="prism language-csharp">    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> Sugar<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> <span class="token function">Test</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token class-name">SqlSugarClient</span> db<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//å¼‚æ­¥äº‹åŠ¡</span>
            <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">UseTranAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">Insertable</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Id <span class="token operator">=</span> <span class="token string">"6"</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"hpf"</span><span class="token punctuation">,</span>SchoolId <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteCommandAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//throw new Exception();    //æ‰‹åŠ¨æ¨¡æ‹ŸæŠ›å¼‚å¸¸</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>Data<span class="token operator">==</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">//è¿”å›å€¼ä¸ºfalse</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>IsSuccess <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> 
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"æ·»åŠ æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> 
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"æ·»åŠ å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">throw</span> result<span class="token punctuation">.</span>ErrorException<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<h2><a id="8_175"></a>8.è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«</h2>
<p>ç›®å‰è¿˜æ²¡æœ‰ç”¨åˆ°æœ‰å…³çŸ¥è¯†</p>
<p><a href="https://blog.csdn.net/eden_tpy/article/details/122401713">ğŸ“„æ–‡æ¡£å‚è€ƒï¼šæ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</a></p>
<h3><a id="81__182"></a>8.1 å•åº“æ¨¡å¼ç”¨æ³•</h3>
<pre><code class="prism language-csharp"><span class="token keyword">try</span>
<span class="token punctuation">{<!-- --></span>
    db<span class="token punctuation">.</span>Ado<span class="token punctuation">.</span><span class="token function">BeginTran</span><span class="token punctuation">(</span>IsolationLevel<span class="token punctuation">.</span>ReadCommitted<span class="token punctuation">)</span><span class="token punctuation">;</span>
         
        <span class="token comment">//ä¸šåŠ¡ä»£ç   </span>
         
    db<span class="token punctuation">.</span>Ado<span class="token punctuation">.</span><span class="token function">CommitTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    db<span class="token punctuation">.</span><span class="token function">RollbackTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="82__199"></a>8.2 å¤šç§Ÿæˆ·æ¨¡å¼</h3>
<pre><code class="prism language-csharp">
 <span class="token class-name"><span class="token keyword">var</span></span> mysqlDb <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">GetConnection</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name"><span class="token keyword">var</span></span> mssqlDb <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">GetConnection</span><span class="token punctuation">(</span><span class="token string">"mssql"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">try</span>
 <span class="token punctuation">{<!-- --></span>
        mysqlDb<span class="token punctuation">.</span>Ado<span class="token punctuation">.</span><span class="token function">BeginTran</span><span class="token punctuation">(</span>IsolationLevel<span class="token punctuation">.</span>ReadCommitted<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯åº“1çš„äº‹åŠ¡</span>
        mssqlDb<span class="token punctuation">.</span>Ado<span class="token punctuation">.</span><span class="token function">BeginTran</span><span class="token punctuation">(</span>IsolationLevel<span class="token punctuation">.</span>ReadCommitted<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯åº“2çš„äº‹åŠ¡</span>
                 
         <span class="token comment">//ä¸šåŠ¡ä»£ç  åªèƒ½ç”¨  mysqlDbå’Œ mssqlDb </span>
 
        db<span class="token punctuation">.</span><span class="token function">CommitTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ³¨æ„ä¸èƒ½ç”¨db.ado.CommitTran</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
        db<span class="token punctuation">.</span><span class="token function">RollbackTran</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p><a href="https://www.donet5.com/home/Doc?typeId=1183">ğŸ“„æ–‡æ¡£å‚è€ƒï¼šæ•°æ®äº‹åŠ¡</a></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>