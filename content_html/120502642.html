<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-tomorrow-night" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4fc3c2f7fd114a179a8427b448176d85.png#pic_center"/></p>
<h1><a id="1_1"></a>1.什么是工作流审批</h1>
<p>根据本人的理解，就是审批流程管理。</p>
<h1><a id="2flowable_5"></a>2.什么是flowable</h1>
<h2><a id="1_6"></a>1.官方解释</h2>
<p>官方解释如下：</p>
<blockquote>
<p>Flowable 项目提供了一套核心的开源业务流程引擎，这些引擎紧凑且高效。它们为开发人员、系统管理员和业务用户提供工作流和业务流程管理 (BPM) 平台。</p>
<p>它的核心是一个闪电般快速、久经考验的动态 BPMN 流程引擎，伴随着 DMN 决策表和 CMMN 案例管理引擎，所有这些引擎都是用 Java 编写的。它们是 Apache 2.0 许可的开放源代码，拥有一个承诺社区。</p>
<p>所有引擎都可以嵌入在 Java 应用程序中运行，也可以作为服务器、集群和云中的服务运行。它们可以作为独立的引擎或服务运行，也可以集成在一起为业务流程管理提供丰富的套件。它们与 Spring 完美集成。凭借丰富的 Java 和 REST API，它们是编排人工或机器人自动化处理的理想基础。它们启用微服务编排或软连接微服务本身。</p>
</blockquote>
<p>这里总结一下:</p>
<ol><li>目的是管理业务审批工作流。</li><li>使用BPMN技术。</li><li>可方便嵌套在spring体系中。</li></ol>
<h2><a id="2_20"></a>2.显赫的家室</h2>
<p>说起flowable还来自于activiti，因为activiti内部工作人员不合，一大堆小伙伴相约出去创业了。但是锅还是原来的锅，只不过做饭的方式不同了。所以在思想上，flowable与activiti相差不大。只不过功能更加强大了。</p>
<h1><a id="3BPMN_23"></a>3.什么是BPMN</h1>
<h2><a id="1BPMN_24"></a>1.解释BPMN</h2>
<p>官方解释如下：</p>
<blockquote>
<p>标准的业务流程模型和符号 (BPMN) 将为企业提供以图形符号理解其内部业务程序的能力，并使组织能够以标准方式交流这些程序。此外，图形符号将有助于理解组织之间的绩效协作和业务交易。这将确保企业了解自身和业务参与者，并使组织能够快速适应新的内部和 B2B 业务环境。</p>
</blockquote>
<p>这里总结一下：</p>
<ol><li>BPMN开发了一套标准的业务流程建模符号。如下图就是建模的符号。</li></ol>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/86486be53e39468f9a6e70bfe0590f47.png"/></p>
<ol start="2"><li>BPMN定义了一个流程图，该流程图使用上述符号编写。如下图就是通过BPMN规则绘画的图。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/978efd387c254dab979e2a05f84f783a.png"/></li></ol>
<blockquote>
<p>说白了如上图规则的图就BPMN流程图。</p>
</blockquote>
<h2><a id="2BPMN_40"></a>2.BPMN常用符号</h2>
<h3><a id="1_41"></a>1.开始节点</h3>
<p>表明从此处开始流程。</p>
<h3><a id="2_44"></a>2.任务节点</h3>
<p>其中包含了很多种任务，如图。其中最常用的就是用户任务。指定审批人都需要此选项。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e2a462a373c94ba4b1bd23f0df62f6cc.png"/></p>
<h3><a id="3_48"></a>3.网关组件</h3>
<p>网关相当于判断（与，或，非），最常用的三种网关分别是互斥/排他网关，并行网关，相容网关。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e98bec3a79b94e1db47e12693af6d522.png"/></p>
<ol><li> <p>互斥网关：相当于判断，举例说明，如果输入值大于20走A节点，小于20走B节点。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d06af4c0e08947a1a8c77c3b6c9ff677.png"/></p> </li><li> <p>并行网关：相容网关成对出现，表示网关中的人全部同意才能够进入下一节点。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a9498979aeef4443877ab3ce236f7e15.png"/><br/> 3 .相容网关：互斥网关与并行网关的结合体，如果满足A,B都互斥条件，则都需要流转，如果只有一个满足，那么只流转满足条件的。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/24e01e1f5d344ad1974351fe342a92cc.png"/></p> </li></ol>
<h2><a id="3_59"></a>3.来个例子</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a6cfb8ef82fb4f82b462a02d5d5d0303.png"/></p>
<p>说明如下：</p>
<ol><li>当审批申请人提交完成后进入审批阶段</li><li>两位项目经理进行审批，需要两人都同意后进入下一节点。</li><li>经理进行审批，此处业务为经理职位（manage）的人都可以执行审批。（此处有认领业务此处不描述）</li><li>此处总经理/董事长审批，如果大于20天需要董事长审批，如果小于20天总经理审批。</li></ol>
<h1><a id="4flowable_68"></a>4.为什么选择flowable</h1>
<p>在技术选择上，flowable较activiti更加新，功能更加完善。以用新不用旧的原则，建议使用flowable。但是相比于activiti来说，他的网上文档非常少。入门也更加困难。</p>
<p>当然可以自己开发审批流系统，设计提交人与审批人字段，通过sql查询可以完成。这种是最费时费力的方法，同时在功能上与开源架构完全没有可比性。而且开源的flowable/activiti已经形成了自己的体系，当与客户侃大山时，更加凸显系统的<code>专业</code>。</p>
<h1><a id="5_74"></a>5.通用的业务流程</h1>
<p>标准的审批流系统都有一套标准化的业务流程下文，介绍如何操作审批流系统。</p>
<h2><a id="1_78"></a>1.整体流程</h2>
<p>业务流程主要分以下步骤：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2384b20360674655af9c873d24fb9ef5.png"/><br/> 一般在系统中的模块名如下，请各自对应。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ec37c9eaaa69450a9a2a8bc1de6e1b00.png"/></p>
<blockquote>
<p>这里的任务管理可以查看到一个流程每个审批节点的具体信息。非必要业务。</p>
</blockquote>
<h3><a id="1_85"></a>1.编辑流程</h3>
<p>这部分主要是制作流程。</p>
<h4><a id="1_87"></a>1.自定义表单</h4>
<p>在申请人进行审批时，需要填写申请的项目和申请数据。如请假审批需要填写请假时间和请假原因。所以这个表单我们希望可以定制。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a82d0c31659e47f09b6a745b6a20f685.png"/></p>
<h4><a id="2_90"></a>2.编辑流程模型</h4>
<p>也就是使用BPMN绘制流程图，在图中会指定该审批流程的表单，下一审批节点人员与进入流程的流转条件。</p>
<p>当然也可以导入流程图。同时可以指定申请人在申请时需要填写的表单。（审批人如果需要添加审批表单也可以在此处配置）<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e6789844d24d4ff5a0d4cc8a2a6149c4.png"/></p>
<h4><a id="3_95"></a>3.部署成流程定义</h4>
<p>流程模型在编辑/导入后，并不会生效。之后发布生成流程定义后才能够使用并发起审批。当然流程定义模块还有导出激活等功能。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/bf47053590d14182bea3d91ce14b902c.png"/></p>
<h3><a id="2_98"></a>2.执行审批</h3>
<h4><a id="1_99"></a>1.功能列表</h4>
<p>当设计完流程之后，就可以发起审批和进行审批了，用户拥有以下功能。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5409436ea09042eba2356810ba48c1de.png"/></p>
<h4><a id="2_102"></a>2.功能解释</h4>
<p>驳回：将审批重置发送给某节点，重新审批。</p>
<p>转办：A转给其B审批，B审批后，进入下一节点。</p>
<p>委派：A转给其B审批，B审批后，转给A，A审批后进入下一节点。</p>
<h3><a id="3_109"></a>3.查询流程实例与任务</h3>
<p>根据上图可见，当发起审批后，就会生成流程实例了。流程实例和任务管理就可以查看到已经发起的审批了。</p>
<ol><li>每一套审批信息生成一条流程实例信息。</li><li>一条流程实例有多个审批节点（流程图中已画），每一个审批节点是一条任务管理信息。</li></ol>
<blockquote>
<p>请注意流程定义和流程实例概念。</p>
</blockquote>
<h1><a id="6_116"></a>6.如何开发</h1>
<p>flowable其实很简单，但是因为市面上的资料比较少，说明白的更加的少，所以该技术栈流通的比较困难。</p>
<p>flowable为我们提供了47张表和7个常用api。</p>
<h2><a id="1_120"></a>1.提供的表</h2>
<p>Flowable的所有数据库表都以ACT_开头。第二部分是说明表用途的两字符标示符。服务API的命名也大略符合这个规则。</p>
<ol><li>ACT_RE_*: 'RE’代表repository。带有这个前缀的表包含“静态”信息，例如流程定义与流程资源（图片、规则等）。</li><li>ACT_RU_*: 'RU’代表runtime。这些表存储运行时信息，例如流程实例（process instance）、用户任务（user task）、变量（variable）、作业（job）等。Flowable只在流程实例运行中保存运行时数据，并在流程实例结束时删除记录。这样保证运行时表小和快。</li><li>ACT_HI_*: 'HI’代表history。这些表存储历史数据，例如已完成的流程实例、变量、任务等。</li><li>ACT_GE_*: 通用数据。在多处使用。</li><li>ACT_ID_*: 表示组织信息，如用户，用户组，等等。（很少使用）</li><li>FLW_*.未找到官方描述，且表中都为空。</li></ol>
<h3><a id="1ACT_GE__128"></a>1.ACT_GE_*</h3>
<p>ACT_GE_BYTEARRAY：保存流程的bpmn的xml以及流程的Image缩略图等信息<br/> ACT_GE_PROPERTY：Flowable相关的基本信息。比如各个module使用的版本信息。</p>
<h3><a id="2ACT_RE__131"></a>2.ACT_RE_*</h3>
<p>ACT_RE_DEPLOYMENT: 部署对象，存储流程名称<br/> ACT_RE_MODEL：基于流程的模型信息<br/> ACT_RE_PROCDEF：流程定义表</p>
<h3><a id="3ACT_RU__135"></a>3.ACT_RU_*</h3>
<p>ACT_RU_ACTINST：运行中实例的活动表<br/> ACT_RU_DEADLETTER_JOB：当JOB执行很多次都无法执行，就会被记录在此表<br/> ACT_RU_ENTITYLINK：还没使用到。后续更新此表。<br/> ACT_RU_EVENT_SUBSCR：运行时的事件<br/> ACT_RU_EXECUTION：运行的实例表<br/> ACT_RU_HISTORY_JOB； 运行中的定时任务历史表<br/> ACT_RU_IDENTITYLINK： 当前任务执行人的信息<br/> ACT_RU_JOB：运行中的异步任务<br/> ACT_RU_SUSPENDED_JOB：暂停的任务表。如果一个异步任务在运行中，被暂停。就会记录在词表<br/> ACT_RU_TASK：运行中的正常节点任务<br/> ACT_RU_TIMER_JOB：定时作业表<br/> ACT_RU_VARIABLE：运行中的流程实例变量</p>
<h3><a id="4ACT_ID__148"></a>4.ACT_ID_*</h3>
<p>ACT_ID_BYTEARRAY：<br/> ACT_ID_GROUP：用户组信息<br/> ACT_ID_INFO：用户详情<br/> ACT_ID_MEMBERSHIP：用户组和用户的关系<br/> ACT_ID_PRIV：权限<br/> ACT_ID_PRIV_MAPPING：用户组和权限之间的关系<br/> ACT_ID_PROPERTY：用户或者用户组属性拓展表<br/> ACT_ID_TOKEN：登录相关日志<br/> ACT_ID_USER：用户</p>
<h3><a id="5ACT_HI__158"></a>5.ACT_HI_*</h3>
<p>ACT_HI_ACTINST: 流程实例历史<br/> ACT_HI_ATTACHMENT：实例的历史附件，几乎不会使用，会加大数据库很大的一个loading<br/> ACT_HI_COMMENT：实例的历史备注<br/> ACT_HI_DETAIL：实例流程详细信息<br/> ACT_HI_IDENTITYLINK: 实例节点中，如果指定了目标人，产生的历史<br/> ACT_HI_PROCINST：流程实例历史<br/> ACT_HI_TASKINST：流程实例的任务历史<br/> ACT_HI_VARINST：流程实例的变量历史</p>
<h3><a id="6FLW__167"></a>6.FLW_*</h3>
<p>FLW_CHANNEL_DEFINITION: 泳池管道定义表<br/> FLW_EVENT_DEFINITION：事件定义<br/> FLW_EVENT_DEPLOYMENT：事件必输<br/> FLW_EVENT_RESOURCE：事件所需资源<br/> FLW_EV_DATABASECHANGELOG：Liquibase执行的记录<br/> FLW_EV_DATABASECHANGELOGLOCK：Liquibase执行锁<br/> FLW_RU_BATCH：暂时未知<br/> FLW_RU_BATCH_PART：暂时未知</p>
<h2><a id="2api_177"></a>2.提供的接口api</h2>
<p>flowable提供了7个常见的api，这些api就对应着上文的所有逻辑，所以只要掌握这些api就可以完成审批业务的开发了。</p>
<h3><a id="1FormService_179"></a>1.FormService</h3>
<p>表单数据的管理。</p>
<pre><code class="prism language-java">formService<span class="token punctuation">.</span><span class="token function">getStartFormKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  获取表单key
formService<span class="token punctuation">.</span><span class="token function">getRenderedStartForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>查询表单json（无数据）
</code></pre>
<h3><a id="2RepositoryService_185"></a>2.RepositoryService</h3>
<p>提供了在编辑和发布审批流程的api。主要是模型管理和流程定义的业务api。</p>
<pre><code class="prism language-java"><span class="token number">1.</span>提供了带条件的查询模型流程定义的api
repositoryService<span class="token punctuation">.</span><span class="token function">createXXXQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
例如：
repositoryService<span class="token punctuation">.</span><span class="token function">createModelQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 模型查询 
repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 流程定义查询

repositoryService<span class="token punctuation">.</span><span class="token function">createXXXXQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">XXXKey</span><span class="token punctuation">(</span>XXX<span class="token punctuation">)</span> （查询该key是否存在）

<span class="token number">2.</span>提供一大波模型与流程定义的通用方法
模型相关
repositoryService<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  （获取模型）
repositoryService<span class="token punctuation">.</span><span class="token function">saveModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  （保存模型）
repositoryService<span class="token punctuation">.</span><span class="token function">deleteModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> （删除模型）
repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> （部署模型）
repositoryService<span class="token punctuation">.</span><span class="token function">getModelEditorSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  （获得模型JSON数据的UTF8字符串）
repositoryService<span class="token punctuation">.</span><span class="token function">getModelEditorSourceExtra</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  （获取PNG格式图像）

<span class="token number">3.</span>流程定义相关
repositoryService<span class="token punctuation">.</span><span class="token function">getProcessDefinition</span><span class="token punctuation">(</span><span class="token class-name">ProcessDefinitionId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  获取流程定义具体信息
repositoryService<span class="token punctuation">.</span><span class="token function">activateProcessDefinitionById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 激活流程定义
repositoryService<span class="token punctuation">.</span><span class="token function">suspendProcessDefinitionById</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  挂起流程定义
repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  删除流程定义
repositoryService<span class="token punctuation">.</span><span class="token function">getProcessDiagram</span><span class="token punctuation">(</span><span class="token punctuation">)</span>获取流程定义图片流
repositoryService<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>获取流程定义xml流
repositoryService<span class="token punctuation">.</span><span class="token function">getBpmnModel</span><span class="token punctuation">(</span>pde<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 获取bpmn对象（当前进行到的那个节点的流程图使用）

<span class="token number">4.</span>流程定义授权相关
repositoryService<span class="token punctuation">.</span><span class="token function">getIdentityLinksForProcessDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 流程定义授权列表
repositoryService<span class="token punctuation">.</span><span class="token function">addCandidateStarterGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>新增组流程授权
repositoryService<span class="token punctuation">.</span><span class="token function">addCandidateStarterUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>新增用户流程授权
repositoryService<span class="token punctuation">.</span><span class="token function">deleteCandidateStarterGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 删除组流程授权
repositoryService<span class="token punctuation">.</span><span class="token function">deleteCandidateStarterUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  删除用户流程授权
</code></pre>
<h3><a id="3RuntimeService_221"></a>3.RuntimeService</h3>
<p>处理正在运行的流程。</p>
<pre><code class="prism language-java">runtimeService<span class="token punctuation">.</span><span class="token function">createProcessInstanceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 发起流程
runtimeService<span class="token punctuation">.</span><span class="token function">deleteProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 删除正在运行的流程
runtimeService<span class="token punctuation">.</span><span class="token function">suspendProcessInstanceById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 挂起流程定义
runtimeService<span class="token punctuation">.</span><span class="token function">activateProcessInstanceById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 激活流程实例
runtimeService<span class="token punctuation">.</span><span class="token function">getVariables</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span> 获取表单中填写的值
runtimeService<span class="token punctuation">.</span><span class="token function">getActiveActivityIds</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">)</span>获取以进行的流程图节点 （当前进行到的那个节点的流程图使用）

runtimeService<span class="token punctuation">.</span><span class="token function">createChangeActivityStateBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">moveExecutionsToSingleActivityId</span><span class="token punctuation">(</span>executionIds<span class="token punctuation">,</span> endId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">changeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 终止流程
</code></pre>
<h3><a id="4HistoryService_233"></a>4.HistoryService</h3>
<p>在用户发起审批后，会生成流程实例。historyService为处理流程实例的api，但是其中包括了已经完成的和未完成的流程实例。</p>
<pre><code class="prism language-java">historyService<span class="token punctuation">.</span><span class="token function">createHistoricProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 查询流程实例列表（历史流程<span class="token punctuation">,</span>包括未完成的）
historyService<span class="token punctuation">.</span><span class="token function">createHistoricProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">foreach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 可以获取历史中表单的信息
historyService<span class="token punctuation">.</span><span class="token function">createHistoricProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 根绝id查询流程实例
historyService<span class="token punctuation">.</span><span class="token function">deleteHistoricProcessInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 删除历史流程
historyService<span class="token punctuation">.</span><span class="token function">deleteHistoricTaskInstance</span><span class="token punctuation">(</span>taskid<span class="token punctuation">)</span><span class="token punctuation">;</span> 删除任务实例
historyService<span class="token punctuation">.</span><span class="token function">createHistoricActivityInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  流程实例节点列表 （当前进行到的那个节点的流程图使用）
</code></pre>
<blockquote>
<p>如果处理正在运行的流程实例，请使用runtimeService。</p>
</blockquote>
<h3><a id="5TaskService_246"></a>5.TaskService</h3>
<p>对流程实例的各个节点的审批处理。</p>
<pre><code class="prism language-java">流转的节点审批
taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 待办任务列表
taskService<span class="token punctuation">.</span><span class="token function">createTaskQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">taskId</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  待办任务详情
taskService<span class="token punctuation">.</span><span class="token function">saveTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span> 修改任务
taskService<span class="token punctuation">.</span><span class="token function">setAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 设置审批人
taskService<span class="token punctuation">.</span><span class="token function">addComment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 设置审批备注
taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 完成当前审批
taskService<span class="token punctuation">.</span><span class="token function">getProcessInstanceComments</span><span class="token punctuation">(</span>processInstanceId<span class="token punctuation">)</span><span class="token punctuation">;</span> 查看任务详情（也就是都经过哪些人的审批，意见是什么）
taskService<span class="token punctuation">.</span><span class="token function">delegateTask</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> delegater<span class="token punctuation">)</span><span class="token punctuation">;</span> 委派任务
taskService<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>认领任务
taskService<span class="token punctuation">.</span><span class="token function">unclaim</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span> 取消认领
taskService<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>taskId<span class="token punctuation">,</span> completeVariables<span class="token punctuation">)</span><span class="token punctuation">;</span> 完成任务

任务授权
taskService<span class="token punctuation">.</span><span class="token function">addGroupIdentityLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span>新增组任务授权
taskService<span class="token punctuation">.</span><span class="token function">addUserIdentityLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 新增人员任务授权
taskService<span class="token punctuation">.</span><span class="token function">deleteGroupIdentityLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 删除组任务授权
taskService<span class="token punctuation">.</span><span class="token function">deleteUserIdentityLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 删除人员任务授权
</code></pre>
<h3><a id="6ManagementService_268"></a>6.ManagementService</h3>
<p>主要是执行自定义命令。</p>
<pre><code class="prism language-java">managementService<span class="token punctuation">.</span><span class="token function">executeCommand</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">classA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  执行classA的内部方法 
</code></pre>
<p>在自定义的方法中可以使用以下方法获取repositoryService。</p>
<pre><code class="prism language-java"><span class="token class-name">ProcessEngineConfiguration</span> processEngineConfiguration <span class="token operator">=</span>
            <span class="token class-name">CommandContextUtil</span><span class="token punctuation">.</span><span class="token function">getProcessEngineConfiguration</span><span class="token punctuation">(</span>commandContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RepositoryService</span> repositoryService <span class="token operator">=</span> processEngineConfiguration<span class="token punctuation">.</span><span class="token function">getRepositoryService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>也可以获取流程定义方法集合 。</p>
<pre><code class="prism language-java"><span class="token class-name">ProcessEngineConfigurationImpl</span> processEngineConfiguration <span class="token operator">=</span>
            <span class="token class-name">CommandContextUtil</span><span class="token punctuation">.</span><span class="token function">getProcessEngineConfiguration</span><span class="token punctuation">(</span>commandContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProcessDefinitionEntityManager</span> processDefinitionEntityManager <span class="token operator">=</span>
            processEngineConfiguration<span class="token punctuation">.</span><span class="token function">getProcessDefinitionEntityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
如findById<span class="token operator">/</span>findLatestProcessDefinitionByKey<span class="token operator">/</span>findLatestProcessDefinitionByKeyAndTenantId等。
</code></pre>
<h3><a id="7IdentityService_287"></a>7.IdentityService</h3>
<p>用于身份信息获取和保存，这里主要是获取身份信息。</p>
<pre><code class="prism language-java">identityService<span class="token punctuation">.</span><span class="token function">createUserQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  获取审批用户的具体信息
identityService<span class="token punctuation">.</span><span class="token function">createGroupQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">groupId</span><span class="token punctuation">(</span>groupId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 获取审批组的具体信息
</code></pre>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>