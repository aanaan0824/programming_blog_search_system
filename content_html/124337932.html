<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p id="main-toc"><strong>目录</strong></p>
<p id="%E5%89%8D%E8%A8%80%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80%EF%BC%9A">前言：</a></p>
<p id="1.%20%E6%9C%80%E4%BD%B3%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99-toc" style="margin-left:0px;"><a href="#1.%20%E6%9C%80%E4%BD%B3%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99">1.最佳左前缀法则</a></p>
<p id="2.%E4%B8%BB%E9%94%AE%E6%8F%92%E5%85%A5%E9%A1%BA%E5%BA%8F-toc" style="margin-left:0px;"><a href="#2.%E4%B8%BB%E9%94%AE%E6%8F%92%E5%85%A5%E9%A1%BA%E5%BA%8F">2.主键插入顺序</a></p>
<p id="3.%20%E8%AE%A1%E7%AE%97%E3%80%81%E5%87%BD%E6%95%B0%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2(%E8%87%AA%E5%8A%A8%E6%88%96%E6%89%8B%E5%8A%A8)%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88-toc" style="margin-left:0px;"><a href="#3.%20%E8%AE%A1%E7%AE%97%E3%80%81%E5%87%BD%E6%95%B0%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%28%E8%87%AA%E5%8A%A8%E6%88%96%E6%89%8B%E5%8A%A8%29%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88">3.计算、函数、类型转换(自动或手动)导致索引失效</a></p>
<p id="4.%E8%8C%83%E5%9B%B4%E6%9D%A1%E4%BB%B6%E5%8F%B3%E8%BE%B9%E7%9A%84%E5%88%97%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88-toc" style="margin-left:0px;"><a href="#4.%E8%8C%83%E5%9B%B4%E6%9D%A1%E4%BB%B6%E5%8F%B3%E8%BE%B9%E7%9A%84%E5%88%97%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88">4.范围条件右边的列索引失效</a></p>
<p id="5.%E4%B8%8D%E7%AD%89%E4%BA%8E(!%3D%20%E6%88%96%E8%80%85%3C%3E)%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88-toc" style="margin-left:0px;"><a href="#5.%E4%B8%8D%E7%AD%89%E4%BA%8E%28!%3D%20%E6%88%96%E8%80%85%3C%3E%29%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88">5.不等于(!= 或者&lt;&gt;)导致索引失效</a></p>
<p id="6.is%20null%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%EF%BC%8Cis%20not%20null%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95-toc" style="margin-left:0px;"><a href="#6.is%20null%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%EF%BC%8Cis%20not%20null%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95">6.is null可以使用索引，is not null无法使用索引</a></p>
<p id="7.%20like%E4%BB%A5%E9%80%9A%E9%85%8D%E7%AC%A6%25%E5%BC%80%E5%A4%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88-toc" style="margin-left:0px;"><a href="#7.%20like%E4%BB%A5%E9%80%9A%E9%85%8D%E7%AC%A6%25%E5%BC%80%E5%A4%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88">7.like以通配符%开头索引失效</a></p>
<p id="8.OR%20%E5%89%8D%E5%90%8E%E5%8F%AA%E8%A6%81%E5%AD%98%E5%9C%A8%E9%9D%9E%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%97%EF%BC%8C%E9%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%C2%A0-toc" style="margin-left:0px;"><a href="#8.OR%20%E5%89%8D%E5%90%8E%E5%8F%AA%E8%A6%81%E5%AD%98%E5%9C%A8%E9%9D%9E%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%97%EF%BC%8C%E9%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%C2%A0">8.OR 前后只要存在非索引的列，都会导致索引失效 </a></p>
<p id="9.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E7%BB%9F%E4%B8%80%E4%BD%BF%E7%94%A8utf8mb4-toc" style="margin-left:0px;"><a href="#9.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E7%BB%9F%E4%B8%80%E4%BD%BF%E7%94%A8utf8mb4">9.数据库和表的字符集统一使用utf8mb4</a></p>
<p id="%E7%89%B9%E5%88%AB%E9%B8%A3%E8%B0%A2%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E7%89%B9%E5%88%AB%E9%B8%A3%E8%B0%A2%EF%BC%9A">特别鸣谢：</a></p>
<hr id="hr-toc"/>
<p></p>
<h1 id="%E5%89%8D%E8%A8%80%EF%BC%9A">前言：</h1>
<p>        MySQL中提高性能的一个最有效的方式是对数据表设计合理的索引。索引提供了高效访问数据的方法，并且加快查询的速度， 因此索引对查询的速度有着至关重要的影响。</p>
<ul><li>使用索引可以快速地定位表中的某条记录，从而提高数据库查询的速度，提高数据库的性能。</li><li>如果查询时没有使用索引，查询语句就会扫描表中的所有记录。在数据量大的情况下，这样查询的速度会很慢。</li></ul>
<p>大多数情况下都（默认）采用<strong>B+ 树</strong>来构建索引。只是空间列类型的索引使<strong>R- 树</strong>，并且<strong>MEMORY 表</strong>还支持<strong>hash</strong> <strong>索引</strong>。其实，用不用索引<strong>最终都是优化器说了算</strong>。</p>
<p>优化器是基于什么的优化器？ 基于cost开销(CostBaseOptimizer) ，它不是基于规则（ Rule-BasedOptimizer），也不是基于语义。怎么样开销小就怎么来。另外， <strong>SQL 语句是否使用索引，跟数据库版本、数据量、数据选择度都有关系</strong>。</p>
<div>
<h1 id="1.%20%E6%9C%80%E4%BD%B3%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99"><span style="color:#34495e;"><strong>1.</strong></span><span style="color:#34495e;"><strong>最佳左前缀法则</strong></span></h1>
<blockquote>
<div>
<div>
<span style="color:#880000;"><strong>拓展：</strong></span>
<span style="color:#880000;"><strong>Alibaba</strong></span>
<span style="color:#880000;"><strong>《</strong></span>
</div>
<div>
<span style="color:#880000;"><strong>Java</strong></span>
<span style="color:#880000;"><strong>开发手册》 </strong></span>
</div>
<div>
<span style="color:#777777;">索引文件具有 </span>
<span style="color:#777777;">B-Tree </span>
<span style="color:#777777;">的最左前缀匹配特性，如果左边的值未确定，那么无法使用此索引。 </span>
</div>
</div>
</blockquote>
</div>
<h1 id="2.%E4%B8%BB%E9%94%AE%E6%8F%92%E5%85%A5%E9%A1%BA%E5%BA%8F"><span style="color:#34495e;"><strong>2.</strong></span><span style="color:#34495e;"><strong>主键插入顺序</strong></span></h1>
<p><img alt="" height="204" src="image\772eb659d11646499acb2dac26306575.png" width="1044"/> <span style="color:#34495e;">如果此时再插入一条主键值为 </span><span style="color:#e96900;">9 </span><span style="color:#34495e;">的记录，那它插入的位置就如下图： </span></p>
<p><img alt="" height="456" src="image\0158ee9bbaa04171a45c570408894bc1.png" width="1046"/></p>
<div>
<span style="color:#34495e;">        可这个数据页已经满了，再插进来咋办呢？我们需要把当前 </span>
<span style="color:#e96900;">页面分裂 </span>
<span style="color:#34495e;">成两个页面，把本页中的一些记录移动到新创建的这个页中。页面分裂和记录移位意味着什么？意味着： </span>
<span style="color:#e96900;">性能损耗 </span>
<span style="color:#34495e;">！所以如果我们想尽量 </span>
<span style="color:#34495e;">避免这样无谓的性能损耗，最好让插入的记录的 </span>
<span style="color:#e96900;">主键值依次递增 </span>
<span style="color:#34495e;">，这样就不会发生这样的性能损耗了。 </span>
</div>
<div>
<span style="color:#34495e;">        所以我们建议：让主键具有 </span>
<span style="color:#e96900;">AUTO_INCREMENT </span>
<span style="color:#34495e;">，让存储引擎自己为表生成主键，</span>
<div>
<span style="color:#34495e;">在插入记录时存储引擎会自动为我们填入自增的主键值。这样的主键占用空间小，顺序写入，减少页分裂。 </span>
</div>
<div></div>
</div>
<h1 id="3.%20%E8%AE%A1%E7%AE%97%E3%80%81%E5%87%BD%E6%95%B0%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2(%E8%87%AA%E5%8A%A8%E6%88%96%E6%89%8B%E5%8A%A8)%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span style="color:#34495e;"><strong>3.</strong></span><span style="color:#34495e;"><strong>计算、函数、类型转换</strong></span><span style="color:#34495e;"><strong>(</strong></span><span style="color:#34495e;"><strong>自动或手动</strong></span><span style="color:#34495e;"><strong>)</strong></span><span style="color:#34495e;"><strong>导致索引失效</strong></span></h1>
<h1 id="4.%E8%8C%83%E5%9B%B4%E6%9D%A1%E4%BB%B6%E5%8F%B3%E8%BE%B9%E7%9A%84%E5%88%97%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span style="color:#34495e;"><strong>4.</strong></span><span style="color:#34495e;"><strong>范围条件右边的列索引失效</strong></span></h1>
<div>
<span style="color:#34495e;"><strong>例子：</strong></span>
</div>
<blockquote>
<div>
<div>
   #创建一个联合索引，
   <span style="color:#fe2c24;">注意字段的顺序</span>
</div>
<div>
<span style="color:#770088;">create index </span>
<span style="color:#34495e;">idx_age_classid_name </span>
<span style="color:#770088;">on </span>
<span style="color:#34495e;">student(age,classid,name);</span>
</div>
<div>
   #执行计划
  </div>
<div>
<span style="color:#770088;">EXPLAIN SELECT SQL_NO_CACHE </span>
<span style="color:#34495e;">* </span>
<span style="color:#770088;">FROM </span>
<span style="color:#34495e;">student </span>
</div>
<div>
<span style="color:#770088;">WHERE </span>
<span style="color:#34495e;">student</span>
<span style="color:#0055aa;">.age</span>
<span style="color:#34495e;">=</span>
<span style="color:#116644;">30 </span>
<span style="color:#770088;">AND </span>
<span style="color:#34495e;">student</span>
<span style="color:#0055aa;">.classId</span>
<span style="color:#34495e;">&gt;</span>
<span style="color:#116644;">20 </span>
<span style="color:#770088;">AND </span>
<span style="color:#34495e;">student</span>
<span style="color:#0055aa;">.name </span>
<span style="color:#34495e;">= </span>
<span style="color:#22a2c9;">'abc' </span>
<span style="color:#34495e;">; </span> 
  </div>
</div>
</blockquote>
<p><img alt="" height="113" src="image\0a362ca2c97d47588be120cd59f8e15b.png" width="1185"/> </p>
<blockquote>
<p>#再创建一个联合索引，与上面的索引对比字段顺序变了</p>
<p><span style="color:#770088;">create index </span><span style="color:#34495e;">idx_age_name_classid </span><span style="color:#770088;">on </span><span style="color:#34495e;">student(age,name,classid);  </span></p>
<p><span style="color:#34495e;">#再执行一模一样的执行计划</span></p>
<div>
<span style="color:#770088;">EXPLAIN SELECT SQL_NO_CACHE </span>
<span style="color:#34495e;">* </span>
<span style="color:#770088;">FROM </span>
<span style="color:#34495e;">student </span>
</div>
<div>
<span style="color:#770088;">WHERE </span>
<span style="color:#34495e;">student</span>
<span style="color:#0055aa;">.age</span>
<span style="color:#34495e;">=</span>
<span style="color:#116644;">30 </span>
<span style="color:#770088;">AND </span>
<span style="color:#34495e;">student</span>
<span style="color:#0055aa;">.classId</span>
<span style="color:#34495e;">&gt;</span>
<span style="color:#116644;">20 </span>
<span style="color:#770088;">AND </span>
<span style="color:#34495e;">student</span>
<span style="color:#0055aa;">.name </span>
<span style="color:#34495e;">= </span>
<span style="color:#22a2c9;">'abc' </span>
<span style="color:#34495e;">;</span>
</div>
</blockquote>
<p><img alt="" height="113" src="image\46fe4d3f21e14698a41619331146700e.png" width="1200"/></p>
<p> 看到两个执行计划虽然都用到了索引，但是：</p>
<ul><li>第一个没用全，只用到了联合索引<span style="color:#34495e;">“idx_age_classid_name” </span>的age和classid。</li><li>第二个把联合索引“<span style="color:#34495e;">idx_age_name_classid</span>”的<span style="color:#34495e;">age，name和classid都用上了。</span></li></ul>
<h1 id="5.%E4%B8%8D%E7%AD%89%E4%BA%8E(!%3D%20%E6%88%96%E8%80%85%3C%3E)%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span style="color:#34495e;"><strong>5.</strong></span><span style="color:#34495e;"><strong>不等于</strong></span><span style="color:#34495e;"><strong>(!= </strong></span><span style="color:#34495e;"><strong>或者</strong></span><span style="color:#34495e;"><strong>&lt;&gt;)</strong></span><span style="color:#34495e;"><strong>导致索引失效 </strong></span></h1>
<div>
<h1 id="6.is%20null%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%EF%BC%8Cis%20not%20null%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span style="color:#34495e;"><strong>6.is null</strong></span><span style="color:#34495e;"><strong>可以使用索引，</strong></span><span style="color:#34495e;"><strong>is not null</strong></span><span style="color:#34495e;"><strong>无法使用索引 </strong></span></h1>
<div>
<h1 id="7.%20like%E4%BB%A5%E9%80%9A%E9%85%8D%E7%AC%A6%25%E5%BC%80%E5%A4%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span style="color:#34495e;"><strong>7.like</strong></span><span style="color:#34495e;"><strong>以通配符</strong></span><span style="color:#34495e;"><strong>%</strong></span><span style="color:#34495e;"><strong>开头索引失效</strong></span></h1>
<blockquote>
<div>
<div>
<span style="color:#880000;"><strong>拓展：</strong></span>
<span style="color:#880000;"><strong>Alibaba</strong></span>
<span style="color:#880000;"><strong>《Java</strong></span>
<span style="color:#880000;"><strong>开发手册》 </strong></span>
</div>
<div>
<span style="color:#777777;">【强制】页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。 </span>
</div>
</div>
</blockquote>
</div>
</div>
<h1 id="8.OR%20%E5%89%8D%E5%90%8E%E5%8F%AA%E8%A6%81%E5%AD%98%E5%9C%A8%E9%9D%9E%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%97%EF%BC%8C%E9%83%BD%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%C2%A0"><span style="color:#34495e;"><strong>8.OR </strong></span><span style="color:#34495e;"><strong>前后只要存在非索引的列，都会导致索引失效  </strong></span></h1>
<div>
<h1 id="9.%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E7%BB%9F%E4%B8%80%E4%BD%BF%E7%94%A8utf8mb4"><span style="color:#34495e;"><strong>9.</strong></span><span style="color:#34495e;"><strong>数据库和表的字符集统一使用utf8mb4 </strong></span></h1>
<div>
<span style="color:#34495e;">        统一使用utf8mb4( 5.5.3</span>
<span style="color:#34495e;">版本以上支持</span>
<span style="color:#34495e;">)</span>
<span style="color:#34495e;">兼容性更好，统一字符集可以避免由于字符集转换产生的乱码。不同的 </span>
<span style="color:#e96900;">字符集 </span>
<span style="color:#34495e;">进行比较前需要进行 </span>
<span style="color:#e96900;">转换 </span>
<span style="color:#34495e;">会造成索引失效。 </span>
</div>
<div></div>
<div>
<h1 id="%E7%89%B9%E5%88%AB%E9%B8%A3%E8%B0%A2%EF%BC%9A">特别鸣谢：</h1>
<p>以上知识来源于“尚硅谷”，宋红康老师的《MySQL数据库教程天花板，mysql安装到mysql高级，强！硬！》系列课程。</p>
<p>所以本文章看不懂的卷王们可以去搜索宋红康老师的mysql系列课程。</p>
</div>
</div>
</div>
</div>