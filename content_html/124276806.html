<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>MiniExcel轻量级开源组件使用</h3>
<ul><li><a href="#_2">开源地址</a></li><li><ul><li><a href="#Excle_14">导入&amp;读取Excle</a></li><li><a href="#_39">实践</a></li><li><a href="#_287">效果</a></li></ul>
</li></ul>
</div>
<p></p>
<h1><a id="_2"></a>开源地址</h1>
<p><a href="https://gitee.com/dotnetchina/MiniExcel">添加链接描述</a><br/> 通常复杂的EXCEL操作采用NPIO组件，优点：性能优越，支持各种复杂操作。缺点：比较繁琐和重量级</p>
<p>MiniExcel:则可以满足大部分应用场景，又是轻量级</p>
<p>Guget:搜MiniExcel安装组件</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0473df04a26d4e218675e8fb5a0b187f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5Y6m6Zeo5b635LuU,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/dfec7bb73e9549c8982baea9510eb904.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5Y6m6Zeo5b635LuU,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h2><a id="Excle_14"></a>导入&amp;读取Excle</h2>
<p>文档简介;<br/> 读/导入 Excel</p>
<ol><li>Query 查询 Excel 返回强型别 IEnumerable 数据 [Try it]</li></ol>
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserAccount</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> ID <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BoD <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Age <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> VIP <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Points <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> rows <span class="token operator">=</span> MiniExcel<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserAccount<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or</span>

<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> stream <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token class-name"><span class="token keyword">var</span></span> rows <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UserAccount<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>一句代码搞定，真TMD爽。</p>
<h2><a id="_39"></a>实践</h2>
<p>前端：</p>
<pre><code class="prism language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-btn<span class="token punctuation">"</span></span> <span class="token attr-name">lay-event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download<span class="token punctuation">"</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-icon<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>下载模板<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-btn<span class="token punctuation">"</span></span> <span class="token attr-name">lay-event</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-icon<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>上传Excel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>javascript:;<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a-upload<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点击这里上传文件
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--表格容器--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-hide<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>currentTableId<span class="token punctuation">"</span></span> <span class="token attr-name">lay-filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>currentTableFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> filename <span class="token operator">=</span> <span class="token string">"品号信息.xlsx"</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'/MinExcel/RequestDownloadFile?filename='</span> <span class="token operator">+</span> filename<span class="token punctuation">;</span>
            window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//刷新表格函数</span>
        <span class="token keyword">function</span> <span class="token function">reloadTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            layui<span class="token punctuation">.</span>table<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token string">'currentTableId'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                page<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    curr<span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">}</span>
                <span class="token punctuation">,</span> where<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    type<span class="token operator">:</span> <span class="token string">"select"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token string">'table'</span><span class="token punctuation">,</span> <span class="token string">'layer'</span><span class="token punctuation">,</span> <span class="token string">'upload'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> $ <span class="token operator">=</span> layui<span class="token punctuation">.</span>jquery<span class="token punctuation">,</span>
                form <span class="token operator">=</span> layui<span class="token punctuation">.</span>form<span class="token punctuation">,</span>
                upload <span class="token operator">=</span> layui<span class="token punctuation">.</span>upload<span class="token punctuation">,</span>
                element <span class="token operator">=</span> layui<span class="token punctuation">.</span>element<span class="token punctuation">,</span>
                layer <span class="token operator">=</span> layui<span class="token punctuation">.</span>layer<span class="token punctuation">,</span>
                table <span class="token operator">=</span> layui<span class="token punctuation">.</span>table<span class="token punctuation">;</span>

            <span class="token comment">//指定允许上传的文件类型</span>
            upload<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                elem<span class="token operator">:</span> <span class="token string">'#upload'</span>
                <span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token string">'/MinExcel/SingleFileUpload'</span> <span class="token comment">//此处配置你自己的上传接口即可</span>
                <span class="token punctuation">,</span> accept<span class="token operator">:</span> <span class="token string">'file'</span> <span class="token comment">//普通文件</span>
                <span class="token punctuation">,</span> exts<span class="token operator">:</span> <span class="token string">'xls|xlsx'</span> <span class="token comment">//只允许上传压缩文件</span>
                <span class="token punctuation">,</span> auto<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">,</span> <span class="token function-variable function">done</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    layer<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">'上传成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>completeFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">//表格数据加载</span>
                    <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">"/MinExcel/GetInvmbs?&amp;path="</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>completeFilePath<span class="token punctuation">;</span>

                    table<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                        elem<span class="token operator">:</span> <span class="token string">'#currentTableId'</span><span class="token punctuation">,</span>
                        url<span class="token operator">:</span> url<span class="token punctuation">,</span>
                        height<span class="token operator">:</span> <span class="token number">650</span><span class="token punctuation">,</span>
                        width<span class="token operator">:</span> <span class="token number">1300</span><span class="token punctuation">,</span>
                        toolbar<span class="token operator">:</span> <span class="token string">'#toolbarDemo'</span><span class="token punctuation">,</span>  <span class="token comment">// 表头工具栏</span>
                        defaultToolbar<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'filter'</span><span class="token punctuation">,</span> <span class="token string">'exports'</span><span class="token punctuation">,</span> <span class="token string">'print'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
                            title<span class="token operator">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
                            layEvent<span class="token operator">:</span> <span class="token string">'LAYTABLE_TIPS'</span><span class="token punctuation">,</span>
                            icon<span class="token operator">:</span> <span class="token string">'layui-icon-tips'</span>

                        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        cols<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
                            <span class="token punctuation">{<!-- --></span> field<span class="token operator">:</span> <span class="token string">'品号'</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'品号'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{<!-- --></span> field<span class="token operator">:</span> <span class="token string">'品名'</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'品名'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{<!-- --></span> field<span class="token operator">:</span> <span class="token string">'规格'</span><span class="token punctuation">,</span> width<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'规格'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        skin<span class="token operator">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span> <span class="token comment">//表格风格 line （行边框风格）row （列边框风格）nob （无边框风格）</span>
                        page<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//开启分页</span>
                        limits<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//每页条数的选择项，默认：[10,20,30,40,50,60,70,80,90]。</span>
                        limit<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token comment">//每页默认显示的数量</span>
                        where<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> type<span class="token operator">:</span> <span class="token string">"select"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//查询时要传递的参数</span>
                        <span class="token function-variable function">parseData</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//res 即为原始返回的数据</span>
                            <span class="token comment">//console.log(res);</span>
                            <span class="token comment">//if (this.page.curr) {<!-- --></span>
                            <span class="token comment">//    result = res.data.slice(this.limit * (this.page.curr - 1), this.limit * this.page.curr);</span>
                            <span class="token comment">//}</span>
                            <span class="token comment">//else {<!-- --></span>
                            <span class="token comment">//    result = res.data.slice(0, this.limit);</span>
                            <span class="token comment">//}</span>
                            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token string">"code"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//res.status, //解析接口状态</span>
                                <span class="token string">"msg"</span><span class="token operator">:</span> res<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">//解析提示文本</span>
                                <span class="token string">"count"</span><span class="token operator">:</span> res<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token comment">//解析数据长度 res.total 改成res.count</span>
                                <span class="token string">"data"</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data <span class="token comment">//解析数据列表</span>
                            <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token punctuation">,</span> <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//请求异常回调</span>
                    layer<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>




        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Controller:</p>
<pre><code class="prism language-csharp">    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MinExcelController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IWebHostEnvironment</span> _webHostingEnvironment<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">MinExcelController</span><span class="token punctuation">(</span><span class="token class-name">IWebHostEnvironment</span> hostingEnvironment<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            _webHostingEnvironment <span class="token operator">=</span> hostingEnvironment<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">RequestDownloadFile</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> filename<span class="token punctuation">)</span> <span class="token comment">//[FromBody] dynamic Json</span>
        <span class="token punctuation">{<!-- --></span>

            <span class="token class-name"><span class="token keyword">var</span></span> FileName <span class="token operator">=</span> filename<span class="token punctuation">;</span> 
            <span class="token class-name"><span class="token keyword">var</span></span> webRootPath <span class="token operator">=</span> _webHostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> FilePath <span class="token operator">=</span> webRootPath<span class="token operator">+</span><span class="token interpolation-string"><span class="token string">$"/UploadFile/Filetpl/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">FileName</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStreamResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>FilePath<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"application/octet-stream"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> FileDownloadName <span class="token operator">=</span> FileName <span class="token punctuation">}</span><span class="token punctuation">;</span>


        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 单文件上传（ajax，Form表单都适用）</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token punctuation">[</span>CustomAllowAnonymous<span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IActionResult</span> <span class="token function">SingleFileUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> formFile <span class="token operator">=</span> Request<span class="token punctuation">.</span>Form<span class="token punctuation">.</span>Files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//获取请求发送过来的文件</span>

            <span class="token class-name"><span class="token keyword">var</span></span> currentDate <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> webRootPath <span class="token operator">=</span> _webHostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span><span class="token comment">//&gt;&gt;&gt;相当于HttpContext.Current.Server.MapPath("") </span>

            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> filePath <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"/UploadFile/Filetemp/"</span></span><span class="token punctuation">;</span>

                <span class="token comment">//创建每日存储文件夹</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>webRootPath <span class="token operator">+</span> filePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>webRootPath <span class="token operator">+</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>formFile <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//文件后缀</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> fileExtension <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">GetExtension</span><span class="token punctuation">(</span>formFile<span class="token punctuation">.</span>FileName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取文件格式，拓展名</span>

                    <span class="token comment">//判断文件大小</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> fileSize <span class="token operator">=</span> formFile<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fileSize <span class="token operator">&gt;</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">//10M TODO:(1mb=1024X1024b)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{<!-- --></span> isSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> resultMsg <span class="token operator">=</span> <span class="token string">"上传的文件不能大于10M"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//Guid.NewGuid().ToString() </span>
                    <span class="token comment">//保存的文件名称(以名称和保存时间命名)</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> saveName <span class="token operator">=</span> formFile<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> formFile<span class="token punctuation">.</span>FileName<span class="token punctuation">.</span><span class="token function">LastIndexOf</span><span class="token punctuation">(</span><span class="token string character">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> currentDate<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"HHmmss"</span><span class="token punctuation">)</span> <span class="token operator">+</span> fileExtension<span class="token punctuation">;</span>

                    <span class="token comment">//文件保存</span>
                    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> fs <span class="token operator">=</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>webRootPath <span class="token operator">+</span> filePath <span class="token operator">+</span> saveName<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        formFile<span class="token punctuation">.</span><span class="token function">CopyTo</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        fs<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">//完整的文件路径</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> completeFilePath <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> saveName<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{<!-- --></span> isSuccess <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> returnMsg <span class="token operator">=</span> <span class="token string">"上传成功"</span><span class="token punctuation">,</span> completeFilePath <span class="token operator">=</span> completeFilePath <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{<!-- --></span> isSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> resultMsg <span class="token operator">=</span> <span class="token string">"上传失败，未检测上传的文件信息~"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">JsonResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{<!-- --></span> isSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> resultMsg <span class="token operator">=</span> <span class="token string">"文件保存失败，异常信息为："</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span>Message <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 获取excel</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="path"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="page"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="limit"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">ActionResult<span class="token punctuation">&lt;</span>TableData<span class="token punctuation">&gt;</span></span> <span class="token function">GetInvmbs</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> path<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> page<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> limit<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//page =2: 第二页 limit=5 每页5条数据</span>

            <span class="token class-name"><span class="token keyword">var</span></span> JsonData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TableData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//"../UploadFile/Filetemp/品号信息_132013.xlsx"</span>
                <span class="token class-name"><span class="token keyword">var</span></span> webRootPath <span class="token operator">=</span> _webHostingEnvironment<span class="token punctuation">.</span>WebRootPath<span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> FilePath <span class="token operator">=</span> webRootPath <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">path</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> rows <span class="token operator">=</span> MiniExcel<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Query</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Invmb<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>FilePath<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//@"E:\\品号信息.xlsx" 本地地址测试OK</span>
                <span class="token class-name"><span class="token keyword">var</span></span> count <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                JsonData<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                JsonData<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">"数据获取成功"</span><span class="token punctuation">;</span>
                JsonData<span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
                JsonData<span class="token punctuation">.</span>data <span class="token operator">=</span> rows<span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>品号<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Skip</span><span class="token punctuation">(</span>limit <span class="token operator">*</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">DeleteFile</span><span class="token punctuation">(</span>FilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> JsonData<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                JsonData<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                JsonData<span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">"数据获取失败:"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>Message<span class="token punctuation">;</span>
                JsonData<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> JsonData<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 销毁文件</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="path"&gt;&lt;/param&gt;</span>
        <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DeleteFile</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> path<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>File<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Invmb</span>
    <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">public</span> <span class="token keyword">string</span> 品号 <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> 品名 <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">string</span> 规格 <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre>
<h2><a id="_287"></a>效果</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b8db3303b6e74f8a93dafcda6ebb683c.gif#pic_center"/></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>