<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="_0"></a>设计模式概述</h1>
<blockquote>
<p>设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的解决某一类问题的一种编码方案。</p>
</blockquote>
<hr/>
<p></p>
<div class="toc">
<h3>文章目录</h3>
<ul><li><a href="#_0">设计模式概述</a></li><li><a href="#_9">设计模式特点</a></li><li><a href="#_119">一、创建型模式</a></li><li><ul><li><a href="#Factory__120">Factory 模式（工厂模式）</a></li><li><a href="#AbstactFactory__244">AbstactFactory 模式（抽象工厂模式）</a></li><li><a href="#Singleton___425">Singleton 模式（ 单例模式）</a></li><li><a href="#Builder__526">Builder 模式（建造者模式）</a></li><li><a href="#Prototype__711">Prototype 模式（原型模式）</a></li></ul>
</li><li><a href="#_800">二、结构型模式</a></li><li><ul><li><a href="#Bridge__801">Bridge 模式（桥接模式）</a></li><li><a href="#Adapter__954">Adapter 模式（适配器模式）</a></li><li><a href="#Decorator__1046">Decorator 模式（装饰器模式）</a></li><li><a href="#Composite__1196">Composite 模式（组合实体模式）</a></li><li><a href="#Flyweight__1342">Flyweight 模式（享元模式）</a></li><li><a href="#Facade__1447">Facade 模式（外观模式）</a></li><li><a href="#Proxy__1579">Proxy 模式（代理模式）</a></li></ul>
</li><li><a href="#_1660">三、行为模式</a></li><li><ul><li><a href="#Template__1661">Template 模式（模板模式）</a></li><li><a href="#Strategy__1748">Strategy 模式（策略模式）</a></li><li><a href="#State__1837">State 模式（状态模式）</a></li><li><a href="#Observer__2213">Observer 模式(观察者模式)</a></li><li><a href="#Memento__2355">Memento 模式（备忘录模式）</a></li><li><a href="#Mediator__2487">Mediator 模式（中介者模式）</a></li><li><a href="#Command__2669">Command 模式（命令模式）</a></li><li><a href="#Visitor__2846">Visitor 模式（访问者模式）</a></li><li><a href="#Chain_of_Responsibility__2991">Chain of Responsibility 模式（责任链模式）</a></li><li><a href="#Iterator__3188">Iterator 模式（迭代器模式）</a></li><li><a href="#Interpreter__3338">Interpreter 模式（解释器模式）</a></li></ul>
</li><li><a href="#_3452">引用</a></li></ul>
</div>
<p></p>
<hr/>
<h1><a id="_9"></a>设计模式特点</h1>
<table><tbody><tr><th>类型</th><th>设计模式</th><th>描述</th></tr><tr><td rowspan="5">创建型</td><td>Factory 模式</td><td>被实例化的子类</td></tr><tr><td>AbstactFactory 模式</td><td>产品对象家族</td></tr><tr><td>Singleton 模式</td><td>针对一个类的唯一实例</td></tr><tr><td> Builder 模式</td><td>如何创建一个组合对象</td></tr><tr><td>Prototype 模式</td><td>针对被实例化的类</td></tr><tr><td rowspan="7">结构型</td><td>Bridge 模式</td><td>对象的实现</td></tr><tr><td>Adapter 模式</td><td>针对对象的接口</td></tr><tr><td>Decorator 模式</td><td>对对象的职责，不生成子类</td></tr><tr><td>Composite 模式</td><td>一个对象的结构和组成</td></tr><tr><td>Flyweight 模式</td><td>对象的存储开销</td></tr><tr><td> Facade 模式</td><td>对一个子系统的接口</td></tr><tr><td> Proxy 模式</td><td>如何访问一个对象；该对象的位置</td></tr><tr><td rowspan="11">行为型</td><td>Template 模式</td><td>对算法中的某些步骤</td></tr><tr><td>Strategy 模式</td><td>算法</td></tr><tr><td>State 模式</td><td>对象的状态</td></tr><tr><td>Observer 模式</td><td>对多个对象依赖于另外一个对象，而这些对象又如何保持一致</td></tr><tr><td>Memento 模式</td><td>对一个对象中哪些私有信息存放在该对象之外，以及在对什么时候进行存储</td></tr><tr><td> Mediator 模式</td><td>对象间怎样交互、和谁交互</td></tr><tr><td> Command 模式</td><td>何时、怎样满足一个请求</td></tr><tr><td> Visitor 模式</td><td>某些可作用于一个（组）对象上的操作，但不修改这些对象的类</td></tr><tr><td> Chain of Responsibility 模式</td><td>满足一个请求的对象链</td></tr><tr><td> Iterator 模式</td><td>如何遍历、访问一个聚合的各元素</td></tr><tr><td>Interpreter 模式</td><td>对一个语言的文法及解释</td></tr></tbody></table>
<h1><a id="_119"></a>一、创建型模式</h1>
<h2><a id="Factory__120"></a>Factory 模式（工厂模式）</h2>
<p><strong>在面向对象系统设计中经常可以遇到以下的两类问题</strong>：</p>
<ul><li>我们经常会抽象出一些类的公共接口以形成抽象基类或者接口。这样我们可以通过声明一个指向基类的指针来指向实际的子类实现，达到了多态的目的。所以就不得不在要用到子类的地方写new 对象。这样实体类的使用者必须知道实际的子类名称，以及会使程序的扩展性和维护变得越来越困难。</li><li>还有一种情况就是在父类中并不知道具体要实例化哪一个具体的子类。只能在父类中写方法调用，具体调用哪一个类的方法交给子类实现。</li></ul>
<p><strong>以上两个问题也就引出了 Factory 模式的两个最重要的功能：<br/> 1）定义创建对象的接口，封装了对象的创建。<br/> 2）使得具体化类的工作延迟到了子类中。</strong></p>
<p><strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1cd04c5ecc444f1f8b5a5ef188e6c3a0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//Product.h </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_PRODUCT_H_ </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_PRODUCT_H_</span> </span>
<span class="token keyword">class</span> <span class="token class-name">Product</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
 
<span class="token keyword">protected</span><span class="token operator">:</span> 
 <span class="token function">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">ConcreteProduct</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Product</span></span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token operator">~</span><span class="token function">ConcreteProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token function">ConcreteProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_PRODUCT_H_</span></span>


<span class="token comment">//Product.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Product.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token class-name">Product</span><span class="token double-colon punctuation">::</span><span class="token function">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 
<span class="token punctuation">}</span> 
<span class="token class-name">Product</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteProduct</span><span class="token double-colon punctuation">::</span><span class="token function">ConcreteProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"ConcreteProduct...."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteProduct</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">ConcreteProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span>

 
<span class="token comment">//Factory.h </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_FACTORY_H_ </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_FACTORY_H_</span> </span>
<span class="token keyword">class</span> <span class="token class-name">Product</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">Factory</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">virtual</span> Product<span class="token operator">*</span> <span class="token function">CreateProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
 <span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token keyword">class</span> <span class="token class-name">ConcreteFactory</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Factory</span></span>
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token operator">~</span><span class="token function">ConcreteFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token function">ConcreteFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 Product<span class="token operator">*</span> <span class="token function">CreateProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_FACTORY_H_ </span></span>

<span class="token comment">//Factory.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Factory.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Product.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token class-name">Factory</span><span class="token double-colon punctuation">::</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Factory</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteFactory</span><span class="token double-colon punctuation">::</span><span class="token function">ConcreteFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"ConcreteFactory....."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteFactory</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">ConcreteFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
Product<span class="token operator">*</span> <span class="token class-name">ConcreteFactory</span><span class="token double-colon punctuation">::</span><span class="token function">CreateProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">ConcreteProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 

<span class="token comment">//main.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Factory.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Product.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
Factory<span class="token operator">*</span> fac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
Product<span class="token operator">*</span> p <span class="token operator">=</span> fac<span class="token operator">-&gt;</span><span class="token function">CreateProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre>
<p><strong>总结：</strong></p>
<ul><li>如果为每一个具体的 ConcreteProduct 类的实例化提供一个函数体，那么我们可能不得不在系统中添加了一个方法来处理这个新建的<br/> ConcreteProduct</li><li>可以看出，Factory 模式对于对象的创建给予开发人员提供了很好的实现策略，但是Factory 模式仅仅局限于一类类（就是说<br/> Product 是一类，有一个共同的基类），如果我们要为不同类的类提供一个对象创建的接口，那就要用 AbstractFactory 了。</li></ul>
<hr/>
<h2><a id="AbstactFactory__244"></a>AbstactFactory 模式（抽象工厂模式）</h2>
<p>假如我们要买水果，水果的产地来自中国、日本、美国，每个国家的水果种类都可以分为苹果、香蕉、梨子。作为开发者，我们就不得不创建苹果类（香蕉和梨子类似），然后每种苹果都继承自苹果类。每上架一个国家的苹果我们都要实现一次苹果类，这样就会有成千上万的苹果类需要被创建，AbstractFactory 模式就是用来解决这类问题的：要创建一组相关或者相互依赖的对象。<br/> <strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/218e3c9a30134d4aaf94b0d38d1f3ba9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//抽象工厂模式</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//苹果的抽象</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractApple</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//中国苹果</span>
<span class="token keyword">class</span> <span class="token class-name">ChinaApple</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractApple</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"中国苹果"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//美国苹果</span>
<span class="token keyword">class</span> <span class="token class-name">USAApple</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractApple</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"美国苹果"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//日本苹果</span>
<span class="token keyword">class</span> <span class="token class-name">JapanApple</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractApple</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"日本苹果"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//香蕉的抽象</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractBanana</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//中国香蕉</span>
<span class="token keyword">class</span> <span class="token class-name">ChinaBanana</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractBanana</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"中国香蕉"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//美国香蕉</span>
<span class="token keyword">class</span> <span class="token class-name">USABanana</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractBanana</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"美国香蕉"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//日本香蕉</span>
<span class="token keyword">class</span> <span class="token class-name">JapanBanana</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractBanana</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"日本香蕉"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//鸭梨的抽象</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractPear</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//中国鸭梨</span>
<span class="token keyword">class</span> <span class="token class-name">ChinaPear</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractPear</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"中国鸭梨"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//美国鸭梨</span>
<span class="token keyword">class</span> <span class="token class-name">USAPear</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractPear</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"美国鸭梨"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//日本鸭梨</span>
<span class="token keyword">class</span> <span class="token class-name">JapanPear</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractPear</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"日本鸭梨"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//抽象工厂  针对产品族</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractFactory</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> AbstractApple<span class="token operator">*</span> <span class="token function">CreateApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> AbstractBanana<span class="token operator">*</span> <span class="token function">CreateBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> AbstractPear<span class="token operator">*</span> <span class="token function">CreatePear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//中国工厂</span>
<span class="token keyword">class</span> <span class="token class-name">ChinaFactory</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFactory</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">virtual</span> AbstractApple<span class="token operator">*</span> <span class="token function">CreateApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> ChinaApple<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> AbstractBanana<span class="token operator">*</span> <span class="token function">CreateBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> ChinaBanana<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> AbstractPear<span class="token operator">*</span> <span class="token function">CreatePear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> ChinaPear<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//美国工厂</span>
<span class="token keyword">class</span> <span class="token class-name">USAFactory</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFactory</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">virtual</span> AbstractApple<span class="token operator">*</span> <span class="token function">CreateApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> USAApple<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> AbstractBanana<span class="token operator">*</span> <span class="token function">CreateBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> USABanana<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> AbstractPear<span class="token operator">*</span> <span class="token function">CreatePear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> USAPear<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//日本工厂</span>
<span class="token keyword">class</span> <span class="token class-name">JapanFactory</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFactory</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">virtual</span> AbstractApple<span class="token operator">*</span> <span class="token function">CreateApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> JapanApple<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> AbstractBanana<span class="token operator">*</span> <span class="token function">CreateBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> JapanBanana<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> AbstractPear<span class="token operator">*</span> <span class="token function">CreatePear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> JapanPear<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    AbstractFactory<span class="token operator">*</span> factory <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    AbstractApple<span class="token operator">*</span> apple <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    AbstractBanana<span class="token operator">*</span> Banana <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    AbstractPear<span class="token operator">*</span> Pear <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token comment">//中国工厂</span>
    factory <span class="token operator">=</span> <span class="token keyword">new</span> ChinaFactory<span class="token punctuation">;</span>
    apple <span class="token operator">=</span> factory<span class="token operator">-&gt;</span><span class="token function">CreateApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Banana <span class="token operator">=</span> factory<span class="token operator">-&gt;</span><span class="token function">CreateBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Pear <span class="token operator">=</span> factory<span class="token operator">-&gt;</span><span class="token function">CreatePear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    apple<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Banana<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Pear<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">delete</span> Pear<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> apple<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> Banana<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p><strong>总结：</strong></p>
<ul><li>AbstractFactory 模式和 Factory模式的区别是初学（使用）设计模式时候的一个容易引起困惑的地方。实际上，AbstractFactory模式是为创建一组（有多类）相关或依赖的对象提供创建接口，而 Factory模式是为一类对象提供创建接口或延迟对象的创建到子类中实现。并且可以看到，AbstractFactory模式通常都是使用 Factory 模式实现。</li></ul>
<hr/>
<h2><a id="Singleton___425"></a>Singleton 模式（ 单例模式）</h2>
<p>Singleton 模式是设计模式中最为简单、最为常见、最容易实现，也是最应该熟悉和掌握的模式。Singleton 模式就是一个类只创建一个唯一的对象，即一次创建多次使用。</p>
<p><strong>实现单例模式的步骤：</strong><br/> 1、构造函数私有化<br/> 2、增加静态私有的当前类的指针变量<br/> 3、提供静态对外接口,可以让用户获得单例对象</p>
<p>单例分为懒汉式和饿汉式</p>
<p><strong>懒汉式</strong>：解决了饿汉式内存浪费问题，但是线程不安全的，可以通过互斥量mutex.lock()和mutex.unlock()来解决<br/> <strong>饿汉式</strong>：还没有使用该单例对象，该单例对象就已经被加载到内存了，在对象过多时会造成内存浪费</p>
<p><strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> A<span class="token operator">*</span> <span class="token function">getInstace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token operator">:</span>
    <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        a <span class="token operator">=</span> <span class="token keyword">new</span> A<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> A<span class="token operator">*</span> a<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
A<span class="token operator">*</span> A<span class="token double-colon punctuation">::</span>a <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

<span class="token comment">//懒汉式   对象的创建在第一次调用getInstance函数时创建</span>
<span class="token comment">//懒汉式是线程不安全的</span>
<span class="token keyword">class</span> <span class="token class-name">SingletonLazy</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> SingletonLazy<span class="token operator">*</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pSingleton <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            pSingleton <span class="token operator">=</span> <span class="token keyword">new</span> SingletonLazy<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> pSingleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token function">SingletonLazy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">static</span> SingletonLazy<span class="token operator">*</span> pSingleton<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//在类外面进行初始化</span>
SingletonLazy<span class="token operator">*</span> SingletonLazy<span class="token double-colon punctuation">::</span>pSingleton<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>



<span class="token comment">//饿汉式    对象在程序执行时优先创建</span>
<span class="token comment">//饿汉式是线程安全的</span>
<span class="token keyword">class</span> <span class="token class-name">SingletonHungry</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> SingletonHungry<span class="token operator">*</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> pSingleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">freeSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pSingleton <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">delete</span> pSingleton<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token function">SingletonHungry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">static</span> SingletonHungry<span class="token operator">*</span> pSingleton<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//以下语句将会在main函数运行前执行</span>
SingletonHungry<span class="token operator">*</span> SingletonHungry<span class="token double-colon punctuation">::</span>pSingleton<span class="token operator">=</span><span class="token keyword">new</span> SingletonHungry<span class="token punctuation">;</span>


<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    SingletonLazy<span class="token operator">*</span> p1 <span class="token operator">=</span> <span class="token class-name">SingletonLazy</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    SingletonLazy<span class="token operator">*</span> p2 <span class="token operator">=</span> <span class="token class-name">SingletonLazy</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p1 <span class="token operator">==</span> p2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"单例模式"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"不是单例模式"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    SingletonHungry<span class="token operator">*</span> p3 <span class="token operator">=</span> <span class="token class-name">SingletonHungry</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    SingletonHungry<span class="token operator">*</span> p4 <span class="token operator">=</span> <span class="token class-name">SingletonHungry</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p3 <span class="token operator">==</span> p4<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"单例模式"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"不是单例模式"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong></p>
<ul><li>Singleton 不可以被实例化，因此将其构造函数声明private</li><li>Singleton 模式经常和 Factory（AbstractFactory）模式在一起使用，因为系统中工厂对象一般来说只要一个</li></ul>
<hr/>
<h2><a id="Builder__526"></a>Builder 模式（建造者模式）</h2>
<p>生活中有着很多的Builder的例子，个人觉得大学生活就是一个Builder模式的最好体验：要完成大学教育，一般将大学教育过程分成 4 个学期进行，因此没有学习可以看作是构建完整大学教育的一个部分构建过程，每个人经过这 4 年的（4 个阶段）构建过程得到的最后的结果不一样，因为可能在四个阶段的构建中引入了很多的参数（每个人的机会和际遇不完全相同）</p>
<p>Builder 模式要解决的也正是这样的问题：当我们要创建的对象很复杂的时候（通常是由很多其他的对象组合而成），我们要要复杂对象的创建过程和这个对象的表示（展示）分离开来，这样做的好处就是通过一步步的进行复杂对象的构建，由于在每一步的构造过程中可以引入参数，使得经过相同的步骤创建最后得到的对象的展示不一样。<br/> <strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d5a449bba349450b8831db163d99cbb9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//Product.h </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_PRODUCT_H_ </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_PRODUCT_H_</span> </span>
<span class="token keyword">class</span> <span class="token class-name">Product</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">void</span> <span class="token function">ProducePart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">ProductPart</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">ProductPart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">ProductPart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 ProductPart<span class="token operator">*</span> <span class="token function">BuildPart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_PRODUCT_H_</span></span>


<span class="token comment">//Component.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Component.h"</span> </span>
<span class="token class-name">Component</span><span class="token double-colon punctuation">::</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Component</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Component</span><span class="token double-colon punctuation">::</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">const</span> Component<span class="token operator">&amp;</span>
com<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
Component<span class="token operator">*</span> <span class="token class-name">Component</span><span class="token double-colon punctuation">::</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Component</span><span class="token double-colon punctuation">::</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token keyword">const</span> Component<span class="token operator">&amp;</span> 
com<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span>


<span class="token comment">//Builder.h </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_BUILDER_H_ </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_BUILDER_H_</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">Product</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">Builder</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">BuildPartA</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> 
buildPara<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">BuildPartB</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> 
buildPara<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">BuildPartC</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> 
buildPara<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> Product<span class="token operator">*</span> <span class="token function">GetProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span> 
 <span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">ConcreteBuilder</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Builder</span></span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">ConcreteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">ConcreteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">void</span> <span class="token function">BuildPartA</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> 
buildPara<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">BuildPartB</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> buildPara<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">BuildPartC</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> buildPara<span class="token punctuation">)</span><span class="token punctuation">;</span>
 Product<span class="token operator">*</span> <span class="token function">GetProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_BUILDER_H_</span></span>

<span class="token comment">//Builder.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Builder.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Product.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token class-name">Builder</span><span class="token double-colon punctuation">::</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Builder</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteBuilder</span><span class="token double-colon punctuation">::</span><span class="token function">ConcreteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteBuilder</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">ConcreteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">ConcreteBuilder</span><span class="token double-colon punctuation">::</span><span class="token function">BuildPartA</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> buildPara<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"Step1:Build PartA..."</span><span class="token operator">&lt;&lt;</span>buildPara<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">ConcreteBuilder</span><span class="token double-colon punctuation">::</span><span class="token function">BuildPartB</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> buildPara<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"Step1:Build PartB..."</span><span class="token operator">&lt;&lt;</span>buildPara<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">ConcreteBuilder</span><span class="token double-colon punctuation">::</span><span class="token function">BuildPartC</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> buildPara<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"Step1:Build PartC..."</span><span class="token operator">&lt;&lt;</span>buildPara<span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
Product<span class="token operator">*</span> <span class="token class-name">ConcreteBuilder</span><span class="token double-colon punctuation">::</span><span class="token function">GetProduct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 <span class="token function">BuildPartA</span><span class="token punctuation">(</span><span class="token string">"pre-defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token function">BuildPartB</span><span class="token punctuation">(</span><span class="token string">"pre-defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token function">BuildPartC</span><span class="token punctuation">(</span><span class="token string">"pre-defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment">//Director.h </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_DIRECTOR_H_ </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DIRECTOR_H_</span> </span>
<span class="token keyword">class</span> <span class="token class-name">Builder</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">Director</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">Director</span><span class="token punctuation">(</span>Builder<span class="token operator">*</span> bld<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">Director</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">void</span> <span class="token function">Construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
 Builder<span class="token operator">*</span> _bld<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_DIRECTOR_H_</span></span>


<span class="token comment">//Director.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"director.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Builder.h"</span> </span>
<span class="token class-name">Director</span><span class="token double-colon punctuation">::</span><span class="token function">Director</span><span class="token punctuation">(</span>Builder<span class="token operator">*</span> bld<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
_bld <span class="token operator">=</span> bld<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Director</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Director</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Director</span><span class="token double-colon punctuation">::</span><span class="token function">Construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 _bld<span class="token operator">-&gt;</span><span class="token function">BuildPartA</span><span class="token punctuation">(</span><span class="token string">"user-defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 _bld<span class="token operator">-&gt;</span><span class="token function">BuildPartB</span><span class="token punctuation">(</span><span class="token string">"user-defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 _bld<span class="token operator">-&gt;</span><span class="token function">BuildPartC</span><span class="token punctuation">(</span><span class="token string">"user-defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment">//main.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Builder.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Product.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Director.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
Director<span class="token operator">*</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Director</span><span class="token punctuation">(</span><span class="token keyword">new</span>
<span class="token function">ConcreteBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 d<span class="token operator">-&gt;</span><span class="token function">Construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong></p>
<ul><li>Builder 模式的关键是其中的 Director对象并不直接返回对象，而是通过一步步（BuildPartA，BuildPartB，BuildPartC）来一步步进行对象的创建。</li><li>Builder 模式的示例代码中，BuildPart 的参数是通过客户程序员传入的，这里使用“user-defined”代替，实际的可在 Construct 方法中传入这 3 个参数，这样就可以得到不同的细微差别的复杂对象了。</li></ul>
<p><strong>Builder 模式和 AbstractFactory 模式在功能上很相似，因为都是用来创建大的复杂的对象，它们的区别是Builder 模式强调的是一步步创建对象，并通过相同的创建过程可以获得不同的结果对象，一般来说 Builder 模式中对象不是直接返回的。而在 AbstractFactory 模式中对象是直接返回的，AbstractFactory 模式强调的是为创建多个相互依赖的对象提供一个同一的接口。</strong></p>
<hr/>
<h2><a id="Prototype__711"></a>Prototype 模式（原型模式）</h2>
<p><strong>定义</strong>：Prototype 模式也正是提供了自我复制的功能，就是说新对象的创建可以通过已有对象进行创建。在 C++中拷贝构造函数（Copy Constructor）曾经是很对程序员的噩梦，拷贝又分为浅拷贝和深拷贝</p>
<p><strong>浅拷贝</strong>：将一个对象复制后，基本数据类型的变量都会重新创建，而引用类型，指向的还是原对象所指向的。</p>
<p><strong>深拷贝</strong>：将一个对象复制后，不论是基本数据类型还有引用类型，都是重新创建的。简单来说，就是深复制进行了完全彻底的复制，而浅复制不彻底。clone明显是深复制，clone出来的对象是是不能去影响原型对象的</p>
<p><strong>Prototype 模式提供了一个通过已存在对象进行新对象创建的接口（Clone），Clone接口在 C++中我们将通过拷贝构造函数实现。</strong></p>
<p><strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f564e85815b74094bcd07b6bad0fb4eb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//Prototype.h </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_PROTOTYPE_H_ </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_PROTOTYPE_H_</span> </span>
<span class="token keyword">class</span> <span class="token class-name">Prototype</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Prototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> Prototype<span class="token operator">*</span> <span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
 <span class="token function">Prototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">ConcretePrototype</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Prototype</span></span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token function">ConcretePrototype</span><span class="token punctuation">(</span><span class="token keyword">const</span> 
ConcretePrototype<span class="token operator">&amp;</span> cp<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
Prototype<span class="token operator">*</span> <span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_PROTOTYPE_H_ </span></span>


<span class="token comment">//Prototype.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Prototype.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token class-name">Prototype</span><span class="token double-colon punctuation">::</span><span class="token function">Prototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Prototype</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Prototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
Prototype<span class="token operator">*</span> <span class="token class-name">Prototype</span><span class="token double-colon punctuation">::</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> 
<span class="token punctuation">{<!-- --></span> 
 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token class-name">ConcretePrototype</span><span class="token double-colon punctuation">::</span><span class="token function">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcretePrototype</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcretePrototype</span><span class="token double-colon punctuation">::</span><span class="token function">ConcretePrototype</span><span class="token punctuation">(</span><span class="token keyword">const</span> 
ConcretePrototype<span class="token operator">&amp;</span> cp<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"ConcretePrototype copy ..."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
Prototype<span class="token operator">*</span> <span class="token class-name">ConcretePrototype</span><span class="token double-colon punctuation">::</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">ConcretePrototype</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>


<span class="token comment">//main.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Prototype.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
Prototype<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcretePrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
Prototype<span class="token operator">*</span> p1 <span class="token operator">=</span> p<span class="token operator">-&gt;</span><span class="token function">Clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong></p>
<ul><li>Prototype 模式通过复制原型（Prototype）而获得新对象创建的功能，这里 Prototype本身就是“对象工厂”（因为能够生产对象），实际上 Prototype 模式和 Builder 模式、AbstractFactory模式都是通过一个类（对象实例）来专门负责对象的创建工作（工厂对象），它们之间的区别是：Builder模式重在复杂对象的一步步创建（并不直接返回对象），AbstractFactory 模式重在产生多个相互依赖类的对象，而 Prototype模式重在从自身复制自己创建新类。</li><li>原型模式的本质就是clone，可以解决构建复杂对象的资源消耗问题，能再某些场景中提升构建对象的效率；还有一个重要的用途就是保护性拷贝，可以通过返回一个拷贝对象的形式，实现只读的限制</li></ul>
<hr/>
<h1><a id="_800"></a>二、结构型模式</h1>
<h2><a id="Bridge__801"></a>Bridge 模式（桥接模式）</h2>
<p>假如遇到这样的问题：<br/> 1）客户给了你一个需求，于是使用一个类来实现（A）；</p>
<p>2）客户需求变化，有两个算法实现功能，于是改变设计，我们通过一个抽象的基类，再定义两个具体类实现两个不同的算法（A1 和 A2）；</p>
<p>3）客户又告诉我们说对于不同的操作系统，于是再抽象一个层次，作为一个抽象基类A0，在分别为每个操作系统派生具体类（A00 和 A01，其中 A00 表示原来的类 A）实现不同操作系统上的客户需求，这样我们就有了一共 4 个类。</p>
<p>4）可能用户的需求又有变化，比如说又有了一种新的算法………</p>
<p>5）我们陷入了一个需求变化的郁闷当中，也因此带来了类的迅速膨胀。Bridge 模式则正是解决了这类问题</p>
<p><strong>示例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9793e7e3867349a5902e2c93cf3824fa.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//Abstraction.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_ABSTRACTION_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ABSTRACTION_H_</span></span>
<span class="token keyword">class</span> <span class="token class-name">AbstractionImp</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">Abstraction</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Abstraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
 <span class="token function">Abstraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token keyword">class</span> <span class="token class-name">RefinedAbstraction</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Abstraction</span></span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">RefinedAbstraction</span><span class="token punctuation">(</span>AbstractionImp<span class="token operator">*</span> imp<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">RefinedAbstraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
 AbstractionImp<span class="token operator">*</span> _imp<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_ABSTRACTION_H_</span></span>

<span class="token comment">//Abstraction.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Abstraction.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AbstractionImp.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token class-name">Abstraction</span><span class="token double-colon punctuation">::</span><span class="token function">Abstraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Abstraction</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Abstraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">RefinedAbstraction</span><span class="token double-colon punctuation">::</span><span class="token function">RefinedAbstraction</span><span class="token punctuation">(</span>AbstractionImp<span class="token operator">*</span> imp<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
_imp <span class="token operator">=</span> imp<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">RefinedAbstraction</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">RefinedAbstraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">RefinedAbstraction</span><span class="token double-colon punctuation">::</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 _imp<span class="token operator">-&gt;</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 

<span class="token comment">//AbstractionImp.h </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_ABSTRACTIONIMP_H_ </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ABSTRACTIONIMP_H_</span> </span>
<span class="token keyword">class</span> <span class="token class-name">AbstractionImp</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AbstractionImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
 <span class="token function">AbstractionImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">ConcreteAbstractionImpA</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractionImp</span></span>
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">ConcreteAbstractionImpA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">ConcreteAbstractionImpA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">ConcreteAbstractionImpB</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractionImp</span></span>
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">ConcreteAbstractionImpB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">ConcreteAbstractionImpB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_ABSTRACTIONIMP_H_ </span></span>

<span class="token comment">//AbstractionImp.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AbstractionImp.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token class-name">AbstractionImp</span><span class="token double-colon punctuation">::</span><span class="token function">AbstractionImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">AbstractionImp</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">AbstractionImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">AbstractionImp</span><span class="token double-colon punctuation">::</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"AbstractionImp....imp..."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteAbstractionImpA</span><span class="token double-colon punctuation">::</span><span class="token function">ConcreteAbstractionImpA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteAbstractionImpA</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">ConcreteAbstractionImpA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">ConcreteAbstractionImpA</span><span class="token double-colon punctuation">::</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"ConcreteAbstractionImpA...."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteAbstractionImpB</span><span class="token double-colon punctuation">::</span><span class="token function">ConcreteAbstractionImpB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">ConcreteAbstractionImpB</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">ConcreteAbstractionImpB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">ConcreteAbstractionImpB</span><span class="token double-colon punctuation">::</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 cout<span class="token operator">&lt;&lt;</span><span class="token string">"ConcreteAbstractionImpB...."</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment">//main.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Abstraction.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AbstractionImp.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
AbstractionImp<span class="token operator">*</span> imp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteAbstractionImpA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
Abstraction<span class="token operator">*</span> abs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">RefinedAbstraction</span><span class="token punctuation">(</span>imp<span class="token punctuation">)</span><span class="token punctuation">;</span> 
abs<span class="token operator">-&gt;</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong></p>
<ul><li>桥接模式实现了抽象化与实现化的脱耦。他们两个互相独立，不会影响到对方。</li><li>对于两个独立变化的维度，使用桥接模式再适合不过了。</li><li>分离抽象接口及其实现部分。提高了比继承更好的解决方案</li></ul>
<h2><a id="Adapter__954"></a>Adapter 模式（适配器模式）</h2>
<p>为了完成某项工作购买了一个第三方的库来加快开发。这就带来了一个问题：我们在应用程序中已经设计好了接口，与这个第三方提供的接口不一致，为了使得这些接口不兼容的类（不能在一起工作）可以在一起工作了，Adapter 模式提供了将一个类（第三方库）的接口转化希望的接口。</p>
<p>适配器模式分为类模式和对象模式。</p>
<p><strong>1)采用继承原有接口类的方式</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/fa7ce3fc9a214afb88401fbdb097c403.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>2)采用组合原有接口类的方式</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a32b09cdc5814a7c8c66ceb9e9f9fb42.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 在 Adapter 模式的结构图中可以看到，类模式的 Adapter 采用继承的方式复用 Adaptee的接口，而在对象模式的 Adapter 中我们则采用组合的方式实现 Adaptee 的复用。</p>
<p><strong>代码：</strong>（只演示采用组合的方式）</p>
<pre><code class="prism language-cpp"><span class="token comment">//Adapter.h </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_ADAPTER_H_ </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ADAPTER_H_</span> </span>
<span class="token keyword">class</span> <span class="token class-name">Target</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">Adaptee</span>
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token operator">~</span><span class="token function">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">void</span> <span class="token function">SpecificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">Adapter</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Target</span></span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">Adapter</span><span class="token punctuation">(</span>Adaptee<span class="token operator">*</span> ade<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token operator">~</span><span class="token function">Adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">void</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
 Adaptee<span class="token operator">*</span> _ade<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">//~_ADAPTER_H_ </span></span>


<span class="token comment">//Adapter.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Adapter.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token class-name">Target</span><span class="token double-colon punctuation">::</span><span class="token function">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Target</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Target</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Target</span><span class="token double-colon punctuation">::</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"Target::Request"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Adaptee</span><span class="token double-colon punctuation">::</span><span class="token function">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Adaptee</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Adaptee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Adaptee</span><span class="token double-colon punctuation">::</span><span class="token function">SpecificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"Adaptee::SpecificRequest"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">Adapter</span><span class="token double-colon punctuation">::</span><span class="token function">Adapter</span><span class="token punctuation">(</span>Adaptee<span class="token operator">*</span> ade<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
 <span class="token keyword">this</span><span class="token operator">-&gt;</span>_ade <span class="token operator">=</span> ade<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token class-name">Adapter</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Adapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Adapter</span><span class="token double-colon punctuation">::</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 _ade<span class="token operator">-&gt;</span><span class="token function">SpecificRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>

<span class="token comment">//main.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Adapter.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span> 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
Adaptee<span class="token operator">*</span> ade <span class="token operator">=</span> <span class="token keyword">new</span> Adaptee<span class="token punctuation">;</span>
Target<span class="token operator">*</span> adt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Adapter</span><span class="token punctuation">(</span>ade<span class="token punctuation">)</span><span class="token punctuation">;</span>
 adt<span class="token operator">-&gt;</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre>
<hr/>
<h2><a id="Decorator__1046"></a>Decorator 模式（装饰器模式）</h2>
<p>装饰器模式（Decorator Pattern）允许向一个现有的对象添加新的功能，同时又不改变其结构。</p>
<p>Component（被装饰对象的基类）<br/> 定义一个对象接口，可以给这些对象动态地添加职责。</p>
<p>ConcreteComponent（具体被装饰对象）<br/> 定义一个对象，可以给这个对象添加一些职责。</p>
<p>Decorator（装饰者抽象类）<br/> 维持一个指向Component实例的引用，并定义一个与Component接口一致的接口。</p>
<p>ConcreteDecorator（具体装饰者）<br/> 具体的装饰对象，给内部持有的具体被装饰对象，增加具体的职责。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/dcec75ba52ce49b3987801384cd000ad.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-cpp"><span class="token comment">//装饰器模式:对类的功能进行扩展（代替继承）。可以动态的给类增加功能</span>
<span class="token comment">//我们需要为英雄增加额外的功能或者属性，但是又不能影响Hero类，这个时候就可以考虑装饰器模式</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//抽象的英雄</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractHero</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> mHp<span class="token punctuation">;</span>
	<span class="token keyword">int</span> mMp<span class="token punctuation">;</span>
	<span class="token keyword">int</span> mAt<span class="token punctuation">;</span>
	<span class="token keyword">int</span> mDf<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HeroA</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractHero</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">HeroA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		mHp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		mMp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		mAt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		mDf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"血量："</span> <span class="token operator">&lt;&lt;</span> mHp <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"魔法："</span> <span class="token operator">&lt;&lt;</span> mMp <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"攻击："</span> <span class="token operator">&lt;&lt;</span> mAt <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"防御："</span> <span class="token operator">&lt;&lt;</span> mDf <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//英雄穿上某个装饰物，那么也还是一个英雄</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractEquipment</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractHero</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">AbstractEquipment</span><span class="token punctuation">(</span>AbstractHero<span class="token operator">*</span> hero<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero <span class="token operator">=</span> hero<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	AbstractHero<span class="token operator">*</span> pHero<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//给英雄穿上狂徒铠甲</span>
<span class="token keyword">class</span> <span class="token class-name">KuangtuEquipment</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractEquipment</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">KuangtuEquipment</span><span class="token punctuation">(</span>AbstractHero<span class="token operator">*</span> hero<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">AbstractEquipment</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	<span class="token comment">//增加额外的功能</span>
	<span class="token keyword">void</span> <span class="token function">AddKuangtu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄穿了狂徒之后"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>mHp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero<span class="token operator">-&gt;</span>mHp<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>mMp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero<span class="token operator">-&gt;</span>mMp<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>mAt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero<span class="token operator">-&gt;</span>mAt<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>mDf <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero<span class="token operator">-&gt;</span>mDf<span class="token operator">+</span><span class="token number">30</span><span class="token punctuation">;</span>
		
	<span class="token punctuation">}</span>

	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">AddKuangtu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"血量："</span> <span class="token operator">&lt;&lt;</span> mHp <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"魔法："</span> <span class="token operator">&lt;&lt;</span> mMp <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"攻击："</span> <span class="token operator">&lt;&lt;</span> mAt <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"防御："</span> <span class="token operator">&lt;&lt;</span> mDf <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//无尽之刃</span>
<span class="token keyword">class</span> <span class="token class-name">Wujinzhireng</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractEquipment</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Wujinzhireng</span><span class="token punctuation">(</span>AbstractHero<span class="token operator">*</span> hero<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token function">AbstractEquipment</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	<span class="token comment">//增加额外的功能</span>
	<span class="token keyword">void</span> <span class="token function">AddKuangtu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄穿了无尽之刃后"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>mHp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero<span class="token operator">-&gt;</span>mHp<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>mMp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero<span class="token operator">-&gt;</span>mMp<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>mAt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero<span class="token operator">-&gt;</span>mAt<span class="token operator">+</span><span class="token number">80</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>mDf <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pHero<span class="token operator">-&gt;</span>mDf<span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">AddKuangtu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"血量："</span> <span class="token operator">&lt;&lt;</span> mHp <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"魔法："</span> <span class="token operator">&lt;&lt;</span> mMp <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"攻击："</span> <span class="token operator">&lt;&lt;</span> mAt <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"防御："</span> <span class="token operator">&lt;&lt;</span> mDf <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	AbstractHero<span class="token operator">*</span> hero <span class="token operator">=</span> <span class="token keyword">new</span> HeroA<span class="token punctuation">;</span>
	hero<span class="token operator">-&gt;</span><span class="token function">showStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-------------------"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token comment">//给英雄穿上狂徒</span>
	hero <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">KuangtuEquipment</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">;</span>
	hero<span class="token operator">-&gt;</span><span class="token function">showStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	hero<span class="token operator">-&gt;</span>mAt <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span>
	<span class="token comment">//给英雄装备武器</span>
	hero <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Wujinzhireng</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">;</span>

	hero<span class="token operator">-&gt;</span><span class="token function">showStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong><br/> Decorator 模式除了采用组合的方式取得了比采用继承方式更好的效果，Decorator 模式还给设计带来一种“即用即付”的方式来添加职责。在 OO 设计和分析经常有这样一种情况：为了多态，通过父类指针指向其具体子类，但是这就带来另外一个问题，这样处于高层的父类就承载了太多的特征（方法），并且继承自这个父类的所有子类都不可避免继承了父类的这些接口，但是可能这并不是这个具体子类所需要的。这样父类就太过臃肿了，那么当需要添加一个操作的时候就可以通过Decorator 模式来解决。</p>
<h2><a id="Composite__1196"></a>Composite 模式（组合实体模式）</h2>
<p>将对象组合成树形结构以表示“部分-整体”的层次结构。Composite 使得用户对单个对象和组合对象的使用具有一致性。<br/> <strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/28ac20bd93824900a559c5720cd0320f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//Composite.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">COMPOSITE_H </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COMPOSITE_H</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;list&gt;</span> </span>
<span class="token comment">// 组合中的抽象基类</span>
<span class="token keyword">class</span> <span class="token class-name">Component</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 
 <span class="token comment">// 纯虚函数,只提供接口,没有默认的实现</span>
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
 <span class="token comment">// 虚函数,提供接口,有默认的实现就是什么都不做</span>
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Add</span><span class="token punctuation">(</span>Component<span class="token operator">*</span> pChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Remove</span><span class="token punctuation">(</span>Component<span class="token operator">*</span> pChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">virtual</span> Component<span class="token operator">*</span> <span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> nIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">// 派生自 Component,是其中的叶子组件的基类</span>
<span class="token keyword">class</span> <span class="token class-name">Leaf</span> 
 <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Component</span></span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">Leaf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Leaf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">// 派生自 Component,是其中的含有子件的组件的基类</span>
<span class="token keyword">class</span> <span class="token class-name">Composite</span> 
 <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Component</span></span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">Composite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Composite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Add</span><span class="token punctuation">(</span>Component<span class="token operator">*</span> pChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Remove</span><span class="token punctuation">(</span>Component<span class="token operator">*</span> pChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">virtual</span> Component<span class="token operator">*</span> <span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> nIndex<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
 <span class="token comment">// 采用 list 容器去保存子组件</span>
 std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>Component<span class="token operator">*</span><span class="token operator">&gt;</span> m_ListOfComponent<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//Composite.cpp </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Composite.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span> </span>
<span class="token comment">/*------------------------------------------------------------------- 
 Component 成员函数的实现
-------------------------------------------------------------------*/</span>
<span class="token keyword">void</span> <span class="token class-name">Component</span><span class="token double-colon punctuation">::</span><span class="token function">Add</span><span class="token punctuation">(</span>Component<span class="token operator">*</span> pChild<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Component</span><span class="token double-colon punctuation">::</span><span class="token function">Remove</span><span class="token punctuation">(</span>Component<span class="token operator">*</span> pChild<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span> 
Component<span class="token operator">*</span> <span class="token class-name">Component</span><span class="token double-colon punctuation">::</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> nIndex<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token comment">/*------------------------------------------------------------------- 
 Leaf 成员函数的实现
-------------------------------------------------------------------*/</span>
<span class="token keyword">void</span> <span class="token class-name">Leaf</span><span class="token double-colon punctuation">::</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Operation by leaf\n"</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token comment">/*------------------------------------------------------------------- 
 Composite 成员函数的实现
-------------------------------------------------------------------*/</span>
<span class="token class-name">Composite</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Composite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>Component<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iter1<span class="token punctuation">,</span> iter2<span class="token punctuation">,</span> temp<span class="token punctuation">;</span> 
PDF created with pdfFactory trial version www<span class="token punctuation">.</span>pdffactory<span class="token punctuation">.</span>com
 <span class="token keyword">for</span> <span class="token punctuation">(</span>iter1 <span class="token operator">=</span> m_ListOfComponent<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iter2 <span class="token operator">=</span> m_ListOfComponent<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 iter1 <span class="token operator">!=</span> iter2<span class="token punctuation">;</span> 
 <span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 temp <span class="token operator">=</span> iter1<span class="token punctuation">;</span> 
 <span class="token operator">++</span>iter1<span class="token punctuation">;</span> 
 <span class="token keyword">delete</span> <span class="token punctuation">(</span><span class="token operator">*</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Composite</span><span class="token double-colon punctuation">::</span><span class="token function">Add</span><span class="token punctuation">(</span>Component<span class="token operator">*</span> pChild<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 m_ListOfComponent<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>pChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Composite</span><span class="token double-colon punctuation">::</span><span class="token function">Remove</span><span class="token punctuation">(</span>Component<span class="token operator">*</span> pChild<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>Component<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iter<span class="token punctuation">;</span> 
 iter <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span>m_ListOfComponent<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_ListOfComponent<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">if</span> <span class="token punctuation">(</span>m_ListOfComponent<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> iter<span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 m_ListOfComponent<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
Component<span class="token operator">*</span> <span class="token class-name">Composite</span><span class="token double-colon punctuation">::</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token keyword">int</span> nIndex<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 <span class="token keyword">if</span> <span class="token punctuation">(</span>nIndex <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> nIndex <span class="token operator">&gt;</span> m_ListOfComponent<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
 <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> 
 std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>Component<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iter1<span class="token punctuation">,</span> iter2<span class="token punctuation">;</span> 
 <span class="token keyword">int</span> i<span class="token punctuation">;</span> 
 <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> iter1 <span class="token operator">=</span> m_ListOfComponent<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iter2 <span class="token operator">=</span> m_ListOfComponent<span class="token punctuation">.</span>
<span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 iter1 <span class="token operator">!=</span> iter2<span class="token punctuation">;</span> 
 <span class="token operator">++</span>iter1<span class="token punctuation">,</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> nIndex<span class="token punctuation">)</span> 
 <span class="token keyword">break</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
PDF created with pdfFactory trial version www<span class="token punctuation">.</span>pdffactory<span class="token punctuation">.</span>com
 <span class="token keyword">return</span> <span class="token operator">*</span>iter1<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">Composite</span><span class="token double-colon punctuation">::</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Operation by Composite\n"</span><span class="token punctuation">;</span> 
 std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>Component<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iter1<span class="token punctuation">,</span> iter2<span class="token punctuation">;</span> 
 <span class="token keyword">for</span> <span class="token punctuation">(</span>iter1 <span class="token operator">=</span> m_ListOfComponent<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iter2 <span class="token operator">=</span> m_ListOfComponent<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 iter1 <span class="token operator">!=</span> iter2<span class="token punctuation">;</span> 
 <span class="token operator">++</span>iter1<span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 <span class="token punctuation">(</span><span class="token operator">*</span>iter1<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Composite.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span> </span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 Leaf <span class="token operator">*</span>pLeaf1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Leaf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 Leaf <span class="token operator">*</span>pLeaf2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Leaf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 Composite<span class="token operator">*</span> pComposite <span class="token operator">=</span> <span class="token keyword">new</span> Composite<span class="token punctuation">;</span> 
 pComposite<span class="token operator">-&gt;</span><span class="token function">Add</span><span class="token punctuation">(</span>pLeaf1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 pComposite<span class="token operator">-&gt;</span><span class="token function">Add</span><span class="token punctuation">(</span>pLeaf2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 pComposite<span class="token operator">-&gt;</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 pComposite<span class="token operator">-&gt;</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">delete</span> pComposite<span class="token punctuation">;</span> 
</code></pre>
<hr/>
<h2><a id="Flyweight__1342"></a>Flyweight 模式（享元模式）</h2>
<p>如果一个应用程序使用了太多的对象，就会造成很大的存储开销。特别是对于大量轻量级（细粒度）的对象，比如在文档编辑器的设计过程中，我们如果为没有字母创建一个对象的话，系统可能会因为大量的对象而造成存储开销的浪费。例如一个字母“a”在文档中出现了100000 次，而实际上我们可以让这一万个字母“a”共享一个对象，当然因为在不同的位置可能字母“a”有不同的显示效果（例如字体和大小等设置不同），在这种情况我们可以为将对象的状态分为“外部状态”和“内部状态”，将可以被共享（不会变化）的状态作为内部状态存储在对象中，而外部对象（例如上面提到的字体、大小等）我们可以在适当的时候将外部对象最为参数传递给对象（例如在显示的时候，将字体、大小等信息传递给对象）。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8c7aa428c5c0433a8ffa0723f05be78c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> Flyweight 模式中有一个类似 Factory 模式的对象构造工厂FlyweightFactory，当客户程序员（Client）需要一个对象时候就会向 FlyweightFactory 发出请求对象的消息 GetFlyweight（）消息，FlyweightFactory 拥有一个管理、存储对象的“仓库”（或者叫对象池，vector 实现），GetFlyweight（）消息会遍历对象池中的对象，如果已经存在则直接返回给 Client，否则创建一个新的对象返回给 Client。<br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//Flyweight.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">FLYWEIGHT_H </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FLYWEIGHT_H</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;list&gt;</span> </span>
<span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>string STATE<span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">Flyweight</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Flyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 
 STATE <span class="token function">GetIntrinsicState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span>STATE<span class="token operator">&amp;</span> ExtrinsicState<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token keyword">protected</span><span class="token operator">:</span> 
 <span class="token function">Flyweight</span><span class="token punctuation">(</span><span class="token keyword">const</span> STATE<span class="token operator">&amp;</span> state<span class="token punctuation">)</span> 
 <span class="token operator">:</span><span class="token function">m_State</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 <span class="token punctuation">}</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
 STATE m_State<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">FlyweightFactory</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">FlyweightFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 
 <span class="token operator">~</span><span class="token function">FlyweightFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 Flyweight<span class="token operator">*</span> <span class="token function">GetFlyweight</span><span class="token punctuation">(</span><span class="token keyword">const</span> STATE<span class="token operator">&amp;</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
 std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>Flyweight<span class="token operator">*</span><span class="token operator">&gt;</span> m_listFlyweight<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">ConcreateFlyweight</span> 
 <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Flyweight</span></span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token keyword">public</span><span class="token operator">:</span> 
 <span class="token function">ConcreateFlyweight</span><span class="token punctuation">(</span><span class="token keyword">const</span> STATE<span class="token operator">&amp;</span> state<span class="token punctuation">)</span> 
 <span class="token operator">:</span> <span class="token function">Flyweight</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 <span class="token punctuation">}</span> 
 <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">ConcreateFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> 
 <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Operation</span><span class="token punctuation">(</span>STATE<span class="token operator">&amp;</span> ExtrinsicState<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//Flyweight.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"FlyWeight.h"</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> </span>
<span class="token keyword">inline</span> STATE <span class="token class-name">Flyweight</span><span class="token double-colon punctuation">::</span><span class="token function">GetIntrinsicState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 <span class="token keyword">return</span> m_State<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token class-name">FlyweightFactory</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">FlyweightFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>Flyweight<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iter1<span class="token punctuation">,</span> iter2<span class="token punctuation">,</span> temp<span class="token punctuation">;</span> 
 <span class="token keyword">for</span> <span class="token punctuation">(</span>iter1 <span class="token operator">=</span> m_listFlyweight<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iter2 <span class="token operator">=</span> m_listFlyweight<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 iter1 <span class="token operator">!=</span> iter2<span class="token punctuation">;</span> 
 <span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 temp <span class="token operator">=</span> iter1<span class="token punctuation">;</span> 
 <span class="token operator">++</span>iter1<span class="token punctuation">;</span> 
 <span class="token keyword">delete</span> <span class="token punctuation">(</span><span class="token operator">*</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
 m_listFlyweight<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
Flyweight<span class="token operator">*</span> <span class="token class-name">FlyweightFactory</span><span class="token double-colon punctuation">::</span><span class="token function">GetFlyweight</span><span class="token punctuation">(</span><span class="token keyword">const</span> STATE<span class="token operator">&amp;</span> key<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span>Flyweight<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iter1<span class="token punctuation">,</span> iter2<span class="token punctuation">;</span> 
 <span class="token keyword">for</span> <span class="token punctuation">(</span>iter1 <span class="token operator">=</span> m_listFlyweight<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iter2 <span class="token operator">=</span> m_listFlyweight<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 iter1 <span class="token operator">!=</span> iter2<span class="token punctuation">;</span> 
 <span class="token operator">++</span>iter1<span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>iter1<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetIntrinsicState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> key<span class="token punctuation">)</span> 
 <span class="token punctuation">{<!-- --></span> 
 std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The Flyweight:"</span> <span class="token operator">&lt;&lt;</span> key <span class="token operator">&lt;&lt;</span> <span class="token string">" already exits"</span><span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> 
 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">*</span>iter1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">}</span> 
 <span class="token punctuation">}</span> 
 std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Creating a new Flyweight:"</span> <span class="token operator">&lt;&lt;</span> key <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> 
 Flyweight<span class="token operator">*</span> flyweight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreateFlyweight</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> 
 m_listFlyweight<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>flyweight<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">void</span> <span class="token class-name">ConcreateFlyweight</span><span class="token double-colon punctuation">::</span><span class="token function">Operation</span><span class="token punctuation">(</span>STATE<span class="token operator">&amp;</span> ExtrinsicState<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"FlyWeight.h"</span> </span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
 FlyweightFactory flyweightfactory<span class="token punctuation">;</span> 
 flyweightfactory<span class="token punctuation">.</span><span class="token function">GetFlyweight</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 flyweightfactory<span class="token punctuation">.</span><span class="token function">GetFlyweight</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 flyweightfactory<span class="token punctuation">.</span><span class="token function">GetFlyweight</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre>
<p>**适用性:**一个应用程序使用了大量对象；完全由于使用大量的对象造成很大的存储开销；对象的大多数状态都可变为外部状态；如果删除对象的外部状态，那么可以使用相对较少的共享对象取代外部对象。</p>
<hr/>
<h2><a id="Facade__1447"></a>Facade 模式（外观模式）</h2>
<p><strong>外观模式是一个很重要、平常也用得很多的一个设计模式</strong></p>
<p>实际上在软件系统开发中也经常回会遇到这样的情况，可能你实现了一些接口（模块），而这些接口（模块）都分布在几个类中（比如 A 和 B、C、D）：A 中实现了一些接口，B 中实现一些接口（或者 A 代表一个独立模块，B、C、D 代表另一些独立模块）。然后你的客户程序员（使用你设计的开发人员）只有很少的要知道你的不同接口到底是在那个类中实现的，绝大多数只是想简单的组合你的 A－D 的类的接口，他并不想知道这些接口在哪里实现的。</p>
<p>下面举一个KTV的例子。假如KTV里面有电视机、电灯、音响、DVD、游戏机这些设备。平常KTV包厢里面没人时电灯都是打开的。电视机、音响、游戏机、DVD都是关闭的。当KTV里面有人了那么电灯关闭，其他东西打开。如果要一个一个开和关特别麻烦。这时候就可以使用外观模式，定义一个总开关。</p>
<p><strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//外观模式</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//电视机类</span>
<span class="token keyword">class</span> <span class="token class-name">Television</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"电视机打开"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"电视机关闭"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//灯类</span>
<span class="token keyword">class</span> <span class="token class-name">Light</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"灯打开"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"灯关闭"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//音响</span>
<span class="token keyword">class</span> <span class="token class-name">Audio</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"音响打开"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"音响关闭"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//麦克风</span>
<span class="token keyword">class</span> <span class="token class-name">Microphone</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"麦克风打开"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"麦克风关闭"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//DVD</span>
<span class="token keyword">class</span> <span class="token class-name">DVDplayer</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DVD打开"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DVD关闭"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//游戏机</span>
<span class="token keyword">class</span> <span class="token class-name">GameMachine</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"游戏机打开"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"游戏机关闭"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//外观模式</span>
<span class="token keyword">class</span> <span class="token class-name">KTVMode</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">KTVMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        pTV <span class="token operator">=</span> <span class="token keyword">new</span> Television<span class="token punctuation">;</span>
        pLight <span class="token operator">=</span> <span class="token keyword">new</span> Light<span class="token punctuation">;</span>
        pAudio <span class="token operator">=</span> <span class="token keyword">new</span> Audio<span class="token punctuation">;</span>
        pMicrophone <span class="token operator">=</span> <span class="token keyword">new</span> Microphone<span class="token punctuation">;</span>
        pDvd <span class="token operator">=</span> <span class="token keyword">new</span> DVDplayer<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">onKTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        pTV<span class="token operator">-&gt;</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pLight<span class="token operator">-&gt;</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pAudio<span class="token operator">-&gt;</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pMicrophone<span class="token operator">-&gt;</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pDvd<span class="token operator">-&gt;</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">offKTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        pTV<span class="token operator">-&gt;</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pLight<span class="token operator">-&gt;</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pAudio<span class="token operator">-&gt;</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pMicrophone<span class="token operator">-&gt;</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pDvd<span class="token operator">-&gt;</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token operator">~</span><span class="token function">KTVMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">delete</span> pTV<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> pLight<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> pAudio<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> pMicrophone<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> pDvd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Television<span class="token operator">*</span> pTV<span class="token punctuation">;</span>
    Light<span class="token operator">*</span> pLight<span class="token punctuation">;</span>
    Audio<span class="token operator">*</span> pAudio<span class="token punctuation">;</span>
    Microphone<span class="token operator">*</span> pMicrophone<span class="token punctuation">;</span>
    DVDplayer<span class="token operator">*</span> pDvd<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    KTVMode<span class="token operator">*</span> ktv <span class="token operator">=</span> <span class="token keyword">new</span> KTVMode<span class="token punctuation">;</span>
    <span class="token comment">//KTV包厢来人了</span>
    ktv<span class="token operator">-&gt;</span><span class="token function">onKTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="Proxy__1579"></a>Proxy 模式（代理模式）</h2>
<p>代理模式（Proxy Pattern）是指为其他对象提供一种代理，以控制对这个对象的访问。 代理对象在客服端和目标对象之间起到中介作用。</p>
<p>在生活中，我们经常见到这样的场景，如：租房中介、售票黄牛、婚介、经纪人、快递、 事务代理、非侵入式日志监听等，这些都是代理模式的实际体现</p>
<p><strong>注意事项：</strong><br/> 1、和适配器模式的区别：适配器模式主要改变所考虑对象的接口，而代理模式不能改变所代理类的接口。<br/> 2、和装饰器模式的区别：装饰器模式为了增强功能，而代理模式是为了加以控制。</p>
<p><strong>举例：</strong><br/> 现在有一个操作系统，只需要调用run（）就可以启动操作系统，但是进入操作系统之前必须要进行账户名和密码的认证。认证成功后这个代理才会让你进入操作系统，其中认证的这个过程就是一个代理。</p>
<p><strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//代理模式:提供一种代理来控制其他对象的访问</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AbstractCommonInterface</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//下面是操作系统类</span>
<span class="token keyword">class</span> <span class="token class-name">MySystem</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractCommonInterface</span></span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"系统启动"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//代理： 启动系统必须要权限验证,不是所以的人都可以来启动我的系统,必须要提供用户名和密码</span>
<span class="token keyword">class</span> <span class="token class-name">MySystemProxy</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractCommonInterface</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MySystemProxy</span><span class="token punctuation">(</span>string userName<span class="token punctuation">,</span> string password<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>mUserName <span class="token operator">=</span> userName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>mPassword <span class="token operator">=</span> password<span class="token punctuation">;</span>
        pMySystem <span class="token operator">=</span> <span class="token keyword">new</span> MySystem<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">bool</span> <span class="token function">checkUserNameAndPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mUserName <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> mPassword <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkUserNameAndPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"启动成功"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token operator">-&gt;</span>pMySystem<span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">"用户名或者密码错误,权限不足"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">MySystemProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pMySystem <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">delete</span> pMySystem<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    string mUserName<span class="token punctuation">;</span>
    string mPassword<span class="token punctuation">;</span>
    MySystem<span class="token operator">*</span> pMySystem<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    MySystemProxy<span class="token operator">*</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MySystemProxy</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    proxy<span class="token operator">-&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong><br/> 1、和适配器模式的区别：适配器模式主要改变所考虑对象的接口，而代理模式不能改变所代理类的接口。</p>
<p>2、和装饰器模式的区别：装饰器模式为了增强功能，而代理模式是为了加以控制</p>
<hr/>
<h1><a id="_1660"></a>三、行为模式</h1>
<h2><a id="Template__1661"></a>Template 模式（模板模式）</h2>
<p>在面向对象系统的分析与设计过程中经常会遇到这样一种情况：对于某一个业务逻辑（算法实现）在不同的对象中有不同的细节实现，但是逻辑（算法）的框架（或通用的应用算法）是相同的。Template 提供了这种情况的一个实现框架。Template 模式是采用继承的方式实现这一点：将逻辑（算法）框架放在抽象基类中，并定义好细节的接口，子类中实现细节。</p>
<p><strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d3f049eba5cf43f486950303b80c771f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 假如我们要做饮料，那么我们首先会定义一个做饮料的模板，即煮水-&gt;冲泡-&gt;导入杯中-&gt;加辅助材料，具体煮什么水、冲泡什么东西放到子类中实现。然后定义一个模板方法，当我们要做饮料时就调用这个方法即可。</p>
<p><strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//模板方法模式:在父类中定义一个方法的抽象，由它的子类来实现细节的处理，在子类实现详细的处理算法时并不会改变算法中的执行次序。</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//做饮料模板</span>
<span class="token keyword">class</span> <span class="token class-name">DrinkTemplate</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//煮水</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">BoildWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//冲泡</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//倒入杯中</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">PourInCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//加辅助材料</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">AddSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//模板方法</span>
    <span class="token keyword">void</span> <span class="token function">Make</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">BoildWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">PourInCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">AddSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//做咖啡：  实现做饮料模板</span>
<span class="token keyword">class</span> <span class="token class-name">Coffee</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">DrinkTemplate</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">BoildWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"煮山泉水"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"冲泡咖啡"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">PourInCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"咖啡倒入杯中"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">AddSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"加糖，加牛奶"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//做茶：  实现做饮料模板</span>
<span class="token keyword">class</span> <span class="token class-name">Tea</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">DrinkTemplate</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">BoildWater</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"煮自来水"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Brew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"冲泡铁观音"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">PourInCup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"茶水倒入杯中"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">AddSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"加糖,加大蒜"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Tea<span class="token operator">*</span> tea <span class="token operator">=</span> <span class="token keyword">new</span> Tea<span class="token punctuation">;</span>
    tea<span class="token operator">-&gt;</span><span class="token function">Make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Coffee<span class="token operator">*</span> coffee <span class="token operator">=</span> <span class="token keyword">new</span> Coffee<span class="token punctuation">;</span>
    coffee<span class="token operator">-&gt;</span><span class="token function">Make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p><strong>总结：</strong></p>
<ul><li>可以看到Template模式获得一种反向控制结构效果，这也是面向对象系统的分析和设计中一个原则，依赖倒置原则。其含义就是父类调用子类的操作（高层模块调用低层模块的操作），低层模块实现高层模块声明的接口。这样控制权在父类（高层模块），低层模块反而要依赖高层模块。</li><li>但是也有局限性，因为模板模式采用继承这种强制约束关系，导致复用性不高。假如我接下来要做冷饮，那么Make函数中的煮水操作其实可以省去 直接冲泡即可，但是我们就无法再次使用这个模板了，这样就导致了不能复用子类的实现步骤。</li></ul>
<hr/>
<h2><a id="Strategy__1748"></a>Strategy 模式（策略模式）</h2>
<p>Strategy 模式和 Template 模式要解决的问题是相同（类似）的，都是为了给业务逻辑（算法）具体实现和抽象接口之间的解耦。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4238aca7009b4a979d2e1c5e83977d6c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 简而言之,Strategy 模式是对算法的封装。处理一个问题的时候可能有多种算法,这些算法的接口(输入参数,输出参数等)都是一致的,那么可以考虑采用Strategy 模式对这些算法进行封装,在基类中定义一个函数接口就可以了。</p>
<p><strong>举例：</strong><br/> 假如现在有个英雄需要使用武器对付敌人，武器有两种匕首和AK，那么这么选择使用哪吧武器其实就是一种策略了那么就可以将策略模式分为三部分：</p>
<ul><li>Strategy 策略基类 （抽象武器）</li><li>ConcreteStrategy 具体策略 （使用匕首或AK）</li><li>Context 具体使用策略的对象（英雄）</li></ul>
<p><strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//策略模式 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//抽象武器  策略基类（抽象的策略）</span>
<span class="token keyword">class</span> <span class="token class-name">WeaponStrategy</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">UseWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//具体的策略使用匕首作为武器</span>
<span class="token keyword">class</span> <span class="token class-name">Knife</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">WeaponStrategy</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">UseWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"使用匕首"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//具体的策略使用AK47作为武器</span>
<span class="token keyword">class</span> <span class="token class-name">AK47</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">WeaponStrategy</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">UseWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"使用AK47"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//具体使用策略的角色 </span>
<span class="token keyword">class</span> <span class="token class-name">Character</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    WeaponStrategy<span class="token operator">*</span> pWeapon<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setWeapon</span><span class="token punctuation">(</span>WeaponStrategy<span class="token operator">*</span> pWeapon<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>pWeapon <span class="token operator">=</span> pWeapon<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">ThrowWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>pWeapon<span class="token operator">-&gt;</span><span class="token function">UseWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Character<span class="token operator">*</span> character <span class="token operator">=</span> <span class="token keyword">new</span> Character<span class="token punctuation">;</span>
    WeaponStrategy<span class="token operator">*</span> knife <span class="token operator">=</span> <span class="token keyword">new</span> Knife<span class="token punctuation">;</span>
    WeaponStrategy<span class="token operator">*</span> ak47 <span class="token operator">=</span> <span class="token keyword">new</span> AK47<span class="token punctuation">;</span>

    <span class="token comment">//用匕首当作武器</span>
    character<span class="token operator">-&gt;</span><span class="token function">setWeapon</span><span class="token punctuation">(</span>knife<span class="token punctuation">)</span><span class="token punctuation">;</span>
    character<span class="token operator">-&gt;</span><span class="token function">ThrowWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    character<span class="token operator">-&gt;</span><span class="token function">setWeapon</span><span class="token punctuation">(</span>ak47<span class="token punctuation">)</span><span class="token punctuation">;</span>
    character<span class="token operator">-&gt;</span><span class="token function">ThrowWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">delete</span> ak47<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> knife<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> character<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong><br/> 可以看到Character 类是通过组合WeaponStrategy 的形式调用武器使用的，这就比继承要好得多，因为在面向对象的设计中的有一条很重要的原则就是：<strong>优先使用对象组合，而非类继承。</strong></p>
<p><strong>优点：</strong></p>
<ul><li>算法可以自由切换。</li><li>避免使用多重条件判断。</li><li>扩展性良好。</li></ul>
<p><strong>缺点：</strong></p>
<ul><li>策略类会增多。</li><li>所有策略类都需要对外暴露</li></ul>
<hr/>
<h2><a id="State__1837"></a>State 模式（状态模式）</h2>
<p>每个人、事物在不同的状态下会有不同表现（动作），而一个状态又会在不同的表现下转移到下一个不同的状态（State）。<br/> <strong>主要解决：</strong></p>
<ol><li>当状态数目不是很多的时候，Switch/Case 可能可以搞定。但是当状态数目很多的时候（实际系统中也正是如此），维护一大组的Switch/Case 语句将是一件异常困难并且容易出错的事情。</li><li>状态逻辑和动作实现没有分离。在很多的系统实现中，动作的实现代码直接写在状态的逻辑当中。这带来的后果就是系统的扩展性和维护得不到保证。</li></ol>
<p><strong>举例：</strong><br/> 以抽奖活动为例。<br/> 有四个状态：</p>
<ul><li>【抽奖状态】</li><li>【可以抽奖】</li><li>【发放奖品】</li><li>【奖品已领完】</li></ul>
<p>抽奖活动的初始状态为【不能抽奖】状态，在扣除50积分后进入【可以抽奖】状态，【可以抽奖】状态有90%的几率不中奖，不中奖就会回到【抽奖状态】，10%的几率中奖，中奖后进入【发放奖品】状态，当奖品数量为0是进入【奖品已领完】状态。如果用switch/if实现起来比较复杂下面用状态模式实现。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/36551f7482814585bd7f57326c1bbd6c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> UML图<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a4fb01a3703e45faab66dea501a8542b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-cpp"><span class="token comment">//State.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token keyword">class</span> <span class="token class-name">State</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">//扣除50积分</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">//是否中奖</span>
	<span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">//发放奖品</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//CanRaffleState.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"State.h"</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">RaffleActivity</span><span class="token punctuation">;</span>
<span class="token comment">//能抽奖状态</span>
<span class="token keyword">class</span> <span class="token class-name">CanRaffleState</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">State</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">CanRaffleState</span><span class="token punctuation">(</span>RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//已经扣除积分了，不能再扣了</span>
	<span class="token keyword">void</span> <span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
	<span class="token comment">//可以抽奖，根据抽奖情况改成新的状态</span>
	<span class="token keyword">bool</span> <span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//CanRaffleState.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CanRaffleState.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"RaffleActivity.h"</span></span>
<span class="token class-name">CanRaffleState</span><span class="token double-colon punctuation">::</span><span class="token function">CanRaffleState</span><span class="token punctuation">(</span>RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>activity <span class="token operator">=</span> activity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//已经扣除积分了，不能再扣了</span>
<span class="token keyword">void</span> <span class="token class-name">CanRaffleState</span><span class="token double-colon punctuation">::</span><span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"已经扣过积分了"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//可以抽奖，根据抽奖情况改成新的状态</span>
<span class="token keyword">bool</span> <span class="token class-name">CanRaffleState</span><span class="token double-colon punctuation">::</span><span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"正在抽奖"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> result<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//将activity的状态设置为发放奖品的状态</span>
		activity<span class="token operator">-&gt;</span><span class="token function">setState</span><span class="token punctuation">(</span>activity<span class="token operator">-&gt;</span><span class="token function">getDispenseState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"很遗憾没有抽中奖品"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token comment">//将activity的状态设置为不能抽奖的状态</span>
		activity<span class="token operator">-&gt;</span><span class="token function">setState</span><span class="token punctuation">(</span>activity<span class="token operator">-&gt;</span><span class="token function">getNoRaffleState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">CanRaffleState</span><span class="token double-colon punctuation">::</span><span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"没中奖，不能发放奖品"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//RaffleActivity.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"State.h"</span></span>
<span class="token keyword">class</span> <span class="token class-name">RaffleActivity</span><span class="token punctuation">;</span>
<span class="token comment">//奖品发送完毕状态</span>
<span class="token keyword">class</span> <span class="token class-name">DispenseOutState</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">State</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">DispenseOutState</span><span class="token punctuation">(</span>RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
	<span class="token keyword">bool</span> <span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
	<span class="token comment">//发放奖品</span>
	<span class="token keyword">void</span> <span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//RaffleActivity.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DispenseOutState.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"RaffleActivity.h"</span></span>

<span class="token class-name">DispenseOutState</span><span class="token double-colon punctuation">::</span><span class="token function">DispenseOutState</span><span class="token punctuation">(</span>RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>activity <span class="token operator">=</span> activity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">DispenseOutState</span><span class="token double-colon punctuation">::</span><span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"奖品已经发完了，请下次再参加"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">DispenseOutState</span><span class="token double-colon punctuation">::</span><span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"奖品已经发完了，请下次再参加"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//发放奖品</span>
<span class="token keyword">void</span> <span class="token class-name">DispenseOutState</span><span class="token double-colon punctuation">::</span><span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"奖品已经发完了，请下次再参加"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//RaffleActivity.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"State.h"</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RaffleActivity</span><span class="token punctuation">;</span>

<span class="token comment">//发放奖品的状态</span>
<span class="token keyword">class</span> <span class="token class-name">DispenseState</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">State</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">DispenseState</span><span class="token punctuation">(</span>RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
	<span class="token keyword">bool</span> <span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
	<span class="token comment">//发放奖品</span>
	<span class="token keyword">void</span> <span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//DispenseState.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DispenseState.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"RaffleActivity.h"</span></span>

<span class="token class-name">DispenseState</span><span class="token double-colon punctuation">::</span><span class="token function">DispenseState</span><span class="token punctuation">(</span>RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>activity <span class="token operator">=</span> activity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">DispenseState</span><span class="token double-colon punctuation">::</span><span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"不能扣除积分"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">DispenseState</span><span class="token double-colon punctuation">::</span><span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"不能抽奖了"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//发放奖品</span>
<span class="token keyword">void</span> <span class="token class-name">DispenseState</span><span class="token double-colon punctuation">::</span><span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>activity<span class="token operator">-&gt;</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"送出奖品"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		activity<span class="token operator">-&gt;</span><span class="token function">setState</span><span class="token punctuation">(</span>activity<span class="token operator">-&gt;</span><span class="token function">getNoRaffleState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"很遗憾,奖品发完了"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token comment">//奖品已经发完，后面的人就不能抽奖了</span>
		activity<span class="token operator">-&gt;</span><span class="token function">setState</span><span class="token punctuation">(</span>activity<span class="token operator">-&gt;</span><span class="token function">getDispenseOutState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//RaffleActivity.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"State.h"</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">RaffleActivity</span><span class="token punctuation">;</span>

<span class="token comment">//不能抽奖状态</span>
<span class="token keyword">class</span> <span class="token class-name">NoRaffleState</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">State</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">NoRaffleState</span><span class="token punctuation">(</span>RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//在不能抽奖状态是可以扣积分的，扣除积分后设置成可以抽奖状态</span>
	<span class="token keyword">void</span> <span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
	<span class="token keyword">bool</span> <span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">//初始化时传入活动，扣除积分后改变其状态</span>
	RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//NoRaffleState.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"NoRaffleState.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"RaffleActivity.h"</span><span class="token expression"><span class="token punctuation">;</span></span></span>

<span class="token class-name">NoRaffleState</span><span class="token double-colon punctuation">::</span><span class="token function">NoRaffleState</span><span class="token punctuation">(</span>RaffleActivity<span class="token operator">*</span> activity<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>activity <span class="token operator">=</span> activity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//在不能抽奖状态是可以扣积分的，扣除积分后设置成可以抽奖状态</span>
<span class="token keyword">void</span> <span class="token class-name">NoRaffleState</span><span class="token double-colon punctuation">::</span><span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"扣除50积分，可以抽奖了"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	activity<span class="token operator">-&gt;</span><span class="token function">setState</span><span class="token punctuation">(</span>activity<span class="token operator">-&gt;</span><span class="token function">getCanRaffleState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">bool</span> <span class="token class-name">NoRaffleState</span><span class="token double-colon punctuation">::</span><span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"扣了积分才能抽奖"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">NoRaffleState</span><span class="token double-colon punctuation">::</span><span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"不能发奖品"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//RaffleActivity.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CanRaffleState.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DispenseOutState.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DispenseState.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"State.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"NoRaffleState.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">RaffleActivity</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	State<span class="token operator">*</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> state<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span>State<span class="token operator">*</span> <span class="token keyword">const</span> state<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> count<span class="token operator">--</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	State<span class="token operator">*</span> <span class="token function">getNoRaffleState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> noRaffleState<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setNoRaffleState</span><span class="token punctuation">(</span>State<span class="token operator">*</span> <span class="token keyword">const</span> noRaffleState<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>noRaffleState <span class="token operator">=</span> noRaffleState<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	State<span class="token operator">*</span> <span class="token function">getCanRaffleState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> canRaffleState<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setCanRaffleState</span><span class="token punctuation">(</span>State<span class="token operator">*</span> <span class="token keyword">const</span> canRaffleState<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>canRaffleState <span class="token operator">=</span> canRaffleState<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	State<span class="token operator">*</span> <span class="token function">getDispenseState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> dispenseState<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setDispenseState</span><span class="token punctuation">(</span>State<span class="token operator">*</span> <span class="token keyword">const</span> dispenseState<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>dispenseState <span class="token operator">=</span> dispenseState<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	State<span class="token operator">*</span> <span class="token function">getDispenseOutState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> dispenseOutState<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setDispenseOutState</span><span class="token punctuation">(</span>State<span class="token operator">*</span> <span class="token keyword">const</span> dispenseOutState<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>dispenseOutState <span class="token operator">=</span> dispenseOutState<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">RaffleActivity</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//初始化当前状态为 不能抽奖状态</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>state <span class="token operator">=</span> <span class="token function">getNoRaffleState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//初始化奖品数量</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//扣分，调用当前状态的deductMoney</span>
	<span class="token keyword">void</span> <span class="token function">deductMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		state<span class="token operator">-&gt;</span><span class="token function">deductMeney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//抽奖</span>
	<span class="token keyword">void</span> <span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//如果抽中奖了，则领奖品</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token operator">-&gt;</span><span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			state<span class="token operator">-&gt;</span><span class="token function">dispensePrize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">//state表示活动当前的状态</span>
	State<span class="token operator">*</span> state <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token comment">//奖品数量</span>
	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//四个属性 表示四种状态</span>
	State<span class="token operator">*</span> noRaffleState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">NoRaffleState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	State<span class="token operator">*</span> canRaffleState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">CanRaffleState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	State<span class="token operator">*</span> dispenseState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">DispenseState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	State<span class="token operator">*</span> dispenseOutState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">DispenseOutState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//main.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"RaffleActivity.h"</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	RaffleActivity<span class="token operator">*</span> activity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">RaffleActivity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">50</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"第"</span> <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token string">"次抽奖"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		activity<span class="token operator">-&gt;</span><span class="token function">deductMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		activity<span class="token operator">-&gt;</span><span class="token function">raffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>优点：</strong></p>
<ol><li>封装了转换规则。</li><li>枚举可能的状态，在枚举状态之前需要确定状态种类。</li><li>将所有与某个状态有关的行为放到一个类中，并且可以方便地增加新的状态，只需要改变对象状态即可改变对象的行为。</li><li>允许状态转换逻辑与状态对象合成一体，而不是某一个巨大的条件语句块。</li><li>可以让多个环境对象共享一个状态对象，从而减少系统中对象的个数。</li></ol>
<hr/>
<h2><a id="Observer__2213"></a>Observer 模式(观察者模式)</h2>
<p>Observer 模式要解决的问题为：建立一个一（Subject）对多（Observer）的依赖关系，并且做到当“一”变化的时候，依赖这个“一”的多也能够同步改变。最常见的一个例子就是：对同一组数据进行统计分析时候，我们希望能够提供多种形式的表示（例如以表格进行统计显示、柱状图统计显示、百分比统计显示等）。指多个对象间存在一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p>
<p><strong>举例：</strong><br/> Subject 提供依赖于它的观察者 Observer 的注册（registerObserver）和注销（remove）操作，并且提供了使得依赖于它的所有观察者同步的操作（notifyObserver），观察者 Observer 则提供一个 Update 操作，注意这里的 Observer 的 Update 操作并不在 Observer 改变了 Subject 目标状态的时候就对自己进行更新，这个更新操作要延迟到 Subject 对象发出 Notify 通知所有Observer 进行修改（调用 Update）。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/18c5a47b30e143e3b35a19b78ac7ede1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;list&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//抽象的英雄 抽象的观察者  Observer</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractHero</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//具体的英雄 具体的观察者 </span>
<span class="token keyword">class</span> <span class="token class-name">HeroA</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractHero</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">HeroA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄A正在鲁BOSS"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄A停止撸，待机状态"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HeroB</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractHero</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">HeroB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄B正在鲁BOSS"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄B停止撸，待机状态"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HeroC</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractHero</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">HeroC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄C正在鲁BOSS"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄C停止撸，待机状态"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HeroD</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractHero</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">HeroD</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄D正在鲁BOSS"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄D停止撸，待机状态"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HeroE</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractHero</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">HeroE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄E正在鲁BOSS"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"英雄E停止撸，待机状态"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//定义抽象的观察目标  Subject</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractBoss</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//    添加观察者</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">addHero</span><span class="token punctuation">(</span>AbstractHero<span class="token operator">*</span> hero<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//    删除观察者</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">deleteHero</span><span class="token punctuation">(</span>AbstractHero<span class="token operator">*</span> hero<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//    通知所有观察者</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">notifv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//相对于 concreteSubject</span>
<span class="token keyword">class</span> <span class="token class-name">BOSSA</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractBoss</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//    添加观察者</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">addHero</span><span class="token punctuation">(</span>AbstractHero<span class="token operator">*</span> hero<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        pHeroList<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//    删除观察者</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">deleteHero</span><span class="token punctuation">(</span>AbstractHero<span class="token operator">*</span> hero<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        pHeroList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//    通知所有观察者</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">notifv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>list<span class="token operator">&lt;</span>AbstractHero<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> pHeroList<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> pHeroList<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    list<span class="token operator">&lt;</span>AbstractHero<span class="token operator">*</span><span class="token operator">&gt;</span> pHeroList<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//    创建观察者</span>
    AbstractHero<span class="token operator">*</span> heroA <span class="token operator">=</span> <span class="token keyword">new</span> HeroA<span class="token punctuation">;</span>
    AbstractHero<span class="token operator">*</span> heroB <span class="token operator">=</span> <span class="token keyword">new</span> HeroB<span class="token punctuation">;</span>
    AbstractHero<span class="token operator">*</span> heroC <span class="token operator">=</span> <span class="token keyword">new</span> HeroC<span class="token punctuation">;</span>
    AbstractHero<span class="token operator">*</span> heroD <span class="token operator">=</span> <span class="token keyword">new</span> HeroD<span class="token punctuation">;</span>
    AbstractHero<span class="token operator">*</span> heroE <span class="token operator">=</span> <span class="token keyword">new</span> HeroE<span class="token punctuation">;</span>

    <span class="token comment">//    创建观察目标</span>
    AbstractBoss<span class="token operator">*</span> bossA <span class="token operator">=</span> <span class="token keyword">new</span> BOSSA<span class="token punctuation">;</span>
    bossA<span class="token operator">-&gt;</span><span class="token function">addHero</span><span class="token punctuation">(</span>heroA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bossA<span class="token operator">-&gt;</span><span class="token function">addHero</span><span class="token punctuation">(</span>heroB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bossA<span class="token operator">-&gt;</span><span class="token function">addHero</span><span class="token punctuation">(</span>heroC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bossA<span class="token operator">-&gt;</span><span class="token function">addHero</span><span class="token punctuation">(</span>heroD<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bossA<span class="token operator">-&gt;</span><span class="token function">addHero</span><span class="token punctuation">(</span>heroE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"heroC阵亡"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    bossA<span class="token operator">-&gt;</span><span class="token function">deleteHero</span><span class="token punctuation">(</span>heroC<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Boss死了，通知其他英雄停止攻击。。。"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    bossA<span class="token operator">-&gt;</span><span class="token function">notifv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>优点：</strong></p>
<ol><li>观察者和被观察者是抽象耦合的。</li><li>建立一套触发机制。</li></ol>
<p><strong>缺点：</strong></p>
<ol><li>如果在观察者和观察目标之间有循环依赖的话，观察目标会触发它们之间进行循环调用，可能导致系统崩溃。</li><li>观察者模式没有相应的机制让观察者知道所观察的目标对象是怎么发生变化的，而仅仅只是知道观察目标发生了变化。</li></ol>
<hr/>
<h2><a id="Memento__2355"></a>Memento 模式（备忘录模式）</h2>
<p>没有人想犯错误，但是没有人能够不犯错误。犯了错误一般只能改过，却很难改正（恢复）。世界上没有后悔药，但是我们在进行软件系统的设计时候是要给用户后悔的权利（实际上可能也是用户要求的权利：）），我们对一些关键性的操作肯定需要提供诸如撤销（Undo）的操作。那这个后悔药就是 Memento 模式提供的。</p>
<p>Memento 模式的关键就是要在不破坏封装行的前提下，捕获并保存一个类的内部状态，这样就可以利用该保存的状态实施恢复操作。</p>
<p><strong>示例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a69c0ad0e7d8457b906756947bfc6bab.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_19,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<ul><li>Originator 原始的状态</li><li>Memento 包含了要被恢复的对象的状态</li><li>Caretaker 用于保存所有的memento的一个管理类</li></ul>
<p>我们有一个英雄，有一个初始状态，在收到敌人的DEBUFF后状态会下降，在DEBUFF时间过了之后又会回到正常的状态，所以我们需要保存正常状态的值，这个时候我们就可以采用备忘录模式了。</p>
<pre><code class="prism language-cpp"><span class="token comment">//Originator.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_ORIGINATOR_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_ORIGINATOR_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Memento.h"</span></span>
<span class="token keyword">class</span> <span class="token class-name">Originator</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>string <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> state<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> state<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//保存一个状态对象Memento   即用当前状态的值去创建一个Memento然后将其返回</span>
	Memento <span class="token function">SaveStateMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">Memento</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//通过备忘录对象，恢复状态</span>
	<span class="token keyword">void</span> <span class="token function">getStateFromMemento</span><span class="token punctuation">(</span>Memento memento<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		state <span class="token operator">=</span> memento<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>string state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//Memento.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_MEMENTO_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_MEMENTO_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token keyword">class</span> <span class="token class-name">Memento</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">Memento</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> state<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">state</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	std<span class="token double-colon punctuation">::</span>string <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> state<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>string state<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//Caretaker.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_CARETAKER_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_CARETAKER_H_</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Memento.h"</span></span>
<span class="token keyword">class</span> <span class="token class-name">Caretaker</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Memento memento<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		mementoList<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>memento<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//获取到第index个Originator的备忘录对象（即备忘录状态）</span>
	Memento <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> mementoList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">//在mementoList中会有很多备忘录对象</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Memento<span class="token operator">&gt;</span> mementoList<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//main.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Originator.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Caretaker.h"</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Originator originator<span class="token punctuation">;</span>
	Caretaker caretaker<span class="token punctuation">;</span>
	originator<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"状态1，攻击力为100"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//保存当前状态</span>
	caretaker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span><span class="token function">SaveStateMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//受到debuff，攻击力下降</span>
	originator<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">"状态2，攻击力为80"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//保存状态</span>
	caretaker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>originator<span class="token punctuation">.</span><span class="token function">SaveStateMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"当前的状态："</span> <span class="token operator">&lt;&lt;</span> originator<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"debuff时间结束，回到状态1"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	originator<span class="token punctuation">.</span><span class="token function">getStateFromMemento</span><span class="token punctuation">(</span>caretaker<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"恢复到状态1后的状态："</span> <span class="token operator">&lt;&lt;</span> originator<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong><br/> 优点：</p>
<ol><li>给用户提供了一种可以恢复状态的机制，可以使用户能够比较方便地回到某个历史的状态。</li><li>实现了信息的封装，使得用户不需要关心状态的保存细节。</li></ol>
<p>缺点：消耗资源。如果类的成员变量过多，势必会占用比较大的资源，而且每一次保存都会消耗一定的内存。</p>
<hr/>
<h2><a id="Mediator__2487"></a>Mediator 模式（中介者模式）</h2>
<p>在面向对象系统的设计和开发过程中，对象之间的交互和通信是最为常见的情况，因为对象间的交互本身就是一种通信。在系统比较小的时候，可能对象间的通信不是很多、对象也比较少，我们可以直接硬编码到各个对象的方法中。但是当系统规模变大，对象的量变引起系统复杂度的急剧增加，对象间的通信也变得越来越复杂，这时候我们就要提供一个专门处理对象间交互和通信的类，这个中介者就是 Mediator 模式。所以Mediator 模式的实现关键就是将对象 Colleague 之间的通信封装到一个类种单独处理。</p>
<p><strong>举例：</strong></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f5fb0e24db16487d96953e5549843fd3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>说明：</strong></p>
<ol><li>Meadiator是抽象中介者，定义了同事对象到中介者对象的接口。</li><li>Colleague是抽象同事类</li><li>ConcreteMediator是具体的中介者对象，实现抽象方法，他需要知道所有的具体的同事类，用一个集合来管理它们，并接收某个同事的消息，完成相应的任务。</li><li>ConcreteColleague是具体的同事类，会有很多，每个同事只知道自己的行为，而不了解其他同事的行为，它们都依赖中介者对象。</li></ol>
<p><strong>中介者模式的目标：</strong><br/> 将网状结构改成星状结构<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9029eb21941846b5be0dc111180ca363.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_14,color_FFFFFF,t_70,g_se,x_16"/><br/> 使用中介者模式后<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/83fe4daf39b747b385aebf5a4f44c143.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_14,color_FFFFFF,t_70,g_se,x_16"/></p>
<p><strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d70954611d3047b9ba494023ef2b80db.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//Colleague.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">Mediator</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Colleague</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	Mediator<span class="token operator">*</span> <span class="token function">getMediator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setMediator</span><span class="token punctuation">(</span>Mediator<span class="token operator">*</span> <span class="token keyword">const</span> mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Colleague</span><span class="token punctuation">(</span>Mediator<span class="token operator">*</span> mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string message<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	Mediator<span class="token operator">*</span> mediator<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//Colleague.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Colleague.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Mediator.h"</span></span>

Mediator<span class="token operator">*</span> <span class="token class-name">Colleague</span><span class="token double-colon punctuation">::</span><span class="token function">getMediator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> mediator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">Colleague</span><span class="token double-colon punctuation">::</span><span class="token function">setMediator</span><span class="token punctuation">(</span>Mediator<span class="token operator">*</span> <span class="token keyword">const</span> mediator<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>mediator <span class="token operator">=</span> mediator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Colleague</span><span class="token double-colon punctuation">::</span><span class="token function">Colleague</span><span class="token punctuation">(</span>Mediator<span class="token operator">*</span> mediator<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>mediator <span class="token operator">=</span> mediator<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>mediator<span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//ConcreteColleague1.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_CONCRETECOLLEAGUE1_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_CONCRETECOLLEAGUE1_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Colleague.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Mediator.h"</span></span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteColleague1</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Colleague</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">ConcreteColleague1</span><span class="token punctuation">(</span>Mediator<span class="token operator">*</span> mediator<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">Colleague</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string message<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">getMediator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string message<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"同事1收到消息："</span> <span class="token operator">+</span> message<span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//ConcreteColleague2.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_CONCRETECOLLEAGUE2_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_CONCRETECOLLEAGUE2_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Colleague.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Mediator.h"</span></span>

<span class="token keyword">class</span> <span class="token class-name">ConcreteColleague2</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Colleague</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">ConcreteColleague2</span><span class="token punctuation">(</span>Mediator<span class="token operator">*</span> mediator<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token function">Colleague</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string message<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">getMediator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string message<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"同事2收到消息："</span> <span class="token operator">+</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//ConcreteMediator.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_CONCRETEMEDIATOR_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_CONCRETEMEDIATOR_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Colleague.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Mediator.h"</span></span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteMediator</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Mediator</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Colleague<span class="token operator">*</span> colleague<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		colleaguesList<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>colleague<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string message<span class="token punctuation">,</span> Colleague<span class="token operator">*</span> colleague<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> value <span class="token operator">:</span> colleaguesList<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token operator">!=</span>colleague<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				value<span class="token operator">-&gt;</span><span class="token function">Notify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Colleague<span class="token operator">*</span><span class="token operator">&gt;</span> colleaguesList<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//Mediator.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_MEDIATOR_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_MEDIATOR_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Colleague.h"</span></span>
<span class="token keyword">class</span> <span class="token class-name">Mediator</span>	
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string message<span class="token punctuation">,</span> Colleague<span class="token operator">*</span> colleague<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span>Colleague<span class="token operator">*</span> colleague<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//main.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ConcreteMediator.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ConcreteColleague1.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ConcreteColleague2.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Mediator.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Colleague.h"</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Mediator<span class="token operator">*</span> mediator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteMediator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ConcreteColleague1<span class="token operator">*</span> colleague1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteColleague1</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ConcreteColleague2<span class="token operator">*</span> colleague2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteColleague2</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>

	colleague1<span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"早上好啊！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	colleague2<span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"早安！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p><strong>总结：</strong></p>
<ul><li><strong>何时使用</strong>：多个类相互耦合，形成了网状结构，需要将上述网状结构分离为星型结构的时候。</li><li>中介者承担了较多的责任，一旦中介者出现问题，整个系统都会收到影响。</li></ul>
<hr/>
<h2><a id="Command__2669"></a>Command 模式（命令模式）</h2>
<ul><li>请求以命令的形式包裹在对象中，并传给调用对象。调用对象寻找可以处理该命令的合适的对象，并把该命令传给相应的对象，该对象执行命令。</li><li>Command 模式的最终目的就是将一个请求封装成一个对象，从而使您可以用不同的请求对客户进行参数化。<br/> <strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c4c8e020db9e47a0b34ecb85509028a1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/></li><li>Invoker 是调用者角色</li><li>Command 是命令角色，需要执行的所有命令都在这里</li><li>Receiver 是接受者角色，知道如何实施和执行一个请求相关的操作</li><li>ConcreteCommand 将接受者对象与一个动作绑定，调用接受者相应的操作</li></ul>
<p>假如现在有一个游戏服务器，该游戏服务器一共可以处理四种不同的请求：处理增加金币、处理增加钻石、处理玩家装备、玩家升级请求。我们需要把这些请求封装成对象，从而加入请求队列一次进行处理。</p>
<p><strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token comment">//命令模式</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;queue&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//协议处理类    （请求类）</span>
<span class="token keyword">class</span> <span class="token class-name">HandleClinetProtocal</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">//处理增加金币</span>
	<span class="token keyword">void</span> <span class="token function">AddMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"给玩家增加金币"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//处理增加钻石</span>
	<span class="token keyword">void</span> <span class="token function">AddDiamond</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"给玩家增加钻石"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//处理玩家装备</span>
	<span class="token keyword">void</span> <span class="token function">AddEquipment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"给玩家穿装备"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//玩家升级</span>
	<span class="token keyword">void</span> <span class="token function">AddLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"给玩家升级"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//命令接口  </span>
<span class="token keyword">class</span> <span class="token class-name">AbstractCommand</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">//相当于execute（）</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">//下面是把每个功能都封装为一个请求对象</span>
<span class="token comment">//处理增加金币请求</span>
<span class="token keyword">class</span> <span class="token class-name">AddMoneyCommand</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractCommand</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">AddMoneyCommand</span><span class="token punctuation">(</span>HandleClinetProtocal<span class="token operator">*</span> protocal<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pProtocol <span class="token operator">=</span> protocal<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pProtocol<span class="token operator">-&gt;</span><span class="token function">AddMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	HandleClinetProtocal<span class="token operator">*</span> pProtocol<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//处理增加钻石请求</span>
<span class="token keyword">class</span> <span class="token class-name">AddDiamondCommand</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractCommand</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">AddDiamondCommand</span><span class="token punctuation">(</span>HandleClinetProtocal<span class="token operator">*</span> protocal<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pProtocol <span class="token operator">=</span> protocal<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pProtocol<span class="token operator">-&gt;</span><span class="token function">AddDiamond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	HandleClinetProtocal<span class="token operator">*</span> pProtocol<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//处理玩家装备请求</span>
<span class="token keyword">class</span> <span class="token class-name">AddEquipmentCommand</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractCommand</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">AddEquipmentCommand</span><span class="token punctuation">(</span>HandleClinetProtocal<span class="token operator">*</span> protocal<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pProtocol <span class="token operator">=</span> protocal<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pProtocol<span class="token operator">-&gt;</span><span class="token function">AddEquipment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	HandleClinetProtocal<span class="token operator">*</span> pProtocol<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//处理玩家升级请求</span>
<span class="token keyword">class</span> <span class="token class-name">AddLevelCommand</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractCommand</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">AddLevelCommand</span><span class="token punctuation">(</span>HandleClinetProtocal<span class="token operator">*</span> protocal<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pProtocol <span class="token operator">=</span> protocal<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>pProtocol<span class="token operator">-&gt;</span><span class="token function">AddLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	HandleClinetProtocal<span class="token operator">*</span> pProtocol<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//服务器程序   （命令调用类）</span>
<span class="token keyword">class</span> <span class="token class-name">Server</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">//将请求对象放入处理队列</span>
	<span class="token keyword">void</span> <span class="token function">addRequest</span><span class="token punctuation">(</span>AbstractCommand<span class="token operator">*</span> command<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		mCommands<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//启动处理程序</span>
	<span class="token keyword">void</span> <span class="token function">startHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>mCommands<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			AbstractCommand<span class="token operator">*</span> command <span class="token operator">=</span> mCommands<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			command<span class="token operator">-&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mCommands<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	queue<span class="token operator">&lt;</span>AbstractCommand<span class="token operator">*</span><span class="token operator">&gt;</span> mCommands<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	HandleClinetProtocal<span class="token operator">*</span> protocal <span class="token operator">=</span> <span class="token keyword">new</span> HandleClinetProtocal<span class="token punctuation">;</span>
	<span class="token comment">//客户端增加金币的请求</span>
	AbstractCommand<span class="token operator">*</span> addmoney <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">AddMoneyCommand</span><span class="token punctuation">(</span>protocal<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//客户端增加钻石的请求</span>
	AbstractCommand<span class="token operator">*</span> adddiamond <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">AddDiamondCommand</span><span class="token punctuation">(</span>protocal<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//客户端穿装备的请求</span>
	AbstractCommand<span class="token operator">*</span> addequipment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">AddEquipmentCommand</span><span class="token punctuation">(</span>protocal<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//客户端升级请求</span>
	AbstractCommand<span class="token operator">*</span> addlevel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">AddLevelCommand</span><span class="token punctuation">(</span>protocal<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//将客户端的请求加入到请求队列中</span>
	Server<span class="token operator">*</span> server <span class="token operator">=</span> <span class="token keyword">new</span> Server<span class="token punctuation">;</span>
	server<span class="token operator">-&gt;</span><span class="token function">addRequest</span><span class="token punctuation">(</span>addmoney<span class="token punctuation">)</span><span class="token punctuation">;</span>
	server<span class="token operator">-&gt;</span><span class="token function">addRequest</span><span class="token punctuation">(</span>adddiamond<span class="token punctuation">)</span><span class="token punctuation">;</span>
	server<span class="token operator">-&gt;</span><span class="token function">addRequest</span><span class="token punctuation">(</span>addequipment<span class="token punctuation">)</span><span class="token punctuation">;</span>
	server<span class="token operator">-&gt;</span><span class="token function">addRequest</span><span class="token punctuation">(</span>addlevel<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//服务器开始处理请求</span>
	server<span class="token operator">-&gt;</span><span class="token function">startHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<hr/>
<h2><a id="Visitor__2846"></a>Visitor 模式（访问者模式）</h2>
<ul><li>访问者模式（VisitorPattern），封装一些作用于某种数据结构的各元素的操作，它可以在不改变数据结构的前提下定义作用于这些元素的新的操作。</li><li>主要将数据结构与数据操作分离，解决 数据结构和操作耦合性问题</li><li>访问者模式的基本工作原理是：在被访问的类里面加一个对外提供接待访问者的接口</li><li>访问者模式主要应用场景是：需要对一个对象结构中的对象进行很多不同操作(这些操作彼此没有关联)，同时需要避免让这些操作"污染"这些对象的类，可以选用访问者模式解决</li></ul>
<p><strong>举例：</strong><br/> 现在有一场演出，将参加选手分为男人和女人，当看完某个歌手表演后，需要对他们进行评价（失败、成功等）<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4364f020028e4c1da1035d919be6d40b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;list&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">Man</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Woman</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Action</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">getManResult</span><span class="token punctuation">(</span>Man<span class="token operator">*</span> man<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">getWomanResult</span><span class="token punctuation">(</span>Woman<span class="token operator">*</span> woman<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
<span class="token keyword">private</span><span class="token operator">:</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Success</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Action</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">getManResult</span><span class="token punctuation">(</span>Man<span class="token operator">*</span> man<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"男人的给的评价该歌手是很成功"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">getWomanResult</span><span class="token punctuation">(</span>Woman<span class="token operator">*</span> woman<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"女人的给的评价该歌手是很成功"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Fail</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Action</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">getManResult</span><span class="token punctuation">(</span>Man<span class="token operator">*</span> man<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"男人的给的评价该歌手是失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">getWomanResult</span><span class="token punctuation">(</span>Woman<span class="token operator">*</span> woman<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"女人的给的评价该歌手是失败"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">//提供一个方法让访问者可以访问</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>Action<span class="token operator">*</span> action<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//这里用用到了双分派，即首先在客户端程序中，将具体的状态作为参数传递进Man中（第一次分派）</span>
<span class="token comment">//然后在Man中调用作为参数的“具体方法” getManResult同时将自己作为参数传入完成第二次分派</span>
<span class="token keyword">class</span> <span class="token class-name">Man</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Person</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>Action<span class="token operator">*</span> action<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		action<span class="token operator">-&gt;</span><span class="token function">getManResult</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Woman</span><span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Person</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span>Action<span class="token operator">*</span> action<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		action<span class="token operator">-&gt;</span><span class="token function">getWomanResult</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//数据结构，管理很多人（Man、Woman）用来装符合某一个评价的所有人</span>
<span class="token keyword">class</span> <span class="token class-name">ObjectStructure</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">//添加到list</span>
	<span class="token keyword">void</span> <span class="token function">attach</span><span class="token punctuation">(</span>Person<span class="token operator">*</span> p<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		persons<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//移除</span>
	<span class="token keyword">void</span> <span class="token function">detach</span><span class="token punctuation">(</span>Person<span class="token operator">*</span> p<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		persons<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">delete</span> p<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//显示测评情况</span>
	<span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span>Action<span class="token operator">*</span> action<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> value <span class="token operator">:</span> persons<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			value<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	list<span class="token operator">&lt;</span>Person<span class="token operator">*</span><span class="token operator">&gt;</span> persons<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//创建ObjectStructure（可以创建很多个不同的ObjectStructure来代表不同评价，然后把同样评价的人放到一个ObjectStructure中）</span>
	ObjectStructure<span class="token operator">*</span> objectStructure <span class="token operator">=</span> <span class="token keyword">new</span> ObjectStructure<span class="token punctuation">;</span>
	objectStructure<span class="token operator">-&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">new</span> Man<span class="token punctuation">)</span><span class="token punctuation">;</span>
	objectStructure<span class="token operator">-&gt;</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token keyword">new</span> Woman<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//假如歌手获得成功</span>
	Success<span class="token operator">*</span> success <span class="token operator">=</span> <span class="token keyword">new</span> Success<span class="token punctuation">;</span>
	objectStructure<span class="token operator">-&gt;</span><span class="token function">display</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"======================="</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//假如歌手失败了</span>
	Fail<span class="token operator">*</span> fail <span class="token operator">=</span> <span class="token keyword">new</span> Fail<span class="token punctuation">;</span>
	objectStructure<span class="token operator">-&gt;</span><span class="token function">display</span><span class="token punctuation">(</span>fail<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p><strong>总结：</strong></p>
<ul><li>假设我们要添加一个Wait的状态类，考察Man类和Woman类的反应，由于使用了双分派，只需增加一个Action子类即可在客户端调用即可，不需要改动任何其他类的代码</li></ul>
<p><strong>优点：</strong></p>
<ol><li>访问者模式符合单一职责原则、让程序具有优秀的扩展性、灵活性非常高</li><li>访问者模式可以对功能进行统一，可以做报表、UI、拦截器与过滤器，适用于数据结构相对稳定的系统</li></ol>
<p><strong>缺点：</strong></p>
<ol><li>具体元素对访问者公布细节，也就是说访问者关注了其他类的内部细节，这是迪米特法则所不建议的, 这样造成了具体元素变更比较困难</li><li>违背了依赖倒转原则。访问者依赖的是具体元素，而不是抽象元素</li><li>因此，如果一个系统有比较稳定的数据结构，又有经常变化的功能需求，那么访问者模式就是比较合适的.</li></ol>
<hr/>
<h2><a id="Chain_of_Responsibility__2991"></a>Chain of Responsibility 模式（责任链模式）</h2>
<p>责任链模式（Chain of Responsibility Pattern）为请求创建了一个接收者对象的链。这种模式给予请求的类型，对请求的发送者和接收者进行解耦。这种类型的设计模式属于行为型模式。</p>
<p>在这种模式中，通常每个接收者都包含对另一个接收者的引用。如果一个对象不能处理该请求，那么它会把相同的请求传给下一个接收者，依此类推。</p>
<p>**主要解决：**职责链上的处理者负责处理请求，客户只需要将请求发送到职责链上即可，无须关心请求的处理细节和请求的传递，所以职责链将请求的发送者和请求的处理者解耦了。</p>
<p>**何时使用：**在处理消息的时候以过滤很多道。</p>
<p><strong>举例：</strong><br/> 编写程序完成学校OA系统的采购审批项目：需求：</p>
<ul><li>采购员采购教学器材</li><li>如果金额 小于等于5000, 由教学主任审批</li><li>如果金额 小于等于10000, 由院长审批</li><li>如果金额 小于等于30000, 由副校长审批</li><li>如果金额 超过30000以上，有校长审批<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ae927feff10f4d7db95cf8394517033e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></li></ul>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//请求类</span>
<span class="token keyword">class</span> <span class="token class-name">PurchaseRequest</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">int</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> type<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">float</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> price<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> id<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">PurchaseRequest</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> price<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">type</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
		  <span class="token function">price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">,</span>
		  <span class="token function">id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">//请求类型</span>
	<span class="token keyword">int</span> type<span class="token punctuation">;</span>
	<span class="token comment">//价格</span>
	<span class="token keyword">float</span> price <span class="token operator">=</span> <span class="token number">0.f</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Approver</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>

	<span class="token keyword">void</span> <span class="token function">setApprover</span><span class="token punctuation">(</span>Approver<span class="token operator">*</span> <span class="token keyword">const</span> approver<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>approver <span class="token operator">=</span> approver<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">explicit</span> <span class="token function">Approver</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	<span class="token comment">//处理审批请求的方法，得到一个请求，处理是子类完成的，因此该方法写成纯虚方法</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span>PurchaseRequest<span class="token operator">*</span> purchaseRequest<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
	<span class="token comment">//下一个处理者</span>
	Approver<span class="token operator">*</span> approver<span class="token punctuation">;</span>
	<span class="token comment">//名字</span>
	string name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//教学主任</span>
<span class="token keyword">class</span> <span class="token class-name">DepartmentApprover</span><span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Approver</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">DepartmentApprover</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">Approver</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span>PurchaseRequest<span class="token operator">*</span> purchaseRequest<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">5000</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请求编号id="</span> <span class="token operator">&lt;&lt;</span> purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"被"</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>name <span class="token operator">&lt;&lt;</span> <span class="token string">"处理"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			approver<span class="token operator">-&gt;</span><span class="token function">processRequest</span><span class="token punctuation">(</span>purchaseRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//院长</span>
<span class="token keyword">class</span> <span class="token class-name">CollegeApprover</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Approver</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">CollegeApprover</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">Approver</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span>PurchaseRequest<span class="token operator">*</span> purchaseRequest<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">5000</span> <span class="token operator">&amp;&amp;</span> purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">10000</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请求编号id="</span> <span class="token operator">&lt;&lt;</span> purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"被"</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>name <span class="token operator">&lt;&lt;</span> <span class="token string">"处理"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			approver<span class="token operator">-&gt;</span><span class="token function">processRequest</span><span class="token punctuation">(</span>purchaseRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//副校长</span>
<span class="token keyword">class</span> <span class="token class-name">ViceSchoolMasterApprover</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Approver</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">ViceSchoolMasterApprover</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">Approver</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span>PurchaseRequest<span class="token operator">*</span> purchaseRequest<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10000</span> <span class="token operator">&amp;&amp;</span> purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">30000</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请求编号id="</span> <span class="token operator">&lt;&lt;</span> purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"被"</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>name <span class="token operator">&lt;&lt;</span> <span class="token string">"处理"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			approver<span class="token operator">-&gt;</span><span class="token function">processRequest</span><span class="token punctuation">(</span>purchaseRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//校长</span>
<span class="token keyword">class</span> <span class="token class-name">SchoolMasterApprover</span> <span class="token operator">:</span><span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Approver</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">SchoolMasterApprover</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">Approver</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span>PurchaseRequest<span class="token operator">*</span> purchaseRequest<span class="token punctuation">)</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">30000</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"请求编号id="</span> <span class="token operator">&lt;&lt;</span> purchaseRequest<span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"被"</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>name <span class="token operator">&lt;&lt;</span> <span class="token string">"处理"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			approver<span class="token operator">-&gt;</span><span class="token function">processRequest</span><span class="token punctuation">(</span>purchaseRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//创建一个请求</span>
	PurchaseRequest<span class="token operator">*</span> purchaseRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">PurchaseRequest</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//创建相关的审批人</span>
	DepartmentApprover<span class="token operator">*</span> department <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">DepartmentApprover</span><span class="token punctuation">(</span><span class="token string">"张主任"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CollegeApprover<span class="token operator">*</span> college <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">CollegeApprover</span><span class="token punctuation">(</span><span class="token string">"李院长"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ViceSchoolMasterApprover<span class="token operator">*</span> viceSchoolMaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ViceSchoolMasterApprover</span><span class="token punctuation">(</span><span class="token string">"王副校长"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	SchoolMasterApprover<span class="token operator">*</span> schoolMaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SchoolMasterApprover</span><span class="token punctuation">(</span><span class="token string">"佟校长"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//需要将各个审批级别的下一个人设置好(处理人构成一个环装就可以从任何一个人开始处理了)</span>
	<span class="token comment">//否则必须从第一个处理人开始</span>
	department<span class="token operator">-&gt;</span><span class="token function">setApprover</span><span class="token punctuation">(</span>college<span class="token punctuation">)</span><span class="token punctuation">;</span>
	college<span class="token operator">-&gt;</span><span class="token function">setApprover</span><span class="token punctuation">(</span>viceSchoolMaster<span class="token punctuation">)</span><span class="token punctuation">;</span>
	viceSchoolMaster<span class="token operator">-&gt;</span><span class="token function">setApprover</span><span class="token punctuation">(</span>schoolMaster<span class="token punctuation">)</span><span class="token punctuation">;</span>
	schoolMaster<span class="token operator">-&gt;</span><span class="token function">setApprover</span><span class="token punctuation">(</span>department<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//开始处理请求</span>
	viceSchoolMaster<span class="token operator">-&gt;</span><span class="token function">processRequest</span><span class="token punctuation">(</span>purchaseRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p><strong>总结：</strong></p>
<ul><li>将请求和处理分开，实现解耦，提高系统的灵活性</li><li>简化了对象，使对象不需要知道链的结构</li><li>调试不方便。采用了类似递归的方式，调试时逻辑可能比较复杂</li><li>最佳应用场景：有多个对象可以处理同一个请求时，比如：多级请求、请假/加薪等审批流程、Java Web中Tomcat对Encoding的处理、拦截器</li></ul>
<hr/>
<h2><a id="Iterator__3188"></a>Iterator 模式（迭代器模式）</h2>
<p>迭代器模式，提供一种遍历集合元素的统一接口，用一致的方法遍历集合元素，不需要知道集合对象的底层表示，即：不暴露其内部的结构。<strong>而且不管这些对象是什么都需要遍历的时候，就应该选择使用迭代器模式</strong><br/> <strong>举例：</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f1727bd2164641859ea2e2cdaf3fb8ab.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbW9tb2hvbGE=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">//迭代抽象类,用于定义得到开始对象、得到下一个对象、判断是否到结尾、当前对象等抽象方法，统一接口</span>
<span class="token keyword">class</span> <span class="token class-name">Iterator</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> string <span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> string <span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> string <span class="token function">CurrentItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">IsDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//聚集抽象类</span>
<span class="token keyword">class</span> <span class="token class-name">Aggregate</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int</span> <span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Push</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> strValue<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> string <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> nIndex<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> Iterator<span class="token operator">*</span> <span class="token function">CreateIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//具体迭代器类，继承Iterator 实现开始、下一个、是否结尾、当前对象等方法</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteIterator</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Iterator</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ConcreteIterator</span><span class="token punctuation">(</span>Aggregate<span class="token operator">*</span> pAggregate<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token function">m_nCurrent</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        m_Aggregate <span class="token operator">=</span> pAggregate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    string <span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> m_Aggregate<span class="token operator">-&gt;</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    string <span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        string strRet<span class="token punctuation">;</span>
        m_nCurrent<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>m_nCurrent <span class="token operator">&lt;</span> m_Aggregate<span class="token operator">-&gt;</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            strRet <span class="token operator">=</span> m_Aggregate<span class="token operator">-&gt;</span><span class="token function">Pop</span><span class="token punctuation">(</span>m_nCurrent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> strRet<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    string <span class="token function">CurrentItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> m_Aggregate<span class="token operator">-&gt;</span><span class="token function">Pop</span><span class="token punctuation">(</span>m_nCurrent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">bool</span> <span class="token function">IsDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>m_nCurrent <span class="token operator">&gt;=</span> m_Aggregate<span class="token operator">-&gt;</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Aggregate<span class="token operator">*</span> m_Aggregate<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_nCurrent<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//具体聚集类 继承</span>
<span class="token keyword">class</span> <span class="token class-name">ConcreteAggregate</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Aggregate</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ConcreteAggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token function">m_pIterator</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        m_vecItems<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">ConcreteAggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> m_pIterator<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">delete</span> m_pIterator<span class="token punctuation">;</span>
            m_pIterator <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    Iterator<span class="token operator">*</span> <span class="token function">CreateIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">==</span> m_pIterator<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            m_pIterator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteIterator</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> m_pIterator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> m_vecItems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">Push</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> strValue<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        m_vecItems<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>strValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    string <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> nIndex<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        string strRet<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nIndex <span class="token operator">&lt;</span> <span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            strRet <span class="token operator">=</span> m_vecItems<span class="token punctuation">[</span>nIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> strRet<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> m_vecItems<span class="token punctuation">;</span>
    Iterator<span class="token operator">*</span> m_pIterator<span class="token punctuation">;</span>


<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ConcreteAggregate<span class="token operator">*</span> pName <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    pName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteAggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> pName<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        pName<span class="token operator">-&gt;</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pName<span class="token operator">-&gt;</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token string">"word"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pName<span class="token operator">-&gt;</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token string">"cxue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Iterator<span class="token operator">*</span> iter <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    iter <span class="token operator">=</span> pName<span class="token operator">-&gt;</span><span class="token function">CreateIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> iter<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        string strItem <span class="token operator">=</span> iter<span class="token operator">-&gt;</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>iter<span class="token operator">-&gt;</span><span class="token function">IsDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            cout <span class="token operator">&lt;&lt;</span> iter<span class="token operator">-&gt;</span><span class="token function">CurrentItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" is ok"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            iter<span class="token operator">-&gt;</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>总结：</strong></p>
<ul><li>提供一个统一的方法遍历对象，客户不用再考虑聚合的类型，使用一种方法就可以遍历对象了。</li><li>隐藏了聚合的内部结构，客户端要遍历聚合的时候只能取到迭代器，而不会知道聚合的具体组成。</li><li>提供了一种设计思想，就是一个类应该只有一个引起变化的原因（叫做单一责任原则）。在聚合类中，我们把迭代器分开，就是要把管理对象集合和遍历对象集合的责任分开，这样一来集合改变的话，只影响到聚合对象。而如果遍历方式改变的话，只影响到了迭代器。</li><li>当要展示一组相似对象，或者遍历一组相同对象时使用, 适合使用迭代器模式</li></ul>
<hr/>
<h2><a id="Interpreter__3338"></a>Interpreter 模式（解释器模式）</h2>
<ul><li> <p>在编译原理中，一个算术表达式通过词法分析器形成词法单元，而后这些词法单元再通过语法分析器构建语法分析树，最终形成一颗抽象的语法分析树。这里的词法分析器和语法分析器都可以看做是解释器</p> </li><li> <p>解释器模式（Interpreter Pattern）：是指给定一个语言(表达式)，定义它的文法的一种表示，并定义一个解释器，使用该解释器来解释语言中的句子(表达式)</p> </li><li> <p>应用场景：<br/> 1、应用可以将一个需要解释执行的语言中的句子表示为一个抽象语法树<br/> 2、一些重复出现的问题可以用一种简单的语言来表达<br/> 3、一个简单语法需要解释的场景<br/> 4、这样的例子还有，比如编译器、运算表达式计算、正则表达式、机器人等</p> </li></ul>
<p><strong>代码：</strong></p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Context</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Context</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        m_num <span class="token operator">=</span> num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">setNum</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        m_num <span class="token operator">=</span> num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> m_num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">setRes</span><span class="token punctuation">(</span><span class="token keyword">int</span> res<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        m_res <span class="token operator">=</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> <span class="token function">getRes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> m_res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> m_num<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Expression</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">interpreter</span><span class="token punctuation">(</span>Context <span class="token operator">*</span>context<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PlusExpression</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Expression</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">interpreter</span><span class="token punctuation">(</span>Context <span class="token operator">*</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> context<span class="token operator">-&gt;</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        num<span class="token operator">++</span><span class="token punctuation">;</span>
        context<span class="token operator">-&gt;</span><span class="token function">setNum</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token operator">-&gt;</span><span class="token function">setRes</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MinusExpression</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Expression</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">interpreter</span><span class="token punctuation">(</span>Context <span class="token operator">*</span>context<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> context<span class="token operator">-&gt;</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        num<span class="token operator">--</span><span class="token punctuation">;</span>
        context<span class="token operator">-&gt;</span><span class="token function">setNum</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token operator">-&gt;</span><span class="token function">setRes</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    Context <span class="token operator">*</span>pcxt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Context</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Expression <span class="token operator">*</span>e1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">PlusExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    e1<span class="token operator">-&gt;</span><span class="token function">interpreter</span><span class="token punctuation">(</span>pcxt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"PlusExpression: "</span> <span class="token operator">&lt;&lt;</span> pcxt<span class="token operator">-&gt;</span><span class="token function">getRes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    Expression <span class="token operator">*</span>e2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MinusExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    e2<span class="token operator">-&gt;</span><span class="token function">interpreter</span><span class="token punctuation">(</span>pcxt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"MinusExpression: "</span> <span class="token operator">&lt;&lt;</span> pcxt<span class="token operator">-&gt;</span><span class="token function">getRes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token keyword">delete</span> e1<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> e2<span class="token punctuation">;</span>

    <span class="token keyword">delete</span> pcxt<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>优点：</p>
<ul><li>可扩展性比较好，灵活。</li><li>增加了新的解释表达式的方式。</li><li>易于实现简单文法。</li></ul>
<p>缺点：</p>
<ul><li>可利用场景比较少。</li><li>对于复杂的文法比较难维护。</li><li>解释器模式会引起类膨胀。</li><li>解释器模式采用递归调用方法。</li></ul>
<h1><a id="_3452"></a>引用</h1>
<blockquote>
<p>1)设计模式精解－GoF 23 种设计模式解析附<br/> 2)菜鸟教程——设计模式<br/> 3)尚硅谷——设计模式<br/> 4)黑马——C++设计模式</p>
</blockquote>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>