<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<h1 id="%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%EF%BC%9A%E9%9A%8F%E6%9C%BA%E6%B7%BB%E5%8A%A0%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%E5%92%8C%E9%AB%98%E6%96%AF%E5%99%AA%E5%A3%B0Python">图像处理：随机添加椒盐噪声和高斯噪声Python</h1>
<p id="main-toc"><strong>目录</strong></p>
<p id="%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%EF%BC%9A%E9%9A%8F%E6%9C%BA%E6%B7%BB%E5%8A%A0%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%E5%92%8C%E9%AB%98%E6%96%AF%E5%99%AA%E5%A3%B0Python-toc" style="margin-left:0px;"><a href="#%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%EF%BC%9A%E9%9A%8F%E6%9C%BA%E6%B7%BB%E5%8A%A0%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%E5%92%8C%E9%AB%98%E6%96%AF%E5%99%AA%E5%A3%B0Python">图像处理：随机添加椒盐噪声和高斯噪声Python</a></p>
<p id="1.%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9B%BE%E5%83%8F%E5%99%AA%E5%A3%B0-toc" style="margin-left:40px;"><a href="#1.%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9B%BE%E5%83%8F%E5%99%AA%E5%A3%B0">1.常见的图像噪声</a></p>
<p id="%EF%BC%881%EF%BC%89%E9%AB%98%E6%96%AF%E5%99%AA%E5%A3%B0-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E9%AB%98%E6%96%AF%E5%99%AA%E5%A3%B0">（1）高斯噪声</a></p>
<p id="%EF%BC%882%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0">（2） 椒盐噪声</a></p>
<p id="2.%E7%94%9F%E6%88%90%E5%9B%BE%E5%83%8F%E5%99%AA%E5%A3%B0-toc" style="margin-left:40px;"><a href="#2.%E7%94%9F%E6%88%90%E5%9B%BE%E5%83%8F%E5%99%AA%E5%A3%B0">2.生成图像噪声</a></p>
<p id="%EF%BC%881%EF%BC%89%E9%AB%98%E6%96%AF%E5%99%AA%E5%A3%B0-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E9%AB%98%E6%96%AF%E5%99%AA%E5%A3%B0">（1）高斯噪声</a></p>
<p id="%EF%BC%882%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%EF%BC%88%E9%80%9F%E5%BA%A6%E6%85%A2%EF%BC%89-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%EF%BC%88%E9%80%9F%E5%BA%A6%E6%85%A2%EF%BC%89">（2） 椒盐噪声（速度慢）</a></p>
<p id="%EF%BC%883%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%EF%BC%88%E5%BF%AB%E9%80%9F%E7%89%88%EF%BC%89-toc" style="margin-left:80px;"><a href="#%EF%BC%883%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%EF%BC%88%E5%BF%AB%E9%80%9F%E7%89%88%EF%BC%89">（3） 椒盐噪声（快速版）</a></p>
<p id="3.%20Demo%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#3.%20Demo%E6%B5%8B%E8%AF%95">3. Demo测试</a></p>
<hr/>
<p>        图像噪声是指存在于图像数据中的不必要的或多余的干扰信息。在噪声的概念中，通常采用信噪比（Signal-Noise Rate, SNR）衡量图像噪声。通俗的讲就是信号占多少，噪声占多少，SNR越小，噪声占比越大。</p>
<p>【尊重原则，转载请注明出处】<a href="https://panjinquan.blog.csdn.net/article/details/126542210" title="https://panjinquan.blog.csdn.net/article/details/126542210">https://panjinquan.blog.csdn.net/article/details/126542210</a></p>
<hr/>
<h2 id="1.%E5%B8%B8%E8%A7%81%E7%9A%84%E5%9B%BE%E5%83%8F%E5%99%AA%E5%A3%B0">1.常见的图像噪声</h2>
<h3 id="%EF%BC%881%EF%BC%89%E9%AB%98%E6%96%AF%E5%99%AA%E5%A3%B0">（1）高斯噪声</h3>
<p>        高斯噪声Gaussian noise，是指它的概率密度函数服从高斯分布（即正态分布）的一类噪声，通常是因为不良照明和高温引起的传感器噪声。</p>
<p class="img-center"><img alt="" height="255" src="image\afa278d6c8d3423184e5af17915df948.png" width="251"/></p>
<h3 id="%EF%BC%882%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0"><strong>（2） 椒盐噪声</strong></h3>
<p>        椒盐噪声salt-and-pepper noise，又称为脉冲噪声，它是一种随机出现的白点（盐噪声）或者黑点（椒噪声），通常是由图像传感器，传输信道，解压处理等产生的黑白相间的亮暗点噪声（椒-黑，盐-白）。常用的去除这种噪声的有效手段是使用<a href="https://baike.baidu.com/item/%E4%B8%AD%E5%80%BC%E6%BB%A4%E6%B3%A2%E5%99%A8" title="中值滤波器">中值滤波器</a>。</p>
<p class="img-center"><img alt="" height="253" src="image\45562e4360dd495db1b9fc187aaea0e5.png" width="254"/></p>
<p><a name="ref_1"></a></p>
<hr/>
<h2 id="2.%E7%94%9F%E6%88%90%E5%9B%BE%E5%83%8F%E5%99%AA%E5%A3%B0">2.生成图像噪声</h2>
<p>在原始图像基础上加上噪声分量，即可生成图像噪声</p>
<h3>（1）高斯噪声</h3>
<pre><code class="language-python">def gaussian_noise(image, mean=0.1, sigma=0.1):
    """
    添加高斯噪声
    :param image:原图
    :param mean:均值
    :param sigma:标准差 值越大，噪声越多
    :return:噪声处理后的图片
    """
    image = np.asarray(image / 255, dtype=np.float32)  # 图片灰度标准化
    noise = np.random.normal(mean, sigma, image.shape).astype(dtype=np.float32)  # 产生高斯噪声
    output = image + noise  # 将噪声和图片叠加
    output = np.clip(output, 0, 1)
    output = np.uint8(output * 255)
    return output
</code></pre>
<h3 id="%EF%BC%882%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%EF%BC%88%E9%80%9F%E5%BA%A6%E6%85%A2%EF%BC%89"><strong>（2） 椒盐噪声（速度慢）</strong></h3>
<p>常规的方法，需要遍历每个像素，添加椒盐噪声，该方法十分缓慢。Python语言十分不建议进行图像像素遍历操作，毕竟性能太差，速度太慢了（除非写成C/C++版本）。我们可以借助numpy的矩阵处理，实现快速的添加<strong>椒盐噪声。</strong></p>
<pre><code class="language-python">def salt_pepper_noise(image: np.ndarray, prob=0.01):
    """
    添加椒盐噪声，该方法需要遍历每个像素，十分缓慢
    :param image:
    :param prob: 噪声比例
    :return:
    """
    for i in range(image.shape[0]):
        for j in range(image.shape[1]):
            if random.random() &lt; prob:
                image[i][j] = 0 if random.random() &lt; 0.5 else 255
            else:
                image[i][j] = image[i][j]
    return image</code></pre>
<h3 id="%EF%BC%883%EF%BC%89%20%E6%A4%92%E7%9B%90%E5%99%AA%E5%A3%B0%EF%BC%88%E5%BF%AB%E9%80%9F%E7%89%88%EF%BC%89"><strong>（3） 椒盐噪声（快速版）</strong></h3>
<p>我们可以借助numpy的矩阵处理，实现快速的添加<strong>椒盐噪声。</strong>基本思路：利用np.random.uniform生成0~1的均匀噪声（ uniform distribution noise），然后将noise &gt; prob的像素设置0或者255，这样通过矩阵的处理，可以快速添加椒盐噪声。</p>
<pre><code class="language-python">def fast_salt_pepper_noise(image: np.ndarray, prob=0.02):
    """
    随机生成一个0~1的mask，作为椒盐噪声
    :param image:图像
    :param prob: 椒盐噪声噪声比例
    :return:
    """
    image = add_uniform_noise(image, prob * 0.51, vaule=255)
    image = add_uniform_noise(image, prob * 0.5, vaule=0)
    return image


def add_uniform_noise(image: np.ndarray, prob=0.05, vaule=255):
    """
    随机生成一个0~1的mask，作为椒盐噪声
    :param image:图像
    :param prob: 噪声比例
    :param vaule: 噪声值
    :return:
    """
    h, w = image.shape[:2]
    noise = np.random.uniform(low=0.0, high=1.0, size=(h, w)).astype(dtype=np.float32)  # 产生高斯噪声
    mask = np.zeros(shape=(h, w), dtype=np.uint8) + vaule
    index = noise &gt; prob
    mask = mask * (~index)
    output = image * index[:, :, np.newaxis] + mask[:, :, np.newaxis]
    output = np.clip(output, 0, 255)
    output = np.uint8(output)
    return output
</code></pre>
<h2 id="3.%20Demo%E6%B5%8B%E8%AF%95">3. Demo性能测试</h2>
<p>需要用到pybaseutils工具，pip安装即可</p>
<pre><code class="language-python"># -*-coding: utf-8 -*-
"""
    @Author : panjq
    @E-mail : pan_jinquan@163.com
    @Date   : 2022-07-27 15:23:24
    @Brief  :
"""
import cv2
import random
import numpy as np
from pybaseutils import time_utils


@time_utils.performance("gaussian_noise")
def gaussian_noise(image, mean=0.1, sigma=0.1):
    """
    添加高斯噪声
    :param image:原图
    :param mean:均值
    :param sigma:标准差 值越大，噪声越多
    :return:噪声处理后的图片
    """
    image = np.asarray(image / 255, dtype=np.float32)  # 图片灰度标准化
    noise = np.random.normal(mean, sigma, image.shape).astype(dtype=np.float32)  # 产生高斯噪声
    output = image + noise  # 将噪声和图片叠加
    output = np.clip(output, 0, 1)
    output = np.uint8(output * 255)
    return output


@time_utils.performance("salt_pepper_noise")
def salt_pepper_noise(image: np.ndarray, prob=0.01):
    """
    添加椒盐噪声，该方法需要遍历每个像素，十分缓慢
    :param image:
    :param prob: 噪声比例
    :return:
    """
    for i in range(image.shape[0]):
        for j in range(image.shape[1]):
            if random.random() &lt; prob:
                image[i][j] = 0 if random.random() &lt; 0.5 else 255
            else:
                image[i][j] = image[i][j]
    return image


@time_utils.performance("fast_salt_pepper_noise")
def fast_salt_pepper_noise(image: np.ndarray, prob=0.02):
    """
    随机生成一个0~1的mask，作为椒盐噪声
    :param image:图像
    :param prob: 椒盐噪声噪声比例
    :return:
    """
    image = add_uniform_noise(image, prob * 0.51, vaule=255)
    image = add_uniform_noise(image, prob * 0.5, vaule=0)
    return image


def add_uniform_noise(image: np.ndarray, prob=0.05, vaule=255):
    """
    随机生成一个0~1的mask，作为椒盐噪声
    :param image:图像
    :param prob: 噪声比例
    :param vaule: 噪声值
    :return:
    """
    h, w = image.shape[:2]
    noise = np.random.uniform(low=0.0, high=1.0, size=(h, w)).astype(dtype=np.float32)  # 产生高斯噪声
    mask = np.zeros(shape=(h, w), dtype=np.uint8) + vaule
    index = noise &gt; prob
    mask = mask * (~index)
    output = image * index[:, :, np.newaxis] + mask[:, :, np.newaxis]
    output = np.clip(output, 0, 255)
    output = np.uint8(output)
    return output


def cv_show_image(title, image, use_rgb=True, delay=0):
    """
    调用OpenCV显示RGB图片
    :param title: 图像标题
    :param image: 输入是否是RGB图像
    :param use_rgb: True:输入image是RGB的图像, False:返输入image是BGR格式的图像
    :return:
    """
    img = image.copy()
    if img.shape[-1] == 3 and use_rgb:
        img = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)  # 将BGR转为RGB
    # cv2.namedWindow(title, flags=cv2.WINDOW_AUTOSIZE)
    cv2.namedWindow(title, flags=cv2.WINDOW_NORMAL)
    cv2.imshow(title, img)
    cv2.waitKey(delay)
    return img


if __name__ == "__main__":
    test_file = "test.png"
    image = cv2.imread(test_file)
    prob = 0.02
    for i in range(10):
        out1 = gaussian_noise(image.copy())
        out2 = salt_pepper_noise(image.copy(), prob=prob)
        out3 = fast_salt_pepper_noise(image.copy(), prob=prob)
        print("----" * 10)
    cv_show_image("image", image, use_rgb=False, delay=1)
    cv_show_image("gaussian_noise", out1, use_rgb=False, delay=1)
    cv_show_image("salt_pepper_noise", out2, use_rgb=False, delay=1)
    cv_show_image("fast_salt_pepper_noise", out3, use_rgb=False, delay=0)
</code></pre>
<p>循环机10次，salt_pepper_noise平均耗时125.49021ms，而fast_salt_pepper_noise平均耗时6.12011ms ，性能提高60倍左右，其生成的效果是基本一致的</p>
<blockquote>
<p>call gaussian_noise elapsed: avg:19.42925ms     total:194.29255ms     count:10<br/> call salt_pepper_noise elapsed: avg:125.49021ms     total:1254.90212ms     count:10<br/> call fast_salt_pepper_noise elapsed: avg:6.12011ms     total:61.20110ms     count:10 </p>
</blockquote>
<table border="1" cellpadding="1" cellspacing="1" style="width:700px;"><tbody><tr><td style="text-align:center;">原图</td><td style="text-align:center;">高斯噪声</td></tr><tr><td> <p class="img-center"><img alt="" height="255" src="image\c6546e2427bd49c788d8a4adf0fae87f.png" width="255"/></p> </td><td style="text-align:center;"><img alt="" height="255" src="image\afa278d6c8d3423184e5af17915df948.png" width="251"/></td></tr><tr><td> <p style="text-align:center;">salt_pepper_noise</p> </td><td style="text-align:center;"> <p style="text-align:center;">fast_salt_pepper_noise</p> </td></tr><tr><td style="text-align:center;"><img alt="" height="253" src="image\45562e4360dd495db1b9fc187aaea0e5.png" width="254"/></td><td style="text-align:center;"><img alt="" height="254" src="image\00b6152bd1f4491aae165bda66b2937b.png" width="255"/></td></tr></tbody></table>
<p></p>
<blockquote></blockquote>
<p></p>
</div>
</div>