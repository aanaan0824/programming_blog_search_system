<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h2><a id="C_0"></a>C#编写串口助手</h2>
<p>借鉴了很大部分下面文章的内容，我也修改了很多，最后完善成了一个完整的串口助手。<br/> <a href="https://blog.csdn.net/weixin_43006196/article/details/84013125">C#编写串口助手</a><br/> 1.UI设置<br/> <img alt="UI截图" src="https://img-blog.csdnimg.cn/b2ee84da554e45ee8760531f4f1fe3f9.png#pic_center"/></p>
<h3><a id="Windows_6"></a>①创建Windows窗口应用程序。</h3>
<p>文件—新建—项目，选择Visual C#，选择Windows窗体应用程序，名称：项目名称"调试串口助手"，位置：保存项目的路径，解决方案：创建新的解决方案（添加到解决方案），解决方案名称：自动生成与项目名称相同，框架：.NET Framework 4.7，默认勾选为解决方案创建目录，点击确定。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6803fc39c57f476d80b2962f24b0370a.png#pic_center"/><br/> 创建新项目后可以看到Form1.cs[设计]，这是自动生成的窗体应用，在这个页面利用左边工具栏和对应UI的属性可以设计UI。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5db5ea952b594e6b90538d39b6f03f78.png#pic_center"/><br/> 找到解决中的Form1.cs，右键-&gt;查看代码，可以代码文件。</p>
<h3><a id="_14"></a>②创建窗体的界面。</h3>
<p>Form1窗体添加三个GroupBox控件，Text分别设置为：串口设置、接收数据、发送数据。</p>
<p>Form1窗体添加五个Lable控件，Text分别设置为：串口号：、波特率：、停止位：、奇偶校验：、数据位：。</p>
<p>Form1窗体添加五个ComoBox控件，Name分别设置为：cbxCOMPort、cbxBaudRate、cbxStopBits、cbxParity、cbxDataBits。</p>
<p>Form1窗体添加两个RadioButton控件，Text分别设置为：字符显示、HEX显示，Name分别设置为：rbnChar、rbnHex，</p>
<p>Checked分别为：True、False。</p>
<p>Form1窗体添加八个Button控件，Text分别设置为：检测串口、打开串口、清空数据、发送数据、AT、ATI8、选择文件、发送文件。<br/> 注：笔者截图里发送AT命令远不止两个按钮是因为此类命令代码非常相似，于是就只写了两个。</p>
<p>Name分别设置为：btnCheckCom、btnOpenCom、btnClearData、btnSendData。</p>
<p>Form1窗体添加三个TextBox控件，Name分别设置为：tbxRecvData、tbxSendData、filename_test_box，filename_test_box、tbxRecvData和的ReadOnly属性设置为True。</p>
<p>Fomr1窗体的AcceptButton属性设置为btnSendData，在窗体上回车关联到发送数据按钮。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/dfc67378bc0e47ba838557a06fa14a86.png#pic_center"/></p>
<h3><a id="_36"></a>③代码编写。</h3>
<p>代码＋注释如下：</p>
<pre><code class="prism language-csharp"><span class="token comment">//新手可以下载一个vspn创建虚拟串口搭配使用:)</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>ComponentModel</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Data</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Drawing</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO<span class="token punctuation">.</span>Ports</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> 调试串口工具
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Form1</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Form</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">bool</span></span> isHex <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//十六进制显示标志位</span>
        <span class="token class-name"><span class="token keyword">bool</span></span> isOpen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//打开串口标志位</span>
        <span class="token class-name"><span class="token keyword">bool</span></span> isSetProperty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//属性设置标志位</span>
        <span class="token class-name"><span class="token keyword">bool</span></span> isfiletranfers <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//文件传输标志位</span>
        <span class="token class-name">SerialPort</span> serialportcom <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">Form1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Form1_Load</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//设置窗口大小</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>MaximizeBox <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//影藏最大化按钮</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>MaximumSize <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Size<span class="token punctuation">;</span>    <span class="token comment">//固定窗口尺寸最大为当前尺寸</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>MinimumSize <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Size<span class="token punctuation">;</span>    <span class="token comment">//固定窗口尺寸最小为当前尺寸</span>
            <span class="token comment">//Form1.refresh();</span>

            <span class="token comment">//设置波特率</span>
            cbxBaudRate<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"1200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxBaudRate<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"2400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxBaudRate<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"4800"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxBaudRate<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"9600"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxBaudRate<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"19200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxBaudRate<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"38400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxBaudRate<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"115200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxBaudRate<span class="token punctuation">.</span>SelectedIndex <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token comment">//列出停止位</span>
            cbxStopBits<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxStopBits<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxStopBits<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"1.5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxStopBits<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxStopBits<span class="token punctuation">.</span>SelectedIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">//列出数据位</span>
            cbxDataBits<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxDataBits<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxDataBits<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxDataBits<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxDataBits<span class="token punctuation">.</span>SelectedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">//列出奇偶检验</span>
            cbxParity<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"无"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxParity<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"奇校验"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxParity<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">"偶校验"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cbxParity<span class="token punctuation">.</span>SelectedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">//默认接受到的数据用字符显示</span>
            rbnChar<span class="token punctuation">.</span>Checked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnCheckCom_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">bool</span></span> comExistence <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//有可用串口标志位</span>
            cbxCOMPort<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//将读取到的串口号写入选项框</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sPortName <span class="token keyword">in</span> SerialPort<span class="token punctuation">.</span><span class="token function">GetPortNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{<!-- --></span>
                    
                    cbxCOMPort<span class="token punctuation">.</span>Items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>sPortName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    comExistence <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>comExistence<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                cbxCOMPort<span class="token punctuation">.</span>SelectedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"没有找到可用的串口！"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">checkPortSetting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//检测串口设置</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxCOMPort<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxBaudRate<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxDataBits<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxParity<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxStopBits<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CheckSendData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//检测发送数据是否输入</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tbxSendData<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">CheckFileSendData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>filename_test_box<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetPortProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//设置串口的属性</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//创建串口</span>
            serialportcom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SerialPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置串口名</span>
            serialportcom<span class="token punctuation">.</span>PortName <span class="token operator">=</span> cbxCOMPort<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置串口波特率</span>
            serialportcom<span class="token punctuation">.</span>BaudRate <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>cbxBaudRate<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置串口数据位</span>
            serialportcom<span class="token punctuation">.</span>DataBits <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>cbxDataBits<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置串口停止位</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxStopBits<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                serialportcom<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxStopBits<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                serialportcom<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>One<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxStopBits<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"1.5"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                serialportcom<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>OnePointFive<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxStopBits<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                serialportcom<span class="token punctuation">.</span>StopBits <span class="token operator">=</span> StopBits<span class="token punctuation">.</span>Two<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//设置校验</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxParity<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"无"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                serialportcom<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>None<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxParity<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"奇校验"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                serialportcom<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>Odd<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cbxParity<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"偶校验"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                serialportcom<span class="token punctuation">.</span>Parity <span class="token operator">=</span> Parity<span class="token punctuation">.</span>Even<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            serialportcom<span class="token punctuation">.</span>ReadTimeout <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span><span class="token comment">//设置超时读取时间</span>
            serialportcom<span class="token punctuation">.</span>RtsEnable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            serialportcom<span class="token punctuation">.</span>DataReceived <span class="token operator">+=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SerialDataReceivedEventHandler</span><span class="token punctuation">(</span>serialportcom_DataReceived<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//接受数据事件监听</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rbnHex<span class="token punctuation">.</span>Checked<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                isHex <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                isHex <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnOpenCom_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">checkPortSetting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//检测串口设置</span>
                <span class="token punctuation">{<!-- --></span>
                    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"串口未设置"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isSetProperty<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">SetPortProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    isSetProperty <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{<!-- --></span>
                    serialportcom<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    isOpen <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    btnOpenCom<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"关闭串口"</span><span class="token punctuation">;</span>
                    <span class="token comment">//串口打开后，相关的串口设置按钮不再可用</span>
                    cbxCOMPort<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    cbxBaudRate<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    cbxDataBits<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    cbxStopBits<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    cbxParity<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    rbnChar<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    rbnHex<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    btnCheckCom<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    isSetProperty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//串口设置标志位设置为false</span>
                    isOpen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//串口打开标志位设置为false</span>
                    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"串口无效或被占用"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打开失败提示消息框</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token comment">//之前串口是打开的，则执行else语句块</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{<!-- --></span>
                    serialportcom<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭串口</span>
                    isOpen <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token comment">//串口打开标志位设置为false</span>
                    btnOpenCom<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"打开串口"</span><span class="token punctuation">;</span>    <span class="token comment">//btnOpenCom的文本设置为“打开串口”</span>
                    cbxCOMPort<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//串口号使能</span>
                    cbxBaudRate<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//波特率</span>
                    cbxDataBits<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//数据位</span>
                    cbxStopBits<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//停止位</span>
                    cbxParity<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//校验</span>
                    rbnChar<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//字符型</span>
                    rbnHex<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//Hex型</span>
                    btnCheckCom<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//检测串口</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"关闭串口时发生错误"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//关闭失败提示消息框</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button2_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span><span class="token comment">//选择文件时间监听</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//新建一个文件对话框</span>
            <span class="token class-name">OpenFileDialog</span> pOpen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OpenFileDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建文件变量</span>
            <span class="token comment">//设置对话框标题</span>
            pOpen<span class="token punctuation">.</span>Title <span class="token operator">=</span> <span class="token string">"打开想要传输的文件"</span><span class="token punctuation">;</span>
            <span class="token comment">//设置打开文件类型</span>
            pOpen<span class="token punctuation">.</span>Filter <span class="token operator">=</span> <span class="token string">"所有文件(*.*)|*.*"</span><span class="token punctuation">;</span>
            <span class="token comment">//监测文件是否存在</span>
            pOpen<span class="token punctuation">.</span>CheckFileExists <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token comment">//文件打开后执行以下程序</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pOpen<span class="token punctuation">.</span><span class="token function">ShowDialog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> DialogResult<span class="token punctuation">.</span>OK<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                filename_test_box<span class="token punctuation">.</span>Text <span class="token operator">=</span> pOpen<span class="token punctuation">.</span>FileName<span class="token punctuation">;</span>
                isfiletranfers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">button1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span><span class="token comment">//发送文件</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name"><span class="token keyword">string</span></span> filenameee <span class="token operator">=</span> filename_test_box<span class="token punctuation">.</span>Text<span class="token punctuation">;</span><span class="token comment">//获取文件名</span>
                    <span class="token class-name">FileStream</span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">OpenRead</span><span class="token punctuation">(</span>@filenameee<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//新建文件流</span>
                    <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> filedata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>fs<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//创建文件内容大小的字节空间</span>
                    fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>filedata<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> filedata<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将文件内容写入字节空间</span>
                    <span class="token class-name"><span class="token keyword">string</span></span> writest <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>filedata<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    filedata <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>writest<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    serialportcom<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>filedata<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> filedata<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//传输字节数组</span>
                                                                      <span class="token comment">//判断文件传输完毕，文件传输标志位变为false</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>serialportcom<span class="token punctuation">.</span>BytesToRead <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        isfiletranfers <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span>
                <span class="token punctuation">{<!-- --></span>
                    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"发送数据时发生错误！"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"串口未打开"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CheckFileSendData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"请输入要发送的数据"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnSendData_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span>    <span class="token comment">//串口打开状态</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Encoding</span> sendData <span class="token operator">=</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span><span class="token function">GetEncoding</span><span class="token punctuation">(</span><span class="token number">936</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//使用合适字符编码，936表示GB2312</span>
                    <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesSD <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>tbxSendData<span class="token punctuation">.</span>Text<span class="token operator">+</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建字节空间，并写入待传输数据</span>
                    tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> tbxSendData<span class="token punctuation">.</span>Text <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
                    serialportcom<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bytesSD<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesSD<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//串口发送数据</span>
                    tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> <span class="token string">"发送成功"</span> <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span>
                <span class="token punctuation">{<!-- --></span>
                    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"发送数据时发生错误！"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"串口未打开"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CheckSendData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"请输入要发送的数据"</span><span class="token punctuation">,</span> <span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">serialportcom_DataReceived</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">SerialDataReceivedEventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>

            System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//延时100ms，等待接收完数据</span>
            <span class="token comment">//MessageBox.Show("收到数据");</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">(</span>EventHandler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">delegate</span>    <span class="token comment">//this.Invoke是跨线程访问ui的方法，也是文本的范例</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>isHex <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> <span class="token string">"正在接收数据...."</span> <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
                        <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>serialportcom<span class="token punctuation">.</span>BytesToRead<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//创建一个缓冲区数据大小的字节空间</span>
                        serialportcom<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//读取缓冲区的数据，并将其写入a的空间中</span>
                        <span class="token class-name"><span class="token keyword">string</span></span> recvstring <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//解码出a中的字符信息</span>
                        tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> recvstring <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">Byte<span class="token punctuation">[</span><span class="token punctuation">]</span></span> ReceivedData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Byte</span><span class="token punctuation">[</span>serialportcom<span class="token punctuation">.</span>BytesToRead<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//定义并初始化字符数组，sp.ByteToRead串口读字符串长度</span>
                        serialportcom<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>ReceivedData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ReceivedData<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//字符数组读取串口数据</span>
                        <span class="token class-name">String</span> RecvDataText <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token comment">//定义字符串</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ReceivedData<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{<!-- --></span>
                            RecvDataText <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">"0X"</span> <span class="token operator">+</span> ReceivedData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"X2"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//串口接收字符数组，字符依次转换为字符串，0Xxx</span>
                            RecvDataText <span class="token operator">+=</span><span class="token string">"\r\n"</span><span class="token punctuation">;</span>                                                                  <span class="token comment">//X2：X是十六进制，2是两位。（A X2--0X0A，A X---0XA）</span>
                        <span class="token punctuation">}</span>
                        tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> RecvDataText<span class="token punctuation">;</span>     <span class="token comment">//转换后的字符串显示到tbxRecvData上面</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token string">"数据接受失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                serialportcom<span class="token punctuation">.</span><span class="token function">DiscardInBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//清除串口接收缓冲区数据</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnClearData_Click_1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span><span class="token comment">//清空数据</span>
        <span class="token punctuation">{<!-- --></span>
            tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            tbxSendData<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            filename_test_box<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnAT1_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Encoding</span> sendData <span class="token operator">=</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span><span class="token function">GetEncoding</span><span class="token punctuation">(</span><span class="token number">936</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//使用合适字符编码，936表示GB2312</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesSD <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"AT"</span> <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建字节空间，并写入待传输数据</span>
            tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> btnAT1<span class="token punctuation">.</span>Text <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
            serialportcom<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bytesSD<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesSD<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//串口发送数据</span>
            tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> <span class="token string">"发送成功"</span> <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">btnAT2_Click</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Encoding</span> sendData <span class="token operator">=</span> System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>Encoding<span class="token punctuation">.</span><span class="token function">GetEncoding</span><span class="token punctuation">(</span><span class="token number">936</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//使用合适字符编码，936表示GB2312</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesSD <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"ATI8"</span> <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建字节空间，并写入待传输数据</span>
            tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> btnAT2<span class="token punctuation">.</span>Text <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
            serialportcom<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bytesSD<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesSD<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//串口发送数据</span>
            tbxRecvData<span class="token punctuation">.</span>Text <span class="token operator">+=</span> <span class="token string">"发送成功"</span> <span class="token operator">+</span> <span class="token string">"\r\n"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>