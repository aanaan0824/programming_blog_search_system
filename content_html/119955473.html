<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="_0"></a>序</h1>
<p>在跟着Vuforia官网教程实现的时候感觉很多东西没有讲清楚，在网上自己搜索相关教程的时候发现许多博客采用的Vuforia的版本过于老旧，已经不适用了。因此也就催生了这篇博客，希望让读者看完之后都能够从0开始将Vuforia图像识别的功能跑起来。</p>
<h1><a id="_2"></a>环境</h1>
<ul><li>Unity版本：2020.3.x（Vuforia的例程只支持这个版本与2021.1.x）</li><li>Hololens 2</li><li>Vuforia SDK版本：10.1</li></ul>
<h1><a id="Vuforia_8"></a>Vuforia官方例程</h1>
<p>要配置自己的工程之前建议把Vuforia提供的<a href="https://library.vuforia.com/articles/Solution/Working-with-the-HoloLens-sample-in-Unity.html">官方例程</a>先跑通，其中还需要结合Holens2配置的<a href="https://docs.microsoft.com/en-us/windows/mixed-reality/develop/unity/tutorials/mr-learning-base-02?tabs=openxr">官网教程</a>。我把两个教程综合了一下，按如下步骤配置即可（如有写的不详细的地方还请移步上述两个链接）。</p>
<ol><li> <p>确保Unity安装了Windows Build Support（IL2CPP）与Universal Windows Platform Build Support<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8677ed3c15fc4f1abd398709fccff87a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_8,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p> </li><li> <p>创建新的Unity工程，在File-&gt;Build Setting中切换平台至Universal Windows Platform，对右侧的选项进行如下配置：<img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/e7e45f0f22544880ab96f389a9389c55.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_19,color_FFFFFF,t_70,g_se,x_16#pic_center" width="60%"/></p> </li><li> <p>到Vuforia官网上注册并下载SDK，下载链接：<a href="https://developer.vuforia.com/downloads/sdk">Vuforia Engine</a>，版本选择10.1</p> </li><li> <p>下载MRTK管理工具，下载链接：<a href="https://www.microsoft.com/en-us/download/details.aspx?id=102778">MRTK</a>。（之前MRTK是unity包的形式，每次要下载再导入很麻烦，现在有统一管理工具辣）</p> </li><li> <p>在Unity中选择Assets-&gt;Import Package-&gt;Custom Package，导入下载的Vuforia包，中间有提示说要升级工程 ，选择“Update”即可。<img alt="在这里插入图片描述" height="50%" src="https://img-blog.csdnimg.cn/31a3bd33d0a84f85be868c7f3499ec98.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_11,color_FFFFFF,t_70,g_se,x_16#pic_center" width="50%"/></p> </li><li> <p>在网页中打开Asset Store，搜索“Hololens Vuforia”，订阅“Vuforia Hololens 1+2 Sample for Unity 2020.3 LTS”（此处选择在Unity中打开似乎会失败，因为Unity2020版本统一用Package Manager对商店的包进行管理，而在此之前的Unity版本能够直接跳转到Unity中，打开Asset Store并直接导入包）<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f8879c4510d34dea91f4d5d55c6620d2.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p> </li><li> <p>打开Windows-&gt;Package Manager，可以在其中看到Vuforia Engine AR，代表Vuforia安装成功，注意其版本为10.1.4。<img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/df5106ebdaf9458caf45d893a720d148.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/></p> </li><li> <p>左上角Packages下拉栏中选择My Assets，并搜索“Vuforia”即可看到刚才在Asset Store中订阅的例程，并选择“Import”。此处务必<font color="red">注意例程的版本与Vuforia的版本应该一致（此处皆为10.1.4），如果不一致的话右下角会出现“Update”的选项可以进行升级。</font><img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/7c3f97c9c24c4233b7dc07c77c1b59ec.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/><br/> 之后会提示覆盖当前工程的配置，选择“Import”；提示需要Package Manager dependencies，选择“Install/Upgrade”。</p> </li><li> <p>下一步对Unity中Hololens的部分进行配置（此步骤放在Vuforia之后是因为Vuforia的例程会覆盖当前工程的设置）。首先导入MRTK，打开刚才下载并安装的Mixed Reality Feature Tool，选择工程路径以后选择“Discover features”，之后选择<strong>Mixed Reality Toolkit Foundation</strong>和<strong>Mixed Reality Toolkit Extensions</strong>并且点击“Get features”。<font color="red">在Hololens官网中对Unity2020的配置可与选择OpenXR或者Windows XR plugin，此处的选择是后者，因为前者实测与Vuforia的兼容性有点问题，例程跑不起来。</font>之后选择“Import”。<br/> <img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/592124ddb18646d99a17346fbe93ed1f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/></p> </li><li> <p>导入之后选择Edit-&gt;Project Settings，在最下方的XR Plugin Management中勾选“<strong>Initialize XR on Startup</strong>”与下方的“<strong>Windows Mixed Reality</strong>”。之后选择左侧的Player栏，在“Resolution and Presentation”中<strong>取消</strong>“<strong>Run in Background</strong>”<strong>的对勾</strong>，Default Orientation选的是“<strong>Landscape Left</strong>”。在“Publishing Settings”中修改Package name，确保Capabilities中的Internet Client, WebCam, Microphone, SpatialPerception以及Supported Device Families中的Holographic都勾选上了。关闭该界面。 <img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/5201a78d336d4e42a32c938f000457ed.png#pic_center" width="60%"/><img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/fc1d2513e2e44793a0466f1820ef8abd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="60%"/></p> </li><li> <p>如果有出现MRTK的弹窗选择“Apply”即可。官网配置中会要求从上方“Mixed Reality Toolkit”中选择“Add to Scene and configure…”，<font color="red">但是导入的例程会自带MRTK的配置，因此不需要选择该选项。</font> 之后可以从下方选择Assets-&gt;SampleResources-&gt;Scenes中打开0-ManagerScene，选中左侧“MixedRealityPlayspace”的子物体“Main camera”，并在右边找到<strong>Vuforia Behaviour</strong>并点击“Open Vuforia Engine configuration”。<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1ee2adee481d445ca3ce20de5a3e9305.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p> </li><li> <p>打开<a href="https://developer.vuforia.com/">Vuforia官网</a>并登陆，选择上方Develop并选择“Get Component Key”,输入名称后确认。<br/> <img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/2fb50e109e9148d792a462e0a8b3da5d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/></p> </li><li> <p>打开刚才创建的Key，并且复制授权码<img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/ef8e96839cbc4fa9904d785f7a78f40a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="60%"/><br/> 粘贴到刚才打开的Vuforia Configuration中的<strong>App Licsense Key</strong>中<img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/5cea299f65ad49e9aa28792898438d3f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_13,color_FFFFFF,t_70,g_se,x_16#pic_center" width="60%"/></p> </li><li> <p>点击File-&gt;Build Settings，确保五个场景已经添加到Scenes In Build中，点击Build，并创建一个“App”文件夹到其中。</p> </li><li> <p>用数据线连接电脑与Hololens2（无线也可以进行部署，但部署速度不如有线，而且经常连接不稳定会断开）。用Visual Studio打开工程，在上方选择“<strong>Release</strong>”、“<strong>ARM64</strong>”、“<strong>Device</strong>”，点击绿色小箭头。<font color="red">有时候会提示超时错误，拔插一下数据线重新部署就可以了。</font>（不要在VS调试模式下运行程序，会很卡。结束调试以后在Hololens中打开即可）<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9011139f098748678b41a49ee2bfdd90.png#pic_center"/></p> </li><li> <p>从<a href="https://library.vuforia.com/sites/default/files/vuforia-library/docs/target_samples/unity/mars_target_images.pdf">此处</a>下载四张图片并打印（黑白即可，无需彩色）。</p> </li><li> <p>部署完成后从Hololens中打开App并选择“ImageTargets”<img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/dd180777b4724aedadf87bef2069fc90.jpg?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/><br/> 之后看到如下界面<img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/37251bf9f51d4020b6b8e341ee6bad04.jpg?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/><br/> 可以对四副测试样例进行识别与增强<br/> <img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/bd0f238f7b4d4b9e8b108645d1946715.jpg?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/></p> </li></ol>
<h1><a id="Vuforia_46"></a>部署自己的Vuforia应用</h1>
<p>以上都是官网上给出的例程，下面来介绍如何配置配置自己的Vuforia应用：</p>
<ol><li>在官网点击选中Develop界面中，点击Target Manager，点击Add Database，Type选择“Device”<img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/2b2a72d5677c426f9da5a9402863a067.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/></li><li>选中数据集，点击“Add Target”。<img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/767fba6f5ce74432b17e05513c08162a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/></li><li>上传自己的需要识别的AR图片（图片应该尽可能纹理丰富以便于识别）。<font color="red">注意在Width处应填写在真实空间中图片的宽度（米为单位)。也就是说应该把你需要识别的图片打印出来，测量其宽度并填写，长度会根据你上传的图片自动换算，因此不需要你填写。</font><img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/10a80862dd2042b6ba44f557a560fe0f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_18,color_FFFFFF,t_70,g_se,x_16#pic_center" width="60%"/><br/> 可以点开你的图片，查看识别的关键点以及图像可用性的评分<img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/92d9cd9e93394320aab141f2e490a51f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/></li><li>选中你刚添加的图片，点击“Download Database”，选项选择“Unity Editor”。之后会下载一个Unity包，导入Unity中。</li><li>建立一个新的工程，按照上一个阶段例程配置中步骤1-5、9-10对Vuforia以及Hololens部分进行配置</li><li><strong>通过Unity上方的Mixed Reality Toolkit点击“Add to Scene and configure…”来添加MRTK管理工具</strong>（由于是自己建立的工程，因此需要手动添加MRTK）</li><li><strong>给MixedRealityPlayspace的子物体Main Camera添加控件Vuforia Behaviour</strong>（无需添加官方提到的AR Camera），按上一个阶段例程配置中步骤12-13来配置授权码（用之前的也可以，无需新建）。<font color="red">在下方Max Simultanesous Tracked Images选项上将需要识别图像的数目改为特定值，代表能同时识别多少张图片。</font></li><li>这一步比较重要，在测试的时候发现用默认的MRTK配置出来的工程无法进行识别，因此<strong>需要将Vuforia例程的配置文件拷贝到当前工程目录下</strong>。<font color="red">具体操作是将上一节例程工程文件夹下Assets-&gt;MRTK-&gt;MixedRealityToolkit.Generated-&gt;CustomProfiles中的配置文件拷贝到当前工程下Assets-&gt;MixedRealityToolkit.Generated-&gt;CustomProfiles中。</font><img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/6dfe0f43cf7e4ca4a6707a9a59ada930.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="60%"/></li><li><font color="red">在Unity的Hierachy中选中MixedRealityToolkit物体，在右侧配置文件处选择VuforiaXRMRTKConfigurationProfile</font><img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/f4d62db7fb56472b8e3d7cbaa6dc672e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_14,color_FFFFFF,t_70,g_se,x_16#pic_center" width="60%"/></li><li>在Unity上方栏处选择GameObject-&gt;Vuforia Engine-&gt;ImageTarget，就会添加一个带追踪的图像对象。刚才我们已经把需要追踪的图片打包并导入到Unity中了，因此在右侧Image Target Behaviour脚本中将Type选为“<strong>From Database</strong>”，并选择刚才导入的Database与图像<img alt="在这里插入图片描述" height="60%" src="https://img-blog.csdnimg.cn/22d5bd41f6d2464aa9fcf513bb14dce8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_14,color_FFFFFF,t_70,g_se,x_16#pic_center" width="60%"/><br/> 可以看到图像的长度也被自动导入，为0.0537m，也就是真实世界中需要识别的图像应该是5.37cm宽。（另外在下方我们可以看到一个警告符号，提示说extended tracking需要用到DeviceTracker，这个功能的作用是当Hololens中我们对图像进行识别并显示了虚拟物体，那么如果该图像消失在视野里，虚拟物体仍然固定在之前的位置上而不是消失。这一点在做物体标注时很有用，例如我们经过图像校准让标注信息显示在真实物体上，那么当我们转动视野看物体的时候校准图像可能消失在视野里，此时我们仍然希望标注信息固定在原来的位置。这个功能默认是开启的，无需我们过多的操作。）</li><li>我们添加需要展示的虚拟物体作为待识别图像的子物体，这样当识别到图像的时候会显示该物体。例如我们添加一个Cube，调整scale为0.1,0.1,0.1。将其位置放置在待识别物体的上方。<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/19e298bf87844d7c9c71d69bc9bf5b6b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></li><li>打包并部署到Hololens上</li><li>打印出待识别的图像并运行程序（我将官方例程的测试图像也添加进了工程中）。<img alt="在这里插入图片描述" height="80%" src="https://img-blog.csdnimg.cn/56196567032a406fb3e905fcc656ce52.jpg?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAVmVyb3BhdHJpbmljYQ==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" width="80%"/></li></ol>
<h1><a id="_64"></a>参考资料</h1>
<p>1.<a href="https://library.vuforia.com/articles/Solution/Working-with-the-HoloLens-sample-in-Unity.html">https://library.vuforia.com/articles/Solution/Working-with-the-HoloLens-sample-in-Unity.html</a><br/> 2.<a href="https://library.vuforia.com/articles/Training/getting-started-with-vuforia-in-unity.html#intro">https://library.vuforia.com/articles/Training/getting-started-with-vuforia-in-unity.html#intro</a><br/> 3.<a href="https://docs.microsoft.com/en-us/windows/mixed-reality/develop/unity/tutorials/mr-learning-base-02?tabs=winxr">https://docs.microsoft.com/en-us/windows/mixed-reality/develop/unity/tutorials/mr-learning-base-02?tabs=winxr</a><br/> 4.<a href="https://blog.csdn.net/li1214661543/article/details/107820207">https://blog.csdn.net/li1214661543/article/details/107820207</a><br/> 5.<a href="https://www.pianshen.com/article/41031887858/">https://www.pianshen.com/article/41031887858/</a></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>