<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-tomorrow-night" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>文章目录</h3>
<ul><li><a href="#_1">前置导入</a></li><li><a href="#SpringBootRedis_10">SpringBoot整合Redis</a></li><li><ul><li><a href="#Redis_11">Redis基本介绍与安装</a></li><li><a href="#_60">基本操作</a></li><li><a href="#_107">整合</a></li></ul>
</li><li><a href="#SpringBootMongoDB_214">SpringBoot整合MongoDB</a></li><li><ul><li><a href="#MongoDB_215">MongoDB基本介绍与安装</a></li><li><a href="#_300">基本操作</a></li><li><a href="#_377">整合</a></li></ul>
</li><li><a href="#SpringBootES_451">SpringBoot整合ES</a></li><li><ul><li><a href="#ES_452">ES基本介绍与安装</a></li><li><a href="#_539">基本操作</a></li><li><a href="#_842">整合</a></li></ul>
</li></ul>
</div>
<p></p>
<h1><a id="_1"></a>前置导入</h1>
<p>NoSQL我们知道是非关系型数据库。在springboot官方文档中提供了10种相关技术的整合方案。本篇文章中将涉及国内市场上最流行的几款NoSQL数据库整合方案，分别是：</p>
<ul><li>Redis</li><li>MongoDB</li><li>ES</li></ul>
<blockquote>
<p>上述这些技术最佳使用方案都是在Linux服务器上部署,但是本文我们还是使用Windows平台。</p>
</blockquote>
<h1><a id="SpringBootRedis_10"></a>SpringBoot整合Redis</h1>
<h2><a id="Redis_11"></a>Redis基本介绍与安装</h2>
<p>Redis是一款key-value存储结构的内存级NoSQL数据库：</p>
<ul><li>支持多种数据存储格式</li><li>支持持久化</li><li>支持集群</li></ul>
<p>重点关注数据存储格式，是key-value格式，也就是键值对的存储形式。与MySQL数据库不同，MySQL数据库有表、有字段、有记录，Redis没有这些东西，就是一个名称对应一个值，并且数据以存储在内存中使用为主。什么叫以存储在内存中为主？其实Redis有它的数据持久化方案，分别是RDB和AOF，但是Redis自身并不是为了数据持久化而生的，主要是在内存中保存数据，加速数据访问的，所以说是一款内存级数据库。</p>
<p>Redis支持多种数据存储格式，比如可以直接存字符串，也可以存一个map集合，list集合，后面会涉及到一些不同格式的数据操作</p>
<blockquote>
<p>windows版安装包下载地址：https://github.com/tporadowski/redis/releases</p>
</blockquote>
<p>下载的安装包有两种形式，一种是一键安装的msi文件，还有一种是解压缩就能使用的zip文件</p>
<blockquote>
<p>啥是msi，其实就是一个文件安装包，不仅安装软件，还帮你把安装软件时需要的功能关联在一起，打包操作。比如如安装序列、创建和设置安装路径、设置系统依赖项、默认设定安装选项和控制安装过程的属性。说简单点就是一站式服务，安装过程一条龙操作一气呵成，就是为小白用户提供的软件安装程序。</p>
</blockquote>
<p>安装完毕后会得到如下文件，其中有两个文件对应两个命令，是启动Redis的核心命令，需要在CMD命令行模式执行。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f47a32e10bfc46a78b0a44843377e2fb.png"/></p>
<p><strong>启动服务器</strong></p>
<pre><code class="prism language-CMD">redis-server.exe redis.windows.conf
</code></pre>
<blockquote>
<p>这里我们使用的是默认6379端口</p>
</blockquote>
<p><strong>启动客户端</strong></p>
<pre><code class="prism language-CMD">redis-cli.exe
</code></pre>
<p>​ 如果启动redis服务器失败，可以先启动客户端，然后执行shutdown操作后退出，此时redis服务器就可以正常执行了。</p>
<p>我们来演示一下：</p>
<p>首先启动服务器，发现启动失败：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f331fa0667324b16b4293b9fd6349ca6.png"/></p>
<p>然后我们继续：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2d3a00e1abd046ef8da0dff19a970815.png"/><br/> 再去开启服务器，ok：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b23560db835d45eab40cb921b363d118.png"/><br/> 出现这个图象就说明服务器已经开启成功了！</p>
<h2><a id="_60"></a>基本操作</h2>
<p>服务器启动后，使用客户端就可以连接服务器，类似于启动完MySQL数据库，然后启动SQL命令行操作数据库。</p>
<p>​ 放置一个字符串数据到redis中，先为数据定义一个名称，比如name,age等，然后使用命令set设置数据到redis服务器中即可</p>
<pre><code class="prism language-CMD">set name nefu
set age 12
</code></pre>
<p>​ 从redis中取出已经放入的数据，根据名称取，就可以得到对应数据。如果没有对应数据就会得到(nil)</p>
<pre><code class="prism language-CMD">get name
get age
</code></pre>
<p>例如：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0308678a09a74246bbb440a0f993bea8.png"/></p>
<p>以上使用的数据存储是一个名称对应一个值，如果要维护的数据过多，可以使用别的数据存储结构。例如hash，它是一种一个名称下可以存储多个数据的存储模型，并且每个数据也可以有自己的二级存储名称。向hash结构中存储数据格式如下：</p>
<pre><code>hset a a1 aa1		#对外key名称是a，在名称为a的存储模型中，a1这个key中保存了数据aa1
hset a a2 aa2
</code></pre>
<p>​ 获取hash结构中的数据命令如下</p>
<pre><code class="prism language-CMD">hget a a1			#得到aa1
hget a a2			#得到aa2
</code></pre>
<p>注意不能直接得到a</p>
<p>例如：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/eb9945c994a542d584d3174b467d953e.png"/></p>
<blockquote>
<p>这里我们只涉及有关Redis的一些简单操作</p>
</blockquote>
<h2><a id="_107"></a>整合</h2>
<p>在进行整合之前先梳理一下整合的思想，springboot整合任何技术其实就是在springboot中使用对应技术的API。如果两个技术没有交集，就不存在整合的概念了。所谓整合其实就是使用springboot技术去管理其他技术，几个问题是躲不掉的：</p>
<ul><li> <p>第一，需要先导入对应技术的坐标，而整合之后，这些坐标都有了一些变化</p> </li><li> <p>第二，任何技术通常都会有一些相关的设置信息，整合之后，这些信息如何写，写在哪是一个问题</p> </li><li> <p>第三，没有整合之前操作如果是模式A的话，整合之后如果没有给开发者带来一些便捷操作，那整合将毫无意义，所以整合后操作肯定要简化一些，那对应的操作方式自然也有所不同</p> </li></ul>
<p>按照上面的三个问题去思考springboot整合所有技术是一种通用思想，在整合的过程中会逐步摸索出整合的套路，而且适用性非常强，经过若干种技术的整合后基本上可以总结出一套固定思维。</p>
<p>下面就开始springboot整合redis，操作步骤如下：</p>
<p><strong>步骤①</strong>：导入springboot整合redis的starter坐标</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>上述坐标可以在创建模块的时候通过勾选的形式进行选择，归属NoSQL分类中</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9e456a9df01d4b3a9ab3b2e8b13de226.png#pic_center"/></p>
<p><strong>步骤②</strong>：进行基础配置</p>
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
</code></pre>
<p>操作redis，最基本的信息就是操作哪一台redis服务器，所以服务器地址属于基础配置信息，不可缺少。但是即便你不配置，目前也是可以用的。因为以上两组信息都有默认配置，刚好就是上述配置值。</p>
<p><strong>步骤③</strong>：使用springboot整合redis的专用客户端接口操作，此处使用的是RedisTemplate</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot16RedisApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//首先决定要操作哪种数据类型</span>
        <span class="token class-name">ValueOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ops<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ValueOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> age <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">hset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HashOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ops<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"csdn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">hget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HashOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> val <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<p>两组get/set的结果：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/aff2fb111d024339891319f28e2bba78.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3bd9546e3db646adb8f02cf6505ef666.png"/></p>
<p><mark>在操作redis时，需要先确认操作何种数据，根据数据种类得到操作接口</mark>。例如使用opsForValue()获取string类型的数据操作接口，使用opsForHash()获取hash类型的数据操作接口，剩下的就是调用对应api操作了。各种类型的数据操作接口如下：</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5c4e19b746c14f2286b8a2e581f430b3.png"/></p>
<p><strong>总结</strong></p>
<ol><li>springboot整合redis步骤 
  <ol><li>导入springboot整合redis的starter坐标</li><li>进行基础配置</li><li>使用springboot整合redis的专用客户端接口RedisTemplate操作</li></ol> </li></ol>
<p>这里有一个注意点当我们在Redis的客户端去查找我们刚才在测试中添加的键值对时，发现查找不到。不是因为没有添加，而是因为数据类型的问题。我们可以使用命令查看此时所有储存的key：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e5d944908d29434bb9262ff2ab7630c4.png"/><br/> 我们发现并不是查不到，而是因为他们是以对象的形式进行存储的，并且被Redis使用特殊的方法进行了序列化，所以我们直接输入字符串是查不出来的。</p>
<blockquote>
<p>我们在RedisTemplate中也可以看到：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f1fd0c6b973c4b389a3f40220b7090c7.png"/><br/> 此处使用了泛型，当我们不写任何东西的时候，它就当成了Object对象</p>
</blockquote>
<p>为了避免这种情况我们可以使用<code>StringRedisTemplate</code>:<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b3b45595e0794b1cba52534aa3bdf602.png"/></p>
<p>然后我们就可以查到了：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/badabbd1ce8b4f71a2a5df357560b528.png"/></p>
<h1><a id="SpringBootMongoDB_214"></a>SpringBoot整合MongoDB</h1>
<h2><a id="MongoDB_215"></a>MongoDB基本介绍与安装</h2>
<p>使用Redis技术可以有效的提高数据访问速度，<strong>但是由于Redis的数据格式单一性，无法操作结构化数据，当操作对象型的数据时，Redis就显得捉襟见肘</strong>。在保障访问速度的情况下，如果想操作结构化数据，看来Redis无法满足要求了，此时需要使用全新的数据存储结构来解决此问题</p>
<p>MongoDB是一个开源、高性能、无模式的文档型数据库，它是NoSQL数据库产品中的一种，<mark>是最像关系型数据库的非关系型数据库</mark>。</p>
<p>上述描述中几个词，其中对于我们最陌生的词是无模式的。什么叫无模式呢？<strong>简单说就是作为一款数据库，没有固定的数据存储结构，第一条数据可能有A、B、C一共3个字段，第二条数据可能有D、E、F也是3个字段，第三条数据可能是A、C、E3个字段，也就是说数据的结构不固定，这就是无模式</strong>。有人会说这有什么用啊？灵活，随时变更，不受约束。基于上述特点，MongoDB的应用面也会产生一些变化。以下列出了一些可以使用MongoDB作为数据存储的场景，但是并不是必须使用MongoDB的场景：</p>
<ul><li> <p>淘宝用户数据</p>
<ul><li>存储位置：数据库</li><li>特征：永久性存储，修改频度极低</li><li><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4a9192a5eb5943eca7b3e82a2e9229af.png"/></li></ul> </li><li> <p>游戏装备数据、游戏道具数据</p>
<ul><li>存储位置：数据库、Mongodb</li><li>特征：永久性存储与临时存储相结合、修改频度较高</li><li><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7aa2515278dc47b0be0f795b145e357f.png"/></li></ul> </li><li> <p>直播数据、打赏数据、粉丝数据</p>
<ul><li>存储位置：数据库、Mongodb</li><li>特征：永久性存储与临时存储相结合，修改频度极高</li><li><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e9bb6f92d78d48149b68b25487e7c67a.png"/></li></ul> </li><li> <p>物联网数据</p>
<ul><li>存储位置：Mongodb</li><li>特征：临时存储，修改频度飞速</li><li><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0cd82fccc05a4aea8a2aa8af2b77fdec.png"/></li></ul> </li></ul>
<p>简单的了解MongoDB之后我们来说说他的安装。</p>
<blockquote>
<p>windows版安装包下载地址：https://www.mongodb.com/try/download</p>
</blockquote>
<p>下载的安装包也有两种形式，一种是一键安装的msi文件，还有一种是解压缩就能使用的zip文件，哪种形式都行，这里采用解压缩zip文件进行安装。</p>
<p>解压缩完毕后会得到如下文件，其中bin目录包含了所有mongodb的可执行命令</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4ab8a6d207354dc7abcf5b6bdaf0496f.png#pic_center"/></p>
<p>​ mongodb在运行时需要指定一个数据存储的目录，所以创建一个数据存储目录，通常放置在安装目录中，此处创建data的目录用来存储数据(我们又在data文件夹中创建一个db文件夹同样也是用来存放数据)，具体如下</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/96540f3af1bb4fe3866dcd1e05e1b9f4.png#pic_center"/></p>
<p>​ 如果在安装的过程中出现了如下警告信息，就是告诉你，你当前的操作系统缺少了一些系统文件，这个不用担心。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7bb9dfeef0e74ed39d589854432828d4.png#pic_center"/></p>
<p>根据下列方案即可解决，在浏览器中搜索提示缺少的名称对应的文件，并下载，将下载的文件拷贝到windows安装目录的system32目录下，然后在命令行中执行regsvr32命令注册此文件。根据下载的文件名不同，执行命令前更改对应名称。</p>
<pre><code class="prism language-CMD">regsvr32 vcruntime140_1.dll
</code></pre>
<p><strong>启动服务器</strong></p>
<pre><code class="prism language-CMD">mongod --dbpath=..\data\db
</code></pre>
<p>启动服务器时需要指定数据存储位置，通过参数–dbpath进行设置，可以根据需要自行设置数据存储路径。<mark>默认服务端口27017</mark>。</p>
<p>然后我们进入data里面的db文件夹会发现多了一些东西：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/00d0800c4a8649e6b4688ef4fdefb1e2.png"/><br/> 这些文件是初始化用的只会生成一次，后续开启服务器是不会再次生成的。</p>
<p>然后我们再启动客户端：</p>
<p><strong>启动客户端</strong></p>
<pre><code class="prism language-CMD">mongo --host=127.0.0.1 --port=27017
</code></pre>
<blockquote>
<p>因为我们的设置都是默认的，所以运行的时候，直接<code>mongo</code>也是可以的</p>
</blockquote>
<p>出现如下界面说明成功：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5ddda733d46c416e8077d7b01e9537a2.png"/></p>
<blockquote>
<p>注意别把服务器关了，两个cmd窗口要同时存在</p>
</blockquote>
<h2><a id="_300"></a>基本操作</h2>
<p>​ MongoDB虽然是一款数据库，<strong>但是它的操作并不是使用SQL语句进行的，因此操作方式各位小伙伴可能比较陌生</strong>，好在有一些类似于Navicat的数据库客户端软件，能够便捷的操作MongoDB，先安装一个客户端，再来操作MongoDB。</p>
<p>同类型的软件较多，本次安装的软件时Robo3t，Robot3t是一款绿色软件，无需安装，解压缩即可。解压缩完毕后进入安装目录双击robot3t.exe即可使用。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/56dd1ad2c4ea4d5ab8140683bfa30d6c.png"/></p>
<p>打开软件首先要连接MongoDB服务器，选择【File】菜单，选择【Connect…】</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/77c0f4126b574005aa515f9a1a2d87e1.png#pic_center"/></p>
<p>进入连接管理界面后，选择左上角的【Create】链接，创建新的连接设置<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a171886b44ea4a0e86f72e4ce5792529.png#pic_center"/></p>
<p>​ 如果输入设置值即可连接（默认不修改即可连接本机27017端口）</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b1d0638499df4c5db5146955b12eda85.png#pic_center"/></p>
<p>连接成功后在命令输入区域输入命令即可操作MongoDB。</p>
<p>创建数据库：在左侧菜单中使用右键创建，输入数据库名称即可</p>
<p>创建集合：在Collections上使用右键创建，输入集合名称即可，集合等同于数据库中的表的作用</p>
<p><code>新增文档</code>：（文档是一种类似json格式的数据，但它实际并不是json数据）</p>
<pre><code class="prism language-CMD">db.集合名称.insert/save/insertOne(文档)
</code></pre>
<p>例如：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1dc2d937ad0c49f0b66e9ef7c4962ca6.png"/><br/> 结果：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/494a43f8256746809e9b53d56558b811.png"/></p>
<p><code>删除文档</code>：</p>
<pre><code class="prism language-CMD">db.集合名称.remove(条件)
</code></pre>
<p><code>修改文档</code>：</p>
<pre><code class="prism language-cmd">db.集合名称.update(条件，{操作种类:{文档}})
</code></pre>
<p><code>查询文档</code>：</p>
<pre><code class="prism language-CMD">基础查询
查询全部：		   db.集合.find();
查第一条：		   db.集合.findOne()
查询指定数量文档：	db.集合.find().limit(10)					//查10条文档
跳过指定数量文档：	db.集合.find().skip(20)					//跳过20条文档
统计：			  	db.集合.count()
排序：				db.集合.sort({age:1})						//按age升序排序
投影：				db.集合名称.find(条件,{name:1,age:1})		 //仅保留name与age域

条件查询
基本格式：			db.集合.find({条件})
模糊查询：			db.集合.find({域名:/正则表达式/})		  //等同SQL中的like，比like强大，可以执行正则所有规则
条件比较运算：		   db.集合.find({域名:{$gt:值}})				//等同SQL中的数值比较操作，例如：name&gt;18
包含查询：			db.集合.find({域名:{$in:[值1，值2]}})		//等同于SQL中的in
条件连接查询：		   db.集合.find({$and:[{条件1},{条件2}]})	   //等同于SQL中的and、or
</code></pre>
<blockquote>
<p>这里只涉及一些基础的MongoDB操作</p>
</blockquote>
<h2><a id="_377"></a>整合</h2>
<p>使用springboot整合MongDB该如何进行呢？其实springboot为什么使用的开发者这么多，就是因为他的套路几乎完全一样。导入坐标，做配置，使用API接口操作。整合Redis如此，整合MongoDB同样如此。</p>
<p>​ 第一，先导入对应技术的整合starter坐标</p>
<p>​ 第二，配置必要信息</p>
<p>​ 第三，使用提供的API操作即可</p>
<p>​ 下面就开始springboot整合MongoDB，操作步骤如下：</p>
<p><strong>步骤①</strong>：导入springboot整合MongoDB的starter坐标</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>​ 上述坐标也可以在创建模块的时候通过勾选的形式进行选择，同样归属NoSQL分类中</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/425c4258253940bd88a3f092bae8ddd0.png"/></p>
<p><strong>步骤②</strong>：进行基础配置</p>
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//localhost/nefu   <span class="token comment">#我们对nefu集合进行操作</span>
</code></pre>
<p>操作MongoDB需要的配置与操作redis一样，最基本的信息都是操作哪一台服务器，区别就是连接的服务器IP地址和端口不同，书写格式不同而已。</p>
<p><strong>步骤③</strong>：使用springboot整合MongoDB的专用客户端接口MongoTemplate来进行操作</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot17MongodbApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Book</span> book <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"springboot2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">"springboot2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">"springboot2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>all<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在执行完save操作之后，我们可以在数据库中查看到新的数据：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/65171d63cf5d412faf64e20924dee2f1.png"/></p>
<p>整合工作到这里就做完了，感觉既熟悉也陌生。熟悉的是这个套路，三板斧，就这三招，导坐标做配置用API操作，陌生的是这个技术，里面具体的操作API可能会不熟悉，有关springboot整合MongoDB我们就讲到这里。</p>
<p><strong>总结</strong></p>
<ol><li>springboot整合MongoDB步骤 
  <ol><li>导入springboot整合MongoDB的starter坐标</li><li>进行基础配置</li><li>使用springboot整合MongoDB的专用客户端接口MongoTemplate操作</li></ol> </li></ol>
<h1><a id="SpringBootES_451"></a>SpringBoot整合ES</h1>
<h2><a id="ES_452"></a>ES基本介绍与安装</h2>
<p>NoSQL解决方案已经讲完了两种技术的整合了，Redis可以使用内存加载数据并实现数据快速访问，MongoDB可以在内存中存储类似对象的数据并实现数据的快速访问，在企业级开发中对于速度的追求是永无止境的。下面要讲的内容也是一款NoSQL解决方案，<strong>只不过他的作用不是为了直接加速数据的读写，而是加速数据的查询的，叫做ES技术</strong>。</p>
<p>​ ES（Elasticsearch）是一个分布式全文搜索引擎，重点是全文搜索。</p>
<p>那什么是全文搜索呢？比如用户要买一本书，以Java为关键字进行搜索，不管是书名中还是书的介绍中，甚至是书的作者名字，只要包含java就作为查询结果返回给用户查看，上述过程就使用了全文搜索技术。<strong>搜索的条件不再是仅用于对某一个字段进行比对，而是在一条数据中使用搜索条件去比对更多的字段</strong>，只要能匹配上就列入查询结果，这就是全文搜索的目的。而ES技术就是一种可以实现上述效果的技术。</p>
<p>要实现全文搜索的效果，不可能使用数据库中like操作去进行比对，这种效率太低了。ES设计了一种全新的思想，来实现全文搜索。具体操作过程如下：</p>
<ol><li> <p>将被查询的字段的数据全部文本信息进行查分，分成若干个词</p>
<ul><li>例如“Spring实战第5版”就会被拆分成三个词，分别是“Spring”、“实战”、“第5版”，此过程有专业术语叫做<code>分词</code>。分词的策略不同，分出的效果不一样，不同的分词策略称为分词器。</li></ul> </li><li> <p>将分词得到的结果存储起来，对应每条数据的id<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/bdf8269aa09e4ffd96573e347ebde3d7.png"/></p>
<ul><li> <p>例如id为1的数据中名称这一项的值是“Spring实战第5版”，那么分词结束后，就会出现“Spring”对应id为1，“实战”对应id为1，“第5版”对应id为1</p> </li><li> <p>例如id为3的数据中名称这一项的值是“Spring5设计模式“，那么分词结束后，就会出现“Spring”对应id为3，“设计模式”对应id为3</p> </li><li> <p>此时就会出现如下对应结果，按照上述形式可以对所有<mark>文档</mark>进行分词。需要注意分词的过程不是仅对一个字段进行，而是对每一个参与查询的字段都执行，最终结果汇总到一个表格中</p> </li></ul>
<blockquote>
<p>这样的一条数据就可以称为一个文档：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9485543a973d4ffc9946b97c52edff77.png"/></p>
</blockquote>
<table><thead><tr><th>分词结果关键字</th><th>对应id</th></tr></thead><tbody><tr><td>Spring</td><td>1，2，3，4，5</td></tr><tr><td>实战</td><td>1</td></tr><tr><td>第5版</td><td>1</td></tr></tbody></table></li><li> <p>当进行查询时，如果输入“实战”作为查询条件，可以通过上述表格数据进行比对，得到id值1,然后根据id值就可以得到查询的结果数据了。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0c1ecc8e55664a9bb9087032c8438c67.png"/></p> </li></ol>
<p>上述过程中分词结果关键字内容每一个都不相同，作用有点类似于数据库中的索引，是用来加速数据查询的。但是数据库中的索引是对某一个字段进行添加索引，而这里的分词结果关键字不是一个完整的字段值，只是一个字段中的其中的一部分内容。并且索引使用时是根据索引内容查找整条数据，全文搜索中的分词结果关键字查询后得到的并不是整条的数据，而是数据的id，要想获得具体数据还要再次查询，因此这里为这种分词结果关键字起了一个全新的名称，叫做<strong>倒排索引</strong>。</p>
<p>接下来我们说说安装：<br/> windows版安装包下载地址：<a href="https://www.elastic.co/cn/downloads/elasticsearch">https://</a><a href="https://www.elastic.co/cn/downloads/elasticsearch">www.elastic.co/cn/downloads/elasticsearch</a></p>
<p>​ 下载的安装包是解压缩就能使用的zip文件，解压缩完毕后会得到如下文件</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/75767c605138429d8be8f683f2460237.png#pic_center"/></p>
<ul><li>bin目录：包含所有的可执行命令</li><li>config目录：包含ES服务器使用的配置文件</li><li>jdk目录：此目录中包含了一个完整的jdk工具包，版本17，当ES升级时，使用最新版本的jdk确保不会出现版本支持性不足的问题</li><li>lib目录：包含ES运行的依赖jar文件</li><li>logs目录：包含ES运行后产生的所有日志文件</li><li>modules目录：包含ES软件中所有的功能模块，也是一个一个的jar包。和jar目录不同，jar目录是ES运行期间依赖的jar包，modules是ES软件自己的功能jar包</li><li>plugins目录：包含ES软件安装的插件，默认为空</li></ul>
<p><strong>启动服务器</strong></p>
<pre><code class="prism language-CMD">elasticsearch.bat
</code></pre>
<p>双击elasticsearch.bat文件即可启动ES服务器，默认服务端口9200。通过浏览器访问http://localhost:9200看到如下信息视为ES服务器正常启动</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/66048a35fc5f46cc85240a27f0d46f06.png"/></p>
<blockquote>
<p>运行的过程中，有两个端口号需要记住一下:<br/> 9300端口：为elasticsearch集群件组件的通信端口，简单说就是elasticsearch内部通信的端口。<br/> 9200端口：浏览器的访问端口。</p>
</blockquote>
<blockquote>
<p>有时候运行也会报如下的error：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6e8bda4423fd484b8424135e2bf9969b.png"/><br/> GeoIP报的错误， <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.14/geoip-processor.html#geoip-cluster-settings">GeoIP processor | Elasticsearch Guide [7.14] | Elastic</a></p>
</blockquote>
<p>错误信息主要是</p>
<blockquote>
<p>javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</p>
</blockquote>
<p>解决方法如下，就是在下载jre的security目录下加入ssh的安全证书。不过不影响运行所以可以不解决。</p>
<blockquote>
<p>解决PKIX：<a href="https://blog.csdn.net/faye0412/article/details/6883879">解决办法</a></p>
</blockquote>
<blockquote>
<p>有些用户可能在点击elasticsearch.bat文件之后，cmd弹窗出来了显示几行文字之后自动关闭了，遇到这种情况再开几次，直到正常运行即可。</p>
</blockquote>
<h2><a id="_539"></a>基本操作</h2>
<p>ES中保存有我们要查询的数据，只不过格式和数据库存储数据格式不同而已。在ES中我们要先创建倒排索引，这个索引的功能又点类似于数据库的表，然后将数据添加到倒排索引中，添加的数据称为文档。所以要进行ES的操作要先创建索引，再添加文档，这样才能进行后续的查询操作。</p>
<p>​ 要操作ES可以通过Rest风格的请求来进行，也就是说发送一个请求就可以执行一个操作。比如新建索引，删除索引这些操作都可以使用发送请求的形式来进行。</p>
<ul><li> <p>创建索引，books是索引名称，下同</p> <pre><code class="prism language-CMD">PUT请求		http://localhost:9200/books
</code></pre> <p>发送请求后，看到如下信息即索引创建成功</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"acknowledged"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"shards_acknowledged"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"books"</span>
<span class="token punctuation">}</span>
</code></pre> <p>重复创建已经存在的索引会出现错误信息，reason属性中描述错误原因</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"resource_already_exists_exception"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"index [books/VgC_XMVAQmedaiBNSgO2-w] already exists"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"index_uuid"</span><span class="token operator">:</span> <span class="token string">"VgC_XMVAQmedaiBNSgO2-w"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"books"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"resource_already_exists_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"index [books/VgC_XMVAQmedaiBNSgO2-w] already exists"</span><span class="token punctuation">,</span>	# books索引已经存在
        <span class="token string-property property">"index_uuid"</span><span class="token operator">:</span> <span class="token string">"VgC_XMVAQmedaiBNSgO2-w"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"book"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">400</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>查询索引</p> <pre><code class="prism language-CMD">GET请求		http://localhost:9200/books
</code></pre> <p>查询索引得到索引相关信息，如下</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"book"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"aliases"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"routing"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"allocation"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token string-property property">"include"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token string-property property">"_tier_preference"</span><span class="token operator">:</span> <span class="token string">"data_content"</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">"number_of_shards"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"provided_name"</span><span class="token operator">:</span> <span class="token string">"books"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"creation_date"</span><span class="token operator">:</span> <span class="token string">"1645768584849"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"number_of_replicas"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"uuid"</span><span class="token operator">:</span> <span class="token string">"VgC_XMVAQmedaiBNSgO2-w"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"created"</span><span class="token operator">:</span> <span class="token string">"7160299"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>如果查询了不存在的索引，会返回错误信息，例如查询名称为book的索引后信息如下</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"index_not_found_exception"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"no such index [book]"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"resource.type"</span><span class="token operator">:</span> <span class="token string">"index_or_alias"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"resource.id"</span><span class="token operator">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"index_uuid"</span><span class="token operator">:</span> <span class="token string">"_na_"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"book"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"index_not_found_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"no such index [book]"</span><span class="token punctuation">,</span>		# 没有book索引
        <span class="token string-property property">"resource.type"</span><span class="token operator">:</span> <span class="token string">"index_or_alias"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"resource.id"</span><span class="token operator">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"index_uuid"</span><span class="token operator">:</span> <span class="token string">"_na_"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"book"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">404</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>删除索引</p> <pre><code class="prism language-CMD">DELETE请求	http://localhost:9200/books
</code></pre> <p>删除所有后，给出删除结果</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"acknowledged"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <p>如果重复删除，会给出错误信息，同样在reason属性中描述具体的错误原因</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"index_not_found_exception"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"no such index [books]"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"resource.type"</span><span class="token operator">:</span> <span class="token string">"index_or_alias"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"resource.id"</span><span class="token operator">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"index_uuid"</span><span class="token operator">:</span> <span class="token string">"_na_"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"book"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"index_not_found_exception"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"reason"</span><span class="token operator">:</span> <span class="token string">"no such index [books]"</span><span class="token punctuation">,</span>		# 没有books索引
        <span class="token string-property property">"resource.type"</span><span class="token operator">:</span> <span class="token string">"index_or_alias"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"resource.id"</span><span class="token operator">:</span> <span class="token string">"book"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"index_uuid"</span><span class="token operator">:</span> <span class="token string">"_na_"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token string">"book"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"status"</span><span class="token operator">:</span> <span class="token number">404</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>创建索引并指定分词器</p> <p>​ 前面创建的索引是未指定分词器的，可以在创建索引时添加请求参数，设置分词器。目前国内较为流行的分词器是IK分词器，使用前先在下对应的分词器，然后使用。<br/> IK分词器下载地址：https://github.com/medcl/elasticsearch-analysis-ik/releases</p> <p>​ 分词器下载后解压到ES安装目录的plugins目录中即可，安装分词器后需要重新启动ES服务器。使用IK分词器创建索引格式：</p> <pre><code class="prism language-json"><span class="token constant">PUT</span>请求		http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books

请求参数如下（注意是json格式的参数）
<span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"mappings"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>							#定义mappings属性，替换创建索引时对应的mappings属性		
        <span class="token string-property property">"properties"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>						#定义索引中包含的属性设置
            <span class="token string-property property">"id"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>							#设置索引中包含id属性
                <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"keyword"</span>			#当前属性可以被直接搜索
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>						#设置索引中包含name属性
                <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"text"</span><span class="token punctuation">,</span>              #当前属性是文本信息，参与分词  
                <span class="token string-property property">"analyzer"</span><span class="token operator">:</span><span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>   #使用<span class="token constant">IK</span>分词器进行分词             
                <span class="token string-property property">"copy_to"</span><span class="token operator">:</span><span class="token string">"all"</span>				#分词结果拷贝到all属性中
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"keyword"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"description"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"text"</span><span class="token punctuation">,</span>	                
                <span class="token string-property property">"analyzer"</span><span class="token operator">:</span><span class="token string">"ik_max_word"</span><span class="token punctuation">,</span>                
                <span class="token string-property property">"copy_to"</span><span class="token operator">:</span><span class="token string">"all"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string-property property">"all"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>							#定义属性，用来描述多个字段的分词结果集合，当前属性可以参与查询
                <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"text"</span><span class="token punctuation">,</span>	                
                <span class="token string-property property">"analyzer"</span><span class="token operator">:</span><span class="token string">"ik_max_word"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>​ 创建完毕后返回结果和不使用分词器创建索引的结果是一样的，此时可以通过查看索引信息观察到添加的请求参数mappings已经进入到了索引属性中</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"books"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"aliases"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>						#mappings属性已经被替换
            <span class="token string-property property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"all"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"copy_to"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"all"</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"copy_to"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"all"</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"analyzer"</span><span class="token operator">:</span> <span class="token string">"ik_max_word"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string-property property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">"index"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"routing"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"allocation"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token string-property property">"include"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token string-property property">"_tier_preference"</span><span class="token operator">:</span> <span class="token string">"data_content"</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token string-property property">"number_of_shards"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"provided_name"</span><span class="token operator">:</span> <span class="token string">"books"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"creation_date"</span><span class="token operator">:</span> <span class="token string">"1645769809521"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"number_of_replicas"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"uuid"</span><span class="token operator">:</span> <span class="token string">"DohYKvr_SZO4KRGmbZYmTQ"</span><span class="token punctuation">,</span>
                <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"created"</span><span class="token operator">:</span> <span class="token string">"7160299"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul>
<p>目前我们已经有了索引了，但是索引中还没有数据，所以要先添加数据，ES中称数据为文档，下面进行文档操作。</p>
<ul><li> <p>添加文档，有三种方式</p> <pre><code class="prism language-json"><span class="token constant">POST</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_doc		#使用系统生成id
<span class="token constant">POST</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_create<span class="token operator">/</span><span class="token number">1</span>	#使用指定id
<span class="token constant">POST</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>		#使用指定id，不存在创建，存在更新（版本递增）

文档通过请求参数传递，数据格式json
<span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token string">"springboot"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"springboot"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"description"</span><span class="token operator">:</span><span class="token string">"springboot"</span>
<span class="token punctuation">}</span>  
</code></pre> </li><li> <p>查询文档</p> <pre><code class="prism language-json"><span class="token constant">GET</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>		 #查询单个文档 		
<span class="token constant">GET</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_search		 #查询全部文档
</code></pre> </li><li> <p>条件查询</p> <pre><code class="prism language-json"><span class="token constant">GET</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_search<span class="token operator">?</span>q<span class="token operator">=</span>name<span class="token operator">:</span>springboot	# q<span class="token operator">=</span>查询属性名<span class="token operator">:</span>查询属性值
</code></pre> </li><li> <p>删除文档</p> <pre><code class="prism language-json"><span class="token constant">DELETE</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>
</code></pre> </li><li> <p>修改文档（全量更新）</p> <pre><code class="prism language-json"><span class="token constant">PUT</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">1</span>

文档通过请求参数传递，数据格式json
<span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token string">"springboot"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"type"</span><span class="token operator">:</span><span class="token string">"springboot"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"description"</span><span class="token operator">:</span><span class="token string">"springboot"</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>修改文档（部分更新）</p> <pre><code class="prism language-json"><span class="token constant">POST</span>请求	http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">9200</span><span class="token operator">/</span>books<span class="token operator">/</span>_update<span class="token operator">/</span><span class="token number">1</span>

文档通过请求参数传递，数据格式json
<span class="token punctuation">{<!-- --></span>			
    <span class="token string-property property">"doc"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>						#部分更新并不是对原始文档进行更新，而是对原始文档对象中的doc属性中的指定属性更新
        <span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token string">"springboot"</span>		#仅更新提供的属性值，未提供的属性值不参与更新操作
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul>
<h2><a id="_842"></a>整合</h2>
<p>使用springboot整合ES该如何进行呢？老规矩，导入坐标，做配置，使用API接口操作。整合Redis如此，整合MongoDB如此，整合ES依然如此。太没有新意了，其实不是没有新意，这就是springboot的强大之处，所有东西都做成相同规则，对开发者来说非常友好。</p>
<p>​ 下面就开始springboot整合ES，操作步骤如下：</p>
<p><strong>步骤①</strong>：导入springboot整合ES的starter坐标</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-elasticsearch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><strong>步骤②</strong>：进行基础配置</p>
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
    <span class="token key atrule">rest</span><span class="token punctuation">:</span>
      <span class="token key atrule">uris</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9200</span>
</code></pre>
<p>​ 配置ES服务器地址，端口9200</p>
<p><strong>步骤③</strong>：使用springboot整合ES的专用客户端接口ElasticsearchRestTemplate来进行操作</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot18EsApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ElasticsearchRestTemplate</span> template<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ 上述操作形式是ES早期的操作方式，使用的客户端被称为Low Level Client，这种客户端操作方式性能方面略显不足，于是ES开发了全新的客户端操作方式，称为High Level Client。高级别客户端与ES版本同步更新，但是springboot最初整合ES的时候使用的是低级别客户端，所以企业开发需要更换成高级别的客户端模式。</p>
<p>​ 下面使用高级别客户端方式进行springboot整合ES，操作步骤如下：</p>
<p><strong>步骤①</strong>：导入springboot整合ES高级别客户端的坐标，此种形式目前没有对应的starter</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-rest-high-level-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><strong>步骤②</strong>：使用编程的形式设置连接的ES服务器，并获取客户端对象</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot18EsApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>
      <span class="token annotation punctuation">@Test</span>
      <span class="token keyword">void</span> <span class="token function">testCreateClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
          <span class="token class-name">HttpHost</span> host <span class="token operator">=</span> <span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">RestClientBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
          client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
          client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ 配置ES服务器地址与端口9200，记得客户端使用完毕需要手工关闭。由于当前客户端是手工维护的，因此不能通过自动装配的形式加载对象。</p>
<p><strong>步骤③</strong>：使用客户端对象操作ES，例如创建索引</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot18EsApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>
      <span class="token annotation punctuation">@Test</span>
      <span class="token keyword">void</span> <span class="token function">testCreateIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
          <span class="token class-name">HttpHost</span> host <span class="token operator">=</span> <span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">RestClientBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
          client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
          
          <span class="token class-name">CreateIndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
          
          client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ 高级别客户端操作是通过发送请求的方式完成所有操作的，ES针对各种不同的操作，设定了各式各样的请求对象，上例中创建索引的对象是CreateIndexRequest，其他操作也会有自己专用的Request对象。</p>
<p>​ 当前操作我们发现，无论进行ES何种操作，第一步永远是获取RestHighLevelClient对象，最后一步永远是关闭该对象的连接。在测试中可以使用测试类的特性去帮助开发者一次性的完成上述操作，但是在业务书写时，还需要自行管理。将上述代码格式转换成使用测试类的初始化方法和销毁方法进行客户端对象的维护。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot18EsApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@BeforeEach</span>		<span class="token comment">//在测试类中每个操作运行前运行的方法</span>
    <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpHost</span> host <span class="token operator">=</span> <span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestClientBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterEach</span>		<span class="token comment">//在测试类中每个操作运行后运行的方法</span>
    <span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">RestHighLevelClient</span> client<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testCreateIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">CreateIndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ 现在的书写简化了很多，也更合理。下面使用上述模式将所有的ES操作执行一遍，测试结果</p>
<p><strong>创建索引（IK分词器）</strong>：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testCreateIndexByIK</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">CreateIndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token string">"{\n"</span> <span class="token operator">+</span>
            <span class="token string">"    \"mappings\":{\n"</span> <span class="token operator">+</span>
            <span class="token string">"        \"properties\":{\n"</span> <span class="token operator">+</span>
            <span class="token string">"            \"id\":{\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"type\":\"keyword\"\n"</span> <span class="token operator">+</span>
            <span class="token string">"            },\n"</span> <span class="token operator">+</span>
            <span class="token string">"            \"name\":{\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"type\":\"text\",\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"analyzer\":\"ik_max_word\",\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"copy_to\":\"all\"\n"</span> <span class="token operator">+</span>
            <span class="token string">"            },\n"</span> <span class="token operator">+</span>
            <span class="token string">"            \"type\":{\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"type\":\"keyword\"\n"</span> <span class="token operator">+</span>
            <span class="token string">"            },\n"</span> <span class="token operator">+</span>
            <span class="token string">"            \"description\":{\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"type\":\"text\",\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"analyzer\":\"ik_max_word\",\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"copy_to\":\"all\"\n"</span> <span class="token operator">+</span>
            <span class="token string">"            },\n"</span> <span class="token operator">+</span>
            <span class="token string">"            \"all\":{\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"type\":\"text\",\n"</span> <span class="token operator">+</span>
            <span class="token string">"                \"analyzer\":\"ik_max_word\"\n"</span> <span class="token operator">+</span>
            <span class="token string">"            }\n"</span> <span class="token operator">+</span>
            <span class="token string">"        }\n"</span> <span class="token operator">+</span>
            <span class="token string">"    }\n"</span> <span class="token operator">+</span>
            <span class="token string">"}"</span><span class="token punctuation">;</span>
    <span class="token comment">//设置请求中的参数</span>
    request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ IK分词器是通过请求参数的形式进行设置的，设置请求参数使用request对象中的source方法进行设置，至于参数是什么，取决于你的操作种类。当请求中需要参数时，均可使用当前形式进行参数设置。</p>
<p><strong>添加文档</strong>：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token comment">//添加文档</span>
<span class="token keyword">void</span> <span class="token function">testCreateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Book</span> book <span class="token operator">=</span> bookDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> json <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ 添加文档使用的请求对象是IndexRequest，与创建索引使用的请求对象不同。</p>
<p><strong>批量添加文档</strong>：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token comment">//批量添加文档</span>
<span class="token keyword">void</span> <span class="token function">testCreateDocAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> bookList <span class="token operator">=</span> bookDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BulkRequest</span> bulk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BulkRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Book</span> book <span class="token operator">:</span> bookList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">IndexRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bulk<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    client<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span>bulk<span class="token punctuation">,</span><span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ 批量做时，先创建一个BulkRequest的对象，可以将该对象理解为是一个保存request对象的容器，将所有的请求都初始化好后，添加到BulkRequest对象中，再使用BulkRequest对象的bulk方法，一次性执行完毕。</p>
<p><strong>按id查询文档</strong>：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token comment">//按id查询</span>
<span class="token keyword">void</span> <span class="token function">testGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">GetRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GetRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">GetResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> json <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ 根据id查询文档使用的请求对象是GetRequest。</p>
<p><strong>按条件查询文档</strong>：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token comment">//按条件查询</span>
<span class="token keyword">void</span> <span class="token function">testSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">SearchRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SearchSourceBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">,</span><span class="token string">"spring"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> hits<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> source <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//System.out.println(source);</span>
        <span class="token class-name">Book</span> book <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>​ 按条件查询文档使用的请求对象是SearchRequest，查询时调用SearchRequest对象的termQuery方法，需要给出查询属性名，此处支持使用合并字段，也就是前面定义索引属性时添加的all属性。</p>
<p>springboot整合ES的操作到这里就说完了，与前期进行springboot整合redis和mongodb的差别还是蛮大的，主要原始就是我们没有使用springboot整合ES的客户端对象。至于操作，由于ES操作种类过多，所以显得操作略微有点复杂。</p>
<p><strong>总结</strong></p>
<ol><li>springboot整合ES步骤 
  <ol><li>导入springboot整合ES的High Level Client坐标</li><li>手工管理客户端对象，包括初始化和关闭操作</li><li>使用High Level Client根据操作的种类不同，选择不同的Request对象完成对应操作</li></ol> </li></ol>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>