<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<blockquote>
<p>提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档</p>
</blockquote>
<p></p>
<div class="toc">
<h3>文章目录</h3>
<ul><li><a href="#_7">前言</a></li><li><a href="#armC_25">一、编译运行在arm平台的C++的动态库</a></li><li><ul><li><a href="#1C_26">1.搭建C++移动开发环境</a></li><li><a href="#2C_29">2.创建项目并生成C++链接库</a></li></ul>
</li><li><a href="#C_130">二、实现C#动态库</a></li><li><ul><li><a href="#1_131">1.添加共享项目</a></li><li><a href="#2Android_276">2.添加平台项目（Android）</a></li></ul>
</li><li><a href="#nupkg_282">三、将动态库打包成nupkg</a></li><li><ul><li><a href="#1Nuget_283">1、Nuget打包</a></li><li><a href="#2Nuget_286">2、Nuget配置本地包</a></li></ul>
</li><li><a href="#APPnupkg_288">四、在APP项目中使用nupkg</a></li><li><ul><li><a href="#1_290">1.界面布局</a></li><li><a href="#2NugetMathSharpLib_293">2、引用自定义Nuget包MathSharpLib</a></li><li><a href="#3_296">3.为按钮添加事件响应</a></li><li><a href="#4Cso_387">4.添加C++动态库.so</a></li><li><a href="#5APPapk_391">5.生成APP的安装包apk文件。</a></li></ul>
</li><li><a href="#_405">总结</a></li></ul>
</div>
<p></p>
<hr/>
<h1><a id="_7"></a>前言</h1>
<pre><code>因为一丢丢的小兴趣，前段时间尝试了一下移动设备APP的开发（主要是Android）。在Vs上使用了Xamarin模板，开发语言是C#。很早之前写过一个C++与C#的小工具，c++实现算法主要是Base64与Hash加密算法，winform实现界面。因为近期产品销售比较旺盛，工具使用的非常频繁，随时随地，这就带来了很大的麻烦（身为码农的我私人电脑已经坏了5、6年了，一直以来都是用的公司台式机），所以就萌生了把工具移植到手机上的想法。初期在怎么把C++动态库移植到手机上遇到了麻烦，然后就用C#重写了算法，至此工具移植完成。好巧不巧近期公司立项了一个APP的项目，unity平台加web，这再次激发了我解决掉（c++加C#提供动态库的跨平台方案）的想法。为什么非得搞C++？因为我是个C/C++程序员。因为在Android上验证的方案，所以在这里只讲安卓了。
</code></pre>
<p>方案实现步骤：</p>
<ol><li> <p>编译运行在arm平台的C++的动态库。</p> </li><li> <p>实现C#动态库，以作为C++动态库的壳。</p> </li><li> <p>将动态库打包成nupkg，以供项目通过NuGet引用。</p> </li><li> <p>在项目中使用nupkg,并发布APP。</p> <p>思路来自于微软官网文档，有坑，说是提供的步骤特定于 Visual Studio for Mac，但该结构也适用于 Visual Studio 2017。但我vs2017安装不了Android SDK,用了vs2019,但好多步骤，操作都不对。<a href="https://docs.microsoft.com/zh-cn/xamarin/cross-platform/cpp/">官方链接</a></p> </li></ol>
<p><a href="https://gitee.com/lifei0818/NugetPackage02.git">代码仓库链接</a><br/> 百度网盘：<br/> 链接: https://pan.baidu.com/s/1lI4wsOrdgLvf-exE-ki_MA<br/> 提取码: 99hm</p>
<hr/>
<h1><a id="armC_25"></a>一、编译运行在arm平台的C++的动态库</h1>
<h2><a id="1C_26"></a>1.搭建C++移动开发环境</h2>
<p>首先搭建编译环境，在Visual studio Install里安装C++跨平台工具包。勾选这里，实际上要完成这套开发其他几个也要勾的。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8d89ed21d1ff470082182de82b144e1b.png"/></p>
<h2><a id="2C_29"></a>2.创建项目并生成C++链接库</h2>
<p>创建库项目并编译。在【文件】【新建】【项目】中选【C++】【所有平台】【库】<br/> 添加代码文件。<br/> 头文件MyMathFuncs.h：</p>
<pre><code class="prism language-cpp"><span class="token comment">//MyMathFuncs.h</span>
<span class="token keyword">namespace</span> MathFuncs
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">class</span> <span class="token class-name">MyMathFuncs</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">double</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> <span class="token function">Subtract</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> <span class="token function">Multiply</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> <span class="token function">Divide</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>源文件MyMathFuncs.cpp：</p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MyMathFuncs.h"</span></span>

<span class="token keyword">namespace</span> MathFuncs
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> <span class="token class-name">MyMathFuncs</span><span class="token double-colon punctuation">::</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> <span class="token class-name">MyMathFuncs</span><span class="token double-colon punctuation">::</span><span class="token function">Subtract</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> <span class="token class-name">MyMathFuncs</span><span class="token double-colon punctuation">::</span><span class="token function">Multiply</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> <span class="token class-name">MyMathFuncs</span><span class="token double-colon punctuation">::</span><span class="token function">Divide</span><span class="token punctuation">(</span><span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>将类封装出导出接口。<br/> MyMathFuncsWrapper.h</p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MyMathFuncs.h"</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> MathFuncs<span class="token punctuation">;</span>

<span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token punctuation">{<!-- --></span>
    MyMathFuncs<span class="token operator">*</span> <span class="token function">CreateMyMathFuncsClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">DisposeMyMathFuncsClass</span><span class="token punctuation">(</span>MyMathFuncs<span class="token operator">*</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> <span class="token function">MyMathFuncsAdd</span><span class="token punctuation">(</span>MyMathFuncs <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> <span class="token function">MyMathFuncsSubtract</span><span class="token punctuation">(</span>MyMathFuncs <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> <span class="token function">MyMathFuncsMultiply</span><span class="token punctuation">(</span>MyMathFuncs <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> <span class="token function">MyMathFuncsDivide</span><span class="token punctuation">(</span>MyMathFuncs <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>MyMathFuncsWrapper.cpp:</p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MyMathFuncsWrapper.h"</span></span>

MyMathFuncs<span class="token operator">*</span> <span class="token function">CreateMyMathFuncsClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">MyMathFuncs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">DisposeMyMathFuncsClass</span><span class="token punctuation">(</span>MyMathFuncs<span class="token operator">*</span> ptr<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ptr <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">delete</span> ptr<span class="token punctuation">;</span>
        ptr <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">MyMathFuncsAdd</span><span class="token punctuation">(</span>MyMathFuncs <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> ptr<span class="token operator">-&gt;</span><span class="token function">Add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">MyMathFuncsSubtract</span><span class="token punctuation">(</span>MyMathFuncs <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> ptr<span class="token operator">-&gt;</span><span class="token function">Subtract</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">MyMathFuncsMultiply</span><span class="token punctuation">(</span>MyMathFuncs <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> ptr<span class="token operator">-&gt;</span><span class="token function">Multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">MyMathFuncsDivide</span><span class="token punctuation">(</span>MyMathFuncs <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">double</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> ptr<span class="token operator">-&gt;</span><span class="token function">Divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>选择Release，ARM64编译生成就得到了*.so组件，如果手机是32位的，就选ARM.</p>
<h1><a id="C_130"></a>二、实现C#动态库</h1>
<h2><a id="1_131"></a>1.添加共享项目</h2>
<p>添加共享项目的目的是为了不同平台可以共享同一套代码，比如Android,IOS,win加载C++接口用的都是同一套代码。<br/> 在解决方案中，【添加】【新建项目】，设置【C#】【所有平台】【所有类型】，选择【共享项目】模板。项目名称SharedPro。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/38e73fd47be14aabb1d95941d404f09e.png"/></p>
<p>加载C++库,封装C#类。使用 MyMathFuncsSafeHandle 类替代标准 IntPtr。 在封送过程中，IntPtr 会自动映射到 SafeHandle。MyMathFuncsWrapper.cs</p>
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">MathFuncs</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyMathFuncsWrapper</span>
    <span class="token punctuation">{<!-- --></span>
<span class="token comment">//#if Android</span>
    <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> DllName <span class="token operator">=</span> <span class="token string">"libMathFuncs.so"</span><span class="token punctuation">;</span>
<span class="token comment">//#else</span>
<span class="token comment">//        const string DllName = "__Internal";</span>
<span class="token comment">//#endif</span>

        <span class="token punctuation">[</span><span class="token function">DllImport</span><span class="token punctuation">(</span>DllName<span class="token punctuation">,</span> EntryPoint <span class="token operator">=</span> <span class="token string">"CreateMyMathFuncsClass"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">MyMathFuncsSafeHandle</span> <span class="token function">CreateMyMathFuncs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span>DllName<span class="token punctuation">,</span> EntryPoint <span class="token operator">=</span> <span class="token string">"DisposeMyMathFuncsClass"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DisposeMyMathFuncs</span><span class="token punctuation">(</span><span class="token class-name">MyMathFuncsSafeHandle</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span>DllName<span class="token punctuation">,</span> EntryPoint <span class="token operator">=</span> <span class="token string">"MyMathFuncsAdd"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">MyMathFuncsSafeHandle</span> ptr<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span>DllName<span class="token punctuation">,</span> EntryPoint <span class="token operator">=</span> <span class="token string">"MyMathFuncsSubtract"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Subtract</span><span class="token punctuation">(</span><span class="token class-name">MyMathFuncsSafeHandle</span> ptr<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span>DllName<span class="token punctuation">,</span> EntryPoint <span class="token operator">=</span> <span class="token string">"MyMathFuncsMultiply"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Multiply</span><span class="token punctuation">(</span><span class="token class-name">MyMathFuncsSafeHandle</span> ptr<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span>DllName<span class="token punctuation">,</span> EntryPoint <span class="token operator">=</span> <span class="token string">"MyMathFuncsDivide"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Divide</span><span class="token punctuation">(</span><span class="token class-name">MyMathFuncsSafeHandle</span> ptr<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>用SafeHandle处理非托管内存。<br/> MyMathFuncsSafeHandle .cs</p>
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>SafeHandles</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">MathFuncs</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">MyMathFuncsSafeHandle</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SafeHandleZeroOrMinusOneIsInvalid</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token function">MyMathFuncsSafeHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">IntPtr</span> Ptr <span class="token operator">=&gt;</span> handle<span class="token punctuation">;</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ReleaseHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// TODO: Release the handle here</span>
            MyMathFuncsWrapper<span class="token punctuation">.</span><span class="token function">DisposeMyMathFuncs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>对外提供的类MyMathFuncs.cs</p>
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">MathFuncs</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMathFuncs</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">readonly</span> <span class="token class-name">MyMathFuncsSafeHandle</span> handle<span class="token punctuation">;</span>
        <span class="token comment">//MyMathFuncsSafeHandle handle;</span>

        <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> DllName <span class="token operator">=</span> <span class="token string">"libMathFuncs.so"</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">MyMathFuncs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            handle <span class="token operator">=</span> MyMathFuncsWrapper<span class="token punctuation">.</span><span class="token function">CreateMyMathFuncs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> disposing<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>handle <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>handle<span class="token punctuation">.</span>IsInvalid<span class="token punctuation">)</span>
                handle<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            GC<span class="token punctuation">.</span><span class="token function">SuppressFinalize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> strRt <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> strPath <span class="token operator">=</span> System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>Process<span class="token punctuation">.</span><span class="token function">GetCurrentProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MainModule<span class="token punctuation">.</span>FileName<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>DllName<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                strRt <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0} is Exist\r\n{1}"</span><span class="token punctuation">,</span> DllName<span class="token punctuation">,</span> strPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                strRt <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0} is not Exist\r\n{1}"</span><span class="token punctuation">,</span> DllName<span class="token punctuation">,</span> strPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> strRt<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> MyMathFuncsWrapper<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//return a + b;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Subtract</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> MyMathFuncsWrapper<span class="token punctuation">.</span><span class="token function">Subtract</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//return a - b;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Multiply</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> MyMathFuncsWrapper<span class="token punctuation">.</span><span class="token function">Multiply</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//return a * b;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Divide</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> b<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> MyMathFuncsWrapper<span class="token punctuation">.</span><span class="token function">Divide</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//return a / b;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<h2><a id="2Android_276"></a>2.添加平台项目（Android）</h2>
<p>添加一个平台项目，目的是编写特定于平台代码，最终打包到Nupkg中，不同的平台引用不同的部分。这里只加个安卓。<br/> 在解决方案中【添加】【新建项目】，选择【C#】【所有平台】【库】，选择【类库】，创建时目标框架选择.Net Standard 2.0。项目名称MathSharpLib。然后为MathSharpLib添加项目引用，引用SharedPro。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/442dfd89a3f54fb385acb1379679e917.png"/></p>
<hr/>
<h1><a id="nupkg_282"></a>三、将动态库打包成nupkg</h1>
<h2><a id="1Nuget_283"></a>1、Nuget打包</h2>
<p>打nupkg包有两种方法，一种使用nuget手动打包。一种是使用vs打包,这种比较简单。<br/> 右键MathSharpLib，属性，打包，勾选在构建时生成Nuget包，在此界面还可以设置包版本等其他信息。</p>
<h2><a id="2Nuget_286"></a>2、Nuget配置本地包</h2>
<p>【工具】【Nuget包管理器】【程序包管理器设置】打开设置UI界面。在【Nuget包管理器】下的【程序包源】点添加，设置名字，已经源目录即可。包打出的包放在开目录下便能被项目看到。</p>
<h1><a id="APPnupkg_288"></a>四、在APP项目中使用nupkg</h1>
<p>然后就可以写个App项目来用Nuget包了。我这里用的是安卓应用（Xamarin），模板用的空白项，项目名App。</p>
<h2><a id="1_290"></a>1.界面布局</h2>
<p>展开App项目下的【Resources】【layout】,双击[activity_main.xml]，通过拖拽完成界面，略丑。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/cbcd5015297247e2aeb6793e4cefae6c.png"/></p>
<h2><a id="2NugetMathSharpLib_293"></a>2、引用自定义Nuget包MathSharpLib</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/65a4a30c793c4a649ebcb2166dfebd4f.png"/></p>
<h2><a id="3_296"></a>3.为按钮添加事件响应</h2>
<p>在MainActive.cs中完成代码。此时能够编译成功。</p>
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>App</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>OS</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">AndroidX<span class="token punctuation">.</span>AppCompat<span class="token punctuation">.</span>App</span><span class="token punctuation">;</span>

<span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Widget</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">SharePro</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">MathFuncs</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">App1</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Activity</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Label <span class="token operator">=</span> <span class="token string">"@string/app_name"</span><span class="token punctuation">,</span> Theme <span class="token operator">=</span> <span class="token string">"@style/AppTheme"</span><span class="token punctuation">,</span> MainLauncher <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AppCompatActivity</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//public SharePro.Android.MathFunc _mathFunc;</span>
        <span class="token keyword">public</span> <span class="token class-name">MathFuncs<span class="token punctuation">.</span>MyMathFuncs</span> _MyMath<span class="token punctuation">;</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Xamarin<span class="token punctuation">.</span>Essentials<span class="token punctuation">.</span>Platform<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Set our view from the "main" layout resource</span>
            <span class="token function">SetContentView</span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//测试nuget包</span>
            <span class="token class-name">EditText</span> editA <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindViewById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EditText<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>editText1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">EditText</span> editB <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindViewById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EditText<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>editText2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">EditText</span> editRt <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindViewById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EditText<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>editText3<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Button</span> b1 <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindViewById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Button<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>button1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Button</span> b2 <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindViewById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Button<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>button2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Button</span> b3 <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindViewById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Button<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>button3<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Button</span> b4 <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindViewById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Button<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Id<span class="token punctuation">.</span>button4<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">//_mathFunc = new SharePro.Android.MathFunc();</span>
            _MyMath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyMathFuncs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            b1<span class="token punctuation">.</span>Click <span class="token operator">+=</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">double</span></span> a <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>editA<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">double</span></span> b <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>editB<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//double c =  _mathFunc.Add(a,b);</span>
                <span class="token class-name"><span class="token keyword">double</span></span> c <span class="token operator">=</span> _MyMath<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>

                editRt<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0} + {1} = {2}"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            b2<span class="token punctuation">.</span>Click <span class="token operator">+=</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">double</span></span> a <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>editA<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">double</span></span> b <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>editB<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//double c = _mathFunc.Multiply(a, b);</span>
                <span class="token class-name"><span class="token keyword">double</span></span> c1 <span class="token operator">=</span> _MyMath<span class="token punctuation">.</span><span class="token function">Multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
                editRt<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"_MyMath sharedc:{0} x {1} = {2}"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            b3<span class="token punctuation">.</span>Click <span class="token operator">+=</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">double</span></span> a <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>editA<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">double</span></span> b <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>editB<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//double c = _mathFunc.Subtract(a, b);</span>
                <span class="token class-name"><span class="token keyword">double</span></span> c <span class="token operator">=</span> _MyMath<span class="token punctuation">.</span><span class="token function">Subtract</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
                editRt<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0} - {1} = {2}"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            b4<span class="token punctuation">.</span>Click <span class="token operator">+=</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">double</span></span> a <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>editA<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">double</span></span> b <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>editB<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name"><span class="token keyword">double</span></span> c <span class="token operator">=</span> _MyMath<span class="token punctuation">.</span><span class="token function">Divide</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
                editRt<span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0} / {1} = {2}"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//editRt.Text = _MyMath.Test();</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnRequestPermissionsResult</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> requestCode<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> permissions<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">GeneratedEnum</span></span><span class="token punctuation">]</span> <span class="token class-name">Android<span class="token punctuation">.</span>Content<span class="token punctuation">.</span>PM<span class="token punctuation">.</span>Permission<span class="token punctuation">[</span><span class="token punctuation">]</span></span> grantResults<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Xamarin<span class="token punctuation">.</span>Essentials<span class="token punctuation">.</span>Platform<span class="token punctuation">.</span><span class="token function">OnRequestPermissionsResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> grantResults<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnRequestPermissionsResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> grantResults<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="4Cso_387"></a>4.添加C++动态库.so</h2>
<p>按照微软的教学文档在编译MathSharpLib库时，c++的动态库应该在文件的生成操作，以“EmbeddedNativeLibrary”的形式嵌入进MathSharpLib库中。然而并不能找到这个选项。所以Nuget包里没有，再次添加到App里，生成apk时打包进去。<br/> 这时的目录结构很重要。名字不能错，因为编译器是根据目录名称来判断ABI的类型的。arm64-v8a放的是我们的C++动态库MathClib在ARM64下编译的，armeabi-v7a是ARM下编译的。添加好后再次编译。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c98d70217cab4a8abc26c50ff78efcd8.png"/></p>
<h2><a id="5APPapk_391"></a>5.生成APP的安装包apk文件。</h2>
<p>右键App项目，选择【存档】【分发】【临时】，在UI创建一个新的密钥存储。然后另存为XXX.apk。<br/> 至此App就完成了。拷贝到手机上就能安装使用了。<br/> App.apk解压之后我们能看到我们的C++的动态库libMathCLib.so。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0b48a8866a7b4bee9a0ac61c7f605a10.png"/></p>
<p>和C#外壳动态库。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/22f5b270f90b40aebdaf54e6bf5dcb58.png"/></p>
<p>最终手机运行效果。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/fc9c3045286f4d259beb172dc9fd5e72.jpeg"/></p>
<h1><a id="_405"></a>总结</h1>
<p>C++与C#实现跨平台方案，首先编译出Arm平台库、加C#外壳、生成nuget包以便灵活使用。需要注意的是C++的动态库一定要打到apk里。可以嵌入到C#的包里（我没实现），也可以加载到Apk里。一定要注意组件所在目录的名称，这里用以区分组件的ABI类型，也就是组件的平台架构，是arm还是x86，是64位还是32位。</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>