<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-tomorrow-night" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p>界面设计参考了野火串口调试助手C#版</p>
<p>功能基本实现！实现效果看图：<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/011e47c6e7f940bc8272df792b0dd663.gif"/><br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/5f111eb605a240e7bc028d6d51a2bc3c.gif"/></p>
<h2><a id="_6"></a>第一步：制作图形界面</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/29693f3dc0f84a4a8b8149e1b32a0f82.png"/><br/> 注意控件命名要又辨识度，不然在编写代码时将是很很痛苦的</p>
<h2><a id="_11"></a>第二步：添加相应的库</h2>
<p>添加此次工程所需要的串口库，在工程的<code>.pro</code>文件下添加以下代码：</p>
<pre><code class="prism language-cpp">QT       <span class="token operator">+=</span> core gui
QT       <span class="token operator">+=</span> serialport
</code></pre>
<p>添加串口使用到的头文件：</p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtSerialPort/QSerialPort&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QtSerialPort/QSerialPortInfo&gt;</span></span>
</code></pre>
<h2><a id="_25"></a>第三步：编程</h2>
<p>看代码注释<br/> <strong>搜索可用串口并添加到QComboBox里</strong></p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SerialDebugging</span><span class="token double-colon punctuation">::</span><span class="token function">getAvailablePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ui<span class="token operator">-&gt;</span>portCB<span class="token operator">-&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">foreach</span> <span class="token punctuation">(</span><span class="token keyword">const</span> QSerialPortInfo <span class="token operator">&amp;</span>info<span class="token punctuation">,</span> <span class="token class-name">QSerialPortInfo</span><span class="token double-colon punctuation">::</span><span class="token function">availablePorts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        QSerialPort serialp<span class="token punctuation">;</span>
        serialp<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>serialp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadWrite<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            ui<span class="token operator">-&gt;</span>portCB<span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span>serialp<span class="token punctuation">.</span><span class="token function">portName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            serialp<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>打开串口和关闭串口</strong></p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SerialDebugging</span><span class="token double-colon punctuation">::</span><span class="token function">on_openPortBtn_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>openPortBtn<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"打开串口"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>portCB<span class="token operator">-&gt;</span><span class="token function">currentText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            ui<span class="token operator">-&gt;</span>stateLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"无可用串口"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ui<span class="token operator">-&gt;</span>stateImageLabel<span class="token operator">-&gt;</span><span class="token function">setPixmap</span><span class="token punctuation">(</span><span class="token function">QPixmap</span><span class="token punctuation">(</span><span class="token string">":/image/dot-gray.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        serial <span class="token operator">=</span> <span class="token keyword">new</span> QSerialPort<span class="token punctuation">;</span>
        serial<span class="token operator">-&gt;</span><span class="token function">setPortName</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>portCB<span class="token operator">-&gt;</span><span class="token function">currentText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置端口</span>
        serial<span class="token operator">-&gt;</span><span class="token function">open</span><span class="token punctuation">(</span>QIODevice<span class="token double-colon punctuation">::</span>ReadWrite<span class="token punctuation">)</span><span class="token punctuation">;</span>
        serial<span class="token operator">-&gt;</span><span class="token function">setBaudRate</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>baudRateCB<span class="token operator">-&gt;</span><span class="token function">currentText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置波特率</span>
        <span class="token comment">//设置校验位</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>parityBitCB<span class="token operator">-&gt;</span><span class="token function">currentIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setParity</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>NoParity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setParity</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>OddParity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setParity</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>EvenParity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setParity</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>MarkParity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setParity</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>SpaceParity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//设置数据位</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>dataBitCB<span class="token operator">-&gt;</span><span class="token function">currentText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setDataBits</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>Data8<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setDataBits</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>Data7<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setDataBits</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>Data6<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setDataBits</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>Data5<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//设置停止位</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>stopBitCB<span class="token operator">-&gt;</span><span class="token function">currentIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setStopBits</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>OneStop<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setStopBits</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>OneAndHalfStop<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            serial<span class="token operator">-&gt;</span><span class="token function">setStopBits</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>TwoStop<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//设置无流控制</span>
        serial<span class="token operator">-&gt;</span><span class="token function">setFlowControl</span><span class="token punctuation">(</span>QSerialPort<span class="token double-colon punctuation">::</span>NoFlowControl<span class="token punctuation">)</span><span class="token punctuation">;</span> 

        ui<span class="token operator">-&gt;</span>portCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>baudRateCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>parityBitCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>dataBitCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>stopBitCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>openPortBtn<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"关闭串口"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>stateLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"串口已打开"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>stateImageLabel<span class="token operator">-&gt;</span><span class="token function">setPixmap</span><span class="token punctuation">(</span><span class="token function">QPixmap</span><span class="token punctuation">(</span><span class="token string">":/image/dot-cyan.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">connect</span><span class="token punctuation">(</span>serial<span class="token punctuation">,</span><span class="token operator">&amp;</span>QSerialPort<span class="token double-colon punctuation">::</span>readyRead<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>SerialDebugging<span class="token double-colon punctuation">::</span>serialReceiveData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>serial<span class="token operator">-&gt;</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//如果原来的串口打开了，先关闭</span>
            serial<span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//释放串口</span>
        <span class="token keyword">delete</span> serial<span class="token punctuation">;</span>
        serial <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

        ui<span class="token operator">-&gt;</span>portCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>baudRateCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>parityBitCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>dataBitCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>stopBitCB<span class="token operator">-&gt;</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>openPortBtn<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"打开串口"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>stateLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"串口已关闭"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>stopShowBtn<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"停止显示"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ui<span class="token operator">-&gt;</span>stateImageLabel<span class="token operator">-&gt;</span><span class="token function">setPixmap</span><span class="token punctuation">(</span><span class="token function">QPixmap</span><span class="token punctuation">(</span><span class="token string">":/image/dot-gray.png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>串口接收数据并显示在QTextEdit</strong></p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SerialDebugging</span><span class="token double-colon punctuation">::</span><span class="token function">serialReceiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QByteArray array <span class="token operator">=</span> serial<span class="token operator">-&gt;</span><span class="token function">readAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    revByte <span class="token operator">+=</span> array<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString revString<span class="token punctuation">;</span>
    <span class="token comment">//这句在这里写了两个次，如果只写一次会有点小毛病，有点强迫症不能忍</span>
    ui<span class="token operator">-&gt;</span>serialRevTextEdit<span class="token operator">-&gt;</span><span class="token function">moveCursor</span><span class="token punctuation">(</span>QTextCursor<span class="token double-colon punctuation">::</span>End<span class="token punctuation">,</span>QTextCursor<span class="token double-colon punctuation">::</span>MoveAnchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>stopShow<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">//十六进制显示</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>hexShowCheckBox<span class="token operator">-&gt;</span><span class="token function">isChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            QDataStream <span class="token function">outArray</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>array<span class="token punctuation">,</span>QIODevice<span class="token double-colon punctuation">::</span>ReadOnly<span class="token punctuation">)</span><span class="token punctuation">;</span>
            qint8 outChar <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>outArray<span class="token punctuation">.</span><span class="token function">atEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                outArray <span class="token operator">&gt;&gt;</span> outChar<span class="token punctuation">;</span>
                revString <span class="token operator">=</span> <span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>outChar<span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token function">QLatin1Char</span><span class="token punctuation">(</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ui<span class="token operator">-&gt;</span>serialRevTextEdit<span class="token operator">-&gt;</span><span class="token function">insertPlainText</span><span class="token punctuation">(</span>revString<span class="token punctuation">.</span><span class="token function">toUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ui<span class="token operator">-&gt;</span>serialRevTextEdit<span class="token operator">-&gt;</span><span class="token function">insertPlainText</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token comment">//ASCII显示</span>
        <span class="token punctuation">{<!-- --></span>
            revString <span class="token operator">=</span> <span class="token class-name">QString</span><span class="token double-colon punctuation">::</span><span class="token function">fromLocal8Bit</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ui<span class="token operator">-&gt;</span>autoClearCheckBox<span class="token operator">-&gt;</span><span class="token function">isChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//自动清空</span>
                ui<span class="token operator">-&gt;</span>serialRevTextEdit<span class="token operator">-&gt;</span><span class="token function">insertPlainText</span><span class="token punctuation">(</span>revString<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                ui<span class="token operator">-&gt;</span>serialRevTextEdit<span class="token operator">-&gt;</span><span class="token function">setPlainText</span><span class="token punctuation">(</span>revString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
       	<span class="token comment">//接收字节数</span>
        ui<span class="token operator">-&gt;</span>revByteLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>revByte<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//这句在这里写了两个次，如果只写一次会有点小毛病，有点强迫症不能忍</span>
        ui<span class="token operator">-&gt;</span>serialRevTextEdit<span class="token operator">-&gt;</span><span class="token function">moveCursor</span><span class="token punctuation">(</span>QTextCursor<span class="token double-colon punctuation">::</span>End<span class="token punctuation">,</span>QTextCursor<span class="token double-colon punctuation">::</span>MoveAnchor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>串口发送数据</strong></p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SerialDebugging</span><span class="token double-colon punctuation">::</span><span class="token function">on_sendDataBtn_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>openPortBtn<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"打开串口"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        ui<span class="token operator">-&gt;</span>stateLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"请先打开串口！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    QString sendData <span class="token operator">=</span> ui<span class="token operator">-&gt;</span>serialSendTextEdit<span class="token operator">-&gt;</span><span class="token function">toPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QByteArray array<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>ui<span class="token operator">-&gt;</span>hexSendCheckBox<span class="token operator">-&gt;</span><span class="token function">isChecked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        array <span class="token operator">=</span> <span class="token class-name">QByteArray</span><span class="token double-colon punctuation">::</span><span class="token function">fromHex</span><span class="token punctuation">(</span>sendData<span class="token punctuation">.</span><span class="token function">toUtf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//字符串转16进制发送</span>
    <span class="token keyword">else</span>
        array <span class="token operator">=</span> sendData<span class="token punctuation">.</span><span class="token function">toLocal8Bit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ASCII发送</span>
    <span class="token keyword">int</span> sbyte <span class="token operator">=</span> serial<span class="token operator">-&gt;</span><span class="token function">write</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sendByte <span class="token operator">+=</span> sbyte<span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>sendByteLabel<span class="token operator">-&gt;</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"%1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>sendByte<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送字节数</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>还有一些小功能（清除接收、接收转向文件、加载文件等功能）的实现方法就不贴代码上来啦，具体看工程源码，工程源码链接在底部。</code></p>
<h2><a id="nativeEventWindows_213"></a>附：使用nativeEvent获取Windows事件处理实现串口热插拔</h2>
<p>实现串口热插拔可以通过添加一个定时器间隔一秒钟获取一次串口列表。<br/> 但是我在网上冲浪学到了使用nativeEvent获取Windows事件，从而可以实现串口热插拔。nativeEvent功能很高级，就是我用的方法<code>很蠢，很搞笑</code>。<br/> <strong><code>注意：nativeEvent函数需要编写在窗口的基类才可以触发</code></strong>，比如我的文件结构是这样的<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ee806576cdf74707b49dce9adaca7f85.png"/><br/> <code>mainwidget.cpp是主窗口，而串口程序编程在serialdebugging.cpp，当时我把nativeEvent函数编写在serialdebugging.cpp的类里，搞了很久都没有反应，最后在网上冲浪才找到原因（新手踩坑多）。 所以nativeEvent函数需要编写在mainwidget.cpp的mainwidget类里。</code><br/> 如果想要了解nativeEvent，大家可以网上 冲浪学习学习<br/> <strong>1.添加头文件</strong></p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windowsx.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;dbt.h&gt;</span></span>
</code></pre>
<p><strong>2.头文件定义函数</strong></p>
<pre><code class="prism language-cpp"><span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">bool</span> <span class="token function">nativeEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> QByteArray <span class="token operator">&amp;</span>eventType<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>message<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token operator">*</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>3.具体实现</strong></p>
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">MainWidget</span><span class="token double-colon punctuation">::</span><span class="token function">nativeEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> QByteArray <span class="token operator">&amp;</span>eventType<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>message<span class="token punctuation">,</span> <span class="token keyword">long</span> <span class="token operator">*</span>result<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    MSG<span class="token operator">*</span> msg <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>MSG<span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token operator">-&gt;</span>message <span class="token operator">==</span> WM_DEVICECHANGE<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        PDEV_BROADCAST_HDR lpdb <span class="token operator">=</span> <span class="token punctuation">(</span>PDEV_BROADCAST_HDR<span class="token punctuation">)</span>msg<span class="token operator">-&gt;</span>lParam<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>msg<span class="token operator">-&gt;</span>wParam<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> DBT_DEVICEARRIVAL<span class="token operator">:</span>             <span class="token comment">// 插入</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lpdb<span class="token operator">-&gt;</span>dbch_devicetype <span class="token operator">==</span> DBT_DEVTYP_PORT<span class="token punctuation">)</span>           <span class="token comment">// 设备类型为串口</span>
            <span class="token punctuation">{<!-- --></span>
                serialDebug<span class="token operator">-&gt;</span><span class="token function">getAvailablePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用获取串口函数</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">case</span> DBT_DEVICEREMOVECOMPLETE<span class="token operator">:</span>      <span class="token comment">// 拔出</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lpdb<span class="token operator">-&gt;</span>dbch_devicetype <span class="token operator">==</span> DBT_DEVTYP_PORT<span class="token punctuation">)</span>           <span class="token comment">// 设备类型为串口</span>
            <span class="token punctuation">{<!-- --></span>
                serialDebug<span class="token operator">-&gt;</span><span class="token function">getAvailablePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>串口调试助手的主要功能就完成了<br/> 还有一些小功能的实现方法具体看工程源码啦。<br/> 工程源码：https://download.csdn.net/download/qq_44793587/85236748<br/> 或者留言邮箱</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>