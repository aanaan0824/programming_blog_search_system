<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>Java提供接口给第三方使用，校验保证接口的安全性</h3>
<ul><li><a href="#_1">前言</a></li><li><ul><li><a href="#Controller_6">接口Controller</a></li><li><a href="#_46">接口幂等性校验</a></li><li><a href="#ServiceImpl_78">实现类ServiceImpl</a></li><li><a href="#Api_188">第三方调用接口Api实现类</a></li><li><a href="#_233">生成签名工具类</a></li><li><a href="#HttpCilent_314">HttpCilent工具类</a></li></ul>
</li></ul>
</div>
<p></p>
<h1><a id="_1"></a>前言</h1>
<p>相信有很多小伙伴，在日常的开发中都有遇到过需要调用第三方接口的需求吧，但是自己有没有写过接口提供给第三方使用呢，常规的都是我们调用别人的接口，但是自己需要开发接口提供给第三方使用的场景应该不是很多，很多小伙伴可能会想不就开发一个接口对外开放嘛岂不是很简单，但是在开发接口对外开放，我们需要考虑一个问题，没有限制条件，那岂不是太不安全了，谁都可以调我这个接口了啊。<br/> 所以接下来的就是我们需要考虑的问题了，在开发接口的时候就要考虑到安全性的问题，那么应该如何去解决这个问题呢？提供接口给第三方使用的时候需要加上校验保证接口的安全性。<br/> 下面是我写的一个例子希望对大家有帮助。</p>
<h2><a id="Controller_6"></a>接口Controller</h2>
<p>在写接口前一定要签名做签名校验，我的签名方式做了特殊处理，因为接口是对外开放的，这个是为了避免恶意调用接口做的处理，叫做签名的混淆值，这个签名混淆值的作用是就算别人知道了接口，并且知道签名方式也不能被攻击，是为了避免被恶意篡改数据，签名混淆值就是一组特定加密后的数据。</p>
<pre><code class="prism language-java">	<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"refundDeductionPoints"</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span> refundDeductionPoints <span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//签名校验</span>
			<span class="token class-name">String</span> msgDigest <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"msgDigest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//签名</span>
			<span class="token class-name">String</span> msgData <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"msgData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> timeStamp <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"timeStamp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> secret <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"secret"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//	秘钥</span>
			<span class="token class-name">String</span> sign <span class="token operator">=</span> <span class="token class-name">SignUtil</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>msgData<span class="token operator">+</span><span class="token string">"wf8la1tw7p9o2xz"</span><span class="token punctuation">,</span>timeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//wf8la1tw7p9o2xz为签名混淆值</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>msgDigest<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">1006</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"数字签名无效"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//先签名后幂等校验</span>
				<span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"密钥不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">/**
			 * 幂等校验
			 * 1.同一个用户操作同一个退货单一分钟内操作该单据视为重复操作（此秘钥已通过特殊处理）
			 */</span>
			<span class="token class-name">String</span> value <span class="token operator">=</span> redistempalte<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>	
				logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"重复请求 secret={}"</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token number">1007</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"重复请求"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
			<span class="token punctuation">}</span>
			redistempalte<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>secret<span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置缓存一分钟</span>
			<span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">refundDeductionPoints</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"添加积分流水异常"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>BUSINESS_ERROR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"生成积分流水失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre>
<h2><a id="_46"></a>接口幂等性校验</h2>
<p>此接口做幂等性校验，幂等性校验常见解决方案有很多，可以自行根据实际情况选择，<br/> 说到幂等首先要先了解什么是幂等<br/> <strong>概念：</strong><br/> 幂等（idempotent、idempotence）是一个数学与计算机学概念，常见于抽象代数中。</p>
<p>在编程中.一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数。</p>
<p>这些函数不会影响系统状态，也不用担心重复执行会对系统造成改变。例如，“getUsername()和setTrue()”函数就是一个幂等函数.</p>
<p>幂等性, 通俗的说就是一个接口, 多次发起同一个请求, 必须保证操作只能执行一次，比如:</p>
<p>订单接口, 不能多次创建订单<br/> 支付接口, 重复支付同一笔订单只能扣一次钱<br/> 支付宝回调接口, 可能会多次回调, 必须处理重复回调<br/> 普通表单提交接口, 因为网络超时等原因多次点击提交, 只能成功一次<br/> 等等<br/> <strong>解决方案常见的几种方式</strong><br/> 唯一索引 – 防止新增脏数据</p>
<p>token机制 – 防止页面重复提交</p>
<p>悲观锁 – 获取数据的时候加锁(锁表或锁行)</p>
<p>乐观锁 – 基于版本号version实现, 在更新数据那一刻校验数据</p>
<p>分布式锁 – redis(jedis、redisson)或zookeeper实现</p>
<p>状态机 – 状态变更, 更新数据时判断状态</p>
<p>如果有小伙伴不理解什么是幂等可以看看官方是解释</p>
<h2><a id="ServiceImpl_78"></a>实现类ServiceImpl</h2>
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Transactional</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span> <span class="token function">refundDeductionPoints</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">String</span> msgData <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"msgData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ParamIntegral</span> entity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>msgData<span class="token punctuation">,</span> <span class="token class-name">ParamIntegral</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"请求参数不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getBitems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"请求参数不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ParamIntegral</span> bitem <span class="token operator">:</span> entity<span class="token punctuation">.</span><span class="token function">getBitems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getDdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"订单号为必传参数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"扣减积分不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MallOrderInfo</span><span class="token punctuation">&gt;</span></span> orderInfo <span class="token operator">=</span> mallOrderInfoMapper<span class="token punctuation">.</span><span class="token function">selectByDdh</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getDdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>orderInfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"订单号为"</span> <span class="token operator">+</span> bitem<span class="token punctuation">.</span><span class="token function">getDdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"没有此订单请联系客服核对信息。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>orderInfo <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> orderInfo<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"订单号为"</span> <span class="token operator">+</span> bitem<span class="token punctuation">.</span><span class="token function">getDdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"有多个相同订单请联系客服核对信息。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"E"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>orderInfo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDdzt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"订单号为"</span> <span class="token operator">+</span> bitem<span class="token punctuation">.</span><span class="token function">getDdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"未确认收货还没产生积分不允许退货。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">SysIntegral</span> integral <span class="token operator">=</span> <span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span>integralMapper<span class="token punctuation">.</span><span class="token function">selectByMdbm</span><span class="token punctuation">(</span>orderInfo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMdbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>integral <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span>
						<span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"门店编码为"</span> <span class="token operator">+</span> orderInfo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMdbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"积分汇总没有找到此门店，请联系客服核实"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">BigDecimal</span> kyjf <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getReturnGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 可用积分小于扣减积分不够扣ERP使用前抵扣</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getKyjf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					kyjf <span class="token operator">=</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">;</span>					
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 可用积分 = 当前可用积分-扣减积分</span>
					kyjf <span class="token operator">=</span> <span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">nvl</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getKyjf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 可用积分 = 当前可用积分+退还积分</span>
				kyjf <span class="token operator">=</span> <span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">nvl</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getKyjf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				
			<span class="token punctuation">}</span>		
			<span class="token comment">// 更新积分汇总</span>
			<span class="token class-name">SysIntegral</span> dataMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SysIntegral</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dataMap<span class="token punctuation">.</span><span class="token function">setIntegralId</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getIntegralId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dataMap<span class="token punctuation">.</span><span class="token function">setMdbm</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getMdbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dataMap<span class="token punctuation">.</span><span class="token function">setKyjf</span><span class="token punctuation">(</span>kyjf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			dataMap<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dataMap<span class="token punctuation">.</span><span class="token function">setUpdateUser</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			dataMap<span class="token punctuation">.</span><span class="token function">setUpdateUserid</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
			row <span class="token operator">=</span> integralMapper<span class="token punctuation">.</span><span class="token function">updateByPrimaryKeySelective</span><span class="token punctuation">(</span>dataMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">TransactionAspectSupport</span><span class="token punctuation">.</span><span class="token function">currentTransactionStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"更新积分失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">//推送到ERP门店信息</span>
			 <span class="token class-name">BdMdxxH</span> mdxx <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">BdMdxxH</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			 mdxx<span class="token punctuation">.</span><span class="token function">setMdbm</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getMdbm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			 mdxx<span class="token punctuation">.</span><span class="token function">setMdjf</span><span class="token punctuation">(</span>kyjf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>lkfs<span class="token punctuation">.</span>cw<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span>Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BdMdxxH</span><span class="token punctuation">&gt;</span></span> bdMdxxh <span class="token operator">=</span> dataBaseServiceApi<span class="token punctuation">.</span><span class="token function">updateStorePoints</span><span class="token punctuation">(</span>mdxx<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bdMdxxh<span class="token punctuation">.</span><span class="token function">isComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">TransactionAspectSupport</span><span class="token punctuation">.</span><span class="token function">currentTransactionStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>bdMdxxh<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span>bdMdxxh<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>		
			<span class="token class-name">SysIntegralStatement</span> statement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SysIntegralStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getReturnGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				statement<span class="token punctuation">.</span><span class="token function">setJfz</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 消费的积分值</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getKyjf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 可用积分小于扣减积分不够扣ERP使用前抵扣</span>
					statement<span class="token punctuation">.</span><span class="token function">setTzhjfz</span><span class="token punctuation">(</span><span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 调整后积分值</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					statement<span class="token punctuation">.</span><span class="token function">setTzhjfz</span><span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">nvl</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getKyjf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 调整后积分值</span>
				<span class="token punctuation">}</span>
				statement<span class="token punctuation">.</span><span class="token function">setJfxflx</span><span class="token punctuation">(</span><span class="token string">"E"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 积分支出</span>
				statement<span class="token punctuation">.</span><span class="token function">setXxsm</span><span class="token punctuation">(</span><span class="token string">"退货扣减积分（订单号为："</span> <span class="token operator">+</span> bitem<span class="token punctuation">.</span><span class="token function">getDdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> <span class="token string">"退货单号为："</span> <span class="token operator">+</span> entity<span class="token punctuation">.</span><span class="token function">getDjh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"）"</span> <span class="token operator">+</span> <span class="token string">"已扣除："</span>
						<span class="token operator">+</span> bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":积分"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 取消退货</span>
				statement<span class="token punctuation">.</span><span class="token function">setJfxflx</span><span class="token punctuation">(</span><span class="token string">"I"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 积分收入</span>
				statement<span class="token punctuation">.</span><span class="token function">setJfz</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 取消退货把积分赠送回来</span>
				statement<span class="token punctuation">.</span><span class="token function">setTzhjfz</span><span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span><span class="token function">nvl</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getKyjf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ZERO<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 调整后积分值</span>
				statement<span class="token punctuation">.</span><span class="token function">setXxsm</span><span class="token punctuation">(</span><span class="token string">"取消退货（订单号为："</span> <span class="token operator">+</span> bitem<span class="token punctuation">.</span><span class="token function">getDdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> <span class="token string">"退货单号为："</span> <span class="token operator">+</span> entity<span class="token punctuation">.</span><span class="token function">getDjh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"）"</span> <span class="token operator">+</span> <span class="token string">"已退还："</span>
						<span class="token operator">+</span> bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":积分"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			statement<span class="token punctuation">.</span><span class="token function">setIntegralId</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getIntegralId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 该门店积分编码</span>
			statement<span class="token punctuation">.</span><span class="token function">setTzqjfz</span><span class="token punctuation">(</span>integral<span class="token punctuation">.</span><span class="token function">getKyjf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 调整前积分值</span>
			statement<span class="token punctuation">.</span><span class="token function">setDdh</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getDdh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			statement<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 流水生成时间</span>
			statement<span class="token punctuation">.</span><span class="token function">setCreateUser</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			statement<span class="token punctuation">.</span><span class="token function">setCreateUserid</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			statement<span class="token punctuation">.</span><span class="token function">setJftz</span><span class="token punctuation">(</span><span class="token string">"T"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 积分扣减为T</span>
			statement<span class="token punctuation">.</span><span class="token function">setZt</span><span class="token punctuation">(</span><span class="token string">"Y"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 状态 Y：有效</span>
			row <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>statement<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">TransactionAspectSupport</span><span class="token punctuation">.</span><span class="token function">currentTransactionStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRollbackOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>INNER_ERROR<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"插入积分流水失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SysIntegralStatement</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodes</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReason</span><span class="token punctuation">(</span><span class="token string">"操作成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre>
<h2><a id="Api_188"></a>第三方调用接口Api实现类</h2>
<p>模拟第三方合作方调用接口</p>
<pre><code class="prism language-java"><span class="token comment">//此方式以上已写了封装信息就不一一展示了，可以根据实际情况自行操作</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pushIntegral</span><span class="token punctuation">(</span><span class="token class-name">Long</span> djlsh<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">FiSjysjsH</span> fiSjysjsh <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>djlsh<span class="token punctuation">)</span><span class="token punctuation">;</span>				
		<span class="token comment">//订单退货调用某某退货扣减积分接口</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FiSjysjsB</span><span class="token punctuation">&gt;</span></span> sjysjsbList <span class="token operator">=</span> bmapper<span class="token punctuation">.</span><span class="token function">selectByKhddh</span><span class="token punctuation">(</span>djlsh<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>sjysjsbList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> sjysjsbList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ParamIntegral</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ParamIntegral</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FiSjysjsB</span> bitem <span class="token operator">:</span> sjysjsbList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">ParamIntegral</span> temp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParamIntegral</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				temp<span class="token punctuation">.</span><span class="token function">setDdh</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getKhddh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				temp<span class="token punctuation">.</span><span class="token function">setJfz</span><span class="token punctuation">(</span>bitem<span class="token punctuation">.</span><span class="token function">getJfz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			
				list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">ParamIntegral</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParamIntegral</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			param<span class="token punctuation">.</span><span class="token function">setBitems</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
			param<span class="token punctuation">.</span><span class="token function">setDjh</span><span class="token punctuation">(</span>fiSjysjsh<span class="token punctuation">.</span><span class="token function">getDjh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			param<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span><span class="token class-name">AppRealm</span><span class="token punctuation">.</span><span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			param<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token class-name">AppRealm</span><span class="token punctuation">.</span><span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Short</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fiSjysjsh<span class="token punctuation">.</span><span class="token function">getLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				param<span class="token punctuation">.</span><span class="token function">setReturnGoods</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				param<span class="token punctuation">.</span><span class="token function">setReturnGoods</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">String</span> msgData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> timeStamp <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//时间戳</span>
			params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"timeStamp"</span><span class="token punctuation">,</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
			params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msgData"</span><span class="token punctuation">,</span> msgData<span class="token punctuation">)</span><span class="token punctuation">;</span>	
			params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msgDigest"</span><span class="token punctuation">,</span> <span class="token class-name">SignUtil</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>msgData<span class="token operator">+</span><span class="token string">"wf8la1tw7p9o2xz"</span><span class="token punctuation">,</span> timeStamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成签名第二个值暂定(wf8la1tw7p9o2xz签名混淆值)</span>
			params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"secret"</span><span class="token punctuation">,</span>IDEMPOTENT_SECRET_PREFIX <span class="token operator">+</span> fiSjysjsh<span class="token punctuation">.</span><span class="token function">getDjh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">AppRealm</span><span class="token punctuation">.</span><span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>param<span class="token punctuation">.</span><span class="token function">getReturnGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//自定义密钥 做幂等校验</span>
			<span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token class-name">HttpCilent</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>B2B_URL<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//发送http post请求</span>
			<span class="token class-name">B2bIntegralResponse</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token class-name">B2bIntegralResponse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"调用积分接口系统异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//接口返回失败异常代码提示</span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"调用积分接口发生异常，异常代码为："</span><span class="token operator">+</span>res<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"异常信息为:"</span><span class="token operator">+</span>res<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre>
<h2><a id="_233"></a>生成签名工具类</h2>
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cy<span class="token punctuation">.</span>xgsm<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">MessageDigest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span></span><span class="token class-name">JsonElement</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span></span><span class="token class-name">JsonObject</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span></span><span class="token class-name">JsonParser</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 
 * @author Dylan
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SignUtil</span> <span class="token punctuation">{<!-- --></span>
	
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SignUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/**
	 * 
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">,</span> <span class="token class-name">String</span> secret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">StringBuilder</span> enValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		enValue<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
		enValue<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		enValue<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">encryptByMD5</span><span class="token punctuation">(</span>enValue<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encryptByMD5</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">String</span> re_md5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">MessageDigest</span> md <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			md<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">byte</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> i<span class="token punctuation">;</span>
			<span class="token class-name">StringBuffer</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> offset <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>length<span class="token punctuation">;</span> offset<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				i <span class="token operator">=</span> b<span class="token punctuation">[</span>offset<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
					i <span class="token operator">+=</span> <span class="token number">256</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span>
					buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			re_md5 <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> re_md5<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> jsonStr<span class="token punctuation">,</span><span class="token class-name">String</span> secret <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

		<span class="token class-name">JsonParser</span> jsonParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">JsonObject</span> jsonObject <span class="token operator">=</span> jsonParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAsJsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> sign1 <span class="token operator">=</span> <span class="token string">"null"</span><span class="token punctuation">;</span>
		<span class="token class-name">JsonElement</span> signElement <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"sign"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span> signElement <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			sign1 <span class="token operator">=</span> signElement<span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"sign1: "</span> <span class="token operator">+</span> sign1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">StringBuilder</span> enValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		enValue<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
		enValue<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		enValue<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> sign2 <span class="token operator">=</span> <span class="token function">encryptByMD5</span><span class="token punctuation">(</span>enValue<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		jsonObject<span class="token punctuation">.</span><span class="token function">addProperty</span><span class="token punctuation">(</span><span class="token string">"sign"</span><span class="token punctuation">,</span> sign2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> jsonObject<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	

<span class="token punctuation">}</span>
</code></pre>
<h2><a id="HttpCilent_314"></a>HttpCilent工具类</h2>
<p>这个工具类在我之前的文章也有但是没有把这个方式的放上去，如果有需要用到可直接把一下代码复制到<a href="https://blog.csdn.net/weixin_45731661/article/details/125531719">这个Http工具类</a> 最后即可直接使用。</p>
<pre><code class="prism language-java">   <span class="token comment">/**
     * 发送post请求
     * @param url 目的url
     * @param parameters 参数
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 返回的结果</span>
    	<span class="token class-name">BufferedReader</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 读取响应输入流</span>
    	<span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    	<span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 处理请求参数</span>
    	<span class="token class-name">String</span> params <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">// 编码之后的参数</span>
    	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">// 编码请求参数</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>parameters<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> parameters<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    	<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span>
    	<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>
    	parameters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	params <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> parameters<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    	<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span>
    	<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>
    	parameters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token class-name">String</span> temp_params <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	params <span class="token operator">=</span> temp_params<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> temp_params<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token comment">// 创建URL对象</span>
    	<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URL</span> connURL <span class="token operator">=</span> <span class="token keyword">new</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span><span class="token function">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 打开URL连接</span>
    	<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>HttpURLConnection</span> httpConn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>HttpURLConnection</span><span class="token punctuation">)</span> connURL
    	<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置通用属性</span>
    	httpConn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">,</span> <span class="token string">"*/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	httpConn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">"Connection"</span><span class="token punctuation">,</span> <span class="token string">"Keep-Alive"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	httpConn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">"content-type"</span><span class="token punctuation">,</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	httpConn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span>
    	<span class="token string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 设置POST方式</span>
    	httpConn<span class="token punctuation">.</span><span class="token function">setDoInput</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	httpConn<span class="token punctuation">.</span><span class="token function">setDoOutput</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 获取HttpURLConnection对象对应的输出流</span>
    	out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>httpConn<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 发送请求参数</span>
    	out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// flush输出流的缓冲</span>
    	out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token comment">// 定义BufferedReader输入流来读取URL的响应，设置编码方式</span>
    	in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>
    	httpConn<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token class-name">String</span> line<span class="token punctuation">;</span>
    	<span class="token comment">// 读取返回的内容</span>
    	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	result <span class="token operator">+=</span> line<span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    	<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
    	<span class="token punctuation">}</span>
    	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
</code></pre>
<p>此文章仅供参考，如果能帮助到大家，可以给博主支持一下。</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>