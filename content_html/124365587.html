<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>目录</h3>
<ul><li><a href="#_2">一、设计思路</a></li><li><ul><li><a href="#1_3">1、背景</a></li><li><a href="#2_6">2、简介</a></li><li><a href="#3_9">3、用到的技术</a></li><li><a href="#4_14">4、设计</a></li><li><ul><li><a href="#_15">功能一：用户注册</a></li><li><ul><li><a href="#_16">功能概述</a></li><li><a href="#_19">功能示意图</a></li><li><a href="#_24">时序图</a></li></ul>
</li><li><a href="#_26">功能二：人脸识别</a></li><li><ul><li><a href="#_27">功能概述</a></li><li><a href="#_30">功能示意图</a></li><li><a href="#_34">时序图</a></li></ul>
</li></ul>
</li></ul>
</li><li><a href="#_36">二、实现</a></li><li><ul><li><a href="#1_37">1、环境准备</a></li><li><a href="#2_41">2、百度接口配置</a></li><li><a href="#3_54">3、技术准备</a></li><li><a href="#4_72">4、代码实现</a></li><li><ul><li><a href="#_73">功能一：用户注册</a></li><li><a href="#_224">功能二：人脸识别</a></li></ul>
</li><li><a href="#5_230">5、补充</a></li></ul>
</li></ul>
</div>
<p></p>
<h1><a id="_2"></a>一、设计思路</h1>
<h2><a id="1_3"></a>1、背景</h2>
<p>家里面的小朋友（我弟）去参加学校组织的一个小比赛，配合他做了这个人脸识别的小程序，把设计思路和代码发在这里。</p>
<h2><a id="2_6"></a>2、简介</h2>
<p>本程序通过调用百度的人脸识别相关的云服务算法，最终实现“人脸注册”和“人脸识别欢迎语提示”这两个功能。</p>
<h2><a id="3_9"></a>3、用到的技术</h2>
<p>本程序的最终实现形式为Windows桌面程序，本程序主要采用微软的Winform模式进行开发，编程语言为C#。<br/> 开发所使用的IDE为Visual Studio2019（.NET Core3.1），辅助工具为Postman、Json格式转换工具、Base64编码工具等。</p>
<h2><a id="4_14"></a>4、设计</h2>
<h3><a id="_15"></a>功能一：用户注册</h3>
<h4><a id="_16"></a>功能概述</h4>
<p>用户图像（照片or实时图像） + 用户填写的信息 =&gt; 百度云端</p>
<h4><a id="_19"></a>功能示意图</h4>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b93f6f8fac484046a73127a9d1bb16aa.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2160af1fb65a44c591c6e1bead4fc1a2.png"/></p>
<h4><a id="_24"></a>时序图</h4>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8e41c72ff252471a8d259d05e97f14c3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASnVuZ2xlMTk5MzEwMDQ=,size_13,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<h3><a id="_26"></a>功能二：人脸识别</h3>
<h4><a id="_27"></a>功能概述</h4>
<p>识别出现在镜头中的用户。</p>
<h4><a id="_30"></a>功能示意图</h4>
<p><img alt="" src="image\8fcd9300b93b402abeb192f25e647f64.png"/></p>
<h4><a id="_34"></a>时序图</h4>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c4e0d5e333d347d8ab6fe4cebc99b371.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASnVuZ2xlMTk5MzEwMDQ=,size_17,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<h1><a id="_36"></a>二、实现</h1>
<h2><a id="1_37"></a>1、环境准备</h2>
<p>硬件：带有摄像头的计算机。<br/> 软件：Windows10 操作系统。<br/> 网络：连接互联网。</p>
<h2><a id="2_41"></a>2、百度接口配置</h2>
<p>（1） 打开百度智能云网址，注册登录，进入如下界面。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b36cbb9c041f4952bebb9c3dec4f1b7b.png"/><br/> （2） 点击立即使用。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e0945f536125431d929869c483f4055a.png"/><br/> （3） 点击创建应用。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/fd53dfb3e6174be7a786b6b4ee9193b8.png"/><br/> （4） 在应用名称一栏输入所建应用的名称，在应用描述一栏输入对所创建应用的大概描述，然后点击立即创建。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c49b60125150482ba1db73d2de70c484.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c7a948550103472d850d8ab3a54e396a.png"/><br/> （5） 点击返回应用列表即可看到刚才创建应用的详细信息，并且可以看到获取到的API key和Secret key。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/de59c959571e43258faf0789c210b651.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a49ee471a9344d2988b140d1f68441f4.png"/></p>
<h2><a id="3_54"></a>3、技术准备</h2>
<p>（1） 一张图片，在计算机最底层的本质就是一段二进制代码，不清楚该原理的可以去这个网站转一下试试：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d6762d8f010047259529e14e7d92a124.png"/><br/> （2） 这次要用到三个百度接口：<br/> A、登录接口（鉴权认证/获取Access Token）<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/76f678f34671471ea3a6f05aa76667c1.png"/><br/> 用Postman或者其他在线http请求工具调用一下试试：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/65d1c6423e0341e393cdad496aad84bf.png"/><br/> 注意，client_id和client_secret是你在百度应用中心申请的应用里面的API Key和Secret Key，这两个东西相当于用户名和密码。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/bf9982af83024f838ff2cfad8611d8a8.png"/><br/> B、注册接口（人脸库管理/人脸注册，别的不用看）<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/064fa9ee09f34868af1d18090e4ded0a.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6e31db40f5aa47c183b08e709ac1688e.png"/></p>
<p>C、人脸识别接口（人脸搜索/人脸搜索，别的不用看）<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/94873df0575f4dae9d23c8125d15a042.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/12652b7a7ac74792bb90f3dd03271ccb.png"/></p>
<h2><a id="4_72"></a>4、代码实现</h2>
<h3><a id="_73"></a>功能一：用户注册</h3>
<p>（1）创建TokenHelper，用于调用百度登录接口（鉴权认证/获取Access Token）</p>
<pre><code class="prism language-csharp">    <span class="token keyword">class</span> <span class="token class-name">TokenHelper</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> clientId <span class="token operator">=</span> ConfigurationSettings<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">"clientId"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> clientSecret <span class="token operator">=</span> ConfigurationSettings<span class="token punctuation">.</span>AppSettings<span class="token punctuation">[</span><span class="token string">"clientSecret"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword">string</span></span> authHost <span class="token operator">=</span> <span class="token string">"https://aip.baidubce.com/oauth/2.0/token"</span><span class="token punctuation">;</span>
            <span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List<span class="token punctuation">&lt;</span>KeyValuePair<span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> paraList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>KeyValuePair<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            paraList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">KeyValuePair<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"grant_type"</span><span class="token punctuation">,</span> <span class="token string">"client_credentials"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            paraList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">KeyValuePair<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"client_id"</span><span class="token punctuation">,</span> clientId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            paraList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">KeyValuePair<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"client_secret"</span><span class="token punctuation">,</span> clientSecret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">HttpResponseMessage</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">PostAsync</span><span class="token punctuation">(</span>authHost<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FormUrlEncodedContent</span><span class="token punctuation">(</span>paraList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> result <span class="token operator">=</span> response<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<p>注意一下，代码里的相关参数都写在app.config中，这些参数的值根据你所申请的百度账号里的参数值进行具体配置。</p>
<p>（2）创建ImagHelper，用于图片的格式转换</p>
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImagHelper</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 图片转为base64编码的文本</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="bmp"&gt;待转的Bitmap&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;转换后的base64字符串&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">String</span> <span class="token function">ImgToBase64String</span><span class="token punctuation">(</span><span class="token class-name">Image</span> bmp<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> strbaser64 <span class="token operator">=</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> btarr <span class="token operator">=</span> <span class="token function">convertByte</span><span class="token punctuation">(</span>bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            strbaser64 <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToBase64String</span><span class="token punctuation">(</span>btarr<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> strbaser64<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// Image转byte[]</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="img"&gt;Img格式数据&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;byte[]格式数据&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">convertByte</span><span class="token punctuation">(</span><span class="token class-name">Image</span> image<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ImageFormat</span> format <span class="token operator">=</span> image<span class="token punctuation">.</span>RawFormat<span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">MemoryStream</span> ms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MemoryStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>ImageFormat<span class="token punctuation">.</span>Jpeg<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    image<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Jpeg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>ImageFormat<span class="token punctuation">.</span>Png<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    image<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Png<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>ImageFormat<span class="token punctuation">.</span>Bmp<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    image<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Bmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>ImageFormat<span class="token punctuation">.</span>Gif<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    image<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Gif<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>ImageFormat<span class="token punctuation">.</span>Icon<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    image<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Icon<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    image<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> ImageFormat<span class="token punctuation">.</span>Jpeg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>ms<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">//Image.Save()会改变MemoryStream的Position，需要重新Seek到Begin</span>
                ms<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ms<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> buffer<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>（3）创建FaceHelper ，用于人脸注册和人脸搜索（即人脸识别）</p>
<pre><code class="prism language-csharp"><span class="token keyword">class</span> <span class="token class-name">FaceHelper</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDisposable</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> token <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 注册人脸</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="face"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">FaceMsg</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">FaceInfo</span> face<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> host <span class="token operator">=</span> <span class="token string">"https://aip.baidubce.com/rest/2.0/face/v3/faceset/user/add?access_token="</span> <span class="token operator">+</span> token<span class="token punctuation">;</span>

            <span class="token class-name">Encoding</span> encoding <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">;</span>
            <span class="token class-name">HttpWebRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span>HttpWebRequest<span class="token punctuation">)</span>WebRequest<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span>Method <span class="token operator">=</span> <span class="token string">"post"</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span>KeepAlive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> str <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> encoding<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span>ContentLength <span class="token operator">=</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">GetRequestStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">HttpWebResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span>HttpWebResponse<span class="token punctuation">)</span>request<span class="token punctuation">.</span><span class="token function">GetResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StreamReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">GetResponseStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> result <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">FaceMsg</span> msg <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DeserializeObject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>FaceMsg<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 搜索人脸</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="face"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">MatchMsg</span> <span class="token function">FaceSearch</span><span class="token punctuation">(</span><span class="token class-name">Face</span> face<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> host <span class="token operator">=</span> <span class="token string">"https://aip.baidubce.com/rest/2.0/face/v3/search?access_token="</span> <span class="token operator">+</span> token<span class="token punctuation">;</span>
            <span class="token class-name">Encoding</span> encoding <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">;</span>
            <span class="token class-name">HttpWebRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span>HttpWebRequest<span class="token punctuation">)</span>WebRequest<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span>Method <span class="token operator">=</span> <span class="token string">"post"</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span>KeepAlive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> str <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> encoding<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span>ContentLength <span class="token operator">=</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">GetRequestStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">HttpWebResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span>HttpWebResponse<span class="token punctuation">)</span>request<span class="token punctuation">.</span><span class="token function">GetResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StreamReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">GetResponseStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> result <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MatchMsg</span> msg <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DeserializeObject</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MatchMsg<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>（4）创建From<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/eedc45d77e044f8ba2f4c1ede89a42be.png"/><br/> 具体细节略过，详细代码已上传，见文章末尾链接，这里就特别注意一下VideoSourcePlayer这个控件，该控件用于动态调用摄像头获取实时图像，该控件需要单独导入这些包：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e18824f917474a4286f3e3df5dbc90ab.png"/></p>
<h3><a id="_224"></a>功能二：人脸识别</h3>
<p>人脸识别的实现思路和上述人脸注册差不多，同样是用到FaceHelper、ImagHelper、TokenHelper这三个类。</p>
<p>在人脸识别的Form设计时，注意一个点：需要启动一个子线程实时监测摄像头、轮询百度人脸搜索接口，一旦摄像头中出现已注册的人脸信息，百度接口将立即返回识别结果。</p>
<h2><a id="5_230"></a>5、补充</h2>
<p>（1）源码和发布后的可运行小程序稍后发在评论区。</p>
<p>（2）摄像头权限配置：有的用户电脑可能会无法直接调用摄像头，需要设置摄像头访问权限，去网上攻略一下怎么在win10设置摄像头访问权限。</p>
<p>（3）部署的目标电脑不是必须安装Visio Studio，只安装.Net Core环境就行：windowsdesktop-runtime-3.1.15-win-x64.exe。</p>
<p>（4）注册程序和人脸识别程序不能同时打开，因为摄像头无法同时被多个进程占用。</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>