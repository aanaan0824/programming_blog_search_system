<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-tomorrow-night" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<blockquote>
<p></p>
<div class="toc">
<h3>目录</h3>
<ul><li><a href="#_3">一、介绍</a></li><li><a href="#_9">二、下载数据</a></li><li><a href="#_13">三、获取数据</a></li><li><a href="#_26">四、分析数据</a></li><li><a href="#_39">五、移动平均预测</a></li><li><a href="#_111">六、封装函数</a></li><li><a href="#_146">最后</a></li></ul>
</div>
<p></p>
</blockquote>
<h1><a id="_3"></a>一、介绍</h1>
<p><strong>移动平均（Moving Average，MA）</strong>，⼜称移动平均线，简称均线。作为技术分析中⼀种分析时间序列的常⽤⼯具，常被应⽤于股票价格序列。移动平均可过滤⾼频噪声，反映出中⻓期低频趋势，辅助投资者做出投资判断。</p>
<p>流⾏的移动平均包括简单移动平均、加权移动平均、指数移动平均，更⾼阶的移动平均算法则有分形⾃适应移动平均、赫尔移动平均等。<br/> 而本文<strong>将使用简单移动平均预测道琼斯、纳斯达克、标准普尔指数</strong></p>
<h1><a id="_9"></a>二、下载数据</h1>
<p>下载S&amp;P、Dow、Nasdaq数据并将其保存至文件夹内，数据已经打包好了：<a href="https://download.csdn.net/download/air__Heaven/86401513">CSDN下载：琼斯、纳斯达克、标准普尔指数-数据挖掘数据集包</a><br/> 下载后的csv数据如下所示：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d93b0a473a2a48af8cde821a7f8d2dc5.png#pic_center"/></p>
<h1><a id="_13"></a>三、获取数据</h1>
<p>获取数据我们使用pandas的read_csv函数，如：<code>data = pd.read_csv('S&amp;P.csv',header=0)</code><br/> pd.read_csv函数用法：<strong>pd.read_csv(filepath_or_buffer,header,parse_dates,index_co)l</strong></p>
<table><thead><tr><th>参数名</th><th>用法</th></tr></thead><tbody><tr><td><strong>filepath_or_buffer</strong></td><td>字符串，或者任何对象的read()方法。这个字符串可以是URL，有效的URL方案包括http、ftp、s3和文件。可以直接写入"文件名.csv"</td></tr><tr><td>header</td><td>将行号用作列名，且是数据的开头</td></tr></tbody></table>
<p>获取数据之后，我们可以打印一下数据：<code>print(data）</code>，可以看到已经成功读取到csv数据：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/aaeaa76d1d2841dcbff4792c864ac342.png#pic_center"/></p>
<h1><a id="_26"></a>四、分析数据</h1>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5b652fe3d17b400084ca4c8337992ffc.png#pic_center"/></p>
<p>如上图所示，<strong>数据格式为csv，其中Date表示开盘的日期，Open表示开盘价，High表示当日最高值，Low表示当日最低值，Close表示收盘价格，Adj Close表示调整后的收盘价格，Volume表示当日成交量。我们需要预测的则是Adj Close这一列</strong>。<br/> 我们可以使用pandas读取csv文件，并打印出Adj Close这一列：</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'DOW.csv'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>applymap<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>结果如下，可以看到在道琼斯数据集中，我们需要预测的Adj Close有798行，type为object，我们要做的就是根据数据，使用移动平均算法，预测后面的指数。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/79ea9ff11ae742d485466dd0f8ddaf67.png#pic_center"/></p>
<h1><a id="_39"></a>五、移动平均预测</h1>
<p>移动平均值，就是指定时间段，<strong>对时间序列数据进行移动计算平均值</strong>。移动平均值常常用在计算股票的移动平均线、存货成本等方面。移动平均的本质是⼀种低通滤波。它的⽬的是过滤掉时间序列中的⾼频扰动，保留有⽤的低频趋势。<strong>计算公式</strong>：<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        S
       
       
        M
       
       
        
         A
        
        
         t
        
       
       
        =
       
       
        
         
          
           P
          
          
           1
          
         
         
          +
         
         
          
           P
          
          
           2
          
         
         
          +
         
         
          …
         
         
          +
         
         
          
           P
          
          
           n
          
         
        
        
         n
        
       
      
      
       S M A_{t}=\frac{P_{1}+P_{2}+\ldots+P_{n}}{n}
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">SM</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.2334em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8884em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.4101em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3173em;"><span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="minner mtight">…</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1645em;"><span class="" style="top: -2.357em; margin-left: -0.1389em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br/> 比如若依次得到测定值<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         x
        
        
         1
        
       
       
        、
       
       
        
         x
        
        
         2
        
       
       
        、
       
       
        
         x
        
        
         3
        
       
       
        、
       
       
        
         x
        
        
         4
        
       
       
        、
       
       
        
         x
        
        
         5
        
       
       
        、
       
       
        
         x
        
        
         6
        
       
       
        、
       
       
        
         x
        
        
         7
        
       
       
        .
       
       
        .
       
       
        .
       
      
      
       x_1、x_2、x_3、x_4、x_5、x_6、x_7...
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">...</span></span></span></span></span>,按顺序取一定个数所做的全部算术平均值就是移动平均值，如<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
         y
        
        
         1
        
       
       
        =
       
       
        (
       
       
        
         x
        
        
         1
        
       
       
        +
       
       
        
         x
        
        
         2
        
       
       
        +
       
       
        
         x
        
        
         3
        
       
       
        )
       
       
        /
       
       
        3
       
       
        、
       
       
        
         y
        
        
         2
        
       
       
        =
       
       
        (
       
       
        
         x
        
        
         2
        
       
       
        +
       
       
        
         x
        
        
         3
        
       
       
        +
       
       
        
         x
        
        
         4
        
       
       
        )
       
       
        /
       
       
        3....
       
      
      
       y_1=(x_1+x_2+x_3)/3、y_2=(x_2+x_3+x_4)/3....
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.7333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">/3</span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.7333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">/3....</span></span></span></span></span>，</p>
<p>而<strong>panda提供了rolling函数</strong>可以用来计算移动平均，使用简单，速度较快：<br/> <strong>DataFrame.rolling(window, min_periods=None, freq=None, center=False, win_type=None, on=None, axis=0, closed=None)</strong></p>
<table><thead><tr><th>参数</th><th>用法</th></tr></thead><tbody><tr><td><strong>window</strong></td><td>表示<strong>时间窗的大小</strong>，注意有两种形式(int or offset)。如果使用int，则数值表示计算统计量的观测值的数量即向前几个数据。如果是offset类型，表示时间窗的大小。</td></tr><tr><td>min_periods</td><td>最少需要有值的观测点的数量，对于int类型，默认与window相等。对于offset类型，默认为1。</td></tr><tr><td>freq</td><td>不用管，从0.18版本中已经被舍弃。</td></tr><tr><td>win_type</td><td>窗口类型，不用管，默认为None一般不特殊指定</td></tr><tr><td>on</td><td>对于DataFrame如果不使用index(索引)作为rolling的列，那么用on来指定使用哪列。</td></tr><tr><td>closed</td><td>定义区间的开闭，不用管，新版本中已经被舍弃</td></tr><tr><td>axis</td><td>方向(轴)，一般都是0。</td></tr><tr><td>center</td><td>是否使用window的中间值作为label，默认为false。只能在window是int时使用。</td></tr></tbody></table>
<p>那么我们使用的简单移动平均直接使用：<code>data['ma5'] = data['Adj Close'].rolling(5).mean()</code>，其表示窗口大小为5的移动平均。计算后，使用matplotlib.pyplot进行画图，横轴为时间，竖轴为预测价格，将其在pyplot 图中打印:</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax1 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> ylabel<span class="token operator">=</span><span class="token string">'Price'</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma5<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'plum'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>
<p>效果如下：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c4b20a1e983c426d95b6583fc187c1ec.png#pic_center"/><br/> 我们以同样方法画出多个均线并且和原数据real对比：</p>
<pre><code class="prism language-python">data<span class="token punctuation">[</span><span class="token string">'real'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'ma5'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'ma10'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'ma20'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'ma30'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'ma50'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'ma100'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'ma200'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'ma250'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

data<span class="token punctuation">.</span>tail<span class="token punctuation">(</span><span class="token punctuation">)</span>


fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax1 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> ylabel<span class="token operator">=</span><span class="token string">'Price'</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>real<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma5<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'plum'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma10<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'grey'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma20<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'salmon'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma30<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'goldenrod'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma50<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'hotpink'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma100<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'khaki'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma200<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'bisque'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>ma250<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'skyblue'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4e8ac501c7c7479188dd25fc783b9af2.png#pic_center"/></p>
<p>可以发现，<strong>移动平均存在一定的滞后性，移动平均以滞后性的代价换来了平滑性</strong>，滞后性说明由简单移动平均计算得到的低频趋势对近期的最新数据不够敏感。<strong>没有未来数据便是滞后的根本原因</strong>。当股价不是随着趋势的变化方向，发生突发的方向趋势，移动平均线行动往往过于迟缓，改变方向速度落后于大趋势。这是一个极大弱点<br/> 在股价原有趋势发生反转时，由于MA的追踪趋势的特性，MA的行动往往过于迟缓，掉头速度落后于大趋势。这是MA的一个极大的弱点。等MA发出反转信号时，股价调头的深度已经很大了。</p>
<p>附录DOW在不同MA值下的滑动平均值：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/070de4cec97f4da8a021c5fe75b7f4bb.png#pic_center"/><br/> Nasdaq在不同MA值下的滑动平均值：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3d1b86226f85439798fad334d2ba3ef5.png#pic_center"/><br/> S&amp;P在不同MA值下的滑动平均值：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3c69e7501246458aa3368bae675000a9.png#pic_center"/></p>
<h1><a id="_111"></a>六、封装函数</h1>
<p>我们将其进行封装如下，代码整体如下：</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> os
<span class="token keyword">def</span> <span class="token function">cal_ma</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>data<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>data<span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>applymap<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
    <span class="token comment"># print(data['Date'])</span>
    <span class="token comment"># print(data['Adj Close'])</span>

    day <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>day<span class="token punctuation">)</span>
    data<span class="token punctuation">[</span><span class="token string">'ma'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>day<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Adj Close'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>day<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>

    data<span class="token punctuation">.</span>tail<span class="token punctuation">(</span><span class="token punctuation">)</span>

    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ax1 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> ylabel<span class="token operator">=</span><span class="token string">'Price'</span><span class="token punctuation">)</span>
    data<span class="token punctuation">[</span><span class="token string">'ma'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>day<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">2.</span><span class="token punctuation">,</span> legend<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'FangSong'</span><span class="token punctuation">]</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"MA"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>day<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" about "</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">" data"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> loc<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    dataname <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入数据名："</span><span class="token punctuation">)</span>
    day <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入MA的天数："</span><span class="token punctuation">)</span>
    cal_ma<span class="token punctuation">(</span>dataname<span class="token punctuation">,</span>dataname<span class="token operator">+</span><span class="token string">'.csv'</span><span class="token punctuation">,</span> day<span class="token punctuation">)</span>
</code></pre>
<p>完整项目已经打包，免费下载：<strong><a href="https://download.csdn.net/download/air__Heaven/86402588">数据挖掘项目——移动平均预测道琼斯、纳斯达克、标准普尔指数</a></strong></p>
<h1><a id="_146"></a>最后</h1>
<p>💖 个人简介：人工智能领域研究生，目前主攻文本生成图像（text to image）方向</p>
<p>📝 关注我：<a href="https://blog.csdn.net/air__Heaven">中杯可乐多加冰</a></p>
<p>🔥 <strong>限时免费</strong>订阅：<a href="https://blog.csdn.net/air__heaven/category_11407863.html">文本生成图像T2I专栏</a></p>
<p>🎉 支持我：点赞👍+收藏⭐️+留言📝</p>
<p>如果这篇文章帮助到你很多，希望能点击下方打赏我一杯可乐！多加冰哦</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>