<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="HarmonyOS_2"></a>HarmonyOS（鸿蒙系统）物联网开发教程——环境搭建</h1>
<p></p>
<div class="toc">
<h3>目录</h3>
<ul><li><a href="#HarmonyOS_2">HarmonyOS（鸿蒙系统）物联网开发教程——环境搭建</a></li><li><ul><li><a href="#_5">前言</a></li><li><a href="#1_HarmonyOS_8">1 HarmonyOS简介</a></li><li><a href="#2__13">2 开发环境搭建</a></li><li><ul><li><a href="#21_HarmonyOS_18">2.1 简洁版环境搭建（使用已经搭建好HarmonyOS环境的镜像）</a></li><li><ul><li><a href="#211_Linux_20">2.1.1 安装虚拟机和Linux镜像</a></li></ul>
</li><li><a href="#22_UbuntuHarmonyOS_34">2.2 复杂版环境搭建（基于普通Ubuntu搭建HarmonyOS环境）</a></li><li><ul><li><a href="#221_Linux_37">2.2.1 安装虚拟机和Linux镜像</a></li><li><a href="#222_Linux_shellbash_41">2.2.2 将Linux shell设置为bash</a></li><li><a href="#223_Python_62">2.2.3 安装Python环境</a></li><li><a href="#224_SCons_89">2.2.4 安装SCons</a></li><li><a href="#225__113">2.2.5 安装编译工具</a></li></ul>
</li></ul>
</li><li><a href="#3_Windows_154">3 Windows工具安装</a></li><li><ul><li><a href="#31_Hiburn_157">3.1 Hiburn(必要)</a></li><li><a href="#32_MobaXterm_162">3.2 MobaXterm</a></li><li><a href="#33_RaiDrive_167">3.3 RaiDrive</a></li><li><a href="#34_Visual_Studio_Code_183">3.4 Visual Studio Code</a></li></ul>
</li><li><a href="#4_HarmonyOS_188">4 下载HarmonyOS源码</a></li><li><a href="#5__211">5 编译源码</a></li><li><a href="#6__225">6 烧录测试</a></li><li><ul><li><a href="#61__226">6.1 代码烧录</a></li><li><a href="#62__245">6.2 运行测试</a></li></ul>
</li><li><a href="#7_demo_248">7 更换其他demo继续测试</a></li><li><a href="#_253">结束语</a></li></ul>
</li></ul>
</div>
<p></p>
<h2><a id="_5"></a>前言</h2>
<p>华为的鸿蒙系统在2019年正式发布，2020年升级到2.0版本并且正式对所有开发者开源，那个时候我就已经简单评测过这个开源系统了，只是一直没有发布相关的博客，然后最近有粉丝私信我希望我出一下鸿蒙相关的文章，所以就有了这个系列。</p>
<h2><a id="1_HarmonyOS_8"></a>1 HarmonyOS简介</h2>
<blockquote>
<p>华为鸿蒙系统是一款全新的面向全场景的分布式操作系统，创造一个超级虚拟终端互联的世界，将人、设备、场景有机地联系在一起，将消费者在全场景生活中接触的多种实现极速发现、极速连接、硬件互助、资源共享，用合适的设备提供场景体验。</p>
</blockquote>
<p>从古到今出现过很多操作系统，其中也有很多优秀的架构，但是绝大部分都夭折了，消失在人们的视野范围。而对于鸿蒙追求的这种万物互联，我还是挺看好的，而且在华为这个大企业的全力推进下，鸿蒙目前的发展还算顺利，一旦鸿蒙站稳了脚跟，成为继IOS和安卓之后的第三个主流系统，那么鸿蒙系统的开发人员就成了香饽饽，因为目前懂鸿蒙的人很少，经验丰富的更少，第一批敢于下水的鸭子就成了最大的受益者之一。当然，如果鸿蒙系统最终夭折了，那一切都是浮云，留给我们的可能只有经验和教训了。</p>
<h2><a id="2__13"></a>2 开发环境搭建</h2>
<p>HarmonyOS的编译工具链主要以Linux系统下的开发为主，因此我们需要先搭建Linux的环境，用于程序编译。而这个编译完的固件最终需要烧录到硬件上，所以我们还需要在Windows下安装一些工具用于烧录和调试。<br/> <font color="#cc33ff">下面的 <code>2.1 (简洁版环境搭建)</code> 和 <code>2.2(复杂版环境搭建)</code> 选择其中一种方式即可，建议选择第一种。</font></p>
<p><font color="#374CFF">特别说明：我这里是基于海思Hi3861这个IC来运行和测试鸿蒙操作系统的。这里搭建的环境只是为了编译源码，最终是烧录到这个IC上面跑的。</font></p>
<h3><a id="21_HarmonyOS_18"></a>2.1 简洁版环境搭建（使用已经搭建好HarmonyOS环境的镜像）</h3>
<p><font color="#ff9966">推荐用这种方式搭建环境，比较省时省力。</font></p>
<h4><a id="211_Linux_20"></a>2.1.1 安装虚拟机和Linux镜像</h4>
<p>关于虚拟机搭建Linux环境相关的教程有很多，我这里就不详细讲解了，不懂的同学请自行查阅资料。<br/> Linux镜像要安装下面这个链接里面的，这个镜像已经把HarmonyOS需要的开发环境搭好了，下载完解压即可。<br/> 链接：<a href="https://pan.baidu.com/s/188RAGBPTMv34b6UF9nk0Hg">https://pan.baidu.com/s/188RAGBPTMv34b6UF9nk0Hg</a><br/> 提取码：tn12<br/> <img alt="在这里插入图片描述" src="image\c6eced854d6348bd8d2df5a8a2298c25.png"/><br/> VMware Workstation下载安装好了之后点击“打开虚拟机”（注意是打开不是创建），选择上面解压好的镜像文件安装即可。<br/> <img alt="在这里插入图片描述" src="image\d831990755b74c8d89270c62bab32903.png"/><br/> 选择镜像。<br/> <img alt="在这里插入图片描述" src="image\6941ce1593d24c9aafd67fe125aa8769.png"/></p>
<p><font color="#ff9966">提示：新虚拟机的存储路径建议选择剩余空间10GB以上的盘。</font><br/> 安装完直接打开虚拟机即可。默认用户和密码：<code>bearpi</code>，打开后可以自行修改。</p>
<h3><a id="22_UbuntuHarmonyOS_34"></a>2.2 复杂版环境搭建（基于普通Ubuntu搭建HarmonyOS环境）</h3>
<p>如果想自己体验一遍HarmonyOS开发环境搭建的话可以试下，不太建议使用该方法，因为没什么必要，HarmonyOS的编程开发才是重点。<br/> <font color="#ff9966">提示：如果选择了2.1的方式，那现在直接跳到第3步即可。</font></p>
<h4><a id="221_Linux_37"></a>2.2.1 安装虚拟机和Linux镜像</h4>
<p>关于虚拟机搭建Linux环境相关的教程有很多，我这里就不详细讲解了，不懂的同学请自行查阅资料。<br/> <font color="#ff9966">提示：Linux镜像要Ubuntu16.04及以上64位系统版本。</font></p>
<h4><a id="222_Linux_shellbash_41"></a>2.2.2 将Linux shell设置为bash</h4>
<p>打开Linux终端，输入如下命令查看shell是否为bash</p>
<pre><code class="prism language-c">ls <span class="token operator">-</span>l <span class="token operator">/</span>bin<span class="token operator">/</span>sh
</code></pre>
<p><font color="#ff9966">提示：如果为显示为<code>/bin/sh -&gt; bash</code>则为正常，否则请按以下方式修改。</font></p>
<p>方法一：在终端运行如下命令，然后选择 no。</p>
<pre><code class="prism language-c">sudo dpkg<span class="token operator">-</span>reconfigure dash
</code></pre>
<p>方法二：先删除sh，再创建软链接。</p>
<pre><code class="prism language-c">rm <span class="token operator">-</span>rf <span class="token operator">/</span>bin<span class="token operator">/</span>sh
sudo ln <span class="token operator">-</span>s <span class="token operator">/</span>bin<span class="token operator">/</span>bash <span class="token operator">/</span>bin<span class="token operator">/</span>sh
</code></pre>
<h4><a id="223_Python_62"></a>2.2.3 安装Python环境</h4>
<p>我们需要在Linux的环境下安装Python作为构建编译工具，一般版本新一点的Ubuntu都是自带了Pythond，如果没有则需要自己安装，安装包可以在官网下载，也可以在下面的链接下载。<br/> 提示：要保证Pythond版本在3.7以上。</p>
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get install python3<span class="token punctuation">.</span><span class="token number">8</span> 
sudo apt<span class="token operator">-</span>get install python3<span class="token operator">-</span>pip 
sudo pip3 install setuptools 
sudo pip3 install kconfiglib
</code></pre>
<p>建议安装kconfiglib 13.2.0+版本</p>
<pre><code class="prism language-c">sudo pip3 install pycryptodome 
sudo pip3 install six <span class="token operator">--</span>upgrade <span class="token operator">--</span>ignore<span class="token operator">-</span>installed six 
sudo pip3 install ecdsa 
</code></pre>
<p>如果当前系统中既存在python2又存在python3，参考以下方法将默认python修改为python3</p>
<pre><code class="prism language-c">ll `which python` 
sudo rm <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>python
sudo ln <span class="token operator">-</span>s python3<span class="token punctuation">.</span><span class="token number">8</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>python
</code></pre>
<h4><a id="224_SCons_89"></a>2.2.4 安装SCons</h4>
<p><strong>1)运行如下命令，安装SCons安装包</strong></p>
<pre><code class="prism language-c">sudo apt<span class="token operator">-</span>get install scons <span class="token operator">-</span>y
</code></pre>
<p><font color="#ff9966">提示：如果软件源中无法找到安装包，请按以下步骤处理：</font></p>
<p>a)下载源码包（下载路径：<code>“ https://scons.org/pages/download.html ”</code>，推荐SCons版本是3.0.4+）。<br/> b)解压源码包到任意目录（以scons-3.1.2为例）。<br/> c)安装源码包：进入解压目录，运行如下命令：</p>
<pre><code class="prism language-c">tar <span class="token operator">-</span>xvf scons<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.2</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
sudo python3 setup<span class="token punctuation">.</span>py install
</code></pre>
<p><strong>2)查看版本</strong></p>
<pre><code class="prism language-c">scons <span class="token operator">-</span>v
</code></pre>
<h4><a id="225__113"></a>2.2.5 安装编译工具</h4>
<p><strong>1)下载工具</strong></p>
<table><thead><tr><th align="left">开发工具</th><th align="left">用途</th><th align="left">获取途径</th></tr></thead><tbody><tr><td align="left">gn</td><td align="left">产生ninja编译脚本</td><td align="left">https://repo.huaweicloud.com/harmonyos/compiler/gn/1523/linux/gn.1523.tar</td></tr><tr><td align="left">ninja</td><td align="left">执行ninja编译脚本</td><td align="left">https://repo.huaweicloud.com/harmonyos/compiler/ninja/1.9.0/linux/ninja.1.9.0.tar</td></tr><tr><td align="left">交叉编译器gcc_riscv32</td><td align="left">交叉编译工具</td><td align="left">https://repo.huaweicloud.com/harmonyos/compiler/gcc_riscv32/7.3.0/linux/gcc_riscv32-linux-7.3.0.tar.gz</td></tr></tbody></table>
<p><strong>2)解压安装包</strong></p>
<pre><code class="prism language-c">tar <span class="token operator">-</span>xvf gn<span class="token punctuation">.</span><span class="token number">1523.</span>tar <span class="token operator">-</span>C <span class="token operator">~</span><span class="token operator">/</span>
tar <span class="token operator">-</span>xvf ninja<span class="token punctuation">.</span><span class="token number">1.9</span><span class="token number">.0</span><span class="token punctuation">.</span>tar <span class="token operator">-</span>C <span class="token operator">~</span><span class="token operator">/</span>
tar <span class="token operator">-</span>xvf gcc_riscv32<span class="token operator">-</span>linux<span class="token operator">-</span><span class="token number">7.3</span><span class="token number">.0</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span>C <span class="token operator">~</span><span class="token operator">/</span>
</code></pre>
<p><strong>3)设置环境变量</strong></p>
<pre><code class="prism language-c">vim <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>bashrc
</code></pre>
<p>将以下命令拷贝到.bashrc文件底部</p>
<pre><code class="prism language-c">export PATH<span class="token operator">=</span><span class="token operator">~</span><span class="token operator">/</span>gn<span class="token operator">:</span>$PATH
export PATH<span class="token operator">=</span><span class="token operator">~</span><span class="token operator">/</span>ninja<span class="token operator">:</span>$PATH
export PATH<span class="token operator">=</span><span class="token operator">~</span><span class="token operator">/</span>gcc_riscv32<span class="token operator">/</span>bin<span class="token operator">:</span>$PATH
</code></pre>
<p>生效环境变量</p>
<pre><code class="prism language-c">source <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>bashrc
</code></pre>
<p><strong>4)查看版本</strong></p>
<pre><code class="prism language-c">riscv32<span class="token operator">-</span>unknown<span class="token operator">-</span>elf<span class="token operator">-</span>gcc <span class="token operator">-</span>v
</code></pre>
<h2><a id="3_Windows_154"></a>3 Windows工具安装</h2>
<p>代码编译是在Linux环境执行的，但是固件烧录和调试要在Windows下操作，所以还需要安装一些工具。</p>
<h3><a id="31_Hiburn_157"></a>3.1 Hiburn(必要)</h3>
<p>Hiburn是代码烧录工具，可以在下面的链接下载。<br/> 下载链接：<a href="https://pan.baidu.com/s/188RAGBPTMv34b6UF9nk0Hg">https://pan.baidu.com/s/188RAGBPTMv34b6UF9nk0Hg</a><br/> 提取码：tn12</p>
<h3><a id="32_MobaXterm_162"></a>3.2 MobaXterm</h3>
<p>MobaXterm是一个很好用的调试工具，我们可以使用MobaXterm来远程控制虚拟机的Linux，用MobaXterm替代Linux的终端。说到这里，可能有些同学会有疑惑，为什么不直接在Linux上运行终端呢？<br/> 虽然虚拟机跟MobaXterm都是在同一个电脑上面操作，但是有些操作使用MobaXterm会比虚拟机上的操作更方便，而且MobaXterm还可以远程操作。具体看个人使用，这个不是必须要用的。<br/> MobaXterm官方下载地址：<a href="https://mobaxterm.mobatek.net">https://mobaxterm.mobatek.net</a><br/> 除了MobaXterm，其实还有其他工具也很好用，比如Xshell。这个看个人习惯吧，我这里只是推荐。</p>
<h3><a id="33_RaiDrive_167"></a>3.3 RaiDrive</h3>
<p>这是一个可以将ubuntu文件远程映射到Windows上面的一个软件，有了这个软件，我们可以用windows下的软件去查看修改ubuntu上面的文件，对于没用过Linux的新手而言，Linux的操作方式可能会很不习惯，也不方便，但是映射到windows之后操作起来就会方便很多。<br/> 下载链接：<a href="https://pan.baidu.com/s/188RAGBPTMv34b6UF9nk0Hg">https://pan.baidu.com/s/188RAGBPTMv34b6UF9nk0Hg</a><br/> 提取码：tn12</p>
<p><strong>使用方法如下：</strong><br/> <strong>1) 打开上面配置好的Linux操作系统，并且在终端输入ifconfig命令查看IP地址</strong>。<br/> <img alt="在这里插入图片描述" src="image\d23962551c13424c9c28c96b9985962d.png"/></p>
<p><strong>2) 打开RaiDrive，语言切换成中文。</strong><br/> <img alt="在这里插入图片描述" src="image\d59b08f653d34c34848dbc71c84ddbb4.png"/><br/> <strong>3) 按下图配置。</strong><br/> <font color="#ff9966">提示：ip地址以实际虚拟机运行的这个Linux操作系统实际使用的ip地址为准（也就是上面第1步查到的那个），账号密码是Linux系统的登录账号和密码，默认是<code>bearpi</code>。</font><br/> <img alt="在这里插入图片描述" src="image\7d901a1cf9e64a74879d16315912cc15.png"/><br/> 配置完成之后会自动弹出一个文件窗口，这个就是ubuntu文件的映射。在这里操作文件的话会自动同步到Linux系统。<br/> <img alt="在这里插入图片描述" src="image\7588f7985a7146889e80ab1c034d71a4.png"/></p>
<h3><a id="34_Visual_Studio_Code_183"></a>3.4 Visual Studio Code</h3>
<p>VScode是一款非常好用的代码编辑器，谁用谁知道。而且这个软件也是跨平台的，Windows、MAC和Linux都可以使用。比起Linux的vim，我觉得VScode要友好太多了。<br/> 当然，你要是不喜欢或者不习惯的话，也不一定非要用这个，这都是无所谓的。<br/> VScode官网地址：<a href="https://code.visualstudio.com">https://code.visualstudio.com</a></p>
<h2><a id="4_HarmonyOS_188"></a>4 下载HarmonyOS源码</h2>
<p><strong>方法1：在ubuntu获取源码</strong><br/> 前面我们已经通过虚拟机搭建好一个Linux系统，我们可以通过Linux的命令行来获取HarmonyOS源码。<br/> 打开终端，依次输入以下命令，然后等待下载完成即可。</p>
<pre><code class="prism language-c">cd <span class="token operator">/</span>home<span class="token operator">/</span>bearpi
mkdir project <span class="token operator">&amp;&amp;</span> cd project
hpm init <span class="token operator">-</span>t <span class="token keyword">default</span>
hpm i @bearpi<span class="token operator">/</span>bearpi_hm_nano
</code></pre>
<p><img alt="在这里插入图片描述" src="image\730d97d4377042ae93d800c891697c7b.png"/></p>
<p><img alt="在这里插入图片描述" src="image\b6e92475033545b68d0938efc4c99217.png"/></p>
<p><font color="#ff9966">提示：如果下载失败，请检查网络是否正常。然后重新执行 <code>hpm i @bearpi/bearpi_hm_nano</code> 命令即可。</font></p>
<p><strong>方法2：从镜像站获取源码</strong><br/> 镜像站点地址：<a href="https://mirrors.huaweicloud.com/harmonyos/os/">https://mirrors.huaweicloud.com/harmonyos/os/</a><br/> 打开地址，这里有多个版本的源码，我这里以1.0版本作为演示。<br/> <img alt="在这里插入图片描述" src="image\7e068ad1626542e5979761c56ea2727e.png"/></p>
<p>下载完成以后，可以直接在PC端解压查看源码，也可以先导入虚拟机的linux系统，然后在linux系统下解压查看。</p>
<h2><a id="5__211"></a>5 编译源码</h2>
<p><strong>编译流程：</strong><br/> 在Linux终端上进入源码的根目录下，运行下面这个命令行。</p>
<pre><code class="prism language-c">hpm dist
</code></pre>
<p><img alt="在这里插入图片描述" src="image\e7a8a5d78c294703bcd2fe0fefe64445.png"/><br/> 如果出现 <code>"BUILD SUCCESS"</code> 字样，说明编译成功，如果出现 <code>"ERROR"</code> ，则可以根据错误提示查找原因。<br/> 编译成功之后可以在<code>/project/out/BearPi-HM_Nano</code>目录下找到编译出来的bin文件<code>（Hi3861_wifiiot_app_allinone.bin）</code>。<br/> 用RaiDrive映射文件方式查看如下图：<br/> <img alt="在这里插入图片描述" src="image\8448b7abe1b94a5198f5c4179f975a26.png"/><br/> 在终端查看如下图：<br/> <img alt="在这里插入图片描述" src="image\c0d119e2b5d747c8a0c043caf6b202b1.png"/></p>
<h2><a id="6__225"></a>6 烧录测试</h2>
<h3><a id="61__226"></a>6.1 代码烧录</h3>
<p>我们把烧录文件从Linux系统里面复制到PC下，因为我们的烧录工具是在windows系统下运行的，开发板也需要连接到PC端（其实就是把HI3861的烧录接口通过电平转换IC连接到PC端）。<br/> <strong>烧录步骤如下：</strong><br/> <strong>1) 连接开发板到PC端</strong><br/> 因为打开了虚拟机，所以插入usb的时候需要选择接入位置，这里选择主机。<br/> <img alt="在这里插入图片描述" src="image\603074dccfcc462ca8a24478be6428a7.png"/><br/> 连接成功之后可以在设备管理器看到串行设备端口。<br/> <font color="#ff9966">提示：没有安装CH340驱动的需要先安装驱动。</font><br/> <img alt="在这里插入图片描述" src="image\2e57832acfb245199666284f6477a0cd.png"/><br/> <strong>2) 打开烧录工具HiBurn，选择开发板对应的com口，配置串口参数。</strong><br/> 串口波特率可以大一点，这样烧录速度比较快。<br/> <img alt="在这里插入图片描述" src="image\860c13135cc545cd8eb455342d5e16b2.png"/><br/> <strong>3) 加载bin文件，勾选Auto burn复选框，然后点击Connect。</strong><br/> <img alt="在这里插入图片描述" src="image\6d1f063a62e640ea827e98df6b7ab415.png"/><br/> 按下Connect后，此时Connect按钮变成Disconnect，等待下载。</p>
<p><strong>4) 按下开发板上面的复位按键，等待下载完成即可。</strong><br/> <img alt="在这里插入图片描述" src="image\cc0185dc9eaa4cf590969016b3e4ac6e.png"/><br/> <img alt="在这里插入图片描述" src="image\831c1a47f8bb4119a0e3bcc0e3f30e28.png"/></p>
<h3><a id="62__245"></a>6.2 运行测试</h3>
<p>下载完成后重新上电复位，这事代码就已经开始运行了 ，可以通过串口看到运行log，也可以通过按键F1和F2查看效果：F1按下LED灯亮，F2按下LED灯灭（这个是demo程序）。</p>
<h2><a id="7_demo_248"></a>7 更换其他demo继续测试</h2>
<p>源码中提供了很多测试demo，我们可以在<code>“\project\applications\BearPi\BearPi-HM_Nano\sample”</code>路径下找到<code>BUILD.gn</code>文件，里面默认打开的是<code>"B2_basic_button:button_example"</code>这个demo。<br/> 想要更换其他demo我们只需要把B2注释掉，然后打开其他demo，再重新编译即可。<br/> <img alt="在这里插入图片描述" src="image\d755b9df80e649c684ca12a2a143ee29.png"/></p>
<h2><a id="_253"></a>结束语</h2>
<p>好了，关于鸿蒙系统的环境搭建就介绍到这里，本人对鸿蒙系统开发了解的也不是很深入，如有错误，欢迎指正，谢谢！<br/> 如果这篇文章有帮助到你，可以给博主点个赞再走。</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>