<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p id="main-toc"><strong>目录</strong></p>
<p id="%E4%BA%8C%E3%80%81%E6%90%AD%E5%BB%BAMyBatis-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E6%90%AD%E5%BB%BAMyBatis">搭建MyBatis</a></p>
<p id="1%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">1、开发环境</a></p>
<p id="2%E3%80%81%E5%88%9B%E5%BB%BAmaven%E5%B7%A5%E7%A8%8B-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E5%88%9B%E5%BB%BAmaven%E5%B7%A5%E7%A8%8B">2、创建maven工程</a></p>
<p id="3%E3%80%81%E5%88%9B%E5%BB%BAMyBatis%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E5%88%9B%E5%BB%BAMyBatis%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">3、创建MyBatis的核心配置文件</a></p>
<p id="4%E3%80%81%E5%88%9B%E5%BB%BAmapper%E6%8E%A5%E5%8F%A3-toc" style="margin-left:40px;"><a href="#4%E3%80%81%E5%88%9B%E5%BB%BAmapper%E6%8E%A5%E5%8F%A3">4、创建mapper接口</a></p>
<p id="5%E3%80%81%E5%88%9B%E5%BB%BAMyBatis%E7%9A%84%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#5%E3%80%81%E5%88%9B%E5%BB%BAMyBatis%E7%9A%84%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6">5、创建MyBatis的映射文件</a></p>
<p id="%C2%A06%E3%80%81%E9%80%9A%E8%BF%87junit%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#%C2%A06%E3%80%81%E9%80%9A%E8%BF%87junit%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD"> 6、通过junit测试功能</a></p>
<p id="7%E3%80%81%E5%8A%A0%E5%85%A5log4j%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#7%E3%80%81%E5%8A%A0%E5%85%A5log4j%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD">7、加入log4j日志功能</a></p>
<hr id="hr-toc"/>
<p></p>
<p></p>
<blockquote>
<p>🍓个人主页：<a href="https://blog.csdn.net/Javascript_tsj?type=blog" title="个人主页">个人主页</a></p>
<p>🍒系列专栏：<a href="https://blog.csdn.net/javascript_tsj/category_11957185.html?spm=1001.2014.3001.5482" title="SSM框架">SSM框架</a></p>
<p>💬推荐一款模拟面试、刷题神器，从基础到大厂面试题👉<a href="https://www.nowcoder.com/link/pc_csdncpt_xbb_java" title="点击跳转刷题网站进行注册学习">点击跳转刷题网站进行注册学习</a></p>
</blockquote>
<p></p>
<h1 id="%E4%BA%8C%E3%80%81%E6%90%AD%E5%BB%BAMyBatis"><span style="color:#ff9900;"><strong>搭建</strong><strong>MyBatis </strong></span></h1>
<h2 id="1%E3%80%81%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span style="color:#4da8ee;"><strong>1</strong><strong>、开发环境 </strong></span></h2>
<p>IDE：idea 2019.2</p>
<p>构建工具：maven 3.5.4</p>
<p>MySQL版本：MySQL 5.7</p>
<p>MyBatis版本：MyBatis 3.5.7</p>
<blockquote>
<p>MySQL不同版本的注意事项</p>
<p>1、驱动类driver-class-name</p>
<p>MySQL 5版本使用jdbc5驱动，驱动类使用：com.mysql.jdbc.Driver</p>
<p>MySQL 8版本使用jdbc8驱动，驱动类使用：com.mysql.cj.jdbc.Driver</p>
<p>2、连接地址url</p>
<p>MySQL 5版本的url：</p>
<p>jdbc:mysql://localhost:3306/ssm</p>
<p>MySQL 8版本的url：</p>
<p>jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC</p>
<p>否则运行测试用例报告如下错误：</p>
<p>java.sql.SQLException: The server time zone value 'ÖÐ¹ú±ê×¼Ê±¼ä' is unrecognized or</p>
<p>represents more</p>
</blockquote>
<h2 id="2%E3%80%81%E5%88%9B%E5%BB%BAmaven%E5%B7%A5%E7%A8%8B"><span style="color:#4da8ee;"><strong>2</strong><strong>、创建</strong><strong>maven</strong><strong>工程 </strong></span></h2>
<p id="a%3E%E6%89%93%E5%8C%85%E6%96%B9%E5%BC%8F%EF%BC%9Ajar"><strong>a&gt;</strong><strong>打包方式：</strong><strong>jar </strong></p>
<p id="b%3E%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><strong>b&gt;</strong><strong>引入依赖</strong></p>
<pre><code>  &lt;dependencies&gt; &lt;!-- Mybatis核心 --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
      &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
      &lt;version&gt;3.5.7&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!-- junit测试 --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;4.12&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;!-- MySQL驱动 --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;mysql&lt;/groupId&gt;
      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
      &lt;version&gt;5.1.3&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
</code></pre>
<h2 id="3%E3%80%81%E5%88%9B%E5%BB%BAMyBatis%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span style="color:#4da8ee;"><strong>3</strong><strong>、创建</strong><strong>MyBatis</strong><strong>的核心配置文件 </strong></span></h2>
<blockquote>
<p>习惯上命名为mybatis-config.xml，这个文件名仅仅只是建议，并非强制要求。将来整合Spring之后，这个配置文件可以省略，所以大家操作时可以直接复制、粘贴。</p>
<p>核心配置文件主要用于配置连接数据库的环境以及MyBatis的全局配置信息</p>
<p>核心配置文件存放的位置是src/main/resources目录下</p>
</blockquote>
<p><img alt="" height="547" src="image\2146535636564387adf761933607f2d5.png" width="611"/></p>
<p></p>
<p>提示:</p>
<p><strong>下面的  username 和 password 为mysql的账号密码   根据自身实际情况进行改写  </strong></p>
<p></p>
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
&lt;configuration&gt;
    &lt;!--设置连接数据库的环境--&gt;
    &lt;environments default="development"&gt;
        &lt;environment id="development"&gt;
            &lt;transactionManager type="JDBC"/&gt;
            &lt;dataSource type="POOLED"&gt;
                &lt;property name="driver" value="com.mysql.jdbc.Driver"/&gt;
                &lt;property name="url" value="jdbc:mysql://localhost:3306/ssm? serverTimezone=UTC"/&gt;
                &lt;property name="username" value="root"/&gt;
                &lt;property name="password" value="root"/&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
    &lt;!--引入映射文件--&gt;
    &lt;mappers&gt;
        &lt;mapper resource="mappers/UserMapper.xml"/&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;</code></pre>
<h2 id="4%E3%80%81%E5%88%9B%E5%BB%BAmapper%E6%8E%A5%E5%8F%A3"><span style="color:#4da8ee;"><strong>4</strong><strong>、创建</strong><strong>mapper</strong><strong>接口 </strong></span></h2>
<p></p>
<blockquote>
<p>MyBatis中的mapper接口相当于以前的dao。但是区别在于，mapper仅仅是接口，我们不需要提供实现类。</p>
</blockquote>
<p>先创建用户类 类中属性 与 数据库中的字段对应 </p>
<p><img alt="" height="737" src="image\e06d3dd082ab466e82d46676f726d56d.png" width="1200"/></p>
<p></p>
<p> User类里面的代码:</p>
<pre><code class="language-java">public class User {
    private  Integer id;
    private  String username;
    private  String password;
    private  Integer age;
    private  String sex;
    private  String email;

    public User() {
    }

    public User(Integer id, String username, String password, Integer age, String sex, String email) {
        this.id = id;
        this.username = username;
        this.password = password;
        this.age = age;
        this.sex = sex;
        this.email = email;
    }

    public Integer getId() {
        return id;
    }

    public void setId(Integer id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public Integer getAge() {
        return age;
    }

    public void setAge(Integer age) {
        this.age = age;
    }

    public String getSex() {
        return sex;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    @Override
    public String toString() {
        return "User{" +
                "id=" + id +
                ", username='" + username + '\'' +
                ", password='" + password + '\'' +
                ", age=" + age +
                ", sex='" + sex + '\'' +
                ", email='" + email + '\'' +
                '}';
    }
}
</code></pre>
<p>创建UserMapper接口</p>
<p><img alt="" height="706" src="image\7763dae5321943e79350b27c91f7ae3d.png" width="1200"/></p>
<p></p>
<pre><code class="language-java">public interface UserMapper { 
/*** 添加用户信息 */ 
int insertUser(); }</code></pre>
<h2 id="5%E3%80%81%E5%88%9B%E5%BB%BAMyBatis%E7%9A%84%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span style="color:#4da8ee;"><strong>5</strong><strong>、创建</strong><strong>MyBatis</strong><strong>的映射文件 </strong></span></h2>
<p>相关概念：<strong>ORM</strong>（<strong>O</strong>bject <strong>R</strong>elationship <strong>M</strong>apping）对象关系映射。</p>
<p><strong>对象</strong>：Java的实体类对象</p>
<p><strong>关系</strong>：关系型数据库</p>
<p><strong>映射</strong>：二者之间的对应关系</p>
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td><strong>Java</strong><strong>概念</strong></td><td><strong>数据库概念</strong></td></tr><tr><td>类</td><td>表</td></tr><tr><td>属性</td><td>字段/列</td></tr><tr><td>对象</td><td>记录/行</td></tr></tbody></table>
<p></p>
<blockquote>
<p>1、映射文件的命名规则：</p>
<p>表所对应的实体类的类名+Mapper.xml</p>
<p>例如：表t_user，映射的实体类为User，所对应的映射文件为UserMapper.xml</p>
<p>因此一个映射文件对应一个实体类，对应一张表的操作</p>
<p>MyBatis映射文件用于编写SQL，访问以及操作表中的数据</p>
<p>MyBatis映射文件存放的位置是src/main/resources/mappers目录下</p>
<p>2、 MyBatis中可以面向接口操作数据，要保证两个一致：</p>
<p>a&gt;mapper接口的全类名和映射文件的命名空间（namespace）保持一致</p>
<p>b&gt;mapper接口中方法的方法名和映射文件中编写SQL的标签的id属性保持一致</p>
</blockquote>
<p><img alt="" height="773" src="image\8b271c089e8f424db18b608e4b399031.png" width="1200"/></p>
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.atguigu.mybatis.mapper.UserMapper"&gt;
    &lt;!--int insertUser();--&gt;
    &lt;insert id="insertUser"&gt; insert into t_user values(null,'张三','123',23,'女','11111@qq.com') &lt;/insert&gt;
&lt;/mapper&gt;</code></pre>
<h2 id="%C2%A06%E3%80%81%E9%80%9A%E8%BF%87junit%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD"><span style="color:#4da8ee;"> <strong>6</strong><strong>、通过</strong><strong>junit</strong><strong>测试功能</strong></span></h2>
<pre><code class="language-XML">import java.io.IOException;
import java.io.InputStream;

public class MybatisTest {
    @Test
    public void testInsert() throws IOException {

//读取MyBatis的核心配置文件
        InputStream is = Resources.getResourceAsStream("mybatis-config.xml");
//创建SqlSessionFactoryBuilder对象
        SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder();
//通过核心配置文件所对应的字节输入流创建工厂类SqlSessionFactory，生产SqlSession对象
        SqlSessionFactory sqlSessionFactory = sqlSessionFactoryBuilder.build(is);
//创建SqlSession对象，此时通过SqlSession对象所操作的sql都必须手动提交或回滚事务
//SqlSession sqlSession = sqlSessionFactory.openSession();
//创建SqlSession对象，此时通过SqlSession对象所操作的sql都会自动提交

        SqlSession sqlSession = sqlSessionFactory.openSession(true);
//通过代理模式创建UserMapper接口的代理实现类对象
        UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
//调用UserMapper接口中的方法，就可以根据UserMapper的全类名匹配元素文件，通过调用的方法名匹配 映射文件中的SQL标签，并执行标签中的SQL语句
        int result = userMapper.insertUser();
        System.out.println(result);
//sqlSession.commit();
    }

}
</code></pre>
<p><strong> 运行一下，控制台 输出了1  表明添加成功。</strong></p>
<p><img alt="" height="751" src="image\4d6e32f390db41dcbf108d3494e3bd57.png" width="1200"/><strong> 打开表，发现数据添加成功。</strong></p>
<p><img alt="" height="517" src="image\811e24655e7d4569a94b507f7537c06c.png" width="1200"/></p>
<p></p>
<blockquote>
<ul><li>SqlSession：代表Java程序和<strong>数据库</strong>之间的<strong>会话</strong>。（HttpSession是Java程序和浏览器之间的会话）</li><li>SqlSessionFactory：是“生产”SqlSession的“工厂”。</li><li>工厂模式：如果创建某一个对象，使用的过程基本固定，那么我们就可以把创建这个对象的相关代码封装到一个“工厂类”中，以后都使用这个工厂类来“生产”我们需要的对象。</li></ul>
</blockquote>
<h2 id="7%E3%80%81%E5%8A%A0%E5%85%A5log4j%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD"><span style="color:#4da8ee;"><strong>7</strong><strong>、加入</strong><strong>log4j</strong><strong>日志功能 </strong></span></h2>
<p id="a%3E%E5%8A%A0%E5%85%A5%E4%BE%9D%E8%B5%96"><strong>a&gt;</strong><strong>加入依赖</strong></p>
<pre><code class="language-XML">&lt;!-- log4j日志 --&gt; 
&lt;dependency&gt; 
&lt;groupId&gt;log4j&lt;/groupId&gt; 
&lt;artifactId&gt;log4j&lt;/artifactId&gt; 
&lt;version&gt;1.2.17&lt;/version&gt; 
&lt;/dependency&gt;</code></pre>
<p> <strong>b&gt;</strong><strong>加入</strong><strong>log4j</strong><strong>的配置文件</strong></p>
<blockquote>
<p>log4j的配置文件名为log4j.xml，存放的位置是src/main/resources目录下</p>
</blockquote>
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt; &lt;!DOCTYPE log4j:configuration SYSTEM "log4j.dtd"&gt;
&lt;log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/"&gt;
    &lt;appender name="STDOUT" class="org.apache.log4j.ConsoleAppender"&gt;
        &lt;param name="Encoding" value="UTF-8"/&gt;
        &lt;layout class="org.apache.log4j.PatternLayout"&gt;
            &lt;param name="ConversionPattern" value="%-5p %d{MM-dd HH:mm:ss,SSS} %m (%F:%L) \n"/&gt;
        &lt;/layout&gt;
    &lt;/appender&gt;
    &lt;logger name="java.sql"&gt;
        &lt;level value="debug"/&gt;
    &lt;/logger&gt;
    &lt;logger name="org.apache.ibatis"&gt;
        &lt;level value="info"/&gt;
    &lt;/logger&gt;
    &lt;root&gt;
        &lt;level value="debug"/&gt;
        &lt;appender-ref ref="STDOUT"/&gt;
    &lt;/root&gt;
&lt;/log4j:configuration&gt;</code></pre>
<p>效果：</p>
<p> <img alt="" height="307" src="image\ca6429b12c3c4137a458bf26ac9abfba.png" width="1200"/></p>
<p> <img alt="" height="179" src="image\f7cb0d5df8434bcd83931498b28c3c9f.png" width="837"/></p>
<p></p>
<blockquote>
<p><strong>日志的级别 </strong></p>
<p>FATAL(致命)&gt;ERROR(错误)&gt;WARN(警告)&gt;INFO(信息)&gt;DEBUG(调试)</p>
<p>从左到右打印的内容越来越详细</p>
</blockquote>
</div>
</div>