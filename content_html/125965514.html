<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p><a class="link-info" href="https://github.com/focus-creative-games/hybridclr" title="HybridCLR">HybridCLR</a>çš„æ¨å¹¿å·²ç»åšå¾—ç›¸å½“å¥½äº†ï¼Œè€Œä¸”çƒ­æ›´é¢†åŸŸçªç„¶æ€å‡ºä¸€åŒ¹é»‘é©¬ï¼Œçƒ­åº¦å¾ˆé«˜ï¼Œä¸å†å¤šåšä»‹ç»ï¼Œå¯ä»¥ç‚¹å‡»è¿›å…¥HybridCLRå¼€æºåœ°å€äº†è§£è¯¦æƒ…ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ç”¨è¿‡toluaå’Œxluaçƒ­æ›´æ¡†æ¶, å› ä¸ºC#å¼€å‘æ–¹å¼å®åœ¨å¤ªçˆ½ï¼Œæƒ³æ”¯æŒçƒ­æ›´åˆä¸æƒ³ä½¿ç”¨å¼±ç±»å‹è¯­è¨€ï¼Œäºæ˜¯å¯¹ILRuntimeå’ŒHybridCLRè¿›è¡Œäº†è¯„ä¼°ï¼Œäº†è§£åæ¯«ä¸çŠ¹è±«é€‰æ‹©äº†HybridCLRæ–¹æ¡ˆï¼Œå°½ç®¡å®ƒè¿˜æ¯”è¾ƒæ–°ã€‚é€‰å®ƒçš„åŸå› å¾ˆç®€å•ï¼Œå®ƒæœ€æ¥è¿‘äºåŸç”ŸC#å¼€å‘æ–¹å¼ï¼Œè™½ç„¶æ€§èƒ½ç›¸æ¯”åŸç”ŸAOTè¿˜æœ‰ä¸€å®šå·®è·ï¼Œä½†æ˜¯ä¸å…¶å®ƒçƒ­æ›´æ–¹æ¡ˆç›¸æ¯”ï¼Œç»å¯¹æ˜¯çƒ­æ›´é¢†åŸŸé¢ è¦†æ€§çš„å­˜åœ¨ï¼Œå°¤å…¶æ˜¯è¿‘æœŸè§£å†³äº†æ³›å‹å…ƒæ•°æ®è¡¥å……ã€æ¡¥æ¥å‡½æ•°ç”Ÿæˆçš„ç—›ç‚¹ï¼Œéå¸¸çš„å¥½ç”¨ï¼</p>
<p>æ„Ÿè°¢HybridCLRä½œè€…è®©æˆ‘èµ¶ä¸Šäº†ä¸€ä¸ªå¥½æ—¶ä»£ï¼Œè¿œç¦»luaå±å±±ğŸ˜‚</p>
<p>ä¸‹é¢è®°å½•ä¸€ä¸‹Windows Unity2021.3.7f1ç¯å¢ƒä¸‹UGF + HybridCLRçƒ­æ›´æ¥å…¥è¿‡ç¨‹ã€‚</p>
<h3>0. ç¯å¢ƒå‡†å¤‡</h3>
<p>â‘  gitç¯å¢ƒï¼Œç”¨äºä¸‹è½½æ›´æ–°hybridclr</p>
<p>â‘¡ C++ç¼–è¯‘åº“ï¼Œåœ¨VisualStudio Installé¢æ¿å‹¾é€‰C++å¼€å‘</p>
<h3>1. ä¸‹è½½<a class="link-info" href="https://github.com/focus-creative-games/hybridclr_trial" title="hybridclr_trial">hybridclr_trial</a>ç¤ºä¾‹å·¥ç¨‹å¹¶å¯¼å…¥UGFæ¡†æ¶</h3>
<p>HybridCLRç›®å‰è¿˜ä¸æ˜¯ä»¥Unityæ’ä»¶çš„å½¢å¼æä¾›ï¼Œéœ€è¦ä¸‹è½½hybridclr_trialç¤ºä¾‹å·¥ç¨‹æå–æä¾›çš„Dllç”Ÿæˆå·¥å…·å’Œæ¡¥æ¥å‡½æ•°ç”Ÿæˆå·¥å…·, ä»¥åŠHybridCLR Runtimeæ¥å£ã€‚</p>
<h3>2. å®‰è£…é…ç½®HybridCLRç¯å¢ƒ</h3>
<p>é¦–å…ˆæ‰¾åˆ°hybridclr_trial\HybridCLRData\init_local_il2cpp_data.bat, ä»¥æ–‡æœ¬æ–¹å¼æ‰“å¼€,å¹¶åšå¦‚ä¸‹é…ç½®ã€‚</p>
<pre><code>@echo off

set IL2CPP_BRANCH=2021.3.1    //è¿™é‡ŒUnity2020.3.xå¡«2020.3.33; Unity2021.3.xå¡«2021.3.1
...
...
set IL2CPP_PATH=C:\Program Files\Unity\Hub\Editor\2021.3.1f1\Editor\Data\il2cpp  //å¡«è‡ªå·±Unityå®‰è£…ç›®å½•ä¸‹çš„il2cppæ–‡ä»¶å¤¹æ‰€åœ¨è·¯å¾„

......</code></pre>
<p>ç›®å‰HybridCLRæ”¯æŒçš„Unityç‰ˆæœ¬ä¸ºUnity2020.3ç³»åˆ—å’Œ2021.3ç³»åˆ—ï¼Œå³Unity2020.3.xä½¿ç”¨il2cpp 2020.3.33åˆ†æ”¯ï¼ŒUnity2021.3.xä½¿ç”¨il2cpp 2021.3.1åˆ†æ”¯ã€‚ç„¶åæŠŠIL2CPP_PATHé…ç½®ä¸ºè‡ªå·±Unityå®‰è£…ç›®å½•ä¸‹il2cppæ‰€åœ¨è·¯å¾„ã€‚</p>
<p>å¯¹åº”å…³ç³»ï¼š</p>
<p>Unity 2020.x =&gt; ä½¿ç”¨HybridCLR il2cpp 2020.3.33åˆ†æ”¯ï¼›IL2CPP_PATHé…ç½®ä¸ºUnity2020.3.33å®‰è£…ç›®å½•ä¸‹çš„il2cpp</p>
<p>Unity 2021.x =&gt; ä½¿ç”¨HybridCLR il2cpp 2021.3.1åˆ†æ”¯ï¼›L2CPP_PATHé…ç½®ä¸ºUnity2021.3.1å®‰è£…ç›®å½•ä¸‹çš„il2cpp</p>
<p><strong><span style="color:#fe2c24;">å¼ºçƒˆå»ºè®®ï¼š</span></strong></p>
<p><strong><span style="color:#fe2c24;">HybridCLRé­”æ”¹äº†Unity 2020.3.33å’ŒUnity 2021.3.1ä¸¤ä¸ªç‰ˆæœ¬çš„il2cppï¼Œåˆ†åˆ«å…¼å®¹Unity 2020.xå’ŒUnity 2021.x.  </span></strong></p>
<p><strong><span style="color:#fe2c24;">å¼ºçƒˆå»ºè®®il2cppå’ŒHybridCLRé­”æ”¹ç‰ˆil2cppçš„Unityç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œå³å¦‚æœä½ æ˜¯ç”¨Unity2020.xå¼€å‘ï¼Œå°±æŠŠIL2CPP_PATHè®¾ç½®ä¸ºUnity2020.3.33å®‰è£…ç›®å½•ä¸‹çš„il2cppï¼Œä½¿ç”¨Unity2021.xå¼€å‘å°±æŠŠ</span></strong><strong><span style="color:#fe2c24;">IL2CPP_PATHè®¾ç½®ä¸ºUnity2021.3.1å®‰è£…ç›®å½•ä¸‹çš„il2cpp. il2cppç‰ˆæœ¬ä¸ä¸€è‡´å¦åˆ™å¾ˆæœ‰å¯èƒ½é‡åˆ°å¥‡æ€ªçš„bug.</span></strong></p>
<p><span style="color:#fe2c24;"><strong>ä¸ºäº†æ–¹ä¾¿å¯ä»¥æŠŠUnity2020.3.33å’ŒUnity2021.3.1çš„il2cppæ–‡ä»¶å¤¹æå–å‡ºæ¥æ”¾åˆ°é¡¹ç›®é‡Œã€‚</strong></span></p>
<p><strong>ä¿®æ”¹å®Œæˆåå³é”®ä»¥ç®¡ç†å‘˜æ–¹å¼è¿è¡Œinit_local_il2cpp_data.bat</strong>ï¼Œwin11ä¸‹å…ˆå³é”®æ‰“å¼€Windows PowerShellç»ˆç«¯ï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­è¿è¡Œã€‚.batä¼šè‡ªåŠ¨ä»gitä¸‹è½½hybridclrå’Œé­”æ”¹åæ”¯æŒdllåŠ¨æ€åŠ è½½çš„il2cppåº“ï¼Œå¹¶å°†IL2CPP_PATHé…ç½®çš„UnityåŸç”Ÿil2cppåº“ä¸é­”æ”¹åçš„il2cppæ–‡ä»¶åˆå¹¶ã€‚Unityä½¿ç”¨é­”æ”¹è¿‡çš„il2cppç¼–è¯‘ä¹Ÿå°±ä»åº•å±‚æ”¯æŒäº†C#çƒ­æ›´æ–°ã€‚</p>
<p class="img-center"><img alt="" height="545" src="image\fca237124406475f9632d91f051cfc1a.png" width="500"/></p>
<h3> 3. ç¨‹åºé›†åˆ†ç¦»ï¼Œåˆ’åˆ†ä¸ºBuiltin.Runtime(å†…ç½®)ç¨‹åºé›†å’ŒHotfix(çƒ­æ›´)ç¨‹åºé›†ã€‚</h3>
<p>ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ç¨‹åºé›†ï¼Ÿ</p>
<p>æ­£å¦‚ä½ ä¸èƒ½è‡ªå·±æŠŠè‡ªå·±ä¸¾èµ·æ¥ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªèµ·åˆ°æ¡¥æ¢ä½œç”¨çš„å†…ç½®ç¨‹åºè´Ÿè´£åˆå§‹åŒ–ä¸€äº›æ¯”è¾ƒé å‰çš„é€»è¾‘ï¼Œæ¯”å¦‚å¯åŠ¨æ¸¸æˆåéœ€è¦å…ˆæŠŠçƒ­æ›´æ–°é€»è¾‘Hotfix.dllä»èµ„æºæœåŠ¡å™¨ä¸‹è½½ä¸‹æ¥ï¼Œå¹¶åŠ è½½ç¨‹åºé›†ã€‚åŠ è½½å®Œæˆåé€šè¿‡åå°„è°ƒç”¨Hotfix.dllä¸­çš„å…¥å£å‡½æ•°åˆ‡æ¢åˆ°çƒ­æ›´æ–°é€»è¾‘ã€‚</p>
<p>ç¨‹åºé›†æ‹†åˆ†ä¸ºBuiltin.Runtimeå’ŒHitfixï¼Œå³å†…ç½®ç¨‹åºé›†å’Œçƒ­æ›´æ–°ç¨‹åºé›†ä¸¤ä¸ªå³å¯ï¼ŒæŠŠå†…ç½®ç¨‹åºå’Œçƒ­æ›´æ–°ç¨‹åºåˆ†ç¦»åˆ°ä¸åŒçš„æ–‡ä»¶å¤¹ï¼Œåœ¨ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºåˆ†åˆ«åˆ›å»ºAssembly Definition. ç„¶åå°†çƒ­æ›´æ–°ç¨‹åºé›†å¼•ç”¨å†…ç½®ç¨‹åºé›†ã€‚</p>
<p class="img-center"><img alt="" height="286" src="image\86526b2818a04d5686910ac3e58cb105.png" width="480"/></p>
<h3> 4. çƒ­æ›´é€»è¾‘å…¥å£HotfixEntry</h3>
<p>ç”±äºHotfixç¨‹åºé›†æ˜¯ä»¥çƒ­æ›´èµ„æºçš„å½¢å¼å­˜åœ¨ï¼Œä¸ä¼šè¢«ç¼–è¯‘æˆ.soè¿›å…¥å®‰è£…åŒ…ï¼Œæ‰€ä»¥Builtinç¨‹åºé›†ä¸èƒ½ç›´æ¥è°ƒç”¨Hotfixç¨‹åºé›†ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¼šæŠ¥é”™ã€‚è¿™å°±éœ€è¦ä¸€ä¸ªHotfixEntryä½œä¸ºè¿›å…¥çƒ­æ›´é€»è¾‘çš„å…¥å£ï¼Œä½¿ç”¨åå°„çš„æ–¹å¼è¿›å…¥Hotfixç¨‹åºé›†ã€‚</p>
<p>ä¸ºäº†å°½å¯èƒ½æŠŠé€»è¾‘æ”¾åˆ°çƒ­æ›´æ–°ä»¥è¾¾åˆ°æ›´å¤§å¯æ§æ€§ï¼ŒBuiltinç¨‹åºé›†åªå¤„ç†æ¯”è¾ƒé å‰çš„é€»è¾‘ï¼Œæ¯”å¦‚æ›´æ–°èµ„æºå’Œçƒ­æ›´dllï¼Œåˆå§‹åŒ–çƒ­æ›´dll. çƒ­æ›´dllåˆå§‹åŒ–å®Œæˆåå°±è¿›å…¥çƒ­æ›´ç¨‹åºé›†æŠŠæ‰€æœ‰é€»è¾‘äº¤ç”±çƒ­æ›´æ–°ç¨‹åºé›†å®Œæˆã€‚ç”±äºGFä¸æ”¯æŒåŠ¨æ€è¿½åŠ Procedureï¼Œæ‰€ä»¥è¿›å…¥çƒ­æ›´ç¨‹åºé›†æµç¨‹æ—¶éœ€è¦é‡æ–°ä¸ºçƒ­æ›´æ–°Procedureåˆ›å»ºæœ‰é™çŠ¶æ€æœºï¼Œå¹¶åˆ‡æ¢åˆ°çƒ­æ›´æ–°æµç¨‹ã€‚åœ¨Builtinç¨‹åºé›†åˆå§‹åŒ–å®Œçƒ­æ›´dllåé€šè¿‡åå°„è°ƒç”¨HotfixEntry.StartHotfixLogic()è¿›å…¥çƒ­æ›´æ–°é€»è¾‘ã€‚</p>
<pre><code class="language-cs">        //åŠ è½½çƒ­æ›´æ–°Dllå®Œæˆ,è¿›å…¥çƒ­æ›´é€»è¾‘
        if (loadedProgress &gt;= totalProgress)
        {
            Log.Info("çƒ­æ›´dllåŠ è½½å®Œæˆ, å¼€å§‹è¿›å…¥HotfixEntry");
            loadedProgress = -1;
#if !DISABLE_HYBRIDCLR
            var hotfixDll = GFBuiltin.Hotfix.GetHotfixClass("HotfixEntry");
            if (hotfixDll == null)
            {
                Log.Error("è·å–çƒ­æ›´å…¥å£ç±»HotfixEntryå¤±è´¥!");
                return;
            }
            hotfixDll.GetMethod("StartHotfixLogic").Invoke(null, new object[] { true });
#else
            HotfixEntry.StartHotfixLogic(false);
#endif</code></pre>
<pre><code class="language-cs">using GameFramework;
using GameFramework.Fsm;
using GameFramework.Procedure;
using UnityGameFramework.Runtime;
/// &lt;summary&gt;
/// çƒ­æ›´é€»è¾‘å…¥å£
/// &lt;/summary&gt;
public class HotfixEntry
{
    public static void StartHotfixLogic(bool enableHotfix)
    {
        Log.Info("Hotfix Enable:{0}", enableHotfix);
        GFBuiltin.Fsm.DestroyFsm&lt;IProcedureManager&gt;();
        var fsmManager = GameFrameworkEntry.GetModule&lt;IFsmManager&gt;();
        var procManager = GameFrameworkEntry.GetModule&lt;IProcedureManager&gt;();
        //æ‰‹åŠ¨æŠŠçƒ­æ›´æ–°ç¨‹åºé›†çš„æµç¨‹æ·»åŠ è¿›æ¥
        ProcedureBase[] procedures = new ProcedureBase[]
        {
            new PreloadProcedure(),
            new ChangeSceneProcedure(),
            new MenuProcedure(),
            new GameProcedure(),
            new GameOverProcedure()
        };
        procManager.Initialize(fsmManager, procedures);
        procManager.StartProcedure&lt;PreloadProcedure&gt;();//é»˜è®¤å¯åŠ¨çƒ­æ›´æ–°ç¨‹åºé›†çš„é¢„åŠ è½½æµç¨‹
    }
}
</code></pre>
<h3>5. æ‰“åŒ…æµç¨‹åŠæ³¨æ„äº‹é¡¹</h3>
<p>0.é€šè¿‡HybridCLRå†…ç½®å·¥å…·ç”Ÿæˆæ¡¥æ¥å‡½æ•°(MethodBridge)ã€ç”Ÿæˆdll(CompileDll)ï¼š</p>
<p><img alt="" height="198" src="image\38edf72c57bb435b817961204b12735f.png" width="344"/></p>
<p></p>
<p>1. HybridCLRå¿…é¡»è¦å…ˆBuildå·¥ç¨‹ï¼Œç›®çš„æ˜¯Buildæ—¶ç”Ÿæˆä»£ç è£å‰ªåçš„dllä»¥ä¾›HybridCLRè¿›è¡ŒAOTå…ƒæ•°æ®è¡¥å……ã€‚</p>
<p>ç”±äºil2cppç¼–è¯‘åæ³›å‹å‡½æ•°çš„åŸå§‹å‡½æ•°ä½“å…ƒæ•°æ®ä¼šä¸¢å¤±ï¼Œæ— æ³•åˆ›å»ºå‡ºAOTæ³›å‹å‡½æ•°çš„å®ä¾‹å°±ä¼šå¯¼è‡´æŠ¥é”™ã€‚AOTæœ‰æ³›å‹å…±äº«æœºåˆ¶ï¼Œåˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å†…ç½®ç¨‹åºé›†ä¸­å®ä¾‹åŒ–çš„ç±»ä¸­æ·»åŠ æ³›å‹å‡½æ•°çš„è°ƒç”¨ï¼Œè¯¥æ³›å‹å‡½æ•°çš„å…ƒæ•°æ®å°±ä¼šå»ºç«‹å¹¶å…±äº«ã€‚</p>
<p><s>HybridCLRå·²ç»é»˜è®¤åœ¨RefTypes.csä¸­è¡¥å……äº†å¸¸ç”¨çš„æ³›å‹å…ƒæ•°æ®ï¼š</s></p>
<p>ï¼ˆæœ€æ–°ç‰ˆHybridCLRåšäº†ä¼˜åŒ–ï¼Œå·²ç»æ²¡äº†ï¼‰</p>
<p class="img-center"><img alt="" height="736" src="image\0c2fe7a8cb684eeca8b3db8da76b1f5d.png" width="480"/></p>
<p><s> æ³›å‹å‡½æ•°åœ¨å¼€å‘ä¸­ä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œè‡ªå·±å†™çš„æ³›å‹å€¼ç±»å‹å‡½æ•°å¿…é¡»æå‰æ³¨å†Œåˆ°AOTä»¥æ³›å‹å…±äº«, å¦‚ä¸‹ç¤ºä¾‹ï¼Œåªéœ€åœ¨ä¼šå®ä¾‹åŒ–çš„ç±»ä¸­æ·»åŠ è¿™äº›æ³›å‹å‡½æ•°è°ƒç”¨ï¼ŒRefBuiltinAOT()å’ŒRefLitJson()æ— éœ€æœ‰ä»»ä½•åœ°æ–¹è°ƒç”¨ã€‚æ³›å‹å…ƒæ•°æ®é—®é¢˜ä¹Ÿæ˜¯ç›®å‰HybridCLRæœ€å¤§çš„ç—›ç‚¹ï¼ŒHybridCLRå®˜æ–¹RoadMapä¸ä¹…åå°±ä¼šå‡ºä¸€ä¸ªè‡ªåŠ¨æ‰«ææ·»åŠ æ³›å‹å‡½æ•°çš„å·¥å…·ä»¥è§£å†³è¿™ä¸€ç—›ç‚¹ã€‚</s>ï¼ˆå®˜æ–¹å·²ç»è§£å†³äº†è¿™ä¸ªç—›ç‚¹)</p>
<p>HybridCLRè¿˜æ”¯æŒé€šè¿‡dllè‡ªåŠ¨è¡¥å……å…ƒæ•°æ®, ä¾‹å¦‚, æˆ‘é¡¹ç›®é‡Œå†…ç½®äº†LitJsonæ’ä»¶ï¼Œå¯ä»¥é€šè¿‡HybridCLR.RuntimeApi.LoadMetadataForAOTAssembly() ä»LitJson.dllè‡ªåŠ¨è¡¥å……AOTå…ƒæ•°æ®</p>
<pre><code class="language-cs">#region æå‰æŠŠçƒ­æ›´æ–°ä½¿ç”¨åˆ°çš„å€¼ç±»å‹æ³›å‹æ³¨å†Œåˆ°AOT,å¦åˆ™æŠ¥é”™
    /// &lt;summary&gt;
    /// æ³¨å†Œå…ƒæ•°æ®åˆ°AOT
    /// &lt;/summary&gt;
    void RefBuiltinAOT()
    {
        var param = RefParams.Acquire();
        param.GetValue&lt;bool&gt;(default, default);
        param.GetValue&lt;int&gt;(default, default);
        param.GetValue&lt;float&gt;(default, default);
        param.GetValue&lt;double&gt;(default, default);
        param.GetValue&lt;Vector2&gt;(default, default);
        param.GetValue&lt;Vector3&gt;(default, default);
        param.GetValue&lt;Vector4&gt;(default, default);
        param.GetValue&lt;Vector2Int&gt;(default, default);
        param.GetValue&lt;Vector3Int&gt;(default, default);
        param.GetValue&lt;Quaternion&gt;(default, default);
        param.GetValue&lt;Rect&gt;(default, default);
        param.GetValue&lt;Bounds&gt;(default, default);
        param.GetValue&lt;Color&gt;(default, default);
        param.GetValue&lt;Color32&gt;(default, default);


        param.TryGetValue&lt;bool&gt;(default, out bool _);
        param.TryGetValue&lt;int&gt;(default, out int _);
        param.TryGetValue&lt;float&gt;(default, out float _);
        param.TryGetValue&lt;double&gt;(default, out double _);
        param.TryGetValue&lt;Vector2&gt;(default, out Vector2 _);
        param.TryGetValue&lt;Vector3&gt;(default, out Vector3 _);
        param.TryGetValue&lt;Vector4&gt;(default, out Vector4 _);
        param.TryGetValue&lt;Vector2Int&gt;(default, out Vector2Int _);
        param.TryGetValue&lt;Vector3Int&gt;(default, out Vector3Int _);
        param.TryGetValue&lt;Quaternion&gt;(default, out Quaternion _);
        param.TryGetValue&lt;Rect&gt;(default, out Rect _);
        param.TryGetValue&lt;Bounds&gt;(default, out Bounds _);
        param.TryGetValue&lt;Color&gt;(default, out Color _);
        param.TryGetValue&lt;Color32&gt;(default, out Color32 _);
    }
    void RefLitJson()
    {
        LitJson.JsonMapper.RegisterExporter&lt;Vector2&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Vector3&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Vector2Int&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Vector3Int&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Vector4&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Quaternion&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Color&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Color32&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Bounds&gt;(default);
        LitJson.JsonMapper.RegisterExporter&lt;Rect&gt;(default);
    }
    #endregion</code></pre>
<p>2. æ¡¥æ¥å‡½æ•°ä¸¢å¤±</p>
<p>å¦‚æœè¿è¡Œæ—¶é‡åˆ°æŠ¥é”™ExecutionEngineException: GetManaged2NativeMethodPointer not support. signature:xxx(ç­¾å)ï¼Œéœ€è¦æŠŠæ‰‹åŠ¨è¡¥å……åˆ°HybridCLR\Editor\HybridCLR\Generators\GeneratorConfig.csä¸­ï¼Œè¿™ä¹Ÿæ˜¯HybridCLRæœ€å¤§çš„ç—›ç‚¹ä¹‹ä¸€ï¼Œå¥½åœ¨å®˜æ–¹åˆšåˆšå®Œå–„äº†æ¡¥æ¥å‡½æ•°çš„é—®é¢˜ï¼Œåç»­è¿˜ä¼šå®Œå–„æ¡¥æ¥å‡½æ•°ç”Ÿæˆå·¥å…·ä»¥å½»åº•æ¶ˆé™¤æ­¤é—®é¢˜ã€‚</p>
<pre><code class="language-cs">/// &lt;summary&gt;
        /// å¦‚æœæç¤ºç¼ºå¤±æ¡¥æ¥å‡½æ•°ï¼Œå°†æç¤ºç¼ºå¤±çš„ç­¾ååŠ å…¥åˆ°ä¸‹åˆ—åˆ—è¡¨æ˜¯ç®€å•çš„åšæ³•ã€‚
        /// è¿™é‡Œæ·»åŠ 64ä½Appç¼ºå¤±çš„æ¡¥æ¥å‡½æ•°ç­¾å
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static List&lt;string&gt; PrepareCustomMethodSignatures64()
        {
            return new List&lt;string&gt;
            {
                "vi8i8",
                "i4i8i8i4i4i8i8",
                "i8i8S12",
                "S12i8S12",
                "S12i8S12S12",
                "i16i8i16i16",
            };
        }

        /// &lt;summary&gt;
        /// å¦‚æœæç¤ºç¼ºå¤±æ¡¥æ¥å‡½æ•°ï¼Œå°†æç¤ºç¼ºå¤±çš„ç­¾ååŠ å…¥åˆ°ä¸‹åˆ—åˆ—è¡¨æ˜¯ç®€å•çš„åšæ³•ã€‚
        /// è¿™é‡Œæ·»åŠ 32ä½Appç¼ºå¤±çš„æ¡¥æ¥å‡½æ•°ç­¾å
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static List&lt;string&gt; PrepareCustomMethodSignatures32()
        {
            return new List&lt;string&gt;
            {
                "vi4i4",
                "S12i4S12S12",
            };
        }</code></pre>
<p>3. æŠŠBuildåç”Ÿæˆçš„Strip(è£å‰ª)è¿‡çš„dllæ‰“åŒ…æˆAssetBundle</p>
<p>BuildåHybridCLRä¼šå°†Stripåçš„dllå¤åˆ¶åˆ°é¡¹ç›®æ ¹ç›®å½•çš„HybridCLRData\AssembliesPostIl2CppStripä¸‹ã€‚</p>
<p>å¯ä»¥å†™ä¸ªå·¥å…·ç›‘å¬Buildè¿›ç¨‹ï¼ŒBuildå®Œæˆåè‡ªåŠ¨æŠŠStripåçš„dllå¤åˆ¶åˆ°AssetsæŒ‡å®šç›®å½•ï¼Œå¹¶ä¿®æ”¹ä¸ºUnityæ”¯æŒçš„èµ„æºæ‰©å±•åä»¥ä¾›æ‰“åŒ…ABï¼š</p>
<pre><code class="language-cs">#if UNITY_EDITOR
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEditor;
using UnityEditor.Build;
using UnityEditor.Build.Reporting;
using HybridCLR;
using System.IO;
using GameFramework;

public class BuildAppListener : IPostprocessBuildWithReport, IPreprocessBuildWithReport, IPostBuildPlayerScriptDLLs
{
    public int callbackOrder =&gt; 100;

    public void OnPostBuildPlayerScriptDLLs(BuildReport report)
    {
        //Debug.LogFormat("OnPostBuildPlayerScriptDLLs:{0}", report.name);

    }

    public void OnPostprocessBuild(BuildReport report)
    {
        Debug.Log("OnPostprocessBuild:");
        BuildTarget target = report.summary.platform;
        //CompileDllHelper.CompileDll(target);
        var hotfixDllDir = UtilityExt.Path.GetCombinePath(Application.dataPath, ConstBuiltin.HOT_FIX_DLL_DIR);
        try
        {
            if (!Directory.Exists(hotfixDllDir))
            {
                Directory.CreateDirectory(hotfixDllDir);
            }
            else
            {
                var dllFils = Directory.GetFiles(hotfixDllDir);
                for (int i = dllFils.Length - 1; i &gt;= 0; i--)
                {
                    File.Delete(dllFils[i]);
                }
            }
            CopyHotfixDllTo(target, hotfixDllDir);
        }
        catch (System.Exception e)
        {
            Debug.LogErrorFormat("ç”Ÿæˆçƒ­æ›´æ–°dllæ–‡ä»¶å¤±è´¥:{0}", e.Message);
            throw;
        }

    }

    public void OnPreprocessBuild(BuildReport report)
    {

        Debug.Log("OnPreprocessBuild:");
    }
    public static void CopyHotfixDllTo(BuildTarget target, string desDir, bool copyAotMeta = true)
    {
        string hotfixDllSrcDir = BuildConfig.GetHotFixDllsOutputDirByTarget(target);
        foreach (var dll in BuildConfig.AllHotUpdateDllNames)
        {
            string dllPath = UtilityExt.Path.GetCombinePath(hotfixDllSrcDir, dll);
            if (File.Exists(dllPath))
            {
                string dllBytesPath = UtilityExt.Path.GetCombinePath(desDir, Utility.Text.Format("{0}.bytes", dll));
                File.Copy(dllPath, dllBytesPath, true);
            }
        }
        if (copyAotMeta)
        {
            string aotDllDir = BuildConfig.GetAssembliesPostIl2CppStripDir(target);
            foreach (var dll in BuildConfig.AOTMetaDlls)
            {
                string dllPath = UtilityExt.Path.GetCombinePath(aotDllDir, dll);
                if (!File.Exists(dllPath))
                {
                    Debug.LogError($"abä¸­æ·»åŠ AOTè¡¥å……å…ƒæ•°æ®dll:{dllPath} æ—¶å‘ç”Ÿé”™è¯¯,æ–‡ä»¶ä¸å­˜åœ¨ã€‚è£å‰ªåçš„AOT dllåœ¨BuildPlayeræ—¶æ‰èƒ½ç”Ÿæˆï¼Œå› æ­¤éœ€è¦ä½ å…ˆæ„å»ºä¸€æ¬¡æ¸¸æˆAppåå†æ‰“åŒ…ã€‚");
                    continue;
                }
                string dllBytesPath = UtilityExt.Path.GetCombinePath(desDir, Utility.Text.Format("{0}.bytes", dll));
                File.Copy(dllPath, dllBytesPath, true);
            }
        }
        AssetDatabase.Refresh();
    }
}
#endif</code></pre>
<p>3. æŠŠçƒ­æ›´dllæ·»åŠ åˆ°GFçš„ABæ‰“åŒ…å·¥å…·å¹¶æ‰“åŒ…AB</p>
<p>4. Buildé¡¹ç›®å¹¶æµ‹è¯•ã€‚</p>
<p></p>
<h3><a class="link-info" href="https://github.com/sunsvip/GF_HybridCLR" title="GF_HybridCLR">GF_HybridCLR</a></h3>
<p><a href="https://github.com/sunsvip/GF_HybridCLR" title="https://github.com/sunsvip/GF_HybridCLR">https://github.com/sunsvip/GF_HybridCLR</a></p>
<p>GF_HybridCLRæ˜¯å·²ç»é›†æˆå¥½çš„GameFramework + HybridCLRå¼€å‘æ¡†æ¶ï¼Œæœ‰ç€ä¸€æ•´å¥—å®Œå–„çš„å·¥ä½œæµã€‚åŒ…å«å¯¹GameFrameworkçš„æ‰©å±•ï¼Œæ•°æ®è¡¨ç”Ÿæˆå·¥å…·ã€ä»£ç ç”Ÿæˆå·¥å…·ã€çƒ­æ›´æ–°å·¥ä½œæµï¼ŒAssetBundleåŠ å¯†è§£å¯†ã€‚å¹¶ä¸”é’ˆå¯¹HybridCLRå¢åŠ äº†å‚»ç“œå¼çš„å®‰è£…ã€æ›´æ–°å·¥å…·ï¼Œæ”¯æŒä¸€é”®å¼€å…³HybridCLRçƒ­æ›´æ–°ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<p>1. é¦–å…ˆè¦ç¡®ä¿å®‰è£…äº†gitç¯å¢ƒ: <a class="link-info" href="https://git-scm.com/download/win" title="Gitä¸‹è½½">Gitä¸‹è½½</a></p>
<p><s>2. ä¸‹è½½GF_HybridCLRå·¥ç¨‹ï¼Œç‚¹å‡»Unityèœå•æ HybridCLR-&gt;Setup è‡ªåŠ¨é…ç½®HybridCLRç¯å¢ƒï¼›</s></p>
<p><s>3. ç‚¹å‡»HybridCLR-&gt;Updateä¸€é”®æ›´æ–°HybridCLRåˆ°æœ€æ–°ç‰ˆæœ¬</s></p>
<p> 2022.8.21æ›´æ–°ï¼š</p>
<p>å®˜æ–¹ä¹Ÿæ–°å¢äº†ä¸€é”®å®‰è£…HybridCLRåŠŸèƒ½ï¼Œæˆ‘ç›´æ¥ç§»æ¤è¿‡æ¥äº†ã€‚å¦å¤–ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œæå–äº†Unity 2021.3.1ç‰ˆæœ¬çš„il2cppæ”¾åœ¨é¡¹ç›®é‡Œï¼Œå¢åŠ äº†ä¸€é”®ä»il2cppå‹ç¼©æ–‡ä»¶å®‰è£…HybridCLRçš„åŠŸèƒ½ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•å¦‚å›¾ï¼š</p>
<p class="img-center"><img alt="" height="136" src="image\2d325e5fb7cd48ec8868953f0036c8d5.png" width="500"/></p>
<p>å·¥å…·é»˜è®¤ä¼šæ ¹æ®å½“å‰Unityç‰ˆæœ¬å»æŸ¥æ‰¾åŒ¹é…çš„HybridCLR il2cppç‰ˆæœ¬(2020.3.3æˆ–2021.3.1)ï¼Œå¦‚æœä½ æ²¡æœ‰å®‰è£…è¿™ä¸¤ä¸ªç‰ˆæœ¬å°±ä¼šä½¿ç”¨å½“å‰Unityå®‰è£…ç›®å½•ä¸‹çš„il2cpp, ä½†æ˜¯il2cppç‰ˆæœ¬ä¸åŒ¹é…å¾ˆæœ‰å¯èƒ½å‡ºç°å…¼å®¹é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¥å‹ç¼©åŒ…çš„å½¢å¼å†…ç½®äº†Unity 2021.3.1ç‰ˆæœ¬çš„il2cppï¼Œç‚¹å‡»Use Buitin il2cppç¨‹åºä¼šè‡ªåŠ¨è§£å‹å¹¶ä½¿ç”¨ï¼Œç„¶åç‚¹å‡»installå®‰è£…å³å¯ã€‚(æ³¨ï¼Œå¦‚æœç”¨çš„æ˜¯Unity 2020.xï¼Œéœ€è¦è‡ªè¡Œæå–Unity 2020.3.33ç‰ˆæœ¬çš„il2cppï¼Œå‹ç¼©ä¸ºil2cpp_Unity2020_3_33.zipæ”¾åˆ°é¡¹ç›®çš„HybridCLRDataç›®å½•ä¸‹)</p>
<p> </p>
<p> </p>
<p>æ‰‹æœºç«¯çƒ­æ›´å®æµ‹ï¼š</p>
<p><img alt="" height="1200" src="image\ec60e00e18114e85897869d2d84f8aea.jpeg" width="1080"/></p>
<p></p>
</div>
</div>