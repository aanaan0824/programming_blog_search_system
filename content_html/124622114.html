<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p id="main-toc"><strong>目录</strong></p>
<p id="%E4%B8%80.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D-toc" style="margin-left:0px;"><a href="#%E4%B8%80.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D">一.文件上传漏洞原理🐱‍🏍🐱‍🏍🐱‍🏍</a></p>
<p id="1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD-toc" style="margin-left:40px;"><a href="#1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD">1.文件上传功能</a></p>
<p id="2.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC-toc" style="margin-left:40px;"><a href="#2.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC">2.一句话木马</a></p>
<p id="%E4%BA%8CWebshell%E4%BB%8B%E7%BB%8D%E2%98%A0%E2%98%A0%E2%98%A0-toc" style="margin-left:0px;"><a href="#%E4%BA%8CWebshell%E4%BB%8B%E7%BB%8D%E2%98%A0%E2%98%A0%E2%98%A0">二Webshell介绍☠☠☠</a></p>
<p id="1.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E7%89%B9%E7%82%B9-toc" style="margin-left:40px;"><a href="#1.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E7%89%B9%E7%82%B9">1.一句话木马的特点</a></p>
<p id="2.%E5%B0%8F%E9%A9%AC-toc" style="margin-left:40px;"><a href="#2.%E5%B0%8F%E9%A9%AC">2.小马</a></p>
<p id="3.%E5%A4%A7%E9%A9%AC-toc" style="margin-left:40px;"><a href="#3.%E5%A4%A7%E9%A9%AC">3.大马</a></p>
<p id="%E4%B8%89%E7%BD%91%E7%AB%99%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7%F0%9F%A6%84%F0%9F%A6%84%F0%9F%A6%84-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E7%BD%91%E7%AB%99%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7%F0%9F%A6%84%F0%9F%A6%84%F0%9F%A6%84">三网站控制工具🦄🦄🦄</a></p>
<p id="%E5%9B%9B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%8D%B1%E5%AE%B3%F0%9F%91%80%F0%9F%91%80%F0%9F%91%80-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%8D%B1%E5%AE%B3%F0%9F%91%80%F0%9F%91%80%F0%9F%91%80">四文件上传的危害👀👀👀</a></p>
<p id="%E4%BA%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0%F0%9F%90%B2%F0%9F%90%B2%F0%9F%90%B2-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0%F0%9F%90%B2%F0%9F%90%B2%F0%9F%90%B2">五文件上传靶场练习🐲🐲🐲</a></p>
<p id="%E5%85%AD.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89-toc" style="margin-left:0px;"><a href="#%E5%85%AD.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89">六.文件上传漏洞发现与利用🐱‍🐉🐱‍🐉🐱‍🐉</a></p>
<p id="1.%E5%88%A9%E7%94%A8%E7%9A%84%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#1.%E5%88%A9%E7%94%A8%E7%9A%84%E6%B5%81%E7%A8%8B">1.利用的流程</a></p>
<p id="1%E6%89%BE%E5%88%B0%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BD%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#1%E6%89%BE%E5%88%B0%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BD%8D%E7%BD%AE">1找到上传的位置</a></p>
<p id="2.%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E6%A0%A1%E9%AA%8C%2C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#2.%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E6%A0%A1%E9%AA%8C%2C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">2.尝试绕过校验,上传文件</a></p>
<p id="3.%E8%8E%B7%E5%BE%97%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#3.%E8%8E%B7%E5%BE%97%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE">3.获得文件位置</a></p>
<p id="4.%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%2C%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#4.%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%2C%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6">4.蚁剑链接,管理文件</a></p>
<p id="7.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B2%E5%BE%A1%F0%9F%91%B9%F0%9F%91%B9%F0%9F%91%B9-toc" style="margin-left:0px;"><a href="#7.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B2%E5%BE%A1%F0%9F%91%B9%F0%9F%91%B9%F0%9F%91%B9">7.文件上传漏洞的防御👹👹👹</a></p>
<p id="1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%94%9F%E7%9A%84%E5%89%8D%E6%8F%90-toc" style="margin-left:40px;"><a href="#1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%94%9F%E7%9A%84%E5%89%8D%E6%8F%90">1.文件上传漏洞发生的前提</a></p>
<p id="2.%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD%F0%9F%A4%A1%F0%9F%A4%A1%F0%9F%A4%A1-toc" style="margin-left:40px;"><a href="#2.%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD%F0%9F%A4%A1%F0%9F%A4%A1%F0%9F%A4%A1">2.防御措施🤡🤡🤡</a></p>
<hr id="hr-toc"/>
<p></p>
<p></p>
<h1 id="%E4%B8%80.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D">一.文件上传漏洞原理🐱‍🏍🐱‍🏍🐱‍🏍</h1>
<h2 id="1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD">1.文件上传功能</h2>
<p>网站Web应用都有一些文件上传功能，比如文档、图片、头像、视频上传，当上传功能的实现代码没有严格校验上传文件的后缀和文件类型，此时攻击者就可以上传一个webshell到一个Web可访问的目录上，并将恶意文件传递给如PHP解释器去执行，之后就可以在服务器上执行恶意代码，进行数据库执行、服务器文件管理，服务器命令执行等恶意操作。还有一部分是攻击者通过Web服务器的解析漏洞来突破Web应用程序的防护。</p>
<p><img alt="" height="357" src="image\2c8a00a7fb6d45bcbad01a65cb5f3eb8.png" width="726"/></p>
<p></p>
<p></p>
<h2 id="2.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC">2.一句话木马</h2>
<p><img alt="" height="109" src="image\c9efd97fbacc488c9a6048ecd17da749.png" width="686"/></p>
<p></p>
<p></p>
<h1 id="%E4%BA%8CWebshell%E4%BB%8B%E7%BB%8D%E2%98%A0%E2%98%A0%E2%98%A0">二Webshell介绍☠☠☠</h1>
<h2 id="1.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E7%89%B9%E7%82%B9">1.一句话木马的特点</h2>
<p>代码短,只有一行代码.</p>
<p>场景多,可以单独生成文件,也可以插入图片中</p>
<p>安全性高,隐匿性强,可变形免杀</p>
<p></p>
<h2 id="2.%E5%B0%8F%E9%A9%AC">2.小马</h2>
<p>体积小,功能少</p>
<p>只有文件上传功能</p>
<p></p>
<h2 id="3.%E5%A4%A7%E9%A9%AC">3.大马</h2>
<p>体积大,功能全</p>
<p>能够管理数据库,文件管理,对站点进行快速的信息收集,甚至能够提权</p>
<p></p>
<pre>github.com/tennc/webshell</pre>
<p></p>
<h1 id="%E4%B8%89%E7%BD%91%E7%AB%99%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7%F0%9F%A6%84%F0%9F%A6%84%F0%9F%A6%84">三网站控制工具🦄🦄🦄</h1>
<p>主流工具(注:如果需要这些工具的安装和使用教程请私信我扣1,我看人数来决定更新)</p>
<p>中国菜刀</p>
<p>中国蚁剑</p>
<pre><code>https://github/AntSwordProject/antSword</code></pre>
<p><img alt="" height="458" src="image\a895b83740764658b54ff45792570504.png" width="691"/></p>
<p></p>
<p></p>
<p>weevely</p>
<pre><code>https://github.com/epinna/weevely3</code></pre>
<p>哥斯拉 godzilla</p>
<pre><code>https://github.com/BeichenDream/Godzilla</code></pre>
<p><img alt="" height="277" src="image\88e04f7994a548fba6a255ac3b3a27ba.png" width="711"/></p>
<p></p>
<p></p>
<p>冰蝎</p>
<pre><code>https://github.com/rebeyond/Behinder</code></pre>
<p><img alt="" height="537" src="image\ed8c738071be480e8f6dbf48901abff5.png" width="711"/></p>
<p></p>
<p></p>
<h1 id="%E5%9B%9B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%8D%B1%E5%AE%B3%F0%9F%91%80%F0%9F%91%80%F0%9F%91%80">四文件上传的危害👀👀👀</h1>
<p>文件上传漏洞是指用户上传一个可执行的脚本文件,而且通过这个脚本文件获得了执行服务器端命令的能力</p>
<pre>wooyun.2xss.cc/searchbug.php?q=文件上传              //现在已经挂掉,只剩下一个镜像站</pre>
<p></p>
<p>1.危害一:黑链接</p>
<p>有可能被攻击者挂上黑链接</p>
<p><img alt="" height="338" src="image\81907b225ac7410abd30c88b50ea653e.png" width="657"/></p>
<p></p>
<p></p>
<p>2.挖矿</p>
<p><img alt="" height="160" src="image\73f1c8ac988f4ee9b85050a2bc505bf6.png" width="679"/></p>
<p></p>
<p></p>
<p>3.敏感文件的泄露(不具体展示)</p>
<p><img alt="" height="47" src="image\2a9b829ec89b47fe854fe3be215a8146.png" width="551"/></p>
<p></p>
<h1 id="%E4%BA%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0%F0%9F%90%B2%F0%9F%90%B2%F0%9F%90%B2">五文件上传靶场练习🐲🐲🐲</h1>
<p>(注:靶场我会出一个专栏给大家补上md的)</p>
<pre><code>https://github.com/c0ny1/upload-labs</code></pre>
<p><img alt="" height="318" src="image\c2e736e2caf44871881297d8eaecd9c5.png" width="712"/></p>
<p></p>
<p></p>
<h1 id="%E5%85%AD.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89">六.文件上传漏洞发现与利用🐱‍🐉🐱‍🐉🐱‍🐉</h1>
<h2 id="1.%E5%88%A9%E7%94%A8%E7%9A%84%E6%B5%81%E7%A8%8B">1.利用的流程</h2>
<pre>github.com/almandin/fuxploider</pre>
<h3 id="1%E6%89%BE%E5%88%B0%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BD%8D%E7%BD%AE">1找到上传的位置</h3>
<h3 id="2.%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E6%A0%A1%E9%AA%8C%2C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6">2.尝试绕过校验,上传文件</h3>
<p>删除/禁用JS,修改MIME,等价扩展名,大小写,htaccess,双写,空格,点. ::$DATA , %00截断, 0x00截断, 图片马,条件竞争等等</p>
<h3 id="3.%E8%8E%B7%E5%BE%97%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE">3.获得文件位置</h3>
<p>1.开源的就审计代码</p>
<p>2.做一个文件的审查器</p>
<h3 id="4.%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%2C%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6">4.蚁剑链接,管理文件</h3>
<p></p>
<h1 id="7.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B2%E5%BE%A1%F0%9F%91%B9%F0%9F%91%B9%F0%9F%91%B9">7.文件上传漏洞的防御👹👹👹</h1>
<h2 id="1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%94%9F%E7%9A%84%E5%89%8D%E6%8F%90">1.文件上传漏洞发生的前提</h2>
<p>1.网站上传功能正常</p>
<p>2.文件类型允许上传</p>
<p>3.上传路径可以确认</p>
<p>4.文件可以被访问,可以被执行或被包含</p>
<p></p>
<p>Linux文件权限</p>
<p><img alt="" height="795" src="image\a0e63fb70d784ee3ac019458f47de684.png" width="705"/></p>
<p></p>
<p></p>
<h2 id="2.%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD%F0%9F%A4%A1%F0%9F%A4%A1%F0%9F%A4%A1">2.防御措施🤡🤡🤡</h2>
<p>1.扩展名(后缀)黑白名单</p>
<p>2.MIME类型校验(image/gif)</p>
<p>3.文件内容头校验(GIF89a)</p>
<p>4.对文件内容进行二次渲染</p>
<p>5.对上传的文件重命名,不易被猜测</p>
<p>6.不要暴露上传文件的位置</p>
<p>7.禁用上传文件的执行权限</p>
</div>
</div>