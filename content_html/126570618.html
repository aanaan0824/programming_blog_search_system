<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<blockquote>
<p>ğŸ‹ä½œè€…ç®€ä»‹ï¼šåšä¸»æ˜¯ä¸€ä½.Netå¼€å‘è€…ï¼ŒåŒæ—¶ä¹Ÿæ˜¯RPAå’Œä½ä»£ç å¹³å°çš„è·µè¡Œè€…ã€‚<br/> ğŸ¬ä¸ªäººä¸»é¡µï¼š<a href="https://blog.csdn.net/baidu_33146219?type=blog">ä¼šæ•²é”®ç›˜çš„è‚˜å­</a><br/> ğŸ°ç³»åˆ—ä¸“æ ï¼š<a href="https://blog.csdn.net/baidu_33146219/category_11968078.html?spm=1001.2014.3001.5482">.Netå®ç”¨æ–¹æ³•æ€»ç»“</a><br/> ğŸ¦€ä¸“æ ç®€ä»‹ï¼šåšä¸»é’ˆå¯¹.Netå¼€å‘å’ŒCç«™é—®ç­”è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜è¿›è¡Œæ€»ç»“ï¼Œå½¢æˆæœ¬ä¸“æ ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°æ‚¨è§£å†³é—®é¢˜ã€‚<br/> ğŸ¶åº§å³é“­ï¼šæ€»æœ‰ä¸€å¤©ä½ æ‰€åšæŒçš„ä¼šåè¿‡æ¥æ‹¥æŠ±ä½ ã€‚</p>
</blockquote>
<hr/>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/20149cf905ca46f78ca992f76476341b.png#pic_center"/></p>
<blockquote>
<p>ğŸŒˆå†™åœ¨å‰é¢ï¼š</p>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»<strong>System.IO</strong>å‘½åç©ºé—´çš„<strong>FileStream</strong> ç±»ï¼Œä»‹ç»å…¶å¸¸ç”¨çš„æ–¹æ³•å’Œç¤ºä¾‹è¯´æ˜ã€‚</p>
</blockquote>
<hr/>
<p><strong>ğŸ‘‰æœ¬æ–‡å…³é”®å­—ï¼šSystem.IOã€FileStreamç±»ã€æ–‡ä»¶æµã€æ–¹æ³•ç¤ºä¾‹ã€C#</strong></p>
<p></p>
<div class="toc">
<h3>æ–‡ç« ç›®å½•</h3>
<ul><li><ul><li><ul><li><a href="#1_SystemIO_21">1ï¸âƒ£ System.IOå‘½åç©ºé—´</a></li><li><a href="#2_FileStream_45">2ï¸âƒ£ FileStreamç±»</a></li><li><ul><li><a href="#__47">â™ˆ å®šä¹‰</a></li><li><a href="#__55">â› ç¤ºä¾‹</a></li><li><a href="#__147">â™‰ æ„é€ å‡½æ•°</a></li><li><ul><li><a href="#FileStreamString_FileMode_FileAccess_FileShare_Int32_FileOptions_151">FileStream(String, FileMode, FileAccess, FileShare, Int32, FileOptions)</a></li><li><a href="#FileStreamString_FileMode_FileAccess_FileShare_Int32_Boolean_264">FileStream(String, FileMode, FileAccess, FileShare, Int32, Boolean)</a></li><li><a href="#FileStreamString_FileMode_436">FileStream(String, FileMode)</a></li></ul>
</li><li><a href="#__504">â™Š å±æ€§</a></li><li><ul><li><a href="#CanRead__506">CanRead å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œè·å–æŒ‡ç¤ºå½“å‰æµæ˜¯å¦æ”¯æŒè¯»å–çš„å€¼</a></li><li><a href="#CanWrite__535">CanWrite å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œè·å–æŒ‡ç¤ºå½“å‰æµæ˜¯å¦æ”¯æŒå†™å…¥åŠŸèƒ½çš„å€¼</a></li><li><a href="#Length__566">Length å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œè·å–æµé•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</a></li></ul>
</li><li><a href="#__572">â™Œ å¸¸ç”¨æ–¹æ³•</a></li><li><ul><li><a href="#Close__574">Close() å…³é—­å½“å‰æµå¹¶é‡Šæ”¾ä¸ä¹‹å…³è”çš„æ‰€æœ‰èµ„æºï¼ˆå¦‚å¥—æ¥å­—å’Œæ–‡ä»¶å¥æŸ„ï¼‰</a></li><li><a href="#CopyToStream__582">CopyTo(Stream) ä»å½“å‰æµä¸­è¯»å–å­—èŠ‚å¹¶å°†å…¶å†™å…¥åˆ°å¦ä¸€æµä¸­</a></li><li><a href="#CopyToStream_Int32__618">CopyTo(Stream, Int32) ä½¿ç”¨æŒ‡å®šçš„ç¼“å†²åŒºå¤§å°ï¼Œä»å½“å‰æµä¸­è¯»å–å­—èŠ‚å¹¶å°†å…¶å†™å…¥åˆ°å¦ä¸€æµä¸­</a></li><li><a href="#CopyToAsyncStream__638">CopyToAsync(Stream) ä»å½“å‰æµä¸­å¼‚æ­¥è¯»å–å­—èŠ‚å¹¶å°†å…¶å†™å…¥åˆ°å¦ä¸€ä¸ªæµä¸­</a></li><li><a href="#Dispose__Stream__693">Dispose() é‡Šæ”¾ç”± Stream ä½¿ç”¨çš„æ‰€æœ‰èµ„æº</a></li><li><a href="#ReadByte_Int32_Int32__699">Read(Byte[], Int32, Int32) å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œä»å½“å‰æµè¯»å–å­—èŠ‚åºåˆ—ï¼Œå¹¶å°†æ­¤æµä¸­çš„ä½ç½®æå‡è¯»å–çš„å­—èŠ‚æ•°</a></li><li><a href="#ReadAsyncByte_Int32_Int32__772">ReadAsync(Byte[], Int32, Int32) ä»å½“å‰æµå¼‚æ­¥è¯»å–å­—èŠ‚åºåˆ—ï¼Œå¹¶å°†æµä¸­çš„ä½ç½®æå‡è¯»å–çš„å­—èŠ‚æ•°</a></li><li><a href="#ReadByte__842">ReadByte() ä»æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶å°†è¯»å–ä½ç½®æå‡ä¸€ä¸ªå­—èŠ‚</a></li><li><a href="#WriteByte_Int32_Int32__900">Write(Byte[], Int32, Int32) å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œå‘å½“å‰æµä¸­å†™å…¥å­—èŠ‚åºåˆ—ï¼Œå¹¶å°†æ­¤æµä¸­çš„å½“å‰ä½ç½®æå‡å†™å…¥çš„å­—èŠ‚æ•°</a></li><li><a href="#WriteAsyncByte_Int32_Int32__930">WriteAsync(Byte[], Int32, Int32) å°†å­—èŠ‚åºåˆ—å¼‚æ­¥å†™å…¥å½“å‰æµï¼Œå¹¶å°†æµçš„å½“å‰ä½ç½®æå‡å†™å…¥çš„å­—èŠ‚æ•°</a></li><li><a href="#WriteByteByte__1000">WriteByte(Byte) ä¸€ä¸ªå­—èŠ‚å†™å…¥æ–‡ä»¶æµä¸­çš„å½“å‰ä½ç½®</a></li><li><a href="#Flush__1060">Flush() æ¸…é™¤æ­¤æµçš„ç¼“å†²åŒºï¼Œä½¿å¾—æ‰€æœ‰ç¼“å†²æ•°æ®éƒ½å†™å…¥åˆ°æ–‡ä»¶ä¸­</a></li><li><a href="#FlushAsync__1105">FlushAsync() å¼‚æ­¥æ¸…é™¤æ­¤æµçš„æ‰€æœ‰ç¼“å†²åŒºå¹¶å¯¼è‡´æ‰€æœ‰ç¼“å†²æ•°æ®éƒ½å†™å…¥åŸºç¡€è®¾å¤‡ä¸­</a></li><li><a href="#LockInt64_Int64__FileStream_1117">Lock(Int64, Int64) é˜²æ­¢å…¶ä»–è¿›ç¨‹è¯»å–æˆ–å†™å…¥ FileStream</a></li><li><a href="#UnlockInt64_Int64__1299">Unlock(Int64, Int64) å…è®¸å…¶ä»–è¿›ç¨‹è®¿é—®ä»¥å‰é”å®šçš„æŸä¸ªæ–‡ä»¶çš„å…¨éƒ¨æˆ–éƒ¨åˆ†</a></li></ul>
</li><li><a href="#__1481">â™ æ³¨è§£</a></li><li><a href="#__1493">â™ æ›´å¤šæ–¹æ³•</a></li></ul>
</li></ul>
</li></ul>
</li></ul>
</div>
<p></p>
<h3><a id="1_SystemIO_21"></a>1ï¸âƒ£ System.IOå‘½åç©ºé—´</h3>
<p>.NETä¸­çš„IOæ“ä½œå‘½åç©ºé—´ï¼ŒåŒ…å«å…è®¸<strong>è¯»å†™æ–‡ä»¶</strong>å’Œ<strong>æ•°æ®æµ</strong>çš„ç±»å‹ä»¥åŠæä¾›åŸºæœ¬<strong>æ–‡ä»¶å’Œç›®å½•æ”¯æŒ</strong>çš„ç±»å‹ã€‚</p>
<p>æˆ‘ä»¬åœ¨.NETä¸­çš„IOæ“ä½œï¼Œç»å¸¸éœ€è¦è°ƒç”¨ä¸€ä¸‹å‡ ä¸ªç±»ã€‚</p>
<ul><li><strong>FileStreamç±»</strong></li></ul>
<p>â€‹ æ–‡ä»¶æµç±»ï¼Œè´Ÿè´£å¤§æ–‡ä»¶çš„æ‹·è´ï¼Œè¯»å†™ã€‚</p>
<ul><li><strong>Pathç±»</strong></li></ul>
<p>â€‹ Pathç±»ä¸­æ–¹æ³•ï¼ŒåŸºæœ¬éƒ½æ˜¯å¯¹å­—ç¬¦ä¸²ï¼ˆæ–‡ä»¶åï¼‰çš„æ“ä½œï¼Œä¸å®é™…æ–‡ä»¶æ²¡å¤šå¤§å…³ç³»ã€‚</p>
<ul><li> <p><strong>Fileç±»</strong></p> <p>Fileç±»å¯ä»¥è¿›è¡Œä¸€äº›å¯¹å°æ–‡ä»¶æ‹·è´ã€å‰ªåˆ‡æ“ä½œï¼Œè¿˜èƒ½è¯»ä¸€äº›æ–‡æ¡£æ–‡ä»¶ã€‚</p> </li><li> <p><strong>Dirctoryç±»</strong></p> <p>ç›®å½•æ“ä½œï¼Œåˆ›å»ºæ–‡ä»¶ã€åˆ é™¤ç›®å½•ï¼Œè·å–ç›®å½•ä¸‹æ–‡ä»¶åç­‰ç­‰ã€‚</p> </li></ul>
<h3><a id="2_FileStream_45"></a>2ï¸âƒ£ FileStreamç±»</h3>
<h4><a id="__47"></a>â™ˆ å®šä¹‰</h4>
<p>ä¸ºæ–‡ä»¶æä¾› <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream?view=net-6.0">Stream</a>ï¼Œæ—¢æ”¯æŒåŒæ­¥è¯»å†™æ“ä½œï¼Œä¹Ÿæ”¯æŒå¼‚æ­¥è¯»å†™æ“ä½œã€‚</p>
<pre><code class="prism language-C#">public class FileStream : System.IO.Stream
</code></pre>
<h4><a id="__55"></a>â› ç¤ºä¾‹</h4>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†ä¸€äº› <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> æ„é€ å‡½æ•°ã€‚</p>
<pre><code class="prism language-c#">using System;
using System.IO;
using System.Text;

class Test
{

    public static void Main()
    {
        string path = @"c:\temp\MyTest.txt";

        // Delete the file if it exists.
        if (File.Exists(path))
        {
            File.Delete(path);
        }

        //Create the file.
        using (FileStream fs = File.Create(path))
        {
            AddText(fs, "This is some text");
            AddText(fs, "This is some more text,");
            AddText(fs, "\r\nand this is on a new line");
            AddText(fs, "\r\n\r\nThe following is a subset of characters:\r\n");

            for (int i=1;i &lt; 120;i++)
            {
                AddText(fs, Convert.ToChar(i).ToString());
            }
        }

        //Open the stream and read it back.
        using (FileStream fs = File.OpenRead(path))
        {
            byte[] b = new byte[1024];
            UTF8Encoding temp = new UTF8Encoding(true);
            while (fs.Read(b,0,b.Length) &gt; 0)
            {
                Console.WriteLine(temp.GetString(b));
            }
        }
    }

    private static void AddText(FileStream fs, string value)
    {
        byte[] info = new UTF8Encoding(true).GetBytes(value);
        fs.Write(info, 0, info.Length);
    }
}
</code></pre>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•å¼‚æ­¥å†™å…¥æ–‡ä»¶ã€‚ æ­¤ä»£ç åœ¨ WPF åº”ç”¨ä¸­è¿è¡Œï¼Œè¯¥åº”ç”¨å…·æœ‰åä¸º UserInput çš„ TextBlock å’Œå·²æŒ‚æ¥åˆ°åä¸º Button_Click çš„ Click äº‹ä»¶å¤„ç†ç¨‹åºçš„æŒ‰é’®ã€‚ æ–‡ä»¶è·¯å¾„éœ€è¦æ›´æ”¹ä¸ºè®¡ç®—æœºä¸Šå­˜åœ¨çš„æ–‡ä»¶ã€‚</p>
<pre><code class="prism language-c#">using System;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.IO;

namespace WpfApplication1
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }

        private async void Button_Click(object sender, RoutedEventArgs e)
        {
            UnicodeEncoding uniencoding = new UnicodeEncoding();
            string filename = @"c:\Users\exampleuser\Documents\userinputlog.txt";

            byte[] result = uniencoding.GetBytes(UserInput.Text);

            using (FileStream SourceStream = File.Open(filename, FileMode.OpenOrCreate))
            {
                SourceStream.Seek(0, SeekOrigin.End);
                await SourceStream.WriteAsync(result, 0, result.Length);
            }
        }
    }
}
</code></pre>
<h4><a id="__147"></a>â™‰ æ„é€ å‡½æ•°</h4>
<p>åˆå§‹åŒ– FileStream ç±»çš„æ–°å®ä¾‹</p>
<h5><a id="FileStreamString_FileMode_FileAccess_FileShare_Int32_FileOptions_151"></a>FileStream(String, FileMode, FileAccess, FileShare, Int32, FileOptions)</h5>
<p>ä½¿ç”¨æŒ‡å®šçš„è·¯å¾„ã€åˆ›å»ºæ¨¡å¼ã€è¯»/å†™å’Œå…±äº«æƒé™ã€å…¶ä»– FileStreams å¯ä»¥å…·æœ‰çš„å¯¹æ­¤æ–‡ä»¶çš„è®¿é—®æƒé™ã€ç¼“å†²åŒºå¤§å°å’Œé™„åŠ æ–‡ä»¶é€‰é¡¹åˆå§‹åŒ– <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> ç±»çš„æ–°å®ä¾‹ã€‚</p>
<pre><code class="prism language-C#">public FileStream (string path, System.IO.FileMode mode, System.IO.FileAccess access, System.IO.FileShare share, int bufferSize, System.IO.FileOptions options);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>path</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.string?view=net-6.0">String</a></p>
<p>å½“å‰ <code>FileStream</code> å¯¹è±¡å°†å°è£…çš„æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ã€‚</p>
<p><code>mode</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filemode?view=net-6.0">FileMode</a></p>
<p>ç”¨äºç¡®å®šæ–‡ä»¶çš„æ‰“å¼€æˆ–åˆ›å»ºæ–¹å¼çš„æšä¸¾å€¼ä¹‹ä¸€ã€‚</p>
<p><code>access</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.fileaccess?view=net-6.0">FileAccess</a></p>
<p>æšä¸¾å€¼çš„æŒ‰ä½ç»„åˆï¼Œè¿™äº›æšä¸¾å€¼ç¡®å®š <code>FileStream</code> å¯¹è±¡è®¿é—®æ–‡ä»¶çš„æ–¹å¼ã€‚ è¯¥å¸¸æ•°è¿˜å¯ä»¥ç¡®å®šç”± <code>FileStream</code> å¯¹è±¡çš„ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.canread?view=net-6.0#system-io-filestream-canread">CanRead</a> å’Œ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.canwrite?view=net-6.0#system-io-filestream-canwrite">CanWrite</a> å±æ€§è¿”å›çš„å€¼ã€‚ å¦‚æœ <code>path</code> æŒ‡å®šç£ç›˜æ–‡ä»¶ï¼Œåˆ™ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.canseek?view=net-6.0#system-io-filestream-canseek">CanSeek</a> ä¸º <code>true</code>ã€‚</p>
<p><code>share</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.fileshare?view=net-6.0">FileShare</a></p>
<p>æšä¸¾å€¼çš„æŒ‰ä½ç»„åˆï¼Œè¿™äº›æšä¸¾å€¼ç¡®å®šè¿›ç¨‹å…±äº«æ–‡ä»¶çš„æ–¹å¼ã€‚</p>
<p><code>bufferSize</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p>ä¸€ä¸ªå¤§äºé›¶çš„æ­£ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a> å€¼ï¼Œè¡¨ç¤ºç¼“å†²åŒºå¤§å°ã€‚ é»˜è®¤ç¼“å†²åŒºå¤§å°ä¸º 4096ã€‚</p>
<p><code>options</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.fileoptions?view=net-6.0">FileOptions</a></p>
<p>æšä¸¾å€¼çš„æŒ‰ä½ç»„åˆï¼Œå®ƒç”¨äºæŒ‡å®šå…¶ä»–æ–‡ä»¶é€‰é¡¹ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä»¥ä¸‹ç¤ºä¾‹å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ å¯¹è±¡è¯»å– <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> æ•°æ®ã€‚</p>
<pre><code class="prism language-c#">using System;
using System.IO;
using System.Text;
using System.Security.AccessControl;

namespace FileSystemExample
{
    class FileStreamExample
    {
        public static void Main()
        {
            try
            {
                // Create a file and write data to it.

                // Create an array of bytes.
                byte[] messageByte = Encoding.ASCII.GetBytes("Here is some data.");

                // Create a file using the FileStream class.
                FileStream fWrite = new FileStream("test.txt", FileMode.Create, FileAccess.ReadWrite, FileShare.None, 8, FileOptions.None);

                // Write the number of bytes to the file.
                fWrite.WriteByte((byte)messageByte.Length);

                // Write the bytes to the file.
                fWrite.Write(messageByte, 0, messageByte.Length);

                // Close the stream.
                fWrite.Close();

                // Open a file and read the number of bytes.

                FileStream fRead = new FileStream("test.txt", FileMode.Open);

                // The first byte is the string length.
                int length = (int)fRead.ReadByte();

                // Create a new byte array for the data.
                byte[] readBytes = new byte[length];

                // Read the data from the file.
                fRead.Read(readBytes, 0, readBytes.Length);

                // Close the stream.
                fRead.Close();

                // Display the data.
                Console.WriteLine(Encoding.ASCII.GetString(readBytes));

                Console.WriteLine("Done writing and reading data.");
            }
            catch (Exception e)
            {
                Console.WriteLine(e);
            }

            Console.ReadLine();
        }
    }
}
</code></pre>
<h5><a id="FileStreamString_FileMode_FileAccess_FileShare_Int32_Boolean_264"></a>FileStream(String, FileMode, FileAccess, FileShare, Int32, Boolean)</h5>
<p>ä½¿ç”¨æŒ‡å®šçš„è·¯å¾„ã€åˆ›å»ºæ¨¡å¼ã€è¯»/å†™å’Œå…±äº«æƒé™ã€ç¼“å†²åŒºå¤§å°å’ŒåŒæ­¥æˆ–å¼‚æ­¥çŠ¶æ€åˆå§‹åŒ– <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> ç±»çš„æ–°å®ä¾‹ã€‚</p>
<pre><code class="prism language-C#">public FileStream (string path, System.IO.FileMode mode, System.IO.FileAccess access, System.IO.FileShare share, int bufferSize, bool useAsync);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>path</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.string?view=net-6.0">String</a></p>
<p>å½“å‰ <code>FileStream</code> å¯¹è±¡å°†å°è£…çš„æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ã€‚</p>
<p><code>mode</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filemode?view=net-6.0">FileMode</a></p>
<p>ç”¨äºç¡®å®šæ–‡ä»¶çš„æ‰“å¼€æˆ–åˆ›å»ºæ–¹å¼çš„æšä¸¾å€¼ä¹‹ä¸€ã€‚</p>
<p><code>access</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.fileaccess?view=net-6.0">FileAccess</a></p>
<p>æšä¸¾å€¼çš„æŒ‰ä½ç»„åˆï¼Œè¿™äº›æšä¸¾å€¼ç¡®å®š <code>FileStream</code> å¯¹è±¡è®¿é—®æ–‡ä»¶çš„æ–¹å¼ã€‚ è¯¥å¸¸æ•°è¿˜å¯ä»¥ç¡®å®šç”± <code>FileStream</code> å¯¹è±¡çš„ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.canread?view=net-6.0#system-io-filestream-canread">CanRead</a> å’Œ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.canwrite?view=net-6.0#system-io-filestream-canwrite">CanWrite</a> å±æ€§è¿”å›çš„å€¼ã€‚ å¦‚æœ <code>path</code> æŒ‡å®šç£ç›˜æ–‡ä»¶ï¼Œåˆ™ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.canseek?view=net-6.0#system-io-filestream-canseek">CanSeek</a> ä¸º <code>true</code>ã€‚</p>
<p><code>share</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.fileshare?view=net-6.0">FileShare</a></p>
<p>æšä¸¾å€¼çš„æŒ‰ä½ç»„åˆï¼Œè¿™äº›æšä¸¾å€¼ç¡®å®šè¿›ç¨‹å…±äº«æ–‡ä»¶çš„æ–¹å¼ã€‚</p>
<p><code>bufferSize</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p>ä¸€ä¸ªå¤§äºé›¶çš„æ­£ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a> å€¼ï¼Œè¡¨ç¤ºç¼“å†²åŒºå¤§å°ã€‚ é»˜è®¤ç¼“å†²åŒºå¤§å°ä¸º 4096ã€‚</p>
<p><code>useAsync</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.boolean?view=net-6.0">Boolean</a></p>
<p>æŒ‡å®šä½¿ç”¨å¼‚æ­¥ I/O è¿˜æ˜¯åŒæ­¥ I/Oã€‚ ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼ŒåŸºç¡€æ“ä½œç³»ç»Ÿå¯èƒ½ä¸æ”¯æŒå¼‚æ­¥ I/Oï¼Œå› æ­¤åœ¨æŒ‡å®š <code>true</code> åï¼Œæ ¹æ®æ‰€ç”¨å¹³å°ï¼Œå¥æŸ„å¯èƒ½åŒæ­¥æ‰“å¼€ã€‚ å½“å¼‚æ­¥æ‰“å¼€æ—¶ï¼Œ[BeginRead(Byte<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.beginread?view=net-6.0#system-io-filestream-beginread%28system-byte%28%29-system-int32-system-int32-system-asynccallback-system-object%29">], Int32, Int32, AsyncCallback, Object)</a> å’Œ [BeginWrite(Byte<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.beginwrite?view=net-6.0#system-io-filestream-beginwrite%28system-byte%28%29-system-int32-system-int32-system-asynccallback-system-object%29">], Int32, Int32, AsyncCallback, Object)</a> æ–¹æ³•åœ¨æ‰§è¡Œå¤§é‡è¯»æˆ–å†™æ—¶æ•ˆæœæ›´å¥½ï¼Œä½†å¯¹äºå°‘é‡çš„è¯»/å†™ï¼Œè¿™äº›æ–¹æ³•é€Ÿåº¦å¯èƒ½è¦æ…¢å¾—å¤šã€‚ å¦‚æœåº”ç”¨ç¨‹åºæ‰“ç®—åˆ©ç”¨å¼‚æ­¥ I/Oï¼Œå°† <code>useAsync</code> å‚æ•°è®¾ç½®ä¸º <code>true</code>ã€‚ æ­£ç¡®ä½¿ç”¨å¼‚æ­¥ I/O å¯ä»¥ä½¿åº”ç”¨ç¨‹åºçš„é€Ÿåº¦åŠ å¿« 10 å€ï¼Œä½†æ˜¯å¦‚æœåœ¨æ²¡æœ‰ä¸ºå¼‚æ­¥ I/O é‡æ–°è®¾è®¡åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ä½¿ç”¨å¼‚æ­¥ I/Oï¼Œåˆ™å¯èƒ½ä½¿æ€§èƒ½é™ä½ 10 å€ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•å°†æ•°æ®å¼‚æ­¥å†™å…¥æ–‡ä»¶ï¼Œç„¶åéªŒè¯æ•°æ®æ˜¯å¦å†™å…¥æ­£ç¡®ã€‚ <code>State</code>åˆ›å»º å¯¹è±¡ä»¥å°†ä¿¡æ¯ä»ä¸»çº¿ç¨‹ä¼ é€’åˆ° å’Œ <code>EndReadCallback</code> <code>EndWriteCallback</code> æ–¹æ³•ã€‚</p>
<pre><code class="prism language-c#">using System;
using System.IO;
using System.Threading;

class FStream
{
    static void Main()
    {
        // Create a synchronization object that gets
        // signaled when verification is complete.
        ManualResetEvent manualEvent = new ManualResetEvent(false);

        // Create random data to write to the file.
        byte[] writeArray = new byte[100000];
        new Random().NextBytes(writeArray);

        FileStream fStream =
            new FileStream("Test#@@#.dat", FileMode.Create,
            FileAccess.ReadWrite, FileShare.None, 4096, true);

        // Check that the FileStream was opened asynchronously.
        Console.WriteLine("fStream was {0}opened asynchronously.",
            fStream.IsAsync ? "" : "not ");

        // Asynchronously write to the file.
        IAsyncResult asyncResult = fStream.BeginWrite(
            writeArray, 0, writeArray.Length,
            new AsyncCallback(EndWriteCallback),
            new State(fStream, writeArray, manualEvent));

        // Concurrently do other work and then wait
        // for the data to be written and verified.
        manualEvent.WaitOne(5000, false);
    }

    // When BeginWrite is finished writing data to the file, the
    // EndWriteCallback method is called to end the asynchronous
    // write operation and then read back and verify the data.
    static void EndWriteCallback(IAsyncResult asyncResult)
    {
        State tempState = (State)asyncResult.AsyncState;
        FileStream fStream = tempState.FStream;
        fStream.EndWrite(asyncResult);

        // Asynchronously read back the written data.
        fStream.Position = 0;
        asyncResult = fStream.BeginRead(
            tempState.ReadArray, 0 , tempState.ReadArray.Length,
            new AsyncCallback(EndReadCallback), tempState);

        // Concurrently do other work, such as
        // logging the write operation.
    }

    // When BeginRead is finished reading data from the file, the
    // EndReadCallback method is called to end the asynchronous
    // read operation and then verify the data.
    static void EndReadCallback(IAsyncResult asyncResult)
    {
        State tempState = (State)asyncResult.AsyncState;
        int readCount = tempState.FStream.EndRead(asyncResult);

        int i = 0;
        while(i &lt; readCount)
        {
            if(tempState.ReadArray[i] != tempState.WriteArray[i++])
            {
                Console.WriteLine("Error writing data.");
                tempState.FStream.Close();
                return;
            }
        }
        Console.WriteLine("The data was written to {0} and verified.",
            tempState.FStream.Name);
        tempState.FStream.Close();

        // Signal the main thread that the verification is finished.
        tempState.ManualEvent.Set();
    }

    // Maintain state information to be passed to
    // EndWriteCallback and EndReadCallback.
    class State
    {
        // fStream is used to read and write to the file.
        FileStream fStream;

        // writeArray stores data that is written to the file.
        byte[] writeArray;

        // readArray stores data that is read from the file.
        byte[] readArray;

        // manualEvent signals the main thread
        // when verification is complete.
        ManualResetEvent manualEvent;

        public State(FileStream fStream, byte[] writeArray,
            ManualResetEvent manualEvent)
        {
            this.fStream   = fStream;
            this.writeArray = writeArray;
            this.manualEvent = manualEvent;
            readArray = new byte[writeArray.Length];
        }

        public FileStream FStream
        { get{ return fStream; } }

        public byte[] WriteArray
        { get{ return writeArray; } }

        public byte[] ReadArray
        { get{ return readArray; } }

        public ManualResetEvent ManualEvent
        { get{ return manualEvent; } }
    }
}
</code></pre>
<h5><a id="FileStreamString_FileMode_436"></a>FileStream(String, FileMode)</h5>
<p>ä½¿ç”¨æŒ‡å®šçš„è·¯å¾„å’Œåˆ›å»ºæ¨¡å¼åˆå§‹åŒ– <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> ç±»çš„æ–°å®ä¾‹ã€‚</p>
<pre><code class="prism language-C#">public FileStream (string path, System.IO.FileMode mode);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>path</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.string?view=net-6.0">String</a></p>
<p>å½“å‰ <code>FileStream</code> å¯¹è±¡å°†å°è£…çš„æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„ã€‚</p>
<p><code>mode</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filemode?view=net-6.0">FileMode</a></p>
<p>ç”¨äºç¡®å®šæ–‡ä»¶çš„æ‰“å¼€æˆ–åˆ›å»ºæ–¹å¼çš„æšä¸¾å€¼ä¹‹ä¸€ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•æŒ‰å­—èŠ‚å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œç„¶åéªŒè¯æ˜¯å¦å·²æ­£ç¡®å†™å…¥æ•°æ®ã€‚</p>
<pre><code class="prism language-c#">using System;
using System.IO;

class FStream
{
    static void Main()
    {
        const string fileName = "Test#@@#.dat";

        // Create random data to write to the file.
        byte[] dataArray = new byte[100000];
        new Random().NextBytes(dataArray);

        using(FileStream
            fileStream = new FileStream(fileName, FileMode.Create))
        {
            // Write the data to the file, byte by byte.
            for(int i = 0; i &lt; dataArray.Length; i++)
            {
                fileStream.WriteByte(dataArray[i]);
            }

            // Set the stream position to the beginning of the file.
            fileStream.Seek(0, SeekOrigin.Begin);

            // Read and verify the data.
            for(int i = 0; i &lt; fileStream.Length; i++)
            {
                if(dataArray[i] != fileStream.ReadByte())
                {
                    Console.WriteLine("Error writing data.");
                    return;
                }
            }
            Console.WriteLine("The data was written to {0} " +
                "and verified.", fileStream.Name);
        }
    }
}
</code></pre>
<h4><a id="__504"></a>â™Š å±æ€§</h4>
<h5><a id="CanRead__506"></a>CanRead å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œè·å–æŒ‡ç¤ºå½“å‰æµæ˜¯å¦æ”¯æŒè¯»å–çš„å€¼</h5>
<pre><code class="prism language-C#">public abstract bool CanRead { get; }
</code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<pre><code class="prism language-c#">using System;
using System.IO;

class TestRW
{
    public static void Main(String[] args)
    {
        FileStream fs = new FileStream("MyFile.txt", FileMode.OpenOrCreate, FileAccess.Read);
        if (fs.CanRead &amp;&amp; fs.CanWrite)
        {
            Console.WriteLine("MyFile.txt can be both written to and read from.");
        }
        else if (fs.CanRead)
        {
            Console.WriteLine("MyFile.txt is not writable.");
        }
    }
}
</code></pre>
<h5><a id="CanWrite__535"></a>CanWrite å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œè·å–æŒ‡ç¤ºå½“å‰æµæ˜¯å¦æ”¯æŒå†™å…¥åŠŸèƒ½çš„å€¼</h5>
<pre><code class="prism language-C#">public abstract bool CanWrite { get; }
</code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<pre><code class="prism language-c#">using System;
using System.IO;

class TestRW
{
  public static void Main(String[] args)
  {
    FileStream fs = new FileStream("MyFile.txt", FileMode.OpenOrCreate,
       FileAccess.Write);
    if (fs.CanRead &amp;&amp; fs.CanWrite) {
        Console.WriteLine("MyFile.txt can be both written to and read from.");
    }
    else if (fs.CanWrite) {
        Console.WriteLine("MyFile.txt is writable.");
    }
  }
}
//This code outputs "MyFile.txt is writable."
//To get the output message "MyFile.txt can be both written to and read from.",
//change the FileAccess parameter to ReadWrite in the FileStream constructor.
</code></pre>
<h5><a id="Length__566"></a>Length å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œè·å–æµé•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</h5>
<pre><code class="prism language-C#">public abstract long Length { get; }
</code></pre>
<h4><a id="__572"></a>â™Œ å¸¸ç”¨æ–¹æ³•</h4>
<h5><a id="Close__574"></a>Close() å…³é—­å½“å‰æµå¹¶é‡Šæ”¾ä¸ä¹‹å…³è”çš„æ‰€æœ‰èµ„æºï¼ˆå¦‚å¥—æ¥å­—å’Œæ–‡ä»¶å¥æŸ„ï¼‰</h5>
<pre><code class="prism language-C#">public virtual void Close ();
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šæ­¤æ–¹æ³•è°ƒç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.dispose?view=net-6.0">Dispose</a> ï¼ŒæŒ‡å®š <code>true</code> ä»¥é‡Šæ”¾æ‰€æœ‰èµ„æºã€‚ ä¸éœ€è¦ä¸“é—¨è°ƒç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.close?view=net-6.0">Close</a> æ–¹æ³•ã€‚ è¯·ç¡®ä¿ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream?view=net-6.0">Stream</a> å·²æ­£ç¡®é‡Šæ”¾æ¯ä¸ªå¯¹è±¡ã€‚ å¯ä»¥ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream?view=net-6.0">Stream</a> <code>using</code> <code>Using</code> åœ¨ Visual Basic) ä¸­ (æˆ–å—ä¸­å£°æ˜å¯¹è±¡ï¼Œä»¥ç¡®ä¿é‡Šæ”¾æµåŠå…¶æ‰€æœ‰èµ„æºï¼Œæˆ–è€…å¯ä»¥æ˜¾å¼è°ƒç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.dispose?view=net-6.0">Dispose</a> æ–¹æ³•ã€‚</p>
</blockquote>
<h5><a id="CopyToStream__582"></a>CopyTo(Stream) ä»å½“å‰æµä¸­è¯»å–å­—èŠ‚å¹¶å°†å…¶å†™å…¥åˆ°å¦ä¸€æµä¸­</h5>
<pre><code class="prism language-C#">public void CopyTo (System.IO.Stream destination);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>destination</code></p>
<p><strong>Stream</strong></p>
<p>å½“å‰æµçš„å†…å®¹å°†å¤åˆ¶åˆ°çš„æµã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ç¤ºä¾‹å°†çš„å†…å®¹å¤åˆ¶ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> åˆ° <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.memorystream?view=net-6.0">MemoryStream</a> ä¸­ã€‚</p>
<pre><code class="prism language-C#">// Create the streams.
MemoryStream destination = new MemoryStream();

using (FileStream source = File.Open(@"c:\temp\data.dat",
    FileMode.Open))
{

    Console.WriteLine("Source length: {0}", source.Length.ToString());

    // Copy source to destination.
    source.CopyTo(destination);
}

Console.WriteLine("Destination length: {0}", destination.Length.ToString());
</code></pre>
<h5><a id="CopyToStream_Int32__618"></a>CopyTo(Stream, Int32) ä½¿ç”¨æŒ‡å®šçš„ç¼“å†²åŒºå¤§å°ï¼Œä»å½“å‰æµä¸­è¯»å–å­—èŠ‚å¹¶å°†å…¶å†™å…¥åˆ°å¦ä¸€æµä¸­</h5>
<pre><code class="prism language-C#">public virtual void CopyTo (System.IO.Stream destination, int bufferSize);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>destination</code></p>
<p><strong>Stream</strong></p>
<p>å½“å‰æµçš„å†…å®¹å°†å¤åˆ¶åˆ°çš„æµã€‚</p>
<p><code>bufferSize</code></p>
<p><strong>Int</strong></p>
<p>ç¼“å†²åŒºçš„å¤§å°ã€‚ æ­¤å€¼å¿…é¡»å¤§äºé›¶ã€‚ é»˜è®¤å¤§å°ä¸º 81920ã€‚</p>
</blockquote>
<h5><a id="CopyToAsyncStream__638"></a>CopyToAsync(Stream) ä»å½“å‰æµä¸­å¼‚æ­¥è¯»å–å­—èŠ‚å¹¶å°†å…¶å†™å…¥åˆ°å¦ä¸€ä¸ªæµä¸­</h5>
<pre><code class="prism language-C#">public System.Threading.Tasks.Task CopyToAsync (System.IO.Stream destination);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>destination</code></p>
<p><strong>Stream</strong></p>
<p>å½“å‰æµçš„å†…å®¹å°†å¤åˆ¶åˆ°çš„æµã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ä¸¤ä¸ª <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> å¯¹è±¡å°†æ–‡ä»¶ä»ä¸€ä¸ªç›®å½•å¼‚æ­¥å¤åˆ¶åˆ°å¦ä¸€ä¸ªç›®å½•ã€‚ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> ç±»æ˜¯ä» <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream?view=net-6.0">Stream</a> ç±»æ´¾ç”Ÿçš„ã€‚ è¯·æ³¨æ„ï¼Œ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.web.ui.webcontrols.button.click?view=net-6.0">Click</a> æ§ä»¶çš„äº‹ä»¶å¤„ç†ç¨‹åº <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.windows.controls.button?view=net-6.0">Button</a> ä½¿ç”¨ä¿®é¥°ç¬¦æ ‡è®°ï¼Œ <code>async</code> å› ä¸ºå®ƒè°ƒç”¨å¼‚æ­¥æ–¹æ³•</p>
<pre><code class="prism language-C#">using System;
using System.Threading.Tasks;
using System.Windows;
using System.IO;

namespace WpfApplication
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }

        private async void Button_Click(object sender, RoutedEventArgs e)
        {
            string StartDirectory = @"c:\Users\exampleuser\start";
            string EndDirectory = @"c:\Users\exampleuser\end";

            foreach (string filename in Directory.EnumerateFiles(StartDirectory))
            {
                using (FileStream SourceStream = File.Open(filename, FileMode.Open))
                {
                    using (FileStream DestinationStream = File.Create(EndDirectory + filename.Substring(filename.LastIndexOf('\\'))))
                    {
                        await SourceStream.CopyToAsync(DestinationStream);
                    }
                }
            }
        }
    }
}
</code></pre>
<blockquote>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.copytoasync?view=net-6.0">CopyToAsync</a>æ–¹æ³•ä½¿ä½ å¯ä»¥åœ¨ä¸é˜»å¡ä¸»çº¿ç¨‹çš„æƒ…å†µä¸‹æ‰§è¡Œå ç”¨å¤§é‡èµ„æºçš„ i/o æ“ä½œã€‚</p>
</blockquote>
<h5><a id="Dispose__Stream__693"></a>Dispose() é‡Šæ”¾ç”± Stream ä½¿ç”¨çš„æ‰€æœ‰èµ„æº</h5>
<pre><code class="prism language-C#">public void Dispose ();
</code></pre>
<h5><a id="ReadByte_Int32_Int32__699"></a>Read(Byte[], Int32, Int32) å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œä»å½“å‰æµè¯»å–å­—èŠ‚åºåˆ—ï¼Œå¹¶å°†æ­¤æµä¸­çš„ä½ç½®æå‡è¯»å–çš„å­—èŠ‚æ•°</h5>
<pre><code class="prism language-C#">public abstract int Read (byte[] buffer, int offset, int count);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>buffer</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.byte?view=net-6.0">Byte</a>[]</p>
<p>å­—èŠ‚æ•°ç»„ã€‚ å½“æ­¤æ–¹æ³•è¿”å›æ—¶ï¼Œæ­¤ç¼“å†²åŒºåŒ…å«æŒ‡å®šçš„å­—ç¬¦æ•°ç»„ï¼Œæ­¤æ•°ç»„ä¸­ <code>offset</code> å’Œ (<code>offset</code> + <code>count</code> - 1) ä¹‹é—´çš„å€¼è¢«ä»å½“å‰æºä¸­è¯»å–çš„å­—èŠ‚æ‰€æ›¿æ¢ã€‚</p>
<p><code>offset</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p><code>buffer</code> ä¸­çš„ä»é›¶å¼€å§‹çš„å­—èŠ‚åç§»é‡ï¼Œä»æ­¤å¤„å¼€å§‹å­˜å‚¨ä»å½“å‰æµä¸­è¯»å–çš„æ•°æ®ã€‚</p>
<p><code>count</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p>è¦ä»å½“å‰æµä¸­æœ€å¤šè¯»å–çš„å­—èŠ‚æ•°ã€‚</p>
</blockquote>
<p><strong>è¿”å›</strong></p>
<blockquote>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p>è¯»å…¥ç¼“å†²åŒºä¸­çš„æ€»å­—èŠ‚æ•°ã€‚ å¦‚æœå¾ˆå¤šå­—èŠ‚å½“å‰ä¸å¯ç”¨ï¼Œåˆ™æ€»å­—èŠ‚æ•°å¯èƒ½å°äºè¯·æ±‚çš„å­—èŠ‚æ•°ï¼›å¦‚æœå·²åˆ°è¾¾æµç»“å°¾ï¼Œåˆ™ä¸ºé›¶ (0)ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.read?view=net-6.0">Read</a> è¯»å–æ•°æ®å—ã€‚</p>
<pre><code class="prism language-C#">using System;
using System.IO;

public class Block
{
    public static void Main()
    {
        Stream s = new MemoryStream();
        for (int i = 0; i &lt; 122; i++)
        {
            s.WriteByte((byte)i);
        }
        s.Position = 0;

        // Now read s into a byte buffer with a little padding.
        byte[] bytes = new byte[s.Length + 10];
        int numBytesToRead = (int)s.Length;
        int numBytesRead = 0;
        do
        {
            // Read may return anything from 0 to 10.
            int n = s.Read(bytes, numBytesRead, 10);
            numBytesRead += n;
            numBytesToRead -= n;
        } while (numBytesToRead &gt; 0);
        s.Close();

        Console.WriteLine("number of bytes read: {0:d}", numBytesRead);
    }
}
</code></pre>
<blockquote>
<p>ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.canread?view=net-6.0">CanRead</a> å±æ€§ç¡®å®šå½“å‰å®ä¾‹æ˜¯å¦æ”¯æŒè¯»å–ã€‚ ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.readasync?view=net-6.0">ReadAsync</a> æ–¹æ³•ä»å½“å‰æµå¼‚æ­¥è¯»å–ã€‚</p>
<p>æ­¤æ–¹æ³•çš„å®ç°ä»å½“å‰æµä¸­è¯»å–æœ€å¤§å­—èŠ‚ <code>count</code> æ•°ï¼Œå¹¶å­˜å‚¨ä» <code>buffer</code> å¼€å§‹çš„å­—èŠ‚ <code>offset</code> ã€‚ æµä¸­çš„å½“å‰ä½ç½®æŒ‰è¯»å–çš„å­—èŠ‚æ•°è¿›è¡Œé«˜çº§;ä½†æ˜¯ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æµä¸­çš„å½“å‰ä½ç½®ä¿æŒä¸å˜ã€‚ å®ç°è¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚ åœ¨æ²¡æœ‰ä»»ä½•æ•°æ®å¯ç”¨æ—¶ï¼Œå®ç°å°†ä¸€ç›´é˜»æ­¢ï¼Œç›´åˆ°è‡³å°‘å¯ä»¥è¯»å–ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.read?view=net-6.0">Read</a> ä»…åœ¨æµä¸­æ²¡æœ‰æ›´å¤šæ•°æ®ä¸”é¢„æœŸæ²¡æœ‰æ›´å¤šæ•°æ®ï¼ˆä¾‹å¦‚å…³é—­å¥—æ¥å­—æˆ–æ–‡ä»¶ç»“å°¾ï¼‰ (è¿”å› 0) ã€‚ å³ä½¿å°šæœªåˆ°è¾¾æµçš„æœ«å°¾ï¼Œå®ç°ä¹Ÿèƒ½å¤Ÿè¿”å›æ¯”è¯·æ±‚çš„æ›´å°‘çš„å­—èŠ‚ã€‚</p>
</blockquote>
<h5><a id="ReadAsyncByte_Int32_Int32__772"></a>ReadAsync(Byte[], Int32, Int32) ä»å½“å‰æµå¼‚æ­¥è¯»å–å­—èŠ‚åºåˆ—ï¼Œå¹¶å°†æµä¸­çš„ä½ç½®æå‡è¯»å–çš„å­—èŠ‚æ•°</h5>
<pre><code class="prism language-C#">public System.Threading.Tasks.Task&lt;int&gt; ReadAsync (byte[] buffer, int offset, int count);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>buffer</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.byte?view=net-6.0">Byte</a>[]</p>
<p>è¦å†™å…¥æ•°æ®çš„ç¼“å†²åŒºã€‚</p>
<p><code>offset</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p><code>buffer</code> ä¸­çš„å­—èŠ‚åç§»é‡ï¼Œä»è¯¥åç§»é‡å¼€å§‹å†™å…¥ä»æµä¸­è¯»å–çš„æ•°æ®ã€‚</p>
<p><code>count</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p>æœ€å¤šè¯»å–çš„å­—èŠ‚æ•°ã€‚</p>
</blockquote>
<p><strong>è¿”å›</strong></p>
<blockquote>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.tasks.task-1?view=net-6.0">Task</a>&lt;<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a>&gt;</p>
<p>è¡¨ç¤ºå¼‚æ­¥è¯»å–æ“ä½œçš„ä»»åŠ¡ã€‚ <code>TResult</code> å‚æ•°çš„å€¼åŒ…å«è¯»å…¥ç¼“å†²åŒºçš„æ€»å­—èŠ‚æ•°ã€‚ å¦‚æœå½“å‰å¯ç”¨å­—èŠ‚æ•°å°‘äºæ‰€è¯·æ±‚çš„å­—èŠ‚æ•°ï¼Œåˆ™è¯¥ç»“æœå€¼å¯å°äºæ‰€è¯·æ±‚çš„å­—èŠ‚æ•°ï¼›å¦‚æœå·²åˆ°è¾¾æµç»“å°¾æ—¶ï¼Œåˆ™ä¸º 0ï¼ˆé›¶ï¼‰ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•ä»¥å¼‚æ­¥æ–¹å¼ä»æ–‡ä»¶è¯»å–ã€‚ è¯¥ç¤ºä¾‹ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> ç±»ï¼Œè¯¥ç±»æ´¾ç”Ÿè‡ª <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream?view=net-6.0">Stream</a> ç±»ã€‚</p>
<pre><code class="prism language-C#">using System;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.IO;

namespace WpfApplication1
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }

        private async void Button_Click(object sender, RoutedEventArgs e)
        {
            string filename = @"c:\Temp\userinputlog.txt";
            byte[] result;

            using (FileStream SourceStream = File.Open(filename, FileMode.Open))
            {
                result = new byte[SourceStream.Length];
                await SourceStream.ReadAsync(result, 0, (int)SourceStream.Length);
            }

            UserInput.Text = System.Text.Encoding.ASCII.GetString(result);
        }
    }
}
</code></pre>
<h5><a id="ReadByte__842"></a>ReadByte() ä»æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶å°†è¯»å–ä½ç½®æå‡ä¸€ä¸ªå­—èŠ‚</h5>
<pre><code class="prism language-C#">public override int ReadByte ();
</code></pre>
<p><strong>è¿”å›</strong></p>
<blockquote>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p>å¼ºåˆ¶è½¬æ¢ä¸º <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a> çš„å­—èŠ‚ï¼›æˆ–è€…å¦‚æœå·²åˆ°è¾¾æµçš„æœ«å°¾ï¼Œåˆ™ä¸º -1ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•æŒ‰å­—èŠ‚å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œç„¶åéªŒè¯æ˜¯å¦å·²æ­£ç¡®å†™å…¥æ•°æ®ã€‚</p>
<pre><code class="prism language-C#">using System;
using System.IO;

class FStream
{
    static void Main()
    {
        const string fileName = "Test#@@#.dat";

        // Create random data to write to the file.
        byte[] dataArray = new byte[100000];
        new Random().NextBytes(dataArray);

        using(FileStream
            fileStream = new FileStream(fileName, FileMode.Create))
        {
            // Write the data to the file, byte by byte.
            for(int i = 0; i &lt; dataArray.Length; i++)
            {
                fileStream.WriteByte(dataArray[i]);
            }

            // Set the stream position to the beginning of the file.
            fileStream.Seek(0, SeekOrigin.Begin);

            // Read and verify the data.
            for(int i = 0; i &lt; fileStream.Length; i++)
            {
                if(dataArray[i] != fileStream.ReadByte())
                {
                    Console.WriteLine("Error writing data.");
                    return;
                }
            }
            Console.WriteLine("The data was written to {0} " +
                "and verified.", fileStream.Name);
        }
    }
}
</code></pre>
<h5><a id="WriteByte_Int32_Int32__900"></a>Write(Byte[], Int32, Int32) å½“åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œå‘å½“å‰æµä¸­å†™å…¥å­—èŠ‚åºåˆ—ï¼Œå¹¶å°†æ­¤æµä¸­çš„å½“å‰ä½ç½®æå‡å†™å…¥çš„å­—èŠ‚æ•°</h5>
<pre><code class="prism language-C#">public abstract void Write (byte[] buffer, int offset, int count);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>buffer</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.byte?view=net-6.0">Byte</a>[]</p>
<p>å­—èŠ‚æ•°ç»„ã€‚ æ­¤æ–¹æ³•å°† <code>count</code> ä¸ªå­—èŠ‚ä» <code>buffer</code> å¤åˆ¶åˆ°å½“å‰æµã€‚</p>
<p><code>offset</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p><code>buffer</code> ä¸­çš„ä»é›¶å¼€å§‹çš„å­—èŠ‚åç§»é‡ï¼Œä»æ­¤å¤„å¼€å§‹å°†å­—èŠ‚å¤åˆ¶åˆ°å½“å‰æµã€‚</p>
<p><code>count</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p>è¦å†™å…¥å½“å‰æµçš„å­—èŠ‚æ•°ã€‚</p>
</blockquote>
<blockquote>
<p>ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.canwrite?view=net-6.0">CanWrite</a> å±æ€§ç¡®å®šå½“å‰å®ä¾‹æ˜¯å¦æ”¯æŒå†™å…¥ã€‚ ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.writeasync?view=net-6.0">WriteAsync</a> æ–¹æ³•å¼‚æ­¥å†™å…¥å½“å‰æµã€‚</p>
<p>å¦‚æœå†™å…¥æ“ä½œæˆåŠŸï¼Œåˆ™æµä¸­çš„ä½ç½®å°†æŒ‰å†™å…¥çš„å­—èŠ‚æ•°å‰è¿›ã€‚ å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™æµä¸­çš„ä½ç½®ä¿æŒä¸å˜ã€‚</p>
</blockquote>
<h5><a id="WriteAsyncByte_Int32_Int32__930"></a>WriteAsync(Byte[], Int32, Int32) å°†å­—èŠ‚åºåˆ—å¼‚æ­¥å†™å…¥å½“å‰æµï¼Œå¹¶å°†æµçš„å½“å‰ä½ç½®æå‡å†™å…¥çš„å­—èŠ‚æ•°</h5>
<pre><code class="prism language-C#">public System.Threading.Tasks.Task WriteAsync (byte[] buffer, int offset, int count);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>buffer</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.byte?view=net-6.0">Byte</a>[]</p>
<p>ä»ä¸­å†™å…¥æ•°æ®çš„ç¼“å†²åŒºã€‚</p>
<p><code>offset</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p><code>buffer</code> ä¸­çš„ä»é›¶å¼€å§‹çš„å­—èŠ‚åç§»é‡ï¼Œä»æ­¤å¤„å¼€å§‹å°†å­—èŠ‚å¤åˆ¶åˆ°è¯¥æµã€‚</p>
<p><code>count</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int32?view=net-6.0">Int32</a></p>
<p>æœ€å¤šå†™å…¥çš„å­—èŠ‚æ•°ã€‚</p>
</blockquote>
<p><strong>è¿”å›</strong></p>
<blockquote>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.tasks.task?view=net-6.0">Task</a></p>
<p>è¡¨ç¤ºå¼‚æ­¥å†™å…¥æ“ä½œçš„ä»»åŠ¡ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•å¼‚æ­¥å†™å…¥æ–‡ä»¶ã€‚ è¯¥ç¤ºä¾‹ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> ç±»ï¼Œè¯¥ç±»æ´¾ç”Ÿè‡ª <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream?view=net-6.0">Stream</a> ç±»ã€‚</p>
<pre><code class="prism language-C#">using System;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.IO;

namespace WpfApplication1
{
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();
        }

        private async void Button_Click(object sender, RoutedEventArgs e)
        {
            UnicodeEncoding uniencoding = new UnicodeEncoding();
            string filename = @"c:\Users\exampleuser\Documents\userinputlog.txt";

            byte[] result = uniencoding.GetBytes(UserInput.Text);

            using (FileStream SourceStream = File.Open(filename, FileMode.OpenOrCreate))
            {
                SourceStream.Seek(0, SeekOrigin.End);
                await SourceStream.WriteAsync(result, 0, result.Length);
            }
        }
    }
}
</code></pre>
<h5><a id="WriteByteByte__1000"></a>WriteByte(Byte) ä¸€ä¸ªå­—èŠ‚å†™å…¥æ–‡ä»¶æµä¸­çš„å½“å‰ä½ç½®</h5>
<pre><code class="prism language-C#">public override void WriteByte (byte value);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>value</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.byte?view=net-6.0">Byte</a></p>
<p>è¦å†™å…¥æµçš„å­—èŠ‚ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•å°†æ•°æ®ä»¥å­—èŠ‚å­—èŠ‚å½¢å¼å†™å…¥æ–‡ä»¶ï¼Œç„¶åéªŒè¯æ•°æ®æ˜¯å¦å†™å…¥æ­£ç¡®ã€‚</p>
<pre><code class="prism language-C#">using System;
using System.IO;

class FStream
{
    static void Main()
    {
        const string fileName = "Test#@@#.dat";

        // Create random data to write to the file.
        byte[] dataArray = new byte[100000];
        new Random().NextBytes(dataArray);

        using(FileStream
            fileStream = new FileStream(fileName, FileMode.Create))
        {
            // Write the data to the file, byte by byte.
            for(int i = 0; i &lt; dataArray.Length; i++)
            {
                fileStream.WriteByte(dataArray[i]);
            }

            // Set the stream position to the beginning of the file.
            fileStream.Seek(0, SeekOrigin.Begin);

            // Read and verify the data.
            for(int i = 0; i &lt; fileStream.Length; i++)
            {
                if(dataArray[i] != fileStream.ReadByte())
                {
                    Console.WriteLine("Error writing data.");
                    return;
                }
            }
            Console.WriteLine("The data was written to {0} " +
                "and verified.", fileStream.Name);
        }
    }
}
</code></pre>
<h5><a id="Flush__1060"></a>Flush() æ¸…é™¤æ­¤æµçš„ç¼“å†²åŒºï¼Œä½¿å¾—æ‰€æœ‰ç¼“å†²æ•°æ®éƒ½å†™å…¥åˆ°æ–‡ä»¶ä¸­</h5>
<pre><code class="prism language-C#">public override void Flush ();
</code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<p>æ­¤ä»£ç ç¤ºä¾‹æ˜¯ä¸º æ–¹æ³•æä¾›çš„è¾ƒå¤§ç¤ºä¾‹çš„ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.lock?view=net-6.0">Lock</a> ä¸€éƒ¨åˆ†ã€‚</p>
<pre><code class="prism language-C#">// Update the file.
case 'W':
    try
    {
        fileStream.Seek(textLength,
            SeekOrigin.Begin);
        fileStream.Read(
            readText, textLength - 1, byteCount);
        tempString = new String(
            uniEncoding.GetChars(
            readText, textLength - 1, byteCount));
        recordNumber = int.Parse(tempString) + 1;
        fileStream.Seek(
            textLength, SeekOrigin.Begin);
        fileStream.Write(uniEncoding.GetBytes(
            recordNumber.ToString()),
            0, byteCount);
        fileStream.Flush();
        Console.WriteLine(
            "Record has been updated.");
    }
</code></pre>
<blockquote>
<p>æ­¤æ–¹æ³•é‡å†™ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.flush?view=net-6.0">Stream.Flush</a>ã€‚</p>
<p>è°ƒç”¨ æ–¹æ³• <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.flush?view=net-6.0">FileStream.Flush</a> æ—¶ï¼Œä¹Ÿä¼šåˆ·æ–°æ“ä½œç³»ç»Ÿ I/O ç¼“å†²åŒºã€‚</p>
<p>é™¤éæ˜¾å¼è°ƒç”¨æˆ–é‡Šæ”¾ å¯¹è±¡ï¼Œå¦åˆ™ä¸ä¼šåˆ·æ–° <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.flush?view=net-6.0">Flush</a> æµçš„ç¼–ç å™¨ã€‚ è®¾ç½®ä¸º <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.streamwriter.autoflush?view=net-6.0">StreamWriter.AutoFlush</a> <code>true</code> è¡¨ç¤ºæ•°æ®ä»ç¼“å†²åŒºåˆ·æ–°åˆ°æµï¼Œä½†ä¸åˆ·æ–°ç¼–ç å™¨çŠ¶æ€ã€‚ è¿™å…è®¸ç¼–ç å™¨ä¿ç•™å…¶çŠ¶æ€ (éƒ¨åˆ†å­—ç¬¦) ä»¥ä¾¿å®ƒå¯ä»¥æ­£ç¡®ç¼–ç ä¸‹ä¸€ä¸ªå­—ç¬¦å—ã€‚ è¿™ç§æƒ…å†µä¼šå½±å“ UTF8 å’Œ UTF7ï¼Œå…¶ä¸­æŸäº›å­—ç¬¦åªèƒ½åœ¨ç¼–ç å™¨æ”¶åˆ°ç›¸é‚»å­—ç¬¦åè¿›è¡Œç¼–ç ã€‚</p>
<p>ç”±äºç¼“å†²åŒºå¯ç”¨äºè¯»å–æˆ–å†™å…¥ï¼Œ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.flush?view=net-6.0#system-io-filestream-flush">Flush()</a> å› æ­¤ æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<ul><li>ä»¥å‰å†™å…¥ç¼“å†²åŒºçš„ä»»ä½•æ•°æ®éƒ½å¤åˆ¶åˆ°æ–‡ä»¶ï¼Œå¹¶ä¸”ç¼“å†²åŒºè¢«æ¸…é™¤ï¼Œä½†ç¼–ç å™¨çŠ¶æ€é™¤å¤–ã€‚</li><li>å¦‚æœ ä¸º ä¸”æ•°æ®ä»¥å‰ä»æ–‡ä»¶å¤åˆ¶åˆ°ç¼“å†²åŒºè¿›è¡Œè¯»å–ï¼Œåˆ™æ–‡ä»¶ä¸­å½“å‰ä½ç½®å°†å‡å°‘ç¼“å†²åŒºä¸­æœªè¯» <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.bufferedstream.canseek?view=net-6.0">BufferedStream.CanSeek</a> <code>true</code> å­—èŠ‚æ•°ã€‚ ç„¶åæ¸…é™¤ç¼“å†²åŒºã€‚</li></ul>
</blockquote>
<h5><a id="FlushAsync__1105"></a>FlushAsync() å¼‚æ­¥æ¸…é™¤æ­¤æµçš„æ‰€æœ‰ç¼“å†²åŒºå¹¶å¯¼è‡´æ‰€æœ‰ç¼“å†²æ•°æ®éƒ½å†™å…¥åŸºç¡€è®¾å¤‡ä¸­</h5>
<pre><code class="prism language-C#">public System.Threading.Tasks.Task FlushAsync ();
</code></pre>
<p><strong>è¿”å›</strong></p>
<blockquote>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.threading.tasks.task?view=net-6.0">Task</a></p>
<p>è¡¨ç¤ºå¼‚æ­¥åˆ·æ–°æ“ä½œçš„ä»»åŠ¡ã€‚</p>
</blockquote>
<h5><a id="LockInt64_Int64__FileStream_1117"></a>Lock(Int64, Int64) é˜²æ­¢å…¶ä»–è¿›ç¨‹è¯»å–æˆ–å†™å…¥ FileStream</h5>
<pre><code class="prism language-C#">[System.Runtime.Versioning.UnsupportedOSPlatform("ios")]
[System.Runtime.Versioning.UnsupportedOSPlatform("macos")]
[System.Runtime.Versioning.UnsupportedOSPlatform("tvos")]
public virtual void Lock (long position, long length);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>position</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int64?view=net-6.0">Int64</a></p>
<p>è¦é”å®šçš„èŒƒå›´çš„èµ·å§‹å¤„ã€‚ æ­¤å‚æ•°çš„å€¼å¿…é¡»å¤§äºæˆ–ç­‰äºé›¶ (0)ã€‚</p>
<p><code>length</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int64?view=net-6.0">Int64</a></p>
<p>è¦é”å®šçš„èŒƒå›´ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•é”å®šæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œä»¥ä¾¿å¦ä¸€ä¸ªè¿›ç¨‹æ— æ³•è®¿é—®è¯¥æ–‡ä»¶çš„è¯¥éƒ¨åˆ†ï¼Œå³ä½¿å®ƒå…·æœ‰å¯¹æ–‡ä»¶çš„è¯»/å†™è®¿é—®æƒé™ã€‚ åœ¨ä¸åŒçš„å‘½ä»¤çª—å£ä¸­åŒæ—¶è¿è¡Œç¨‹åºï¼Œå¹¶ä½¿ç”¨ä¸åŒçš„æ§åˆ¶å°è¾“å…¥é€‰é¡¹è¿›è¡Œè°ƒæŸ¥ã€‚</p>
<pre><code class="prism language-C#">using System;
using System.IO;
using System.Text;

class FStreamLock
{
    static void Main()
    {
        UnicodeEncoding uniEncoding = new UnicodeEncoding();
        string lastRecordText =
            "The last processed record number was: ";
        int textLength = uniEncoding.GetByteCount(lastRecordText);
        int recordNumber = 13;
        int byteCount =
            uniEncoding.GetByteCount(recordNumber.ToString());
        string tempString;

        using(FileStream fileStream = new FileStream(
            "Test#@@#.dat", FileMode.OpenOrCreate,
            FileAccess.ReadWrite, FileShare.ReadWrite))
        {
            // Write the original file data.
            if(fileStream.Length == 0)
            {
                tempString =
                    lastRecordText + recordNumber.ToString();
                fileStream.Write(uniEncoding.GetBytes(tempString),
                    0, uniEncoding.GetByteCount(tempString));
            }

            // Allow the user to choose the operation.
            char consoleInput = 'R';
            byte[] readText = new byte[fileStream.Length];
            while(consoleInput != 'X')
            {
                Console.Write(
                    "\nEnter 'R' to read, 'W' to write, 'L' to " +
                    "lock, 'U' to unlock, anything else to exit: ");

                if((tempString = Console.ReadLine()).Length == 0)
                {
                    break;
                }
                consoleInput = char.ToUpper(tempString[0]);
                switch(consoleInput)
                {
                    // Read data from the file and
                    // write it to the console.
                    case 'R':
                        try
                        {
                            fileStream.Seek(0, SeekOrigin.Begin);
                            fileStream.Read(
                                readText, 0, (int)fileStream.Length);
                            tempString = new String(
                                uniEncoding.GetChars(
                                readText, 0, readText.Length));
                            Console.WriteLine(tempString);
                            recordNumber = int.Parse(
                                tempString.Substring(
                                tempString.IndexOf(':') + 2));
                        }

                        // Catch the IOException generated if the
                        // specified part of the file is locked.
                        catch(IOException e)
                        {
                            Console.WriteLine("{0}: The read " +
                                "operation could not be performed " +
                                "because the specified part of the " +
                                "file is locked.",
                                e.GetType().Name);
                        }
                        break;

                    // Update the file.
                    case 'W':
                        try
                        {
                            fileStream.Seek(textLength,
                                SeekOrigin.Begin);
                            fileStream.Read(
                                readText, textLength - 1, byteCount);
                            tempString = new String(
                                uniEncoding.GetChars(
                                readText, textLength - 1, byteCount));
                            recordNumber = int.Parse(tempString) + 1;
                            fileStream.Seek(
                                textLength, SeekOrigin.Begin);
                            fileStream.Write(uniEncoding.GetBytes(
                                recordNumber.ToString()),
                                0, byteCount);
                            fileStream.Flush();
                            Console.WriteLine(
                                "Record has been updated.");
                        }

                        // Catch the IOException generated if the
                        // specified part of the file is locked.
                        catch(IOException e)
                        {
                            Console.WriteLine(
                                "{0}: The write operation could not " +
                                "be performed because the specified " +
                                "part of the file is locked.",
                                e.GetType().Name);
                        }
                        break;

                    // Lock the specified part of the file.
                    case 'L':
                        try
                        {
                            fileStream.Lock(textLength - 1, byteCount);
                            Console.WriteLine("The specified part " +
                                "of file has been locked.");
                        }
                        catch(IOException e)
                        {
                            Console.WriteLine(
                                "{0}: The specified part of file is" +
                                " already locked.", e.GetType().Name);
                        }
                        break;

                    // Unlock the specified part of the file.
                    case 'U':
                        try
                        {
                            fileStream.Unlock(
                                textLength - 1, byteCount);
                            Console.WriteLine("The specified part " +
                                "of file has been unlocked.");
                        }
                        catch(IOException e)
                        {
                            Console.WriteLine(
                                "{0}: The specified part of file is " +
                                "not locked by the current process.",
                                e.GetType().Name);
                        }
                        break;

                    // Exit the program.
                    default:
                        consoleInput = 'X';
                        break;
                }
            }
        }
    }
}
</code></pre>
<h5><a id="UnlockInt64_Int64__1299"></a>Unlock(Int64, Int64) å…è®¸å…¶ä»–è¿›ç¨‹è®¿é—®ä»¥å‰é”å®šçš„æŸä¸ªæ–‡ä»¶çš„å…¨éƒ¨æˆ–éƒ¨åˆ†</h5>
<pre><code class="prism language-C#">[System.Runtime.Versioning.UnsupportedOSPlatform("ios")]
[System.Runtime.Versioning.UnsupportedOSPlatform("macos")]
[System.Runtime.Versioning.UnsupportedOSPlatform("tvos")]
public virtual void Unlock (long position, long length);
</code></pre>
<p><strong>å‚æ•°</strong></p>
<blockquote>
<p><code>position</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int64?view=net-6.0">Int64</a></p>
<p>è¦å–æ¶ˆé”å®šçš„èŒƒå›´çš„å¼€å§‹å¤„ã€‚</p>
<p><code>length</code></p>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.int64?view=net-6.0">Int64</a></p>
<p>è¦å–æ¶ˆé”å®šçš„èŒƒå›´ã€‚</p>
</blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<p>ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•é”å®šéƒ¨åˆ†æ–‡ä»¶ï¼Œä»¥ä¾¿å…¶ä»–è¿›ç¨‹å³ä½¿å¯¹æ–‡ä»¶å…·æœ‰è¯»/å†™è®¿é—®æƒé™ä¹Ÿæ— æ³•è®¿é—®è¯¥æ–‡ä»¶çš„è¯¥éƒ¨åˆ†ï¼Œç„¶åå¯¹è¯¥æ–‡ä»¶çš„æŒ‡å®šéƒ¨åˆ†è§£é™¤é”å®šã€‚ åœ¨ä¸åŒçš„å‘½ä»¤çª—å£ä¸­åŒæ—¶è¿è¡Œç¨‹åºï¼Œå¹¶ä½¿ç”¨ä¸åŒçš„æ§åˆ¶å°è¾“å…¥é€‰é¡¹è¿›è¡Œè°ƒæŸ¥ã€‚</p>
<pre><code class="prism language-C#">using System;
using System.IO;
using System.Text;

class FStreamLock
{
    static void Main()
    {
        UnicodeEncoding uniEncoding = new UnicodeEncoding();
        string lastRecordText =
            "The last processed record number was: ";
        int textLength = uniEncoding.GetByteCount(lastRecordText);
        int recordNumber = 13;
        int byteCount =
            uniEncoding.GetByteCount(recordNumber.ToString());
        string tempString;

        using(FileStream fileStream = new FileStream(
            "Test#@@#.dat", FileMode.OpenOrCreate,
            FileAccess.ReadWrite, FileShare.ReadWrite))
        {
            // Write the original file data.
            if(fileStream.Length == 0)
            {
                tempString =
                    lastRecordText + recordNumber.ToString();
                fileStream.Write(uniEncoding.GetBytes(tempString),
                    0, uniEncoding.GetByteCount(tempString));
            }

            // Allow the user to choose the operation.
            char consoleInput = 'R';
            byte[] readText = new byte[fileStream.Length];
            while(consoleInput != 'X')
            {
                Console.Write(
                    "\nEnter 'R' to read, 'W' to write, 'L' to " +
                    "lock, 'U' to unlock, anything else to exit: ");

                if((tempString = Console.ReadLine()).Length == 0)
                {
                    break;
                }
                consoleInput = char.ToUpper(tempString[0]);
                switch(consoleInput)
                {
                    // Read data from the file and
                    // write it to the console.
                    case 'R':
                        try
                        {
                            fileStream.Seek(0, SeekOrigin.Begin);
                            fileStream.Read(
                                readText, 0, (int)fileStream.Length);
                            tempString = new String(
                                uniEncoding.GetChars(
                                readText, 0, readText.Length));
                            Console.WriteLine(tempString);
                            recordNumber = int.Parse(
                                tempString.Substring(
                                tempString.IndexOf(':') + 2));
                        }

                        // Catch the IOException generated if the
                        // specified part of the file is locked.
                        catch(IOException e)
                        {
                            Console.WriteLine("{0}: The read " +
                                "operation could not be performed " +
                                "because the specified part of the " +
                                "file is locked.",
                                e.GetType().Name);
                        }
                        break;

                    // Update the file.
                    case 'W':
                        try
                        {
                            fileStream.Seek(textLength,
                                SeekOrigin.Begin);
                            fileStream.Read(
                                readText, textLength - 1, byteCount);
                            tempString = new String(
                                uniEncoding.GetChars(
                                readText, textLength - 1, byteCount));
                            recordNumber = int.Parse(tempString) + 1;
                            fileStream.Seek(
                                textLength, SeekOrigin.Begin);
                            fileStream.Write(uniEncoding.GetBytes(
                                recordNumber.ToString()),
                                0, byteCount);
                            fileStream.Flush();
                            Console.WriteLine(
                                "Record has been updated.");
                        }

                        // Catch the IOException generated if the
                        // specified part of the file is locked.
                        catch(IOException e)
                        {
                            Console.WriteLine(
                                "{0}: The write operation could not " +
                                "be performed because the specified " +
                                "part of the file is locked.",
                                e.GetType().Name);
                        }
                        break;

                    // Lock the specified part of the file.
                    case 'L':
                        try
                        {
                            fileStream.Lock(textLength - 1, byteCount);
                            Console.WriteLine("The specified part " +
                                "of file has been locked.");
                        }
                        catch(IOException e)
                        {
                            Console.WriteLine(
                                "{0}: The specified part of file is" +
                                " already locked.", e.GetType().Name);
                        }
                        break;

                    // Unlock the specified part of the file.
                    case 'U':
                        try
                        {
                            fileStream.Unlock(
                                textLength - 1, byteCount);
                            Console.WriteLine("The specified part " +
                                "of file has been unlocked.");
                        }
                        catch(IOException e)
                        {
                            Console.WriteLine(
                                "{0}: The specified part of file is " +
                                "not locked by the current process.",
                                e.GetType().Name);
                        }
                        break;

                    // Exit the program.
                    default:
                        consoleInput = 'X';
                        break;
                }
            }
        }
    }
}
</code></pre>
<h4><a id="__1481"></a>â™ æ³¨è§£</h4>
<p>ä½¿ç”¨ ç±»å¯ä»¥è¯»å–ã€å†™å…¥ã€æ‰“å¼€å’Œå…³é—­æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ï¼Œä»¥åŠæ“ä½œå…¶ä»–ä¸æ–‡ä»¶ç›¸å…³çš„æ“ä½œç³»ç»Ÿå¥æŸ„ï¼ŒåŒ…æ‹¬ç®¡é“ã€æ ‡å‡†è¾“å…¥å’Œ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> æ ‡å‡†è¾“å‡ºã€‚ å¯ä»¥ä½¿ç”¨ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.read?view=net-6.0">Read</a> <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.write?view=net-6.0">Write</a> ã€ã€ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.copyto?view=net-6.0">CopyTo</a> å’Œ æ–¹æ³•æ¥æ‰§è¡ŒåŒæ­¥æ“ä½œï¼Œæˆ–ä½¿ç”¨ ã€ã€ å’Œ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.flush?view=net-6.0">Flush</a> <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.readasync?view=net-6.0">ReadAsync</a> <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.writeasync?view=net-6.0">WriteAsync</a> <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.copytoasync?view=net-6.0">CopyToAsync</a> <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.flushasync?view=net-6.0">FlushAsync</a> æ–¹æ³•æ¥æ‰§è¡Œå¼‚æ­¥æ“ä½œã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<p>æ­¤ç±»å‹å®ç° <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.idisposable?view=net-6.0">IDisposable</a> æ¥å£ã€‚ åœ¨ä½¿ç”¨å®Œç±»å‹åï¼Œæ‚¨åº”ç›´æ¥æˆ–é—´æ¥é‡Šæ”¾ç±»å‹ã€‚ è‹¥è¦ç›´æ¥é‡Šæ”¾ç±»å‹ï¼Œè¯·åœ¨ <code>try</code>/<code>catch</code> å—ä¸­è°ƒç”¨å…¶ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.idisposable.dispose?view=net-6.0">Dispose</a> æ–¹æ³•ã€‚ è‹¥è¦é—´æ¥é‡Šæ”¾ç±»å‹ï¼Œè¯·ä½¿ç”¨ <code>using</code>ï¼ˆåœ¨ C# ä¸­ï¼‰æˆ– <code>Using</code>ï¼ˆåœ¨ Visual Basic ä¸­ï¼‰ç­‰è¯­è¨€æ„é€ ã€‚ æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.idisposable?view=net-6.0">IDisposable</a> æ¥å£ä¸»é¢˜ä¸­çš„â€œä½¿ç”¨å®ç° IDisposable çš„å¯¹è±¡â€ä¸€èŠ‚ã€‚</p>
</blockquote>
<p><a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.isasync?view=net-6.0">IsAsync</a>å±æ€§æ£€æµ‹æ–‡ä»¶å¥æŸ„æ˜¯å¦å·²å¼‚æ­¥æ‰“å¼€ã€‚ ä½¿ç”¨å…·æœ‰ ã€ æˆ– å‚æ•°çš„æ„é€ å‡½æ•°åˆ›å»º ç±»çš„å®ä¾‹æ—¶ï¼Œè¯· <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStream</a> <code>isAsync</code> <code>useAsync</code> æŒ‡å®š <code>options</code> æ­¤å€¼ã€‚ å½“ å±æ€§ä¸º <code>true</code> æ—¶ï¼Œæµåˆ©ç”¨é‡å çš„ I/O ä»¥å¼‚æ­¥æ–¹å¼æ‰§è¡Œæ–‡ä»¶æ“ä½œã€‚ ä½†æ˜¯ï¼Œ <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.isasync?view=net-6.0">IsAsync</a> å±æ€§ä¸ä¸€å®šè°ƒç”¨ <code>true</code> <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.readasync?view=net-6.0">ReadAsync</a> ã€ æˆ– <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.writeasync?view=net-6.0">WriteAsync</a> <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.stream.copytoasync?view=net-6.0">CopyToAsync</a> æ–¹æ³•ã€‚ å½“ å±æ€§ä¸º å¹¶ä¸”è°ƒç”¨å¼‚æ­¥è¯»å–å’Œå†™å…¥æ“ä½œæ—¶ï¼ŒUI çº¿ç¨‹ä»æœªè¢«é˜»æ­¢ï¼Œä½†å®é™… <a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream.isasync?view=net-6.0">IsAsync</a> <code>false</code> I/O æ“ä½œæ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚</p>
<h4><a id="__1493"></a>â™ æ›´å¤šæ–¹æ³•</h4>
<blockquote>
<p>æ›´å¤šæ–¹æ³•è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.io.filestream?view=net-6.0">FileStreamç±»</a>ã€‚</p>
</blockquote>
<hr/>
<blockquote>
<p>â­å†™åœ¨ç»“å°¾ï¼š</p>
<p>æ–‡ç« ä¸­å‡ºç°çš„ä»»ä½•é”™è¯¯è¯·å¤§å®¶æ‰¹è¯„æŒ‡å‡ºï¼Œä¸€å®šåŠæ—¶ä¿®æ”¹ã€‚</p>
<p>å¸Œæœ›å†™åœ¨è¿™é‡Œçš„å°ä¼™ä¼´èƒ½ç»™ä¸ª<strong>ä¸‰è¿æ”¯æŒ</strong>ï¼</p>
</blockquote>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>