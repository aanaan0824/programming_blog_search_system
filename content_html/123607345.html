<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>AVL树</h3>
<ul><li><a href="#_3">零、前言</a></li><li><a href="#AVL_7">一、AVL树的概念</a></li><li><a href="#AVL_34">二、AVL树结点定义</a></li><li><a href="#AVL_62">三、AVL树的插入</a></li><li><a href="#AVL_204">四、AVL树的旋转</a></li><li><ul><li><a href="#1_212">1、左单旋</a></li><li><a href="#2_280">2、右单旋</a></li><li><a href="#3_337">3、左右双旋</a></li><li><a href="#4_408">4、右左双旋</a></li><li><a href="#5_461">5、总结</a></li></ul>
</li><li><a href="#AVL_481">五、AVL树的验证</a></li><li><a href="#AVL_546">六、AVL树的性能</a></li></ul>
</div>
<p></p>
<h1><a id="_3"></a>零、前言</h1>
<blockquote>
<p>本章主要讲解map和set的底层结构平衡二叉搜索树的一种-AVL树的特性及其实现</p>
</blockquote>
<h1><a id="AVL_7"></a>一、AVL树的概念</h1>
<ul><li>引入：</li></ul>
<blockquote>
<ol><li> <p>map/multimap/set/multiset其底层都是按照二叉搜索树来实现的，但是二叉搜索树有其自身的缺陷</p> </li><li> <p>假如往树中插入的元素有序或者接近有序，二叉搜索树就会退化成单支树，时间复杂度会退化成O(N)</p> </li><li> <p>因此map、set等关联式容器的底层结构是对二叉树进行了平衡处理，即采用平衡树来实现</p> </li></ol>
</blockquote>
<ul><li>概念：</li></ul>
<blockquote>
<p>对于数据有序或接近有序二叉搜索树将退化为单支树的情况，两位俄罗斯的数学家G.M.Adelson-Velskii和E.M.Landis在1962年<br/> 发明了一种解决上述问题的方法：当向二叉搜索树中插入新结点后，如果能保证每个结点的左右子树高度之差的绝对值不超过1(需要对树中的结点进行调整)，即可降低树的高度，从而减少平均搜索长度。</p>
</blockquote>
<ul><li>一棵AVL树或者是空树或者是具有以下性质的二叉搜索树：</li></ul>
<blockquote>
<ol><li> <p>它的左右子树都是AVL</p> </li><li> <p>树左右子树高度之差(简称平衡因子)的绝对值不超过1(-1/0/1)</p> </li></ol>
</blockquote>
<ul><li>示图：</li></ul>
<img alt="image-20220225105330505" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202203092259230.png"/>
<blockquote>
<p>注：如果一棵二叉搜索树是高度可保持在1(-1/0/1)，则非常接近完全二叉树 ，搜索时间复杂度O(logN)</p>
</blockquote>
<h1><a id="AVL_34"></a>二、AVL树结点定义</h1>
<blockquote>
<p>为了方便找到子树对应的父亲节点，这里我们选择使用三叉链结构</p>
</blockquote>
<ul><li>代码实现：</li></ul>
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">AVLTreeNode</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//三叉链</span>
	AVLTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _left<span class="token punctuation">;</span>
	AVLTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _right<span class="token punctuation">;</span>
	AVLTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _parent<span class="token punctuation">;</span>
	
	<span class="token keyword">int</span> _bf<span class="token punctuation">;</span><span class="token comment">//平衡因子</span>
	T _kv<span class="token punctuation">;</span><span class="token comment">//T可以是key也可以是pair&lt;K,V&gt;类型便于封装成map或set</span>

	<span class="token function">AVLTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> t<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_bf</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_kv</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h1><a id="AVL_62"></a>三、AVL树的插入</h1>
<blockquote>
<p>AVL树就是在二叉搜索树的基础上引入了平衡因子，因此AVL树也可以看成是二叉搜索树</p>
</blockquote>
<ul><li>那么AVL树的插入过程：</li></ul>
<ol><li>首先按照二叉搜索树的方式插入新节点</li></ol>
<blockquote>
<ol><li>待插入结点的key值比当前结点小就插入到该结点的左子树</li><li>待插入结点的key值比当前结点大就插入到该结点的右子树</li><li>待插入结点的key值与当前结点的key值相等就插入失败</li></ol>
</blockquote>
<ul><li>示例：插入12</li></ul>
<img alt="AVL树插入1" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202203092304413.gif"/>
<ol start="2"><li>插入后则向上调整当前结点到根路径上祖先结点的平衡因子</li></ol>
<ul><li>示图：</li></ul>
<img alt="image-20220225202637653" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202203092304520.png"/>
<blockquote>
<p>平衡因子数值=右子树高度-左子树的高度</p>
</blockquote>
<ul><li>平衡因子更新规则：</li></ul>
<blockquote>
<p>1.如果新增结点在祖父节点的左子树中，则父节点平衡因子数值减1</p>
<p>2.如果新增结点在祖父节点的右子树中，则父节点平衡因子数值加1</p>
</blockquote>
<ul><li>平衡因子更新后处理规则：</li></ul>
<blockquote>
<p>1.更新后平衡因子为1或-1，那么说明该平衡因子更新前为0，子树的高度发生变化，则也会影响父亲结点的平衡因子，继续向上更新平衡因子</p>
<p>2.更新后平衡因子为0，那么说明该平衡因子更新前为1或-1，子树的高度未发生变化，则也不会影响父亲结点的平衡因子，停止向上更新平衡因子</p>
<p>3.更新后平衡因子为2或-2，那么当前子树不符合AVL树的规则，需要进行旋转子树进行调节高度</p>
</blockquote>
<blockquote>
<p>注：更新平衡因子之前，该树本身就满足AVL树的规则，平衡因子为1或0或-1</p>
</blockquote>
<ul><li>示图：</li></ul>
<img alt="image-20220225204001930" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202203092304171.png"/>
<p>实现代码：</p>
<pre><code class="prism language-cpp">pair<span class="token operator">&lt;</span>Node<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token comment">//空树的情况</span>
    <span class="token punctuation">{<!-- --></span>
        _root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>_root<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//插入需要链接父子节点，但是插入的位置是空节点，需要另一个指针记录父结点</span>
    Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">,</span> <span class="token operator">*</span>parent <span class="token operator">=</span> _root<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
            cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
            cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token comment">//找到了相同的</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//找到插入位置，创建链接节点</span>
    cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Node<span class="token operator">*</span> newnode <span class="token operator">=</span> cur<span class="token punctuation">;</span><span class="token comment">//记录新结点地址，便于返回</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

    <span class="token comment">//向上更新平衡因子</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">!=</span> _root<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_right <span class="token operator">==</span> cur<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parent<span class="token operator">-&gt;</span>_bf<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            parent<span class="token operator">-&gt;</span>_bf<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//子树高度不变，不影响上面路径的结点平衡因子</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//子树高度改变，继续向上更新节点平衡因子</span>
        <span class="token punctuation">{<!-- --></span>
            cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
            parent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//子树已经不平衡了,需要进行旋转处理</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//右单旋</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token comment">//左右双旋</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">RotateLR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//右单旋</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token comment">//右左双旋</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token function">RotateRL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token comment">//已经出错了</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>newnode<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="AVL_204"></a>四、AVL树的旋转</h1>
<blockquote>
<p>如果在一棵原本是平衡的AVL树中插入一个新节点，可能造成不平衡，此时必须调整树的结构，使之平衡</p>
</blockquote>
<ul><li>根据节点插入位置的不同，AVL树的旋转分为四种：</li></ul>
<ol><li>新节点插入较高右子树的右侧—右右：左单旋</li></ol>
<h2><a id="1_212"></a>1、左单旋</h2>
<ul><li>抽象示图：</li></ul>
<img alt="image-20220225212422386" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202202261620243.png"/>
<ul><li>注意：</li></ul>
<blockquote>
<ol><li>上图在插入前AVL树是平衡的，新节点插入到60的右子树(注意：此处不是有孩子)中，60右子树增加了一层，导致以30为根的二叉树不平衡</li><li>要让30平衡，只能将30右子树的高度减少一层，左子树增加一层，即将右子树往上提，这样30转下来，因为30比60大=小，只能将其放在60的左子树，而如果60有左子树，左子树根的值一定大于30，小于60，只能将其放在30的右子树，旋转完成后，更新节点的平衡因子即可</li><li>对于a,b,c都是符合AVL树且高度为h的树的一种，这里不具体表示，以抽象表示各种情况，对于以下抽象图示也是如此</li></ol>
</blockquote>
<ul><li>在旋转过程中，有以下几种情况需要考虑：</li></ul>
<blockquote>
<ol><li> <p>60节点的左孩子可能存在，也可能不存在</p> </li><li> <p>30可能是根节点，也可能是子树：如果是根节点，旋转完成后，要更新根节点；如果是子树，可能是某个节点的左子树，也可能是右子树，需要更新父结点的左右结点地址</p> </li><li> <p>旋转后，子树得到平衡，两个旋转结点的平衡因子更新为0，而高度没有改变，不用再向上更新结点平衡因子</p> </li></ol>
</blockquote>
<ul><li>实例示图：</li></ul>
<img alt="AVL树左单旋" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202202252113981.gif"/>
<ul><li>实现代码：</li></ul>
<pre><code class="prism language-cpp"><span class="token comment">// 左单旋</span>
<span class="token keyword">void</span> <span class="token function">RotateL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//记录节点信息</span>
    Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
    Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
    Node<span class="token operator">*</span> parentP <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>

    <span class="token comment">//修改链接关系</span>
    parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subRL<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subRL<span class="token punctuation">)</span><span class="token comment">//避免为空节点的情况</span>
        subRL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

    subR<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> parent<span class="token punctuation">;</span>
    parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subR<span class="token punctuation">;</span>

    <span class="token comment">//讨论父节点的情况</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _root <span class="token operator">=</span> subR<span class="token punctuation">;</span>
        subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parentP<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parentP<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subR<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            parentP<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subR<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parentP<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//更新平衡因子</span>
    subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="2"><li>新节点插入较高左子树的左侧—左左：右单旋</li></ol>
<h2><a id="2_280"></a>2、右单旋</h2>
<blockquote>
<p>注：具体思路和步骤可以参考左单旋</p>
</blockquote>
<ul><li>抽象示图：</li></ul>
<img alt="image-20220225222328812" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202202252223863.png"/>
<ul><li>实例示图：</li></ul>
<img alt="AVL树右单旋" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202202252232415.gif"/>
<ul><li>实现代码：</li></ul>
<pre><code class="prism language-cpp"><span class="token comment">// 右单旋</span>
<span class="token keyword">void</span> <span class="token function">RotateR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//记录节点信息</span>
    Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
    Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
    Node<span class="token operator">*</span> parentP <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>

    <span class="token comment">//修改链接关系</span>
    parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subLR<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>subLR<span class="token punctuation">)</span><span class="token comment">//避免为空节点的情况</span>
        subLR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

    subL<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> parent<span class="token punctuation">;</span>
    parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subL<span class="token punctuation">;</span>

    <span class="token comment">//讨论父节点的情况</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _root <span class="token operator">=</span> subL<span class="token punctuation">;</span>
        subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parentP<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            parentP<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subL<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            parentP<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subL<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parentP<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//更新平衡因子</span>
    subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="3"><li>新节点插入较高左子树的右侧**—**左右：先左单旋再右单旋</li></ol>
<h2><a id="3_337"></a>3、左右双旋</h2>
<ul><li>抽象示图：</li></ul>
<img alt="image-20220226162227497" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202202261622554.png"/>
<ul><li>注意：</li></ul>
<blockquote>
<ol><li> <p>将双旋变成单旋后再旋转，即先对30进行左单旋，然后再对90进行右单旋，旋转完成后再考虑平衡因子的更新（并不都为0，具体情况具体分析）</p> </li><li> <p>复用单旋会把其他情况都给处理，例如子树是否为空，当前不平衡结点为根结点还是子树结点</p> </li><li> <p>对于h高度的子树，h满足大于等于0，当h=0时，插入新节点就是60</p> </li><li> <p>左右双旋可以看做是60做当前树的根结点，并将左子树给给30结点，将右子树给给90结点</p> </li></ol>
</blockquote>
<ul><li>旋转后更新平衡因子具有三种情况：</li></ul>
<blockquote>
<ol><li> <p>插入结点就是不平衡结点的subLR（左子结点的右子结点），30,60,90都更新为0</p> </li><li> <p>插入结点为不平衡结点的subLR的左子结点，30,60更新为0，90更新为1</p> </li><li> <p>插入结点就是不平衡结点的subLR的右子节点，90,60更新为0，30更新为-1</p> </li></ol>
</blockquote>
<ul><li>实例示图：h为0的情况</li></ul>
<img alt="AVL左右双旋" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202202261627365.gif"/>
<ul><li>实现代码：</li></ul>
<pre><code class="prism language-cpp"><span class="token comment">// 左右双旋</span>
<span class="token keyword">void</span> <span class="token function">RotateLR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//记录节点地址和平衡因子</span>
    Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
    Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

    <span class="token keyword">int</span> bf <span class="token operator">=</span> subLR<span class="token operator">-&gt;</span>_bf<span class="token punctuation">;</span>
    <span class="token comment">//旋转</span>
    <span class="token function">RotateL</span><span class="token punctuation">(</span>subL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//处理平衡因子</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//新增节点为subLR的左子树</span>
    <span class="token punctuation">{<!-- --></span>
        subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//新增节点为subRL的右子树</span>
    <span class="token punctuation">{<!-- --></span>
        subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//新增节点就是subRL</span>
    <span class="token punctuation">{<!-- --></span>
        subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token comment">//旋转之前就已经存在错误了</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="4"><li>新节点插入较高右子树的左侧**—**右左：先右单旋再左单旋</li></ol>
<h2><a id="4_408"></a>4、右左双旋</h2>
<ul><li>抽象示图：</li></ul>
<img alt="image-20220226165650282" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202202261656347.png"/>
<blockquote>
<p>注：具体情况可以参考左右双旋</p>
</blockquote>
<ul><li>实例示图：</li></ul>
<img alt="AVL右左双旋" src="https://typoracole.oss-cn-guangzhou.aliyuncs.com/blogimage-master/blogimage-master/https_/gitee.com/zheng-guijun/blogimage/202202261704947.gif"/>
<ul><li>实现代码：</li></ul>
<pre><code class="prism language-cpp"><span class="token comment">// 右左双旋</span>
<span class="token keyword">void</span> <span class="token function">RotateRL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//记录节点地址和平衡因子</span>
    Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
    Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

    <span class="token keyword">int</span> bf <span class="token operator">=</span> subRL<span class="token operator">-&gt;</span>_bf<span class="token punctuation">;</span>
    <span class="token comment">//旋转</span>
    <span class="token function">RotateR</span><span class="token punctuation">(</span>subR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//处理平衡因子</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//新增节点为subLR的左子树</span>
    <span class="token punctuation">{<!-- --></span>
        subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//新增节点为subLR的右子树</span>
    <span class="token punctuation">{<!-- --></span>
        subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//新增节点就是subLR</span>
    <span class="token punctuation">{<!-- --></span>
        subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token comment">//旋转之前就已经存在错误了</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="5_461"></a>5、总结</h2>
<ul><li>假如以pParent为根的子树不平衡，即pParent的平衡因子为2或者-2，分以下情况考虑：</li></ul>
<ol><li>pParent的平衡因子为2，说明pParent的右子树高，设pParent的右子树的根为pSubR</li></ol>
<blockquote>
<ol><li> <p>当SubR的平衡因子为1时，执行左单旋</p> </li><li> <p>当SubR的平衡因子为-1时，执行右左双旋</p> </li></ol>
</blockquote>
<ol start="2"><li>pParent的平衡因子为-2，说明pParent的左子树高，设pParent的左子树的根为pSubL</li></ol>
<blockquote>
<ol><li> <p>当SubL的平衡因子为-1是，执行右单旋</p> </li><li> <p>当SubL的平衡因子为1时，执行左右双旋</p> </li></ol>
</blockquote>
<blockquote>
<p>从视角上来看，当旋转相关结点成直线，则进行单旋；当旋转相关结点成折线，则进行双旋</p>
</blockquote>
<blockquote>
<p>旋转完成后，原pParent为根的子树个高度降低，已经平衡，不需要再向上更新</p>
</blockquote>
<h1><a id="AVL_481"></a>五、AVL树的验证</h1>
<blockquote>
<p>AVL树是在二叉搜索树的基础上加入了平衡性的限制</p>
</blockquote>
<ul><li>要验证AVL树可以分两步：</li></ul>
<ol><li>验证其为二叉搜索树</li></ol>
<blockquote>
<p>如果中序遍历可得到一个有序的序列，就说明为二叉搜索树</p>
</blockquote>
<ul><li>实现代码：</li></ul>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">_InOrder</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token function">_InOrder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">" : "</span> <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>second <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token function">_InOrder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="2"><li>验证其为平衡树</li></ol>
<blockquote>
<p>每个结点子树高度差的绝对值不超过1(注意结点中如果没有平衡因子)以及结点的平衡因子是否计算正确</p>
</blockquote>
<ul><li>实现代码：</li></ul>
<pre><code class="prism language-cpp"><span class="token comment">//验证pRoot是否为有效的AVL树</span>
<span class="token keyword">bool</span> <span class="token function">_IsAVLTree</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//空树</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token comment">//比较高度</span>
    <span class="token keyword">int</span> heightL <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> heightR <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//检查平衡因子是否有误</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>heightR <span class="token operator">-</span> heightL <span class="token operator">!=</span> root<span class="token operator">-&gt;</span>_bf<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"平衡因子错误："</span> <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">abs</span><span class="token punctuation">(</span>heightR <span class="token operator">-</span> heightL<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span>
        <span class="token operator">&amp;&amp;</span> <span class="token function">_IsAVLTree</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
        <span class="token operator">&amp;&amp;</span> <span class="token function">_IsAVLTree</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//递归检查左右子树</span>
<span class="token punctuation">}</span>
<span class="token comment">//高度</span>
size_t <span class="token function">_Height</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//空节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    size_t left <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    size_t right <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> left <span class="token operator">&gt;</span> right <span class="token operator">?</span> left <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="AVL_546"></a>六、AVL树的性能</h1>
<ul><li>分析：</li></ul>
<blockquote>
<ol><li> <p>AVL树是一棵绝对平衡的二叉搜索树，其要求每个节点的左右子树高度差的绝对值都不超过1，这样可以保证查询时高效的时间复杂度logN</p> </li><li> <p>但是如果要对AVL树做一些结构修改的操作，性能非常低下，比如：插入时要维护其绝对平衡，旋转的次数比较多，更差的是在删除时，有可能一直要让旋转持续到根的位置</p> </li></ol>
</blockquote>
<ul><li>总结：</li></ul>
<blockquote>
<p>如果需要一种查询高效且有序的数据结构，而且数据的个数为静态的(即不会改变)，可以考虑AVL树，但一个结构经常修改，就不太适合</p>
</blockquote>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>