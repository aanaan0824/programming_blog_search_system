<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h3><a id="_0"></a>前言</h3>
<p>最近在网上看到一个有意思的开源项目，基于快手团队开发的开源AI斗地主——DouZero做的一个“成熟”的AI，项目开源地址<a href="https://github.com/tianqiraf/DouZero_For_HappyDouDiZhu">【https://github.com/tianqiraf/DouZero_For_HappyDouDiZhu – tianqiraf】</a>。</p>
<p>今天我们就一起来学习下是如何制作一个基于DouZero的出牌器，看看AI是如何来帮助斗地主的！</p>
<h3><a id="_5"></a>一、核心功能设计</h3>
<p>首先这款出牌器是基于<font color="red" size="4">DouZero</font>开发的，核心是需要利用训练好的AI模型来帮住我们，给出最优出牌方案。</p>
<p>其次关于出牌器，先要需要确认<font color="red" size="4">一个AI出牌角色</font>，代表我们玩家自己。我们只要给这个AI输入玩家手牌和三张底牌。确认好地主和农民的各个角色，告诉它三个人对应的关系，这样就可以确定队友和对手。</p>
<p>我们还要将每一轮其他两人的出牌输入，这样出牌器就可以根据出牌数据，及时提供给我们<font color="red" size="4">最优出牌决策</font>，带领我们取得胜利！</p>
<p>那么如何获取三者之间的关系呢？谁是地主？谁是农民？是自己一人作战还是农民合作？自己玩家的手牌是什么？三张底牌是什么？这些也都需要在开局后确认好。</p>
<p>大致可以整理出要实现的核心功能如下：</p>
<ul><li> <p><strong>UI设计排版布局</strong></p>
<ul><li>显示三张底牌</li><li>显示AI角色出牌数据区域，上家出牌数据区域，下家出牌数据区域，本局胜率区域</li><li>AI玩家手牌区域</li><li>AI出牌器开始停止</li></ul> </li><li> <p><strong>手牌和出牌数据识别</strong></p>
<ul><li>游戏刚开始根据屏幕位置，截图识别AI玩家手牌及三张底牌</li><li>确认三者之间的关系，识别地主和农民角色，确认队友及对手关系</li><li>识别每轮三位玩家依次出了什么牌，刷新显示对应区域</li></ul> </li><li> <p><strong>AI出牌方案输出</strong></p>
<ul><li>加载训练好的AI模型，初始化游戏环境</li><li>每轮出牌判断，根据上家出牌数据给出最优出牌决策</li><li>自动刷新玩家剩余手牌和本局胜率预测</li></ul> </li></ul>
<h3><a id="_33"></a>二、实现步骤</h3>
<h4><a id="1_UI_34"></a>1. UI设计排版布局</h4>
<p>根据上述功能，首先考虑进行简单的<font color="red" size="4">UI布局设计</font>，使用的是<font color="red" size="4"><strong>pyqt5</strong></font>。核心设计代码如下：</p>
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">setupUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Form<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">)</span>
    Form<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">395</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Arial"</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setBold<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setItalic<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setWeight<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span>
    Form<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>WinRate <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>WinRate<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>WinRate<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>WinRate<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>WinRate<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"WinRate"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>InitCard <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>InitCard<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">330</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Arial"</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setBold<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setWeight<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>InitCard<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>InitCard<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>InitCard<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"InitCard"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>UserHandCards <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>UserHandCards<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">260</span><span class="token punctuation">,</span> <span class="token number">421</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>UserHandCards<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>UserHandCards<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>UserHandCards<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"UserHandCards"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayer <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayer<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayer<span class="token punctuation">.</span>setFrameShape<span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">.</span>StyledPanel<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayer<span class="token punctuation">.</span>setFrameShadow<span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">.</span>Raised<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayer<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"LPlayer"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayedCard <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LPlayer<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayedCard<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayedCard<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayedCard<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayedCard<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"LPlayedCard"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayer <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayer<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">230</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayer<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayer<span class="token punctuation">.</span>setFrameShape<span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">.</span>StyledPanel<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayer<span class="token punctuation">.</span>setFrameShadow<span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">.</span>Raised<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayer<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"RPlayer"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayedCard <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>RPlayer<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayedCard<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">201</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayedCard<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayedCard<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayedCard<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"RPlayedCard"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Player <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Player<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Player<span class="token punctuation">.</span>setFrameShape<span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">.</span>StyledPanel<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Player<span class="token punctuation">.</span>setFrameShadow<span class="token punctuation">(</span>QtWidgets<span class="token punctuation">.</span>QFrame<span class="token punctuation">.</span>Raised<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Player<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"Player"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>PredictedCard <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Player<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>PredictedCard<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>PredictedCard<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>PredictedCard<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>PredictedCard<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"PredictedCard"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ThreeLandlordCards <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QLabel<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ThreeLandlordCards<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ThreeLandlordCards<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ThreeLandlordCards<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ThreeLandlordCards<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"ThreeLandlordCards"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Stop <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QPushButton<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Stop<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">260</span><span class="token punctuation">,</span> <span class="token number">330</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    font <span class="token operator">=</span> QtGui<span class="token punctuation">.</span>QFont<span class="token punctuation">(</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setFamily<span class="token punctuation">(</span><span class="token string">"Arial"</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setPointSize<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setBold<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    font<span class="token punctuation">.</span>setWeight<span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Stop<span class="token punctuation">.</span>setFont<span class="token punctuation">(</span>font<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Stop<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Stop<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"Stop"</span><span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>retranslateUi<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>InitCard<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>Form<span class="token punctuation">.</span>init_cards<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Stop<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>Form<span class="token punctuation">.</span>stop<span class="token punctuation">)</span>
    QtCore<span class="token punctuation">.</span>QMetaObject<span class="token punctuation">.</span>connectSlotsByName<span class="token punctuation">(</span>Form<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">retranslateUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Form<span class="token punctuation">)</span><span class="token punctuation">:</span>
    _translate <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QCoreApplication<span class="token punctuation">.</span>translate
    Form<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"AI欢乐斗地主--Dragon少年"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>WinRate<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"胜率：--%"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>InitCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"开始"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>UserHandCards<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"手牌"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>LPlayedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"上家出牌区域"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>RPlayedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"下家出牌区域"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>PredictedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"AI出牌区域"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ThreeLandlordCards<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"三张底牌"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Stop<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"Form"</span><span class="token punctuation">,</span> <span class="token string">"停止"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h4><a id="2__147"></a>2. 手牌和出牌数据识别</h4>
<p>接下来需要<font color="red" size="4"><strong>所有扑克牌的模板图片与游戏屏幕特定区域的截图进行对比</strong></font>，这样才能获取AI玩家手牌、底牌、每一轮出牌、三者关系（地主、地主上家、地主下家）。</p>
<p><strong>识别AI玩家手牌及三张底牌：</strong></p>
<p>我们可以截取游戏屏幕，根据固定位置来识别当前AI玩家的手牌和三张底牌。核心代码如下：</p>
<pre><code class="prism language-python"><span class="token comment"># 牌检测结果滤波</span>
<span class="token keyword">def</span> <span class="token function">cards_filter</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> location<span class="token punctuation">,</span> distance<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    locList <span class="token operator">=</span> <span class="token punctuation">[</span>location<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    count <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> e <span class="token keyword">in</span> location<span class="token punctuation">:</span>
        flag <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># “是新的”标志</span>
        <span class="token keyword">for</span> have <span class="token keyword">in</span> locList<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> have<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> distance<span class="token punctuation">:</span>
                flag <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> flag<span class="token punctuation">:</span>
            count <span class="token operator">+=</span> <span class="token number">1</span>
            locList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> count

<span class="token comment"># 获取玩家AI手牌</span>
<span class="token keyword">def</span> <span class="token function">find_my_cards</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
    user_hand_cards_real <span class="token operator">=</span> <span class="token string">""</span>
    img <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span>region<span class="token operator">=</span>pos<span class="token punctuation">)</span>
    <span class="token keyword">for</span> card <span class="token keyword">in</span> AllCards<span class="token punctuation">:</span>
        result <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateAll<span class="token punctuation">(</span>needleImage<span class="token operator">=</span><span class="token string">'pics/m'</span> <span class="token operator">+</span> card <span class="token operator">+</span> <span class="token string">'.png'</span><span class="token punctuation">,</span> haystackImage<span class="token operator">=</span>img<span class="token punctuation">,</span> confidence<span class="token operator">=</span>self<span class="token punctuation">.</span>MyConfidence<span class="token punctuation">)</span>
        user_hand_cards_real <span class="token operator">+=</span> card<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>cards_filter<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>MyFilter<span class="token punctuation">)</span>
    <span class="token keyword">return</span> user_hand_cards_real

<span class="token comment"># 获取地主三张底牌</span>
<span class="token keyword">def</span> <span class="token function">find_three_landlord_cards</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
    three_landlord_cards_real <span class="token operator">=</span> <span class="token string">""</span>
    img <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span>region<span class="token operator">=</span>pos<span class="token punctuation">)</span>
    img <span class="token operator">=</span> img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">349</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> card <span class="token keyword">in</span> AllCards<span class="token punctuation">:</span>
        result <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateAll<span class="token punctuation">(</span>needleImage<span class="token operator">=</span><span class="token string">'pics/o'</span> <span class="token operator">+</span> card <span class="token operator">+</span> <span class="token string">'.png'</span><span class="token punctuation">,</span> haystackImage<span class="token operator">=</span>img<span class="token punctuation">,</span>
                                     confidence<span class="token operator">=</span>self<span class="token punctuation">.</span>ThreeLandlordCardsConfidence<span class="token punctuation">)</span>
        three_landlord_cards_real <span class="token operator">+=</span> card<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>cards_filter<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>OtherFilter<span class="token punctuation">)</span>
    <span class="token keyword">return</span> three_landlord_cards_real

</code></pre>
<p>效果如下所示：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ec547fd990f444f38a4c12e5dfd3bd56.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hobGFkbWluaGhs,size_16,color_FFFFFF,t_70"/></p>
<p><strong>地主、地主上家、地主下家：</strong></p>
<p>同理我们可以根据游戏屏幕截图，识别地主的图标，确认地主角色。核心代码如下：</p>
<pre><code class="prism language-python"><span class="token comment"># 查找地主角色</span>
<span class="token keyword">def</span> <span class="token function">find_landlord</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> landlord_flag_pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> pos <span class="token keyword">in</span> landlord_flag_pos<span class="token punctuation">:</span>
        result <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'pics/landlord_words.png'</span><span class="token punctuation">,</span> region<span class="token operator">=</span>pos<span class="token punctuation">,</span> confidence<span class="token operator">=</span>self<span class="token punctuation">.</span>LandlordFlagConfidence<span class="token punctuation">)</span>
        <span class="token keyword">if</span> result <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> landlord_flag_pos<span class="token punctuation">.</span>index<span class="token punctuation">(</span>pos<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre>
<p>这样我们就可以得到玩家AI手牌，其他玩家手牌（预测），地主三张底牌，三者角色关系，出牌顺序。核心代码如下：</p>
<pre><code class="prism language-python"><span class="token comment"># 坐标</span>
self<span class="token punctuation">.</span>MyHandCardsPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">414</span><span class="token punctuation">,</span> <span class="token number">804</span><span class="token punctuation">,</span> <span class="token number">1041</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>  <span class="token comment"># AI玩家截图区域</span>
self<span class="token punctuation">.</span>LPlayedCardsPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">530</span><span class="token punctuation">,</span> <span class="token number">470</span><span class="token punctuation">,</span> <span class="token number">380</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">)</span>  <span class="token comment"># 左侧玩家截图区域</span>
self<span class="token punctuation">.</span>RPlayedCardsPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1010</span><span class="token punctuation">,</span> <span class="token number">470</span><span class="token punctuation">,</span> <span class="token number">380</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">)</span>  <span class="token comment"># 右侧玩家截图区域</span>
self<span class="token punctuation">.</span>LandlordFlagPos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1320</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 地主标志截图区域(右-我-左)</span>
self<span class="token punctuation">.</span>ThreeLandlordCardsPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">817</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">287</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">)</span>      <span class="token comment"># 地主底牌截图区域，resize成349x168</span>

<span class="token keyword">def</span> <span class="token function">init_cards</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 玩家手牌</span>
    self<span class="token punctuation">.</span>user_hand_cards_real <span class="token operator">=</span> <span class="token string">""</span>
    self<span class="token punctuation">.</span>user_hand_cards_env <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 其他玩家出牌</span>
    self<span class="token punctuation">.</span>other_played_cards_real <span class="token operator">=</span> <span class="token string">""</span>
    self<span class="token punctuation">.</span>other_played_cards_env <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 其他玩家手牌（整副牌减去玩家手牌，后续再减掉历史出牌）</span>
    self<span class="token punctuation">.</span>other_hand_cards <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 三张底牌</span>
    self<span class="token punctuation">.</span>three_landlord_cards_real <span class="token operator">=</span> <span class="token string">""</span>
    self<span class="token punctuation">.</span>three_landlord_cards_env <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 玩家角色代码：0-地主上家, 1-地主, 2-地主下家</span>
    self<span class="token punctuation">.</span>user_position_code <span class="token operator">=</span> <span class="token boolean">None</span>
    self<span class="token punctuation">.</span>user_position <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token comment"># 开局时三个玩家的手牌</span>
    self<span class="token punctuation">.</span>card_play_data_list <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token comment"># 出牌顺序：0-玩家出牌, 1-玩家下家出牌, 2-玩家上家出牌</span>
    self<span class="token punctuation">.</span>play_order <span class="token operator">=</span> <span class="token number">0</span>
    self<span class="token punctuation">.</span>env <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token comment"># 识别玩家手牌</span>
    self<span class="token punctuation">.</span>user_hand_cards_real <span class="token operator">=</span> self<span class="token punctuation">.</span>find_my_cards<span class="token punctuation">(</span>self<span class="token punctuation">.</span>MyHandCardsPos<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>UserHandCards<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_hand_cards_real<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>user_hand_cards_env <span class="token operator">=</span> <span class="token punctuation">[</span>RealCard2EnvCard<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_hand_cards_real<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 识别三张底牌</span>
    self<span class="token punctuation">.</span>three_landlord_cards_real <span class="token operator">=</span> self<span class="token punctuation">.</span>find_three_landlord_cards<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ThreeLandlordCardsPos<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ThreeLandlordCards<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"底牌："</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>three_landlord_cards_real<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>three_landlord_cards_env <span class="token operator">=</span> <span class="token punctuation">[</span>RealCard2EnvCard<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>three_landlord_cards_real<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 识别玩家的角色</span>
    self<span class="token punctuation">.</span>user_position_code <span class="token operator">=</span> self<span class="token punctuation">.</span>find_landlord<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LandlordFlagPos<span class="token punctuation">)</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>user_position_code <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        items <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"地主上家"</span><span class="token punctuation">,</span> <span class="token string">"地主"</span><span class="token punctuation">,</span> <span class="token string">"地主下家"</span><span class="token punctuation">)</span>
        item<span class="token punctuation">,</span> okPressed <span class="token operator">=</span> QInputDialog<span class="token punctuation">.</span>getItem<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"选择角色"</span><span class="token punctuation">,</span> <span class="token string">"未识别到地主，请手动选择角色:"</span><span class="token punctuation">,</span> items<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> okPressed <span class="token keyword">and</span> item<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>user_position_code <span class="token operator">=</span> items<span class="token punctuation">.</span>index<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span>
    self<span class="token punctuation">.</span>user_position <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'landlord_up'</span><span class="token punctuation">,</span> <span class="token string">'landlord'</span><span class="token punctuation">,</span> <span class="token string">'landlord_down'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>user_position_code<span class="token punctuation">]</span>
    <span class="token keyword">for</span> player <span class="token keyword">in</span> self<span class="token punctuation">.</span>Players<span class="token punctuation">:</span>
        player<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token string">'background-color: rgba(255, 0, 0, 0);'</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Players<span class="token punctuation">[</span>self<span class="token punctuation">.</span>user_position_code<span class="token punctuation">]</span><span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token string">'background-color: rgba(255, 0, 0, 0.1);'</span><span class="token punctuation">)</span>

    <span class="token comment"># 整副牌减去玩家手上的牌，就是其他人的手牌,再分配给另外两个角色（如何分配对AI判断没有影响）</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">set</span><span class="token punctuation">(</span>AllEnvCard<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>other_hand_cards<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>AllEnvCard<span class="token punctuation">.</span>count<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>user_hand_cards_env<span class="token punctuation">.</span>count<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>card_play_data_list<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">'three_landlord_cards'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>three_landlord_cards_env<span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'landlord_up'</span><span class="token punctuation">,</span> <span class="token string">'landlord'</span><span class="token punctuation">,</span> <span class="token string">'landlord_down'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position_code <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>user_hand_cards_env<span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'landlord_up'</span><span class="token punctuation">,</span> <span class="token string">'landlord'</span><span class="token punctuation">,</span> <span class="token string">'landlord_down'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position_code <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>other_hand_cards<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position_code <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token keyword">else</span> self<span class="token punctuation">.</span>other_hand_cards<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'landlord_up'</span><span class="token punctuation">,</span> <span class="token string">'landlord'</span><span class="token punctuation">,</span> <span class="token string">'landlord_down'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position_code <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>other_hand_cards<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position_code <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">else</span> self<span class="token punctuation">.</span>other_hand_cards<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>card_play_data_list<span class="token punctuation">)</span>
    <span class="token comment"># 生成手牌结束，校验手牌数量</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>card_play_data_list<span class="token punctuation">[</span><span class="token string">"three_landlord_cards"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">:</span>
        QMessageBox<span class="token punctuation">.</span>critical<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"底牌识别出错"</span><span class="token punctuation">,</span> <span class="token string">"底牌必须是3张！"</span><span class="token punctuation">,</span> QMessageBox<span class="token punctuation">.</span>Yes<span class="token punctuation">,</span> QMessageBox<span class="token punctuation">.</span>Yes<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>init_display<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>card_play_data_list<span class="token punctuation">[</span><span class="token string">"landlord_up"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">17</span> <span class="token keyword">or</span> \
        <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>card_play_data_list<span class="token punctuation">[</span><span class="token string">"landlord_down"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">17</span> <span class="token keyword">or</span> \
        <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>card_play_data_list<span class="token punctuation">[</span><span class="token string">"landlord"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">20</span><span class="token punctuation">:</span>
        QMessageBox<span class="token punctuation">.</span>critical<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"手牌识别出错"</span><span class="token punctuation">,</span> <span class="token string">"初始手牌数目有误"</span><span class="token punctuation">,</span> QMessageBox<span class="token punctuation">.</span>Yes<span class="token punctuation">,</span> QMessageBox<span class="token punctuation">.</span>Yes<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>init_display<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    <span class="token comment"># 得到出牌顺序</span>
    self<span class="token punctuation">.</span>play_order <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>user_position <span class="token operator">==</span> <span class="token string">"landlord"</span> <span class="token keyword">else</span> <span class="token number">1</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>user_position <span class="token operator">==</span> <span class="token string">"landlord_up"</span> <span class="token keyword">else</span> <span class="token number">2</span>
</code></pre>
<p>效果如下：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d68c6b2486d94ab6b0f9037986bffbe9.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hobGFkbWluaGhs,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="3_AI_293"></a>3. AI出牌方案输出</h4>
<p>下面我们就需要用到DouZero开源的AI斗地主了。DouZero项目地址：<a href="https://github.com/kwai/DouZero">https://github.com/kwai/DouZero</a>。我们需要将该开源项目下载并导入项目中。</p>
<p><font color="red" size="4">创建一个AI玩家角色，初始化游戏环境，加载模型，进行每轮的出牌判断</font>，控制一局游戏流程的进行和结束。核心代码如下：</p>
<pre><code class="prism language-python"><span class="token comment"># 创建一个代表玩家的AI</span>
ai_players <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
ai_players<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>user_position
ai_players<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> DeepAgent<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position<span class="token punctuation">,</span> self<span class="token punctuation">.</span>card_play_model_path_dict<span class="token punctuation">[</span>self<span class="token punctuation">.</span>user_position<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 初始化游戏环境</span>
self<span class="token punctuation">.</span>env <span class="token operator">=</span> GameEnv<span class="token punctuation">(</span>ai_players<span class="token punctuation">)</span>
<span class="token comment"># 游戏开始</span>
self<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>card_play_init<span class="token punctuation">(</span>self<span class="token punctuation">.</span>card_play_data_list<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始出牌\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>game_over<span class="token punctuation">:</span>
        <span class="token comment"># 玩家出牌时就通过智能体获取action，否则通过识别获取其他玩家出牌</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>play_order <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>PredictedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span>
            action_message <span class="token operator">=</span> self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>step<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position<span class="token punctuation">)</span>
            <span class="token comment"># 更新界面</span>
            self<span class="token punctuation">.</span>UserHandCards<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"手牌："</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>
                <span class="token punctuation">[</span>EnvCard2RealCard<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>info_sets<span class="token punctuation">[</span>self<span class="token punctuation">.</span>user_position<span class="token punctuation">]</span><span class="token punctuation">.</span>player_hand_cards<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            self<span class="token punctuation">.</span>PredictedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>action_message<span class="token punctuation">[</span><span class="token string">"action"</span><span class="token punctuation">]</span> <span class="token keyword">if</span> action_message<span class="token punctuation">[</span><span class="token string">"action"</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token string">"不出"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>WinRate<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"胜率："</span> <span class="token operator">+</span> action_message<span class="token punctuation">[</span><span class="token string">"win_rate"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n手牌："</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>
                    <span class="token punctuation">[</span>EnvCard2RealCard<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>info_sets<span class="token punctuation">[</span>self<span class="token punctuation">.</span>user_position<span class="token punctuation">]</span><span class="token punctuation">.</span>player_hand_cards<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"出牌："</span><span class="token punctuation">,</span> action_message<span class="token punctuation">[</span><span class="token string">"action"</span><span class="token punctuation">]</span> <span class="token keyword">if</span> action_message<span class="token punctuation">[</span><span class="token string">"action"</span><span class="token punctuation">]</span> <span class="token keyword">else</span> <span class="token string">"不出"</span><span class="token punctuation">,</span> <span class="token string">"， 胜率："</span><span class="token punctuation">,</span>
                  action_message<span class="token punctuation">[</span><span class="token string">"win_rate"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>have_white<span class="token punctuation">(</span>self<span class="token punctuation">.</span>RPlayedCardsPos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> \
                    pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'pics/pass.png'</span><span class="token punctuation">,</span>
                                             region<span class="token operator">=</span>self<span class="token punctuation">.</span>RPlayedCardsPos<span class="token punctuation">,</span>
                                             confidence<span class="token operator">=</span>self<span class="token punctuation">.</span>LandlordFlagConfidence<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"等待玩家出牌"</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>restart<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>elapsed<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
                    QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">.</span>processEvents<span class="token punctuation">(</span>QEventLoop<span class="token punctuation">.</span>AllEvents<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>play_order <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>play_order <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>RPlayedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span>
            pass_flag <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>have_white<span class="token punctuation">(</span>self<span class="token punctuation">.</span>RPlayedCardsPos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> \
                    <span class="token keyword">not</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'pics/pass.png'</span><span class="token punctuation">,</span>
                                                 region<span class="token operator">=</span>self<span class="token punctuation">.</span>RPlayedCardsPos<span class="token punctuation">,</span>
                                                 confidence<span class="token operator">=</span>self<span class="token punctuation">.</span>LandlordFlagConfidence<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"等待下家出牌"</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>restart<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>elapsed<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">:</span>
                    QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">.</span>processEvents<span class="token punctuation">(</span>QEventLoop<span class="token punctuation">.</span>AllEvents<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>restart<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>elapsed<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">:</span>
                QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">.</span>processEvents<span class="token punctuation">(</span>QEventLoop<span class="token punctuation">.</span>AllEvents<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token comment"># 不出</span>
            pass_flag <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'pics/pass.png'</span><span class="token punctuation">,</span>
                                                 region<span class="token operator">=</span>self<span class="token punctuation">.</span>RPlayedCardsPos<span class="token punctuation">,</span>
                                                 confidence<span class="token operator">=</span>self<span class="token punctuation">.</span>LandlordFlagConfidence<span class="token punctuation">)</span>
            <span class="token comment"># 未找到"不出"</span>
            <span class="token keyword">if</span> pass_flag <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token comment"># 识别下家出牌</span>
                self<span class="token punctuation">.</span>other_played_cards_real <span class="token operator">=</span> self<span class="token punctuation">.</span>find_other_cards<span class="token punctuation">(</span>self<span class="token punctuation">.</span>RPlayedCardsPos<span class="token punctuation">)</span>
            <span class="token comment"># 找到"不出"</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>other_played_cards_real <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n下家出牌："</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>other_played_cards_real<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>other_played_cards_env <span class="token operator">=</span> <span class="token punctuation">[</span>RealCard2EnvCard<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>other_played_cards_real<span class="token punctuation">)</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>step<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position<span class="token punctuation">,</span> self<span class="token punctuation">.</span>other_played_cards_env<span class="token punctuation">)</span>
            <span class="token comment"># 更新界面</span>
            self<span class="token punctuation">.</span>RPlayedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>other_played_cards_real <span class="token keyword">if</span> self<span class="token punctuation">.</span>other_played_cards_real <span class="token keyword">else</span> <span class="token string">"不出"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>play_order <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>play_order <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>LPlayedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>have_white<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LPlayedCardsPos<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> \
                    <span class="token keyword">not</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'pics/pass.png'</span><span class="token punctuation">,</span>
                                                region<span class="token operator">=</span>self<span class="token punctuation">.</span>LPlayedCardsPos<span class="token punctuation">,</span>
                                                confidence<span class="token operator">=</span>self<span class="token punctuation">.</span>LandlordFlagConfidence<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"等待上家出牌"</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>restart<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>elapsed<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">:</span>
                    QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">.</span>processEvents<span class="token punctuation">(</span>QEventLoop<span class="token punctuation">.</span>AllEvents<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>restart<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>elapsed<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">:</span>
                QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">.</span>processEvents<span class="token punctuation">(</span>QEventLoop<span class="token punctuation">.</span>AllEvents<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token comment"># 不出</span>
            pass_flag <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>locateOnScreen<span class="token punctuation">(</span><span class="token string">'pics/pass.png'</span><span class="token punctuation">,</span>
                                                 region<span class="token operator">=</span>self<span class="token punctuation">.</span>LPlayedCardsPos<span class="token punctuation">,</span>
                                                 confidence<span class="token operator">=</span>self<span class="token punctuation">.</span>LandlordFlagConfidence<span class="token punctuation">)</span>
            <span class="token comment"># 未找到"不出"</span>
            <span class="token keyword">if</span> pass_flag <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token comment"># 识别上家出牌</span>
                self<span class="token punctuation">.</span>other_played_cards_real <span class="token operator">=</span> self<span class="token punctuation">.</span>find_other_cards<span class="token punctuation">(</span>self<span class="token punctuation">.</span>LPlayedCardsPos<span class="token punctuation">)</span>
            <span class="token comment"># 找到"不出"</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>other_played_cards_real <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n上家出牌："</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>other_played_cards_real<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>other_played_cards_env <span class="token operator">=</span> <span class="token punctuation">[</span>RealCard2EnvCard<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>other_played_cards_real<span class="token punctuation">)</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>step<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_position<span class="token punctuation">,</span> self<span class="token punctuation">.</span>other_played_cards_env<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>play_order <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token comment"># 更新界面</span>
            self<span class="token punctuation">.</span>LPlayedCard<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>self<span class="token punctuation">.</span>other_played_cards_real <span class="token keyword">if</span> self<span class="token punctuation">.</span>other_played_cards_real <span class="token keyword">else</span> <span class="token string">"不出"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

        self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>restart<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>elapsed<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
            QtWidgets<span class="token punctuation">.</span>QApplication<span class="token punctuation">.</span>processEvents<span class="token punctuation">(</span>QEventLoop<span class="token punctuation">.</span>AllEvents<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{}胜，本局结束!\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"农民"</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>winner <span class="token operator">==</span> <span class="token string">"farmer"</span> <span class="token keyword">else</span> <span class="token string">"地主"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    QMessageBox<span class="token punctuation">.</span>information<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"本局结束"</span><span class="token punctuation">,</span> <span class="token string">"{}胜！"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"农民"</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>winner <span class="token operator">==</span> <span class="token string">"farmer"</span> <span class="token keyword">else</span> <span class="token string">"地主"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            QMessageBox<span class="token punctuation">.</span>Yes<span class="token punctuation">,</span> QMessageBox<span class="token punctuation">.</span>Yes<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>env<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>init_display<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>到这里，整个AI斗地主出牌流程基本已经完成了。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1402c3f66ae34b6b805d3bff0286ab67.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hobGFkbWluaGhs,size_16,color_FFFFFF,t_70"/></p>
<h3><a id="_412"></a>三、出牌器用法</h3>
<p>按照上述过程，这款AI出牌器已经制作完成了。后面应该如何使用呢？如果不想研究源码，只想使用这款AI斗地主出牌器，验证下效果，该怎么配置环境运行这个AI出牌器呢？下面就开始介绍。</p>
<h4><a id="1__415"></a>1. 环境配置</h4>
<p>首先我们需要安装这些第三方库，配置相关环境，如下所示：</p>
<pre><code class="prism language-python">torch<span class="token operator">==</span><span class="token number">1.9</span><span class="token number">.0</span>
GitPython<span class="token operator">==</span><span class="token number">3.0</span><span class="token number">.5</span>
gitdb2<span class="token operator">==</span><span class="token number">2.0</span><span class="token number">.6</span>
PyAutoGUI<span class="token operator">==</span><span class="token number">0.9</span><span class="token number">.50</span>
PyQt5<span class="token operator">==</span><span class="token number">5.13</span><span class="token number">.0</span>
PyQt5<span class="token operator">-</span>sip<span class="token operator">==</span><span class="token number">12.8</span><span class="token number">.1</span>
Pillow<span class="token operator">&gt;=</span><span class="token number">5.2</span><span class="token number">.0</span>
opencv<span class="token operator">-</span>python
rlcard
</code></pre>
<h4><a id="2__430"></a>2. 坐标调整确认</h4>
<p>我们可以打开游戏界面，将游戏窗口模式下最大化运行，把AI出牌器程序窗口需要移至右下角，不能遮挡手牌、地主标志、底牌、历史出牌这些关键位置。</p>
<p>其次我们要确认屏幕截图获取的各个区域是否正确。如果有问题需要进行区域位置坐标调整。</p>
<pre><code class="prism language-python"><span class="token comment"># 坐标</span>
self<span class="token punctuation">.</span>MyHandCardsPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">414</span><span class="token punctuation">,</span> <span class="token number">804</span><span class="token punctuation">,</span> <span class="token number">1041</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span>  <span class="token comment"># 我的截图区域</span>
self<span class="token punctuation">.</span>LPlayedCardsPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">530</span><span class="token punctuation">,</span> <span class="token number">470</span><span class="token punctuation">,</span> <span class="token number">380</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">)</span>  <span class="token comment"># 左边截图区域</span>
self<span class="token punctuation">.</span>RPlayedCardsPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1010</span><span class="token punctuation">,</span> <span class="token number">470</span><span class="token punctuation">,</span> <span class="token number">380</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">)</span>  <span class="token comment"># 右边截图区域</span>
self<span class="token punctuation">.</span>LandlordFlagPos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1320</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 地主标志截图区域(右-我-左)</span>
self<span class="token punctuation">.</span>ThreeLandlordCardsPos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">817</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">287</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">)</span>      <span class="token comment"># 地主底牌截图区域，resize成349x168</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/60304f9ea331484580e2dbe49cc4ebab.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hobGFkbWluaGhs,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="3__445"></a>3. 运行测试</h4>
<p>当所有环境配置完成，各区域坐标位置确认无误之后，下面我们就可以直接运行程序，测试效果啦~</p>
<p>首先我们运行AI出牌器程序，打开游戏界面，进入游戏。当玩家就位，手牌分发完毕，地主身份确认之后，我们就可以点击画面中开始按钮，让AI来帮助我们斗地主了。</p>
<p>基于这个DouZero项目做一个“成熟”的AI，项目开源地址<a href="https://github.com/tianqiraf/DouZero_For_HappyDouDiZhu">【https://github.com/tianqiraf/DouZero_For_HappyDouDiZhu – tianqiraf】</a>。</p>
<p>今天我们就到这里，明天继续努力！<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2021052715225999.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hobGFkbWluaGhs,size_16,color_FFFFFF,t_70"/><br/> 若本篇内容对您有所帮助，请三连点赞，关注，收藏支持下。</p>
<p>创作不易，白嫖不好，各位的支持和认可，就是我创作的最大动力，我们下篇文章见！</p>
<p>Dragon少年 | 文</p>
<p>如果本篇博客有任何错误，请批评指教，不胜感激 ！</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>