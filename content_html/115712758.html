<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-github-gist" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>目录</h3>
<ul><li><a href="#1_1">1、初识数据库</a></li><li><ul><li><a href="#11_3">1.1、什么是数据库</a></li><li><a href="#12_13">1.2、数据库分类</a></li><li><a href="#13_28">1.3、相关概念</a></li><li><a href="#14MySQL_39">1.4、MySQL及其安装</a></li><li><a href="#15_44">1.5、基本命令</a></li></ul>
</li><li><a href="#2_69">2、操作数据库</a></li><li><ul><li><a href="#21_71">2.1、操作数据库</a></li><li><a href="#22_100">2.2、数据库的列类型</a></li><li><a href="#23_141">2.3、数据库的字段属性</a></li><li><a href="#24_190">2.4、创建数据库表</a></li><li><a href="#25_236">2.5、数据库存储引擎</a></li><li><a href="#26_274">2.6、修改数据库</a></li></ul>
</li><li><a href="#3MySQL_331">3、MySQL数据管理</a></li><li><ul><li><a href="#31_333">3.1、外键</a></li><li><a href="#32DML_424">3.2、DML语言</a></li><li><ul><li><a href="#1__insert_432">1. 添加 insert</a></li><li><a href="#2__update_459">2. 修改 update</a></li><li><a href="#3___delete_497">3. 删除 delete</a></li></ul>
</li></ul>
</li><li><a href="#4DQL_550">4、DQL查询数据</a></li><li><ul><li><a href="#41_643">4.1、基础查询</a></li><li><a href="#42_682">4.2、条件查询</a></li><li><a href="#43_727">4.3、分组查询</a></li><li><a href="#44_760">4.4、连接查询</a></li><li><a href="#45_848">4.5、排序和分页</a></li><li><a href="#46_904">4.6、子查询</a></li><li><a href="#47MySQL_929">4.7、MySQL函数</a></li><li><ul><li><a href="#1__931">1. 常用函数</a></li><li><a href="#2__974">2. 聚合函数</a></li></ul>
</li></ul>
</li><li><a href="#5MD5_1002">5、数据库级别的MD5加密</a></li><li><a href="#6_1040">6、事务</a></li><li><ul><li><a href="#61ACID_1055">6.1、事务原则：ACID</a></li><li><a href="#62_1068">6.2、事务并发导致的问题</a></li><li><a href="#63_1080">6.3、隔离级别</a></li><li><a href="#64_1105">6.4、执行事务的过程</a></li></ul>
</li><li><a href="#7_1150">7、索引</a></li><li><ul><li><a href="#71_1164">7.1、索引的分类</a></li><li><ul><li><a href="#PRIMARY_KEY_1185">主键索引（PRIMARY KEY）</a></li><li><a href="#KEY__INDEX_1206">普通索引（KEY / INDEX）</a></li><li><a href="#UNIQUE_KEY_1230">唯一索引（UNIQUE KEY）</a></li><li><a href="#FULLText_1252">全文索引（FULLText）</a></li></ul>
</li><li><a href="#72_1272">7.2、索引的使用</a></li><li><ul><li><a href="#1__1274">1. 索引的创建</a></li><li><a href="#2__1298">2. 索引的删除</a></li><li><a href="#3__1307">3. 显示索引信息</a></li><li><a href="#4_explainsql_1313">4. explain分析sql执行的情况</a></li></ul>
</li><li><a href="#73_1326">7.3、测试索引</a></li><li><a href="#74_1395">7.4、索引原则</a></li></ul>
</li><li><a href="#8explain_1405">8、explain关键字</a></li><li><a href="#9_1415">9、权限管理和备份</a></li><li><ul><li><a href="#91_1417">9.1、用户管理</a></li><li><a href="#92_1459">9.2、数据库备份</a></li></ul>
</li><li><a href="#10_1509">10、三大范式</a></li><li><a href="#11JDBC_1535">11、数据库驱动和JDBC</a></li><li><ul><li><a href="#1_JDBC_1545">1. 第一个JDBC程序</a></li><li><a href="#2_JDBC_1595">2. JDBC对象</a></li><li><ul><li><a href="#DriverManager_1597">DriverManager</a></li><li><a href="#Statement_1621">Statement</a></li><li><a href="#ResultSet_1636">ResultSet</a></li></ul>
</li><li><a href="#3_jdbc_1644">3. 封装jdbc工具类</a></li><li><ul><li><a href="#1__1646">1. 编写数据库配置文件</a></li><li><a href="#2__1660">2. 编写工具类</a></li><li><a href="#3__1725">3. 测试</a></li></ul>
</li><li><a href="#4_SQL_1754">4. SQL注入问题</a></li><li><a href="#5_PreparedStatement_1797">5. PreparedStatement对象</a></li><li><a href="#6__1835">6. 事务案例</a></li></ul>
</li></ul>
</div>
<p></p>
<h1><a id="1_1"></a>1、初识数据库</h1>
<h2><a id="11_3"></a>1.1、什么是数据库</h2>
<blockquote>
<p><strong>数据库：DB（DataBase）</strong></p>
</blockquote>
<p><strong>概念</strong>：数据仓库，<code>软件</code>，安装在操作系统之上</p>
<p><strong>作用</strong>：存储数据，管理数据</p>
<hr/>
<h2><a id="12_13"></a>1.2、数据库分类</h2>
<p><strong>关系型数据库：SQL</strong>（Structured Query Language）</p>
<ul><li>MySQL、Oracle、Sql Server、DB2、SQLlite</li><li>通过表和表之间，行和列之间的关系进行数据的存储</li><li>通过外键关联来建立表与表之间的关系</li></ul>
<p><strong>非关系型数据库：NoSQL</strong>（Not Only SQL）</p>
<ul><li>Redis、MongoDB</li><li>指数据以<strong>对象</strong>的形式存储在数据库中，而对象之间的关系通过每个对象自身的属性来决定</li></ul>
<hr/>
<h2><a id="13_28"></a>1.3、相关概念</h2>
<blockquote>
<p><strong>DBMS（数据库管理系统）</strong></p>
</blockquote>
<ul><li>数据库的管理<strong>软件</strong>，科学有效的管理、维护和获取我们的数据</li><li><strong>MySQL</strong>就是数据库管理系统</li></ul>
<p><img alt="image-20200718152213413" src="https://img-blog.csdnimg.cn/img_convert/6ca15d7eee443107638939952d09ed79.png"/></p>
<hr/>
<h2><a id="14MySQL_39"></a>1.4、MySQL及其安装</h2>
<ul><li><a href="https://bareth.blog.csdn.net/article/details/107369405">MySQL最新版8.0.21安装配置教程~</a></li></ul>
<hr/>
<h2><a id="15_44"></a>1.5、基本命令</h2>
<blockquote>
<p>所有的语句都要以分号结尾</p>
</blockquote>
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>	<span class="token comment">--查看当前所有的数据库</span>
<span class="token keyword">use</span> 数据库名<span class="token punctuation">;</span>	<span class="token comment">--打开指定的数据库</span>
<span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>	<span class="token comment">--查看所有的表</span>
<span class="token keyword">describe</span><span class="token operator">/</span><span class="token keyword">desc</span> 表名<span class="token punctuation">;</span>	<span class="token comment">--显示表的信息</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> 数据库名<span class="token punctuation">;</span>	<span class="token comment">--创建一个数据库</span>
<span class="token keyword">exit</span>	<span class="token comment">--退出连接</span>
</code></pre>
<pre><code class="prism language-sql"><span class="token comment">--		--单行注释</span>
<span class="token comment">#		--单行注释</span>
<span class="token comment">/*...*/</span>		<span class="token comment">--多行注释</span>
</code></pre>
<hr/>
<br/>
<h1><a id="2_69"></a>2、操作数据库</h1>
<h2><a id="21_71"></a>2.1、操作数据库</h2>
<p>1、创建数据库</p>
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 数据库名<span class="token punctuation">;</span>
</code></pre>
<p>2、删除数据库</p>
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span><span class="token keyword">if</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 数据库名<span class="token punctuation">;</span>
</code></pre>
<p>3、使用数据库</p>
<pre><code class="prism language-sql"><span class="token comment">--如果表名或者字段名是特殊字符，则需要带``</span>
<span class="token keyword">use</span> 数据库名<span class="token punctuation">;</span>
</code></pre>
<p>4、查看数据库</p>
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span>
</code></pre>
<hr/>
<h2><a id="22_100"></a>2.2、数据库的列类型</h2>
<blockquote>
<p>数值</p>
</blockquote>
<table><thead><tr><th align="center">数据类型</th><th align="center">描述</th><th align="center">大小</th></tr></thead><tbody><tr><td align="center">tinyint</td><td align="center">十分小的数据</td><td align="center">1个字节</td></tr><tr><td align="center">smallint</td><td align="center">较小的数据</td><td align="center">2个字节</td></tr><tr><td align="center">mediumint</td><td align="center">中等大小的数据</td><td align="center">3个字节</td></tr><tr><td align="center">int</td><td align="center">标准的整数</td><td align="center">4个字节</td></tr><tr><td align="center">bigint</td><td align="center">较大的数据</td><td align="center">8个字节</td></tr><tr><td align="center">float</td><td align="center">浮点数</td><td align="center">4个字节</td></tr><tr><td align="center">double</td><td align="center">浮点数</td><td align="center">8个字节</td></tr><tr><td align="center">decimal</td><td align="center">字符串形式的浮点数，一般用于金融计算</td><td align="center"></td></tr></tbody></table>
<blockquote>
<p>字符串</p>
</blockquote>
<table><thead><tr><th align="center">数据类型</th><th align="center">描述</th><th align="center">大小</th></tr></thead><tbody><tr><td align="center">char</td><td align="center">字符串固定大小</td><td align="center">0~255</td></tr><tr><td align="center">varchar</td><td align="center">可变字符串</td><td align="center">0~65535</td></tr><tr><td align="center">tinytext</td><td align="center">微型文本</td><td align="center">2^8-1</td></tr><tr><td align="center">text</td><td align="center">文本串</td><td align="center">2^16-1</td></tr></tbody></table>
<blockquote>
<p>时间日期</p>
</blockquote>
<table><thead><tr><th align="center">数据类型</th><th align="center">描述</th><th align="center">格式</th></tr></thead><tbody><tr><td align="center">date</td><td align="center">日期格式</td><td align="center">YYYY-MM-DD</td></tr><tr><td align="center">time</td><td align="center">时间格式</td><td align="center">HH：mm：ss</td></tr><tr><td align="center">datetime</td><td align="center">最常用的时间格式</td><td align="center">YYYY-MM-DD HH：mm：ss</td></tr><tr><td align="center">timestamp</td><td align="center">时间戳，1970.1.1到现在的毫秒数</td><td align="center"></td></tr><tr><td align="center">year</td><td align="center">年份表示</td><td align="center"></td></tr></tbody></table>
<blockquote>
<p>null</p>
</blockquote>
<ul><li>没有值，未知</li><li>不要使用NULL值进行计算</li></ul>
<hr/>
<h2><a id="23_141"></a>2.3、数据库的字段属性</h2>
<blockquote>
<p><strong>UnSigned</strong></p>
</blockquote>
<ul><li>无符号的</li><li>声明了该列不能为负数</li></ul>
<blockquote>
<p><strong>ZEROFILL</strong></p>
</blockquote>
<ul><li>0填充的</li><li>不足位数的用0来填充 , 如int(3),5则为005</li></ul>
<blockquote>
<p><strong>Auto_InCrement</strong></p>
</blockquote>
<ul><li> <p>通常理解为自增，自动在上一条记录的基础上默认+1</p> </li><li> <p>通常用来设计唯一的主键，必须是整数类型</p> </li><li> <p>可定义起始值和步长</p>
<ul><li>当前表设置步长(AUTO_INCREMENT=100) : 只影响当前表</li><li>SET @@auto_increment_increment=5 ; 影响所有使用自增的表(全局)</li></ul> </li></ul>
<blockquote>
<p><strong>NULL 和 NOT NULL</strong></p>
</blockquote>
<ul><li>默认为NULL , 即没有插入该列的数值</li><li>如果设置为NOT NULL , 则该列必须有值</li></ul>
<blockquote>
<p><strong>DEFAULT</strong></p>
</blockquote>
<ul><li>默认的</li><li>用于设置默认值</li><li>例如,性别字段,默认为"男" , 否则为 “女” ; 若无指定该列的值 , 则默认值为"男"的值</li></ul>
<hr/>
<p><strong>拓展</strong>：每一个表，都必须存在以下五个字段：</p>
<table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>主键</td></tr><tr><td>version</td><td>乐观锁</td></tr><tr><td>is_delete</td><td>伪删除</td></tr><tr><td>gmt_create</td><td>创建时间</td></tr><tr><td>gmt_update</td><td>修改时间</td></tr></tbody></table>
<hr/>
<h2><a id="24_190"></a>2.4、创建数据库表</h2>
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>	<span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'学号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'匿名'</span> <span class="token keyword">COMMENT</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>pwd<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'123456'</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>sex<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'女'</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>birthday<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'出生日期'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>address<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'家庭住址'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>email<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8
</code></pre>
<p><code>注意点</code>：</p>
<ul><li> <p>表名和字段尽量使用``括起来</p> </li><li> <p>AUTO_INCREMENT 代表自增</p> </li><li> <p>所有的语句后面加逗号，最后一个不加</p> </li><li> <p>字符串使用单引号括起来</p> </li><li> <p>主键的声明一般放在最后，便于查看</p> </li><li> <p>不设置字符集编码的话，会使用MySQL默认的字符集编码Latin1，不支持中文，可以在my.ini里修改</p> </li></ul>
<blockquote>
<p>格式：</p>
</blockquote>
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token string">'字段名'</span> 列类型 <span class="token punctuation">[</span>属性<span class="token punctuation">]</span> <span class="token punctuation">[</span>索引<span class="token punctuation">]</span> <span class="token punctuation">[</span>注释<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'字段名'</span> 列类型 <span class="token punctuation">[</span>属性<span class="token punctuation">]</span> <span class="token punctuation">[</span>索引<span class="token punctuation">]</span> <span class="token punctuation">[</span>注释<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'字段名'</span> 列类型 <span class="token punctuation">[</span>属性<span class="token punctuation">]</span> <span class="token punctuation">[</span>索引<span class="token punctuation">]</span> <span class="token punctuation">[</span>注释<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">[</span>表的类型<span class="token punctuation">]</span><span class="token punctuation">[</span>字符集设置<span class="token punctuation">]</span><span class="token punctuation">[</span>注释<span class="token punctuation">]</span>
</code></pre>
<p><strong>常用命令：</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 数据库名<span class="token punctuation">;</span><span class="token comment">-- 查看创建数据库的语句</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名<span class="token punctuation">;</span><span class="token comment">-- 查看表的定义语句</span>
<span class="token keyword">DESC</span> 表名<span class="token punctuation">;</span><span class="token comment">-- 显示表的具体结构</span>
</code></pre>
<hr/>
<h2><a id="25_236"></a>2.5、数据库存储引擎</h2>
<p><strong>INNODB</strong></p>
<ul><li>默认使用，安全性高，支持事务的处理，多表多用户操作</li></ul>
<p><strong>MYISAM</strong></p>
<ul><li>早些年使用，节约空间，速度较快</li></ul>
<table><thead><tr><th></th><th>MYISAM</th><th>INNODB</th></tr></thead><tbody><tr><td><strong>事务支持</strong></td><td>不支持</td><td>支持</td></tr><tr><td><strong>数据行锁定</strong></td><td>不支持</td><td>支持</td></tr><tr><td><strong>外键约束</strong></td><td>不支持</td><td>支持</td></tr><tr><td><strong>全文索引</strong></td><td>支持</td><td>不支持</td></tr><tr><td><strong>表空间大小</strong></td><td>较小</td><td>较大，约为2倍</td></tr></tbody></table>
<blockquote>
<p><strong>数据库文件存在的物理空间位置</strong>：</p>
</blockquote>
<ul><li> <p><mark>MySQL数据表以文件方式存放在磁盘中</mark></p>
<ul><li>包括表文件 , 数据文件 , 以及数据库的选项文件</li><li>位置 : <code>Mysql安装目录\data\</code>（目录名对应数据库名 , 该目录下文件名对应数据表）<br/> <img alt="image-20200718152608917" src="https://img-blog.csdnimg.cn/img_convert/1946b76c983e11c85ab1b71a89158eb0.png"/></li></ul> </li></ul>
<p><strong>MySQL在文件引擎上区别：</strong></p>
<ul><li><code>INNODB</code>数据库文件类型就包括**.frm**、<strong>.ibd</strong>以及在上一级目录的<strong>ibdata1</strong>文件</li><li><code>MYISAM</code>存储引擎，数据库文件类型就包括 
  <ul><li><strong>.frm</strong>：表结构定义文件</li><li><strong>.MYD</strong>：数据文件</li><li><strong>.MYI</strong>：索引文件</li></ul> </li></ul>
<hr/>
<h2><a id="26_274"></a>2.6、修改数据库</h2>
<blockquote>
<p>修改</p>
</blockquote>
<p><strong>修改表名</strong> : ALTER TABLE 旧表名 RENAME AS 新表名</p>
<p><strong>添加字段</strong> : ALTER TABLE 表名 ADD字段名 列属性[属性]</p>
<p><strong>修改字段</strong> :</p>
<ul><li>ALTER TABLE 表名 MODIFY 字段名 列类型[属性]</li><li>ALTER TABLE 表名 CHANGE 旧字段名 新字段名 列属性[属性]</li></ul>
<p><strong>删除字段</strong> : ALTER TABLE 表名 DROP 字段名</p>
<pre><code class="prism language-sql"><span class="token comment">-- 修改表名</span>
<span class="token comment">-- ALTER TABLE 旧表名 RENAME AS 新表名</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> teacher <span class="token keyword">RENAME</span> <span class="token keyword">AS</span> teachers<span class="token punctuation">;</span>

<span class="token comment">-- 增加表的字段</span>
<span class="token comment">-- ALTER TABLE 表名 ADD 字段名 列属性</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> teachers <span class="token keyword">ADD</span> age <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 修改表的字段(重命名，修改约束)</span>
<span class="token comment">-- ALTER TABLE 表名 MODIFY 字段名 [列属性];</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> teachers <span class="token keyword">MODIFY</span> age <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- 修改约束</span>
<span class="token comment">-- ALTER TABLE 表名 CHANGE 旧名字 新名字 [列属性];</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> teachers CHANGE age age1 <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- 字段重命名</span>

<span class="token comment">-- 删除表的字段</span>
<span class="token comment">-- ALTER TABLE 表名 DROP 字段名</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> teachers <span class="token keyword">DROP</span> age1<span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>删除</p>
</blockquote>
<p><strong>语法</strong>：DROP TABLE [IF EXISTS] 表名</p>
<ul><li>IF EXISTS为可选 , 判断是否存在该数据表</li><li>如删除不存在的数据表会抛出错误</li></ul>
<pre><code class="prism language-sql"><span class="token comment">-- 删除表(如果存在再删除)</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> teachers<span class="token punctuation">;</span>
</code></pre>
<p><strong>所有的创建和删除尽量加上判断，以免报错~</strong></p>
<hr/>
<br/>
<h1><a id="3MySQL_331"></a>3、MySQL数据管理</h1>
<h2><a id="31_333"></a>3.1、外键</h2>
<blockquote>
<p>外键概念</p>
</blockquote>
<p>如果公共关键字在一个关系中是主关键字，那么这个公共关键字被称为另一个关系的外键。由此可见，外键表示了两个关系之间的相关联系。以另一个关系的外键作主关键字的表被称为<strong>主表</strong>，具有此外键的表被称为主表的<strong>从表</strong>。</p>
<p>在实际操作中，将一个表的值放入第二个表来表示关联，所使用的值是第一个表的主键值(在必要时可包括复合主键值)。此时，第二个表中保存这些值的属性称为外键(<strong>foreign key</strong>)。</p>
<p><strong>外键作用</strong>：</p>
<p>保持数据<strong>一致性</strong>，<strong>完整性</strong>，主要目的是控制存储在外键表中的数据,<strong>约束</strong>。使两张表形成关联，外键只能引用外表中的列的值或使用空值。</p>
<hr/>
<p><strong>目标</strong>：学生表（student）的gradeid字段 要去引用年级表（grade）的 gradeid字段</p>
<blockquote>
<p>创建外键</p>
</blockquote>
<p><strong>方式一：在创建表的时候增加约束</strong></p>
<pre><code class="prism language-sql"><span class="token comment">/*
	1. 定义外键key
	2. 给外键添加约束（执行引用）references 引用
*/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'学号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'匿名'</span> <span class="token keyword">COMMENT</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>pwd<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'123456'</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>sex<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>	<span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'女'</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>birthday<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'出生日期'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>address<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'家庭住址'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>email<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学生的年级'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">KEY</span> <span class="token punctuation">`</span>FK_gradeid<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">CONSTRAINT</span> <span class="token punctuation">`</span>FK_gradeid<span class="token punctuation">`</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8

<span class="token comment">-- 创建年级表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年级id'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>gradename<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年纪名称'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8
</code></pre>
<p>删除有外键关系的表的时候，必须要先删除引用别人的表（从表），再删除被引用的表（主表）</p>
<hr/>
<p><strong>方法二：创建表成功后，添加外键约束</strong></p>
<pre><code class="prism language-sql"><span class="token comment">/*
	1. 定义外键key
	2. 给外键添加约束（执行引用）references 引用
*/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'学号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'匿名'</span> <span class="token keyword">COMMENT</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>pwd<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'123456'</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>sex<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>	<span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'女'</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>birthday<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'出生日期'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>address<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'家庭住址'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>email<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学生的年级'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8

<span class="token comment">-- 创建表的时候没有外键关系</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span>
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token punctuation">`</span>FK_gradeid<span class="token punctuation">`</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建年级表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年级id'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>gradename<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年纪名称'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8
</code></pre>
<p>以上的操作都是物理外键，数据库级别的外键，不建议使用！避免数据库过多造成困扰！</p>
<p><code>最佳实践</code></p>
<ul><li>数据库就是用来单纯的表，只用来存数据，只有行（数据）和列（属性）</li><li>我们想使用多张表的数据，使用外键，用程序去实现</li></ul>
<hr/>
<h2><a id="32DML_424"></a>3.2、DML语言</h2>
<p><strong>数据库的意义</strong>：数据存储，数据管理</p>
<blockquote>
<p><code>Data Manipulation Luaguge</code>：数据操作语言</p>
</blockquote>
<hr/>
<h3><a id="1__insert_432"></a>1. 添加 insert</h3>
<pre><code class="prism language-sql"><span class="token comment">-- 普通用法</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'zsr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 插入多条数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>pwd<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>sex<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'zsr'</span><span class="token punctuation">,</span><span class="token string">'200024'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'gcc'</span><span class="token punctuation">,</span><span class="token string">'000421'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 省略字段</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'Bareth'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'2000-02-04'</span><span class="token punctuation">,</span><span class="token string">'武汉'</span><span class="token punctuation">,</span><span class="token string">'1412@qq.com'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre>
<p><strong>语法：</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 表名<span class="token punctuation">(</span><span class="token punctuation">[</span>字段<span class="token number">1</span><span class="token punctuation">,</span>字段<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'值1'</span><span class="token punctuation">,</span><span class="token string">'值2'</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'值1'</span><span class="token punctuation">,</span><span class="token string">'值2'</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>注意</strong>：</p>
<ol><li>字段和字段之间使用英文逗号隔开</li><li>字段是可以省略的，但是值必须完整且一一对应</li><li>可以同时插入多条数据，VALUES后面的值需要使用逗号隔开</li></ol>
<hr/>
<h3><a id="2__update_459"></a>2. 修改 update</h3>
<pre><code class="prism language-sql"><span class="token comment">-- 修改学员名字,指定条件</span>
<span class="token keyword">UPDATE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'zsr204'</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">-- 不指定条件的情况,会改动所有表</span>
<span class="token keyword">UPDATE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'zsr204'</span><span class="token punctuation">;</span>

<span class="token comment">-- 修改多个属性</span>
<span class="token keyword">UPDATE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'zsr'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>address<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'湖北'</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">-- 通过多个条件定位数据</span>
<span class="token keyword">UPDATE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'zsr204'</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'zsr'</span> <span class="token operator">AND</span> <span class="token punctuation">`</span>pwd<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'200024'</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>语法</strong>：</p>
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> 表名 <span class="token keyword">SET</span> 字段<span class="token number">1</span><span class="token operator">=</span>值<span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">[</span>字段<span class="token number">2</span><span class="token operator">=</span>值<span class="token number">2.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token keyword">WHERE</span> 条件<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>关于WHERE条件语句</strong>：</p>
<table><thead><tr><th>操作符</th><th>含义</th></tr></thead><tbody><tr><td>=</td><td>等于</td></tr><tr><td>&lt;&gt;或!=</td><td>不等于</td></tr><tr><td>&gt;</td><td>大于</td></tr><tr><td>&lt;</td><td>小于</td></tr><tr><td>&lt;=</td><td>小于等于</td></tr><tr><td>&gt;=</td><td>大于等于</td></tr><tr><td>BETWEEN…AND…</td><td>闭合区间</td></tr><tr><td>AND</td><td>和</td></tr><tr><td>OR</td><td>或</td></tr></tbody></table>
<hr/>
<h3><a id="3___delete_497"></a>3. 删除 delete</h3>
<pre><code class="prism language-sql"><span class="token comment">-- 删除数据(避免这样写,会全部删除)</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">-- 删除指定数据</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>语法</strong>：</p>
<pre><code class="prism language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 表名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件<span class="token punctuation">]</span>
</code></pre>
<p>关于<code>DELETE</code>删除的问题，重启数据库现象：</p>
<ul><li>INNODB 自增列会从1开始（存在内存当中，断电即失）</li><li>MYISAM 继续从上一个子增量开始（存在内存当中，不会丢失）</li></ul>
<blockquote>
<p>TRUNCATE</p>
</blockquote>
<p><strong>作用</strong>：完全清空一个数据库表，表的结构和索引约束不会变！</p>
<p><strong>DELETE和TRUNCATE 的区别：</strong></p>
<ul><li>DELETE可以条件删除（where子句），而TRUNCATE只能删除整个表</li><li>TRUNCATE 重新设置自增列，计数器会归零，而DELETE不会影响自增</li><li>DELETE是数据操作语言（DML - Data Manipulation Language），操作时原数据会被放到 rollback segment中，可以被回滚；而TRUNCATE是数据定义语言（DDL - Data Definition Language)，操作时不会进行存储，不能进行回滚。<br/> <img alt="image-20210418210712785" src="https://img-blog.csdnimg.cn/img_convert/b4b2c1e383fc8bd2f0b1e4a4eddc080f.png"/></li></ul>
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>coll<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>coll<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 不会影响自增</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">-- 会影响自增</span>
<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre>
<hr/>
<br/>
<h1><a id="4DQL_550"></a>4、DQL查询数据</h1>
<blockquote>
<p><code>Data QueryLanguage</code> 数据查询语言</p>
</blockquote>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span> <span class="token operator">|</span> <span class="token keyword">DISTINCT</span><span class="token punctuation">]</span>
{<!-- --><span class="token operator">*</span> <span class="token operator">|</span> <span class="token keyword">table</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token keyword">table</span><span class="token punctuation">.</span>field1<span class="token punctuation">[</span><span class="token keyword">as</span> alias1<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token keyword">table</span><span class="token punctuation">.</span>field2<span class="token punctuation">[</span><span class="token keyword">as</span> alias2<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>}
<span class="token keyword">FROM</span> table_name <span class="token punctuation">[</span><span class="token keyword">as</span> table_alias<span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token keyword">left</span> <span class="token operator">|</span> <span class="token keyword">right</span> <span class="token operator">|</span> <span class="token keyword">inner</span> <span class="token keyword">join</span> table_name2<span class="token punctuation">]</span>  <span class="token comment">-- 联合查询</span>
  <span class="token punctuation">[</span><span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token comment">-- 指定结果需满足的条件</span>
  <span class="token punctuation">[</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token comment">-- 指定结果按照哪几个字段来分组</span>
  <span class="token punctuation">[</span><span class="token keyword">HAVING</span><span class="token punctuation">]</span>  <span class="token comment">-- 过滤分组的记录必须满足的次要条件</span>
  <span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token comment">-- 指定查询记录按一个或多个条件排序</span>
  <span class="token punctuation">[</span><span class="token keyword">LIMIT</span> {<!-- --><span class="token punctuation">[</span><span class="token keyword">offset</span><span class="token punctuation">,</span><span class="token punctuation">]</span>row_count <span class="token operator">|</span> row_countOFFSET <span class="token keyword">offset</span>}<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">-- 指定查询的记录从哪条至哪条</span>
</code></pre>
<ul><li>查询数据库数据 , 如<strong>SELECT</strong>语句</li><li>简单的单表查询或多表的复杂查询和嵌套查询</li><li>是数据库语言中最核心,最重要的语句</li><li>使用频率最高的语句</li></ul>
<p><strong>前提配置</strong>：</p>
<pre><code class="prism language-sql"><span class="token comment">-- 创建学校数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>school<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">-- 用school数据库</span>
<span class="token keyword">USE</span> <span class="token punctuation">`</span>school<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建年级表grade表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>GradeID<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'年级编号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>GradeName<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年纪名称'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>	<span class="token punctuation">(</span><span class="token punctuation">`</span>GradeID<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">6</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- 给grade表插入数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>GradeID<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>GradeName<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'大一'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'大二'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'大三'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'大四'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建成绩result表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>result<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>SubjectNo<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'考试编号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>ExamDate<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'考试日期'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'考试成绩'</span><span class="token punctuation">,</span>
	<span class="token keyword">KEY</span> <span class="token punctuation">`</span>SubjectNo<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>SubjectNo<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- 给result表插入数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>result<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>SubjectNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>ExamDate<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'2019-10-21 16:00:00'</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'2019-10-21 16:00:00'</span><span class="token punctuation">,</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'2019-10-21 16:00:00'</span><span class="token punctuation">,</span><span class="token number">87</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'2019-10-21 16:00:00'</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建学生表student</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span>	
	<span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>LoginPwd<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学生姓名'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>Sex<span class="token punctuation">`</span> <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别,取值0或1'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>GradeID<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年级编号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>Phone<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'联系电话,允许为空,即可选输入'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>Adress<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'地址,允许为空,即可选输入'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>BornDate<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'出生时间'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>Email<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱账号,允许为空,即可选输入'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>IdentityCard<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'身份证号'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>IdentityCard<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>IdentityCard<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">KEY</span> <span class="token punctuation">`</span>Email<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>Email<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span>MYISAM <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- 给学生表插入数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>LoginPwd<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>Sex<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>GradeID<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>Phone<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>Adress<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>BornDate<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>Email<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>IdentityCard<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token string">'1241'</span><span class="token punctuation">,</span><span class="token string">'dsaf'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'24357'</span><span class="token punctuation">,</span><span class="token string">'unknow'</span><span class="token punctuation">,</span><span class="token string">'2000-09-16 00:00:00'</span><span class="token punctuation">,</span><span class="token string">'1231@qq.com'</span><span class="token punctuation">,</span><span class="token string">'809809'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">'1321'</span><span class="token punctuation">,</span><span class="token string">'dfdj'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'89900'</span><span class="token punctuation">,</span><span class="token string">'unknow'</span><span class="token punctuation">,</span><span class="token string">'2000-10-16 00:00:00'</span><span class="token punctuation">,</span><span class="token string">'5971@qq.com'</span><span class="token punctuation">,</span><span class="token string">'908697'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建科目表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>SubjectNo<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'课程编号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>SubjectName<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'课程名称'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>ClassHour<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学时'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>GradeID<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年级编号'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>SubjectNo<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">18</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- 给科目表subject插入数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>SubjectNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>SubjectName<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>ClassHour<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>GradeID<span class="token punctuation">`</span><span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'高数'</span><span class="token punctuation">,</span><span class="token string">'96'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'大物'</span><span class="token punctuation">,</span><span class="token string">'112'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'程序设计'</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> 字段 <span class="token keyword">FROM</span> 表<span class="token punctuation">;</span>
</code></pre>
<h2><a id="41_643"></a>4.1、基础查询</h2>
<p><strong>语法</strong>：</p>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 查询列表 <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
</code></pre>
<ul><li>查询列表可以是：表中的（一个或多个）字段，常量，变量，表达式，函数</li><li>查询结果是一个虚拟的表格</li></ul>
<pre><code class="prism language-sql"><span class="token comment">-- 查询全部学生</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>

<span class="token comment">-- 查询指定的字段</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>LoginPwd<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>

<span class="token comment">-- 别名 AS(可以给字段起别名,也可以给表起别名)</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span> <span class="token keyword">AS</span> 学号<span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token keyword">AS</span> 学生姓名 <span class="token keyword">FROM</span> student <span class="token keyword">AS</span> 学生表<span class="token punctuation">;</span>

<span class="token comment">-- 函数 CONCAT(str1,str2,...)</span>
<span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'姓名'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 新名字 <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>

<span class="token comment">-- 查询系统版本(函数)</span>
<span class="token keyword">SELECT</span> VERSION<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 用来计算(计算表达式)</span>
<span class="token keyword">SELECT</span> <span class="token number">100</span><span class="token operator">*</span><span class="token number">53</span><span class="token operator">-</span><span class="token number">90</span> <span class="token keyword">AS</span> 计算结果<span class="token punctuation">;</span>

<span class="token comment">-- 查询自增步长(变量)</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@auto_increment_increment</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询有哪写同学参加了考试,重复数据要去重</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span> <span class="token keyword">FROM</span> result<span class="token punctuation">;</span>
</code></pre>
<hr/>
<h2><a id="42_682"></a>4.2、条件查询</h2>
<blockquote>
<p>where 条件字句：检索数据中<code>符合条件</code>的值</p>
</blockquote>
<p><strong>语法</strong>：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> 查询列表 <span class="token keyword">from</span> 表名 <span class="token keyword">where</span> 筛选条件<span class="token punctuation">;</span>
</code></pre>
<img alt="image-20200718180714078" src="https://gitee.com/zhong_siru/images/raw/master/img/20200718180714.png"/>
<pre><code class="prism language-sql"><span class="token comment">-- 查询考试成绩在95~100之间的</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span> <span class="token keyword">FROM</span> result
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token operator">&gt;=</span><span class="token number">95</span> <span class="token operator">AND</span> <span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">-- &amp;&amp;</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span> <span class="token keyword">FROM</span> result
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token operator">&gt;=</span><span class="token number">95</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">-- BETWEEN AND</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span> <span class="token keyword">FROM</span> result
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token operator">BETWEEN</span> <span class="token number">95</span> <span class="token operator">AND</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询除了1000号以外的学生</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span> <span class="token keyword">FROM</span> result
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token operator">!=</span><span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token comment">-- NOT</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span> <span class="token keyword">FROM</span> result
<span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询名字含d的同学</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token keyword">FROM</span> student
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">'%d%'</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询名字倒数第二个为d的同学</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token keyword">FROM</span> student
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token operator">LIKE</span> <span class="token string">'%d_'</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询1000,1001学员</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token keyword">FROM</span> student
<span class="token keyword">WHERE</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<hr/>
<h2><a id="43_727"></a>4.3、分组查询</h2>
<p><strong>语法</strong>：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> 分组函数，分组后的字段
<span class="token keyword">from</span> 表
【<span class="token keyword">where</span> 筛选条件】
<span class="token keyword">group</span> <span class="token keyword">by</span> 分组的字段
【<span class="token keyword">having</span> 分组后的筛选】
【<span class="token keyword">order</span> <span class="token keyword">by</span> 排序列表】
</code></pre>
<p><strong>区别</strong>：</p>
<table><thead><tr><th align="left"></th><th align="left">使用关键字</th><th>筛选的表</th><th align="left">位置</th></tr></thead><tbody><tr><td align="left">分组前筛选</td><td align="left">where</td><td>原始表</td><td align="left">group by的前面</td></tr><tr><td align="left">分组后筛选</td><td align="left">having</td><td>分组后的结果</td><td align="left">group by 的后面</td></tr></tbody></table>
<pre><code class="prism language-sql"><span class="token comment">-- 查询不同科目的平均分、最高分、最低分且平均分大于90</span>
<span class="token comment">-- 核心：根据不同的课程进行分组</span>
<span class="token keyword">SELECT</span> SubjectName<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>StudentResult<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">MIN</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> result r
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> s
<span class="token keyword">on</span> r<span class="token punctuation">.</span>SubjectNo<span class="token operator">=</span>s<span class="token punctuation">.</span>SubjectNo
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> r<span class="token punctuation">.</span>SubjectNo
<span class="token keyword">HAVING</span> <span class="token function">AVG</span><span class="token punctuation">(</span>StudentResult<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">90</span><span class="token punctuation">;</span>
</code></pre>
<hr/>
<h2><a id="44_760"></a>4.4、连接查询</h2>
<p><img alt="image-20200718231304641" src="https://img-blog.csdnimg.cn/img_convert/6354aff6ecaee8ec2f2f7ec065304889.png"/></p>
<pre><code class="prism language-sql"><span class="token comment">-- 查询学员所属的年级（学号，学生姓名，年级名称）</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>GradeName<span class="token punctuation">`</span>
<span class="token keyword">FROM</span> student s
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> grade g
<span class="token keyword">ON</span> s<span class="token punctuation">.</span>GradeID<span class="token operator">=</span>g<span class="token punctuation">.</span>GradeID<span class="token punctuation">;</span>

<span class="token comment">-- 查询科目所属的年级</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>SubjectName<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>GradeName<span class="token punctuation">`</span>
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> s
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span> g
<span class="token keyword">ON</span> s<span class="token punctuation">.</span>GradeID<span class="token operator">=</span>g<span class="token punctuation">.</span>GradeID<span class="token punctuation">;</span>

<span class="token comment">-- 查询列参加程序设计考试的同学信息（学号，姓名，科目名，分数）</span>
<span class="token keyword">SELECT</span> s<span class="token punctuation">.</span><span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>SubjectName<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span>
<span class="token keyword">FROM</span> student s
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> result r
<span class="token keyword">on</span> s<span class="token punctuation">.</span>StudentNo<span class="token operator">=</span>r<span class="token punctuation">.</span>StudentNo
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> sub
<span class="token keyword">on</span> r<span class="token punctuation">.</span>SubjectNo<span class="token operator">=</span>sub<span class="token punctuation">.</span>SubjectNo
<span class="token keyword">where</span> SubjectName<span class="token operator">=</span><span class="token string">'课程设计'</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>自连接</p>
</blockquote>
<p>自己的表和自己的表连接，核心：<strong>一张表拆为两张一样的表即可</strong></p>
<pre><code class="prism language-sql"><span class="token comment">-- 创建一个表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>course<span class="token punctuation">`</span> <span class="token punctuation">(</span>
<span class="token punctuation">`</span>courseid<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'课程id'</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>pid<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'父课程id'</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>courseName<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'课程名'</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>courseid<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">9</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8

<span class="token comment">-- 插入数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>course<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>courseid<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>pid<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>courseName<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'信息技术'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'软件开发'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'数据库'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'美术设计'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'web开发'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'ps技术'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'办公信息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>得到下表：<br/> <img alt="image-20200718235951574" height="200" src="https://gitee.com/zhong_siru/images/raw/master/img/20200718235951.png"/></p>
<p>将该表进行拆分：</p>
<table><thead><tr><th>pid（父课程id）</th><th>courseid（课程id）</th><th>courseName（课程名）</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>信息技术</td></tr><tr><td>1</td><td>3</td><td>软件开发</td></tr><tr><td>1</td><td>5</td><td>美术设计</td></tr></tbody></table>
<table><thead><tr><th>pid（父课程id）</th><th>courseid（课程id）</th><th>courseName（课程名）</th></tr></thead><tbody><tr><td>2</td><td>8</td><td>办公信息</td></tr><tr><td>3</td><td>4</td><td>数据库</td></tr><tr><td>3</td><td>6</td><td>web开发</td></tr><tr><td>5</td><td>7</td><td>ps技术</td></tr></tbody></table>
<p><strong>操作</strong>：查询父类对应的子类关系</p>
<table><thead><tr><th>父类</th><th>子类</th></tr></thead><tbody><tr><td>信息技术 2</td><td>办公信息 4</td></tr><tr><td>软件开发 3</td><td>数据库 4、web开发 6</td></tr><tr><td>美术设计 5</td><td>ps技术 7</td></tr></tbody></table>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span><span class="token punctuation">`</span>courseid<span class="token punctuation">`</span> <span class="token keyword">AS</span> <span class="token string">'父课程'</span><span class="token punctuation">,</span>b<span class="token punctuation">.</span><span class="token punctuation">`</span>courseid<span class="token punctuation">`</span> <span class="token keyword">AS</span> <span class="token string">'子课程'</span>
<span class="token keyword">FROM</span> course <span class="token keyword">AS</span> a<span class="token punctuation">,</span>course <span class="token keyword">AS</span> b
<span class="token keyword">WHERE</span> a<span class="token punctuation">.</span><span class="token punctuation">`</span>courseid<span class="token punctuation">`</span><span class="token operator">=</span>b<span class="token punctuation">.</span><span class="token punctuation">`</span>pid<span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre>
<p><img alt="image-20200719105147906" src="https://img-blog.csdnimg.cn/img_convert/149c6d4bfdaea45e0a66af888e3f304c.png"/></p>
<hr/>
<h2><a id="45_848"></a>4.5、排序和分页</h2>
<blockquote>
<p>排序</p>
</blockquote>
<p><strong>语法</strong>：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> 查询列表
<span class="token keyword">from</span> 表
<span class="token keyword">where</span> 筛选条件
<span class="token keyword">order</span> <span class="token keyword">by</span> 排序列表 <span class="token keyword">asc</span><span class="token operator">/</span><span class="token keyword">desc</span>
</code></pre>
<ul><li>order by的位置一般放在查询语句的最后（除limit语句之外）</li></ul>
<table><thead><tr><th>asc ：</th><th>升序，如果不写默认升序</th></tr></thead><tbody><tr><td><strong>desc：</strong></td><td><strong>降序</strong></td></tr></tbody></table>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>GradeName<span class="token punctuation">`</span>
<span class="token keyword">FROM</span> student s
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> grade g
<span class="token keyword">ON</span> s<span class="token punctuation">.</span>GradeID<span class="token operator">=</span>g<span class="token punctuation">.</span>GradeID
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>分页</p>
</blockquote>
<p><strong>语法</strong>：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> 查询列表
<span class="token keyword">from</span> 表
<span class="token keyword">limit</span> <span class="token keyword">offset</span><span class="token punctuation">,</span>pagesize<span class="token punctuation">;</span>
</code></pre>
<ul><li>offset代表的是起始的条目索引，默认从0开始</li><li>size代表的是显示的条目数</li><li>offset=(n-1)*pagesize</li></ul>
<pre><code class="prism language-sql"><span class="token comment">-- 第一页 limit 0 5</span>
<span class="token comment">-- 第二页 limit 5,5</span>
<span class="token comment">-- 第三页 limit 10,5</span>
<span class="token comment">-- 第n页  limit (n-1)*pagesize,pagesize</span>
<span class="token comment">-- pagesize:当前页面大小</span>
<span class="token comment">-- (n-1)*pagesize:起始值</span>
<span class="token comment">-- n:当前页面</span>
<span class="token comment">-- 数据总数/页面大小=总页面数</span>
<span class="token comment">-- limit n 表示从0到n的页面</span>
</code></pre>
<hr/>
<h2><a id="46_904"></a>4.6、子查询</h2>
<p><strong>本质</strong>：在 <code>where</code>子句中嵌套一个子查询语句</p>
<pre><code class="prism language-sql"><span class="token comment">-- 查询‘课程设计’的所有考试结果（学号，科目编号，成绩）降序排列</span>

<span class="token comment">-- 方式一:使用连接查询</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token punctuation">`</span>SubjectNo<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span>
<span class="token keyword">FROM</span> result r
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> s
<span class="token keyword">on</span> r<span class="token punctuation">.</span>StudentNo<span class="token operator">=</span>s<span class="token punctuation">.</span>SubjectNo
<span class="token keyword">WHERE</span> SubjectName<span class="token operator">=</span><span class="token string">'课程设计'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> StudentResult <span class="token keyword">DESC</span><span class="token punctuation">;</span>
<span class="token comment">-- 方式二:使用子查询（由里到外）</span>
<span class="token keyword">SELECT</span> StudentNo<span class="token punctuation">,</span>SubjectNo<span class="token punctuation">,</span>StudentResult
<span class="token keyword">from</span> result
<span class="token keyword">WHERE</span> SubjectNo<span class="token operator">=</span><span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> SubjectNo <span class="token keyword">FROM</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span>
	<span class="token keyword">WHERE</span> SubjectName<span class="token operator">=</span><span class="token string">'课程设计'</span>
<span class="token punctuation">)</span>
</code></pre>
<hr/>
<h2><a id="47MySQL_929"></a>4.7、MySQL函数</h2>
<h3><a id="1__931"></a>1. 常用函数</h3>
<pre><code class="prism language-sql"><span class="token comment">-- 数学运算</span>
<span class="token keyword">SELECT</span> ABS<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 绝对值</span>
<span class="token keyword">SELECT</span> CEIL<span class="token punctuation">(</span><span class="token number">5.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 向上取整</span>
<span class="token keyword">SELECT</span> CEILING<span class="token punctuation">(</span><span class="token number">5.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 向上取整</span>
<span class="token keyword">SELECT</span> RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 返回0~1之间的一个随机数</span>
<span class="token keyword">SELECT</span> SIGN<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 返回一个数的符号;0返回0;正数返回1;负数返回-1</span>

<span class="token comment">-- 字符串函数</span>
<span class="token keyword">SELECT</span> CHAR_LENGTH<span class="token punctuation">(</span><span class="token string">'我喜欢你'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 字符串长度</span>
<span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'我'</span><span class="token punctuation">,</span><span class="token string">'喜欢'</span><span class="token punctuation">,</span><span class="token string">'你'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 拼接字符串</span>
<span class="token keyword">SELECT</span> <span class="token keyword">INSERT</span><span class="token punctuation">(</span><span class="token string">'我喜欢'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'超级'</span><span class="token punctuation">)</span> <span class="token comment">-- INSERT(str,pos,len,newstr) 从str的pos位置开始替换为长度为len的newstr</span>
<span class="token keyword">SELECT</span> UPPER<span class="token punctuation">(</span><span class="token string">'zsr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 转大写</span>
<span class="token keyword">SELECT</span> LOWER<span class="token punctuation">(</span><span class="token string">'ZSR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 转小写</span>
<span class="token keyword">SELECT</span> INSTR<span class="token punctuation">(</span><span class="token string">'zsrs'</span><span class="token punctuation">,</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 返回第一次出现字串索引的位置</span>
<span class="token keyword">SELECT</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">'加油就能胜利'</span><span class="token punctuation">,</span><span class="token string">'加油'</span><span class="token punctuation">,</span><span class="token string">'坚持'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 替换出现的指定字符串</span>
<span class="token keyword">SELECT</span> SUBSTR<span class="token punctuation">(</span><span class="token string">'坚持就是胜利'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 返回指定的字符串(源字符串,截取位置,截取长度)</span>
<span class="token keyword">SELECT</span> REVERSE<span class="token punctuation">(</span><span class="token string">'rsz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 反转字符串</span>

<span class="token comment">-- 时间日期函数</span>
<span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_DATE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 获取当前日期</span>
<span class="token keyword">SELECT</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 获取当前日期</span>
<span class="token keyword">SELECT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 获取当前时间</span>
<span class="token keyword">SELECT</span> LOCALTIME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 本地时间</span>
<span class="token keyword">SELECT</span> SYSDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 系统时间</span>

<span class="token keyword">SELECT</span> <span class="token keyword">YEAR</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">MONTH</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DAY</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">HOUR</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">MINUTE</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">SECOND</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 系统信息</span>
<span class="token keyword">SELECT</span> <span class="token keyword">SYSTEM_USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> VERSION<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<hr/>
<h3><a id="2__974"></a>2. 聚合函数</h3>
<table><thead><tr><th align="left">函数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">max</td><td align="left">最大值</td></tr><tr><td align="left">min</td><td align="left">最小值</td></tr><tr><td align="left">sum</td><td align="left">和</td></tr><tr><td align="left">avg</td><td align="left">平均值</td></tr><tr><td align="left">count</td><td align="left">计算个数</td></tr></tbody></table>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>StudentName<span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span> 
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> result<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> result<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> result<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentResult<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> result<span class="token punctuation">;</span>
</code></pre>
<hr/>
<br/>
<h1><a id="5MD5_1002"></a>5、数据库级别的MD5加密</h1>
<blockquote>
<p><strong>MD5信息摘要算法</strong>（MD5 Message-Digest Algorithm）</p>
</blockquote>
<ul><li>MD5由MD4、MD3、MD2改进而来，主要增强算法复杂度和不可逆性</li><li>MD5破解网站的原理，背后有一个字典，MD5加密后的值，加密前的值</li></ul>
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>testMD5<span class="token punctuation">`</span><span class="token punctuation">(</span>
	<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>pwd<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment">-- 明文密码</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>testMD5<span class="token punctuation">`</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'zsr'</span><span class="token punctuation">,</span><span class="token string">'200024'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'gcc'</span><span class="token punctuation">,</span><span class="token string">'000421'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'bareth'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 加密</span>
<span class="token keyword">UPDATE</span> <span class="token punctuation">`</span>testMD5<span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>pwd<span class="token punctuation">`</span><span class="token operator">=</span>MD5<span class="token punctuation">(</span>pwd<span class="token punctuation">)</span> WHE RE id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> <span class="token punctuation">`</span>testMD5<span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>pwd<span class="token punctuation">`</span><span class="token operator">=</span>MD5<span class="token punctuation">(</span>pwd<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 加密全部的密码</span>

<span class="token comment">-- 插入的时候加密</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>testMD5<span class="token punctuation">`</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'barry'</span><span class="token punctuation">,</span>MD5<span class="token punctuation">(</span><span class="token string">'654321'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 如何校验:将用户传递进来的密码，进行MD5加密，然后对比加密后的值</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>testMD5<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'barry'</span> <span class="token operator">AND</span> <span class="token punctuation">`</span>pwd<span class="token punctuation">`</span><span class="token operator">=</span>MD5<span class="token punctuation">(</span><span class="token string">'654321'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<img alt="image-20200719183311341" height="130" src="https://gitee.com/zhong_siru/images/raw/master/img/20200719183311.png"/>
<hr/>
<br/>
<h1><a id="6_1040"></a>6、事务</h1>
<blockquote>
<p><mark>要么都成功，要么都失败</mark></p>
</blockquote>
<pre><code class="prism language-note">SQL执行：A转账给B
SQL执行：B收到A的钱
</code></pre>
<p>将一组SQL放在一个批次中去执行</p>
<ul><li>例如银行转账：只有A转账成功且B成功到账，该事件才算结束，如果一方不成功，则该事务不成功</li></ul>
<h2><a id="61ACID_1055"></a>6.1、事务原则：ACID</h2>
<p>参考链接：<a href="https://blog.csdn.net/dengjili/article/details/82468576">https://blog.csdn.net/dengjili/article/details/82468576</a></p>
<table><thead><tr><th align="left">名称</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>原子性（Atomicity）</strong></td><td align="left">原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。</td></tr><tr><td align="left"><strong>一致性（Consistency）</strong></td><td align="left">事务前后数据的完整性必须保持一致。</td></tr><tr><td align="left"><strong>隔离性（Isolation）</strong></td><td align="left">事务的隔离性是多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。</td></tr><tr><td align="left"><strong>持久性（Durability）</strong></td><td align="left">事务一旦被提交则不可逆，被持久化到数据库中，接下来即使数据库发生故障也不应该对其有任何影响</td></tr></tbody></table>
<hr/>
<h2><a id="62_1068"></a>6.2、事务并发导致的问题</h2>
<blockquote>
<p>隔离所导致的一些问题：</p>
</blockquote>
<table><thead><tr><th align="left">名称</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>脏读</strong></td><td align="left">指一个事务读取了另外一个事务未提交的数据。</td></tr><tr><td align="left"><strong>不可重复读</strong></td><td align="left">在一个事务内读取表中的某一行数据，多次读取结果不同。</td></tr><tr><td align="left"><strong>虚读(幻读)</strong></td><td align="left">是指在一个事务内读取到了别的事务插入的数据，导致前后读取不一致。</td></tr></tbody></table>
<hr/>
<h2><a id="63_1080"></a>6.3、隔离级别</h2>
<blockquote>
<p>在数据库操作中，为了有效保证并发读取数据的正确性，提出的<strong>事务隔离级别</strong></p>
</blockquote>
<ul><li> <p><strong>读未提交</strong>：一个事务读取到其他事务未提交的数据；这种隔离级别下，查询不会加锁，一致性最差，会产生<code>脏读</code>、<code>不可重复读</code>、<code>幻读</code>的问题</p> </li><li> <p><strong>读已提交</strong>：一个事务只能读取到其他事务已经提交的数据；该隔离级别避免了<code>脏读</code>问题的产生，但是<code>不可重复读</code>和<code>幻读</code>的问题仍然存在；</p> <p>读提交事务隔离级别是大多数流行数据库的默认事务隔离级别，比如 Oracle，但是不是 MySQL 的默认隔离界别</p> </li><li> <p><strong>可重复读</strong>：事务在执行过程中可以读取到其他事务已提交的新插入的数据，但是不能读取其他事务对数据的修改，也就是说多次读取同一记录的结果相同；该个里级别避免了<code>脏读</code>、<code>不可重复度</code>的问题，但是仍然无法避免<code>幻读</code>的问题</p> <p>可重复读是MySQL默认的隔离级别</p> </li><li> <p><strong>串行化</strong>：事务串行化执行，事务只能一个接着一个地执行,、，并且在执行过程中完全看不到其他事务对数据所做的更新；缺点是并发能力差，最严格的事务隔离，完全符合ACID原则，但是对性能影响比较大</p> </li></ul>
<table><thead><tr><th><strong>事务隔离级别</strong></th><th><strong>脏读</strong></th><th><strong>不可重复读</strong></th><th><strong>幻读</strong></th></tr></thead><tbody><tr><td>读未提交（read-uncommitted）</td><td>是</td><td>是</td><td>是</td></tr><tr><td>读已提交（read-committed）</td><td>否</td><td>是</td><td>是</td></tr><tr><td>可重复读（repeatable-read）</td><td>否</td><td>否</td><td>是</td></tr><tr><td>串行化（serializable）</td><td>否</td><td>否</td><td>否</td></tr></tbody></table>
<h2><a id="64_1105"></a>6.4、执行事务的过程</h2>
<p>1️⃣ <strong>关闭自动提交</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">SET</span> autocommit<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
</code></pre>
<p>2️⃣ <strong>事务开启</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span> <span class="token comment">-- 标记一个事务的开始，从这个之后的sql都在同一个事务内</span>
</code></pre>
<p>3️⃣ <strong>成功则提交，失败则回滚</strong></p>
<pre><code class="prism language-sql"><span class="token comment">-- 提交：持久化（成功）</span>
<span class="token keyword">COMMIT</span>
</code></pre>
<pre><code class="prism language-sql"><span class="token comment">-- 回滚：回到原来的样子（失败）</span>
<span class="token keyword">ROLLBACK</span>
</code></pre>
<p>4️⃣ <strong>事务结束</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">SET</span> autocommit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">-- 开启自动提交</span>
</code></pre>
<p>​5️⃣ <strong>其他操作</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">SAVEPOINT</span> 保存点名<span class="token punctuation">;</span> <span class="token comment">-- 设置一个事务的保存点</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> <span class="token keyword">SAVEPOINT</span> 保存点名<span class="token punctuation">;</span> <span class="token comment">-- 回滚到保存点</span>
<span class="token keyword">RELEASE</span> <span class="token keyword">SAVEPOINT</span> 保存点名<span class="token punctuation">;</span> <span class="token comment">-- 撤销保存点</span>
</code></pre>
<hr/>
<br/>
<h1><a id="7_1150"></a>7、索引</h1>
<p>推荐阅读：<a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">MySQL索引背后的数据结构及算法原理</a></p>
<blockquote>
<p>索引（<code>Index</code>）是帮助MySQL高效获取数据的<strong>数据结构</strong>。</p>
</blockquote>
<ul><li>提高查询速度</li><li>确保数据的唯一性</li><li>可以加速表和表之间的连接 , 实现表与表之间的参照完整性</li><li>使用分组和排序子句进行数据检索时 , 可以显著减少分组和排序的时间</li><li>全文检索字段进行搜索优化</li></ul>
<hr/>
<h2><a id="71_1164"></a>7.1、索引的分类</h2>
<pre><code class="prism language-sql"><span class="token comment">-- 创建学生表student</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token punctuation">(</span>	
	<span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>LoginPwd<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学生姓名'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>Sex<span class="token punctuation">`</span> <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别,取值0或1'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>GradeID<span class="token punctuation">`</span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'年级编号'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>Phone<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'联系电话,允许为空,即可选输入'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>Adress<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'地址,允许为空,即可选输入'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>BornDate<span class="token punctuation">`</span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'出生时间'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>Email<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱账号,允许为空,即可选输入'</span><span class="token punctuation">,</span>
	<span class="token punctuation">`</span>IdentityCard<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'身份证号'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>StudentNo<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>IdentityCard<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>IdentityCard<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">KEY</span> <span class="token punctuation">`</span>Email<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>Email<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">ENGINE</span><span class="token operator">=</span>MYISAM <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre>
<h3><a id="PRIMARY_KEY_1185"></a>主键索引（PRIMARY KEY）</h3>
<p>唯一的标识，主键不可重复，只有一个列作为主键</p>
<ul><li>最常见的索引类型，不允许为空值</li><li>确保数据记录的唯一性</li><li>确定特定数据记录在数据库中的位置</li></ul>
<pre><code class="prism language-sql"><span class="token comment">-- 创建表的时候指定主键索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tableName<span class="token punctuation">(</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">INDEX</span> <span class="token punctuation">(</span>columeName<span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">-- 修改表结构添加主键索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">INDEX</span> <span class="token punctuation">(</span>columnName<span class="token punctuation">)</span>
</code></pre>
<hr/>
<h3><a id="KEY__INDEX_1206"></a>普通索引（KEY / INDEX）</h3>
<p>默认的，快速定位特定数据</p>
<ul><li>index 和 key 关键字都可以设置常规索引</li><li>应加在查询找条件的字段</li><li>不宜添加太多常规索引,影响数据的插入,删除和修改操作</li></ul>
<pre><code class="prism language-sql"><span class="token comment">-- 直接创建普通索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> tableName <span class="token punctuation">(</span>columnName<span class="token punctuation">)</span>

<span class="token comment">-- 创建表的时候指定普通索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tableName<span class="token punctuation">(</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>columeName<span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment">-- 修改表结构添加普通索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> indexName<span class="token punctuation">(</span>columnName<span class="token punctuation">)</span>
</code></pre>
<hr/>
<h3><a id="UNIQUE_KEY_1230"></a>唯一索引（UNIQUE KEY）</h3>
<p>它与前面的普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值</p>
<p>与主键索引的区别：主键索引只能有一个、唯一索引可以有多个</p>
<pre><code class="prism language-sql"><span class="token comment">-- 直接创建唯一索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> indexName <span class="token keyword">ON</span> tableName<span class="token punctuation">(</span>columnName<span class="token punctuation">)</span>

<span class="token comment">-- 创建表的时候指定唯一索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tableName<span class="token punctuation">(</span>  
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>columeName<span class="token punctuation">)</span>  
<span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment">-- 修改表结构添加唯一索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> tableName <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token punctuation">[</span>indexName<span class="token punctuation">]</span> <span class="token punctuation">(</span>columnName<span class="token punctuation">)</span>
</code></pre>
<hr/>
<h3><a id="FULLText_1252"></a>全文索引（FULLText）</h3>
<p>快速定位特定数据（百度搜索就是全文索引）</p>
<ul><li>在特定的数据库引擎下才有：MyISAM</li><li>只能用于CHAR , VARCHAR , TEXT数据列类型</li><li>适合大型数据集</li></ul>
<pre><code class="prism language-sql"><span class="token comment">-- 增加一个全文索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token keyword">ADD</span> FULLTEXT <span class="token keyword">INDEX</span> <span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- EXPLAIN 分析sql执行的情况</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span> <span class="token comment">-- 非全文索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>StudentName<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 全文索引</span>
</code></pre>
<hr/>
<h2><a id="72_1272"></a>7.2、索引的使用</h2>
<h3><a id="1__1274"></a>1. 索引的创建</h3>
<ul><li>在创建表的时候给字段增加索引</li></ul>
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名 <span class="token punctuation">(</span>
    字段名<span class="token number">1</span> 数据类型 <span class="token punctuation">[</span>完整性约束条件…<span class="token punctuation">]</span><span class="token punctuation">,</span>
    字段名<span class="token number">2</span> 数据类型 <span class="token punctuation">[</span>完整性约束条件…<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token keyword">UNIQUE</span><span class="token operator">|</span>FULLTEXT<span class="token operator">|</span>SPATIAL<span class="token punctuation">]</span> <span class="token keyword">INDEX</span><span class="token operator">|</span><span class="token keyword">KEY</span> <span class="token punctuation">[</span>索引名<span class="token punctuation">]</span> <span class="token punctuation">(</span>字段名<span class="token punctuation">[</span><span class="token punctuation">(</span>长度<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul><li>创建完毕后，增加索引</li></ul>
<pre><code class="prism language-sql"><span class="token comment">-- 方法一：CREATE在已存在的表上创建索引</span>
       <span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">UNIQUE</span><span class="token operator">|</span>FULLTEXT<span class="token operator">|</span>SPATIAL<span class="token punctuation">]</span> <span class="token keyword">INDEX</span> 索引名
       <span class="token keyword">ON</span> 表名 <span class="token punctuation">(</span>字段名<span class="token punctuation">[</span><span class="token punctuation">(</span>长度<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token comment">-- 方法二：ALTER TABLE在已存在的表上创建索引</span>
       <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">ADD</span> <span class="token punctuation">[</span><span class="token keyword">UNIQUE</span><span class="token operator">|</span>FULLTEXT<span class="token operator">|</span>SPATIAL<span class="token punctuation">]</span> 
       <span class="token keyword">INDEX</span> 索引名 <span class="token punctuation">(</span>字段名<span class="token punctuation">[</span><span class="token punctuation">(</span>长度<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre>
<h3><a id="2__1298"></a>2. 索引的删除</h3>
<pre><code class="prism language-sql"><span class="token comment">-- 删除索引</span>
	<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> 索引名 <span class="token keyword">ON</span> 表名<span class="token punctuation">;</span>
<span class="token comment">-- 删除主键索引</span>
	<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="3__1307"></a>3. 显示索引信息</h3>
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
</code></pre>
<h3><a id="4_explainsql_1313"></a>4. explain分析sql执行的情况</h3>
<pre><code class="prism language-sql"><span class="token comment">-- 增加一个全文索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span> <span class="token keyword">ADD</span> FULLTEXT <span class="token keyword">INDEX</span> <span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>StudentName<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- EXPLAIN 分析sql执行的情况</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span> <span class="token comment">-- 非全文索引</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>StudentName<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 全文索引</span>
</code></pre>
<hr/>
<h2><a id="73_1326"></a>7.3、测试索引</h2>
<p><strong>建表app_user：</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>app_user<span class="token punctuation">`</span> <span class="token punctuation">(</span>
    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户昵称'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>email<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户邮箱'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>phone<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>gender<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别（0:男；1：女）'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>age<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> UPDATECURRENT_TIMESTAMP<span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'app用户表'</span>
</code></pre>
<p><strong>批量插入数据：100w</strong></p>
<pre><code class="prism language-sql"><span class="token comment">-- 1418错解决方案(创建函数前执行此语句)</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> log_bin_trust_function_creators<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">-- 插入100万条数据</span>
<span class="token keyword">DELIMITER</span> $$	<span class="token comment">-- 写函数之前要写的标志</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> mock_data<span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">-- 创建mock_data()函数</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">INT</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> num <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> i <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">WHILE</span> i <span class="token operator">&lt;</span> num <span class="token keyword">DO</span>
  		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> app_user<span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>email<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>phone<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>gender<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>age<span class="token punctuation">`</span><span class="token punctuation">)</span>
   		<span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span><span class="token string">'用户'</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'24736743@qq.com'</span><span class="token punctuation">,</span> CONCAT<span class="token punctuation">(</span><span class="token string">'18'</span><span class="token punctuation">,</span> FLOOR<span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">999999999</span><span class="token operator">-</span><span class="token number">100000000</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">100000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>UUID<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FLOOR<span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  		<span class="token keyword">SET</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
	<span class="token keyword">RETURN</span> i<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>

<span class="token comment">-- 执行函数</span>
<span class="token keyword">SELECT</span> mock_data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img alt="image-20210327101253258" src="https://img-blog.csdnimg.cn/img_convert/df271eca3feb9ab506aaed611ef6f087.png"/><br/> <img alt="image-20210327101316627" src="https://img-blog.csdnimg.cn/img_convert/2d3b3bfa01475754f69c4386a214a73a.png"/></p>
<p><strong>测试查询速度</strong></p>
<pre><code class="prism language-sql"><span class="token comment">-- 查询用户名为'用户9999'性能分析</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> app_user <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'用户99999'</span>
</code></pre>
<p><img alt="image-20210327101912627" src="https://img-blog.csdnimg.cn/img_convert/70f2c32ec8c3bbdf6ea0c922108f8d8c.png"/></p>
<p><strong>增加索引后测试</strong></p>
<pre><code class="prism language-sql"><span class="token comment">-- 给name列创建常规索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> id_app_user_name <span class="token keyword">ON</span> app_user<span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token comment">-- 再测试</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> app_user <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'用户99999'</span>
</code></pre>
<p><img alt="image-20210327102830560" src="https://img-blog.csdnimg.cn/img_convert/cd50fa7b12a659d31ffc32e0ef15e20f.png"/><br/> 对比两次结果，速度有了很大的提升</p>
<hr/>
<h2><a id="74_1395"></a>7.4、索引原则</h2>
<ul><li>索引不是越多越好，小数据量的表不需要加索引</li><li>不要对经常变动的数据增加索引</li><li>索引一般加在经常要查询的列上</li></ul>
<hr/>
<br/>
<h1><a id="8explain_1405"></a>8、explain关键字</h1>
<p><strong>建议阅读</strong>：</p>
<ul><li><a href="https://blog.csdn.net/jiadajing267/article/details/81269067">MySQL优化——看懂explain</a></li><li><a href="https://blog.csdn.net/wuseyukui/article/details/71512793?dist_request_id=&amp;depth_1-">MySQL高级 之 explain执行计划详解</a></li></ul>
<hr/>
<br/>
<h1><a id="9_1415"></a>9、权限管理和备份</h1>
<h2><a id="91_1417"></a>9.1、用户管理</h2>
<p><strong>方式一：可视化管理</strong><br/> <img alt="image-20210327123000095" src="https://img-blog.csdnimg.cn/img_convert/26c44c01a054ac4476a6cb2eafb768ff.png"/></p>
<hr/>
<p><strong>方式二：SQL命令操作</strong></p>
<blockquote>
<p>用户信息存储在<code>mysql</code>数据库的<code>user</code>表中，对用户的管理本质上就是对这张表进行增删改查</p>
<p><img alt="image-20210327123240942" src="https://img-blog.csdnimg.cn/img_convert/134b75187269c5e003fd98902cfc959e.png"/></p>
</blockquote>
<pre><code class="prism language-sql"><span class="token comment">-- 创建用户</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> zsr IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span>

<span class="token comment">-- 删除用户</span>
<span class="token keyword">DROP</span> <span class="token keyword">USER</span> zsr

<span class="token comment">-- 修改当前用户密码</span>
<span class="token keyword">SET</span> PASSWORD <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'200024'</span><span class="token punctuation">)</span>

<span class="token comment">-- 修改指定用户密码</span>
<span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> zsr <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'200024'</span><span class="token punctuation">)</span>

<span class="token comment">-- 重命名</span>
<span class="token keyword">RENAME</span> <span class="token keyword">USER</span> zsr <span class="token keyword">to</span> zsr2

<span class="token comment">-- 用户授权(授予全部权限,除了给其他用户授权)</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span>	<span class="token keyword">PRIVILEGES</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> zsr2

<span class="token comment">-- 查询权限</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> zsr
<span class="token comment">-- 查看root用户权限</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> root<span class="token variable">@localhost</span>

<span class="token comment">-- 撤销权限</span>
<span class="token keyword">REVOKE</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> zsr
</code></pre>
<hr/>
<h2><a id="92_1459"></a>9.2、数据库备份</h2>
<p><mark>保证重要的数据不丢失、数据转义</mark></p>
<blockquote>
<p><strong>方式一</strong>：直接拷贝物理文件，MySQL数据表以文件方式存放在磁盘中</p>
</blockquote>
<ul><li> <p>包括表文件 , 数据文件 , 以及数据库的选项文件</p> </li><li> <p>位置 : <code>Mysql安装目录\data\</code>（目录名对应数据库名 , 该目录下文件名对应数据表）</p> <p><img alt="image-20210327125528006" src="https://img-blog.csdnimg.cn/img_convert/7e7cc8befc1537b12c9f7dfd10279114.png"/></p> </li></ul>
<blockquote>
<p><strong>方式二</strong>：可视化管理</p>
</blockquote>
<p>Navicat打开要备份的数据库，然后点击新建备份<br/> <img alt="image-20210327125911151" src="https://img-blog.csdnimg.cn/img_convert/e4240bd95dec14b565b1d86cb1c5c915.png"/><br/> 点击对象选择，这里可以自定义选择备份的表<br/> <img alt="image-20210327130024058" src="https://img-blog.csdnimg.cn/img_convert/3e6c95e2806746c38d0e8627682f6163.png"/><br/> 选择完毕后，点击备份即可开始备份<br/> <img alt="image-20210327130134693" src="https://img-blog.csdnimg.cn/img_convert/8f920ac3f3ad125e54e4f3f10328cbee.png"/><br/> <img alt="image-20210327130213947" src="https://img-blog.csdnimg.cn/img_convert/eeaeff9e0dd440f6dc4df763f5804845.png"/><br/> 等待备份完成，关闭，然后便可看到备份的文件<br/> <img alt="image-20210327130245251" src="https://img-blog.csdnimg.cn/img_convert/056debcb95166ac3195a993db6a9b63b.png"/></p>
<blockquote>
<p><strong>方式三</strong>：可视化管理</p>
</blockquote>
<p>选中要导出的表，右键转储SQL文件<br/> <img alt="image-20210327131239931" src="https://img-blog.csdnimg.cn/img_convert/da7feae09141b97f48ef3133a7385baa.png"/><br/> 然就就可以得到<code>.sql</code>文件<br/> <img alt="image-20210327131430300" src="https://img-blog.csdnimg.cn/img_convert/4d4c9b1c3da14f4fccaf7e4ad0b5c6f5.png"/></p>
<blockquote>
<p><strong>方式四</strong>：命令<code>mysqldump</code>导出</p>
</blockquote>
<pre><code class="prism language-shell"><span class="token comment"># mysqldump -h主机 -u用户名 -p密码 数据库 [表1 表2 表3] &gt;物理磁盘位置/文件名</span>

<span class="token comment"># 导出school数据库的cource grade student表到D:/school.sql</span>
mysqldump -hlocalhost -uroot -p200024 school course grade student <span class="token operator">&gt;</span>D:/school.sql
</code></pre>
<p><img alt="image-20210327132011402" src="https://img-blog.csdnimg.cn/img_convert/5443e1fbd169e2c1e387cb4da76d0b8e.png"/><br/> 然后便可看到导出的<code>sql</code>文件<br/> <img alt="image-20210327132043857" src="https://img-blog.csdnimg.cn/img_convert/4f8735b65d95ecd8db7fcdb3da763e4f.png"/><br/> 然后可以命令行登录mysql，切换到指定的数据库，用<code>source</code>命令导入<br/> <img alt="image-20210327132439737" src="https://img-blog.csdnimg.cn/img_convert/17b6a505af032cce78c98488f1baa215.png"/></p>
<hr/>
<br/>
<h1><a id="10_1509"></a>10、三大范式</h1>
<blockquote>
<p><strong>规范化理论</strong>：改造关系模式，通过分解关系模式来消除其中不合适的数据依赖，以解决插入异常、删除异常、更新异常和数据冗余的问题。</p>
<p>为了建立冗余较小、结构合理的数据库，设计数据库时必须遵循一定规范化理论。在关系型数据库中这种规则就称为<code>范式</code></p>
</blockquote>
<p><a href="https://www.cnblogs.com/wsg25/p/9615100.html">三大范式的通俗理解</a></p>
<ul><li>如果一个关系模式R的所有属性都是不可分的数据项，则R属于<code>第一范式</code></li><li>如果关系模式R属于第一范式，且每一个非主属性完全函数依赖于码，则R属于<code>第二范式</code></li><li>若关系模式R属于第二范式，且R中所有的非主属性都直接依赖于码，则R属于<code>第三范式</code></li></ul>
<img alt="image-20210325220605636" height="200" src="https://gitee.com/zhong_siru/images/raw/master//img/image-20210325220605636.png"/>
<p><strong>规范性问题</strong>：</p>
<blockquote>
<p>数据库的范式是为了规范数据库的设计，但是实际中相比规范性，往往更需要看中性能、成本、用户体验等问题；</p>
<p>因此有时会故意给某些表增加一个冗余的字段，使多表查询变为单表查询。有时还会增加一些计算列，从大数据量变为小数据量（数据量大时，count(*)很耗时，可以直接添加一列，每增加一行+1，查该列即可）；阿里也曾提出关联查询的表最多不超过三张表。</p>
<p>这些就是为了性能、成本而舍弃一定规范性的例子</p>
</blockquote>
<hr/>
<br/>
<h1><a id="11JDBC_1535"></a>11、数据库驱动和JDBC</h1>
<blockquote>
<p>我们编写的程序会通过<strong>数据库驱动</strong>来和数据库进行交互</p>
<img alt="image-20210327150348149" src="https://gitee.com/zhong_siru/images/raw/master//img/image-20210327150348149.png"/>
<p>然后不同的数据库有不同的驱动，这不便于我们程序对各种数据库进行操作；因此为了简化对不同数据库的操作，SUN公司提供了一个Java操作数据库的规范<code>JDBC</code>；不同数据库的规范由对应的数据库厂商完成，对于开发人员，只需要掌握JDBC接口的操作即可</p>
<img alt="image-20210327150911631" src="https://gitee.com/zhong_siru/images/raw/master//img/image-20210327150911631.png"/>
</blockquote>
<h2><a id="1_JDBC_1545"></a>1. 第一个JDBC程序</h2>
<p>1️⃣ <strong>新建空项目</strong></p>
<p><img alt="image-20210327153130998" src="https://img-blog.csdnimg.cn/img_convert/2a6f4995962d7719b5f341ac0d2bfabe.png"/></p>
<p>2️⃣ <strong>导入mysql-connector-java</strong></p>
<p>在项目目录下新建<code>lib</code>目录，放入jar包<br/> <img align="left" alt="image-20210327153240818" src="https://gitee.com/zhong_siru/images/raw/master//img/image-20210327153240818.png"/><br/> <img alt="image-20210327153343389" src="https://img-blog.csdnimg.cn/img_convert/44dc09d9bf971bd3dc0c72cfe8aab10d.png"/><br/> <img alt="image-20210327153457419" src="https://img-blog.csdnimg.cn/img_convert/8b6b89c5197b0356215aa9aed1cbd964.png"/></p>
<p>3️⃣ <strong>编写代码&amp;测试</strong></p>
<p>在<code>src</code>目录下新建<code>JDBCDemo</code>用来操作数据库</p>
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> ClassNotFoundException<span class="token punctuation">,</span> SQLException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.加载驱动</span>
        Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.连接信息url,用户信息</span>
        String url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://localhost:3306/school?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&amp;serverTimezone=UTC"</span><span class="token punctuation">;</span>
        String username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
        String password <span class="token operator">=</span> <span class="token string">"200024"</span><span class="token punctuation">;</span>
        <span class="token comment">//3.连接,获得数据库对象connection</span>
        Connection connection <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//4.获取执行sql的对象</span>
        Statement statement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.执行sql</span>
        String sql <span class="token operator">=</span> <span class="token string">"select * from app_user where id&lt;10"</span><span class="token punctuation">;</span>
        ResultSet resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"id:"</span> <span class="token operator">+</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"phone:"</span> <span class="token operator">+</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//6.释放连接</span>
        resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img alt="image-20210327155209907" src="https://img-blog.csdnimg.cn/img_convert/30ae5d967e49cdbf74b4677938952fc1.png"/></p>
<hr/>
<h2><a id="2_JDBC_1595"></a>2. JDBC对象</h2>
<h3><a id="DriverManager_1597"></a>DriverManager</h3>
<blockquote>
<p><strong>DriverManager</strong>：驱动管理</p>
</blockquote>
<pre><code class="prism language-java"><span class="token comment">//1.加载驱动</span>
Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>本质上执行<code>DriverManager.registerDriver(new com.mysql.cj.jdbc.Driver());</code></p>
<img align="left" alt="image-20210327161110925"/>
<pre><code class="prism language-java"><span class="token comment">//3.连接,获得数据库对象connection</span>
Connection connection <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>connection</code>代表数据库，因此可以设置事务自动提交，事务回滚等</p>
<p><img alt="image-20210327161507445" src="https://img-blog.csdnimg.cn/img_convert/3e5b382f0710809439ab5f7cee170872.png"/></p>
<hr/>
<h3><a id="Statement_1621"></a>Statement</h3>
<blockquote>
<p><strong>Statement</strong>：执行sql的对象，用于向数据库发送SQL语句，想完成对数据库的增删改査，只需要通过这个对象向数据库发送增删改查语句即可</p>
</blockquote>
<pre><code class="prism language-java">statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询操作,返回结果</span>
statement<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//执行sql</span>
statement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//用于增删改,返回受影响的行数</span>
</code></pre>
<p><img alt="image-20210327162622201" src="https://img-blog.csdnimg.cn/img_convert/aa5a397f6e2e376c7e16dbba106e88b6.png"/><br/> <img alt="image-20210327162705203" src="https://img-blog.csdnimg.cn/img_convert/c4587e04579f25dc58864ccfed3184f4.png"/></p>
<hr/>
<h3><a id="ResultSet_1636"></a>ResultSet</h3>
<blockquote>
<p><strong>ResultSet</strong>：查询的结果集，封装了所有查询的结果</p>
</blockquote>
<p><img alt="image-20210327162307420" src="https://img-blog.csdnimg.cn/img_convert/ac1a33619a7021011df6025a57f18ec3.png"/></p>
<hr/>
<h2><a id="3_jdbc_1644"></a>3. 封装jdbc工具类</h2>
<h3><a id="1__1646"></a>1. 编写数据库配置文件</h3>
<p>在<code>src</code>目录下新建<code>db.properties</code>，用于存放数据库配置信息<br/> <img alt="image-20210327165924876" src="https://img-blog.csdnimg.cn/img_convert/aa2ecaf2738632a4b75d2c70e417f8c1.png"/></p>
<pre><code class="prism language-properties">driver=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/school?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&amp;serverTimezone=UTC
username=root
password=200024
</code></pre>
<hr/>
<h3><a id="2__1660"></a>2. 编写工具类</h3>
<p>然后再<code>src</code>目录下新建<code>JDBCUtils.java</code>作为工具类</p>
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>InputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Properties<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtils</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> String driver <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> String url <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> String username <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> String password <span class="token operator">=</span> null<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            InputStream inputStream <span class="token operator">=</span> JDBCDemo<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"db.properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Properties properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
            driver <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            url <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            username <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            password <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//加载驱动</span>
            Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取连接</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> Connection <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//释放连接资源</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span>Connection connection<span class="token punctuation">,</span> Statement statement<span class="token punctuation">,</span> ResultSet resultSet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>resultSet <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> throwables<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                throwables<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>statement <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> throwables<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                throwables<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> throwables<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                throwables<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<hr/>
<h3><a id="3__1725"></a>3. 测试</h3>
<p>修改<code>JDBCDemo</code></p>
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获得数据库对象connection</span>
        Connection connection <span class="token operator">=</span> JDBCUtils<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取sql执行对象statement</span>
        Statement statement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        String sql <span class="token operator">=</span> <span class="token string">"select * from app_user where id&lt;10"</span><span class="token punctuation">;</span>
        ResultSet resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"id:"</span> <span class="token operator">+</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"phone:"</span> <span class="token operator">+</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//释放连接</span>
        JDBCUtils<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> statement<span class="token punctuation">,</span> resultSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img alt="image-20210327171418601" src="https://img-blog.csdnimg.cn/img_convert/d22fdb27412e8514d878f28053d4f820.png"/></p>
<hr/>
<h2><a id="4_SQL_1754"></a>4. SQL注入问题</h2>
<blockquote>
<p>SQL注入即是指<a href="https://baike.baidu.com/item/web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/2498090">web应用程序</a>对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的<a href="https://baike.baidu.com/item/SQL%E8%AF%AD%E5%8F%A5/5714895">SQL语句</a>，在管理员不知情的情况下实现非法操作，以此来实现欺骗<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8/613818">数据库服务器</a>执行非授权的任意查询，从而进一步得到相应的数据信息。</p>
</blockquote>
<p><strong>sql注入案例</strong>：主函数中传入用户名，查找指定名字用户信息</p>
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Connection<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>ResultSet<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Statement<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SQLInjection</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{<!-- --></span>
        <span class="token function">searchName</span><span class="token punctuation">(</span><span class="token string">"' or '1=1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//查找指定名字用户信息</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">searchName</span><span class="token punctuation">(</span>String username<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获得数据库对象connection</span>
        Connection connection <span class="token operator">=</span> JDBCUtils<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取sql执行对象statement</span>
        Statement statement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        String sql <span class="token operator">=</span> <span class="token string">"select * from app_user where name='"</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">;</span>
        ResultSet resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"id:"</span> <span class="token operator">+</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"phone:"</span> <span class="token operator">+</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//释放连接</span>
        JDBCUtils<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> statement<span class="token punctuation">,</span> resultSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>结果</strong>：查询到了数据库中所有的数据<br/> <img alt="image-20210327173159454" src="https://img-blog.csdnimg.cn/img_convert/fa46b5cd881946e10066ced5b621f8b7.png"/><br/> 这里传入一个不是用户名，而是一个不合法字符串，却获取到了全部的数据，为什么呢？</p>
<p>拼接整条sql语句是<code>select * from app_user where name=' ' or '1==1'</code>，其中<code>1==1</code>永远是真的，所以该sql语句相当于查询表中所有的数据；这就是sql注入，主要是字符串拼接引起的问题，十分危险！！</p>
<hr/>
<h2><a id="5_PreparedStatement_1797"></a>5. PreparedStatement对象</h2>
<blockquote>
<p><code>PreparedStatement</code>是<code>Statement</code>的子类，与其相比，可以防止SQL注入，并且效率更高</p>
</blockquote>
<p>同样测试sql注入案例</p>
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SQLInjection</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{<!-- --></span>
        <span class="token function">searchName</span><span class="token punctuation">(</span><span class="token string">"' 'or '1=1'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//登录</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">searchName</span><span class="token punctuation">(</span>String username<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获得数据库对象connection</span>
        Connection connection <span class="token operator">=</span> JDBCUtils<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取sql执行对象preparedStatement(预编译sql,先写不执行,参数用?表示)</span>
        PreparedStatement preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"select * from app_user where name=?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//手动传参</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行sql</span>
        ResultSet resultSet <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"id:"</span> <span class="token operator">+</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"phone:"</span> <span class="token operator">+</span> resultSet<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//释放连接</span>
        JDBCUtils<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> preparedStatement<span class="token punctuation">,</span> resultSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img alt="image-20210327180032468" src="https://img-blog.csdnimg.cn/img_convert/1a164b75b1a4e030974f32f4ed8cec42.png"/><br/> 根据结果，PreparedStatement对象完美避免了sql注入问题</p>
<hr/>
<h2><a id="6__1835"></a>6. 事务案例</h2>
<p>首先创建account表</p>
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> account<span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	money <span class="token keyword">FLOAT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> account<span class="token punctuation">(</span>name<span class="token punctuation">,</span>money<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> account<span class="token punctuation">(</span>name<span class="token punctuation">,</span>money<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> account<span class="token punctuation">(</span>name<span class="token punctuation">,</span>money<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img alt="image-20210414235806762" src="https://img-blog.csdnimg.cn/img_convert/fb7a765f6b6d077503fb3ac8fe2971c7.png"/><br/> 然后编写Java代码</p>
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Connection<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>PreparedStatement<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>SQLException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>Statement<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTransaction</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//获得数据库对象connection</span>
        Connection connection <span class="token operator">=</span> JDBCUtils<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭数据库自动提交,即开启事务</span>
        connection<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String sql1 <span class="token operator">=</span> <span class="token string">"update account set money = money+100 where name = 'A' "</span><span class="token punctuation">;</span>
        String sql2 <span class="token operator">=</span> <span class="token string">"update account set money = money-100 where name = 'B' "</span><span class="token punctuation">;</span>
        <span class="token comment">//获取sql执行对象preparedStatement</span>
        PreparedStatement preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//业务完毕,提交事务</span>
        connection<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//释放资源</span>
        JDBCUtils<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> preparedStatement<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>运行结果：<br/> <img alt="image-20210414235836300" src="https://img-blog.csdnimg.cn/img_convert/61f641ba421658f8bcb574751954b9d4.png"/><br/> 如果两次更新之间加<code>int x = 1 / 0;</code></p>
<p>则会报错，且事务执行失败，两条语句都不会执行成功<br/> <img alt="image-20210327212324221" src="https://img-blog.csdnimg.cn/img_convert/0db32304bfc44277ce777d5b68aedccd.png"/></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>