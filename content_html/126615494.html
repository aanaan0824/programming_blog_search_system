<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<div id="js_content">
<p>“</p>
<p style="text-align:justify;">在移动机器人领域，足式机器人具有广泛的应用价值和发展潜力。本期技术干货，我们邀请到了<strong>小米机器人实验室工程师——周明亮</strong><strong>，通过当下主要采用的串口RS232/RS485、CAN、EtherCAT三类总线的应用，</strong>介绍<strong>足式机器人</strong>的<strong>控制总线</strong><strong>。</strong></p>
<p style="text-align:right;">”</p>
<p><strong>一、前言</strong></p>
<h1></h1>
<p>机器人是“制造业皇冠顶端的明珠”，其研发、制造、应用是衡量一个国家科技创新和高端制造业水平的重要标志。可以预见，机器人与人工智能技术的融合发展，将改变人民的生产生活方式，带来巨大的社会变革与经济效益[1]。</p>
<p>足式机器人凭借其腿部结构优势，可以在离散、非连续的地面上寻找落脚点，相比于轮式和履带式机器人更容易穿越一些非结构化地形，同时非常容易赋予足式机器人一定的负载能力与对外作业能力。因此，足式机器人在移动机器人领域具有更为广泛的应用价值和发展潜力。</p>
<p style="text-align:center;"><img alt="ee44fd00f4cafa34354841fe88b530c7.png" src="image\ee44fd00f4cafa34354841fe88b530c7.png"/></p>
<p style="text-align:center;">图 1 波士顿动力足式机器人</p>
<p><strong>二、机器人总线</strong></p>
<p>足式机器人控制系统涉及三个方面：<strong>控制系统硬件、控制系统软件、控制系统通信</strong>[2]<strong>。</strong>控制系统硬件即控制算法的实现平台，例如单片机、PC机、工控机等。控制系统软件就是控制算法在实时的操作系统下编写。</p>
<p>控制系统通信是运动控制器和其他各个部件的信息传输，如传感器的数据需要传给控制器，控制器的指令需要传给执行器等。目前主要的控制总线有串口总线RS232/RS485、CAN、EtherCAT、PROFINET、PROFIBUS、SERCOS、Ethernet、Modbus、CC-Link、MECHATROLINK等等。考虑到足式机器人控制系统的带宽、稳定性与性价比等因素，目前足式机器人主要采用串口RS232/RS485、CAN、EtherCAT这三类总线。</p>
<p><strong>三、总线应用</strong></p>
<h1><strong><strong><strong>&gt;&gt;&gt;&gt;</strong></strong><strong><strong> </strong></strong></strong><strong>3.1 <strong><strong>串行总线</strong></strong></strong><strong></strong></h1>
<p>串口=COM口（cluster communication port ，串行通讯端口），是指的物理接口形式(硬件)。而TTL、RS-232、RS-485是指的电平标准(电信号)。这种通信方式具有通信接线简单，性价比高，但是通信速率不高特点，无法满足机器人高动态控制。因此一般只能用在舵机制作的仿人机器人上，如优必选的“悟空”机器人，ALPHA EBOT机器人[3]。</p>
<p><img alt="e97455eaf1b2e8fbd8be54ef3653c7c9.png" src="image\e97455eaf1b2e8fbd8be54ef3653c7c9.png"/></p>
<p style="text-align:center;">图 2 优必选“悟空”机器人</p>
<p style="text-align:center;"><img alt="60b32fed49fc1baa943a779dcced8046.png" src="image\60b32fed49fc1baa943a779dcced8046.png"/></p>
<p style="text-align:center;">图 3 优必选 ALPHA EBOT 机器人</p>
<h1><strong><strong><strong>&gt;&gt;&gt;&gt;</strong></strong><strong><strong> </strong></strong></strong><strong>3.2 <strong>高速串行总线</strong></strong></h1>
<p>为了提高串行总线传输速率，增加机器人控制带宽，同时又不带来巨大的成本，杭州宇树科技有限公司(Unitree Robotics)自主研发高速485总线。该总线布局在A1机器狗上，A1机器狗是Laikago的缩减版，最大持续室外奔跑速度为3.3米/秒（11.88千米/小时）[4]，这样的速度和成年人慢跑的速度差不多 。</p>
<p style="text-align:center;"><img alt="83e75995c4d44ca094b43db7a34f8c53.gif" src="https://img-blog.csdnimg.cn/img_convert/83e75995c4d44ca094b43db7a34f8c53.gif"/></p>
<p style="text-align:center;">图 4 宇树科技A1机器狗</p>
<p>宇树A1电机是一款高度集成的永磁同步电机，电机由定子，转子，驱动板，减速器，编码器，轴承构成。电机485串口通信波特率是可达4.8Mb/s，具体参数如下：</p>
<p style="text-align:center;"><img alt="814047700a9487e4a627bd874957b8f6.png" src="image\814047700a9487e4a627bd874957b8f6.png"/></p>
<p style="text-align:center;">表 1 宇树A1电机参数</p>
<p style="text-align:center;"><img alt="f395f603f926b8d30212368e7475a7f1.png" src="image\f395f603f926b8d30212368e7475a7f1.png"/></p>
<p style="text-align:center;">图 5 宇树A1电机</p>
<h1><strong><strong><strong>&gt;&gt;&gt;&gt;</strong></strong><strong><strong> </strong></strong></strong><strong>3.3 <strong>CAN总线</strong></strong></h1>
<p>CAN 是Controller Area Network 的缩写（以下称为CAN），是ISO国际标准化的串行通信协议。在汽车产业中，出于对安全性、舒适性、方便性、低功耗、低成本的要求，各种各样的电子控制系统被开发了出来。由于这些系统之间通信所用的数据类型及对可靠性的要求不尽相同，由多条总线构成的情况很多，线束的数量也随之增加。为适应“减少线束的数量”、“通过多个LAN，进行大量数据的高速通信”的需要，1986 年德国电气商博世公司开发出面向汽车的CAN 通信协议。此后，CAN 通过ISO11898 及ISO11519 进行了标准化，在欧洲已是汽车网络的标准协议[5]。</p>
<p>在CAN总线上，利用CAN_H和CAN_L两根线上的电位差来表示CAN信号。CAN总线上的电位差分为显性电平和隐性电平。其中显性电平为逻辑0，隐性电平为逻辑1，物理层拓扑如下图所示：</p>
<p style="text-align:center;"><img alt="3a4dbaccfafd43bd706232282bec9dfe.png" src="image\3a4dbaccfafd43bd706232282bec9dfe.png"/></p>
<p style="text-align:center;">图 6 CAN总线物理层拓扑</p>
<p>数据链路层如下图所示：</p>
<p style="text-align:center;"><img alt="33b3b3f3538b490562d5fd0d267852fb.png" src="image\33b3b3f3538b490562d5fd0d267852fb.png"/></p>
<p style="text-align:center;">图 7 CAN数据链路层</p>
<p>由于CAN的稳定性，大带宽性，低成本性，目前已经被广泛用在工业机器人领域与足式机器人领域。控制器经过模型预测控制和全身动力学控制，算出关节位置、关节速度以及前馈力矩通过CAN总线发给各个关节电机驱动器，一般总线的波特率设置为1Mb /s。</p>
<p>足式机器人使用CAN通信，一般分为两类，一类为标准CAN通信，一类为CANOPEN协议。</p>
<p><strong>1. 标准CAN通信</strong></p>
<p>比较有名使用标准CAN通信的足式机器人为MIT 发布的Mini Cheetah四足机器人[6,7]，该机器人为了满足传输的数据精度与传输效率，团队将CAN总线的ID场部分位扩充成了数据场，使得命令指令的下发和反馈数据的上传能够分别在一帧内完成。</p>
<p style="text-align:center;"><img alt="dce02bbc4a9b7ab18e3a0a1bc60f2bcc.png" src="image\dce02bbc4a9b7ab18e3a0a1bc60f2bcc.png"/></p>
<p style="text-align:center;">图 8 MIT Mini Cheetah四足机器人</p>
<p>Mini Cheetah控制架构如下所示：</p>
<p style="text-align:center;"><img alt="fabded9e8f1fc2058a0d7ada6bab2c6c.png" src="image\fabded9e8f1fc2058a0d7ada6bab2c6c.png"/></p>
<p style="text-align:center;">图 9 MIT Mini Cheetah四足机器人控制架构</p>
<p><strong>2.</strong> <strong>CANOPEN协议</strong></p>
<p>为了更好的规范机器人主控制器与从节点的数据交互的能力，机器人伺服领域制定了CANOPEN协议。CANOPEN协议是在 20 世纪 90 年代末，由总部位于德国纽伦堡的 CiA 组织——CAN-in-Automation，（http://www.can-cia.org ）在 CAL（CAN Application Layer）的基础上发展而来。CANOPEN总线是一个主从网络，即在 CANOPEN总线中存在一个，负责管理 CANOPEN网络中多个从站。CANOPEN主站以轮询的方式与 CANOPEN从站进行数据交换。</p>
<p>基本的 CANOPEN设备及通讯子协定定义在 CAN in Automation (CiA) draft standard 301中。针对个别设备的子协定以 CiA 301 为基础再进行扩充。如针对 I/O 模组的 CiA401 及针对运动控制的 CiA402 [8]。相关基于CiA402的运控控制CANOPEN协议拓扑如下：</p>
<p style="text-align:center;"><img alt="58df202f23f79bd0eae80bd554439b38.png" src="image\58df202f23f79bd0eae80bd554439b38.png"/></p>
<p style="text-align:center;">图 10 基于CiA402 CANOPEN协议拓扑</p>
<p>目前有许多足式机器人使用这种方式进行控制，如北京理工大学“汇童”5代 BHR-5仿人机器人[9]，如下面图所示：</p>
<p style="text-align:center;"><img alt="bb1db6667ed3b5937b2afb2bdbb783e9.png" src="image\bb1db6667ed3b5937b2afb2bdbb783e9.png"/></p>
<p style="text-align:center;">图 11 “汇童”5代 BHR-5仿人机器人</p>
<h1><strong><strong><strong>&gt;&gt;&gt;&gt;</strong></strong><strong><strong> </strong></strong></strong><strong>3.4 <strong>EtherCAT总线</strong></strong></h1>
<p>近年来仿人机器人研究逐渐成为热门，2022年8月24日，特斯拉通过官方社交平台正式宣布将于北美时间9月30日在加州帕罗奥图举行“AI DAY”人工智能大会。据悉，特斯拉将在本届“AI DAY”上首度展示人形机器人“擎天柱”[10]。而仿人机器人是一个强耦合、非线性、强实时、大数据的系统，因此需要控制总线具备强实时与高带宽特性，故引入了工业实时以太网EtherCAT总线。</p>
<p>EtherCAT(以太网控制自动化技术)是一个以以太网为基础的开放架构的现场总线系统，EtherCAT名称中的CAT为Control Automation Technology(控制自动化技术)首字母的缩写。最初由德国倍福自动化有限公司(Beckhoff Automation GmbH) 研发。EtherCAT为系统的实时性能和拓扑的灵活性树立了新的标准，同时，它还符合甚至降低了现场总线的使用成本。EtherCAT的特点还包括高精度设备同步，可选线缆冗余，和功能性安全协议(SIL3)。</p>
<p>EtherCAT可以支持线形、树形和星形设备连接拓扑结构，物理介质可以选100Base-TX标准以太网电缆或光缆。使用100Base-TX电缆时站间间距可以达到100m。整个网络最多可以连接65535个设备。使用快速以太网全双工通信技术构成主从式的环形结构。</p>
<p>报文通过从站设备时，从站识别出相关的命令并作出相应的处理。完全由硬件完成信息的处理，延迟时间约为100~500ns(取决于物理层器件)，其通信性能和从站设备控制微处理器的响应时间是相互独立的。每个从站设备都具有可编址的内存，其容量最大可为64KB，能够对其进行连续的或同步的读写操作。可以把多个EtherCAT命令数据嵌入到同一个以太网数据帧中，每个数据对应不同的设备或内存区。</p>
<p>从站设备可以构成多种形式的分支结构，独立的设备分支可以放置于控制柜中或机器模块中，再用主线连接这些分支结构。EtherCAT大大提高了现场总线的性能，例如，控制1000个开关量输入和输出的刷新时间约为30μs。单个以太网数据帧最多可容纳1486字节的数据，相当于12000位开关量数字输入和输出，刷新时间约为300μs。控制100个伺服电机的数据通信周期约为100μs。</p>
<p>EtherCAT通信是由主站发起的，主站发出的数据帧传输到一个从站站点时，从站将解析数据帧，每个从站从对应报文中读取输出数据，并将输入数据嵌入到子报文中，同时修改工作计数器WKC的值，以标识从站己处理该报文。网段末端的从站处理完报文后，将报文转发回主站，主站捕获返回的报文并对其进行处理，完成一次通讯过程。一个通讯周期过程中，报文传输延时大概为几个纳秒，克服了传统以太网先对数据包进行解析，再复制成过程数据而造成通讯效率低的缺陷。EtherCAT系统运行原理如图所示：</p>
<p style="text-align:center;"><img alt="a0eeebfe7a20da53fc99c6ad3c13b31a.png" src="image\a0eeebfe7a20da53fc99c6ad3c13b31a.png"/></p>
<p style="text-align:center;">图12 EtherCAT运行原理</p>
<p>仿人机器人自由度较多，多达几十个，主控对关节控制信息量太大，对总线的带宽与实时性要求较高，而传统的RS232、RS485、CAN等通信已经不能够满足设计要求了，因此实时以太网便孕育而生。下面几种实时以太网相比如下：</p>
<p><img alt="cc1f617f82a9a508db57a97314cbea4c.png" src="image\cc1f617f82a9a508db57a97314cbea4c.png"/></p>
<p style="text-align:center;">图13 实时以太网对比</p>
<p>目前许多仿人机器人已经采用EtherCAT总线进行控制，比如优必选著名的Walker机器人[11]。Walker 具备 36 个高性能伺服关节以及力觉、视觉、听觉、空间知觉等全方位的感知系统，可以实现平稳快速的行走和灵活精准的操作。Walker 具备了在常用家庭场景和办公场景的自由活动和服务的能力，开始准备真正走入人们的生活。</p>
<p style="text-align:center;"><img alt="759e68302051f9603e13e5580944dc10.png" src="image\759e68302051f9603e13e5580944dc10.png"/></p>
<p style="text-align:center;">图14 优必选Walker机器人</p>
<p>2022年8月11日，小米分享了在智能机器人与人工智能探索方面的最新进展，小米首个全尺寸人形仿生机器人 CyberOne 正式亮相。小米全尺寸人形仿生机器人 CyberOne 身高 177cm，体重 52kg，艺名为“铁大”。CyberOne 机器人行走速度可达3.6km/h，全身控制也采用EtherCAT[12]。</p>
<p><img alt="b743de59b9f05ed935a4ea3ac47754e5.png" src="image\b743de59b9f05ed935a4ea3ac47754e5.png"/></p>
<p style="text-align:center;">图15 小米铁大机器人</p>
<p><strong>四、总结</strong></p>
<p>随着科学技术的发展，未来机器人将更加智能化，控制也将更加复杂化，要求控制总线更加高实时、高带宽、强稳定。机器人控制总线已经从串口走向了CAN，进而由CAN迈步到工业实时以太网EtherCAT，相信未来也会产生生命力更加强大的控制总线。我们每个人应该去主动拥抱变化，永远相信美好的事情即将发生！</p>
<p><strong>参考文献</strong></p>
<p style="text-align:justify;">[1]黄强,黄岩,余张国.仿人机器人基础理论与技术[M].北京理工大学出版社，2021</p>
<p style="text-align:justify;">[2]https://blog.csdn.net/DQ_Lab/article/details/91953833?spm=1001.2014.3001.5502</p>
<p style="text-align:justify;">[3]https://www.ubtrobot.com/cn/alphamini</p>
<p style="text-align:justify;">[4]https://www.unitree.com/a1</p>
<p style="text-align:justify;">[5]https://baike.baidu.com/item/CAN%E6%80%BB%E7%BA%BF/297754?fr=aladdin</p>
<p style="text-align:justify;">[6]Katz B G. A low cost modular actuator for dynamic robots[D]. Massachusetts Institute of Technology, 2018.</p>
<p style="text-align:justify;">[7]Kim D, Di Carlo J, Katz B, et al. Highly dynamic quadruped locomotion via whole-body impulse control and model predictive control[J]. arXiv preprint arXiv:1909.06586, 2019.</p>
<p style="text-align:justify;">[8]https://baike.baidu.com/item/CANopen/2700924?fr=aladdin</p>
<p style="text-align:justify;">[9]Yu Z, Huang Q, Ma G, et al. Design and development of the humanoid robot BHR-5[J]. Advances in Mechanical Engineering, 2014, 6: 852937.</p>
<p style="text-align:justify;">[10]https://xw.qq.com/cmsid/20220824A08G5Y00</p>
<p style="text-align:justify;">[11]https://www.ubtrobot.com/cn/products/walker/?area=cn</p>
<p style="text-align:justify;">[12]https://baijiahao.baidu.com/s?id=1740873329780073543&amp;wfr=spider&amp;for=pc</p>
<p><img alt="a66416108817ae9f0123874cc59782ca.gif" src="https://img-blog.csdnimg.cn/img_convert/a66416108817ae9f0123874cc59782ca.gif"/></p>
<p style="text-align:center;"><img alt="6ed05a934df3ad2b4ec7d7c5d05cb063.png" src="image\6ed05a934df3ad2b4ec7d7c5d05cb063.png"/></p>
</div>
</div>
</div>