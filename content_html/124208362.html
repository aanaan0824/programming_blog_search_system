<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p>⼀个困扰两天的问题：<br/> 需要通过串⼝向设备发送的数据：0A010 7e 08 00 11 00 00 7e 76 7f<br/> 我先将每个16进制字符转换成10进制，再将其转换成ASCII码对应的字符。<br/> ///&lt;summary&gt;<br/> /// 16进制数组转ASCII字符串<br/> ///&lt;/summary&gt;<br/> ///&lt;param name="strArrHex"&gt;&lt;/param&gt;<br/> ///&lt;returns&gt;&lt;/returns&gt;<br/> publicstaticstring ConvertHexArrToString(string strHex)<br/>         {<!-- --><br/>             StringBuilder sb = new StringBuilder();<br/> string[] strArrHex = strHex.Split('');<br/> foreach (string item in strArrHex)<br/>             {<!-- --><br/> //将⼗六进制转换成10进制<br/> int ten = Convert.ToInt32(item, 16);<br/> char cc = (char)ten;<br/>                 sb.Append(cc);<br/>             }<br/> string s = sb.ToString();<br/> return s;<br/>         }<br/> --------------------------------------------------------</p>
<p>View Code<br/> 这个没有问题，但是7e 08 00 22 00 01 01 74 f4 7f就有问题了<br/> 通过Wireshark抓包发现，只要包含a开头的⼗六进制数都变成了3f。<br/> 捣⿎两天查各种资料终于找到了问题的根源：合法的ASCII码只到0x7F，也就是说，⼤于0x7F的数你转成字符再发送的话，都会变成问号，也即0x3F。<br/> 找到问题了就好解决：不能将其转换成字符，⽽是把要发送的内容转换成16进制字节发送。<br/> //在串⼝通讯过程中，经常要⽤到 16进制与字符串、字节数组之间的转换<br/> publicstaticbyte[] HexStringToBytes(string hs)<br/>         {<!-- --><br/> string[] strArr = hs.Trim().Split('');<br/> byte[] b = newbyte[strArr.Length];<br/> //逐个字符变为16进制字节数据<br/> for (int i = 0; i &lt; strArr.Length; i++)<br/>             {<!-- --><br/>                 b[i] = Convert.ToByte(strArr[i], 16);<br/>             }<br/> //按照指定编码将字节数组变为字符串<br/> return b;<br/>         }<br/> 字符转换成16进制字节<br/> 要发送的数据“0A010 7e 08 00 22 00 01 01 74 f4 7f”<br/> ⾸先将0A010转换成16进制的ASCII码即30 41 30 31 00<br/> 然后将30 41 30 31 00 7e 08 00 22 00 01 01 74 f4 7f 通过HexStringToBytes⽅法转换成字节发送。<br/> 我考，终于搞定了<br/>  </p>
</div>
</div>