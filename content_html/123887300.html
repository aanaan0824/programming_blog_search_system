<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h3><a id="_0"></a>前言：</h3>
<p>用到的迁移命令：<br/> Add-Migration test 生成迁移文件命令，test是迁移文件名称<br/> Update-Database 迁移更新到数据库<br/> <strong>用到的NuGet包</strong><br/> 用于绑定上下文::DbContext<br/> Pomelo.EntityFrameworkCore.MySql<br/> 用于迁移<br/> Microsoft.EntityFrameworkCore.Design<br/> Microsoft.EntityFrameworkCore.Tools</p>
<h4><a id="_web_api_11"></a>一 创建web api项目</h4>
<p>选择asp.net core web api项目下一步<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a7a1171044104820ac497608f808ac63.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/>框架选择.net 6，配置Https要和不要都可以，其他默认，然后点击创建<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/edfc14cc01a9418ca84a6fe63c8cfd3f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 创建完成后是这样的<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/03b321ab5e0643f9a2f12c38b436d2b3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h4><a id="__17"></a>二 创建准备迁移的表</h4>
<p>右键添加文件夹，创建一个Context的文件夹，用于存放创建表的类<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8614b1c857f24c7583481841e626f4be.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b67d7bb1c6f84a998781e4dbc92f5d67.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_17,color_FFFFFF,t_70,g_se,x_16"/><br/> 右键依赖项，点击管理NuGet程序包，搜索安装Pomelo.EntityFrameworkCore.MySql<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0bfa448794f441b4b4da0be7168ff0fc.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_16,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c2b2d6389058427ab6c36e72956bc8fe.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 在Context文件夹创建City类<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e73e4ae6775c4ea3a00548c64603c706.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5fe813f9d8e44f78b297953c5253d3ac.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_12,color_FFFFFF,t_70,g_se,x_16"/><br/> 类定义几个变量，也就是迁移到数据库的字段</p>
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>DataAnnotations</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>ComponentModel<span class="token punctuation">.</span>DataAnnotations<span class="token punctuation">.</span>Schema</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">WebApplication1<span class="token punctuation">.</span>Context</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">City</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Key</span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Column</span><span class="token attribute-arguments"><span class="token punctuation">(</span>TypeName <span class="token operator">=</span> <span class="token string">"nvarchar(100)"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Column</span><span class="token attribute-arguments"><span class="token punctuation">(</span>TypeName <span class="token operator">=</span> <span class="token string">"nvarchar(100)"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> AreaCode <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre>
<p>同样在当前Context文件夹创建DemoContext类，用于绑定上下文<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/594e4012fa4e4efbb35ee7801dd7d101.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_11,color_FFFFFF,t_70,g_se,x_16"/><br/> DemoContext类内容，记住要继承DbContext类</p>
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>EntityFrameworkCore</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">WebApplication1<span class="token punctuation">.</span>Context</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
    <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//添加City类</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>City<span class="token punctuation">&gt;</span></span> Cities <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">//构造函数</span>
        <span class="token keyword">public</span> <span class="token function">DemoContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions<span class="token punctuation">&lt;</span>DemoContext<span class="token punctuation">&gt;</span></span> option<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>
 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<h4><a id="__71"></a>三 开始迁移</h4>
<p>在appsettings.json添加字符串连接串,记得要修改Source：数据库连接地址，Database：数据库名称，User ID：用户名;Password：密码，port：端口号，改成你自己数据库的配置</p>
<pre><code class="prism language-csharp"><span class="token string">"ConnectionStrings"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"DbConnectionString"</span><span class="token punctuation">:</span> <span class="token string">" Data Source=localhost;Database=efcodetest;AllowLoadLocalInfile=true;User ID=root;Password=123456;allowPublicKeyRetrieval=true;pooling=true;CharSet=utf8;port=3306;sslmode=none;"</span>
  <span class="token punctuation">}</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f43e142addb84055ad4e79f3d2d8fcbd.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 在NuGet程序包上搜索安装下面这两个包，Microsoft.EntityFrameworkCore.Tools<br/> Microsoft.EntityFrameworkCore.Design<br/> 用于迁移基本迁移命令在Microsoft.EntityFrameworkCore.Tools描述下就有<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c71fa84856634818a1e355c5722142e2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 在Program.cs配置添加注入下面代码</p>
<pre><code class="prism language-csharp">builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DemoContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>option <span class="token operator">=&gt;</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name"><span class="token keyword">string</span></span> DbConnectionString <span class="token operator">=</span> builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">.</span><span class="token function">GetConnectionString</span><span class="token punctuation">(</span><span class="token string">"DbConnectionString"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    option<span class="token punctuation">.</span><span class="token function">UseMySql</span><span class="token punctuation">(</span>DbConnectionString<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MySqlServerVersion</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Version</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f48aa41ca4e04e0387f509262c50ac7c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 开始迁移，点击工具，NuGet包管理器，程序包管理器控制台，打开控制台<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e054ca8143d34fa4b2e4a7a040270f8d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 生成迁移文件，在控制台输入 Add-Migration test 生成迁移文件命令，test是迁移文件名称，<br/> 然后回车<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5ca96b7f949b44fdbef3236e6e7964dd.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 生成的迁移文件<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3c879039189646f6a1b4ff9b11b955f5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_13,color_FFFFFF,t_70,g_se,x_16"/><br/> 迁移更新到数据库，在刚才的控制台输入Update-Database<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/456107ee3aaf45aebbea3f5416cab6b3.png"/><br/> 回车确认<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/07e863a6575d47faa2149e453191c35d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>查看数据库，有表有库，字段一样，迁移成功<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/aee2428383d74647aac85120105bd7ea.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LuK5aSc5L6G55yL6Zuq,size_18,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>下篇我们來学习.net 6框架下的EF Core操作数据库基本增删改查</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>