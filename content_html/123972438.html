<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>MySQL----多表查询</h3>
<ul><li><ul><li><a href="#_3">多表关系</a></li><li><ul><li><a href="#_5">表与表之间的联系：</a></li><li><a href="#_9">一对多(多对一)</a></li><li><a href="#_15">多对多</a></li><li><a href="#_19">一对一</a></li></ul>
</li><li><a href="#_24">多表查询</a></li><li><a href="#_48">多表查询的分类</a></li><li><a href="#_68">数据准备</a></li><li><a href="#_118">内连接</a></li><li><a href="#_134">外连接</a></li><li><a href="#_153">自连接</a></li><li><a href="#_166">联合查询</a></li><li><a href="#_193">子查询</a></li><li><ul><li><a href="#_208">标量子查询</a></li><li><a href="#_221">列子查询</a></li><li><a href="#_236">行子查询</a></li><li><a href="#_246">表子查询</a></li></ul>
</li><li><a href="#_264">多表查询案例</a></li></ul>
</li></ul>
</div>
<p></p>
<hr/>
<h2><a id="_3"></a>多表关系</h2>
<p>在进行数据库表结构的设计时，会根据业务的需求和业务模块之间的关系，分析设计表结构，由于业务之间相互关联，所以各个表结构之间也存在各种联系</p>
<h3><a id="_5"></a>表与表之间的联系：</h3>
<p>1.一对多(多对一)<br/> 2.多对多<br/> 3.一对一</p>
<h3><a id="_9"></a>一对多(多对一)</h3>
<p>例如，一个员工对应一个部门，一个部门可以对应多个员工<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c254909c33de46e3b3cb2753d89449c8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbTBfNTMwMjI4MTM=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p><strong>一般在多的一方创建外键，指向一的那一方</strong><br/> 员工与部门，在员工表上设置外键，指向部门表</p>
<h3><a id="_15"></a>多对多</h3>
<p>例如，一个学生可以选修多门课程，一个课程可以被多名学生选修<br/> <strong>一般会建立第三张表，至少包含两个外键，分别指向两张表的主键</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7cf5167b12154891b9df7b39da08de3e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbTBfNTMwMjI4MTM=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="_19"></a>一对一</h3>
<p>例如，用户和自己的学历信息的关系，一个人只对应一条学历信息<br/> <strong>可以在任意一方加入外键，关联另一方的主键，并且设置外键为唯一(unique)</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5db544627a9a4fb290e6743b6de3bff2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbTBfNTMwMjI4MTM=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>注：可以放在一张表中，但是对其进行拆分，一张表放基础信息，另一张表放详情，可以提升操作效率</strong></p>
<h2><a id="_24"></a>多表查询</h2>
<p><strong>概述：</strong><br/> 从多张表中查询数据<br/> <strong>笛卡尔积：</strong><br/> 笛卡尔积为两个集合(两张表)中的每条数据进行两两组合的结果<br/> <strong>在多表查询时会产生笛卡尔积，要通过添加条件消除笛卡尔积</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2f6c382f98fd4bc0b0c2b761b8da1418.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbTBfNTMwMjI4MTM=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> dept表：<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/f46995a20ab543ba9fb95ade2b349151.png"/><br/> emp表：<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/e42266b427ee4cf990aa7992a5141bee.png"/><br/> 查询产生笛卡尔积的结果：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span> dept <span class="token punctuation">;</span>
</code></pre>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/363df9da63604fcbab9d127990de1453.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbTBfNTMwMjI4MTM=,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>消除笛卡尔积(添加条件)：</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span> dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/9c332605f46040b2bf255855d27d118b.png"/></p>
<h2><a id="_48"></a>多表查询的分类</h2>
<p>1.连接查询：</p>
<pre><code>内连接：
	相当于查询AB的交集部分
外连接：
		左外连接：
			查询A的所有数据，同时拼接上B对应的数据
		右外连接：
			查询B的所有数据，同时拼接上A中对应的数据
自连接：
	表与自身连接查询
	自连接必须给表取别名
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e9497de5e6094518a4215e521ffbec15.png"/></p>
<p>2.子查询</p>
<h2><a id="_68"></a>数据准备</h2>
<p><strong>部门表：</strong><br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/47526a27507543d4a7f09d839f1fafb7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbTBfNTMwMjI4MTM=,size_10,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> dept <span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">auto_increment</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">comment</span> <span class="token string">'id'</span><span class="token punctuation">,</span>
    name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'部门名称'</span>
<span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'部门表'</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> dept <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'研发部'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'市场部'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'财务部'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'销售部'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'总经办'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'人事部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>员工表：</strong><br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/6e79c273b2e2492b84ba10ca54bfad92.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbTBfNTMwMjI4MTM=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> emp<span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">auto_increment</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">,</span>
    name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token punctuation">,</span>
    age <span class="token keyword">int</span><span class="token punctuation">,</span>
    job <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'职位'</span><span class="token punctuation">,</span>
    salary <span class="token keyword">int</span> <span class="token punctuation">,</span>
    entrydate <span class="token keyword">date</span> <span class="token keyword">comment</span> <span class="token string">'入职时间'</span><span class="token punctuation">,</span>
    managerid <span class="token keyword">int</span> <span class="token keyword">comment</span> <span class="token string">'直属领导id'</span><span class="token punctuation">,</span>
    dept_id <span class="token keyword">int</span> <span class="token keyword">comment</span> <span class="token string">'所在部门id'</span>
<span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'员工表'</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> emp
<span class="token keyword">values</span> <span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'金庸'</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token string">'总裁'</span><span class="token punctuation">,</span> <span class="token number">20000</span><span class="token punctuation">,</span> <span class="token string">'2000-01-01'</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'张无忌'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'项目经理'</span><span class="token punctuation">,</span> <span class="token number">12500</span><span class="token punctuation">,</span> <span class="token string">'2005-12-05'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'杨晓'</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token string">'开发'</span><span class="token punctuation">,</span> <span class="token number">8400</span><span class="token punctuation">,</span> <span class="token string">'2000-11-03'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'韦一笑'</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token string">'开发'</span><span class="token punctuation">,</span> <span class="token number">11000</span><span class="token punctuation">,</span> <span class="token string">'2002-02-05'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'陈玉存'</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token string">'开发'</span><span class="token punctuation">,</span> <span class="token number">10500</span><span class="token punctuation">,</span> <span class="token string">'2004-09-07'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'小昭'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string">'程序员鼓励师'</span><span class="token punctuation">,</span> <span class="token number">6600</span><span class="token punctuation">,</span> <span class="token string">'2004-10-12'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'灭绝'</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token string">'财务总监'</span><span class="token punctuation">,</span> <span class="token number">8500</span><span class="token punctuation">,</span> <span class="token string">'2002-09-12'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'周芷若'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string">'会计'</span><span class="token punctuation">,</span> <span class="token number">48000</span><span class="token punctuation">,</span> <span class="token string">'2006-06-02'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'丁敏君'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token string">'出纳'</span><span class="token punctuation">,</span> <span class="token number">5250</span><span class="token punctuation">,</span> <span class="token string">'2009-05-13'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'赵敏'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'市场部总监'</span><span class="token punctuation">,</span> <span class="token number">12500</span><span class="token punctuation">,</span> <span class="token string">'2004-10-12'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'鹿杖客'</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token string">'职员'</span><span class="token punctuation">,</span> <span class="token number">3750</span><span class="token punctuation">,</span> <span class="token string">'2006-10-03'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'何碧文'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string">'职员'</span><span class="token punctuation">,</span> <span class="token number">3750</span><span class="token punctuation">,</span> <span class="token string">'2007-05-09'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">'东方白'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string">'职员'</span><span class="token punctuation">,</span> <span class="token number">5500</span><span class="token punctuation">,</span> <span class="token string">'2009-02-12'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token string">'张三丰'</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token string">'销售总监'</span><span class="token punctuation">,</span> <span class="token number">14000</span><span class="token punctuation">,</span> <span class="token string">'2004-10-12'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">'鱼梁洲'</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token string">'销售'</span><span class="token punctuation">,</span> <span class="token number">4600</span><span class="token punctuation">,</span> <span class="token string">'2004-10-12'</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">'宋远桥'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">'销售'</span><span class="token punctuation">,</span> <span class="token number">4600</span><span class="token punctuation">,</span> <span class="token string">'2004-10-12'</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token string">'陈友谅'</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token string">'2011-10-12'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">null</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2><a id="_118"></a>内连接</h2>
<p>语法：</p>
<pre><code class="prism language-sql"><span class="token comment"># 隐式内连接</span>
<span class="token keyword">select</span> 字段列表 <span class="token keyword">from</span> 表<span class="token number">1</span><span class="token punctuation">,</span>表<span class="token number">2</span> <span class="token keyword">where</span> 条件<span class="token punctuation">;</span>
<span class="token comment"># 显示内连接</span>
<span class="token keyword">select</span> 字段列表 <span class="token keyword">from</span> 表<span class="token number">1</span> <span class="token punctuation">[</span><span class="token keyword">inner</span><span class="token punctuation">]</span> <span class="token keyword">join</span> 表<span class="token number">2</span> <span class="token keyword">on</span> 连接条件<span class="token punctuation">;</span>
</code></pre>
<p><strong>内连接查询的是两张表交集的部分</strong></p>
<pre><code class="prism language-sql"><span class="token comment"># 查询每一个员工的姓名及关联的部门的名称</span>
<span class="token keyword">select</span> emp<span class="token punctuation">.</span>name<span class="token punctuation">,</span> dept<span class="token punctuation">.</span>name <span class="token keyword">from</span> emp<span class="token punctuation">,</span> dept <span class="token keyword">where</span> emp<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token keyword">select</span> emp<span class="token punctuation">.</span>name<span class="token punctuation">,</span> dept<span class="token punctuation">.</span>name <span class="token keyword">from</span> emp <span class="token keyword">inner</span> <span class="token keyword">join</span> dept <span class="token keyword">on</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre>
<h2><a id="_134"></a>外连接</h2>
<p>语法：</p>
<pre><code class="prism language-sql"><span class="token comment"># 左外连接</span>
<span class="token keyword">select</span> 字段列表 <span class="token keyword">from</span> 表<span class="token number">1</span> <span class="token keyword">left</span> <span class="token punctuation">[</span><span class="token keyword">outer</span><span class="token punctuation">]</span> <span class="token keyword">join</span> 表<span class="token number">2</span> <span class="token keyword">on</span> 条件<span class="token punctuation">;</span>
<span class="token comment"># 右外连接</span>
<span class="token keyword">select</span> 字段列表 <span class="token keyword">from</span> 表<span class="token number">1</span> <span class="token keyword">right</span> <span class="token punctuation">[</span><span class="token keyword">outer</span><span class="token punctuation">]</span> <span class="token keyword">join</span> 表<span class="token number">2</span> <span class="token keyword">on</span> 条件<span class="token punctuation">;</span>
</code></pre>
<p>左外连接相当于查询表1的所有数据包含表1和表2交集的部分数据<br/> 右外连接相当于查询表2的所有数据包含表1和表2交集部分的数据</p>
<pre><code class="prism language-sql"><span class="token comment"># 查询emp表的所有数据，和应于的部门信息(左)</span>
<span class="token keyword">select</span> emp<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> dept<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept <span class="token keyword">on</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
<span class="token comment"># 查询dept表的所有数据，和对于的员工信息(右)</span>
<span class="token keyword">select</span> dept<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> emp<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">right</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept <span class="token keyword">on</span> emp<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre>
<p>左外连接和右外连接可以进行相互转化</p>
<h2><a id="_153"></a>自连接</h2>
<p>语法：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> 字段列表 <span class="token keyword">from</span> 表a 别名a <span class="token keyword">join</span> 表a 别名b <span class="token keyword">on</span> 条件<span class="token punctuation">;</span>
</code></pre>
<p>自链接查询可以是内连接查询也可以是外连接查询</p>
<pre><code class="prism language-sql"><span class="token comment"># 查询员工及其所属领导的名字</span>
<span class="token comment"># 自连接可以看成两张一样的表进行连接查询</span>
<span class="token keyword">select</span> a<span class="token punctuation">.</span>name<span class="token punctuation">,</span> b<span class="token punctuation">.</span>name <span class="token keyword">from</span> emp a <span class="token keyword">join</span> emp b <span class="token keyword">on</span> a<span class="token punctuation">.</span>managerid<span class="token operator">=</span>b<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre>
<h2><a id="_166"></a>联合查询</h2>
<p><strong>union、union all</strong><br/> 对于联合查询就是把多次查询的结果合并起来，形成一个新的查询结果集<br/> 语法：</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> 字段列表 <span class="token keyword">from</span> 表a
<span class="token keyword">union</span> <span class="token punctuation">[</span><span class="token keyword">all</span><span class="token punctuation">]</span>
<span class="token keyword">select</span> 字段列表 <span class="token keyword">from</span> 表b
</code></pre>
<pre><code class="prism language-sql"><span class="token comment"># 将薪资低于5000的员工和年龄大于50的员工查询出来</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> salary<span class="token operator">&gt;</span><span class="token number">5000</span>
<span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> age<span class="token operator">&gt;</span><span class="token number">50</span><span class="token punctuation">;</span>
</code></pre>
<pre><code class="prism language-sql"><span class="token comment"># 没有all重复满足条件的只出现一次</span>
<span class="token comment"># 将薪资低于5000的员工和年龄大于50的员工查询出来</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> salary<span class="token operator">&gt;</span><span class="token number">5000</span>
<span class="token keyword">union</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> age<span class="token operator">&gt;</span><span class="token number">50</span><span class="token punctuation">;</span>
</code></pre>
<p>对于联合查询的多张表的列数必须保持一致，字段类型也要保持一致<br/> union all会将全部的数据直接合并在一起，union会对合并之后的数据去重</p>
<h2><a id="_193"></a>子查询</h2>
<p>概念：SQL语句中嵌套select语句为嵌套查询，又称子查询<br/> <code>select * from 表1 where 字段=(select 字段 from 表2);</code><br/> 子查询外的语句可以是insert、update、delete、select中的一个<br/> 根据子查询的结构不同，分为：</p>
<pre><code>标量子查询：子查询的结果为单个值
列子查询：子查询的结果为一列
行子查询：子查询的结果为一行
表子查询：子查询的结果为多行多列
</code></pre>
<p>根据子查询的位置，分为：</p>
<pre><code>where之后
from之后
select之后
</code></pre>
<h3><a id="_208"></a>标量子查询</h3>
<p>子查询返回的结果是单个值(数字、字符串、日期等)，最简单的形式，这种子查询称为标量子查询<br/> 常用符号：=、&lt;&gt;、&gt;、&gt;=、&lt;、&lt;=</p>
<pre><code class="prism language-sql"><span class="token comment"># 根据销售部门的id查询员工信息</span>
<span class="token comment"># 先分开查询</span>
<span class="token comment"># 查询销售部门的id</span>
<span class="token keyword">select</span> id <span class="token keyword">from</span> dept <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'销售部'</span><span class="token punctuation">;</span> <span class="token comment">#id为4</span>
<span class="token comment"># 查询销售部门中员工的信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> dept_id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment"># 合并为一个查询</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> dept_id<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> dept<span class="token punctuation">.</span>id <span class="token keyword">from</span> dept <span class="token keyword">where</span> dept<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'销售部'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="_221"></a>列子查询</h3>
<p>子查询的结果为一列(可以是多行)的，这种子查询为列子查询<br/> 常用操作符：<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d151d9742f584d97bf96cc06c857806c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAbTBfNTMwMjI4MTM=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-sql"><span class="token comment"># 列子查询</span>
<span class="token comment"># 查询销售部和市场部的所有员工信息</span>
<span class="token comment"># 查询销售部和市场部的id</span>
<span class="token keyword">select</span> id <span class="token keyword">from</span> dept <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'销售部'</span> <span class="token operator">or</span> name<span class="token operator">=</span><span class="token string">'市场部'</span><span class="token punctuation">;</span> <span class="token comment">#id为2 4</span>
<span class="token comment"># 查询两个部门的所有员工</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> dept_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 合并</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> dept_id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> dept <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'销售部'</span> <span class="token operator">or</span> name<span class="token operator">=</span><span class="token string">'市场部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="_236"></a>行子查询</h3>
<p>子查询返回的结果是一行(可以是多列)，这种子查询为行子查询<br/> 常用操作符：=、&lt;&gt;、in、not in</p>
<pre><code class="prism language-sql"><span class="token comment"># 查询与张无忌的薪资及直属领导相同的员工信息</span>
<span class="token comment"># 查询张无忌的薪资和直属领导</span>
<span class="token keyword">select</span> salary<span class="token punctuation">,</span> managerid <span class="token keyword">from</span> emp <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'张无忌'</span><span class="token punctuation">;</span>
<span class="token comment"># 查询与张无忌的薪资及直属领导相同的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token punctuation">(</span>salary<span class="token punctuation">,</span>managerid<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> salary<span class="token punctuation">,</span> managerid <span class="token keyword">from</span> emp <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'张无忌'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a id="_246"></a>表子查询</h3>
<p>子查询的结果是多行多列这种查询为表子查询<br/> 常用操作符：in</p>
<pre><code class="prism language-sql"><span class="token comment"># 查询与鹿杖客和宋远桥的职位和薪资相同的员工信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> <span class="token punctuation">(</span>job<span class="token punctuation">,</span> salary<span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span> <span class="token keyword">select</span> job<span class="token punctuation">,</span> salary <span class="token keyword">from</span> emp <span class="token keyword">where</span> name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'鹿杖客'</span><span class="token punctuation">,</span> <span class="token string">'宋远桥'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>表子查询的子表作为临时表</p>
<pre><code class="prism language-sql"><span class="token comment"># 查询入职日期是’2006-01-01‘之后的员工信息和部门信息</span>
<span class="token comment"># 先查询出入职在’2006-01-01‘之后员工的所有信息</span>
<span class="token comment"># 与部门表左连接</span>
<span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> dept<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> entrydate<span class="token operator">&gt;</span><span class="token string">'2006-01-01'</span><span class="token punctuation">)</span> e <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept <span class="token keyword">on</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>dept<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre>
<h2><a id="_264"></a>多表查询案例</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e896bc8340284ef5827e30ea37027ca9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LiA5Y-q5ZGG55Oc5a2m57yW56iL,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> 数据准备：</p>
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> salgrade <span class="token punctuation">(</span>
    grade <span class="token keyword">int</span><span class="token punctuation">,</span>
    losal <span class="token keyword">int</span> <span class="token keyword">comment</span> <span class="token string">'本薪资等级的最低界限'</span><span class="token punctuation">,</span>
    hisal <span class="token keyword">int</span> <span class="token keyword">comment</span> <span class="token string">'最高界限'</span>
<span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'薪资等级表'</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> salgrade <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> salgrade <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3001</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> salgrade <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5001</span><span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> salgrade <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8001</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> salgrade <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token number">15000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> salgrade <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">15001</span><span class="token punctuation">,</span><span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> salgrade <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">20001</span><span class="token punctuation">,</span><span class="token number">25000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> salgrade <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">025001</span><span class="token punctuation">,</span><span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>1.查询员工的姓名，年龄，职位，部门信息(隐式内连接)</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> e<span class="token punctuation">.</span>name<span class="token punctuation">,</span> e<span class="token punctuation">.</span>age<span class="token punctuation">,</span> e<span class="token punctuation">.</span>job<span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token operator">*</span> 
<span class="token keyword">from</span> emp e<span class="token punctuation">,</span> dept d 
<span class="token keyword">where</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre>
<p>2.查询年龄小于30的员工的姓名、年龄、职位、部门信息(显示内连接)</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> e<span class="token punctuation">.</span>name<span class="token punctuation">,</span>e<span class="token punctuation">.</span>age<span class="token punctuation">,</span>e<span class="token punctuation">.</span>job<span class="token punctuation">,</span>d<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">from</span> emp e
<span class="token keyword">inner</span> <span class="token keyword">join</span> dept d <span class="token keyword">on</span> e<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> d<span class="token punctuation">.</span>id
<span class="token keyword">where</span> e<span class="token punctuation">.</span>age<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span>
</code></pre>
<p>3.查询拥有员工的部门id，部门名称</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">distinct</span> d<span class="token punctuation">.</span>id<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name
<span class="token keyword">from</span> emp e<span class="token punctuation">,</span> dept d
<span class="token keyword">where</span> d<span class="token punctuation">.</span>id<span class="token operator">=</span>e<span class="token punctuation">.</span>dept_id<span class="token punctuation">;</span>
</code></pre>
<p>4.查询所有年龄大于40的员工，及其归属部门名称，如果员工没有分配部门也要显示</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>name
<span class="token keyword">from</span> emp e
<span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept d <span class="token keyword">on</span> e<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> d<span class="token punctuation">.</span>id
<span class="token keyword">where</span> e<span class="token punctuation">.</span>age<span class="token operator">&gt;</span><span class="token number">40</span><span class="token punctuation">;</span>
</code></pre>
<p>5.查询所有员工的工资等级</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span>grade
<span class="token keyword">from</span> emp e<span class="token punctuation">,</span> salgrade s
<span class="token keyword">where</span> e<span class="token punctuation">.</span>salary <span class="token operator">between</span> s<span class="token punctuation">.</span>losal <span class="token operator">and</span> s<span class="token punctuation">.</span>hisal<span class="token punctuation">;</span>
</code></pre>
<p>6.查询研发部所有员工的信息即工资等级</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> e<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span>grade
<span class="token keyword">from</span> emp e<span class="token punctuation">,</span>dept d<span class="token punctuation">,</span>salgrade s
<span class="token keyword">where</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'研发部'</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>salary <span class="token operator">between</span> s<span class="token punctuation">.</span>losal <span class="token operator">and</span> s<span class="token punctuation">.</span>hisal<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>7.查询研发部员工的平均工资</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>salary<span class="token punctuation">)</span>
<span class="token keyword">from</span> emp e<span class="token punctuation">,</span> dept d
<span class="token keyword">where</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id <span class="token operator">and</span> d<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'研发部'</span><span class="token punctuation">;</span>
</code></pre>
<p>8.查询工资比灭绝高的员工信息</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> emp
<span class="token keyword">where</span> emp<span class="token punctuation">.</span>salary <span class="token operator">&gt;</span> <span class="token punctuation">(</span>
                      <span class="token keyword">select</span> e<span class="token punctuation">.</span>salary
                      <span class="token keyword">from</span> emp e
                      <span class="token keyword">where</span> e<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'灭绝'</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>9.查询比平均薪资高的员工信息</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> emp
<span class="token keyword">where</span> salary<span class="token operator">&gt;</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>salary<span class="token punctuation">)</span>
    <span class="token keyword">from</span> emp e
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>10.查询低于本部门平均工资的员工信息</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span>
<span class="token keyword">from</span> emp
<span class="token keyword">where</span> emp<span class="token punctuation">.</span>salary<span class="token operator">&lt;</span><span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
    <span class="token keyword">from</span> emp e
    <span class="token keyword">where</span> e<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>emp<span class="token punctuation">.</span>dept_id
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>11.查询所有部门信息，并统计部门的员工人数</p>
<pre><code class="prism language-sql"><span class="token keyword">select</span> d<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
    <span class="token keyword">from</span> emp
    <span class="token keyword">where</span> emp<span class="token punctuation">.</span>dept_id<span class="token operator">=</span>d<span class="token punctuation">.</span>id
    <span class="token punctuation">)</span>
<span class="token keyword">from</span> dept d<span class="token punctuation">;</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e0089701222a4769add3d7817e879dc1.png"/></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>