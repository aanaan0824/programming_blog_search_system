<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="1__0"></a>1 å‰è¨€</h1>
<p>ğŸ”¥ è¿™ä¸¤å¹´å¼€å§‹æ¯•ä¸šè®¾è®¡å’Œæ¯•ä¸šç­”è¾©çš„è¦æ±‚å’Œéš¾åº¦ä¸æ–­æå‡ï¼Œä¼ ç»Ÿçš„æ¯•è®¾é¢˜ç›®ç¼ºå°‘åˆ›æ–°å’Œäº®ç‚¹ï¼Œå¾€å¾€è¾¾ä¸åˆ°æ¯•ä¸šç­”è¾©çš„è¦æ±‚ï¼Œè¿™ä¸¤å¹´ä¸æ–­æœ‰å­¦å¼Ÿå­¦å¦¹å‘Šè¯‰å­¦é•¿è‡ªå·±åšçš„é¡¹ç›®ç³»ç»Ÿè¾¾ä¸åˆ°è€å¸ˆçš„è¦æ±‚ã€‚</p>
<p>ä¸ºäº†å¤§å®¶èƒ½å¤Ÿé¡ºåˆ©ä»¥åŠæœ€å°‘çš„ç²¾åŠ›é€šè¿‡æ¯•è®¾ï¼Œå­¦é•¿åˆ†äº«ä¼˜è´¨æ¯•ä¸šè®¾è®¡é¡¹ç›®ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯</p>
<p>ğŸš© <strong>Yolovå®‰å…¨å¸½ä½©æˆ´æ£€æµ‹ å±é™©åŒºåŸŸè¿›å…¥æ£€æµ‹</strong></p>
<p>ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)</p>
<ul><li>éš¾åº¦ç³»æ•°ï¼š3åˆ†</li><li>å·¥ä½œé‡ï¼š3åˆ†</li><li>åˆ›æ–°ç‚¹ï¼š4åˆ†</li></ul>
<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p>
<p><a href="https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md">https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md</a></p>
<h1><a id="1__18"></a>1 è¯¾é¢˜èƒŒæ™¯</h1>
<p>å»ºç­‘å·¥äººå¤´éƒ¨ä¼¤å®³æ˜¯é€ æˆå»ºç­‘ä¼¤äº¡äº‹æ•…çš„é‡è¦åŸå› ã€‚ä½©æˆ´å®‰å…¨å¸½æ˜¯é˜²æ­¢å»ºç­‘å·¥äººå‘ç”Ÿè„‘éƒ¨å¤–ä¼¤äº‹æ•…çš„æœ‰æ•ˆæªæ–½,è€Œåœ¨å®é™…å·¥ä½œä¸­å·¥äººæœªä½©æˆ´å®‰å…¨å¸½çš„ä¸å®‰å…¨è¡Œä¸ºæ—¶æœ‰å‘ç”Ÿã€‚å› æ­¤,å¯¹æ–½å·¥ç°åœºå»ºç­‘å·¥äººä½©æˆ´å®‰å…¨å¸½è‡ªåŠ¨å®æ—¶æ£€æµ‹è¿›è¡Œæ¢ç©¶,å°†ä¸ºæ·±å…¥è®¤çŸ¥å’Œä¸»åŠ¨é¢„é˜²å®‰å…¨äº‹æ•…æä¾›æ–°çš„è§†è§’ã€‚ç„¶è€Œ,ä¼ ç»Ÿçš„æ–½å·¥ç°åœºå…·æœ‰å®‰å…¨ç®¡ç†æ°´å¹³ä½ä¸‹ã€ç®¡ç†èŒƒå›´å°ã€ä¸»è¦ä¾é å®‰å…¨ç®¡ç†äººå‘˜çš„ä¸»è§‚ç›‘æµ‹å¹¶ä¸”æ—¶æ•ˆæ€§å·®ã€ä¸èƒ½å…¨ç¨‹ç›‘æ§ç­‰ä¸€ç³»åˆ—é—®é¢˜ã€‚<br/> æœ¬é¡¹ç›®åŸºäºyolov5å®ç°äº†å®‰å…¨å¸½å’Œå±é™©åŒºåŸŸæ£€æµ‹ã€‚</p>
<h1><a id="2__23"></a>2 æ•ˆæœæ¼”ç¤º</h1>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\c9eca4a123be461fb0468204455f971f.png"/><br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\c2b22c8b54304377832ceba32e97a091.png" width="600"/><br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\25696418976a4b5797725f69cd44461a.png" width="600"/></p>
<h1><a id="3_Yolov5_29"></a>3 Yolov5æ¡†æ¶</h1>
<p>æˆ‘ä»¬é€‰æ‹©å½“ä¸‹YOLOæœ€æ–°çš„å·ç§¯ç¥ç»ç½‘ç»œYOLOv5æ¥è¿›è¡Œç«ç„°è¯†åˆ«æ£€æµ‹ã€‚6æœˆ9æ—¥ï¼ŒUltralyticså…¬å¸å¼€æºäº†YOLOv5ï¼Œç¦»ä¸Šä¸€æ¬¡YOLOv4å‘å¸ƒä¸åˆ°50å¤©ã€‚è€Œä¸”è¿™ä¸€æ¬¡çš„YOLOv5æ˜¯å®Œå…¨åŸºäºPyTorchå®ç°çš„ï¼åœ¨æˆ‘ä»¬è¿˜å¯¹YOLOv4çš„å„ç§é«˜ç«¯æ“ä½œã€ä¸°å¯Œçš„å®éªŒå¯¹æ¯”æƒŠå¹ä¸å·²æ—¶ï¼ŒYOLOv5åˆå¸¦æ¥äº†æ›´å¼ºå®æ—¶ç›®æ ‡æ£€æµ‹æŠ€æœ¯ã€‚æŒ‰ç…§å®˜æ–¹ç»™å‡ºçš„æ•°ç›®ï¼Œç°ç‰ˆæœ¬çš„YOLOv5æ¯ä¸ªå›¾åƒçš„æ¨ç†æ—¶é—´æœ€å¿«0.007ç§’ï¼Œå³æ¯ç§’140å¸§ï¼ˆFPSï¼‰ï¼Œä½†YOLOv5çš„æƒé‡æ–‡ä»¶å¤§å°åªæœ‰YOLOv4çš„1/9ã€‚</p>
<p>ç›®æ ‡æ£€æµ‹æ¶æ„åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯two-stageï¼Œä¸€ç§æ˜¯one-stageï¼ŒåŒºåˆ«å°±åœ¨äº two-stage æœ‰region proposalè¿‡ç¨‹ï¼Œç±»ä¼¼äºä¸€ç§æµ·é€‰è¿‡ç¨‹,ç½‘ç»œä¼šæ ¹æ®å€™é€‰åŒºåŸŸç”Ÿæˆä½ç½®å’Œç±»åˆ«ï¼Œè€Œone-stageç›´æ¥ä»å›¾ç‰‡ç”Ÿæˆä½ç½®å’Œç±»åˆ«ã€‚ä»Šå¤©æåˆ°çš„ YOLOå°±æ˜¯ä¸€ç§ one-stageæ–¹æ³•ã€‚YOLOæ˜¯You Only Look Onceçš„ç¼©å†™,æ„æ€æ˜¯ç¥ç»ç½‘ç»œåªéœ€è¦çœ‹ä¸€æ¬¡å›¾ç‰‡ï¼Œå°±èƒ½è¾“å‡ºç»“æœã€‚YOLO ä¸€å…±å‘å¸ƒäº†äº”ä¸ªç‰ˆæœ¬ï¼Œå…¶ä¸­ YOLOv1 å¥ å®šäº†æ•´ä¸ªç³»åˆ—çš„åŸºç¡€ï¼Œåé¢çš„ç³»åˆ—å°±æ˜¯åœ¨ç¬¬ä¸€ç‰ˆåŸºç¡€ä¸Šçš„æ”¹è¿›ï¼Œä¸ºçš„æ˜¯æå‡æ€§èƒ½ã€‚</p>
<p>YOLOv5æœ‰4ä¸ªç‰ˆæœ¬æ€§èƒ½å¦‚å›¾æ‰€ç¤ºï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\48c62c79d0e64f9983226600e2371ee9.png" width="600"/></p>
<p>ç½‘ç»œæ¶æ„å›¾</p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\eda066943f1c45159a014bfb1c258a87.png" width="600"/></p>
<p>YOLOv5æ˜¯ä¸€ç§å•é˜¶æ®µç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œè¯¥ç®—æ³•åœ¨YOLOv4çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¸€äº›æ–°çš„æ”¹è¿›æ€è·¯ï¼Œä½¿å…¶é€Ÿåº¦ä¸ç²¾åº¦éƒ½å¾—åˆ°äº†æå¤§çš„æ€§èƒ½æå‡ã€‚ä¸»è¦çš„æ”¹è¿›æ€è·¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><strong>è¾“å…¥ç«¯</strong></p>
<p>åœ¨æ¨¡å‹è®­ç»ƒé˜¶æ®µï¼Œæå‡ºäº†ä¸€äº›æ”¹è¿›æ€è·¯ï¼Œä¸»è¦åŒ…æ‹¬Mosaicæ•°æ®å¢å¼ºã€è‡ªé€‚åº”é”šæ¡†è®¡ç®—ã€è‡ªé€‚åº”å›¾ç‰‡ç¼©æ”¾ï¼›</p>
<p><strong>Mosaicæ•°æ®å¢å¼º</strong>ï¼šMosaicæ•°æ®å¢å¼ºçš„ä½œè€…ä¹Ÿæ˜¯æ¥è‡ªYOLOv5å›¢é˜Ÿçš„æˆå‘˜ï¼Œé€šè¿‡éšæœºç¼©æ”¾ã€éšæœºè£å‰ªã€éšæœºæ’å¸ƒçš„æ–¹å¼è¿›è¡Œæ‹¼æ¥ï¼Œå¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœå¾ˆä¸é”™<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/917c2e8cfbac46baaa73c2313fea4724.jpeg#pic_center" width="600"/></p>
<p><strong>åŸºå‡†ç½‘ç»œ</strong></p>
<p>èåˆå…¶å®ƒæ£€æµ‹ç®—æ³•ä¸­çš„ä¸€äº›æ–°æ€è·¯ï¼Œä¸»è¦åŒ…æ‹¬ï¼šFocusç»“æ„ä¸CSPç»“æ„ï¼›</p>
<p><strong>Neckç½‘ç»œ</strong></p>
<p>åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸï¼Œä¸ºäº†æ›´å¥½çš„æå–èåˆç‰¹å¾ï¼Œé€šå¸¸åœ¨Backboneå’Œè¾“å‡ºå±‚ï¼Œä¼šæ’å…¥ä¸€äº›å±‚ï¼Œè¿™ä¸ªéƒ¨åˆ†ç§°ä¸ºNeckã€‚Yolov5ä¸­æ·»åŠ äº†FPN+PANç»“æ„ï¼Œç›¸å½“äºç›®æ ‡æ£€æµ‹ç½‘ç»œçš„é¢ˆéƒ¨ï¼Œä¹Ÿæ˜¯éå¸¸å…³é”®çš„ã€‚</p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\55762461d2e54312ba6533e62e2966a0.png" width="600"/><br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\fce6797739b4456695405ecbf5c5ae5a.png" width="600"/></p>
<p>FPN+PANçš„ç»“æ„<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\baa1c7446d4643abb946bd04bbd7a39d.png" width="600"/><br/> è¿™æ ·ç»“åˆæ“ä½œï¼ŒFPNå±‚è‡ªé¡¶å‘ä¸‹ä¼ è¾¾å¼ºè¯­ä¹‰ç‰¹å¾ï¼ˆHigh-Levelç‰¹å¾ï¼‰ï¼Œè€Œç‰¹å¾é‡‘å­—å¡”åˆ™è‡ªåº•å‘ä¸Šä¼ è¾¾å¼ºå®šä½ç‰¹å¾ï¼ˆLow-Levelç‰¹å¾)ï¼Œä¸¤ä¸¤è”æ‰‹ï¼Œä»ä¸åŒçš„ä¸»å¹²å±‚å¯¹ä¸åŒçš„æ£€æµ‹å±‚è¿›è¡Œç‰¹å¾èšåˆã€‚</p>
<p>FPN+PANå€Ÿé‰´çš„æ˜¯18å¹´CVPRçš„PANetï¼Œå½“æ—¶ä¸»è¦åº”ç”¨äºå›¾åƒåˆ†å‰²é¢†åŸŸï¼Œä½†Alexeyå°†å…¶æ‹†åˆ†åº”ç”¨åˆ°Yolov4ä¸­ï¼Œè¿›ä¸€æ­¥æé«˜ç‰¹å¾æå–çš„èƒ½åŠ›ã€‚</p>
<p><strong>Headè¾“å‡ºå±‚</strong></p>
<p>è¾“å‡ºå±‚çš„é”šæ¡†æœºåˆ¶ä¸YOLOv4ç›¸åŒï¼Œä¸»è¦æ”¹è¿›çš„æ˜¯è®­ç»ƒæ—¶çš„æŸå¤±å‡½æ•°GIOU_Lossï¼Œä»¥åŠé¢„æµ‹æ¡†ç­›é€‰çš„DIOU_nmsã€‚</p>
<p>å¯¹äºHeadéƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°ä¸‰ä¸ªç´«è‰²ç®­å¤´å¤„çš„ç‰¹å¾å›¾æ˜¯40Ã—40ã€20Ã—20ã€10Ã—10ã€‚ä»¥åŠæœ€åPredictionä¸­ç”¨äºé¢„æµ‹çš„3ä¸ªç‰¹å¾å›¾ï¼š</p>
<pre><code>â‘ ==&gt;40Ã—40Ã—255

â‘¡==&gt;20Ã—20Ã—255

â‘¢==&gt;10Ã—10Ã—255

</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\81a6f320d1464a80be9e14c0b9e54581.png" width="600"/></p>
<ul><li> <p>ç›¸å…³ä»£ç </p> <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Detect</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    stride <span class="token operator">=</span> <span class="token boolean">None</span>  <span class="token comment"># strides computed during build</span>
    onnx_dynamic <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># ONNX export parameter</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nc<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> anchors<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ch<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># detection layer</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>nc <span class="token operator">=</span> nc  <span class="token comment"># number of classes</span>
        self<span class="token punctuation">.</span>no <span class="token operator">=</span> nc <span class="token operator">+</span> <span class="token number">5</span>  <span class="token comment"># number of outputs per anchor</span>
        self<span class="token punctuation">.</span>nl <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>anchors<span class="token punctuation">)</span>  <span class="token comment"># number of detection layers</span>
        self<span class="token punctuation">.</span>na <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>anchors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>  <span class="token comment"># number of anchors</span>
        self<span class="token punctuation">.</span>grid <span class="token operator">=</span> <span class="token punctuation">[</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>nl  <span class="token comment"># init grid</span>
        self<span class="token punctuation">.</span>anchor_grid <span class="token operator">=</span> <span class="token punctuation">[</span>torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>nl  <span class="token comment"># init anchor grid</span>
        self<span class="token punctuation">.</span>register_buffer<span class="token punctuation">(</span><span class="token string">'anchors'</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>anchors<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>self<span class="token punctuation">.</span>nl<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># shape(nl,na,2)</span>
        self<span class="token punctuation">.</span>m <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>no <span class="token operator">*</span> self<span class="token punctuation">.</span>na<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> ch<span class="token punctuation">)</span>  <span class="token comment"># output conv</span>
        self<span class="token punctuation">.</span>inplace <span class="token operator">=</span> inplace  <span class="token comment"># use in-place ops (e.g. slice assignment)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># inference output</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>nl<span class="token punctuation">)</span><span class="token punctuation">:</span>
            x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>m<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># conv</span>
            bs<span class="token punctuation">,</span> _<span class="token punctuation">,</span> ny<span class="token punctuation">,</span> nx <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>shape  <span class="token comment"># x(bs,255,20,20) to x(bs,3,20,20,85)</span>
            x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>bs<span class="token punctuation">,</span> self<span class="token punctuation">.</span>na<span class="token punctuation">,</span> self<span class="token punctuation">.</span>no<span class="token punctuation">,</span> ny<span class="token punctuation">,</span> nx<span class="token punctuation">)</span><span class="token punctuation">.</span>permute<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>training<span class="token punctuation">:</span>  <span class="token comment"># inference</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>onnx_dynamic <span class="token keyword">or</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">!=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>anchor_grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_make_grid<span class="token punctuation">(</span>nx<span class="token punctuation">,</span> ny<span class="token punctuation">,</span> i<span class="token punctuation">)</span>

                y <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>inplace<span class="token punctuation">:</span>
                    y<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>stride<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token comment"># xy</span>
                    y<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>anchor_grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token comment"># wh</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># for YOLOv5 on AWS Inferentia https://github.com/ultralytics/yolov5/pull/2953</span>
                    xy <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>stride<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token comment"># xy</span>
                    wh <span class="token operator">=</span> <span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>anchor_grid<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token comment"># wh</span>
                    y <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">(</span>xy<span class="token punctuation">,</span> wh<span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                z<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">.</span>view<span class="token punctuation">(</span>bs<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>no<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> x <span class="token keyword">if</span> self<span class="token punctuation">.</span>training <span class="token keyword">else</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_make_grid</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> nx<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> ny<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> self<span class="token punctuation">.</span>anchors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>device
        <span class="token keyword">if</span> check_version<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>__version__<span class="token punctuation">,</span> <span class="token string">'1.10.0'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># torch&gt;=1.10.0 meshgrid workaround for torch&gt;=0.7 compatibility</span>
            yv<span class="token punctuation">,</span> xv <span class="token operator">=</span> torch<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span><span class="token punctuation">[</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>ny<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>nx<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> indexing<span class="token operator">=</span><span class="token string">'ij'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            yv<span class="token punctuation">,</span> xv <span class="token operator">=</span> torch<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span><span class="token punctuation">[</span>torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>ny<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> torch<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>nx<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        grid <span class="token operator">=</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">(</span>xv<span class="token punctuation">,</span> yv<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expand<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>na<span class="token punctuation">,</span> ny<span class="token punctuation">,</span> nx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        anchor_grid <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>anchors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>clone<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>stride<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> \
            <span class="token punctuation">.</span>view<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>na<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expand<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>na<span class="token punctuation">,</span> ny<span class="token punctuation">,</span> nx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> grid<span class="token punctuation">,</span> anchor_grid
</code></pre> </li></ul>
<h1><a id="4__146"></a>4 æ•°æ®å¤„ç†å’Œè®­ç»ƒ</h1>
<h2><a id="41__148"></a>4.1 å®‰å…¨å¸½æ£€æµ‹</h2>
<p>è¿™é‡Œåªæ˜¯åˆ¤æ–­ ã€äººæ²¡æœ‰å¸¦å®‰å…¨å¸½ã€‘ã€ã€äººæœ‰å¸¦å®‰å…¨å¸½ã€‘ã€ã€äººä½“ã€‘ 3ä¸ªç±»åˆ« ï¼ŒåŸºäº data/coco128.yaml æ–‡ä»¶ï¼Œåˆ›å»ºè‡ªå·±çš„æ•°æ®é›†é…ç½®æ–‡ä»¶ custom_data.yamlã€‚<br/> <strong>åˆ›å»ºè‡ªå·±çš„æ•°æ®é›†é…ç½®æ–‡ä»¶</strong></p>
<pre><code class="prism language-python"><span class="token comment"># è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„ labels å’Œ image æ–‡ä»¶çš„ä½ç½®</span>
train<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>score<span class="token operator">/</span>images<span class="token operator">/</span>train
val<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>score<span class="token operator">/</span>images<span class="token operator">/</span>val

<span class="token comment"># number of classes</span>
nc<span class="token punctuation">:</span> <span class="token number">3</span>

<span class="token comment"># class names</span>
names<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token string">'head'</span><span class="token punctuation">,</span> <span class="token string">'helmet'</span><span class="token punctuation">]</span>
</code></pre>
<p><strong>åˆ›å»ºæ¯ä¸ªå›¾ç‰‡å¯¹åº”çš„æ ‡ç­¾æ–‡ä»¶</strong><br/> ä½¿ç”¨ data/gen_data/gen_head_helmet.py æ¥å°† VOC çš„æ•°æ®é›†è½¬æ¢æˆ YOLOv5 è®­ç»ƒéœ€è¦ç”¨åˆ°çš„æ ¼å¼ã€‚<br/> ä½¿ç”¨æ ‡æ³¨å·¥å…·ç±»ä¼¼äº Labelbox ã€CVAT ã€ç²¾çµæ ‡æ³¨åŠ©æ‰‹ æ ‡æ³¨ä¹‹åï¼Œéœ€è¦ç”Ÿæˆæ¯ä¸ªå›¾ç‰‡å¯¹åº”çš„ .txt æ–‡ä»¶ï¼Œå…¶è§„èŒƒå¦‚ä¸‹ï¼š</p>
<ul><li>æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªç›®æ ‡</li><li>ç±»åˆ«åºå·æ˜¯é›¶ç´¢å¼•å¼€å§‹çš„ï¼ˆä»0å¼€å§‹ï¼‰</li><li>æ¯ä¸€è¡Œçš„åæ ‡ class x_center y_center width height æ ¼å¼</li><li>æ¡†åæ ‡å¿…é¡»é‡‡ç”¨å½’ä¸€åŒ–çš„ xywhæ ¼å¼ï¼ˆä»0åˆ°1ï¼‰ã€‚å¦‚æœæ‚¨çš„æ¡†ä»¥åƒç´ ä¸ºå•ä½ï¼Œåˆ™å°†x_centerå’Œwidthé™¤ä»¥å›¾åƒå®½åº¦ï¼Œå°†y_centerå’Œheighté™¤ä»¥å›¾åƒé«˜åº¦ã€‚</li></ul>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> box<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    å°†æ ‡æ³¨çš„ xml æ–‡ä»¶ç”Ÿæˆçš„ã€å·¦ä¸Šè§’x,å·¦ä¸Šè§’y,å³ä¸‹è§’xï¼Œå³ä¸‹è§’yã€‘æ ‡æ³¨è½¬æ¢ä¸ºyolov5è®­ç»ƒçš„åæ ‡
    :param size: å›¾ç‰‡çš„å°ºå¯¸ï¼š [w,h]
    :param box: anchor box çš„åæ ‡ [å·¦ä¸Šè§’x,å·¦ä¸Šè§’y,å³ä¸‹è§’x,å³ä¸‹è§’y,]
    :return: è½¬æ¢åçš„ [x,y,w,h]
    """</span>

    x1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    x2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    dw <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token number">1.</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dh <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token number">1.</span> <span class="token operator">/</span> <span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    w <span class="token operator">=</span> x2 <span class="token operator">-</span> x1
    h <span class="token operator">=</span> y2 <span class="token operator">-</span> y1
    x <span class="token operator">=</span> x1 <span class="token operator">+</span> <span class="token punctuation">(</span>w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
    y <span class="token operator">=</span> y1 <span class="token operator">+</span> <span class="token punctuation">(</span>h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>

    x <span class="token operator">=</span> x <span class="token operator">*</span> dw
    w <span class="token operator">=</span> w <span class="token operator">*</span> dw
    y <span class="token operator">=</span> y <span class="token operator">*</span> dh
    h <span class="token operator">=</span> h <span class="token operator">*</span> dh
    <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">]</span>
</code></pre>
<p>ç”Ÿæˆçš„ .txt ä¾‹å­ï¼š</p>
<pre><code class="prism language-python"><span class="token number">1</span> <span class="token number">0.1830000086920336</span> <span class="token number">0.1396396430209279</span> <span class="token number">0.13400000636465847</span> <span class="token number">0.15915916301310062</span>
<span class="token number">1</span> <span class="token number">0.5240000248886645</span> <span class="token number">0.29129129834473133</span> <span class="token number">0.0800000037997961</span> <span class="token number">0.16816817224025726</span>
<span class="token number">1</span> <span class="token number">0.6060000287834555</span> <span class="token number">0.29579580295830965</span> <span class="token number">0.08400000398978591</span> <span class="token number">0.1771771814674139</span>
<span class="token number">1</span> <span class="token number">0.6760000321082771</span> <span class="token number">0.25375375989824533</span> <span class="token number">0.10000000474974513</span> <span class="token number">0.21321321837604046</span>
<span class="token number">0</span> <span class="token number">0.39300001866649836</span> <span class="token number">0.2552552614361048</span> <span class="token number">0.17800000845454633</span> <span class="token number">0.2822822891175747</span>
<span class="token number">0</span> <span class="token number">0.7200000341981649</span> <span class="token number">0.5570570705458522</span> <span class="token number">0.25200001196935773</span> <span class="token number">0.4294294398277998</span>
<span class="token number">0</span> <span class="token number">0.7720000366680324</span> <span class="token number">0.2567567629739642</span> <span class="token number">0.1520000072196126</span> <span class="token number">0.23123123683035374</span>
</code></pre>
<p><strong>é€‰æ‹©æ¨¡å‹</strong><br/> åœ¨æ–‡ä»¶å¤¹ ./models ä¸‹é€‰æ‹©ä¸€ä¸ªä½ éœ€è¦çš„æ¨¡å‹ç„¶åå¤åˆ¶ä¸€ä»½å‡ºæ¥ï¼Œå°†æ–‡ä»¶å¼€å¤´çš„ nc = ä¿®æ”¹ä¸ºæ•°æ®é›†çš„åˆ†ç±»æ•°ï¼Œä¸‹é¢æ˜¯å€Ÿé‰´ ./models/yolov5s.yamlæ¥ä¿®æ”¹çš„</p>
<pre><code class="prism language-python"><span class="token comment"># parameters</span>
nc<span class="token punctuation">:</span> <span class="token number">3</span>  <span class="token comment"># number of classes     &lt;============ ä¿®æ”¹è¿™é‡Œä¸ºæ•°æ®é›†çš„åˆ†ç±»æ•°</span>
depth_multiple<span class="token punctuation">:</span> <span class="token number">0.33</span>  <span class="token comment"># model depth multiple</span>
width_multiple<span class="token punctuation">:</span> <span class="token number">0.50</span>  <span class="token comment"># layer channel multiple</span>

<span class="token comment"># anchors</span>
anchors<span class="token punctuation">:</span>
  <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">]</span>  <span class="token comment"># P3/8</span>
  <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span><span class="token number">119</span><span class="token punctuation">]</span>  <span class="token comment"># P4/16</span>
  <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span><span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">373</span><span class="token punctuation">,</span><span class="token number">326</span><span class="token punctuation">]</span>  <span class="token comment"># P5/32</span>

<span class="token comment"># YOLOv5 backbone</span>
backbone<span class="token punctuation">:</span>
  <span class="token comment"># [from, number, module, args]</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Focus<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 0-P1/2</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 1-P2/4</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 3-P3/8</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 5-P4/16</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 7-P5/32</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> SPP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 9</span>
  <span class="token punctuation">]</span>

<span class="token comment"># YOLOv5 head</span>
head<span class="token punctuation">:</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Upsample<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'nearest'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat backbone P4</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 13</span>

   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Upsample<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'nearest'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat backbone P3</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 17</span>

   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat head P4</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 20</span>

   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat head P5</span>
   <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 23</span>

   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Detect<span class="token punctuation">,</span> <span class="token punctuation">[</span>nc<span class="token punctuation">,</span> anchors<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># Detect(P3, P4, P5)</span>
  <span class="token punctuation">]</span>

</code></pre>
<p><strong>å¼€å§‹è®­ç»ƒ</strong><br/> è¿™é‡Œé€‰æ‹©äº† yolov5s æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œæƒé‡ä¹Ÿæ˜¯åŸºäº yolov5s.pt æ¥è®­ç»ƒ</p>
<pre><code class="prism language-python">python train<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>img <span class="token number">640</span> \
                <span class="token operator">-</span><span class="token operator">-</span>batch <span class="token number">16</span> <span class="token operator">-</span><span class="token operator">-</span>epochs <span class="token number">10</span> <span class="token operator">-</span><span class="token operator">-</span>data <span class="token punctuation">.</span><span class="token operator">/</span>data<span class="token operator">/</span>custom_data<span class="token punctuation">.</span>yaml \
                <span class="token operator">-</span><span class="token operator">-</span>cfg <span class="token punctuation">.</span><span class="token operator">/</span>models<span class="token operator">/</span>custom_yolov5<span class="token punctuation">.</span>yaml <span class="token operator">-</span><span class="token operator">-</span>weights <span class="token punctuation">.</span><span class="token operator">/</span>weights<span class="token operator">/</span>yolov5s<span class="token punctuation">.</span>pt
</code></pre>
<h2><a id="42__282"></a>4.2 æ£€æµ‹å±é™©åŒºåŸŸå†…æ˜¯å¦æœ‰äºº</h2>
<p><strong>å±é™©åŒºåŸŸæ ‡æ³¨æ–¹å¼</strong></p>
<p>ä½¿ç”¨çš„æ˜¯ ç²¾çµæ ‡æ³¨åŠ©æ‰‹ æ ‡æ³¨ï¼Œç”Ÿæˆäº†å¯¹åº”å›¾ç‰‡çš„ json æ–‡ä»¶</p>
<p><strong>æ‰§è¡Œä¾¦æµ‹</strong></p>
<pre><code class="prism language-python">python area_detect<span class="token punctuation">.</span>py <span class="token operator">-</span><span class="token operator">-</span>source <span class="token punctuation">.</span><span class="token operator">/</span>area_dangerous <span class="token operator">-</span><span class="token operator">-</span>weights <span class="token punctuation">.</span><span class="token operator">/</span>weights<span class="token operator">/</span>helmet_head_person_s<span class="token punctuation">.</span>pt
</code></pre>
<p><strong>æ•ˆæœ</strong><br/> å±é™©åŒºåŸŸä¼šä½¿ç”¨ çº¢è‰²æ¡† æ ‡å‡ºæ¥ï¼ŒåŒæ—¶ï¼Œå±é™©åŒºåŸŸé‡Œé¢çš„äººä½“ä¹Ÿä¼šè¢«æ¡†å‡ºæ¥ï¼Œå±é™©åŒºåŸŸå¤–çš„äººä½“ä¸ä¼šè¢«æ¡†é€‰å‡ºæ¥ã€‚<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\cb41e6d8894d4160af576b17bb5e814b.png"/></p>
<h1><a id="5__299"></a>5 æœ€å</h1>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>