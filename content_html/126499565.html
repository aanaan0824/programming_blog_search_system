<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p id="main-toc"><strong>ç›®å½•</strong></p>
<p id="Vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E5%A4%A7%E8%87%B4%E6%80%9D%E8%B7%AF%EF%BC%9A-toc" style="margin-left:0px;"><a href="#Vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E5%A4%A7%E8%87%B4%E6%80%9D%E8%B7%AF%EF%BC%9A">Vueé¡¹ç›®ä¸­å®ç°ç™»å½•å¤§è‡´æ€è·¯ï¼š</a></p>
<p id="%E7%94%A8%E5%88%B0%E7%9A%84%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E7%94%A8%E5%88%B0%E7%9A%84%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6">ç”¨åˆ°çš„å…³é”®æ–‡ä»¶</a></p>
<p id="%C2%A0%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"> ä¸€ã€å®‰è£…æ’ä»¶</a></p>
<p id="%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAstore%C2%A0-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAstore%C2%A0">äºŒã€åˆ›å»ºstore </a></p>
<p id="%E4%B8%89%E3%80%81%E5%B0%81%E8%A3%85axios-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E5%B0%81%E8%A3%85axios">ä¸‰ã€å°è£…axios</a></p>
<p id="qs%20vue%20%E6%8F%92%E4%BB%B6-toc" style="margin-left:80px;"><a href="#qs%20vue%20%E6%8F%92%E4%BB%B6">qs vue æ’ä»¶</a></p>
<p id="api.js%E7%9A%84%E4%BD%9C%E7%94%A8%C2%A0-toc" style="margin-left:40px;"><a href="#api.js%E7%9A%84%E4%BD%9C%E7%94%A8%C2%A0">api.jsçš„ä½œç”¨ </a></p>
<p id="%E5%9B%9B%E3%80%81%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA">å››ã€è·¯ç”±æ‹¦æˆª</a></p>
<p id="%E4%BA%94%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8">äº”ã€ç™»å½•é¡µé¢å®é™…ä½¿ç”¨</a></p>
<hr id="hr-toc"/>
<p></p>
<h1>Vueé¡¹ç›®ä¸­å®ç°ç™»å½•å¤§è‡´æ€è·¯ï¼š</h1>
<p>1ã€ç¬¬ä¸€æ¬¡ç™»å½•çš„æ—¶å€™ï¼Œå‰ç«¯è°ƒåç«¯çš„ç™»é™†æ¥å£ï¼Œå‘é€ç”¨æˆ·åå’Œå¯†ç </p>
<p>2ã€åç«¯æ”¶åˆ°è¯·æ±‚ï¼ŒéªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼ŒéªŒè¯æˆåŠŸï¼Œå°±ç»™å‰ç«¯è¿”å›ä¸€ä¸ªtoken</p>
<p>3ã€å‰ç«¯æ‹¿åˆ°tokenï¼Œå°†tokenå­˜å‚¨åˆ°localStorageå’Œvuexä¸­ï¼Œå¹¶è·³è½¬è·¯ç”±é¡µé¢</p>
<p>4ã€å‰ç«¯æ¯æ¬¡è·³è½¬è·¯ç”±ï¼Œå°±åˆ¤æ–­ localStroage ä¸­æœ‰æ—  token ï¼Œæ²¡æœ‰å°±è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œæœ‰åˆ™è·³è½¬åˆ°å¯¹åº”è·¯ç”±é¡µé¢</p>
<p>5ã€æ¯æ¬¡è°ƒåç«¯æ¥å£ï¼Œéƒ½è¦åœ¨è¯·æ±‚å¤´ä¸­åŠ token</p>
<p>6ã€åç«¯åˆ¤æ–­è¯·æ±‚å¤´ä¸­æœ‰æ— tokenï¼Œæœ‰tokenï¼Œå°±æ‹¿åˆ°tokenå¹¶éªŒè¯tokenï¼ŒéªŒè¯æˆåŠŸå°±è¿”å›æ•°æ®ï¼ŒéªŒè¯å¤±è´¥ï¼ˆä¾‹å¦‚ï¼štokenè¿‡æœŸï¼‰å°±è¿”å›401ï¼Œè¯·æ±‚å¤´ä¸­æ²¡æœ‰tokenä¹Ÿè¿”å›401</p>
<p>7ã€å¦‚æœå‰ç«¯æ‹¿åˆ°çŠ¶æ€ç ä¸º401ï¼Œå°±æ¸…é™¤tokenä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢</p>
<h3 id="%E7%94%A8%E5%88%B0%E7%9A%84%E5%85%B3%E9%94%AE%E6%96%87%E4%BB%B6">ç”¨åˆ°çš„å…³é”®æ–‡ä»¶</h3>
<p><img alt="" height="232" src="image\81aef141836d4f8294e7db3e12260b5b.png" width="321"/></p>
<h1 id="%C2%A0%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"> ä¸€ã€å®‰è£…æ’ä»¶</h1>
<pre><code>npm install axios; // å®‰è£…axios
npm install vuex  // å®‰è£…vuex</code></pre>
<p>è¡¥å……ï¼š </p>
<ul><li>åˆ›å»ºstoreæ˜¯å¿…é¡»çš„ï¼</li><li>tokenä¸€å®šè¦å­˜åœ¨storageç¼“å­˜ä¸­ï¼Œå¦åˆ™åˆ·æ–°ä¸€ä¸‹ï¼Œstoreä¼šé‡æ–°è¢«åŠ è½½ï¼Œtokenå°±æ²¡äº†ï¼›</li><li>é‚£å­˜åœ¨storeæ˜¯ä¸æ˜¯å¤šä½™äº†ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸ºäº†æ•°æ®ç»Ÿä¸€ç®¡ç†å§ï¼Œä¹Ÿæ˜¯æ•°æ®å¯è§†åŒ–ï¼Œå› ä¸ºç¼“å­˜ä¸­çš„æ•°æ®ä»£ç ä¸­æ˜¯çœ‹ä¸è§çš„ã€‚ï¼ˆä¸ºäº†ä»£ç æ›´å®¹æ˜“è®©åˆ«äººç†è§£æ‰€ä»¥åŠ ä¸Švuexï¼Œä¸åŠ ä¹Ÿä¸å½±å“åšç™»å½•ï¼‰</li></ul>
<h1 id="%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BAstore%C2%A0">äºŒã€åˆ›å»ºstore </h1>
<pre><code class="language-javascript">
import Vue from 'vue'
import Vuex from 'vuex'
Vue.use(Vuex);
// ç”¨Vuex.Storeå¯¹è±¡ç”¨æ¥è®°å½•token
const store = new Vuex.Store({

  state: {
    // å­˜å‚¨token
    token:"",
    userName:"" // å¯é€‰
  },
  getters: {
	getToken(state){
		return state.token || localStorage.getItem("token") || "";
	}
  },
  mutations: {
    // ä¿®æ”¹tokenï¼Œå¹¶å°†tokenå­˜å…¥localStorage
    setToken(state,token) {
      state.token = token;
      localStorage.setItem('token', token);
      console.log('storeã€localstorageä¿å­˜tokenæˆåŠŸï¼');
    },
    delToken(state) {
      state.token = "";
      localStorage.removeItem("token");
    },
    // å¯é€‰
    setUserInfo(state, userName) {
      state.userName = userName;
    }
  },

 actions: {
   // removeToken: (context) =&gt; {
     // context.commit('setToken')
   // }
 },
});
  
export default store;
</code></pre>
<p>å¼•ç”¨åˆ°main.js</p>
<pre><code class="language-javascript">import store from './store'
new Vue({
  router,
  store,
  render: h =&gt; h(App),
}).$mount('#app')
</code></pre>
<p></p>
<h1 id="%E4%B8%89%E3%80%81%E5%B0%81%E8%A3%85axios">ä¸‰ã€å°è£…axios</h1>
<p>request.jsæ–‡ä»¶ç”¨æ¥å°è£…æˆ‘ä»¬çš„axios</p>
<h3 id="qs%20vue%20%E6%8F%92%E4%BB%B6">qs vue æ’ä»¶</h3>
<p>é‡Œé¢æœ‰ç”¨åˆ°qsï¼Œè¿™é‡Œæˆ‘é—¨è®²è§£ä¸‹ä»–çš„ä½œç”¨ï¼š</p>
<p>getæ–¹æ³•ï¼šæˆ‘ä»¬é€šè¿‡å®šä¹‰ä¸€ä¸ªgetå‡½æ•°ï¼Œgetå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæˆ‘ä»¬è¦è¯·æ±‚çš„urlåœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦æºå¸¦çš„è¯·æ±‚å‚æ•°ã€‚getå‡½æ•°è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå½“axioså…¶è¯·æ±‚æˆåŠŸæ—¶resolveæœåŠ¡å™¨è¿”å› å€¼ï¼Œè¯·æ±‚å¤±è´¥æ—¶rejecté”™è¯¯å€¼ã€‚æœ€åé€šè¿‡exportæŠ›å‡ºgetå‡½æ•°ã€‚</p>
<p>postæ–¹æ³•ï¼šåŸç†åŒgetåŸºæœ¬ä¸€æ ·ï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œpostæ–¹æ³•å¿…é¡»è¦ä½¿ç”¨å¯¹æäº¤ä»å‚æ•°å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–çš„æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€šè¿‡nodeçš„qsæ¨¡å—æ¥åºåˆ—åŒ–æˆ‘ä»¬çš„å‚æ•°ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œå¦‚æœæ²¡æœ‰åºåˆ—åŒ–æ“ä½œï¼Œåå°æ˜¯æ‹¿ä¸åˆ°ä½ æäº¤çš„æ•°æ®çš„ã€‚è¿™å°±æ˜¯æ–‡ç« å¼€å¤´æˆ‘ä»¬import QS from â€˜qsâ€™;çš„åŸå› ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œqs æ˜¯ä¸€ä¸ªå¢åŠ äº†ä¸€äº›å®‰å…¨æ€§çš„æŸ¥è¯¢å­—ç¬¦ä¸²è§£æå’Œåºåˆ—åŒ–å­—ç¬¦ä¸²çš„åº“ã€‚</p>
<p>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·è¾“å…¥ï¼šnpm install qs<br/> å®‰è£…å®Œæˆååœ¨éœ€è¦ç”¨åˆ°çš„ç»„ä»¶ä¸­ï¼šimport qs from 'qsâ€™<br/> å…·ä½“ä½¿ç”¨ä¸­æˆ‘æŸ¥çœ‹äº†ï¼šqs.parse()å’Œqs.stringify()</p>
<p>è¿™ä¸¤ç§æ–¹æ³•è™½ç„¶éƒ½æ˜¯åºåˆ—åŒ–ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚<br/> qs.parse()æ˜¯å°†URLè§£ææˆå¯¹è±¡çš„å½¢å¼<br/> qs.stringify()æ˜¯å°†å¯¹è±¡ åºåˆ—åŒ–æˆURLçš„å½¢å¼ï¼Œä»¥&amp;è¿›è¡Œæ‹¼æ¥</p>
<pre><code class="language-javascript">// å°è£…axios
import axios from 'axios'
// åºåˆ—åŒ–
import QS from 'qs';
// vuex
import store from '../store/index'

//è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯åˆ¤æ–­å‡ºå½“å‰æ˜¯å¼€å‘ç¯å¢ƒè¿˜æ˜¯ç”Ÿæˆç¯å¢ƒï¼Œæ–¹æ³•ä¸æ­¢ä¸€ç§ï¼Œè¾¾åˆ°ç›®çš„å°±è¡Œ
// if(process.env.NODE_ENV=="development"){
//   baseURL=''
// }else{
//   baseURL=''
// }

// ä½¿ç”¨è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶å‘é€è¯·æ±‚
const instance = axios.create({
    baseURL: '',
    timeout: 80000,
    headers: {
        // 'Content-Type': 'application/json;charset=UTF-8',
        // 'custome-header':'tianliangjiaoyu'
    }
});
// postè¯·æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸Šä¸€ä¸ªè¯·æ±‚å¤´ï¼Œæ‰€ä»¥å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œä¸€ä¸ªé»˜è®¤çš„è®¾ç½®ï¼Œå³è®¾ç½®postçš„è¯·æ±‚å¤´ä¸º
axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=UTF-8';
// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
instance.interceptors.request.use(function (config) {
    // æ¯æ¬¡å‘é€è¯·æ±‚ä¹‹å‰åˆ¤æ–­vuexä¸­æ˜¯å¦å­˜åœ¨token        
    // å¦‚æœå­˜åœ¨ï¼Œåˆ™ç»Ÿä¸€åœ¨httpè¯·æ±‚çš„headeréƒ½åŠ ä¸Štokenï¼Œè¿™æ ·åå°æ ¹æ®tokenåˆ¤æ–­ä½ çš„ç™»å½•æƒ…å†µ
    // å³ä½¿æœ¬åœ°å­˜åœ¨tokenï¼Œä¹Ÿæœ‰å¯èƒ½tokenæ˜¯è¿‡æœŸçš„ï¼Œæ‰€ä»¥åœ¨å“åº”æ‹¦æˆªå™¨ä¸­è¦å¯¹è¿”å›çŠ¶æ€è¿›è¡Œåˆ¤æ–­ 
    const token = store.getters.getToken;
    if (token) {
        // å·²ç»ç™»å½•æˆåŠŸï¼Œç»Ÿä¸€æ·»åŠ token
        config.headers.Authorization = `Bearer ${token}`
    }
    // token &amp;&amp; (config.headers.Authorization = token);
    return config;
}, function (error) {
    // å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ
    return Promise.reject(error);
});

// è¿™é‡Œè¯´ä¸€ä¸‹tokenï¼Œä¸€èˆ¬æ˜¯åœ¨ç™»å½•å®Œæˆä¹‹åï¼Œå°†ç”¨æˆ·çš„tokené€šè¿‡localStorageæˆ–è€…cookieå­˜åœ¨æœ¬åœ°ï¼Œ
// ç„¶åç”¨æˆ·æ¯æ¬¡åœ¨è¿›å…¥é¡µé¢çš„æ—¶å€™ï¼ˆå³åœ¨main.jsä¸­ï¼‰ï¼Œä¼šé¦–å…ˆä»æœ¬åœ°å­˜å‚¨ä¸­è¯»å–tokenï¼Œå¦‚æœtokenå­˜åœ¨è¯´æ˜ç”¨æˆ·å·²ç»ç™»é™†è¿‡ï¼Œ
// åˆ™æ›´æ–°vuexä¸­çš„tokençŠ¶æ€ã€‚ç„¶åï¼Œåœ¨æ¯æ¬¡è¯·æ±‚æ¥å£çš„æ—¶å€™ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚çš„headerä¸­æºå¸¦tokenï¼Œ
// åå°äººå‘˜å°±å¯ä»¥æ ¹æ®ä½ æºå¸¦çš„tokenæ¥åˆ¤æ–­ä½ çš„ç™»å½•æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ²¡æœ‰æºå¸¦ï¼Œåˆ™è¯´æ˜æ²¡æœ‰ç™»å½•è¿‡ã€‚
// æ·»åŠ å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(function (response) {
    if (response.status === 200) {
        return Promise.resolve(response);
    } else {
        return Promise.reject(response);
    }
}, function (error) {
    // å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ
    if (error.response.status) {
        switch (error.response.status) {
            // 401: æœªç™»å½•
            // æœªç™»å½•åˆ™è·³è½¬ç™»å½•é¡µé¢ï¼Œå¹¶æºå¸¦å½“å‰é¡µé¢çš„è·¯å¾„
            // åœ¨ç™»å½•æˆåŠŸåè¿”å›å½“å‰é¡µé¢ï¼Œè¿™ä¸€æ­¥éœ€è¦åœ¨ç™»å½•é¡µæ“ä½œã€‚                
            case 401:
                router.replace({
                    path: '/login',
                    query: {
                        redirect: router.currentRoute.fullPath
                    }
                });
                break;
            // 403 tokenè¿‡æœŸ
            // ç™»å½•è¿‡æœŸå¯¹ç”¨æˆ·è¿›è¡Œæç¤º
            // æ¸…é™¤æœ¬åœ°tokenå’Œæ¸…ç©ºvuexä¸­tokenå¯¹è±¡
            // è·³è½¬ç™»å½•é¡µé¢                
            case 403:
                this.$message({
                    message: 'ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',
                    duration: 1000,
                    type: 'success'
                });
                // æ¸…é™¤token
                localStorage.removeItem('token');
                store.commit('loginSuccess', null);
                // è·³è½¬ç™»å½•é¡µé¢ï¼Œå¹¶å°†è¦æµè§ˆçš„é¡µé¢fullPathä¼ è¿‡å»ï¼Œç™»å½•æˆåŠŸåè·³è½¬éœ€è¦è®¿é—®çš„é¡µé¢ 
                setTimeout(() =&gt; {
                    router.replace({
                        path: '/login',
                        query: {
                            redirect: router.currentRoute.fullPath
                        }
                    });
                }, 1000);
                break;

            // 404è¯·æ±‚ä¸å­˜åœ¨
            case 404:
                this.$message({
                    message: 'ç½‘ç»œè¯·æ±‚ä¸å­˜åœ¨',
                    duration: 1500,
                    type: 'success'

                });
                break;
            // å…¶ä»–é”™è¯¯ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯æç¤º
            default:
                this.$message({
                    message: error.response.data.message,
                    duration: 1500,
                    type: 'success'

                });
        }
        return Promise.reject(error.response);
    }
});

/** 
 * getæ–¹æ³•ï¼Œå¯¹åº”getè¯·æ±‚ 
 * @param {String} url [è¯·æ±‚çš„urlåœ°å€] 
 * @param {Object} params [è¯·æ±‚æ—¶æºå¸¦çš„å‚æ•°] 
 */
export function get(url, params) {
    return new Promise((resolve, reject) =&gt; {
        instance.get(url, {
            params: params
        })
            .then(res =&gt; {
                resolve(res.data);
            })
            .catch(err =&gt; {
                reject(err.data)
            })
    });
}
/** 
 * postæ–¹æ³•ï¼Œå¯¹åº”postè¯·æ±‚ 
 * @param {String} url [è¯·æ±‚çš„urlåœ°å€] 
 * @param {Object} params [è¯·æ±‚æ—¶æºå¸¦çš„å‚æ•°] 
 */
export function post(url, params, headers) {
    return new Promise((resolve, reject) =&gt; {
        instance.post(url, QS.stringify(params), headers)
            .then(res =&gt; {
                resolve(res.data);
            })
            .catch(err =&gt; {
                reject(err.data)
            })
    });
}

</code></pre>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢çš„this.$messageæ–¹æ³•ï¼Œæ˜¯æˆ‘å¼•å…¥çš„elementåº“ä¸­çš„è½»æç¤ºç»„ä»¶ï¼Œä½ æ ¹æ®ä½ çš„uiåº“ï¼Œå¯¹åº”ä½¿ç”¨ä½ çš„ä¸€ä¸ªæç¤ºç»„ä»¶ã€‚ </p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹tokenï¼Œä¸€èˆ¬æ˜¯åœ¨ç™»å½•å®Œæˆä¹‹åï¼Œå°†ç”¨æˆ·çš„tokené€šè¿‡localStorageæˆ–è€…cookieå­˜åœ¨æœ¬åœ°ï¼Œç„¶åç”¨æˆ·æ¯æ¬¡åœ¨è¿›å…¥é¡µé¢çš„æ—¶å€™ï¼ˆå³åœ¨main.jsä¸­ï¼‰ï¼Œä¼šé¦–å…ˆä»æœ¬åœ°å­˜å‚¨ä¸­è¯»å–tokenï¼Œå¦‚æœtokenå­˜åœ¨è¯´æ˜ç”¨æˆ·å·²ç»ç™»é™†è¿‡ï¼Œåˆ™æ›´æ–°vuexä¸­çš„tokençŠ¶æ€ã€‚ç„¶åï¼Œåœ¨æ¯æ¬¡è¯·æ±‚æ¥å£çš„æ—¶å€™ï¼Œéƒ½ä¼šåœ¨è¯·æ±‚çš„headerä¸­æºå¸¦tokenï¼Œåå°äººå‘˜å°±å¯ä»¥æ ¹æ®ä½ æºå¸¦çš„tokenæ¥åˆ¤æ–­ä½ çš„ç™»å½•æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæ²¡æœ‰æºå¸¦ï¼Œåˆ™è¯´æ˜æ²¡æœ‰ç™»å½•è¿‡ã€‚</p>
<blockquote>
<p>axios.get()æ–¹æ³•å’Œaxios.post()åœ¨æäº¤æ•°æ®æ—¶å‚æ•°çš„ä¹¦å†™æ–¹å¼è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚åŒºåˆ«å°±æ˜¯ï¼Œgetçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª{}ï¼Œç„¶åè¿™ä¸ªå¯¹è±¡çš„paramså±æ€§å€¼æ˜¯ä¸€ä¸ªå‚æ•°å¯¹è±¡çš„ã€‚è€Œpostçš„ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªå‚æ•°å¯¹è±¡ã€‚ä¸¤è€…ç•¥å¾®çš„åŒºåˆ«è¦ç•™æ„å“¦ï¼</p>
</blockquote>
<h2 id="api.js%E7%9A%84%E4%BD%9C%E7%94%A8%C2%A0">api.jsçš„ä½œç”¨ </h2>
<p><strong>è¿™é‡Œæˆ‘ä»¬è¡¥å……ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</strong></p>
<p>apiæ–‡ä»¶çš„ä½œç”¨å°±æ˜¯æ¥å£ç»Ÿä¸€ç®¡ç†</p>
<p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªpostLoginæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°pï¼Œpæ˜¯æˆ‘ä»¬è¯·æ±‚æ¥å£æ—¶æºå¸¦çš„å‚æ•°å¯¹è±¡ã€‚è€Œåè°ƒç”¨äº†æˆ‘ä»¬å°è£…çš„postæ–¹æ³•ï¼Œpostæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬çš„æ¥å£åœ°å€ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯postLoginçš„på‚æ•°ï¼Œå³è¯·æ±‚æ¥å£æ—¶æºå¸¦çš„å‚æ•°å¯¹è±¡ã€‚æœ€åé€šè¿‡exportç»Ÿä¸€å¯¼å‡ºapiFunå¯¹è±¡</p>
<pre><code class="language-javascript">import {get,post} from './request'

let apiFun = null;
apiFun.postLogin = p =&gt; post('api/v1/users/my_address/address_edit_before', p)
export default apiFun;
</code></pre>
<p>ç„¶ååœ¨æˆ‘ä»¬çš„mian.jsæ–‡ä»¶ä¸­å®šä¹‰æˆå…¨å±€å˜é‡ï¼Œæ–¹ä¾¿è°ƒç”¨</p>
<pre><code class="language-javascript">import apiFun from "./network/api";

Vue.prototype.$apiFun = apiFun;//è¯·æ±‚æ¥å£api</code></pre>
<p>ç„¶ååœ¨æˆ‘ä»¬çš„é¡µé¢ä¸­å¯ä»¥è¿™æ ·è°ƒç”¨æˆ‘ä»¬çš„apiæ¥å£ï¼š</p>
<pre><code class="language-javascript">// è°ƒç”¨apiæ¥å£ï¼Œå¹¶ä¸”æä¾›äº†ä¸¤ä¸ªå‚æ•°                
           this.$apiFun.postLogin({                    
                type: 0,                    
                sort: 1                
            }).then(res =&gt; {
                // è·å–æ•°æ®æˆåŠŸåçš„å…¶ä»–æ“ä½œ
                â€¦â€¦â€¦â€¦â€¦â€¦                
            })  </code></pre>
<p>apiæ¥å£ç®¡ç†çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯ï¼Œæˆ‘ä»¬æŠŠapiç»Ÿä¸€é›†ä¸­èµ·æ¥ï¼Œå¦‚æœåæœŸéœ€è¦ä¿®æ”¹æ¥å£ï¼Œæˆ‘ä»¬å°±ç›´æ¥åœ¨api.jsä¸­æ‰¾åˆ°å¯¹åº”çš„ä¿®æ”¹å°±å¥½äº†ï¼Œè€Œä¸ç”¨å»æ¯ä¸€ä¸ªé¡µé¢æŸ¥æ‰¾æˆ‘ä»¬çš„æ¥å£ç„¶åå†ä¿®æ”¹ä¼šå¾ˆéº»çƒ¦.</p>
<h1 id="%E5%9B%9B%E3%80%81%E8%B7%AF%E7%94%B1%E6%8B%A6%E6%88%AA">å››ã€è·¯ç”±æ‹¦æˆª</h1>
<pre><code class="language-javascript">import Vue from "vue"
import Router from "vue-router"
import Home from '../views/Home.vue'
import store from '../store/index'

Vue.use(Router)
let routes = [

    {
        path: '/',
        name: 'Home',
        component: Home,
        // é‡å®šå‘
        redirect: '/publiccloud',
        children: [
            {
                path: '/publiccloud',
                name: 'å…¬æœ‰äº‘ç”¨æˆ·ç®¡ç†',
                component: () =&gt; import('../views/publicCloud/PublicCloud.vue')
            },
            {
                path: '/admin',
                name: 'ç®¡ç†å‘˜ç®¡ç†',
                component: () =&gt; import('../views/admin/Admin.vue')
            }
        ]
    },
    // ç™»é™†é¡µé¢
    {
        path: "/Login",
        name: "ç™»å½•é¡µé¢",
        component: () =&gt; import('../views/login/Login.vue')
    },
];

let router = new Router({
    routes,
    mode: 'history',
    // å…¨å±€é…ç½®æ¿€æ´»è·¯ç”±çš„classç±»åï¼Œå¤„ä¸æ´»è·ƒï¼ˆåŠ¨æ€ï¼‰å°±ä¼šç”¨ä¸Šè¿™ä¸ªç±»å
    linkActiveClass: 'active'
})


// è®¾ç½®è·¯ç”±å®ˆå«ï¼Œåœ¨è¿›é¡µé¢ä¹‹å‰ï¼Œåˆ¤æ–­æœ‰tokenï¼Œæ‰è¿›å…¥é¡µé¢ï¼Œå¦åˆ™è¿”å›ç™»å½•é¡µé¢
if (storage.get("token")) {
    store.commit("setToken", localStorage.getItem("token"));
  }
router.beforeEach((to, from, next) =&gt; {
    // è®¾ç½®è·¯ç”±å®ˆå«ï¼Œåœ¨è¿›é¡µé¢ä¹‹å‰ï¼Œåˆ¤æ–­æœ‰tokenï¼Œæ‰è¿›å…¥é¡µé¢
        if (token) {
            next('/')
        } else {
            // æ²¡æœ‰tokenå°±è°ƒç”¨åç«¯æ¥å£ï¼Œè·³è½¬åœ°å€
            getAddress().then((res) =&gt; {
              if (res.data.code === 200) {
                location.href = res.data.data.redirectUri
              }
            })
        }
});
export default router</code></pre>
<h1 id="%E4%BA%94%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8">äº”ã€ç™»å½•é¡µé¢å®é™…ä½¿ç”¨</h1>
<pre><code class="language-javascript">

submitForm(formName) {
      this.$refs[formName].validate(valid =&gt; {
        if (valid) {
          let that = this;
          // console.log('username',this.loginForm.username)
          // é€šè¿‡æ ¡éªŒè§„åˆ™åè¿›å…¥æ ¡éªŒç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
          // æ²¡æœ‰åå°æ¥å£å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥æ¨¡æ‹Ÿï¼Œæ›¿æ¢postLogin
          this.$apiFun.postLogin(this.loginForm.username, this.loginForm.password)
            .then(res =&gt; {
              console.log(res);
              
               that.$store.commit("setToken", res.data.token);
               that.$store.commit("setUserInfo", res.data.account);

              this.$notify({
                title: "ç™»å½•æˆåŠŸ",
                type: "success",
                showClose: false,
                duration: 1000
              });
              setTimeout(() =&gt; {
                // æ­¤æ—¶è¦åˆ¤æ–­/loginåé¢çš„å‚æ•°redirectï¼Œè‹¥æ— å‚æ•°ï¼Œè¿›å…¥ä¸»é¡µï¼›
                this.$router.push("/index");
                // è‹¥æœ‰å‚æ•°åˆ™å‚æ•°ä¸ºæœªæœ‰æƒé™çš„é‚£ä¸ªè·¯ç”±ï¼Œè·³è½¬åˆ°é‚£ä¸ªè·¯ç”±
                // this.$router.push(***); -- å…·ä½“è¦è‡ªå·±åœ¨è¿™å®ç°
              }, 1000);
            })
            .catch(error =&gt; {
            // é”™è¯¯åˆ†ä¸º status-è¯·æ±‚é”™è¯¯ å’Œ code-è´¦å·å¯†ç é”™è¯¯
              this.$message.error(error);
              console.log(error);
            });
        } else {
        // ä¸ç¬¦åˆå‰ç«¯æ ¡éªŒ
          this.$message.error('format errorï¼š'+error);
          console.log('format errorï¼š',error);
          return false;
        }
      });
    }
</code></pre>
<p>å¦‚æœå–œæ¬¢ï¼Œå°±ç»™ä¸ªâ¤å§</p>
<p>æƒ³è®¤è¯†åšä¸»çš„è¯è¿™é‡Œå“¦ğŸ‘‡</p>
</div>
</div>