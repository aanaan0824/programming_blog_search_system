<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="2021F_1"></a>2021电赛F题视觉教程+代码免费开源</h1>
<blockquote>
<p>最近好多要电赛题的源码，其他csdn营销号下载都需要会员或钱，正好最近课设又要做一遍电赛小车题，哥们先把代码开源了，饿死营销号</p>
</blockquote>
<p>电赛宝藏链接：</p>
<p>四天三夜，那布满着未知与紧迫感的气息让荷尔蒙无比兴奋，挑战着脑力与体力的极限！<br/> <a href="https://blog.csdn.net/zhaohaobingniu/article/details/121259332?spm=1001.2014.3001.5502">2021全国大学生电子设计竞赛F题参赛简记</a></p>
<p>2021年小车题完整代码及教程！<br/> <a href="https://blog.csdn.net/zhaohaobingniu/article/details/122211255?spm=1001.2014.3001.5502">2021电赛F题视觉教程+代码免费开源</a></p>
<p>其他年份的经典题目的源码都在这里啦！<br/> <a href="https://blog.csdn.net/zhaohaobingniu/article/details/124087352?spm=1001.2014.3001.5502">【电赛源码合集】19电磁炮.zip、17板球.zip、15风力摆.zip、13倒立摆.zip、全国大学生电子设计竞赛历年真题（1994-2021）.zip</a></p>
<p>参加电赛必看的经验贴！<br/> <a href="https://blog.csdn.net/zhaohaobingniu/article/details/124086257?spm=1001.2014.3001.5502">全国电子设计竞赛指导 （老学长挥泪经验之谈）</a></p>
<p>论文模板及评分标准！<br/> <a href="https://blog.csdn.net/zhaohaobingniu/article/details/124085261?spm=1001.2014.3001.5502">全国大学生电子设计竞赛论文写作模板及评分标准</a></p>
<p>正文开始咯：<br/> 视觉的一个任务是视觉上位机模块识别数字并进行滤波和判断处理，传指令给下位机；另一个任务是红线循迹。</p>
<p>不多bb，先上代码和效果图~</p>
<ul><li> <p>链接：<a href="https://github.com/zhaohaobingSUI/ZHB_project_diansai/tree/master">GitHub——2021电赛F题所有程序</a></p> </li><li> <p>链接：<a href="https://github.com/zhaohaobingSUI/ZHB_project_diansai/tree/master/ZHB_K210_5.0%282021%E7%94%B5%E8%B5%9BF%E9%A2%98%E8%A7%86%E8%A7%89%E6%95%B0%E5%AD%97%E8%AF%86%E5%88%AB%29">GitHub——K210数字识别模型文件及主程序</a></p> </li><li> <p>链接：<a href="https://github.com/zhaohaobingSUI/ZHB_project_diansai/tree/master/ZHB_openmv_redline%282021%E7%94%B5%E8%B5%9BF%E9%A2%98%E8%A7%86%E8%A7%89%E7%BA%A2%E7%BA%BF%E5%BE%AA%E8%BF%B9%29">GitHub——openmv循迹主程序分享</a></p> </li><li> <p>链接：<a href="https://pan.baidu.com/s/1ltrhB3WN7EX_keB2xvppGA">百度网盘——小车主板pcb文件</a><br/> 提取码：3n50<br/> –来自百度网盘超级会员V3的分享</p> </li><li> <p>README：蓝牙连接后，发送字符 " t " 给小车进入测试程序</p> </li></ul>
<p>K210数字识别效果：（我媛哥的手真好看）<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/f9281b92ea0243408802e641589743cd.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>openmv红线循迹效果：<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/d1395bc3b4a54eca9617292626247ec7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_9,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>小车整体图：<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/54615433419a4932b446ea3b73ec2839.png"/></p>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/3a304e39209f49c69fe1922a4a3bd774.png"/></p>
<p>硬件工具：K210、openmv</p>
<p>软件工具：Maixpy IDE、OpenMV IDE</p>
<p>IDE可到官网下载：</p>
<p><a href="https://www.sipeed.com/index.html">https://www.sipeed.com/index.html</a></p>
<p><a href="https://singtown.com/openmv/">https://singtown.com/openmv/</a><br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/5c07eab058d44af2801ee53450f96984.png"/></p>
<p></p>
<div class="toc">
<h3>文章目录</h3>
<ul><li><a href="#2021F_1">2021电赛F题视觉教程+代码免费开源</a></li><li><ul><li><a href="#1_K210_72">1. K210数字识别、滤噪、判断</a></li><li><ul><li><a href="#11__78">1.1 功能难点及对应函数实现分析</a></li><li><a href="#12_YOLOV5_116">1.2 YOLOV5神经网络模型训练</a></li><li><a href="#13_K210_147">1.3 K210操作步骤</a></li><li><ul><li><a href="#131_K210IDE_149">1.3.1 下载K210的IDE</a></li><li><a href="#132__153">1.3.2 烧入最新固件库</a></li><li><a href="#133_TF_164">1.3.3 将文件放入TF卡中</a></li><li><a href="#134_IED_175">1.3.4 IED中查看效果</a></li><li><a href="#135__182">1.3.5 通过串口调试助手测试指令通信</a></li></ul>
</li><li><a href="#14__195">1.4 上代码含详细注释</a></li></ul>
</li><li><a href="#2_OPENMV_562">2. OPENMV红线循迹</a></li></ul>
</li></ul>
</div>
<p></p>
<h2><a id="1_K210_72"></a>1. K210数字识别、滤噪、判断</h2>
<p>正常操作是上位机是识别，给下位机传数据，处理放到下位机；假如你有个坑比队友，处理还是放上位机干吧；</p>
<p>经过算法优化，现在几乎不存在掉帧。</p>
<h3><a id="11__78"></a>1.1 功能难点及对应函数实现分析</h3>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/9b06bc987a6c4f4d95369113576637d9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>1、在小车行驶过程中，会存在数字不能完全进入视野中情况等存在有很多帧误识情况，要进行滤噪处理</p>
<p>2、每一帧要做处理的同时每个目标值的矩形框进行处理，每个目标值的矩形框还要进行滤波</p>
<p>3、在上位机上不断的优化算法，减少掉帧</p>
<p>4、在Maixpy IDE中python 的numpy、pandas巴拉巴拉包都调不了</p>
<p>5、图中最多出现四个，但这里设了读六个矩形框，留两个容错，不然有误识别的直接死机</p>
<p>6、给下位机传送指令：</p>
<p>一开始初始化识别传送对应的数字</p>
<p>若为12，则后面不在传送指令</p>
<p>若为34，则后面路口处传"l"or"r"</p>
<p>若为5678，则后面两个路口传送两次"l"or“r”</p>
<p>7、设计思路</p>
<p>通过初始化函数识别一开始给入的数字并保存下来；</p>
<p>根据识别的情况进入不同的程序；</p>
<p>12号病房，识别完了以后是不用在路上在识别的，直接关掉程序；</p>
<p>34号病房，初始化识别完了，加两秒延迟，避免在开始的时候连续识别传指令，要在路上识别一次，要保证返回来的时候不识别不然又给下位机传指令了，还要保证初始化识别完了以后不会紧接着识别误认为是路上的标签给下位机传指令；</p>
<p>5678也一样，但是路上得识别两次穿两次指令；</p>
<h3><a id="12_YOLOV5_116"></a>1.2 YOLOV5神经网络模型训练</h3>
<p>训练集：</p>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/6044f77fc83547b2aec42bb0dd30b24e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>测试集：</p>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/a361a9f66961410dadbb64f719535328.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>训练输出结果：</p>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/9bdc118812d3440b94676bc5286ba440.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>将通过拍摄3403张赛道数字照片，使用labellmg进行标签标定，制作数据集，yolov5训练<br/> （哥们和队友从晚上十点标到凌晨两点（哭脸））</p>
<p>详细过程可看下面文章：</p>
<p><a href="https://blog.csdn.net/zhaohaobingniu/article/details/120397185?spm=1001.2014.3001.5502">YOLOV5：数据集制作</a></p>
<p><a href="https://blog.csdn.net/zhaohaobingniu/article/details/120255571?spm=1001.2014.3001.5502">YOLOV5：不懂代码也能使用YOLOV5跑项目</a></p>
<p>注意：这里yolov5得到的是.pt文件，需要进行模型转换，转化成可以加载在K210板上的.kmodel模型（后面细讲）</p>
<h3><a id="13_K210_147"></a>1.3 K210操作步骤</h3>
<h4><a id="131_K210IDE_149"></a>1.3.1 下载K210的IDE</h4>
<p><a href="https://www.sipeed.com/index.html">https://www.sipeed.com/index.html</a></p>
<h4><a id="132__153"></a>1.3.2 烧入最新固件库</h4>
<p>官方教程：</p>
<p><a href="https://wiki.sipeed.com/soft/maixpy/zh/get_started/upgrade_maixpy_firmware.html">https://wiki.sipeed.com/soft/maixpy/zh/get_started/upgrade_maixpy_firmware.html</a></p>
<p>更新固件库：</p>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/02dc25a896d9451a9ef60053be9b7b8b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_12,color_FFFFFF,t_70,g_se,x_16"/></p>
<h4><a id="133_TF_164"></a>1.3.3 将文件放入TF卡中</h4>
<p>文件目录：</p>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/b69b7325a1d844a5a9c6dbc8a9bc3ae9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>将上述文件全复制到tf卡中，tf卡插入k210</p>
<p>注意：tf卡先格式成FAT32格式，部分牌子的tf卡格式了也不能挂载到k210上，建议多换几张卡试试</p>
<h4><a id="134_IED_175"></a>1.3.4 IED中查看效果</h4>
<p>IDE中运行效果：</p>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/89fb09c8b6b646f0b16d541819503a2c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h4><a id="135__182"></a>1.3.5 通过串口调试助手测试指令通信</h4>
<p>引脚9是TX，引脚10是RX，波特率为115200</p>
<p>通过usb转ttl连接到电脑上</p>
<p>初始识别数字为6，两次转向是向左</p>
<p><img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/6edf200efa264f8782412dfd7b4b876c.png"/></p>
<h3><a id="14__195"></a>1.4 上代码含详细注释</h3>
<p>第一版本：</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> sensor<span class="token punctuation">,</span>image<span class="token punctuation">,</span>lcd<span class="token punctuation">,</span>time
<span class="token keyword">import</span> KPU <span class="token keyword">as</span> kpu
<span class="token keyword">from</span> machine <span class="token keyword">import</span> UART
<span class="token keyword">from</span> fpioa_manager <span class="token keyword">import</span> fm

lcd<span class="token punctuation">.</span>init<span class="token punctuation">(</span>freq<span class="token operator">=</span><span class="token number">15000000</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_pixformat<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>RGB565<span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_framesize<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>QVGA<span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_hmirror<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#加载yolov5模型</span>
task <span class="token operator">=</span> kpu<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"/sd/yolov5.kmodel"</span><span class="token punctuation">)</span>
f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"anchors.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>
anchor_txt<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
L<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> anchor_txt<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
anchor<span class="token operator">=</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"lable.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>
lable_txt<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
lable <span class="token operator">=</span> lable_txt<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#设置RX、RT引脚</span>
fm<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> fm<span class="token punctuation">.</span>fpioa<span class="token punctuation">.</span>UART1_TX<span class="token punctuation">,</span> force<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
fm<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> fm<span class="token punctuation">.</span>fpioa<span class="token punctuation">.</span>UART1_RX<span class="token punctuation">,</span> force<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment">#设置串口通信</span>
uart_A <span class="token operator">=</span> UART<span class="token punctuation">(</span>UART<span class="token punctuation">.</span>UART1<span class="token punctuation">,</span> <span class="token number">115200</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> read_buf_len<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">)</span>
anchor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.1766</span><span class="token punctuation">,</span> <span class="token number">0.1793</span><span class="token punctuation">,</span> <span class="token number">0.4409</span><span class="token punctuation">,</span> <span class="token number">0.3797</span><span class="token punctuation">,</span> <span class="token number">0.6773</span><span class="token punctuation">,</span> <span class="token number">0.5954</span><span class="token punctuation">,</span> <span class="token number">1.0218</span><span class="token punctuation">,</span> <span class="token number">0.9527</span><span class="token punctuation">,</span> <span class="token number">2.158</span><span class="token punctuation">,</span> <span class="token number">1.6841</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_windowing<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> kpu<span class="token punctuation">.</span>init_yolo2<span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
classes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"9"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"4"</span><span class="token punctuation">,</span><span class="token string">"2"</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">,</span><span class="token string">"8"</span><span class="token punctuation">,</span><span class="token string">"5"</span><span class="token punctuation">,</span><span class="token string">"6"</span><span class="token punctuation">,</span><span class="token string">"7"</span> <span class="token punctuation">]</span>

<span class="token comment">#全局变量，保存初始化识别的数字</span>
intnum <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#初始化识别函数</span>
<span class="token keyword">def</span> <span class="token function">begin</span><span class="token punctuation">(</span>intnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    TF <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">#得分序列，放1-8识别的次数，每一帧识别成哪个，对应的位置加一，1-8哪个先到10即最终识别为哪个</span>
    List_score01 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>TF<span class="token punctuation">)</span><span class="token punctuation">:</span>
         img <span class="token operator">=</span> sensor<span class="token punctuation">.</span>snapshot<span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token comment">#code是yolov5返回的每个矩形框的参数</span>
         <span class="token comment">#例图中出现两个目标区域的时候：[{"x":9, "y":99, "w":55, "h":82, "value":0.697979, "classid":8, "index":0, "objnum":2}, {"x":137, "y":105, "w":56, "h":67, "value":0.939132, "classid":4, "index":1, "objnum":2}]</span>
         code <span class="token operator">=</span> kpu<span class="token punctuation">.</span>run_yolo2<span class="token punctuation">(</span>task<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
         <span class="token comment">#print(code)</span>
         <span class="token keyword">if</span> code<span class="token punctuation">:</span>
             <span class="token keyword">for</span> i <span class="token keyword">in</span> code<span class="token punctuation">:</span>
                <span class="token comment">#画目标区域矩形框</span>
                a <span class="token operator">=</span> img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                a <span class="token operator">=</span> lcd<span class="token punctuation">.</span> display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
                list1<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">#print(classes[i.classid()])</span>
                <span class="token comment">#识别到的加1</span>
                List_score01<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">.</span>classid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token comment">#print(List_score01)</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">1</span>
                    <span class="token comment">#给下位机通信传指令</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
                    <span class="token comment">#print(1)</span>
                    <span class="token comment">#退出初始化循环</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">2</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
                    <span class="token comment">#print(2)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">3</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span>
                    <span class="token comment">#print(3)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">4</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span>
                    <span class="token comment">#print(4)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">5</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span>
                    <span class="token comment">#print(5)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">6</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">)</span>
                    <span class="token comment">#print(6)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">7</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span>
                    <span class="token comment">#print(7)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">8</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
         <span class="token keyword">else</span><span class="token punctuation">:</span>
             a <span class="token operator">=</span> lcd<span class="token punctuation">.</span>display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token keyword">return</span> intnum

<span class="token comment">#34道路识别函数</span>
<span class="token keyword">def</span> <span class="token function">threefour</span><span class="token punctuation">(</span>intnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#设置二维矩阵，存放每一个矩形框中不同数字识别的次数</span>
    List_score02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
    intnum02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span>
    TF <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>TF<span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token comment">#加载一帧图像</span>
         img <span class="token operator">=</span> sensor<span class="token punctuation">.</span>snapshot<span class="token punctuation">(</span><span class="token punctuation">)</span>
         code <span class="token operator">=</span> kpu<span class="token punctuation">.</span>run_yolo2<span class="token punctuation">(</span>task<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
         <span class="token keyword">if</span> code<span class="token punctuation">:</span>
             int_i <span class="token operator">=</span> <span class="token number">0</span>
             <span class="token keyword">for</span> i <span class="token keyword">in</span> code<span class="token punctuation">:</span>
                 int_i <span class="token operator">+=</span><span class="token number">1</span>
                 a<span class="token operator">=</span>img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 a <span class="token operator">=</span> lcd<span class="token punctuation">.</span> display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
                 list1<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 b<span class="token operator">=</span><span class="token punctuation">(</span>list1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>list1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
                 <span class="token comment">#对应的矩阵值加一</span>
                 List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">.</span>classid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                 <span class="token keyword">print</span><span class="token punctuation">(</span>List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                 <span class="token comment">#该目标框逐个数字分析是否出现次数到达10，即为该目标区域中的数字</span>
                 <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">[</span>ii<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        intnum02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span> <span class="token operator">=</span> ii<span class="token operator">+</span><span class="token number">1</span>
                 <span class="token comment">#该目标区域中的数字是否是初始化识别的数字</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span>intnum <span class="token operator">==</span> intnum02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                 <span class="token comment">#判断位置，从而判断先做向右转</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span>
                        TF <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&gt;</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">)</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">)</span>
                        TF <span class="token operator">=</span> <span class="token number">0</span>
         <span class="token keyword">else</span><span class="token punctuation">:</span>
             a <span class="token operator">=</span> lcd<span class="token punctuation">.</span>display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token comment">#5678道路识别函数</span>
<span class="token keyword">def</span> <span class="token function">fivesixseveneight</span><span class="token punctuation">(</span>intnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#设置二维矩阵，存放每一个矩形框中不同数字识别的次数，一帧中最多有四个目标区域，但这里设置六个，防止有误识别的造成有很多矩形框程序暴死</span>
    List_score02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
    intnum02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span>
    TF <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token comment">#5678道路识别要识别两次，传两次指令，两次直接通过延时函数断开</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>TF<span class="token punctuation">)</span><span class="token punctuation">:</span>
         img <span class="token operator">=</span> sensor<span class="token punctuation">.</span>snapshot<span class="token punctuation">(</span><span class="token punctuation">)</span>
         code <span class="token operator">=</span> kpu<span class="token punctuation">.</span>run_yolo2<span class="token punctuation">(</span>task<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
         <span class="token keyword">if</span> code<span class="token punctuation">:</span>
             int_i <span class="token operator">=</span> <span class="token number">0</span>
             <span class="token keyword">for</span> i <span class="token keyword">in</span> code<span class="token punctuation">:</span>
                 int_i <span class="token operator">+=</span><span class="token number">1</span>
                 a<span class="token operator">=</span>img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 a <span class="token operator">=</span> lcd<span class="token punctuation">.</span> display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
                 list1<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 b<span class="token operator">=</span><span class="token punctuation">(</span>list1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>list1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
                 List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">.</span>classid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                 <span class="token keyword">print</span><span class="token punctuation">(</span>List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                 <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">[</span>ii<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        intnum02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span> <span class="token operator">=</span> ii<span class="token operator">+</span><span class="token number">1</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span>intnum <span class="token operator">==</span> intnum02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"l"</span><span class="token punctuation">)</span>
                        TF <span class="token operator">-=</span> <span class="token number">1</span>
                        List_score02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
                        intnum02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span>
                        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&gt;</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">)</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">)</span>
                        TF <span class="token operator">-=</span> <span class="token number">1</span>
                        List_score02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
                        intnum02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span>
                        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
         <span class="token keyword">else</span><span class="token punctuation">:</span>
             a <span class="token operator">=</span> lcd<span class="token punctuation">.</span>display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token comment">#执行程序</span>
intnum <span class="token operator">=</span> begin<span class="token punctuation">(</span>intnum<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>intnum <span class="token operator">==</span> <span class="token number">3</span> <span class="token keyword">or</span> intnum <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    threefour<span class="token punctuation">(</span>intnum<span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>intnum <span class="token operator">==</span> <span class="token number">5</span> <span class="token keyword">or</span> intnum <span class="token operator">==</span> <span class="token number">6</span> <span class="token keyword">or</span> intnum <span class="token operator">==</span><span class="token number">7</span> <span class="token keyword">or</span> intnum <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fivesixseveneight<span class="token punctuation">(</span>intnum<span class="token punctuation">)</span>
uart_A<span class="token punctuation">.</span>deinit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">del</span> uart_A
a <span class="token operator">=</span> kpu<span class="token punctuation">.</span>deinit<span class="token punctuation">(</span>task<span class="token punctuation">)</span>


</code></pre>
<p>第二版本：</p>
<pre><code class="prism language-python"><span class="token keyword">import</span> sensor<span class="token punctuation">,</span>image<span class="token punctuation">,</span>lcd<span class="token punctuation">,</span>time
<span class="token keyword">import</span> KPU <span class="token keyword">as</span> kpu
<span class="token keyword">from</span> machine <span class="token keyword">import</span> UART
<span class="token keyword">from</span> fpioa_manager <span class="token keyword">import</span> fm

lcd<span class="token punctuation">.</span>init<span class="token punctuation">(</span>freq<span class="token operator">=</span><span class="token number">15000000</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_pixformat<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>RGB565<span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_framesize<span class="token punctuation">(</span>sensor<span class="token punctuation">.</span>QVGA<span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_hmirror<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#加载yolov5模型</span>
task <span class="token operator">=</span> kpu<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"/sd/yolov5.kmodel"</span><span class="token punctuation">)</span>
f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"anchors.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>
anchor_txt<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
L<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> anchor_txt<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
anchor<span class="token operator">=</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"lable.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>
lable_txt<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
lable <span class="token operator">=</span> lable_txt<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#设置RX、RT引脚</span>
fm<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> fm<span class="token punctuation">.</span>fpioa<span class="token punctuation">.</span>UART1_TX<span class="token punctuation">,</span> force<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
fm<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> fm<span class="token punctuation">.</span>fpioa<span class="token punctuation">.</span>UART1_RX<span class="token punctuation">,</span> force<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment">#设置串口通信</span>
uart_A <span class="token operator">=</span> UART<span class="token punctuation">(</span>UART<span class="token punctuation">.</span>UART1<span class="token punctuation">,</span> <span class="token number">9600</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> read_buf_len<span class="token operator">=</span><span class="token number">4096</span><span class="token punctuation">)</span>
anchor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0.1766</span><span class="token punctuation">,</span> <span class="token number">0.1793</span><span class="token punctuation">,</span> <span class="token number">0.4409</span><span class="token punctuation">,</span> <span class="token number">0.3797</span><span class="token punctuation">,</span> <span class="token number">0.6773</span><span class="token punctuation">,</span> <span class="token number">0.5954</span><span class="token punctuation">,</span> <span class="token number">1.0218</span><span class="token punctuation">,</span> <span class="token number">0.9527</span><span class="token punctuation">,</span> <span class="token number">2.158</span><span class="token punctuation">,</span> <span class="token number">1.6841</span><span class="token punctuation">)</span>
sensor<span class="token punctuation">.</span>set_windowing<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> kpu<span class="token punctuation">.</span>init_yolo2<span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>
classes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"9"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token string">"4"</span><span class="token punctuation">,</span><span class="token string">"2"</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">,</span><span class="token string">"8"</span><span class="token punctuation">,</span><span class="token string">"5"</span><span class="token punctuation">,</span><span class="token string">"6"</span><span class="token punctuation">,</span><span class="token string">"7"</span> <span class="token punctuation">]</span>

<span class="token comment">#全局变量，保存初始化识别的数字</span>
intnum <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#初始化识别函数</span>
<span class="token keyword">def</span> <span class="token function">begin</span><span class="token punctuation">(</span>intnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    TF <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment">#得分序列，放1-8识别的次数，每一帧识别成哪个，对应的位置加一，1-8哪个先到10即最终识别为哪个</span>
    List_score01 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>TF<span class="token punctuation">)</span><span class="token punctuation">:</span>
         img <span class="token operator">=</span> sensor<span class="token punctuation">.</span>snapshot<span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token comment">#code是yolov5返回的每个矩形框的参数</span>
         <span class="token comment">#例图中出现两个目标区域的时候：[{"x":9, "y":99, "w":55, "h":82, "value":0.697979, "classid":8, "index":0, "objnum":2}, {"x":137, "y":105, "w":56, "h":67, "value":0.939132, "classid":4, "index":1, "objnum":2}]</span>
         code <span class="token operator">=</span> kpu<span class="token punctuation">.</span>run_yolo2<span class="token punctuation">(</span>task<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
         <span class="token comment">#print(code)</span>
         <span class="token keyword">if</span> code<span class="token punctuation">:</span>
             <span class="token keyword">for</span> i <span class="token keyword">in</span> code<span class="token punctuation">:</span>
                <span class="token comment">#画目标区域矩形框</span>
                a <span class="token operator">=</span> img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                a <span class="token operator">=</span> lcd<span class="token punctuation">.</span> display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
                list1<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">#print(classes[i.classid()])</span>
                <span class="token comment">#识别到的加1</span>
                List_score01<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">.</span>classid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token comment">#print(List_score01)</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">1</span>
                    <span class="token comment">#给下位机通信传指令</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token comment">#退出初始化循环</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">2</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">3</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">4</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">5</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'E'</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">6</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'F'</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">7</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">)</span>
                    <span class="token comment">#print(7)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>List_score01<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    intnum <span class="token operator">=</span> <span class="token number">8</span>
                    uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'H'</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
                    TF <span class="token operator">=</span> <span class="token number">0</span>
         <span class="token keyword">else</span><span class="token punctuation">:</span>
             a <span class="token operator">=</span> lcd<span class="token punctuation">.</span>display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token keyword">return</span> intnum


<span class="token comment">#道路识别函数</span>
<span class="token keyword">def</span> <span class="token function">then</span><span class="token punctuation">(</span>intnum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#设置二维矩阵，存放每一个矩形框中不同数字识别的次数，一帧中最多有四个目标区域，但这里设置六个，防止有误识别的造成有很多矩形框程序暴死</span>
        List_score02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
        intnum02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span>
        TF <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>TF<span class="token punctuation">)</span><span class="token punctuation">:</span>
             img <span class="token operator">=</span> sensor<span class="token punctuation">.</span>snapshot<span class="token punctuation">(</span><span class="token punctuation">)</span>
             code <span class="token operator">=</span> kpu<span class="token punctuation">.</span>run_yolo2<span class="token punctuation">(</span>task<span class="token punctuation">,</span> img<span class="token punctuation">)</span>
             <span class="token keyword">if</span> code<span class="token punctuation">:</span>
                 int_i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
                 <span class="token keyword">for</span> i <span class="token keyword">in</span> code<span class="token punctuation">:</span>
                     int_i <span class="token operator">+=</span><span class="token number">1</span>
                     a<span class="token operator">=</span>img<span class="token punctuation">.</span>draw_rectangle<span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                     a <span class="token operator">=</span> lcd<span class="token punctuation">.</span> display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
                     list1<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                     b<span class="token operator">=</span><span class="token punctuation">(</span>list1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>list1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
                     List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>i<span class="token punctuation">.</span>classid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                     <span class="token comment">#print(int_i)</span>
                     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>int_i<span class="token punctuation">)</span><span class="token punctuation">)</span>
                     <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                     <span class="token comment">#int_i是第几个框，ii是第几个框中的每个数字</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>List_score02<span class="token punctuation">[</span>int_i<span class="token punctuation">]</span><span class="token punctuation">[</span>ii<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token keyword">and</span> intnum <span class="token operator">==</span> ii<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&lt;</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                                uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>
                                TF <span class="token operator">=</span> <span class="token number">0</span>
                                List_score02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
                                intnum02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>b <span class="token operator">&gt;</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                                uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"R"</span><span class="token punctuation">)</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"R"</span><span class="token punctuation">)</span>
                                TF <span class="token operator">=</span> <span class="token number">0</span>
                                List_score02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
                                intnum02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span>
             <span class="token keyword">else</span><span class="token punctuation">:</span>
                 a <span class="token operator">=</span> lcd<span class="token punctuation">.</span>display<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
                 TF <span class="token operator">=</span> <span class="token number">0</span>
                 List_score02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
                 intnum02 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">6</span>
    <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token comment">#执行程序</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
uart_A<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"E"</span><span class="token punctuation">)</span>
intnum <span class="token operator">=</span> begin<span class="token punctuation">(</span>intnum<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
then<span class="token punctuation">(</span>intnum<span class="token punctuation">)</span>
uart_A<span class="token punctuation">.</span>deinit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">del</span> uart_A
a <span class="token operator">=</span> kpu<span class="token punctuation">.</span>deinit<span class="token punctuation">(</span>task<span class="token punctuation">)</span>

</code></pre>
<h2><a id="2_OPENMV_562"></a>2. OPENMV红线循迹</h2>
<blockquote>
<p>openmv就是玩具<br/> ——某位老哥（收录名人名言）</p>
</blockquote>
<p>用openmv红线循迹，这部分比较简单，就不多说了吧</p>
<p>循迹测试：<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/fc2426432a41429ba64b6212faa618e6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_9,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>测试结果：<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/183ae6e6940d40fe91b7826eddb72864.png"/></p>
<p>虽然2021电赛过去了，但是现在回味起来依然很香~<br/> <img alt="请添加图片描述" src="https://img-blog.csdnimg.cn/736e758c82ef4f86952a4035022a4f51.webp?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAemhhb2hhb2JpbmdTVUk=,size_12,color_FFFFFF,t_70,g_se,x_16"/></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>