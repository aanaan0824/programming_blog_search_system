<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<blockquote>
<p>â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸ ğŸ¥³ğŸ¥³ğŸ¥³ èŒ«èŒ«äººæµ·åƒåƒä¸‡ä¸‡ï¼Œæ„Ÿè°¢è¿™ä¸€åˆ»ä½ çœ‹åˆ°äº†æˆ‘çš„æ–‡ç« ï¼Œæ„Ÿè°¢è§‚èµï¼Œå¤§å®¶å¥½å‘€ï¼Œæ¬¢è¿åŠ å…¥äººå·¥æ™ºèƒ½äº¤æµç¾¤ï¼ˆçœ‹æˆ‘çš„åŠ¨æ€ï¼‰ï¼Œæ›´å¤šå‘¨è¾¹ç¦åˆ©ç­‰ä½ ğŸ¥³ğŸ¥³ğŸ¥³</p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/834cbfdac09a4b1aa3984cfb7bb30379.gif#pic_center"/></p>
</blockquote>
<blockquote>
<p>âœ¨âœ¨æ¬¢è¿è®¢é˜…æœ¬ä¸“æ æˆ–è€…å…³æ³¨æˆ‘ï¼Œå¤§å®¶ä¸€èµ·åŠªåŠ›æ¯å¤©ä¸€é¢˜ç®—æ³•é¢˜âœ¨âœ¨</p>
<p>â¤ï¸â¤ï¸â¤ï¸ æœ€åï¼Œå¸Œæœ›æˆ‘çš„è¿™ç¯‡æ–‡ç« èƒ½å¯¹ä½ çš„æœ‰æ‰€å¸®åŠ©ï¼</p>
<p>æ„¿è‡ªå·±è¿˜æœ‰ä½ åœ¨æœªæ¥çš„æ—¥å­ï¼Œä¿æŒå­¦ä¹ ï¼Œä¿æŒè¿›æ­¥ï¼Œä¿æŒçƒ­çˆ±ï¼Œå¥”èµ´å±±æµ·ï¼ â¤ï¸â¤ï¸â¤ï¸</p>
</blockquote>
<h1><a id="_14"></a>å‰æ™¯</h1>
<p>æœ¬æ¬¡å¼€å‘æ—¶åˆå†æ¬¡ç”¨åˆ°ï¼Œç»“åˆä¹‹å‰çš„æ‘¸çˆ¬æ»šæ‰“çš„ç»éªŒï¼Œæˆ‘ç»™å¤§å®¶æ•´ç†ä¸‹ï¼Œåšåˆ°ä¸€æ–‡å°±èƒ½è®©ä½ æ˜ç™½[<strong>ä»€ä¹ˆæ˜¯è®¢é˜…æ¶ˆæ¯ï¼Ÿ</strong>]ã€[<strong>å¦‚ä½•ä½¿ç”¨è®¢é˜…æ¶ˆæ¯</strong>]ã€[<strong>å¼€å‘è®¢é˜…æ¶ˆæ¯</strong>]ï¼Œ<mark>è¿˜åœ¨ç­‰ä»€ä¹ˆï¼Ÿå°ç¨‹åºå­¦ä¹ è®¢é˜…æœ¬ä¸“æ ä¸é¦™å˜›ï¼Ÿï¼</mark>ï¼Œ<s>é¡ºä¾¿å…³æ³¨èµ°ä¸€èµ°[æ»‘ç¨½]</s></p>
<p></p>
<div class="toc">
<h3>ç›®å½•</h3>
<ul><li><a href="#_14">å‰æ™¯</a></li><li><a href="#_19">ä»€ä¹ˆæ˜¯å°ç¨‹åºè®¢é˜…æ¶ˆæ¯ï¼Ÿ</a></li><li><ul><li><a href="#1__24">1. ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯</a></li><li><a href="#2__28">2. é•¿æœŸè®¢é˜…æ¶ˆæ¯</a></li><li><a href="#3__34">3. è®¾å¤‡è®¢é˜…æ¶ˆæ¯</a></li><li><a href="#_39">ä½•ä¸ºä¸€æ¬¡æ€§æ¨¡æ¿ï¼Ÿ</a></li><li><a href="#_42">è®¢é˜…æ¶ˆæ¯çš„æ ¼å¼</a></li></ul>
</li><li><a href="#_57">è¿è¡ŒåŸºæœ¬æµç¨‹</a></li><li><a href="#_61">å¼€å‘æ­¥éª¤</a></li><li><ul><li><a href="#_62">ç¬¬ä¸€æ­¥å¼€é€šè®¢é˜…æ¶ˆæ¯</a></li><li><a href="#_65">é€‰æ‹©æ¶ˆæ¯æ¨¡æ¿</a></li><li><a href="#_70">å°ç¨‹åºç”³è¯·æˆæƒ</a></li><li><a href="#PHPredis_190">åç«¯PHPå°è£…ã€redisé…ç½®</a></li><li><a href="#notifyphp_313">ä¿®æ”¹notify.phpæ–‡ä»¶</a></li><li><a href="#_368">æµ‹è¯•</a></li></ul>
</li><li><a href="#_410">æ€»ç»“</a></li></ul>
</div>
<p></p>
<h1><a id="_19"></a>ä»€ä¹ˆæ˜¯å°ç¨‹åºè®¢é˜…æ¶ˆæ¯ï¼Ÿ</h1>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/c6f2c434497d42f29d0bb0ce9d9c67b7.png#pic_center"/></p>
<p>å¯ä»¥å®ç°ç»™æˆæƒäº†çš„ç”¨æˆ·è¿›è¡Œæ¶ˆæ¯æ¨é€ï¼Œæ¨é€ä¸€äº›æŒ‡å®šçš„æ¶ˆæ¯ï¼Œå¸¦åŠ¨ç”¨æˆ·çš„ç‚¹å‡»ï¼Œä¾‹å¦‚æé†’ç”¨æˆ·ç­¾åˆ°ï¼Œæˆ–è€…å‘é€ä¸€äº›å¥–åŠ±åˆ°è´¦ç­‰é€šçŸ¥ï¼Œç›®çš„å°±æ˜¯ä¸€ä¸ªï¼Œå¸¦åŠ¨ç”¨æˆ·çš„ç‚¹å‡»ï¼Œç•™ä½è€ç”¨æˆ·ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦é€šè¿‡ï¼Œå°ç¨‹åºçš„åå°å»å¼€é€šè®¢é˜…æ¶ˆæ¯ï¼Œè®¢é˜…æ¶ˆæ¯<strong>ä¼ä¸š</strong>ã€<strong>ä¸ªäºº</strong>éƒ½å¯ä»¥å¼€é€šï¼Œæœºå…³éƒ¨é—¨å¯ä»¥<strong>ç”³è¯·é•¿æœŸè®¢é˜…æ¨¡æ¿</strong>ã€è€Œå…¶ä»–çš„å°±åªèƒ½é€‰æ‹©ä¸€æ¬¡æ€§æ¨¡æ¿<br/> æ¶ˆæ¯ç±»å‹</p>
<h2><a id="1__24"></a>1. ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯</h2>
<p>ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯ç”¨äºè§£å†³ç”¨æˆ·ä½¿ç”¨å°ç¨‹åºåï¼Œåç»­æœåŠ¡ç¯èŠ‚çš„é€šçŸ¥é—®é¢˜ã€‚ç”¨æˆ·è‡ªä¸»è®¢é˜…åï¼Œå¼€å‘è€…å¯ä¸é™æ—¶é—´åœ°ä¸‹å‘ä¸€æ¡å¯¹åº”çš„æœåŠ¡æ¶ˆæ¯ï¼›æ¯æ¡æ¶ˆæ¯å¯å•ç‹¬è®¢é˜…æˆ–é€€è®¢ã€‚</p>
<h2><a id="2__28"></a>2. é•¿æœŸè®¢é˜…æ¶ˆæ¯</h2>
<p>ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯å¯æ»¡è¶³å°ç¨‹åºçš„å¤§éƒ¨åˆ†æœåŠ¡åœºæ™¯éœ€æ±‚ï¼Œä½†çº¿ä¸‹å…¬å…±æœåŠ¡é¢†åŸŸå­˜åœ¨ä¸€æ¬¡æ€§è®¢é˜…æ— æ³•æ»¡è¶³çš„åœºæ™¯ï¼Œå¦‚èˆªç­å»¶è¯¯ï¼Œéœ€æ ¹æ®èˆªç­å®æ—¶åŠ¨æ€æ¥å¤šæ¬¡å‘é€æ¶ˆæ¯æé†’ã€‚ä¸ºä¾¿äºæœåŠ¡ï¼Œæˆ‘ä»¬æä¾›äº†é•¿æœŸæ€§è®¢é˜…æ¶ˆæ¯ï¼Œç”¨æˆ·è®¢é˜…ä¸€æ¬¡åï¼Œå¼€å‘è€…å¯é•¿æœŸä¸‹å‘å¤šæ¡æ¶ˆæ¯ã€‚</p>
<p>ç›®å‰é•¿æœŸæ€§è®¢é˜…æ¶ˆæ¯ä»…å‘æ”¿åŠ¡æ°‘ç”Ÿã€åŒ»ç–—ã€äº¤é€šã€é‡‘èã€æ•™è‚²ç­‰çº¿ä¸‹å…¬å…±æœåŠ¡å¼€æ”¾ï¼ŒåæœŸå°†é€æ­¥æ”¯æŒåˆ°å…¶ä»–çº¿ä¸‹å…¬å…±æœåŠ¡ä¸šåŠ¡ã€‚</p>
<h2><a id="3__34"></a>3. è®¾å¤‡è®¢é˜…æ¶ˆæ¯</h2>
<p>è®¾å¤‡è®¢é˜…æ¶ˆæ¯æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„è®¢é˜…æ¶ˆæ¯ï¼Œå®ƒå±äºé•¿æœŸè®¢é˜…æ¶ˆæ¯ç±»å‹ï¼Œä¸”éœ€è¦å®Œæˆã€Œè®¾å¤‡æ¥å…¥ã€æ‰èƒ½ä½¿ç”¨ã€‚</p>
<p>è®¾å¤‡è®¢é˜…æ¶ˆæ¯ç”¨äºåœ¨è®¾å¤‡è§¦å‘æŸäº›éœ€è¦äººå·¥ä»‹å…¥çš„äº‹ä»¶æ—¶ï¼ˆä¾‹å¦‚è®¾å¤‡å‘ç”Ÿæ•…éšœã€è®¾å¤‡è€—æä¸è¶³ç­‰ï¼‰ï¼Œå‘ç”¨æˆ·å‘é€æ¶ˆæ¯é€šçŸ¥ã€‚è¯¦è§è®¾å¤‡è®¢é˜…æ¶ˆæ¯æ–‡æ¡£</p>
<h2><a id="_39"></a>ä½•ä¸ºä¸€æ¬¡æ€§æ¨¡æ¿ï¼Ÿ</h2>
<p>ç®€æ˜æ‰¼è¦æ¥è¯´ï¼Œå°±æ˜¯ç”¨æˆ·æˆæƒä¸€æ¬¡å¯ä»¥è·å–ä¸€æ¬¡æ¶ˆæ¯ï¼Œå¼€å‘è€…ä¸å¯ä»¥ä¸€ç›´æ¨é€æ¶ˆæ¯æ‰“æ‰°ç”¨æˆ·</p>
<h2><a id="_42"></a>è®¢é˜…æ¶ˆæ¯çš„æ ¼å¼</h2>
<p>è®¢é˜…æ¶ˆæ¯æ˜¯ä¸å¯ä»¥éšä¾¿å‘é€çš„ï¼Œéœ€è¦å¯¹åº”åˆ°æ ¼å¼ï¼ŒåŒ…æ‹¬å­—æ•°é•¿åº¦ç­‰ç­‰ï¼Œå¯ä»¥çœ‹è¿™ä¸ªï¼Œè¿™æ˜¯ä¸€ä¸ªç­¾åˆ°æ¨¡æ¿<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/b28a352ea8624c51bba0ba12365cb7df.png"/></p>
<p>çœ‹ä¸‹ä»–çš„è¯¦æƒ…</p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/84e3332923c241b5b0443e9b8f64be02.png"/></p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>æ´»åŠ¨åç§°</td><td>{<!-- -->{thing1.DATA}}</td></tr><tr><td>æ¸©é¦¨æç¤º</td><td>{<!-- -->{thing2.DATA}}</td></tr><tr><td>ç­¾åˆ°æ–¹å¼</td><td>{<!-- -->{thing5.DATA}}</td></tr><tr><td>ç­¾åˆ°çŠ¶æ€</td><td>{<!-- -->{phrase6.DATA}}</td></tr></tbody></table>
<p>è¿™é‡Œçš„thing1ã€thing5éƒ½ç”±å­—æ•°çš„è§„èŒƒï¼Œé˜²æ­¢æ¨é€åƒåœ¾æ¶ˆæ¯ï¼Œå¼•æµä¹‹ç±»çš„</p>
<h1><a id="_57"></a>è¿è¡ŒåŸºæœ¬æµç¨‹</h1>
<p>å‰ç«¯é€šè¿‡ç»„ä»¶æ¥å£ç”¨æˆ·è¿›è¡Œæˆæƒï¼Œåç«¯é€šè¿‡å®šæ—¶è§¦å‘ï¼Œå°†æ¨¡æ¿æ¶ˆæ¯è§¦å‘<br/> å¯ä»¥é€šè¿‡å®å¡”çš„å®šæ—¶è®¡åˆ’æ¥è¿›è¡Œè§¦å‘ï¼Œç”¨åˆ°çš„å„ç§é‰´æƒï¼Œæˆ‘ä»¬é€šè¿‡redisæ¥å­˜å‚¨</p>
<h1><a id="_61"></a>å¼€å‘æ­¥éª¤</h1>
<h2><a id="_62"></a>ç¬¬ä¸€æ­¥å¼€é€šè®¢é˜…æ¶ˆæ¯</h2>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/032457d01f234afa9f607d03e0b0cead.png"/></p>
<h2><a id="_65"></a>é€‰æ‹©æ¶ˆæ¯æ¨¡æ¿</h2>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/8b76901dec9c497196024d3fd0456e97.png"/><br/> æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰æƒ³è¦çš„æ¨¡æ¿ï¼Œå»æŠŠå°ç¨‹åºçš„<strong>æœåŠ¡ç±»ç›®</strong>å¤šåŠ å‡ ä¸ª<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/3c57d1f74a09446c8442f291b95108b6.png"/></p>
<h2><a id="_70"></a>å°ç¨‹åºç”³è¯·æˆæƒ</h2>
<p>ä¸€æ¬¡æ€§è®¢é˜…æ¶ˆæ¯ã€é•¿æœŸè®¢é˜…æ¶ˆæ¯ï¼Œæ¥å£</p>
<blockquote>
<p>wx.requestSubscribeMessage</p>
</blockquote>
<p>ä»£ç ï¼š</p>
<pre><code class="prism language-bash">wx.requestSubscribeMessage<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      tmplIds: <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>ä¸Šé¢çš„tmplIdsé‡Œé¢å¡«å†™çš„å°±æ˜¯ç”³è¯·åˆ°çš„<strong>æ¨¡æ¿ID</strong>ï¼Œä¾‹å¦‚æˆ‘çš„</p>
<blockquote>
<p>6io5lFLo4OEdNjl2_F********RZEm6RMdHLQ</p>
</blockquote>
<p>è¿™é‡Œä¹‹å‰åšè¿‡æµ‹è¯•å¤šä¸ªæ¨¡æ¿idä¸€æ¬¡æ€§æˆæƒï¼Œå­˜åœ¨bugï¼Œåªä¼šå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆï¼Œå•¥æ„æ€å‘¢ï¼Ÿå°±æ˜¯åƒè¿™æ ·</p>
<blockquote>
<p>tmplIds: [â€˜1â€™,â€˜2â€™],<br/> è¿™ä¸ªå¤§å®¶è‡ªå·±å»æµ‹è¯•</p>
</blockquote>
<hr/>
<p>æˆ‘ä»¬æ–°å»ºwxmlæ–‡ä»¶ï¼š</p>
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>view <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"height: 100rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>æŠ½å¥–<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>view <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"height: 100rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"primary"</span> <span class="token assign-left variable">bindtap</span><span class="token operator">=</span><span class="token string">"sign_up"</span><span class="token operator">&gt;</span>ç­¾åˆ°<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>view <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"height: 100rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>è´­ä¹°<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>view <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"height: 100rpx;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>åˆ†äº«<span class="token operator">&lt;</span>/button<span class="token operator">&gt;</span>
æ³¨é‡Šï¼š1æ¯ä¸ªäººèƒ½æ¯å¤©èƒ½åˆ†äº«ä¸€æ¬¡ï¼Œé‡å¤åˆ†äº«ç§¯åˆ†ä¸ç®—å…¥
<span class="token number">2</span>é‚€è¯·æ–°ç”¨æˆ·ç™»å½•ååŠ ç§¯åˆ†
</code></pre>
<p>æ–°å»ºjsæ–‡ä»¶ï¼š</p>
<pre><code class="prism language-bash">// pages/share/share.js
Page<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>

  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>,
  sign_up:<span class="token function-name function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    wx.requestSubscribeMessage<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      tmplIds: <span class="token punctuation">[</span><span class="token string">'6io5lFLo4OEdNjl2_F********RZEm6RMdHLQ'</span><span class="token punctuation">]</span>,
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>,
  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad<span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>,

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åˆæ¬¡æ¸²æŸ“å®Œæˆ
   */
  <span class="token function-name function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>,

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢æ˜¾ç¤º
   */
  <span class="token function-name function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>,

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢éšè—
   */
  <span class="token function-name function">onHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>,

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢å¸è½½
   */
  <span class="token function-name function">onUnload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>,

  /**
   * é¡µé¢ç›¸å…³äº‹ä»¶å¤„ç†å‡½æ•°--ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åŠ¨ä½œ
   */
  <span class="token function-name function">onPullDownRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>,

  /**
   * é¡µé¢ä¸Šæ‹‰è§¦åº•äº‹ä»¶çš„å¤„ç†å‡½æ•°
   */
  <span class="token function-name function">onReachBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>,

  /**
   * ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
   */
  <span class="token function-name function">onShareAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>æµ‹è¯•ä¸‹å¯ä»¥æ­£å¸¸æˆæƒ<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/6e8a2365be6e43a5a6b69d41399b39c7.png"/></p>
<h2><a id="PHPredis_190"></a>åç«¯PHPå°è£…ã€redisé…ç½®</h2>
<p>åœ¨apiç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶<strong>notify.php</strong></p>
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>?php
// å¾®ä¿¡å°ç¨‹åºé€šçŸ¥ä¸»è¦å‡½æ•°
//http_request åˆ©ç”¨curlè¯·æ±‚  ä¸¤ä¸ªå‚æ•°   urlè¿æ¥åœ°å€   æ•°æ®ä¿¡æ¯
<span class="token keyword">function</span> http_request<span class="token punctuation">(</span><span class="token variable">$url</span>,<span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$ch</span> <span class="token operator">=</span> curl_init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//åˆå§‹åŒ–
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_URL, <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//è®¾ç½®
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_SSL_VERIFYPEER, FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_SSL_VERIFYHOST, FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_POST, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$output</span> <span class="token operator">=</span> curl_exec<span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//æ‰§è¡Œ 
    curl_close<span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//å…³é—­
    <span class="token builtin class-name">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>//è¿”å›ç»“æœ
<span class="token punctuation">}</span>

//å°è£…æ–¹æ³•

//ç­¾åˆ°é€šçŸ¥
 <span class="token keyword">function</span> notify_sign<span class="token punctuation">(</span><span class="token variable">$touser</span>,<span class="token variable">$ACCESS_TOKEN</span>,<span class="token variable">$order_num</span>,<span class="token variable">$shop_name</span>,<span class="token variable">$user_name9</span>,<span class="token variable">$phone</span>,<span class="token variable">$address</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token variable">$template</span><span class="token operator">=</span>array<span class="token punctuation">(</span>
        <span class="token string">'touser'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$touser</span>"</span>,//æ¥æ”¶æ–¹openid
        <span class="token string">'template_id'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"8nHJ-TGMbPXBEROLpIEsba4ZMKt4lkJlJoEO5RcTYmk"</span>,    //æ¨¡æ¿çš„id
        <span class="token string">'page'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"pages/admin_order/admin_order"</span>,//ç‚¹å‡»å°ç¨‹åºè®¢é˜…æ¶ˆæ¯è·³è½¬çš„é¡µ
        <span class="token string">'data'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span>
            // <span class="token string">'character_string1'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$out_trade_no</span>"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"#00008B"</span><span class="token punctuation">)</span>,   
            <span class="token string">'character_string12'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$order_num</span>"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,  
            // <span class="token string">'amount4'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"15"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,  
            <span class="token string">'thing1'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$shop_name</span>"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,
            <span class="token string">'thing8'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$user_name9</span>"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,
            <span class="token string">'phone_number9'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$phone</span>"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,
            <span class="token string">'thing11'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$address</span>"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        // <span class="token string">'phrase1'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span>urlencode<span class="token punctuation">(</span><span class="token variable">$plan</span><span class="token punctuation">)</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,   //æ—¶é—´
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$json_template</span><span class="token operator">=</span>json_encode<span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$url</span><span class="token operator">=</span><span class="token string">"https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token="</span><span class="token builtin class-name">.</span><span class="token variable">$ACCESS_TOKEN</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span><span class="token operator">=</span>http_request<span class="token punctuation">(</span><span class="token variable">$url</span>,urldecode<span class="token punctuation">(</span><span class="token variable">$json_template</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
    print_r<span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


?<span class="token operator">&gt;</span>
</code></pre>
<p>ä¸‹è½½redisæœåŠ¡ï¼Œè®°å¾—å¼€æ”¾6379ç«¯å£<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/e9ef50cb954a4a8cada3fe60eb715fe4.png"/></p>
<hr/>
<p>æ–°å»ºaccess_token.phpæ–‡ä»¶<br/> é€šè¿‡å®šæ—¶ä»»åŠ¡å¯¹access_tokençš„å­˜å‚¨ï¼Œåœ¨å¿«è¿‡æœŸæ—¶è°ƒç”¨æ›´æ–°ï¼Œè¿™é‡Œè¯´ä¸€æ¬¡ä¸ºå•¥ä¸è°ƒç”¨ä¸€æ¬¡åˆ·æ–°ä¸€æ¬¡access_tokenå°±å¥½äº†ï¼Œå¼„è¿™ä¹ˆéº»çƒ¦ï¼Ÿå› ä¸ºå½“access_tokenåˆ·æ–°åå·²ç»é€šçŸ¥è¿‡çš„æ¨¡æ¿æ¶ˆæ¯å°±ä¼šå¤±æ•ˆï¼Œä¸ºäº†é˜²æ­¢ä»¥å‰å‘çš„æ¨¡æ¿æ¶ˆæ¯å¤±æ•ˆï¼Œèƒ½æœ€å¤§ç¨‹åº¦é™ä½å¤±æ•ˆï¼Œå¯ä»¥ç”¨å®šæ—¶å™¨çš„æ–¹æ³•æ›´æ–°access_tokenå³å¯</p>
<p>å†çœ‹ä¸‹å®˜æ–¹æ€ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<p>access_token çš„å­˜å‚¨è‡³å°‘è¦ä¿ç•™ 512 ä¸ªå­—ç¬¦ç©ºé—´ï¼›<br/> access_token çš„æœ‰æ•ˆæœŸç›®å‰ä¸º 2 ä¸ªå°æ—¶ï¼Œéœ€å®šæ—¶åˆ·æ–°ï¼Œé‡å¤è·å–å°†å¯¼è‡´ä¸Šæ¬¡è·å–çš„ access_token å¤±æ•ˆï¼›<br/> å»ºè®®å¼€å‘è€…ä½¿ç”¨ä¸­æ§æœåŠ¡å™¨ç»Ÿä¸€è·å–å’Œåˆ·æ–° access_tokenï¼Œå…¶ä»–ä¸šåŠ¡é€»è¾‘æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„ access_token å‡æ¥è‡ªäºè¯¥ä¸­æ§æœåŠ¡å™¨ï¼Œä¸åº”è¯¥å„è‡ªå»åˆ·æ–°ï¼Œå¦åˆ™å®¹æ˜“é€ æˆå†²çªï¼Œå¯¼è‡´ access_token è¦†ç›–è€Œå½±å“ä¸šåŠ¡ï¼›</p>
</blockquote>
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>?php
//access_token
<span class="token variable">$appid</span><span class="token operator">=</span><span class="token string">"wxe20298c8e087576e"</span><span class="token punctuation">;</span>//å°ç¨‹åºid
<span class="token variable">$secret</span><span class="token operator">=</span><span class="token string">"*****"</span><span class="token punctuation">;</span>//å¯†é’¥
<span class="token variable">$grant_type</span><span class="token operator">=</span><span class="token string">"client_credential"</span><span class="token punctuation">;</span>
<span class="token variable">$access_token</span><span class="token operator">=</span>curl_get<span class="token punctuation">(</span><span class="token string">"https://api.weixin.qq.com/cgi-bin/token?appid=<span class="token variable">$appid</span>&amp;secret=<span class="token variable">$secret</span>&amp;grant_type=<span class="token variable">$grant_type</span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$access_token</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> curl_get<span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
 
   <span class="token variable">$header</span> <span class="token operator">=</span> array<span class="token punctuation">(</span>
       <span class="token string">'Accept: application/json'</span>,
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$curl</span> <span class="token operator">=</span> curl_init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //è®¾ç½®æŠ“å–çš„url
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$curl</span>, CURLOPT_URL, <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //è®¾ç½®å¤´æ–‡ä»¶çš„ä¿¡æ¯ä½œä¸ºæ•°æ®æµè¾“å‡º
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$curl</span>, CURLOPT_HEADER, <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    // è¶…æ—¶è®¾ç½®,ä»¥ç§’ä¸ºå•ä½
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$curl</span>, CURLOPT_TIMEOUT, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    // è¶…æ—¶è®¾ç½®ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½
    // curl_setopt<span class="token punctuation">(</span><span class="token variable">$curl</span>, CURLOPT_TIMEOUT_MS, <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    // è®¾ç½®è¯·æ±‚å¤´
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$curl</span>, CURLOPT_HTTPHEADER, <span class="token variable">$header</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //è®¾ç½®è·å–çš„ä¿¡æ¯ä»¥æ–‡ä»¶æµçš„å½¢å¼è¿”å›ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºã€‚
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$curl</span>, CURLOPT_SSL_VERIFYPEER, <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$curl</span>, CURLOPT_SSL_VERIFYHOST, <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    //æ‰§è¡Œå‘½ä»¤
    <span class="token variable">$data</span> <span class="token operator">=</span> curl_exec<span class="token punctuation">(</span><span class="token variable">$curl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    <span class="token keyword">if</span> <span class="token punctuation">(</span>curl_error<span class="token punctuation">(</span><span class="token variable">$curl</span><span class="token punctuation">))</span> <span class="token punctuation">{<!-- --></span>
        print <span class="token string">"Error: "</span> <span class="token builtin class-name">.</span> curl_error<span class="token punctuation">(</span><span class="token variable">$curl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
       <span class="token variable">$result</span><span class="token operator">=</span>json_decode<span class="token punctuation">(</span><span class="token variable">$data</span>,true<span class="token punctuation">)</span><span class="token punctuation">;</span>
    //  <span class="token variable">$ACCESS_TOKEN</span><span class="token operator">=</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string">'access_token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        curl_close<span class="token punctuation">(</span><span class="token variable">$curl</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//å…³é—­è¿æ¥
        //  <span class="token builtin class-name">return</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string">'access_token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         // //å­˜å…¥åˆ°redis
// // å¦‚æœæœªä¿®æ”¹php.iniä¸‹é¢ä¸¤è¡Œæ³¨é‡Šå»æ‰
 ini_set<span class="token punctuation">(</span><span class="token string">'session.save_handler'</span>, <span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 ini_set<span class="token punctuation">(</span><span class="token string">'session.save_path'</span>, <span class="token string">'tcp://127.0.0.1:6379'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token variable">$redis</span> <span class="token operator">=</span> new redis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token variable">$redis</span>-<span class="token operator">&gt;</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token variable">$redis</span>-<span class="token operator">&gt;</span>set<span class="token punctuation">(</span><span class="token string">'kuaiquyin_wx_token'</span>,<span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string">'access_token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token builtin class-name">echo</span> <span class="token variable">$redis</span>-<span class="token operator">&gt;</span>get<span class="token punctuation">(</span><span class="token string">'kuaiquyin_wx_token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 ?<span class="token operator">&gt;</span>
</code></pre>
<p>æˆ‘ä»¬è®¿é—®æµ‹è¯•ä¸‹ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/da44810a0fab4d0ca4f530438f56bdab.png"/></p>
<p>è®¾è®¡å®šæ—¶å™¨è§¦å‘æ›´æ–°access_token<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/e7426c40b78f4571aa1af1c3a46e7b11.png"/></p>
<h2><a id="notifyphp_313"></a>ä¿®æ”¹notify.phpæ–‡ä»¶</h2>
<p>æ‰“å¼€å°ç¨‹åºæ¨¡æ¿çš„è¯¦æƒ…æˆ‘ä»¬è¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚æˆ‘çš„ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/41e755e586174fd2a4ba686abbd083d8.png"/></p>
<p>é‚£å°±éœ€è¦æŠŠå†…å®¹çš„æ•°æ®æ›¿æ¢</p>
<p>æ›¿æ¢ånotify.phpæ–‡ä»¶å¦‚ä¸‹ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/c051fd5be9ac4f17a875181ba045cf24.png"/></p>
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>?php
// å¾®ä¿¡å°ç¨‹åºé€šçŸ¥ä¸»è¦å‡½æ•°
//http_request åˆ©ç”¨curlè¯·æ±‚  ä¸¤ä¸ªå‚æ•°   urlè¿æ¥åœ°å€   æ•°æ®ä¿¡æ¯
<span class="token keyword">function</span> http_request<span class="token punctuation">(</span><span class="token variable">$url</span>,<span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$ch</span> <span class="token operator">=</span> curl_init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//åˆå§‹åŒ–
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_URL, <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//è®¾ç½®
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_SSL_VERIFYPEER, FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_SSL_VERIFYHOST, FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_POST, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl_setopt<span class="token punctuation">(</span><span class="token variable">$ch</span>, CURLOPT_POSTFIELDS, <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$output</span> <span class="token operator">=</span> curl_exec<span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//æ‰§è¡Œ 
    curl_close<span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//å…³é—­
    <span class="token builtin class-name">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>//è¿”å›ç»“æœ
<span class="token punctuation">}</span>

//å°è£…æ–¹æ³•

//ç­¾åˆ°
 <span class="token keyword">function</span> notify_sign<span class="token punctuation">(</span><span class="token variable">$touser</span>,<span class="token variable">$ACCESS_TOKEN</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token variable">$template</span><span class="token operator">=</span>array<span class="token punctuation">(</span>
        <span class="token string">'touser'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$touser</span>"</span>,//æ¥æ”¶æ–¹openid
        <span class="token string">'template_id'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"6io5lFL**********HLQ"</span>,    //æ¨¡æ¿çš„id
        <span class="token string">'page'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"pages/jifen/jifen"</span>,//ç‚¹å‡»å°ç¨‹åºè®¢é˜…æ¶ˆæ¯è·³è½¬çš„é¡µ
        <span class="token string">'data'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span>
            // <span class="token string">'character_string1'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"<span class="token variable">$out_trade_no</span>"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"#00008B"</span><span class="token punctuation">)</span>,   
            <span class="token string">'thing1'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"ç§¯åˆ†ç­¾åˆ°æé†’"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,  
            // <span class="token string">'amount4'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"15"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,  
            <span class="token string">'thing2'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"ç­¾åˆ°è·å¾—10ç§¯åˆ†"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,
            <span class="token string">'thing5'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"ç‚¹å‡»ç«‹å³ç­¾åˆ°"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,
            <span class="token string">'phrase6'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"ä»Šå¤©è¿˜æ²¡ç­¾åˆ°å“¦"</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        // <span class="token string">'phrase1'</span><span class="token operator">=</span><span class="token operator">&gt;</span>array<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token operator">=</span><span class="token operator">&gt;</span>urlencode<span class="token punctuation">(</span><span class="token variable">$plan</span><span class="token punctuation">)</span>,<span class="token string">'color'</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">'#00008B'</span><span class="token punctuation">)</span>,   //æ—¶é—´
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$json_template</span><span class="token operator">=</span>json_encode<span class="token punctuation">(</span><span class="token variable">$template</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$url</span><span class="token operator">=</span><span class="token string">"https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token="</span><span class="token builtin class-name">.</span><span class="token variable">$ACCESS_TOKEN</span><span class="token punctuation">;</span>
    <span class="token variable">$res</span><span class="token operator">=</span>http_request<span class="token punctuation">(</span><span class="token variable">$url</span>,urldecode<span class="token punctuation">(</span><span class="token variable">$json_template</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
    print_r<span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


?<span class="token operator">&gt;</span>
</code></pre>
<h2><a id="_368"></a>æµ‹è¯•</h2>
<p>é€šè¿‡å®šæ—¶è®¡åˆ’æˆ‘ä»¬å…ˆè§¦å‘ä¸€æ¬¡access_tokençš„è·å–<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/82454c20f955484485a8755588572423.png"/><br/> ç„¶åæ–°å»ºsign.phpæ–‡ä»¶</p>
<p>å†™å…¥ä»£ç </p>
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>?php
//ç­¾åˆ°é€šçŸ¥
header<span class="token punctuation">(</span><span class="token string">"Content-type:text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//å­—ç¬¦ç¼–ç è®¾ç½®  

//é€šçŸ¥
 include <span class="token string">'notify.php'</span><span class="token punctuation">;</span>//å¼•ç”¨é€šçŸ¥æ¨¡æ¿æ–‡ä»¶
 ini_set<span class="token punctuation">(</span><span class="token string">'session.save_handler'</span>, <span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 ini_set<span class="token punctuation">(</span><span class="token string">'session.save_path'</span>, <span class="token string">'tcp://127.0.0.1:6379'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token variable">$redis</span> <span class="token operator">=</span> new redis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token variable">$redis</span>-<span class="token operator">&gt;</span>connect<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span>, <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token variable">$redius_token</span><span class="token operator">=</span><span class="token variable">$redis</span>-<span class="token operator">&gt;</span>get<span class="token punctuation">(</span><span class="token string">'kuaiquyin_wx_token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>//é‰´æƒ

// <span class="token variable">$name</span><span class="token operator">=</span>mb_substr<span class="token punctuation">(</span><span class="token variable">$name</span>,0,10,<span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
notify_sign<span class="token punctuation">(</span><span class="token string">"ä½ çš„openid"</span>,<span class="token variable">$redius_token</span>,<span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>openidæ˜¯å°ç¨‹åºç™»é™†åç»™çš„ï¼Œå¯ä»¥å»å‚è€ƒå…¶ä»–æ–‡ç« ï¼Œè¿™é‡Œä¸åšè¯´æ˜<br/> ä¾‹å¦‚æˆ‘çš„openid<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/ce47a5510fc54f15a9266959bcb28900.png"/><br/> å†™å…¥åï¼Œå»å°ç¨‹åºç‚¹å‡»ç­¾åˆ°æˆæƒ<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/e098aee1ecb947a9b09cf000490cb399.png"/><br/> è®¿é—®åæŠ¥é”™ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/12f1f58bf4e54cf8aec5ac90d4700568.png"/><br/> æˆ‘ä»¬çœ‹ä¸€ä¸‹æ˜¯å•¥é”™è¯¯<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/abee34e0abff48cf83fa2dcc4bcf18ec.png"/><br/> ä¸å¥½æ„æ€ğŸ˜„å¿˜è®°æ”¹äº†ï¼Œå¿˜è®°æ”¹openidäº†</p>
<p>æ”¹äº†ä¹‹åï¼š</p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/77eb64c1f1a640fd93d09795d02fa895.png"/><br/> å¾®ä¿¡æˆåŠŸæ”¶åˆ°æ¶ˆæ¯<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/0a41b1adfbaf451096f8b1262a400756.png"/></p>
<h1><a id="_410"></a>æ€»ç»“</h1>
<p>ä»¥ä¸Šå°±æ˜¯ä»Šå¤©çš„æ•™ç¨‹ï¼Œåšä¸€ä¸ªç®€å•çš„è®°å½•ï¼Œæ–¹ä¾¿è‡ªå·±ä»¥åèƒ½ç”¨åˆ°ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åŠ©åˆ°å±å¹•ä¸­å›°æ‰°çš„ä½ ï¼Œè°¢è°¢æ”¯æŒ</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>