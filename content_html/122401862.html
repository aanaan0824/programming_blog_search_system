<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-tomorrow-night" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p><strong>小伙伴想精准查找自己想看的MySQL文章？喏 → <a href="https://blog.csdn.net/qq_39390545/article/details/107786761">MySQL专栏目录 | 点击这里</a></strong></p>
<blockquote>
<p>  MySQL<code>行转列</code>，对经常处理数据的同学们来说，一定是不陌生的，甚至是印象深刻，因为它大概率困扰过你，让你为之一愣~ 但当你看到本文后，这个问题就不在是问题，及时收藏，以后谁再问你这个问题，直接甩他脸上，粘贴即用。</p>
</blockquote>
<p>  这里告诉大家一个小秘密，其实我和<code>《小欢喜》</code>里面的几位是同学还是好朋友~~今天我就拿我们哥儿几个高考成绩表来当测试表。嗯，兄弟们不信？<code>我还有我们在学校里的合影呢，高三那年还没有PS，所以照片肯定是真的！</code>😉😉</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/bfe0d5f0293c441f9d9ee10b62a241ff.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAX-mZiOWTiOWTiA==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>废话不多说，首先，我们看一下咱们的<code>测试表数据</code>和<code>预期查询的结果</code>。</p>
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t_gaokao_score<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+--------------+--------------+-------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> student_name <span class="token operator">|</span> subject      <span class="token operator">|</span> score <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+--------------+-------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 林磊儿       <span class="token operator">|</span> 语文         <span class="token operator">|</span>   <span class="token number">148</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 林磊儿       <span class="token operator">|</span> 数学         <span class="token operator">|</span>   <span class="token number">150</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 林磊儿       <span class="token operator">|</span> 英语         <span class="token operator">|</span>   <span class="token number">147</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 乔英子       <span class="token operator">|</span> 语文         <span class="token operator">|</span>   <span class="token number">121</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> 乔英子       <span class="token operator">|</span> 数学         <span class="token operator">|</span>   <span class="token number">106</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> 乔英子       <span class="token operator">|</span> 英语         <span class="token operator">|</span>   <span class="token number">146</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> 方一凡       <span class="token operator">|</span> 语文         <span class="token operator">|</span>    <span class="token number">70</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> 方一凡       <span class="token operator">|</span> 数学         <span class="token operator">|</span>    <span class="token number">90</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> 方一凡       <span class="token operator">|</span> 英语         <span class="token operator">|</span>    <span class="token number">59</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> 方一凡       <span class="token operator">|</span> 特长加分     <span class="token operator">|</span>   <span class="token number">200</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> 陈哈哈       <span class="token operator">|</span> 语文         <span class="token operator">|</span>   <span class="token number">109</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> 陈哈哈       <span class="token operator">|</span> 数学         <span class="token operator">|</span>    <span class="token number">92</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">13</span> <span class="token operator">|</span> 陈哈哈       <span class="token operator">|</span> 英语         <span class="token operator">|</span>    <span class="token number">80</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+--------------+--------------+-------+</span>
<span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre>
<p>看看我们<code>行转列</code>转完后的结果:</p>
<pre><code class="prism language-sql"><span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------------+</span>
<span class="token operator">|</span> student_name <span class="token operator">|</span> 语文   <span class="token operator">|</span> 数学   <span class="token operator">|</span> 英语   <span class="token operator">|</span> 特长加分     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------------+</span>
<span class="token operator">|</span> 林磊儿       <span class="token operator">|</span>    <span class="token number">148</span> <span class="token operator">|</span>    <span class="token number">150</span> <span class="token operator">|</span>    <span class="token number">147</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> 乔英子       <span class="token operator">|</span>    <span class="token number">121</span> <span class="token operator">|</span>    <span class="token number">106</span> <span class="token operator">|</span>    <span class="token number">146</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">|</span> 方一凡       <span class="token operator">|</span>     <span class="token number">70</span> <span class="token operator">|</span>     <span class="token number">90</span> <span class="token operator">|</span>     <span class="token number">59</span> <span class="token operator">|</span>          <span class="token number">200</span> <span class="token operator">|</span>
<span class="token operator">|</span> 陈哈哈       <span class="token operator">|</span>    <span class="token number">109</span> <span class="token operator">|</span>     <span class="token number">92</span> <span class="token operator">|</span>     <span class="token number">80</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre>
<p>  好，下面我们一起来看看SQL是如何编写的，对了，<code>创建表结构和导入测试数据的SQL放到文章末尾了</code>，自取~</p>
<hr/>
<p></p>
<div class="toc">
<h3>飞机票</h3>
<ul><li><a href="#SQL_53">一、行转列SQL写法</a></li><li><a href="#_91">二、如果领导@你，让你在结果集中加上总数列呢？</a></li><li><a href="#_126">三、领导又双叒叕@你改需求</a></li><li><a href="#_214">四、结束语</a></li><li><a href="#SQL_225">附录：创建表结构&amp;测试数据SQL</a></li></ul>
</div>
<p></p>
<hr/>
<h1><a id="SQL_53"></a>一、行转列SQL写法</h1>
<ul><li>方法一、使用<code>case..when..then</code>进行 行转列</li></ul>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> student_name<span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> <span class="token keyword">WHEN</span> <span class="token string">'语文'</span> <span class="token keyword">THEN</span> score <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'语文'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> <span class="token keyword">WHEN</span> <span class="token string">'数学'</span> <span class="token keyword">THEN</span> score <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'数学'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> <span class="token keyword">WHEN</span> <span class="token string">'英语'</span> <span class="token keyword">THEN</span> score <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'英语'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> <span class="token keyword">WHEN</span> <span class="token string">'特长加分'</span> <span class="token keyword">THEN</span> score <span class="token keyword">ELSE</span> <span class="token number">0</span> <span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'特长加分'</span> 
<span class="token keyword">FROM</span> t_gaokao_score 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> student_name<span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>  这里如果不使用SUM()会报<code>sql_mode=only_full_group_by</code>相关错误，需要<code>聚合函数和group by连用</code>或<code>使用distinct</code>才可以解决。<br/><br/>   其实，加了<code>SUM()</code>是为了能够使用GROUP BY根据student_name进行分组，每一个student_name对应的<code>subject="语文"</code>的记录毕竟只有一条，所以SUM() 的值就等于对应那一条记录的score的值。当然，也可以换成<code>MAX()</code>。</p>
</blockquote>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/69324c9052c041a98f2972190ebee17e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAX-mZiOWTiOWTiA==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<ul><li>方法二、使用<code>IF()</code>进行 行转列：</li></ul>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> student_name<span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'语文'</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'语文'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'数学'</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'数学'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'英语'</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'英语'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'特长加分'</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'特长加分'</span> 
<span class="token keyword">FROM</span> t_gaokao_score 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> student_name<span class="token punctuation">;</span>
</code></pre>
<p>  该方法将<code>IF(subject='语文',score,0)</code>作为条件，通过student_name进行分组，对分组后所有subject='语文’的记录的score字段进行SUM()操作，如果score没有值则默认为0。</p>
<p>  这种方式和<code>case..when..then</code>方法原理相同，相比更加简洁明了，建议使用。</p>
<h1><a id="_91"></a>二、如果领导@你，让你在结果集中加上总数列呢？</h1>
<blockquote>
<p><code>友情提示</code>：<strong>我们工作中处理行转列数据时，尽量都把总数、平均数等加上，方便领导查阅，省得他循环BB你。</strong><br/><br/> 话说，你还记得上学时的成绩表是啥样的么？你一般从上往下看还是从下往上看呢？<code>文末投票，快来给大家乐呵乐呵！</code></p>
</blockquote>
<p>写法：利用<code>SUM(IF())</code> 生成列，<code>WITH ROLLUP</code> 生成汇总列和行,并利用 <code>IFNULL</code>将汇总行标题显示为<code>总数</code></p>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span>student_name<span class="token punctuation">,</span><span class="token string">'总数'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> student_name<span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'语文'</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'语文'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'数学'</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'数学'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'英语'</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'英语'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'特长加分'</span><span class="token punctuation">,</span>score<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'特长加分'</span><span class="token punctuation">,</span>
	<span class="token function">SUM</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'总数'</span> 
<span class="token keyword">FROM</span> t_gaokao_score
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> student_name <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span>
</code></pre>
<p>查询结果：</p>
<pre><code class="prism language-sql"><span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------------+--------+</span>
<span class="token operator">|</span> student_name <span class="token operator">|</span> 语文   <span class="token operator">|</span> 数学   <span class="token operator">|</span> 英语   <span class="token operator">|</span> 特长加分     <span class="token operator">|</span> 总数   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------------+--------+</span>
<span class="token operator">|</span> 乔英子       <span class="token operator">|</span>    <span class="token number">121</span> <span class="token operator">|</span>    <span class="token number">106</span> <span class="token operator">|</span>    <span class="token number">146</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>    <span class="token number">373</span> <span class="token operator">|</span>
<span class="token operator">|</span> 方一凡       <span class="token operator">|</span>     <span class="token number">70</span> <span class="token operator">|</span>     <span class="token number">90</span> <span class="token operator">|</span>     <span class="token number">59</span> <span class="token operator">|</span>          <span class="token number">200</span> <span class="token operator">|</span>    <span class="token number">419</span> <span class="token operator">|</span>
<span class="token operator">|</span> 林磊儿       <span class="token operator">|</span>    <span class="token number">148</span> <span class="token operator">|</span>    <span class="token number">150</span> <span class="token operator">|</span>    <span class="token number">147</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>    <span class="token number">445</span> <span class="token operator">|</span>
<span class="token operator">|</span> 陈哈哈       <span class="token operator">|</span>    <span class="token number">113</span> <span class="token operator">|</span>    <span class="token number">116</span> <span class="token operator">|</span>     <span class="token number">80</span> <span class="token operator">|</span>            <span class="token number">0</span> <span class="token operator">|</span>    <span class="token number">309</span> <span class="token operator">|</span>
<span class="token operator">|</span> 总数         <span class="token operator">|</span>    <span class="token number">452</span> <span class="token operator">|</span>    <span class="token number">462</span> <span class="token operator">|</span>    <span class="token number">432</span> <span class="token operator">|</span>          <span class="token number">200</span> <span class="token operator">|</span>   <span class="token number">1546</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------------+--------+</span>
<span class="token number">5</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span><span class="token punctuation">,</span> <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre>
<h1><a id="_126"></a>三、领导又双叒叕@你改需求</h1>
<p>  让你把分值转化为具体内容显示（优秀、良好、普通、差），430分以上重点大学，400分以上一本，350分及以上二本，350以下搬砖，该怎么写呢？</p>
<p>  真恶心，不说了，先淦饭🐶🐶~~（独门绝技：<code>饭遁</code>）</p>
<p>  这里我们就需要<code>case when嵌套</code>一下了，看着高大上，其实就是普通的嵌套而已。在第一层查出分组后的各科分数，在第二层替换成等级即可。</p>
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> student_name<span class="token punctuation">,</span>
<span class="token function">MAX</span><span class="token punctuation">(</span>  
        <span class="token keyword">CASE</span> subject  
        <span class="token keyword">WHEN</span> <span class="token string">'语文'</span> <span class="token keyword">THEN</span>  
            <span class="token punctuation">(</span>  
                <span class="token keyword">CASE</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'语文'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'优秀'</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'语文'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'良好'</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'语文'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'普通'</span>  
                <span class="token keyword">ELSE</span>  
                    <span class="token string">'差'</span>  
                <span class="token keyword">END</span>  
            <span class="token punctuation">)</span>  
        <span class="token keyword">END</span>  
    <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'语文'</span><span class="token punctuation">,</span> 
<span class="token function">MAX</span><span class="token punctuation">(</span>  
        <span class="token keyword">CASE</span> subject  
        <span class="token keyword">WHEN</span> <span class="token string">'数学'</span> <span class="token keyword">THEN</span>  
            <span class="token punctuation">(</span>  
                <span class="token keyword">CASE</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'数学'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'优秀'</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'数学'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'良好'</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'数学'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'普通'</span>  
                <span class="token keyword">ELSE</span>  
                    <span class="token string">'差'</span>  
                <span class="token keyword">END</span>  
            <span class="token punctuation">)</span>  
        <span class="token keyword">END</span>  
    <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'数学'</span><span class="token punctuation">,</span>
<span class="token function">MAX</span><span class="token punctuation">(</span>  
        <span class="token keyword">CASE</span> subject  
        <span class="token keyword">WHEN</span> <span class="token string">'英语'</span> <span class="token keyword">THEN</span>  
            <span class="token punctuation">(</span>  
                <span class="token keyword">CASE</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'英语'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'优秀'</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'英语'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'良好'</span>  
                <span class="token keyword">WHEN</span> score <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">from</span> t_gaokao_score <span class="token keyword">where</span> subject<span class="token operator">=</span><span class="token string">'英语'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token keyword">THEN</span>  
                    <span class="token string">'普通'</span>  
                <span class="token keyword">ELSE</span>  
                    <span class="token string">'差'</span>  
                <span class="token keyword">END</span>  
            <span class="token punctuation">)</span>  
        <span class="token keyword">END</span>  
    <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'英语'</span><span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'总分'</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> <span class="token function">SUM</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">430</span> <span class="token keyword">THEN</span> <span class="token string">'重点大学'</span>  
	  <span class="token keyword">WHEN</span> <span class="token function">SUM</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">400</span> <span class="token keyword">THEN</span> <span class="token string">'一本'</span>  
	  <span class="token keyword">WHEN</span> <span class="token function">SUM</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">350</span> <span class="token keyword">THEN</span> <span class="token string">'二本'</span>  
	  <span class="token keyword">ELSE</span> <span class="token string">'工地搬砖'</span> 
	  <span class="token keyword">END</span> <span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">'结果'</span>
<span class="token keyword">FROM</span> t_gaokao_score 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> student_name 
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">SUM</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre>
<p>我们来看一下输出结果：</p>
<pre><code class="prism language-sql"><span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------+--------------+</span>
<span class="token operator">|</span> student_name <span class="token operator">|</span> 语文   <span class="token operator">|</span> 数学   <span class="token operator">|</span> 英语   <span class="token operator">|</span> 总分   <span class="token operator">|</span> 结果         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------+--------------+</span>
<span class="token operator">|</span> 林磊儿       <span class="token operator">|</span> 优秀   <span class="token operator">|</span> 优秀   <span class="token operator">|</span> 优秀   <span class="token operator">|</span>    <span class="token number">445</span> <span class="token operator">|</span> 重点大学     <span class="token operator">|</span>
<span class="token operator">|</span> 方一凡       <span class="token operator">|</span> 差     <span class="token operator">|</span> 差     <span class="token operator">|</span> 差     <span class="token operator">|</span>    <span class="token number">419</span> <span class="token operator">|</span> 一本         <span class="token operator">|</span>
<span class="token operator">|</span> 乔英子       <span class="token operator">|</span> 普通   <span class="token operator">|</span> 差     <span class="token operator">|</span> 优秀   <span class="token operator">|</span>    <span class="token number">373</span> <span class="token operator">|</span> 二本         <span class="token operator">|</span>
<span class="token operator">|</span> 陈哈哈       <span class="token operator">|</span> 普通   <span class="token operator">|</span> 普通   <span class="token operator">|</span> 差     <span class="token operator">|</span>    <span class="token number">309</span> <span class="token operator">|</span> 工地搬砖     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------+--------+--------+--------+--------+--------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre>
<p>过来人的经验来看，老实孩子最吃亏，早知道他娘的走艺体了~</p>
<h1><a id="_214"></a>四、结束语</h1>
<p>  好了，SQL方面就是以上这些内容了，有疑问可以写在评论区，哈哥会在摸鱼的时候回复你~~`</p>
<p>  帮忙三连一下哦，比心ღ( ´･ᴗ･` )</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3f33a3c904e14f17aa7f9772a5ccbe0c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAX-mZiOWTiOWTiA==,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<h1><a id="SQL_225"></a>附录：创建表结构&amp;测试数据SQL</h1>
<p><strong>表结构：</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>t_gaokao_score<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t_gaokao_score<span class="token punctuation">`</span>  <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>student_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'学生姓名'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'科目'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>score<span class="token punctuation">`</span> <span class="token keyword">double</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'成绩'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">11</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>
</code></pre>
<p><strong>导入测试数据</strong></p>
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>t_gaokao_score<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'林磊儿'</span><span class="token punctuation">,</span> <span class="token string">'语文'</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'林磊儿'</span><span class="token punctuation">,</span> <span class="token string">'数学'</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'林磊儿'</span><span class="token punctuation">,</span> <span class="token string">'英语'</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'乔英子'</span><span class="token punctuation">,</span> <span class="token string">'语文'</span><span class="token punctuation">,</span> <span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'乔英子'</span><span class="token punctuation">,</span> <span class="token string">'数学'</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'乔英子'</span><span class="token punctuation">,</span> <span class="token string">'英语'</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'方一凡'</span><span class="token punctuation">,</span> <span class="token string">'语文'</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'方一凡'</span><span class="token punctuation">,</span> <span class="token string">'数学'</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'方一凡'</span><span class="token punctuation">,</span> <span class="token string">'英语'</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'方一凡'</span><span class="token punctuation">,</span> <span class="token string">'特长加分'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'陈哈哈'</span><span class="token punctuation">,</span> <span class="token string">'语文'</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'陈哈哈'</span><span class="token punctuation">,</span> <span class="token string">'数学'</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">'陈哈哈'</span><span class="token punctuation">,</span> <span class="token string">'英语'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>