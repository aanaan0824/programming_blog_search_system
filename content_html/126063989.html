<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-dracula" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/f9e3f20ca2164eff958539c6588f2c32.png#pic_center"/><br/> </p>
<div class="toc">
<h3>æœ¬æ–‡ç›®å½•ï¼š</h3>
<ul><li><a href="#ORM__13">ä¸€ã€ORM å¯¹å…³è”è¡¨çš„æ“ä½œ</a></li><li><ul><li><a href="#1_54">1.å¤–é”®è¡¨å­—æ®µè®¿é—®</a></li><li><a href="#2_61">2.å¤–é”®è¡¨å­—æ®µè¿‡æ»¤</a></li><li><ul><li><a href="#21__70">2.1 é”™è¯¯æ–¹æ³•</a></li><li><a href="#22_idid_79">2.2 å…ˆè·å–ä¸­å›½çš„å›½å®¶idï¼Œç„¶åå†é€šè¿‡idå»æ‰¾</a></li><li><a href="#23_country__name_97">2.3 country__nameä¸€æ­¥åˆ°ä½</a></li><li><a href="#24_____105">2.4 åªéœ€è¦ å­¦ç”Ÿå§“å å’Œ å›½å®¶åä¸¤ä¸ªå­—æ®µ</a></li><li><a href="#25__113">2.5 é‡å‘½åä¸¤ä¸ªä¸‹åˆ’çº¿</a></li></ul>
</li><li><a href="#3_129">3.å¤–é”®è¡¨åå‘è®¿é—®</a></li><li><a href="#4_169">4.å¤–é”®è¡¨åå‘è¿‡æ»¤</a></li><li><ul><li><a href="#related_name__190">æ²¡æœ‰æŒ‡å®šrelated_nameï¼Œ åˆ™åº”è¯¥ä½¿ç”¨è¡¨åè½¬åŒ–ä¸ºå°å†™</a></li><li><a href="#_distinct_196">ä½¿ç”¨ .distinct()å»é‡</a></li></ul>
</li></ul>
</li><li><a href="#_211">äºŒã€å®ç°é¡¹ç›®ä»£ç </a></li><li><ul><li><a href="#1url_212">1.urlè·¯ç”±æ›´æ–°</a></li><li><a href="#2_286">2.äº‹åŠ¡ã€å¤šå¯¹å¤šè®°å½•æ·»åŠ </a></li><li><a href="#3ORM_350">3.ORMå¤–é”®å…³è”</a></li><li><ul><li><a href="#31_404">3.1åŒä¸‹åˆ’çº¿é—®é¢˜</a></li><li><a href="#32_435">3.2å¤šä¸ªè®¢å•é—®é¢˜</a></li></ul>
</li></ul>
</li><li><a href="#_471">`ã€ç³»åˆ—å¥½æ–‡æ¨èã€‘`</a></li></ul>
</div>
<p></p>
<blockquote>
<p><code>å‰è¨€ï¼š</code> ğŸ“¢ğŸ“¢ğŸ“¢<br/> ğŸ…ğŸ…ğŸ…ä½œè€…ç®€ä»‹ï¼šæ˜¯Dreamå‘€ï¼Œåä¸ºäº‘äº«ä¸“å®¶ã€CSDNåŸåŠ›è®¡åˆ’ä½œè€…ã€Pythoné¢†åŸŸä¼˜è´¨åˆ›ä½œè€…ï¼Œä¸“æ³¨åˆ†äº«Pythoné¢†åŸŸåŸåˆ›ç³»åˆ—æ–‡ç« ã€‚<br/> ğŸŒ»ğŸŒ»ğŸŒ»<strong>çƒ­é—¨ä¸“æ </strong>ï¼šã€<strong><a href="https://blog.csdn.net/weixin_51390582/category_11571272.html">é›¶åŸºç¡€å­¦Python</a></strong>ã€‘<br/> æœ¬è¯¾ç¨‹æ˜¯é’ˆå¯¹Pythonå…¥é—¨&amp;è¿›é˜¶æ‰“é€ çš„ä¸€å…¨å¥—è¯¾ç¨‹ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘å°†ä¼šä¸€ ä¸€æ›´æ–°PythonåŸºç¡€è¯­æ³•ã€Pythonçˆ¬è™«ã€Webå¼€å‘ã€ Djangoæ¡†æ¶ã€Flaskæ¡†æ¶ä»¥åŠäººå·¥æ™ºèƒ½ç›¸å…³çŸ¥è¯†ï¼Œå¸®åŠ©ä½ æˆä¸ºPythonå¤§ç¥ï¼Œå¦‚æœä½ å–œæ¬¢çš„è¯å°±æŠ“ç´§æ”¶è—è®¢é˜…èµ·æ¥å§~ğŸ’˜ğŸ’˜ğŸ’˜<br/> ğŸ‹ğŸ‹ğŸ‹å¦‚æœå¯¹å­¦ä¹ æ²¡æœ‰è‡ªåˆ¶åŠ›æˆ–è€…æ²¡æœ‰ä¸€èµ·å­¦ä¹ äº¤æµçš„åŠ¨åŠ›ï¼Œæ¬¢è¿ç§ä¿¡æˆ‘æˆ–è€…æ–‡æœ«æ·»åŠ vxï¼Œæ‹‰ä½ è¿›ç¾¤ï¼Œç¾¤å†…æœ‰è¡Œä¸šå¤§ä½¬å¸®å¤§å®¶è§£ç­”ç–‘é—®ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ ï¼Œç¾¤å†…å®šæœŸè¿˜ä¼šæœ‰æŠ½å¥–æ´»åŠ¨å’Œçº¢åŒ…ç›¸é€å—·ï¼Œå¿«æ¥è¿›å…¥æˆ‘ä»¬å§~<br/> ğŸ’• å…¥é—¨é¡»çŸ¥ï¼šè¿™ç‰‡ä¹å›­ä»ä¸ç¼ºä¹å¤©æ‰ï¼ŒåŠªåŠ›æ‰æ˜¯ä½ çš„æœ€ç»ˆå…¥åœºåˆ¸ï¼ğŸš€ğŸš€ğŸš€<br/> ğŸ’“æœ€åï¼Œæ„¿æˆ‘ä»¬éƒ½èƒ½åœ¨çœ‹ä¸åˆ°çš„åœ°æ–¹é—ªé—ªå‘å…‰ï¼Œä¸€èµ·åŠ æ²¹è¿›æ­¥ğŸºğŸºğŸº</p>
</blockquote>
<h1><a id="ORM__13"></a>ä¸€ã€ORM å¯¹å…³è”è¡¨çš„æ“ä½œ</h1>
<p>å‰é¢æˆ‘ä»¬å­¦è¿‡ ä¸€å¯¹å¤šï¼Œä¸€å¯¹ä¸€ï¼Œå¤šå¯¹å¤šï¼Œéƒ½æ˜¯é€šè¿‡å¤–é”®æ¥å®ç°ã€‚<br/> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¼”ç¤ºï¼ŒDjango ORM å¦‚ä½• æ“ä½œ å¤–é”®å…³è”å…³ç³»<br/> è¯·å¤§å®¶åœ¨ <code>models.py</code> ä¸­å®šä¹‰è¿™æ ·çš„ä¸¤ä¸ªModelï¼Œå¯¹åº”ä¸¤å¼ è¡¨ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/f2486350a4a1465ba2cb9e00e548a7b0.png"/><br/> <strong>ç„¶åï¼Œæ‰§è¡Œï¼š</strong></p>
<pre><code class="prism language-python">python manage<span class="token punctuation">.</span>py makemigrations common
python manage<span class="token punctuation">.</span>py migrate
</code></pre>
<p>äº§ç”Ÿäº†ä¸¤ä¸ªæ–°çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšåŠ è¿›å»çš„ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/f76311fac033401987a9cd97db184a55.png"/><br/> åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/764f2d1bc79d4b20b017387219233d44.png"/><br/> æ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­ä¾¿æ‰¾åˆ°äº†æˆ‘ä»¬çš„æ–‡ä»¶ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/048fd8ff802641fb81abf6c20db099dc.png"/><br/> ç„¶åï¼Œå‘½ä»¤è¡Œä¸­æ‰§è¡Œ <code>python manage.py shell</code> ï¼Œç›´æ¥å¯åŠ¨Djangoå‘½ä»¤è¡Œï¼Œè¾“å…¥ä»£ç ã€‚<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/6d36794b8cd149959b8c884324a6586a.png"/></p>
<p>å…ˆè¾“å…¥å¦‚ä¸‹ä»£ç ï¼Œåˆ›å»ºä¸€äº›æ•°æ®ï¼š</p>
<pre><code class="prism language-python"><span class="token keyword">from</span> common<span class="token punctuation">.</span>models <span class="token keyword">import</span> <span class="token operator">*</span>
c1 <span class="token operator">=</span> Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span>
c2 <span class="token operator">=</span> Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ç¾å›½'</span><span class="token punctuation">)</span>
c3 <span class="token operator">=</span> Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'æ³•å›½'</span><span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ç™½æœˆ'</span><span class="token punctuation">,</span> grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> country<span class="token operator">=</span>c1<span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'é»‘ç¾½'</span><span class="token punctuation">,</span> grade<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> country<span class="token operator">=</span>c1<span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'å¤§ç½—'</span><span class="token punctuation">,</span> grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> country<span class="token operator">=</span>c1<span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'çœŸä½›'</span><span class="token punctuation">,</span> grade<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> country<span class="token operator">=</span>c1<span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> country<span class="token operator">=</span>c2<span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Gus'</span><span class="token punctuation">,</span>  grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> country<span class="token operator">=</span>c2<span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'White'</span><span class="token punctuation">,</span> grade<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> country<span class="token operator">=</span>c2<span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Napolen'</span><span class="token punctuation">,</span> grade<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> country<span class="token operator">=</span>c3<span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/36041affafe24cb8ad3e7d5e41986bcb.png"/></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨æˆ‘ä»¬çš„å›½å®¶è¡¨å’Œå­¦ç”Ÿè¡¨ä¸­éƒ½äº§ç”Ÿäº†æˆ‘ä»¬æ·»åŠ çš„åå•ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/9701496472bf469d95b0c34e5c5ba6fc.png"/><br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/c2312771445f4495a786136b29c0c45b.png"/></p>
<h2><a id="1_54"></a>1.å¤–é”®è¡¨å­—æ®µè®¿é—®</h2>
<p>å¦‚æœä½ å·²ç»è·å–äº†ä¸€ä¸ªstudentå¯¹è±¡ï¼Œè¦å¾—åˆ°ä»–çš„å›½å®¶åç§°åªéœ€è¿™æ ·ï¼š</p>
<pre><code class="prism language-python">s1 <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ç™½æœˆ'</span><span class="token punctuation">)</span>
s1<span class="token punctuation">.</span>country<span class="token punctuation">.</span>name
</code></pre>
<h2><a id="2_61"></a>2.å¤–é”®è¡¨å­—æ®µè¿‡æ»¤</h2>
<p>å¦‚æœï¼Œæˆ‘ä»¬è¦æŸ¥æ‰¾Studentè¡¨ä¸­æ‰€æœ‰ ä¸€å¹´çº§ å­¦ç”Ÿï¼Œå¾ˆç®€å•ï¼š</p>
<pre><code class="prism language-python">Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/d5a9878d1cce4e13abf1f74017cacfa0.png"/></p>
<p>å¦‚æœç°åœ¨ï¼Œæˆ‘ä»¬è¦æŸ¥æ‰¾Studentè¡¨ä¸­æ‰€æœ‰ ä¸€å¹´çº§ä¸­å›½ å­¦ç”Ÿï¼Œè¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿ</p>
<h3><a id="21__70"></a>2.1 é”™è¯¯æ–¹æ³•</h3>
<p><strong>ä¸èƒ½è¿™ä¹ˆå†™ï¼š</strong></p>
<pre><code class="prism language-python">Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>country<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/4e35dd65b01d49079ed8fdcb4a9698f8.png"/><br/> å› ä¸ºï¼ŒStudentè¡¨ä¸­ country å¹¶ä¸æ˜¯å›½å®¶åç§°å­—ç¬¦ä¸²å­—æ®µï¼Œè€Œæ˜¯ä¸€ä¸ªå¤–é”®å­—æ®µï¼Œå…¶å®æ˜¯å¯¹åº” Country è¡¨ä¸­ id å­—æ®µ ã€‚</p>
<h3><a id="22_idid_79"></a>2.2 å…ˆè·å–ä¸­å›½çš„å›½å®¶idï¼Œç„¶åå†é€šè¿‡idå»æ‰¾</h3>
<p>å¯èƒ½æœ‰çš„æœ‹å‹ä¼šè¿™æ ·æƒ³ï¼šæˆ‘å¯ä»¥å…ˆè·å–ä¸­å›½çš„å›½å®¶idï¼Œç„¶åå†é€šè¿‡idå»æ‰¾ï¼Œåƒè¿™æ ·</p>
<pre><code class="prism language-python">cn <span class="token operator">=</span> Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>country_id<span class="token operator">=</span>cn<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/fd17632cbf28400ea2e5da7314122ebb.png"/><br/> æ³¨æ„å¤–é”®å­—æ®µçš„idæ˜¯é€šè¿‡åç¼€ _id è·å–çš„ã€‚</p>
<p>æˆ–è€…è¿™æ ·ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„</p>
<pre><code class="prism language-python">cn <span class="token operator">=</span> Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>country<span class="token operator">=</span>cn<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>ä¸Šé¢çš„æ–¹æ³•ï¼Œå†™èµ·æ¥<strong>éº»çƒ¦ä¸€äº›ï¼Œæœ‰ä¸¤æ­¥æ“ä½œ</strong>ã€‚è€Œä¸”éœ€è¦<strong>å‘é€ä¸¤æ¬¡æ•°æ®è¯·æ±‚ç»™æ•°æ®åº“æœåŠ¡ï¼Œæ€§èƒ½ä¸é«˜</strong>ã€‚</p>
<h3><a id="23_country__name_97"></a>2.3 country__nameä¸€æ­¥åˆ°ä½</h3>
<p>å…¶å®ï¼ŒDjango ORM ä¸­ï¼Œå¯¹å¤–é”®å…³è”ï¼Œæœ‰æ›´æ–¹ä¾¿çš„è¯­æ³•ã€‚</p>
<pre><code class="prism language-python">Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>country__name<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>å†™èµ·æ¥ç®€å•ï¼Œä¸€æ­¥åˆ°ä½ï¼Œè€Œä¸”åªéœ€è¦å‘é€ä¸€ä¸ªæ•°æ®åº“è¯·æ±‚ï¼Œæ€§èƒ½æ›´å¥½ã€‚<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/d78731d3091141ca96119441e2ff29e5.png"/></p>
<h3><a id="24_____105"></a>2.4 åªéœ€è¦ å­¦ç”Ÿå§“å å’Œ å›½å®¶åä¸¤ä¸ªå­—æ®µ</h3>
<p>å¦‚æœè¿”å›ç»“æœåªéœ€è¦ <strong>å­¦ç”Ÿå§“å</strong> å’Œ <strong>å›½å®¶å</strong>ä¸¤ä¸ªå­—æ®µï¼Œå¯ä»¥è¿™æ ·æŒ‡å®švalueså†…å®¹ï¼š</p>
<pre><code class="prism language-python">Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>country__name<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span>\
     <span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'country__name'</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/cc3632805e4d48f5a656c58ec279cf4b.png"/></p>
<h3><a id="25__113"></a>2.5 é‡å‘½åä¸¤ä¸ªä¸‹åˆ’çº¿</h3>
<p>ä½†æ˜¯è¿™æ ·å†™æœ‰ä¸ªé—®é¢˜ï¼šé€‰æ‹©å‡ºæ¥çš„è®°å½•ä¸­ï¼Œå›½å®¶åæ˜¯ country__name ã€‚ ä¸¤ä¸ªä¸‹åˆ’çº¿æ¯”è¾ƒæ€ªã€‚<br/> æœ‰æ—¶å€™ï¼Œå‰åç«¯æ¥å£çš„è®¾è®¡è€…ï¼Œå®šä¹‰å¥½äº†æ¥å£æ ¼å¼ï¼Œå¦‚æœè¦æ±‚ä¸€å®šæ˜¯ countryname è¿™æ ·æ€ä¹ˆåŠï¼Ÿ<br/> å¯ä»¥ä½¿ç”¨ <code>annotate æ–¹æ³•</code>å°†è·å–çš„å­—æ®µå€¼è¿›è¡Œé‡å‘½åï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F

<span class="token comment"># annotate å¯ä»¥å°†è¡¨å­—æ®µè¿›è¡Œåˆ«åå¤„ç†</span>
Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>
    countryname<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'country__name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    studentname<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>\
    <span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>countryname<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'studentname'</span><span class="token punctuation">,</span><span class="token string">'countryname'</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/158da3fed5ff46b5828da145af28bc33.png"/></p>
<h2><a id="3_129"></a>3.å¤–é”®è¡¨åå‘è®¿é—®</h2>
<p>å‰é¢å­¦è¿‡ï¼Œ Django ORMä¸­ï¼Œå…³è”è¡¨ æ­£å‘å…³ç³»æ˜¯é€šè¿‡è¡¨å¤–é”®å­—æ®µï¼ˆæˆ–è€…å¤šå¯¹å¤šï¼‰è¡¨ç¤ºï¼Œ æ¯”å¦‚å‰é¢ä¾‹å­ä¸­Studentè¡¨çš„ countryå­—æ®µã€‚</p>
<p>è€Œåå‘å…³ç³»ï¼Œæ˜¯é€šè¿‡ è¡¨Modelåè½¬åŒ–ä¸ºå°å†™ è¡¨ç¤ºçš„ã€‚<br/> æ¯”å¦‚ï¼Œä½ å·²ç»è·å–äº†ä¸€ä¸ªCountryå¯¹è±¡ï¼Œå¦‚ä½•è·å–åˆ°æ‰€æœ‰å±äºè¿™ä¸ªå›½å®¶çš„å­¦ç”Ÿå‘¢ï¼Ÿ<br/> å¯ä»¥è¿™æ ·</p>
<pre><code class="prism language-python">cn <span class="token operator">=</span> Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span>
cn<span class="token punctuation">.</span>student_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/c0a71846d4974f47ad348e263e99d0a8.png"/><br/> é€šè¿‡ è¡¨Modelåè½¬åŒ–ä¸ºå°å†™ ï¼Œåé¢åŠ ä¸Šä¸€ä¸ª _set æ¥è·å–æ‰€æœ‰çš„åå‘å¤–é”®å…³è”å¯¹è±¡</p>
<p>Djangoè¿˜ç»™å‡ºäº†ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥æ›´ç›´è§‚çš„åæ˜  å…³è”å…³ç³»ã€‚</p>
<p>åœ¨å®šä¹‰Modelçš„æ—¶å€™ï¼Œå¤–é”®å­—æ®µä½¿ç”¨ <strong>related_name</strong> å‚æ•°ï¼Œåƒè¿™æ ·ï¼š</p>
<pre><code class="prism language-python"><span class="token comment"># å›½å®¶è¡¨</span>
<span class="token keyword">class</span> <span class="token class-name">Country</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>

<span class="token comment"># country å­—æ®µæ˜¯å›½å®¶è¡¨çš„å¤–é”®ï¼Œå½¢æˆä¸€å¯¹å¤šçš„å…³ç³»</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name    <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    grade   <span class="token operator">=</span> models<span class="token punctuation">.</span>PositiveSmallIntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    country <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Country<span class="token punctuation">,</span>
                on_delete <span class="token operator">=</span> models<span class="token punctuation">.</span>PROTECT<span class="token punctuation">,</span>
                <span class="token comment"># æŒ‡å®šåå‘è®¿é—®çš„åå­—</span>
                related_name<span class="token operator">=</span><span class="token string">'students'</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/8f1964629e6a421b8b53289a1a7245df.png"/><br/> å°±å¯ä»¥ä½¿ç”¨æ›´ç›´è§‚çš„å±æ€§åï¼Œåƒè¿™æ ·</p>
<pre><code class="prism language-python">cn <span class="token operator">=</span> Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'ä¸­å›½'</span><span class="token punctuation">)</span>
cn<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h2><a id="4_169"></a>4.å¤–é”®è¡¨åå‘è¿‡æ»¤</h2>
<p>å¦‚æœæˆ‘ä»¬è¦è·å–æ‰€æœ‰ å…·æœ‰ä¸€å¹´çº§å­¦ç”Ÿ çš„å›½å®¶åï¼Œè¯¥æ€ä¹ˆå†™ï¼Ÿ</p>
<p>å½“ç„¶å¯ä»¥è¿™æ ·</p>
<pre><code class="prism language-python"><span class="token comment"># å…ˆè·å–æ‰€æœ‰çš„ä¸€å¹´çº§å­¦ç”Ÿidåˆ—è¡¨</span>
country_ids <span class="token operator">=</span> Student<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'country'</span><span class="token punctuation">,</span> flat<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># å†é€šè¿‡idåˆ—è¡¨ä½¿ç”¨  id__in  è¿‡æ»¤</span>
Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>id__in<span class="token operator">=</span>country_ids<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/208c3ad637c64493b6bb08457ddefe86.png"/><br/> ä½†æ˜¯è¿™æ ·åŒæ ·å­˜åœ¨ éº»çƒ¦ å’Œæ€§èƒ½çš„é—®é¢˜ã€‚<br/> Django ORM å¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code class="prism language-python">Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>students__grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>æ³¨æ„ï¼Œ å› ä¸ºï¼Œæˆ‘ä»¬å®šä¹‰è¡¨çš„æ—¶å€™ï¼Œç”¨ related_name=â€˜studentsâ€™ æŒ‡å®šäº†åå‘å…³è”åç§° students ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ students__grade ã€‚ ä½¿ç”¨äº†åå‘å…³è”åå­—ã€‚</p>
<h3><a id="related_name__190"></a>æ²¡æœ‰æŒ‡å®šrelated_nameï¼Œ åˆ™åº”è¯¥ä½¿ç”¨è¡¨åè½¬åŒ–ä¸ºå°å†™</h3>
<p>å¦‚æœå®šä¹‰æ—¶ï¼Œæ²¡æœ‰æŒ‡å®šrelated_nameï¼Œ åˆ™åº”è¯¥ä½¿ç”¨ è¡¨åè½¬åŒ–ä¸ºå°å†™ ï¼Œå°±æ˜¯è¿™æ ·:</p>
<pre><code class="prism language-python">Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>student__grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="_distinct_196"></a>ä½¿ç”¨ .distinct()å»é‡</h3>
<p><strong>ä½†æ˜¯ï¼Œæˆ‘ä»¬å‘ç°ï¼Œè¿™ç§æ–¹å¼ï¼Œä¼šæœ‰é‡å¤çš„è®°å½•äº§ç”Ÿï¼Œå¦‚ä¸‹</strong><br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/fe259bd263a14bf49fbdaf683b64e6eb.png"/></p>
<pre><code class="prism language-python"><span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'ä¸­å›½'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'ä¸­å›½'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'ç¾å›½'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'ç¾å›½'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</code></pre>
<p>å¯ä»¥ä½¿ç”¨ <strong>.distinct()</strong> å»é‡:</p>
<pre><code class="prism language-python">Country<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>student__grade<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/9eeae142db864c10ac9d97cc7ebcb013.png"/></p>
<p>æ³¨æ„ï¼šdistinct()å¯¹MySQLæ•°æ®åº“æ— æ•ˆã€‚</p>
<h1><a id="_211"></a>äºŒã€å®ç°é¡¹ç›®ä»£ç </h1>
<h2><a id="1url_212"></a>1.urlè·¯ç”±æ›´æ–°</h2>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ mgr ç›®å½•ä¸‹é¢æ–°å»º order.py å¤„ç† å®¢æˆ·ç«¯å‘è¿‡æ¥çš„ åˆ—å‡ºè®¢å•ã€æ·»åŠ è®¢å• çš„è¯·æ±‚ã€‚<br/> åŒæ ·ï¼Œå…ˆå†™ dispatcher å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> JsonResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> IntegrityError<span class="token punctuation">,</span> transaction

<span class="token comment"># å¯¼å…¥ Order å¯¹è±¡å®šä¹‰</span>
<span class="token keyword">from</span>  common<span class="token punctuation">.</span>models <span class="token keyword">import</span>  Order<span class="token punctuation">,</span>OrderMedicine

<span class="token keyword">import</span> json

<span class="token keyword">def</span> <span class="token function">dispatcher</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># æ ¹æ®sessionåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ˜¯ç™»å½•çš„ç®¡ç†å‘˜ç”¨æˆ·</span>
    <span class="token keyword">if</span> <span class="token string">'usertype'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>session<span class="token punctuation">:</span>
        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">'ret'</span><span class="token punctuation">:</span> <span class="token number">302</span><span class="token punctuation">,</span>
            <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'æœªç™»å½•'</span><span class="token punctuation">,</span>
            <span class="token string">'redirect'</span><span class="token punctuation">:</span> <span class="token string">'/mgr/sign.html'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            status<span class="token operator">=</span><span class="token number">302</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'usertype'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'mgr'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">'ret'</span><span class="token punctuation">:</span> <span class="token number">302</span><span class="token punctuation">,</span>
            <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'ç”¨æˆ·émgrç±»å‹'</span><span class="token punctuation">,</span>
            <span class="token string">'redirect'</span><span class="token punctuation">:</span> <span class="token string">'/mgr/sign.html'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            status<span class="token operator">=</span><span class="token number">302</span><span class="token punctuation">)</span>


    <span class="token comment"># å°†è¯·æ±‚å‚æ•°ç»Ÿä¸€æ”¾å…¥request çš„ params å±æ€§ä¸­ï¼Œæ–¹ä¾¿åç»­å¤„ç†</span>

    <span class="token comment"># GETè¯·æ±‚ å‚æ•° åœ¨ request å¯¹è±¡çš„ GETå±æ€§ä¸­</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        request<span class="token punctuation">.</span>params <span class="token operator">=</span> request<span class="token punctuation">.</span>GET

    <span class="token comment"># POST/PUT/DELETE è¯·æ±‚ å‚æ•° ä» request å¯¹è±¡çš„ body å±æ€§ä¸­è·å–</span>
    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'PUT'</span><span class="token punctuation">,</span><span class="token string">'DELETE'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># æ ¹æ®æ¥å£ï¼ŒPOST/PUT/DELETE è¯·æ±‚çš„æ¶ˆæ¯ä½“éƒ½æ˜¯ jsonæ ¼å¼</span>
        request<span class="token punctuation">.</span>params <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>

    <span class="token comment"># æ ¹æ®ä¸åŒçš„actionåˆ†æ´¾ç»™ä¸åŒçš„å‡½æ•°è¿›è¡Œå¤„ç†</span>
    action <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'action'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token string">'list_order'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> listorder<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> action <span class="token operator">==</span> <span class="token string">'add_order'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> addorder<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

    <span class="token comment"># è®¢å• æš‚ ä¸æ”¯æŒä¿®æ”¹ å’Œåˆ é™¤</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'ret'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'ä¸æ”¯æŒè¯¥ç±»å‹httpè¯·æ±‚'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>å’Œä»¥å‰å·®ä¸å¤šï¼Œæ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬åœ¨ <code>mgr\urls.py</code> é‡Œé¢åŠ ä¸Š å¯¹ orders è¯·æ±‚å¤„ç†çš„è·¯ç”±ï¼š</p>
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> mgr <span class="token keyword">import</span> customer<span class="token punctuation">,</span>sign_in_out<span class="token punctuation">,</span>medicine<span class="token punctuation">,</span>order

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>

    path<span class="token punctuation">(</span><span class="token string">'customers'</span><span class="token punctuation">,</span> customer<span class="token punctuation">.</span>dispatcher<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'medicines'</span><span class="token punctuation">,</span> medicine<span class="token punctuation">.</span>dispatcher<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'orders'</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span>dispatcher<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment"># åŠ ä¸Šè¿™è¡Œ</span>

    path<span class="token punctuation">(</span><span class="token string">'signin'</span><span class="token punctuation">,</span> sign_in_out<span class="token punctuation">.</span>signin<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'signout'</span><span class="token punctuation">,</span> sign_in_out<span class="token punctuation">.</span>signout<span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/9b2aaf735bdb4f1b967dfe897c78c552.png"/></p>
<h2><a id="2_286"></a>2.äº‹åŠ¡ã€å¤šå¯¹å¤šè®°å½•æ·»åŠ </h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·»åŠ å‡½æ•° addorderï¼Œæ¥å¤„ç† æ·»åŠ è®¢å• è¯·æ±‚ã€‚<br/> æˆ‘ä»¬æ·»åŠ ä¸€æ¡è®¢å•è®°å½•ï¼Œéœ€è¦åœ¨2å¼ è¡¨ï¼ˆOrder å’Œ OrderMedicine ï¼‰ä¸­æ·»åŠ è®°å½•ã€‚</p>
<p>è¿™é‡Œå°±æœ‰ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„åœ°æ–¹ï¼Œ ä¸¤å¼ è¡¨çš„æ’å…¥ï¼Œæ„å‘³ç€æˆ‘ä»¬è¦æœ‰ä¸¤æ¬¡æ•°æ®åº“æ“ä½œã€‚</p>
<p>å¦‚æœç¬¬ä¸€æ¬¡æ’å…¥æˆåŠŸï¼Œ è€Œç¬¬äºŒæ¬¡æ’å…¥å¤±è´¥ï¼Œ å°±ä¼šå‡ºç° Orderè¡¨ä¸­ æŠŠè®¢å•ä¿¡æ¯å†™äº†ä¸€éƒ¨åˆ†ï¼Œè€ŒOrderMedicineè¡¨ä¸­ è¯¥è®¢å•çš„ä¿¡æ¯ å´æ²¡æœ‰å†™æˆåŠŸã€‚<br/> è¿™æ˜¯ä¸ªå¤§é—®é¢˜ï¼š å°±ä¼šé€ æˆ è¿™ä¸ªå¤„ç† åšäº†ä¸€åŠã€‚</p>
<p>é‚£ä¹ˆæ•°æ®åº“ä¸­å°±ä¼šå‡ºç°æ•°æ®çš„ä¸ä¸€è‡´ã€‚æœ¯è¯­å« <strong>è„æ•°æ®</strong><br/> æŠŠä¸€æ‰¹æ•°æ®åº“æ“ä½œæ”¾åœ¨ äº‹åŠ¡ ä¸­ï¼Œ è¯¥äº‹åŠ¡ä¸­çš„ä»»ä½•ä¸€æ¬¡æ•°æ®åº“æ“ä½œ å¤±è´¥äº†ï¼Œ æ•°æ®åº“ç³»ç»Ÿå°±ä¼šè®© æ•´ä¸ªäº‹åŠ¡å°±ä¼šå‘ç”Ÿå›æ»šï¼Œæ’¤é”€å‰é¢çš„æ“ä½œï¼Œ æ•°æ®åº“å›æ»šåˆ°è¿™äº‹åŠ¡æ“ä½œä¹‹å‰çš„çŠ¶æ€ã€‚</p>
<p>Django æ€ä¹ˆå®ç° äº‹åŠ¡æ“ä½œå‘¢ï¼Ÿ<br/> è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Django çš„ with transaction.atomic()</code><br/> ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">addorder</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>

    info  <span class="token operator">=</span> request<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span>

    <span class="token comment"># ä»è¯·æ±‚æ¶ˆæ¯ä¸­ è·å–è¦æ·»åŠ è®¢å•çš„ä¿¡æ¯</span>
    <span class="token comment"># å¹¶ä¸”æ’å…¥åˆ°æ•°æ®åº“ä¸­</span>

    
    <span class="token keyword">with</span> transaction<span class="token punctuation">.</span>atomic<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        new_order <span class="token operator">=</span> Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span>info<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token punctuation">,</span>
                                         customer_id<span class="token operator">=</span>info<span class="token punctuation">[</span><span class="token string">'customerid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        batch <span class="token operator">=</span> <span class="token punctuation">[</span>OrderMedicine<span class="token punctuation">(</span>order_id<span class="token operator">=</span>new_order<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>medicine_id<span class="token operator">=</span>mid<span class="token punctuation">,</span>amount<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  
                    <span class="token keyword">for</span> mid <span class="token keyword">in</span> info<span class="token punctuation">[</span><span class="token string">'medicineids'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

        <span class="token comment">#  åœ¨å¤šå¯¹å¤šå…³ç³»è¡¨ä¸­ æ·»åŠ äº† å¤šæ¡å…³è”è®°å½•</span>
        OrderMedicine<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>bulk_create<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
    <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'ret'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'id'</span><span class="token punctuation">:</span>new_order<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><code>with transaction.atomic()</code> ä¸‹é¢ ç¼©è¿›éƒ¨åˆ†çš„ä»£ç ï¼Œå¯¹æ•°æ®åº“çš„æ“ä½œï¼Œå°±éƒ½æ˜¯åœ¨ ä¸€ä¸ªäº‹åŠ¡ ä¸­è¿›è¡Œäº†ã€‚<br/> å¦‚æœå…¶ä¸­æœ‰ä»»ä½•ä¸€æ­¥æ•°æ®æ“ä½œå¤±è´¥äº†ï¼Œ å‰é¢çš„æ“ä½œéƒ½ä¼šå›æ»šã€‚</p>
<p>è¿™å°±å¯ä»¥é˜²æ­¢å‡ºç° å‰é¢çš„ Orderè¡¨è®°å½•æ’å…¥æˆåŠŸï¼Œ è€Œåé¢çš„ è®¢å•è¯å“ è®°å½•æ’å…¥å¤±è´¥è€Œå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´ç°è±¡ã€‚<br/> OrderMedicine å¯¹åº”çš„æ˜¯è®¢å•å’Œè¯å“çš„å¤šå¯¹å¯¹è®°å½•å…³ç³»è¡¨ã€‚</p>
<p>è¦åœ¨å¤šå¯¹å¤šè¡¨ä¸­åŠ ä¸Šå…³è”è®°å½•ï¼Œå°±æ˜¯æ·»åŠ ä¸€æ¡è®°å½•ï¼Œ å¯ä»¥è¿™æ ·</p>
<pre><code class="prism language-python">OrderMedicine<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>order_id<span class="token operator">=</span>new_order<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>medicine_id<span class="token operator">=</span>mid<span class="token punctuation">,</span>amount<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<p>æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸€ä¸ªè®¢å•å¯èƒ½ä¼šå…³è”å¤šä¸ªè¯å“ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ æ’å…¥ OrderMedicine è¡¨ä¸­çš„æ•°æ® å¯èƒ½æœ‰å¾ˆå¤šæ¡ï¼Œ å¦‚æœæˆ‘ä»¬å¾ªç¯ç”¨</p>
<pre><code class="prism language-python">OrderMedicine<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>order_id<span class="token operator">=</span>new_order<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>medicine_id<span class="token operator">=</span>mid<span class="token punctuation">,</span>amount<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<p>æ’å…¥çš„è¯ï¼Œ å¾ªç¯å‡ æ¬¡ï¼Œ å°±ä¼šæ‰§è¡Œ å‡ æ¬¡SQLè¯­å¥ æ’å…¥çš„ æ•°æ®åº“æ“ä½œ è¿™æ ·æ€§èƒ½ä¸é«˜ã€‚<br/> æˆ‘ä»¬å¯ä»¥æŠŠå¤šæ¡æ•°æ®çš„æ’å…¥ï¼Œæ”¾åœ¨ä¸€ä¸ªSQLè¯­å¥ä¸­å®Œæˆï¼Œ è¿™æ ·ä¼šå¤§å¤§æé«˜æ€§èƒ½ã€‚<br/> æ–¹æ³•å°±æ˜¯ä½¿ç”¨ bulk_createï¼Œ å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰ è¯¥è¡¨çš„ Model å¯¹è±¡çš„ åˆ—è¡¨<br/> å°±åƒä¸Šé¢ä»£ç è¿™æ ·</p>
<pre><code class="prism language-python">batch <span class="token operator">=</span> <span class="token punctuation">[</span>OrderMedicine<span class="token punctuation">(</span>order_id<span class="token operator">=</span>new_order<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>medicine_id<span class="token operator">=</span>mid<span class="token punctuation">,</span>amount<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  
            <span class="token keyword">for</span> mid <span class="token keyword">in</span> info<span class="token punctuation">[</span><span class="token string">'medicineids'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token comment">#  åœ¨å¤šå¯¹å¤šå…³ç³»è¡¨ä¸­ æ·»åŠ äº† å¤šæ¡å…³è”è®°å½•</span>
OrderMedicine<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>bulk_create<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
</code></pre>
<h2><a id="3ORM_350"></a>3.ORMå¤–é”®å…³è”</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç¼–å†™listorder å‡½æ•°ç”¨æ¥å¤„ç† åˆ—å‡ºè®¢å•è¯·æ±‚ã€‚</p>
<p>æ ¹æ®æ¥å£æ–‡æ¡£ï¼Œæˆ‘ä»¬åº”è¯¥è¿”å› è®¢å•è®°å½•æ ¼å¼ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="prism language-python"><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
        name<span class="token punctuation">:</span> <span class="token string">"åå±±åŒ»é™¢è®¢å•001"</span><span class="token punctuation">,</span> 
        create_date<span class="token punctuation">:</span> <span class="token string">"2018-12-26T14:10:15.419Z"</span><span class="token punctuation">,</span>
        customer_name<span class="token punctuation">:</span> <span class="token string">"åå±±åŒ»é™¢"</span><span class="token punctuation">,</span>
        medicines_name<span class="token punctuation">:</span> <span class="token string">"é’éœ‰ç´ "</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
        name<span class="token punctuation">:</span> <span class="token string">"åå±±åŒ»é™¢è®¢å•002"</span><span class="token punctuation">,</span> 
        create_date<span class="token punctuation">:</span> <span class="token string">"2018-12-27T14:10:37.208Z"</span><span class="token punctuation">,</span>
        customer_name<span class="token punctuation">:</span> <span class="token string">"åå±±åŒ»é™¢"</span><span class="token punctuation">,</span>
        medicines_name<span class="token punctuation">:</span> <span class="token string">"é’éœ‰ç´  | çº¢éœ‰ç´  "</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span> 
</code></pre>
<p>å…¶ä¸­ â€˜idâ€™,â€˜nameâ€™,â€˜create_dateâ€™ è¿™äº›å­—æ®µçš„å†…å®¹è·å–å¾ˆç®€å•ï¼Œorderè¡¨ä¸­å°±æœ‰è¿™äº›å­—æ®µï¼Œ<br/> åªéœ€è¦è¿™æ ·å†™å°±å¯ä»¥äº†ï¼š</p>
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">listorder</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># è¿”å›ä¸€ä¸ª QuerySet å¯¹è±¡ ï¼ŒåŒ…å«æ‰€æœ‰çš„è¡¨è®°å½•</span>
    qs <span class="token operator">=</span> Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'create_date'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'ret'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'retlist'</span><span class="token punctuation">:</span> newlist<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>é—®é¢˜æ˜¯ï¼šâ€˜customer_nameâ€™ å’Œ â€˜medicines_nameâ€™ è¿™ä¸¤ä¸ªå­—æ®µçš„å€¼æ€ä¹ˆè·å–å‘¢ï¼Ÿ å› ä¸º è®¢å•å¯¹åº”çš„å®¢æˆ·åå­— å’Œ è¯å“çš„åå­— éƒ½ä¸åœ¨ Order è¡¨ä¸­å•Šã€‚</p>
<p>Order è¿™ä¸ªModel ä¸­ æœ‰ â€˜customerâ€™ å­—æ®µ ï¼Œ å®ƒå¤–é”®å…³è”äº† Customer è¡¨ä¸­çš„ä¸€ä¸ª è®°å½•ï¼Œè¿™ä¸ªè®°å½•é‡Œé¢ çš„ nameå­—æ®µ å°±æ˜¯æˆ‘ä»¬è¦å–çš„å­—æ®µã€‚</p>
<p>å– å¤–é”®å…³è”çš„è¡¨è®°å½•çš„å­—æ®µå€¼ï¼Œåœ¨Djangoä¸­å¾ˆç®€å•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ å¤–é”®å­—æ®µ åé¢åŠ  ä¸¤ä¸ªä¸‹åˆ’çº¿ åŠ  å…³è”å­—æ®µåçš„æ–¹å¼ æ¥è·å–ã€‚</p>
<p>æ¯”å¦‚ è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ ä¸‹é¢çš„ä»£ç æ¥å®ç°</p>
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">listorder</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    qs <span class="token operator">=</span> Order<span class="token punctuation">.</span>objects\
            <span class="token punctuation">.</span>values<span class="token punctuation">(</span>
                <span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'create_date'</span><span class="token punctuation">,</span>
                <span class="token comment"># ä¸¤ä¸ªä¸‹åˆ’çº¿ï¼Œè¡¨ç¤ºå–customerå¤–é”®å…³è”çš„è¡¨ä¸­çš„nameå­—æ®µçš„å€¼</span>
                <span class="token string">'customer__name'</span>
            <span class="token punctuation">)</span>
    
    <span class="token comment"># å°† QuerySet å¯¹è±¡ è½¬åŒ–ä¸º list ç±»å‹</span>
    retlist <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'ret'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'retlist'</span><span class="token punctuation">:</span> retlist<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="31_404"></a>3.1åŒä¸‹åˆ’çº¿é—®é¢˜</h3>
<p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œ æ¥å£æ–‡æ¡£éœ€è¦çš„åå­—æ˜¯ â€˜customer_nameâ€™ å’Œ â€˜medicines_nameâ€™ã€‚ é‡Œé¢åªæœ‰ä¸€ä¸ªä¸‹åˆ’çº¿ï¼Œ è€Œæˆ‘ä»¬è¿™é‡Œå´äº§ç”Ÿäº† ä¸¤ä¸ªä¸‹åˆ’çº¿ã€‚</p>
<p>æ€ä¹ˆåŠï¼Ÿ</p>
<p>å¯ä»¥ä½¿ç”¨ annotate æ–¹æ³•å°†è·å–çš„å­—æ®µå€¼è¿›è¡Œé‡å‘½åï¼Œåƒä¸‹é¢è¿™æ ·<br/> å†™å¥½åï¼Œ å¤§å®¶å¯ä»¥è¿è¡ŒæœåŠ¡ ï¼Œ ç”¨æˆ‘ä»¬åšå¥½çš„å‰ç«¯ç³»ç»Ÿæ·»åŠ å‡ æ¡ è®¢å•è®°å½•ï¼Œ ç„¶åå†æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åº“é‡Œé¢çš„æ•°æ®æ˜¯å¦æ­£ç¡®ã€‚</p>
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F

<span class="token keyword">def</span> <span class="token function">listorder</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># è¿”å›ä¸€ä¸ª QuerySet å¯¹è±¡ ï¼ŒåŒ…å«æ‰€æœ‰çš„è¡¨è®°å½•</span>
    qs <span class="token operator">=</span> Order<span class="token punctuation">.</span>objects\
            <span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>
                customer_name<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'customer__name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                medicines_name<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'medicines__name'</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>\
            <span class="token punctuation">.</span>values<span class="token punctuation">(</span>
                <span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'create_date'</span><span class="token punctuation">,</span>
                <span class="token string">'customer_name'</span><span class="token punctuation">,</span>
                <span class="token string">'medicines_name'</span>
            <span class="token punctuation">)</span>

    <span class="token comment"># å°† QuerySet å¯¹è±¡ è½¬åŒ–ä¸º list ç±»å‹</span>
    retlist <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span>

    <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'ret'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'retlist'</span><span class="token punctuation">:</span> retlist<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/29da59a3ecd2413682136daad5bdf295.png"/></p>
<h3><a id="32_435"></a>3.2å¤šä¸ªè®¢å•é—®é¢˜</h3>
<p>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¦‚æœä¸€ä¸ªè®¢å•é‡Œé¢æœ‰å¤šä¸ªè¯å“ï¼Œå°±ä¼šäº§ç”Ÿå¤šæ¡è®°å½•ï¼Œ è¿™ä¸æ˜¯æˆ‘ä»¬è¦çš„ã€‚</p>
<p>æ ¹æ®æ¥å£ï¼Œä¸€ä¸ªè®¢å•é‡Œé¢çš„å¤šä¸ªè¯å“ï¼Œ ç”¨ ç«–çº¿ éš”å¼€ã€‚</p>
<p>æ€ä¹ˆåŠï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨pythonä»£ç æ¥å¤„ç†ï¼Œåƒä¸‹é¢è¿™æ ·</p>
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">listorder</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># è¿”å›ä¸€ä¸ª QuerySet å¯¹è±¡ ï¼ŒåŒ…å«æ‰€æœ‰çš„è¡¨è®°å½•</span>
    qs <span class="token operator">=</span> Order<span class="token punctuation">.</span>objects\
            <span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>
                customer_name<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'customer__name'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                medicines_name<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'medicines__name'</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>\
            <span class="token punctuation">.</span>values<span class="token punctuation">(</span>
                <span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'create_date'</span><span class="token punctuation">,</span><span class="token string">'customer_name'</span><span class="token punctuation">,</span><span class="token string">'medicines_name'</span>
            <span class="token punctuation">)</span>

    <span class="token comment"># å°† QuerySet å¯¹è±¡ è½¬åŒ–ä¸º list ç±»å‹</span>
    retlist <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span>

    <span class="token comment"># å¯èƒ½æœ‰ IDç›¸åŒï¼Œè¯å“ä¸åŒçš„è®¢å•è®°å½•ï¼Œ éœ€è¦åˆå¹¶</span>
    newlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    id2order <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> one <span class="token keyword">in</span> retlist<span class="token punctuation">:</span>
        orderid <span class="token operator">=</span> one<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> orderid <span class="token keyword">not</span> <span class="token keyword">in</span> id2order<span class="token punctuation">:</span>
            newlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>one<span class="token punctuation">)</span>
            id2order<span class="token punctuation">[</span>orderid<span class="token punctuation">]</span> <span class="token operator">=</span> one
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            id2order<span class="token punctuation">[</span>orderid<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'medicines_name'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token string">' | '</span> <span class="token operator">+</span> one<span class="token punctuation">[</span><span class="token string">'medicines_name'</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'ret'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'retlist'</span><span class="token punctuation">:</span> newlist<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h1><a id="_471"></a><code>ã€ç³»åˆ—å¥½æ–‡æ¨èã€‘</code></h1>
<p>ğŸ¯ğŸ¯ğŸ¯<br/> <strong><a href="https://blog.csdn.net/weixin_51390582/article/details/125554253?spm=1001.2014.3001.5501">Python Webå¼€å‘ä¸€ï¼šWebå¼€å‘ç®€ä»‹</a></strong><br/> <strong><a href="https://blog.csdn.net/weixin_51390582/article/details/125572774?spm=1001.2014.3001.5501">Python Webå¼€å‘äºŒï¼šDjangoçš„å®‰è£…å’Œè¿è¡Œ</a></strong><br/> <strong><a href="https://xuyipeng.blog.csdn.net/article/details/125581163?spm=1001.2014.3001.5502">Python Webå¼€å‘ï¼ˆä¸‰ï¼‰ï¼šHTTPè¯·æ±‚çš„urlè·¯ç”±</a></strong></p>
<p>æ¬¢è¿è®¢é˜…æœ¬ä¸“æ ï¼š<strong><a href="https://blog.csdn.net/weixin_51390582/category_11571272.html">é›¶åŸºç¡€å­¦Python</a></strong> ç³»åˆ—è¯¾ç¨‹æ˜¯é’ˆå¯¹Pythonå…¥é—¨&amp;è¿›é˜¶æ‰“é€ çš„ä¸€å…¨å¥—è¯¾ç¨‹ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘å°†ä¼šä¸€ ä¸€æ›´æ–°PythonåŸºç¡€è¯­æ³•ã€Pythonçˆ¬è™«ã€Webå¼€å‘ã€ Djangoæ¡†æ¶ã€Flaskæ¡†æ¶ä»¥åŠäººå·¥æ™ºèƒ½ç›¸å…³çŸ¥è¯†ï¼Œå¸®åŠ©ä½ æˆä¸ºPythonå¤§ç¥ï¼Œå¦‚æœä½ å–œæ¬¢çš„è¯å°±æŠ“ç´§æ”¶è—è®¢é˜…èµ·æ¥å§~ğŸ’˜ğŸ’˜ğŸ’˜<br/> ğŸ’•ğŸ’•ğŸ’• å¥½å•¦ï¼Œè¿™å°±æ˜¯ä»Šå¤©è¦åˆ†äº«ç»™å¤§å®¶çš„å…¨éƒ¨å†…å®¹äº†ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼âœ¨ âœ¨ âœ¨<br/> ğŸ»ğŸ»ğŸ»å¦‚æœä½ å–œæ¬¢çš„è¯ï¼Œå°±ä¸è¦åæƒœä½ çš„ä¸€é”®ä¸‰è¿äº†~<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/151f7a1ac3844566b09099a0eb78ef37.gif#pic_center"/><br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/ddf3206097a0497da6795c23135f4c31.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5pivRHJlYW3lkYA=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> â¬‡ï¸â¬‡ï¸ â¬‡ï¸ <strong>å•†åŠ¡åˆä½œ|äº¤æµå­¦ä¹ |ç²‰ä¸ç¦åˆ©|Pythonå…¨å¥—èµ„æ–™</strong>â¬‡ï¸ â¬‡ï¸ â¬‡ï¸ æ¬¢è¿è”ç³»~</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>