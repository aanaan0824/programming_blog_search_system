<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p>为了处理文件，首先，导入 <code>fstream</code> 库。 在这个库里面有三种数据类型：</p>
<ul><li><code>ofstream</code> - 用于写入文件</li><li><code>ifstream</code> - 用于从文件中读取</li><li><code>fstream</code> - 用于读取和写入</li></ul>
<p>为了打开文件，我们使用 <code>open()</code> 函数。 该函数接收两个参数：文件名和文件打开方式。<br/> 可以打开文件的模式如下：</p>
<ul><li>ios::in - 打开要读取的文件（ifstream 的默认值）</li><li>ios::out - 打开要写入的文件（ofstream 的默认值）</li><li>ios::binary - 以二进制模式打开文件</li><li>ios::app- 打开文件以在末尾附加新信息</li><li>ios::ate - 打开并将控件移动到文件末尾</li><li>ios::trunc - 删除现有文件中的数据</li><li>ios::nocreate - 仅在文件已存在时打开文件</li><li>ios::noreplace - 仅在文件不存在时打开文件</li></ul>
<p>我们还可以使用符号 <code>|</code> 组合不同的模式 例如： <code>myFile.open(“saldinaFile.txt”, ios::out | ios::in);</code> 在此示例中，我们打开 <code>saldinaFile.txt</code> 进行写入和读取。</p>
<h1><a id="1txt_17"></a>1.读写txt文件</h1>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	fstream myFile<span class="token punctuation">;</span>
	myFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"saldina.txt"</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// write,清空再写入</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>myFile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		myFile <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello\n"</span><span class="token punctuation">;</span>
		myFile <span class="token operator">&lt;&lt;</span> <span class="token string">"This is second line\n"</span><span class="token punctuation">;</span>
		myFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	myFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"saldina.txt"</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// append,追加</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>myFile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		myFile <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello2\n"</span><span class="token punctuation">;</span>
		myFile <span class="token operator">&lt;&lt;</span> <span class="token string">"This is third line\n"</span><span class="token punctuation">;</span>
		myFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	myFile<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"saldina.txt"</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// read,读</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>myFile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		string line<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>myFile<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> line <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		myFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre>
<h1><a id="2CCSV_56"></a>2.C++读写CSV文件</h1>
<p>据我所知，C++ STL 中没有内置 CSV 读取器/写入器。这不是对 C++ 的打击。它只是一种低级语言。如果我们想用 C++ 读写 CSV 文件，我们将不得不处理文件 I/O、数据类型和一些关于如何读取、解析和写入数据的低级逻辑。对我来说，这是构建和测试更多有趣程序（如机器学习模型）的必要步骤。</p>
<h2><a id="21_CSV_58"></a>2.1 写入CSV</h2>
<p>这里，<code>ofstream</code>是一个“输出文件流”。由于它派生自<code>ostream</code>，我们可以像对待<code>cout</code>一样对待它(它也是派生自<code>ostream</code>)。执行这个程序的结果是，我们在可执行文件所在的目录中得到了一个名为<code>ones.csv</code>的文件。让我们将它封装到<code>write_csv()</code>函数中。</p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">write_csv</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string filename<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string colname<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vals<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Make a CSV file with one column of integer values</span>
    <span class="token comment">// filename - the name of the file</span>
    <span class="token comment">// colname - the name of the one and only column</span>
    <span class="token comment">// vals - an integer vector of values</span>
    
    <span class="token comment">// Create an output filestream object</span>
    std<span class="token double-colon punctuation">::</span>ofstream <span class="token function">myFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Send the column name to the stream</span>
    myFile <span class="token operator">&lt;&lt;</span> colname <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Send data to the stream</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vals<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        myFile <span class="token operator">&lt;&lt;</span> vals<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Close the file</span>
    myFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Make a vector of length 100 filled with 1s</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">vec</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Write the vector to CSV</span>
    <span class="token function">write_csv</span><span class="token punctuation">(</span><span class="token string">"ones.csv"</span><span class="token punctuation">,</span> <span class="token string">"Col1"</span><span class="token punctuation">,</span> vec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/553b87c84cb144799de9f6f4ba461af2.png"/></p>
<p>现在我们可以使用 <code>write_csv()</code> 轻松地将整数向量写入 CSV 文件。让我们对此进行扩展以支持多个整数向量和相应的列名。</p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;utility&gt;</span> <span class="token comment">// std::pair</span></span>

<span class="token keyword">void</span> <span class="token function">write_csv</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string filename<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> dataset<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Make a CSV file with one or more columns of integer values</span>
    <span class="token comment">// Each column of data is represented by the pair &lt;column name, column data&gt;</span>
    <span class="token comment">//   as std::pair&lt;std::string, std::vector&lt;int&gt;&gt;</span>
    <span class="token comment">// The dataset is represented as a vector of these columns</span>
    <span class="token comment">// Note that all columns should be the same size</span>
    
    <span class="token comment">// Create an output filestream object</span>
    std<span class="token double-colon punctuation">::</span>ofstream <span class="token function">myFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Send column names to the stream</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> dataset<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        myFile <span class="token operator">&lt;&lt;</span> dataset<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>j <span class="token operator">!=</span> dataset<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> myFile <span class="token operator">&lt;&lt;</span> <span class="token string">","</span><span class="token punctuation">;</span> <span class="token comment">// No comma at end of line</span>
    <span class="token punctuation">}</span>
    myFile <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Send data to the stream</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dataset<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> dataset<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            myFile <span class="token operator">&lt;&lt;</span> dataset<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>j <span class="token operator">!=</span> dataset<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> myFile <span class="token operator">&lt;&lt;</span> <span class="token string">","</span><span class="token punctuation">;</span> <span class="token comment">// No comma at end of line</span>
        <span class="token punctuation">}</span>
        myFile <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Close the file</span>
    myFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Make three vectors, each of length 100 filled with 1s, 2s, and 3s</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">vec1</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Wrap into a vector</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> vals <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token string">"One"</span><span class="token punctuation">,</span> vec1<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Two"</span><span class="token punctuation">,</span> vec2<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Three"</span><span class="token punctuation">,</span> vec3<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Write the vector to CSV</span>
    <span class="token function">write_csv</span><span class="token punctuation">(</span><span class="token string">"three_cols.csv"</span><span class="token punctuation">,</span> vals<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/afb3d99165a54ae29353aa1656f648d8.png"/><br/> 在这里，我们将每列数据表示为 <code>&lt;column name, column values&gt;</code> 的 <code>std::pair</code>，并将整个数据集表示为此类列的 <code>std::vector</code>。现在我们可以将可变数量的整数列写入 <code>CSV</code> 文件。</p>
<h2><a id="22_CSV1_160"></a>2.2 读取CSV文件(1)</h2>
<p>现在我们已经编写了一些 CSV 文件，让我们尝试读取它们。现在让我们假设我们的文件包含整数数据和顶部的一行列名。</p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;utility&gt;</span> <span class="token comment">// std::pair</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// std::runtime_error</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span> <span class="token comment">// std::stringstream</span></span>

std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">read_csv</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string filename<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Reads a CSV file into a vector of &lt;string, vector&lt;int&gt;&gt; pairs where</span>
    <span class="token comment">// each pair represents &lt;column name, column values&gt;</span>

    <span class="token comment">// Create a vector of &lt;string, int vector&gt; pairs to store the result</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> result<span class="token punctuation">;</span>

    <span class="token comment">// Create an input filestream</span>
    std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">myFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Make sure the file is open</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>myFile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">runtime_error</span><span class="token punctuation">(</span><span class="token string">"Could not open file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Helper vars</span>
    std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">,</span> colname<span class="token punctuation">;</span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>

    <span class="token comment">// Read the column names</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>myFile<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Extract the first line in the file</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">getline</span><span class="token punctuation">(</span>myFile<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Create a stringstream from line</span>
        std<span class="token double-colon punctuation">::</span>stringstream <span class="token function">ss</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Extract each column name</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">getline</span><span class="token punctuation">(</span>ss<span class="token punctuation">,</span> colname<span class="token punctuation">,</span> <span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            
            <span class="token comment">// Initialize and add &lt;colname, int vector&gt; pairs to result</span>
            result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>colname<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Read data, line by line</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">getline</span><span class="token punctuation">(</span>myFile<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Create a stringstream of the current line</span>
        std<span class="token double-colon punctuation">::</span>stringstream <span class="token function">ss</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Keep track of the current column index</span>
        <span class="token keyword">int</span> colIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Extract each integer</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>ss <span class="token operator">&gt;&gt;</span> val<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            
            <span class="token comment">// Add the current integer to the 'colIdx' column's values vector</span>
            result<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>colIdx<span class="token punctuation">)</span><span class="token punctuation">.</span>second<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// If the next token is a comma, ignore it and move on</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ss<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">','</span><span class="token punctuation">)</span> ss<span class="token punctuation">.</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Increment the column index</span>
            colIdx<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Close file</span>
    myFile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Read three_cols.csv and ones.csv</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> three_cols <span class="token operator">=</span> <span class="token function">read_csv</span><span class="token punctuation">(</span><span class="token string">"three_cols.csv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ones <span class="token operator">=</span> <span class="token function">read_csv</span><span class="token punctuation">(</span><span class="token string">"ones.csv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Write to another file to check that this was successful</span>
    <span class="token function">write_csv</span><span class="token punctuation">(</span><span class="token string">"three_cols_copy.csv"</span><span class="token punctuation">,</span> three_cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write_csv</span><span class="token punctuation">(</span><span class="token string">"ones_copy.csv"</span><span class="token punctuation">,</span> ones<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<p>该程序读取我们之前创建的 CSV 文件并将每个数据集写入一个新文件，本质上是创建原始文件的副本。</p>
<h2><a id="23_CSV2_248"></a>2.3 读取CSV文件(2)</h2>
<p>示例CSV文件如下所示。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/59d403ab4b9f4004a45ab4af8def838f.png"/><br/> 在这个文件中，每行中的每个值都由逗号分隔。第一行表示列名，分别为姓名、性别和年龄。在每一行之后，都有一个换行符，该换行符存储在内部，在文件中不可见。文件中的每一行表示一个不同的记录，而每个逗号分隔的值表示记录的一个字段。</p>
<p>读取 CSV 文件本质上类似于读取 C++ 中的所有其他文件。不同之处在于从行中提取值的方式。要读取 CSV 文件，</p>
<ul><li>我们将使用C++ 库的<code>fstream</code> 或 <code>ifstream</code>打开文件。然后，我们将使用<code>getline()</code>方法逐行读取文件，因为每一行都以换行符结尾。</li><li>该<code>getline()</code>方法将文件流作为其第一个输入参数，将一个字符串变量作为其第二个参数。执行后，它将文件流的下一行存储在字符串变量中。它还接受一个可选参数<code>delimitor</code>。如果我们将分隔符作为输入参数传递，它会读取文件直到找到分隔符。否则，它会读取文件直到找到换行符。</li><li>提取一行后，我们将使用<code>stringstream</code>提取该行中用逗号分隔的单词。顾名思义，<code>stringstream</code>将字符串转换为类似文件流的对象。</li><li>在这里，我们将使用<code>getline()</code>方法来读取由<code>stringstream</code>创建的字符串流。使用<code>getline()</code>时，除了字符串流和名为 <code>word</code> 的字符串变量外，我们还将<code>，</code>作为第三个参数传递给<code>getline()</code>函数。通过这种方式，<code>getline()</code>函数只读取数据，直到一行中的下一个逗号符号。</li><li>我们将每个单词存储在一个名为<code>row</code>的向量中，每个单词<code>row</code>存储在一个名为<code>content</code>的二维向量中。执行整个程序后，我们得到一个二维向量，其中每一行代表 CSV 文件中的一条记录，每一行的每一列代表其中的数据。</li></ul>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span></span>
 
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	string fname<span class="token punctuation">;</span>
	cout<span class="token operator">&lt;&lt;</span><span class="token string">"Enter the file name: "</span><span class="token punctuation">;</span>
	cin<span class="token operator">&gt;&gt;</span>fname<span class="token punctuation">;</span>
 
	vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;&gt;</span> content<span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> row<span class="token punctuation">;</span>
	string line<span class="token punctuation">,</span> word<span class="token punctuation">;</span>
 
	fstream <span class="token function">file</span> <span class="token punctuation">(</span>fname<span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			row<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
			stringstream <span class="token function">str</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
			<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> word<span class="token punctuation">,</span> <span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				row<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>
			content<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
		cout<span class="token operator">&lt;&lt;</span><span class="token string">"Could not open the file\n"</span><span class="token punctuation">;</span>
 
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>content<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>content<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout<span class="token operator">&lt;&lt;</span>content<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span><span class="token string">" "</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		cout<span class="token operator">&lt;&lt;</span><span class="token string">"\n"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
 
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上述代码的输出如下所示。我们使用上面给出的 CSV 文件作为程序的输入。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/eb24c176db1c4f22869eab4cf0403537.png"/></p>
<h2><a id="24_c1_310"></a>2.4 用c++读写二进制文件(1)</h2>
<pre><code class="prism language-cpp"><span class="token comment">/**
 * @description - Read any ASCII,BINARY or HEX file.
 * @param - Source file name and file type.
 * @return - Returns data in tuple format,use std::get&lt;TUPLE_ID&gt;(TUPLE_OBJ) to get data.
 */</span>
<span class="token comment">/*Including STD-C++ libraries*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span> <span class="token comment">/*For basic I/O.*/</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span> <span class="token comment">/*For basic I/O.*/</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sstream&gt;</span> <span class="token comment">/*For basic I/O.*/</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span> <span class="token comment">/*For STL vector.*/</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;tuple&gt;</span>  <span class="token comment">/*For packing multi data.*/</span></span>

<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BINARY_FILE</span> <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ASCII_FILE</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HEX_FILE</span> <span class="token expression"><span class="token number">2</span></span></span>
std<span class="token double-colon punctuation">::</span>tuple<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint8_t</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> string<span class="token punctuation">,</span> string<span class="token operator">&gt;</span> <span class="token function">ReadFile</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> <span class="token function">WriteFile</span><span class="token punctuation">(</span>string file_name<span class="token punctuation">,</span> string<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
Example of binary file:
	auto file_type = ReadFile("user_data.dat", BINARY_FILE);
	auto file_data = std::get&lt;BINARY_FILE&gt;(file_type);

Example of ASCII file:
	auto file_type = ReadFile("my_file.txt", ASCII_FILE);
	auto file_data = std::get&lt;ASCII_FILE&gt;(file_type);
*/</span>

std<span class="token double-colon punctuation">::</span>tuple<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint8_t</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> string<span class="token punctuation">,</span> string<span class="token operator">&gt;</span> <span class="token function">ReadFile</span><span class="token punctuation">(</span>string file_name<span class="token punctuation">,</span> <span class="token keyword">int</span> file_type<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*Buffers to store output data from file.*/</span>
	string str_buf<span class="token punctuation">,</span> hex_buf<span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint8_t</span><span class="token operator">&gt;</span> vec_buf<span class="token punctuation">;</span>

	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>file_type <span class="token operator">==</span> BINARY_FILE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

			<span class="token comment">/*Open the stream in binary mode.*/</span>
			std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">bin_file</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>bin_file<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">/*Read Binary data using streambuffer iterators.*/</span>
				std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">uint8_t</span><span class="token operator">&gt;</span> <span class="token function">v_buf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">istreambuf_iterator</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>bin_file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">istreambuf_iterator</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				vec_buf <span class="token operator">=</span> v_buf<span class="token punctuation">;</span>
				bin_file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span>

		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>file_type <span class="token operator">==</span> ASCII_FILE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

			<span class="token comment">/*Open the stream in default mode.*/</span>
			std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">ascii_file</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
			string ascii_data<span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>ascii_file<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">/*Read ASCII data using getline*/</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getline</span><span class="token punctuation">(</span>ascii_file<span class="token punctuation">,</span> ascii_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
					str_buf <span class="token operator">+=</span> ascii_data <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>

				ascii_file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>file_type <span class="token operator">==</span> HEX_FILE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

			<span class="token comment">/*Open the stream in default mode.*/</span>
			std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">hex_file</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>hex_file<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">/*Read Hex data using streambuffer iterators.*/</span>
				std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span> <span class="token function">h_buf</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">istreambuf_iterator</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>hex_file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">istreambuf_iterator</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				string <span class="token function">hex_str_buf</span><span class="token punctuation">(</span>h_buf<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> h_buf<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				hex_buf <span class="token operator">=</span> hex_str_buf<span class="token punctuation">;</span>

				hex_file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

	<span class="token keyword">catch</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>exception <span class="token keyword">const</span><span class="token operator">&amp;</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		string ex_str <span class="token operator">=</span> <span class="token string">"Error: "</span> <span class="token operator">+</span> file_name <span class="token operator">+</span> <span class="token string">": No such file or directory"</span><span class="token punctuation">;</span>
		<span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">exception</span><span class="token punctuation">(</span>ex_str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">auto</span> tuple_data <span class="token operator">=</span> <span class="token function">make_tuple</span><span class="token punctuation">(</span>vec_buf<span class="token punctuation">,</span> str_buf<span class="token punctuation">,</span> hex_buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> tuple_data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @description - Write data to any ASCII,BINARY or HEX file.
 * @param - Source file name, file data and file type.
 * @return - Returns true on successfully written data otherwise returns false.
 */</span>

<span class="token keyword">bool</span> <span class="token function">WriteFile</span><span class="token punctuation">(</span>string file_name<span class="token punctuation">,</span> string file_data<span class="token punctuation">,</span> <span class="token keyword">int</span> file_type<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">bool</span> write_status <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>ofstream <span class="token function">out_stream</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> <span class="token punctuation">(</span>file_type <span class="token operator">==</span> ASCII_FILE<span class="token punctuation">)</span> <span class="token operator">?</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>out <span class="token operator">:</span> <span class="token punctuation">(</span>file_type <span class="token operator">==</span> BINARY_FILE <span class="token operator">||</span> file_type <span class="token operator">==</span> HEX_FILE<span class="token punctuation">)</span> <span class="token operator">?</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary <span class="token operator">:</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>out_stream<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>file_type <span class="token operator">==</span> ASCII_FILE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			out_stream <span class="token operator">&lt;&lt;</span> file_data<span class="token punctuation">;</span>
			write_status <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>file_type <span class="token operator">==</span> BINARY_FILE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			out_stream <span class="token operator">&lt;&lt;</span> file_data<span class="token punctuation">;</span>
			write_status <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>file_type <span class="token operator">==</span> HEX_FILE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> bin_data<span class="token punctuation">;</span>
			std<span class="token double-colon punctuation">::</span>stringstream ss<span class="token punctuation">;</span>
			ss <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>hex <span class="token operator">&lt;&lt;</span> file_data<span class="token punctuation">;</span>

			<span class="token keyword">while</span> <span class="token punctuation">(</span>ss <span class="token operator">&gt;&gt;</span> bin_data<span class="token punctuation">)</span>
				out_stream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bin_data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			write_status <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		out_stream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		string ex_str <span class="token operator">=</span> <span class="token string">"Error: couldn't open "</span> <span class="token operator">+</span> file_name <span class="token operator">+</span> <span class="token string">" for output"</span><span class="token punctuation">;</span>
		<span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">exception</span><span class="token punctuation">(</span>ex_str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> write_status<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h2><a id="25_c2_456"></a>2.5 用c++读写二进制文件(2)</h2>
<ul><li>1.写<br/> 用C++写二进制文件，请使用write方法,它用于在给定流上写入给定数量的字节，从<code>put</code>指针的位置开始。如果<code>put</code>指针当前位于文件的末尾，则扩展文件。如果该指针指向文件的中间，则文件中的字符将被新数据覆盖。如果在写入文件期间发生了任何错误，则将流置于错误状态。<br/> 写方法的语法：<code>ostream&amp; write(const char*, int);</code></li><li>2.读<br/> 要在c++中读取二进制文件，请使用read方法。它从给定的流中提取给定数量的字节，并将它们放入由第一个参数指向的内存中。如果在读取文件期间发生任何错误，则将流置于错误状态，随后所有的读取操作都将失败。<br/> <code>gcount()</code>可用于统计已经读取的字符数。然后可以使用<code>clear()</code>将流重置为可用状态。<br/> 读方法的语法：<code>ifstream&amp; write(const char*, int);</code></li><li>3.伪代码</li></ul>
<pre><code class="prism language-shell">Begin
   Create a structure Student to <span class="token builtin class-name">declare</span> variables.
   Open binary <span class="token function">file</span> to write.
   Check <span class="token keyword">if</span> any error occurs <span class="token keyword">in</span> <span class="token function">file</span> opening.
   Initialize the variables with data.
   If <span class="token function">file</span> <span class="token function">open</span> successfully, <span class="token function">write</span> the binary data using <span class="token function">write</span> method.
      Close the <span class="token function">file</span> <span class="token keyword">for</span> writing.
   Open the binary <span class="token function">file</span> to read.
   Check <span class="token keyword">if</span> any error occurs <span class="token keyword">in</span> <span class="token function">file</span> opening.
   If <span class="token function">file</span> <span class="token function">open</span> successfully, <span class="token builtin class-name">read</span> the binary data <span class="token function">file</span> using <span class="token builtin class-name">read</span> method.
      Close the <span class="token function">file</span> <span class="token keyword">for</span> reading.
   Check <span class="token keyword">if</span> any error occurs.
   Print the data.
End.
</code></pre>
<ul><li>4.示例代码</li></ul>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;fstream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">Student</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">int</span> roll_no<span class="token punctuation">;</span>
   string name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   ofstream <span class="token function">wf</span><span class="token punctuation">(</span><span class="token string">"student.dat"</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>out <span class="token operator">|</span> ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>wf<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Cannot open file!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   Student wstu<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   wstu<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>roll_no <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
   wstu<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Ram"</span><span class="token punctuation">;</span>
   wstu<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>roll_no <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
   wstu<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Shyam"</span><span class="token punctuation">;</span>
   wstu<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>roll_no <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
   wstu<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Madhu"</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      wf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>wstu<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   wf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>wf<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Error occurred at writing time!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   ifstream <span class="token function">rf</span><span class="token punctuation">(</span><span class="token string">"student.dat"</span><span class="token punctuation">,</span> ios<span class="token double-colon punctuation">::</span>out <span class="token operator">|</span> ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rf<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Cannot open file!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   Student rstu<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      rf<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>rstu<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   rf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rf<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Error occurred at reading time!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   cout<span class="token operator">&lt;&lt;</span><span class="token string">"Student's Details:"</span><span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Roll No: "</span> <span class="token operator">&lt;&lt;</span> wstu<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>roll_no <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Name: "</span> <span class="token operator">&lt;&lt;</span> wstu<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
      cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>输出：</p>
<pre><code class="prism language-shell">Student’s Details:
Roll No: <span class="token number">1</span>
Name: Ram
Roll No: <span class="token number">2</span>
Name: Shyam
Roll No: <span class="token number">3</span>
Name: Madhu
</code></pre>
<h2><a id="26_c3_544"></a>2.6 用c++读写二进制文件(3)</h2>
<ul><li>1.问题描述<br/> 我使用以下代码创建一个简单的二进制文件。</li></ul>
<pre><code class="prism language-cpp">ofstream <span class="token function">outfile</span><span class="token punctuation">(</span><span class="token string">"binary.txt"</span><span class="token punctuation">,</span> ofstream<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
string text <span class="token operator">=</span> <span class="token string">"Hello cplusplus forum!"</span><span class="token punctuation">;</span>
outfile<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>text<span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
outfile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>当我打开此文件时，它是二进制文件，但每当我尝试使用此代码将此文件读回程序时：</p>
<pre><code class="prism language-cpp"><span class="token keyword">char</span><span class="token operator">*</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ifstream <span class="token function">infile</span><span class="token punctuation">(</span><span class="token string">"binary.txt"</span><span class="token punctuation">,</span> ifstream<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
infile<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
string<span class="token operator">*</span> elem <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token operator">*</span><span class="token punctuation">)</span>buffer<span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>elem <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>
infile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>程序和Visual Studio崩溃了。</p>
<ul><li>2.解答<br/> 第一部分有几个问题:</li></ul>
<pre><code class="prism language-cpp">ofstream <span class="token function">outfile</span><span class="token punctuation">(</span><span class="token string">"binary.txt"</span><span class="token punctuation">,</span> ofstream<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
string text <span class="token operator">=</span> <span class="token string">"Hello cplusplus forum!"</span><span class="token punctuation">;</span>
outfile<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>text<span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
outfile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>该代码可能会毫无问题地运行。但是文件 binary.txt 中包含什么？对于这类工作，十六进制编辑器很有用。在 Windows 上，您可以尝试 Hxd<a href="https://mh-nexus.de/en/hxd/">https://mh-nexus.de/en/hxd/</a></p>
<p>在我的系统上看到的是这样的：<code>TA&gt;.$ÀÂw..&gt;.LXH.èUH.@? </code>这很没有意义。这是因为字符串对象可能不包含字符串的文本，而是包含指向堆上保存的字符串的指针，以及可能的一些其他信息。</p>
<p>第一步是编写字符串本身的实际文本内容。<br/> 可以通过替换第3行来实现：<code>outfile.write((char*)&amp;text, text.size());</code>改为<code>outfile.write( text.c_str(), text.size());</code><br/> 现在，如果您再看一下文件的内容，它应该更有意义。<br/> 但这仍然留下一个问题。你将如何读回它？如果这就是文件包含的所有内容，这很容易，只需阅读到文件末尾即可。但是，如果您只想读取原始字符串，不多也不少怎么办？</p>
<p>那么你可以先在文件中存储大小。像这样:</p>
<pre><code class="prism language-cpp"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> size <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
outfile<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>要读取文件，请按相反的步骤执行。</p>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
    
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>   

    string text <span class="token operator">=</span> <span class="token string">"Hello cplusplus forum!"</span><span class="token punctuation">;</span>

    ofstream <span class="token function">outfile</span><span class="token punctuation">(</span><span class="token string">"binary.txt"</span><span class="token punctuation">,</span> ofstream<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> size <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                 <span class="token comment">// get the size</span>
    outfile<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// write it to the file</span>
    outfile<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span> text<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> text<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// write the actual text</span>
    outfile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">//----------------------------------------</span>

    ifstream <span class="token function">infile</span><span class="token punctuation">(</span><span class="token string">"binary.txt"</span><span class="token punctuation">,</span> ifstream<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// read the size</span>
    size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        
    infile<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Allocate a string, make it large enough to hold the input</span>
    string buffer<span class="token punctuation">;</span>
    buffer<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// read the text into the string</span>
    infile<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  buffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    infile<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"buffer = \n"</span> <span class="token operator">&lt;&lt;</span> buffer <span class="token operator">&lt;&lt;</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="3CYaml_630"></a>3.C++读写Yaml文件</h1>
<p>它的基本语法规则如下:</p>
<ul><li>大小写敏感</li><li>使用缩进表示层级关系</li><li>缩进时不允许使用Tab键，只允许使用空格。</li><li>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</li></ul>
<p>YAML支持的数据结构有三种。</p>
<ul><li>对象：键值对的集合，又称为映射（mapping）/ 哈希（hashes） / 字典（dictionary）</li><li>数组：一组按次序排列的值，又称为序列（sequence） / 列表（list）</li><li>纯量（scalars）：单个的、不可再分的值</li></ul>
<p>一般常用yaml-cpp和OpenCV进行解析</p>
<p>相比yaml-cpp，OpenCV的优点是可以在YAML文件中存储矩阵，读出来就是cv::Mat格式；缺点是OpenCV要求YAML文件有一个特殊的头，与标准的YAML文件并不兼容。或者也可以理解为OpenCV定义了一种新的YAML格式。<br/> <code># 表示注释，从这个字符一直到行尾，都会被解析器忽略</code>。</p>
<h2><a id="31yamlcpp_646"></a>3.1安装yaml-cpp</h2>
<p><a href="https://github.com/jbeder/yaml-cpp/">https://github.com/jbeder/yaml-cpp/</a></p>
<ul><li>编译环境<br/> Windows10<br/> VS2019<br/> cmake-3.19.8-win64-x64</li><li>yaml-cpp的编译<br/> 将下载好的yaml-cpp-master.zip进行解压，在源码目录下创建一个build文件夹并进入这个文件夹</li></ul>
<pre><code class="prism language-shell"><span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake <span class="token punctuation">..</span>
</code></pre>
<p>接着将会看到在build目录下有一个名为YAM_-CPP.sln的文件，用VS打开它<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/aafa429fa526424d88b3a97c87651f9b.png"/><br/> 对ALL_BUILD生成解决方案，成功生成后，会在build/Debug目录下得到yaml-cppd.lib文件<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a3fffab0f0384e4c9e37ba2d4e38f460.png"/></p>
<h1><a id="32_yaml1_664"></a>3.2 yaml文件的解析(1)</h1>
<ul><li>1)<code>config.yaml</code>配置文件</li></ul>
<pre><code class="prism language-yaml"><span class="token key atrule">custom_db</span><span class="token punctuation">:</span>
    <span class="token key atrule">db_domain</span><span class="token punctuation">:</span> 10.0.0.8
    <span class="token key atrule">db_username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">db_passwd</span><span class="token punctuation">:</span> my_passwd
    <span class="token key atrule">db_schema</span><span class="token punctuation">:</span> test

<span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">redis_domain</span><span class="token punctuation">:</span> 10.0.0.10
    <span class="token key atrule">redis_passwd</span><span class="token punctuation">:</span> <span class="token number">123456</span>

<span class="token key atrule">hello</span><span class="token punctuation">:</span>
    <span class="token key atrule">num_config</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>1141studio<span class="token punctuation">]</span>
    <span class="token key atrule">name_config</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>powered<span class="token punctuation">,</span> by<span class="token punctuation">,</span> 1141studio<span class="token punctuation">]</span>
</code></pre>
<ul><li>2)<code>config_test.cpp</code></li></ul>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"yaml-cpp/yaml.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string DB_CONF <span class="token operator">=</span> <span class="token string">"config.yaml"</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/*----------------------------------- test yaml ----------------------------------------*/</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"hello world\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this code is only for test yaml"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token comment">/* Node conf. */</span>
    YAML<span class="token double-colon punctuation">::</span>Node conf <span class="token operator">=</span> <span class="token class-name">YAML</span><span class="token double-colon punctuation">::</span><span class="token function">LoadFile</span><span class="token punctuation">(</span>DB_CONF<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/*----------------------------------- display db_config ----------------------------------------*/</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Database:"</span><span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"domain:  "</span> <span class="token operator">&lt;&lt;</span> conf<span class="token punctuation">[</span><span class="token string">"custom_db"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"db_domain"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"username:"</span> <span class="token operator">&lt;&lt;</span> conf<span class="token punctuation">[</span><span class="token string">"custom_db"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"db_username"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"passwd:  "</span> <span class="token operator">&lt;&lt;</span> conf<span class="token punctuation">[</span><span class="token string">"custom_db"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"db_passwd"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"schema:  "</span> <span class="token operator">&lt;&lt;</span> conf<span class="token punctuation">[</span><span class="token string">"custom_db"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"db_schema"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token comment">/*----------------------------------- display redis ----------------------------------------*/</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Redis"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"redis_domain: "</span> <span class="token operator">&lt;&lt;</span> conf<span class="token punctuation">[</span><span class="token string">"redis"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"redis_domain"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"redis_passwd: "</span> <span class="token operator">&lt;&lt;</span> conf<span class="token punctuation">[</span><span class="token string">"redis"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"redis_passwd"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    
    <span class="token comment">/*----------------------------------- display hello ----------------------------------------*/</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"HelloServer"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    
    <span class="token comment">/* vector of name string. */</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> name_vec <span class="token operator">=</span> conf<span class="token punctuation">[</span><span class="token string">"hello"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"num_config"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> <span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>name_vec<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> name_vec<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>3)CmakeLists.txt配置情况如下</li></ul>
<pre><code class="prism language-txt">cmake_minimum_required(VERSION 3.5.1)
project(nanodet-mnn)
SET(CMAKE_BUILD_TYPE "Release")

SET(CMAKE_CXX_FLAGS_RELEASE "$ENV{CXXFLAGS} -O3 -Wall")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -Wall")
set(EXECUTABLE_OUTPUT_PATH ${PROJECT_SOURCE_DIR}/)

# yaml-cpp的包含目录
include_directories("/gzy_mnt/YAML_X86/include")
file(GLOB SOURCE_FILES *.cpp)
add_executable(${CMAKE_PROJECT_NAME} ${SOURCE_FILES})

target_link_libraries (
        ${CMAKE_PROJECT_NAME}   
        pthread
        /gzy_mnt/YAML_X86/lib/libyaml-cpp.so
)
</code></pre>
<h2><a id="33_yaml2_744"></a>3.3 yaml文件的解析(2)</h2>
<ul><li>config.yaml配置文件</li></ul>
<pre><code class="prism language-txt">name: frank
sex: male
age: 18
 
skills: 
    c++: 1
    java: 1
    android: 1
    python: 1

</code></pre>
<ul><li>config_demo.cpp</li></ul>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"yaml-cpp/yaml.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
 
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    YAML<span class="token double-colon punctuation">::</span>Node config<span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
         config <span class="token operator">=</span> <span class="token class-name">YAML</span><span class="token double-colon punctuation">::</span><span class="token function">LoadFile</span><span class="token punctuation">(</span><span class="token string">"../config.yaml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>YAML<span class="token double-colon punctuation">::</span>BadFile <span class="token operator">&amp;</span>e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"read error!"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Node type "</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"skills type "</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span><span class="token string">"skills"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
 
    <span class="token comment">//可以用string类型作为下表，读取参数</span>
    string age <span class="token operator">=</span> <span class="token string">"age"</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"age when string is label:"</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span>age<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
 
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"name:"</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"sex:"</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span><span class="token string">"sex"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"age:"</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span><span class="token string">"age"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
 
    <span class="token comment">//读取不存在的node值，报YAML::TypedBadConversion异常</span>
    <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
        string label <span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">"label"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>YAML<span class="token double-colon punctuation">::</span>TypedBadConversion<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">&amp;</span>e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"label node is NULL"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token comment">//TypedBadConversion是模板类，读取什么类型的参数就传入什么类型</span>
 
 
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"skills c++:"</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span><span class="token string">"skills"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"c++"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"skills java:"</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span><span class="token string">"skills"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"java"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"skills android:"</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span><span class="token string">"skills"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"android"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"skills python:"</span> <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">[</span><span class="token string">"skills"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"python"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
 	<span class="token comment">// yaml-cpp 中也可以通过迭代的方式，访问 Node 中的内容。</span>
	<span class="token comment">// 比如，访问 skills 下面的各个元素。</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>YAML<span class="token double-colon punctuation">::</span>const_iterator it<span class="token operator">=</span> config<span class="token punctuation">[</span><span class="token string">"skills"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> config<span class="token punctuation">[</span><span class="token string">"skills"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>it<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> it<span class="token operator">-&gt;</span>first<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">":"</span> <span class="token operator">&lt;&lt;</span> it<span class="token operator">-&gt;</span>second<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    YAML<span class="token double-colon punctuation">::</span>Node test1 <span class="token operator">=</span> <span class="token class-name">YAML</span><span class="token double-colon punctuation">::</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">"[1,2,3,4]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Type: "</span> <span class="token operator">&lt;&lt;</span> test1<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
 
    YAML<span class="token double-colon punctuation">::</span>Node test2 <span class="token operator">=</span> <span class="token class-name">YAML</span><span class="token double-colon punctuation">::</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Type: "</span> <span class="token operator">&lt;&lt;</span> test2<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
 
    YAML<span class="token double-colon punctuation">::</span>Node test3 <span class="token operator">=</span> <span class="token class-name">YAML</span><span class="token double-colon punctuation">::</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">"{'id':1,'degree':'senior'}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">" Type: "</span> <span class="token operator">&lt;&lt;</span> test3<span class="token punctuation">.</span><span class="token function">Type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
 
    ofstream <span class="token function">fout</span><span class="token punctuation">(</span><span class="token string">"./testconfig.yaml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//保存config为yaml文件</span>
 
    config<span class="token punctuation">[</span><span class="token string">"score"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">;</span><span class="token comment">//添加新元素</span>
 
    fout <span class="token operator">&lt;&lt;</span> config<span class="token punctuation">;</span>
 
    fout<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
<h2><a id="34_node_830"></a>3.4 node的增删改查</h2>
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;yaml-cpp/yaml.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
 
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    YAML<span class="token double-colon punctuation">::</span>Node node<span class="token punctuation">;</span>  
    <span class="token function">assert</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//初始化的节点是Null类型</span>
    node<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"value"</span><span class="token punctuation">;</span>  <span class="token comment">//当你给它赋值键值对，它转变为Map类型</span>
    <span class="token comment">//node.force_insert("key", "value");//这个操作和上面等价，但是它不会检查是否存在"key"键，不推荐使用</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token string">"mascot"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> node<span class="token punctuation">[</span><span class="token string">"mascot"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span><span class="token comment">//单纯的查询操作不会增加一个key，当然上面的if不会执行</span>
 
    node<span class="token punctuation">[</span><span class="token string">"number"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">IsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//node是一个Map</span>
    node<span class="token punctuation">[</span><span class="token string">"seq"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"first element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">[</span><span class="token string">"seq"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"second element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//node的seq下是Sequence类型，有两个参数</span>
 
    YAML<span class="token double-colon punctuation">::</span>Node node_2<span class="token punctuation">;</span>  
    node_2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"first item"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果你不给node_2键值对，它是一个sequence类型</span>
    node_2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"second_item"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    node_2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"third_item"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//给node_2插入了一个Sequence</span>
    node_2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>node_2<span class="token punctuation">.</span><span class="token function">IsSequence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//当然，node_2仍然是一个Sequence</span>
 
    <span class="token function">assert</span><span class="token punctuation">(</span>node_2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"first item"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//对于Sequence类型，你可以使用它的下标来访问</span>
    <span class="token comment">//注意这里as&lt;T&gt;是一个模板转换，node_2[0]的type是NodeType::Scalar</span>
    <span class="token keyword">auto</span> it <span class="token operator">=</span> node_2<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> node_2<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token comment">//当然，你也可以用迭代器来访问</span>
    <span class="token comment">//他们的类型分别是NodeType::Scalar，NodeType::Scalar，NodeType::Scalar，NodeType::Sequence</span>
    <span class="token comment">//取值时记得使用as进行模板转换</span>
    node_2<span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"value"</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>node_2<span class="token punctuation">.</span><span class="token function">IsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//一旦node_2接收到键值对，它转变为Map类型</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>node_2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"first item"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//此时，Sequence时的下标变为它的key值</span>
    node<span class="token punctuation">[</span><span class="token string">"node_2"</span><span class="token punctuation">]</span> <span class="token operator">=</span> node_2<span class="token punctuation">;</span><span class="token comment">//将node_2作为node的一个子项</span>
    node<span class="token punctuation">[</span><span class="token string">"pointer_to_first_element"</span><span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">[</span><span class="token string">"seq"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//你也可以给已有的node设置一个别名，类似于一个指针</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token string">"pointer_to_first_element"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">as</span><span class="token generic class-name"><span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"first element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//你可以通过这个指针访问那个node</span>
 
    node<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>node<span class="token punctuation">[</span><span class="token string">"seq"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//你可以通过指定一个node来删除它</span>
    node<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"pointer_to_first_element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//你也可以通过指定key来删除它</span>
<span class="token punctuation">}</span>
</code></pre>
<p>如果你执行<code>std::cout&lt;&lt;node&lt;&lt;endl;</code><br/> 应该会得到以下结果</p>
<pre><code class="prism language-txt">key: value
number: 255
seq:
  - first element
  - second element
node_2:
  0: first item
  1: second_item
  2: third_item
  3:
    - 1
    - 3
    - 5
    - 7
    - 9
  key: value

</code></pre>
<h1><a id="_902"></a>参考目录</h1>
<p><a href="https://java2blog.com/read-csv-file-in-cpp/#:~:text=To%20read%20a%20CSV%20file%2C,variable%20as%20its%20second%20argument.">https://java2blog.com/read-csv-file-in-cpp/#:~:text=To%20read%20a%20CSV%20file%2C,variable%20as%20its%20second%20argument.</a><br/> <a href="https://gist.github.com/haseeb-heaven/ee3f5931f7951106bea550c119a68c57">https://gist.github.com/haseeb-heaven/ee3f5931f7951106bea550c119a68c57</a><br/> <a href="http://www.cplusplus.com/forum/beginner/224309/">http://www.cplusplus.com/forum/beginner/224309/</a><br/> <a href="https://blog.csdn.net/qq_23123181/article/details/123627596">https://blog.csdn.net/qq_23123181/article/details/123627596</a><br/> <a href="https://blog.csdn.net/xhtchina/article/details/113868147">https://blog.csdn.net/xhtchina/article/details/113868147</a></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>