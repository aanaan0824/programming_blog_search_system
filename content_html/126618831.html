<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>æ–‡ç« ç›®å½•</h3>
<ul><li><a href="#_6">å‰è¨€</a></li><li><a href="#_42">ä¸€ã€è¯†åˆ«æ•ˆæœ</a></li><li><a href="#_61">äºŒã€å®ç°</a></li><li><ul><li><a href="#1_62">1.æ•°æ®é›†</a></li><li><a href="#2_76">2.å®ç°åŸç†å’Œæ–¹æ³•</a></li><li><a href="#3_86">3.ç½‘ç»œç»“æ„</a></li></ul>
</li></ul>
</div>
<p></p>
<hr color="#000000" size='1"'/>
<h1><a id="_6"></a>å‰è¨€</h1>
<p>ğŸ”¥ Hiï¼Œå¤§å®¶å¥½ï¼Œè¿™é‡Œæ˜¯ä¸¹æˆå­¦é•¿çš„æ¯•è®¾ç³»åˆ—æ–‡ç« ï¼</p>
<p>ğŸ”¥ å¯¹æ¯•è®¾æœ‰ä»»ä½•ç–‘é—®éƒ½å¯ä»¥é—®å­¦é•¿å“¦!</p>
<p>è¿™ä¸¤å¹´å¼€å§‹ï¼Œå„ä¸ªå­¦æ ¡å¯¹æ¯•è®¾çš„è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œéš¾åº¦ä¹Ÿè¶Šæ¥è¶Šå¤§â€¦ æ¯•ä¸šè®¾è®¡è€—è´¹æ—¶é—´ï¼Œè€—è´¹ç²¾åŠ›ï¼Œç”šè‡³æœ‰äº›é¢˜ç›®å³ä½¿æ˜¯ä¸“ä¸šçš„è€å¸ˆæˆ–è€…ç¡•å£«ç”Ÿä¹Ÿéœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œæ‰€ä»¥ä¸€æ—¦å‘ç°é—®é¢˜ï¼Œä¸€å®šè¦æå‰å‡†å¤‡ï¼Œé¿å…åˆ°åé¢æªæ‰‹ä¸åŠï¼Œè‰è‰äº†äº‹ã€‚</p>
<p>ä¸ºäº†å¤§å®¶èƒ½å¤Ÿé¡ºåˆ©ä»¥åŠæœ€å°‘çš„ç²¾åŠ›é€šè¿‡æ¯•è®¾ï¼Œå­¦é•¿åˆ†äº«ä¼˜è´¨æ¯•ä¸šè®¾è®¡é¡¹ç›®ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ–°é¡¹ç›®æ˜¯</p>
<p>ğŸš© <strong>åŸºäºæ·±åº¦å­¦ä¹ å›¾åƒè¯†åˆ«çš„åƒåœ¾åˆ†ç±»ç³»ç»Ÿ</strong></p>
<p>ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)</p>
<ul><li>éš¾åº¦ç³»æ•°ï¼š4åˆ†</li><li>å·¥ä½œé‡ï¼š4åˆ†</li><li>åˆ›æ–°ç‚¹ï¼š3åˆ†</li></ul>
<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p>
<p><a href="https://blog.csdn.net/Mr_DC_IT/article/details/126460477">https://blog.csdn.net/Mr_DC_IT/article/details/126460477</a></p>
<p><font color="#999AAA">å¦‚ä»Šï¼Œåƒåœ¾åˆ†ç±»å·²æˆä¸ºç¤¾ä¼šçƒ­ç‚¹è¯é¢˜ã€‚å…¶å®åœ¨2019å¹´4æœˆ26æ—¥ï¼Œæˆ‘å›½ä½æˆ¿å’ŒåŸä¹¡å»ºè®¾éƒ¨ç­‰éƒ¨é—¨å°±å‘å¸ƒäº†ã€Šå…³äºåœ¨å…¨å›½åœ°çº§åŠä»¥ä¸ŠåŸå¸‚å…¨é¢å¼€å±•ç”Ÿæ´»åƒåœ¾åˆ†ç±»å·¥ä½œçš„é€šçŸ¥ã€‹ï¼Œå†³å®šè‡ª2019å¹´èµ·åœ¨å…¨å›½åœ°çº§åŠä»¥ä¸ŠåŸå¸‚å…¨é¢å¯åŠ¨ç”Ÿæ´»åƒåœ¾åˆ†ç±»å·¥ä½œã€‚åˆ°2020å¹´åº•ï¼Œ46ä¸ªé‡ç‚¹åŸå¸‚åŸºæœ¬å»ºæˆç”Ÿæ´»åƒåœ¾åˆ†ç±»å¤„ç†ç³»ç»Ÿã€‚</font></p>
<p><font color="#999AAA">äººå·¥åƒåœ¾åˆ†ç±»æŠ•æ”¾æ˜¯åƒåœ¾å¤„ç†çš„ç¬¬ä¸€ç¯èŠ‚ï¼Œä½†èƒ½å¤Ÿå¤„ç†æµ·é‡åƒåœ¾çš„ç¯èŠ‚æ˜¯åƒåœ¾å¤„ç†å‚ã€‚ç„¶è€Œï¼Œç›®å‰å›½å†…çš„åƒåœ¾å¤„ç†å‚åŸºæœ¬éƒ½æ˜¯é‡‡ç”¨äººå·¥æµæ°´çº¿åˆ†æ‹£çš„æ–¹å¼è¿›è¡Œåƒåœ¾åˆ†æ‹£ï¼Œå­˜åœ¨å·¥ä½œç¯å¢ƒæ¶åŠ£ã€åŠ³åŠ¨å¼ºåº¦å¤§ã€åˆ†æ‹£æ•ˆç‡ä½ç­‰ç¼ºç‚¹ã€‚åœ¨æµ·é‡åƒåœ¾é¢å‰ï¼Œäººå·¥åˆ†æ‹£åªèƒ½åˆ†æ‹£å‡ºææœ‰é™çš„ä¸€éƒ¨åˆ†å¯å›æ”¶åƒåœ¾å’Œæœ‰å®³åƒåœ¾ï¼Œç»å¤§å¤šæ•°åƒåœ¾åªèƒ½è¿›è¡Œå¡«åŸ‹ï¼Œå¸¦æ¥äº†æå¤§çš„èµ„æºæµªè´¹å’Œç¯å¢ƒæ±¡æŸ“å±é™©ã€‚</font></p>
<p><font color="#999AAA">éšç€æ·±åº¦å­¦ä¹ æŠ€æœ¯åœ¨è§†è§‰é¢†åŸŸçš„åº”ç”¨å’Œå‘å±•ï¼Œè®©æˆ‘ä»¬çœ‹åˆ°äº†åˆ©ç”¨AIæ¥è‡ªåŠ¨è¿›è¡Œåƒåœ¾åˆ†ç±»çš„å¯èƒ½ï¼Œé€šè¿‡æ‘„åƒå¤´æ‹æ‘„åƒåœ¾å›¾ç‰‡ï¼Œæ£€æµ‹å›¾ç‰‡ä¸­åƒåœ¾çš„ç±»åˆ«ï¼Œä»è€Œå¯ä»¥è®©æœºå™¨è‡ªåŠ¨è¿›è¡Œåƒåœ¾åˆ†æ‹£ï¼Œæå¤§åœ°æé«˜åƒåœ¾åˆ†æ‹£æ•ˆç‡ã€‚</font></p>
<p><font color="#999AAA">åŸºäºæ·±åº¦å­¦ä¹ çš„åƒåœ¾åˆ†ç±»ç³»ç»Ÿï¼Œæ˜¯éå¸¸å¥½çš„æ¯•ä¸šè®¾è®¡è¯¾é¢˜</font></p>
<hr color="#000000" size='1"'/>
<h1><a id="_42"></a>ä¸€ã€è¯†åˆ«æ•ˆæœ</h1>
<p><font color="#999AAA">è€æ ·å­ï¼Œ åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆå±•ç¤ºå›¾åƒåƒåœ¾åˆ†ç±»çš„è¯†åˆ«æ•ˆæœ</font></p>
<p>è®­ç»ƒæ¨¡å‹ç²¾åº¦ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\20201117202349633.jpg"/><br/> å¯ä»¥çœ‹åˆ°ï¼Œåªè¿­ä»£äº†10è½®ç²¾åº¦è¾¾åˆ°87.50%ï¼Œè€Œä¸”æ²¡æœ‰å‡ºç°è¿‡æ‹Ÿåˆç°è±¡</p>
<p>æˆ‘æœ€é«˜è®­ç»ƒè¾¾åˆ°96%ï¼Œè¿­ä»£200è½®</p>
<p>è¯†åˆ«ç»“æœï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\2020111720251019.png"/><br/> å®é™…éªŒè¯æ­£ç¡®ç‡è¿˜æ˜¯å¾ˆé«˜çš„ã€‚</p>
<h1><a id="_61"></a>äºŒã€å®ç°</h1>
<h2><a id="1_62"></a>1.æ•°æ®é›†</h2>
<p>è¯¥æ•°æ®é›†åŒ…å«äº† 2507 ä¸ªç”Ÿæ´»åƒåœ¾å›¾ç‰‡ã€‚æ•°æ®é›†çš„åˆ›å»ºè€…å°†åƒåœ¾åˆ†ä¸ºäº† 6 ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«æ˜¯ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\20201117202955835.png"/><br/> å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\20201117203100182.png"/><br/> ä¸€å…±6ç±»åƒåœ¾ï¼Œ æ¯”å¦‚ç»ç’ƒç±»çš„å¦‚ä¸‹ï¼š</p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\20201117203208458.png"/><br/> å¡‘æ–™ç±»çš„å¦‚ä¸‹ï¼š</p>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\2020111720324980.png"/><br/> å…¶ä»–çš„ä¸åˆ—ä¸¾äº†ã€‚</p>
<h2><a id="2_76"></a>2.å®ç°åŸç†å’Œæ–¹æ³•</h2>
<p>ä½¿ç”¨æ·±åº¦æ®‹å·®ç½‘ç»œresnet50ä½œä¸ºåŸºçŸ³ï¼Œåœ¨åç»­æ·»åŠ éœ€è¦çš„å±‚ä»¥é€‚åº”ä¸åŒçš„åˆ†ç±»ä»»åŠ¡<br/> æ¨¡å‹çš„è®­ç»ƒéœ€è¦ç”¨ç”Ÿæˆå™¨å°†æ•°æ®é›†å¾ªç¯å†™å…¥å†…å­˜ï¼ŒåŒæ—¶å›¾åƒå¢å¼ºä»¥æ³›åŒ–æ¨¡å‹<br/> ä½¿ç”¨ä¸åŒ…å«ç½‘ç»œè¾“å‡ºéƒ¨åˆ†çš„resnet50æƒé‡æ–‡ä»¶è¿›è¡Œè¿ç§»å­¦ä¹ ï¼Œåªè®­ç»ƒæˆ‘ä»¬åœ¨5ä¸ªstageåå¢åŠ çš„å±‚</p>
<p>éœ€è¦çš„ç¬¬ä¸‰æ–¹åº“ä¸»è¦æœ‰tensorflow1.xï¼Œkerasï¼Œopencvï¼ŒPillowï¼Œscikit-learnï¼Œnumpy<br/> å®‰è£…æ–¹å¼å¾ˆç®€å•ï¼Œæ‰“å¼€terminalï¼Œä¾‹å¦‚ï¼špip install numpy -i https://pypi.tuna.tsinghua.edu.cn/simple<br/> æ•°æ®é›†ä¸æƒé‡æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æ²¡æœ‰ä¸Šä¼ <br/> å¦‚æœç¯å¢ƒé…ç½®æ–¹é¢æœ‰é—®é¢˜æˆ–è€…éœ€è¦æ•°æ®é›†ä¸æ¨¡å‹æƒé‡æ–‡ä»¶ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºè¯´æ˜æ‚¨çš„é—®é¢˜ï¼Œæˆ‘å°†è¿œç¨‹å¸®åŠ©æ‚¨</p>
<h2><a id="3_86"></a>3.ç½‘ç»œç»“æ„</h2>
<p>è¿™é‡Œæˆ‘åªä½¿ç”¨äº†resnet50çš„5ä¸ªstageï¼Œåé¢çš„è¾“å‡ºéƒ¨åˆ†éœ€è¦æˆ‘ä»¬è‡ªå·±å®šåˆ¶ï¼Œç½‘ç»œçš„ç»“æ„å›¾å¦‚ä¸‹ï¼š<br/> <img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="image\20201117204217280.png"/><br/> stage5åæˆ‘ä»¬çš„å®šåˆ¶ç½‘ç»œå¦‚ä¸‹ï¼š</p>
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""å®šåˆ¶resnetåé¢çš„å±‚"""</span>
<span class="token keyword">def</span> <span class="token function">custom</span><span class="token punctuation">(</span>input_size<span class="token punctuation">,</span>num_classes<span class="token punctuation">,</span>pretrain<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># å¼•å…¥åˆå§‹åŒ–resnet50æ¨¡å‹</span>
    base_model <span class="token operator">=</span> ResNet50<span class="token punctuation">(</span>weights<span class="token operator">=</span>pretrain<span class="token punctuation">,</span>
                          include_top<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                          pooling<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                          input_shape<span class="token operator">=</span><span class="token punctuation">(</span>input_size<span class="token punctuation">,</span>input_size<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          classes<span class="token operator">=</span>num_classes<span class="token punctuation">)</span>
    <span class="token comment">#ç”±äºæœ‰é¢„æƒé‡ï¼Œå‰éƒ¨åˆ†å†»ç»“ï¼Œåé¢è¿›è¡Œè¿ç§»å­¦ä¹ </span>
    <span class="token keyword">for</span> layer <span class="token keyword">in</span> base_model<span class="token punctuation">.</span>layers<span class="token punctuation">:</span>
        layer<span class="token punctuation">.</span>trainable <span class="token operator">=</span> <span class="token boolean">False</span>
    <span class="token comment">#æ·»åŠ åé¢çš„å±‚</span>
    x <span class="token operator">=</span> base_model<span class="token punctuation">.</span>output
    x <span class="token operator">=</span> layers<span class="token punctuation">.</span>GlobalAveragePooling2D<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'avg_pool'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x <span class="token operator">=</span> layers<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'dropout1'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token comment">#regularizersæ­£åˆ™åŒ–å±‚ï¼Œæ­£åˆ™åŒ–å™¨å…è®¸åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­å¯¹å±‚çš„å‚æ•°æˆ–å±‚çš„æ¿€æ´»æƒ…å†µè¿›è¡Œæƒ©ç½š</span>
    <span class="token comment">#å¯¹æŸå¤±å‡½æ•°è¿›è¡Œæœ€å°åŒ–çš„åŒæ—¶ï¼Œä¹Ÿéœ€è¦è®©å¯¹å‚æ•°æ·»åŠ é™åˆ¶ï¼Œè¿™ä¸ªé™åˆ¶ä¹Ÿå°±æ˜¯æ­£åˆ™åŒ–æƒ©ç½šé¡¹ï¼Œä½¿ç”¨l2èŒƒæ•°</span>
    x <span class="token operator">=</span> layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">,</span>kernel_regularizer<span class="token operator">=</span> regularizers<span class="token punctuation">.</span>l2<span class="token punctuation">(</span><span class="token number">0.0001</span><span class="token punctuation">)</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'fc2'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x <span class="token operator">=</span> layers<span class="token punctuation">.</span>BatchNormalization<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'bn_fc_01'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x <span class="token operator">=</span> layers<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'dropout2'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token comment">#40ä¸ªåˆ†ç±»</span>
    x <span class="token operator">=</span> layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span>num_classes<span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    model <span class="token operator">=</span> Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>base_model<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">,</span>outputs<span class="token operator">=</span>x<span class="token punctuation">)</span>
    <span class="token comment">#æ¨¡å‹ç¼–è¯‘</span>
    model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">"adam"</span><span class="token punctuation">,</span>loss <span class="token operator">=</span> <span class="token string">'categorical_crossentropy'</span><span class="token punctuation">,</span>metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> model
</code></pre>
<p>ç½‘ç»œçš„è®­ç»ƒæ˜¯è¿ç§»å­¦ä¹ è¿‡ç¨‹ï¼Œä½¿ç”¨å·²æœ‰çš„åˆå§‹resnet50æƒé‡ï¼ˆ5ä¸ªstageå·²ç»è®­ç»ƒè¿‡ï¼Œå·ç§¯å±‚å·²ç»èƒ½å¤Ÿæå–ç‰¹å¾ï¼‰ï¼Œæˆ‘ä»¬åªè®­ç»ƒåé¢çš„å…¨è¿æ¥å±‚éƒ¨åˆ†ï¼Œ4ä¸ªepochåå†å¯¹è¾ƒåé¢çš„å±‚è¿›è¡Œè®­ç»ƒå¾®è°ƒä¸€ä¸‹ï¼Œè·å¾—æ›´é«˜å‡†ç¡®ç‡ï¼Œè®­ç»ƒè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Net</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>img_size<span class="token punctuation">,</span>gar_num<span class="token punctuation">,</span>data_dir<span class="token punctuation">,</span>batch_size<span class="token punctuation">,</span>pretrain<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>img_size<span class="token operator">=</span>img_size
        self<span class="token punctuation">.</span>gar_num<span class="token operator">=</span>gar_num
        self<span class="token punctuation">.</span>data_dir<span class="token operator">=</span>data_dir
        self<span class="token punctuation">.</span>batch_size<span class="token operator">=</span>batch_size
        self<span class="token punctuation">.</span>pretrain<span class="token operator">=</span>pretrain

    <span class="token keyword">def</span> <span class="token function">build_train</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""è¿ç§»å­¦ä¹ """</span>
        model <span class="token operator">=</span> resnet<span class="token punctuation">.</span>custom<span class="token punctuation">(</span>self<span class="token punctuation">.</span>img_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>gar_num<span class="token punctuation">,</span> self<span class="token punctuation">.</span>pretrain<span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>

        train_sequence<span class="token punctuation">,</span> validation_sequence <span class="token operator">=</span> genit<span class="token punctuation">.</span>gendata<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data_dir<span class="token punctuation">,</span> self<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>gar_num<span class="token punctuation">,</span> self<span class="token punctuation">.</span>img_size<span class="token punctuation">)</span>

        epochs<span class="token operator">=</span><span class="token number">4</span>
        model<span class="token punctuation">.</span>fit_generator<span class="token punctuation">(</span>train_sequence<span class="token punctuation">,</span>steps_per_epoch<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_sequence<span class="token punctuation">)</span><span class="token punctuation">,</span>epochs<span class="token operator">=</span>epochs<span class="token punctuation">,</span>verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>validation_data<span class="token operator">=</span>validation_sequence<span class="token punctuation">,</span>
                                     max_queue_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment">#å¾®è°ƒ,åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œæ¿€æ´»å‡½æ•°ä¹Ÿè¢«ç®—è¿›å±‚é‡Œï¼Œæ‰€ä»¥æ€»å…±181å±‚ï¼Œå¾®è°ƒæ˜¯ä¸ºäº†é‡æ–°è®­ç»ƒéƒ¨åˆ†å·ç§¯å±‚ï¼ŒåŒæ—¶è®­ç»ƒæœ€åçš„å…¨è¿æ¥å±‚</span>
        layers<span class="token operator">=</span><span class="token number">149</span>
        learning_rate<span class="token operator">=</span><span class="token number">1e-4</span>
        <span class="token keyword">for</span> layer <span class="token keyword">in</span> model<span class="token punctuation">.</span>layers<span class="token punctuation">[</span><span class="token punctuation">:</span>layers<span class="token punctuation">]</span><span class="token punctuation">:</span>
            layer<span class="token punctuation">.</span>trainable <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">for</span> layer <span class="token keyword">in</span> model<span class="token punctuation">.</span>layers<span class="token punctuation">[</span>layers<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            layer<span class="token punctuation">.</span>trainable <span class="token operator">=</span> <span class="token boolean">True</span>
        Adam <span class="token operator">=</span>adam<span class="token punctuation">(</span>lr<span class="token operator">=</span>learning_rate<span class="token punctuation">,</span> decay<span class="token operator">=</span><span class="token number">0.0005</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span>Adam<span class="token punctuation">,</span> loss<span class="token operator">=</span><span class="token string">'categorical_crossentropy'</span><span class="token punctuation">,</span> metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        model<span class="token punctuation">.</span>fit_generator<span class="token punctuation">(</span>train_sequence<span class="token punctuation">,</span>steps_per_epoch<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_sequence<span class="token punctuation">)</span><span class="token punctuation">,</span>epochs<span class="token operator">=</span>epochs <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>verbose<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
            callbacks<span class="token operator">=</span><span class="token punctuation">[</span>
                callbacks<span class="token punctuation">.</span>ModelCheckpoint<span class="token punctuation">(</span><span class="token string">'./models/garclass.h5'</span><span class="token punctuation">,</span>monitor<span class="token operator">=</span><span class="token string">'val_loss'</span><span class="token punctuation">,</span> save_best_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'min'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                callbacks<span class="token punctuation">.</span>ReduceLROnPlateau<span class="token punctuation">(</span>monitor<span class="token operator">=</span><span class="token string">'val_loss'</span><span class="token punctuation">,</span> factor<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>patience<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'min'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                callbacks<span class="token punctuation">.</span>EarlyStopping<span class="token punctuation">(</span>monitor<span class="token operator">=</span><span class="token string">'val_loss'</span><span class="token punctuation">,</span> patience<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            validation_data<span class="token operator">=</span>validation_sequence<span class="token punctuation">,</span>max_queue_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'finish train,look for garclass.h5'</span><span class="token punctuation">)</span>
</code></pre>
<br/>
<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p>
<p><a href="https://blog.csdn.net/Mr_DC_IT/article/details/126460477">https://blog.csdn.net/Mr_DC_IT/article/details/126460477</a></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>