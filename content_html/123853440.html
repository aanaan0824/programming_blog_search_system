<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<div style="margin-left:0;">
<div id="ctl00_Abstract" style="margin-left:0;">
<span style="color:#111111;"><span style="background-color:#ffffff;">二维码库允许您的程序创建（编码）二维码图像或读取（解码）包含一个或多个二维码的图像。代码已升级到 VS 2022 和 .NET 6.0。</span></span>
</div>
<div style="margin-left:0;"></div>
<div style="margin-left:0;">
<span style="color:#111111;"><span style="background-color:#ffffff;"><a class="link-info" href="https://www.itjpk.com/Artices?id=23" title="无情跳转">无情跳转</a>​​​​​​​</span></span>
</div>
<div id="contentdiv" style="margin-left:0;">
<h2 style="margin-left:0;"><span style="color:#ff9900;"><span style="background-color:#ffffff;">介绍</span></span></h2>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">二维码库允许您的程序创建（编码）二维码图像或读取（解码）包含一个或多个二维码的图像。随附的源代码由两个解决方案组成，一个二维码编码器解决方案和一个二维码解码器解决方案。软件升级到VS 2022 .NET6.0。源代码是用 C# 编写的。它是一个开源代码。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">请注意“QR Code”一词是 DENSO WAVE INCORPORATED 的注册商标。</span></span></p>
<h3><span style="color:#ff9900;"><span style="background-color:#ffffff;">编码器解决方案</span></span></h3>
<code>QRCodeEncoderLibrary</code>：一个类库项目 
  <code>QRCodeEncoderDemo</code>：一个 Windows 窗体演示程序，演示如何将一个
  <code>string</code>或一个字节数组编码为 QR 码图像文件 
  <code>QRCodeConsoleDemo</code>：一个 Windows 控制台演示程序，演示如何将文本文件或二进制文件编码为 QR 码图像文件 
  <h3><span style="color:#ff9900;"><span style="background-color:#ffffff;">解码器解决方案</span></span></h3>
<code>QRCodeDecoderLibrary</code>：一个类库项目 
  <code>QRCodeDecoderDemo</code>：演示如何解码包含二维码的图像文件并检索
  <code>string</code>或字节数组的演示程序。图像文件源可以是磁盘文件或实时摄像机输入。摄像机软件基于 Direct Show Library。 
  <p><span style="color:#111111;"><span style="background-color:#ffffff;">此库的 QR 码编码器部分包含在<a href="https://www.codeproject.com/Articles/570682/PDF-File-Writer-Csharp-Class-Library-Version" title="PDF 文件编写器 C# 类库">PDF 文件编写器 C# 类库</a>文章中。</span></span></p>
<h2 style="margin-left:0;"><span style="color:#ff9900;"><span style="background-color:#ffffff;">安装</span></span></h2>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">随附的源代码由两个 Visual Studio 解决方案组成。每个解决方案都由一个库项目和演示/测试项目组成。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">将代码集成到您的应用程序需要以下步骤。在您的开发区域中安装<em><strong>QRCodeEncoderLibrary.dll</strong></em>或<em><strong>QRCodeDecoderLibrary.dll</strong></em>。启动 Visual Studio C# 程序并打开您的应用程序。转到<strong>解决方案资源管理器</strong>，右键单击<strong>References</strong>，然后选择<strong>Add Reference</strong>。选择<strong>浏览</strong>选项卡并将文件系统导航到所需库的位置。当您的应用程序发布时，相关的库文件必须包含并安装在与您的可执行文件 ( <em><strong>.exe</strong></em> ) 文件相同的文件夹中。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">或者，您可以将相关库的源文件复制到您的项目中。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">必须将相关的“ <code>using</code>”语句添加到您的所有源文件中：</span></span></p>
<div id="premain34438" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre34438"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#0000ff"&gt;using&lt;/span&gt; QRCodeEncoderLibrary;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; or&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#0000ff"&gt;using&lt;/span&gt; QRCodeDecoderLibrary;&lt;/span&gt;&lt;/span&gt;</code></pre>
<h2 style="margin-left:0;"><span style="color:#ff9900;"><span style="background-color:#ffffff;">二维码</span></span></h2>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">二维码代表快速响应代码。它是一个二维条码。从视觉上看，它是一个由黑白相间的小方块模块组成的正方形。广场周围环绕着一个白色的安静区域。二维码由国际标准 ISO/IEC 18004 定义<a href="https://www.swisseduc.ch/informatik/theoretische_informatik/qr_codes/docs/qr_standard.pdf" title="。此标准的免费副本可在此处获得。">。此标准的免费副本可在此处获得。</a></span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">ISO 标准文件将 QR 码定义为“QR 码是一个矩阵，由以整体方形图案排列的名义上的方形模块阵列组成，包括位于符号三个角的独特定位器图案，旨在帮助轻松定位它的位置、大小和倾斜度。提供了范围广泛的符号大小以及四级纠错。模块尺寸由用户指定，可通过多种技术生成符号。”</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">ISO 标准 18004 是了解 QR 码详细信息的最佳信息来源。搜索互联网会产生更多关于此主题的文章。<a href="https://en.wikipedia.org/wiki/QR_code" title="可以在此处查看">可以在此处查看</a>有关 QR 码的维基百科文章。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">二维码标准是 40 个不同大小的正方形的集合。每个方块都有一个从 1 到 40 的版本号。每个方块的大小从 21 x 21 模块（版本 1）到 177 x 177 模块（版本 40）不等。每个版本的每边比以前的版本多 4 个模块。</span></span></p>
<div id="premain895512" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre895512"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;Square-Dimension = &lt;span style="color:#000080"&gt;21&lt;/span&gt; + &lt;span style="color:#000080"&gt;4&lt;/span&gt; * (Version - &lt;span style="color:#000080"&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">一些模块是固定的。最明显的是三方取景器。其余模块分为数据和纠错。有 4 个级别的纠错：</span></span></p> L- Low 将纠正高达 7% 的错误 M- Medium 将纠正高达 15% 的错误 Q- Quarter 将纠正高达 25% 的错误 H- 高将纠正高达 30% 的错误 
  <p><span style="color:#111111;"><span style="background-color:#ffffff;">数据区中的每个模块代表一位。黑色模块为 1，白色模块为 0。数据区可以划分为段。每个输入段字节数组以数字、字母数字和字节三种方式之一编码为数据位。<strong>注意</strong>：二维码标准对汉字字符多了一种编码方法。本项目不支持。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">要编码 QR 码，您需要提供要编码的数据和四个纠错码之一。系统将计算表示数据所需的最小版本号。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">除了数据之外，QR 码还可以包含 ECI 分配编号。分配编号范围是 0 到 999999。该编号不是 QR 码数据的一部分。它用于对受字节值的替代解释（例如，替代字符集）的数据进行编码。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">该程序分析每个数据段以找到“最佳”编码。如果您想减小 QR 码的大小并且您有如上定义的长数字字符串或字母数字数据，则将您的输入分成几个字符串或字节数组。其中一些字符串必须是纯数字或上面定义的字母数字。在解码过程中，所有结果<code>string</code>段将连接在一起。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">当库解码包含一个或多个二维码的图像时，结果将是一个<code>string</code>s 数组或字节数组数组。每个数组项是一个二维码。</span></span></p>
<ul style="margin-left:0;"><li><strong>数字数据</strong>：该段仅由数字 0-9 组成。三位数字将转换为 10 位。</li><li><strong>字母数字数据</strong>：该段由数字 0–9、大写字母 A–Z 和其他九个字符 [空格、$ % * + - 组成。/ :]。两个字母数字字符将转换为 11 位。</li><li><strong>8 位字节数据</strong>。该段未转换。输入位和模块之间是一一对应的。</li></ul>
</div>
</div>
<div style="margin-left:0;">
<div style="margin-left:0;">
<h2 style="margin-left:0;"><span style="color:#ff9900;"><span style="background-color:#ffffff;">二维码编码</span></span></h2>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">编码的主要类是<code>QREncoder</code>. 它将字节数组或文本<code>string</code>转换为二维码图像。要创建 QR 码图像，请执行以下步骤：</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">创建<code>QREncoder</code>对象。设置两个可选参数。纠错码和 ECI 分配编号。这个对象是可重复使用的。如果您想创建许多 QR 码，只需重用此对象即可。没有初始化或处置要求。可选参数将保留上次运行时的值。</span></span></p>
<div id="premain530128" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre530128"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; create QR Code encoder object&lt;/em&gt;&lt;/span&gt;
QRCodeEncoder Encoder = &lt;span style="color:#0000ff"&gt;new&lt;/span&gt;();&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">如果需要，设置两个可选参数：</span></span></p>
<div id="premain449624" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre449624"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; Error correction&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; error correction low (7%)&lt;/em&gt;&lt;/span&gt;
Encoder.ErrorCorrection = ErrorCorrection.L;

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; or, error correction medium (15%) The Default&lt;/em&gt;&lt;/span&gt;
Encoder.ErrorCorrection = ErrorCorrection.M;

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; or, error correction quarter (25%)&lt;/em&gt;&lt;/span&gt;
Encoder.ErrorCorrection = ErrorCorrection.Q;

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; or, error correction high (30%)&lt;/em&gt;&lt;/span&gt;
Encoder.ErrorCorrection = ErrorCorrection.H;

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; ECI Assignment Value (default is -1 not used)&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; The ECI value is a number in the range of 0 to 999999.&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; or -1 if it is not used&lt;/em&gt;&lt;/span&gt;
Encoder.ECIAssignValue = -1;&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">更高的纠错百分比为您提供更好的保护，防止损坏的 QR 码图像。成本是增加的 QR 符号的大小。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">调用以下四种<code>Encode</code>方法之一：</span></span></p>
<div id="premain725020" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre725020"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; single text string input&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;void&lt;/span&gt; Encode(&lt;span style="color:#0000ff"&gt;string&lt;/span&gt; StringDataSegment);

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; multiple text strings input&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;void&lt;/span&gt; Encode(string[] StringDataSegments);

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; single byte array input&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;void&lt;/span&gt; Encode(byte[] ByteDataSegment);

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; multiple byte arrays input&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;void&lt;/span&gt; Encode(byte[][] ByteDataSegments);&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">如果输入数据是文本字符串或文本字符串数组。文本将使用以下方法转换为字节数组。</span></span></p>
<div id="premain501435" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre501435"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; the encoder converts text string to byte array&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; using the conversion method&lt;/em&gt;&lt;/span&gt;
byte[] ByteArray = Encoding.UTF8.GetBytes(Text);&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">实际上，库软件会将第一种和第二种<code>Encode</code>方法分别转换为第三种和第四种方法。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">将<code>QRCodeEncoderLibrary</code>扫描每个传入数据字节数组段以确定最佳编码方法。该程序不会尝试断开单个段以最小化 QR 码矩阵的大小。您可以以利用长字符串数字或字母数字数据的方式提交段数组。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">该<code>Encode</code>方法返回一个<code>bool[,]</code>布尔元素数组的方阵。返回的二维 bool 数组也可作为类的公共成员<code>QRCodeMatrix</code>使用<code>QREncode</code>。每个元素将黑色模块表示为<code>true</code>，将白色模块表示为<code>false</code>。矩阵维度在 public member 中给出<code>QRCodeDimension</code>。如果编码失败，将抛出异常。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">下一步是将二维码符号保存到文件中，或者创建一个<code>Bitmap</code>. 以下示例显示如何将其保存<code>QRCodeMatrix</code>为 PNG 图像文件。将二维码图像保存为 PNG 文件不需要使用<code>Bitmap</code>类，适用于 net-core 和 net-standard。PNG 图像文件比<code>Bitmap</code>.<code>QRSaveBitmapImage</code></span></span></p>
<div id="premain208563" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre208563"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; save image as png file&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; create save PNG image class &lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; and load the QR Code matrix &lt;/em&gt;&lt;/span&gt;
QRSavePngImage PngImage = &lt;span style="color:#0000ff"&gt;new&lt;/span&gt;(QRCodeMatrix);

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; set the module size in pixels&lt;/em&gt;&lt;/span&gt;
PngImage.ModuleSize = ModuleSize;

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; set the quiet zone in pixels&lt;/em&gt;&lt;/span&gt;
PngImage.QuietZone = QuietZone;

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; save the QR Code PNG image to file name&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; or to open file stream&lt;/em&gt;&lt;/span&gt;
PngImage.SaveQRCodeToPngFile(Dialog.FileName);&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;"><code>Bitmap</code>使用类保存二维码。<code>Bitmap</code>类允许您选择文件格式。</span></span></p>
<div id="premain126532" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre126532"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; save image as any file format supported by Bitmap class.&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; create image class for the QR Code matrix &lt;/em&gt;&lt;/span&gt;
QRSaveBitmapImage Image = &lt;span style="color:#0000ff"&gt;new&lt;/span&gt;(QRCodeMatrix);

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; set the module size in pixels&lt;/em&gt;&lt;/span&gt;
Image.ModuleSize = ModuleSize;

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; set the quiet zone in pixels&lt;/em&gt;&lt;/span&gt;
Image.QuietZone = QuietZone;

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; save the QR Code image to file name&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; or to open file stream&lt;/em&gt;&lt;/span&gt;
Image.SaveQRCodeToBitmapFile(Dialog.FileName, ImageFormat);&lt;/span&gt;&lt;/span&gt;</code></pre>
<h2 style="margin-left:0;"><span style="color:#ff9900;"><span style="background-color:#ffffff;">使用命令行类创建 PNG 图像文件。</span></span></h2>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">下面列出了命令行参数。参数设置编码选项。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">命令行参数格式：</span></span></p>
<ul style="margin-left:0;"><li>命令行：exefile [可选参数] input-file output-file</li><li>输出文件必须具有<em>.png</em>扩展名</li><li>选项格式 /code:value 或 -code:value (: 可以是 =)</li><li>纠错级别。代码=[错误|e]，值=低|l|中|m|季|q|高|h]，默认=m</li><li>模块尺寸。代码=[模块|m]，值=[1-100]，默认值=2</li><li>安静区域。代码=[安静|q]，值=[4-400]，默认=8，最小=4*宽度</li><li>ECI 赋值：code=[value|v], value=[0-999999]，默认为无ECI值。</li><li>文本文件格式。code=[text|t] 见下面的注释。</li><li>除非指定了文本文件选项，否则输入文件是二进制文件如果输入文件格式是文本或 t，则字符串将被编码为字节数组。</li></ul>
<h2 style="margin-left:0;"><span style="color:#ff9900;"><span style="background-color:#ffffff;">二维码编码器演示</span></span></h2>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">QR Code Encoder Demo 是一个测试程序，展示了如何对 QR 码进行编码并将其保存为图像文件。</span></span></p>
<ul style="margin-left:0;"><li>选择纠错级别。</li><li>设置 ECI 分配值或将其留空。</li><li>在数据框中输入文本。您可以使用竖线<code>|</code>字符将<code>string</code>数字、字母数字和一般文本分段。</li><li>按编码。将显示二维码。</li><li>将<code>QRCodeMatrix</code>被创建。</li><li>按<strong>保存图像</strong>按钮或<strong>复制到剪贴板</strong>按钮。</li><li>如果按下复制到剪贴板，模块宽度为 2、静区为 8 的 QR 图像将被加载到剪贴板。</li><li>如果按保存图像，将显示<strong>保存二维码图像</strong>对话框。</li><li>设置模块大小。</li><li>设置静区。</li><li>设置图像格式（压缩 PNG 不需要）。</li><li>按四个<strong>保存</strong>按钮之一。</li><li>按<strong>Save Compressed PNG</strong>以不使用位图的 PNG 格式保存图像。</li><li>或者，按<strong>位图图像</strong>。</li><li>或者，按<strong>Save Special</strong>。将显示保存特殊屏幕。此选项用于创建用于解码测试的图像文件。<strong>保存 QR 码图像</strong>屏幕允许您将 QR 码图像保存在画笔或图像背景上。您可以旋转二维码或将其显示为好像它是由相机拍摄的，以产生透视图。您可以在图像上随机添加圆形点。</li><li>或者，按复制到剪贴板。此按钮将创建具有指定模块大小和静区大小的图像。</li></ul>
<p></p>
<div style="margin-left:0;">
<em><strong><span style="color:#111111;"><span style="background-color:#ffffff;">二维码编码器演示</span></span></strong></em>
</div>
<p class="img-center"><img alt="" src="image\03579eb0721d94062c77cbe4afbbb5ff.png"/></p>
<div style="margin-left:0;">
<em><strong><span style="color:#111111;"><span style="background-color:#ffffff;">二维码保存对话框</span></span></strong></em>
</div>
<p class="img-center"><img alt="" src="image\369f91baac95898c605fefdcd07229d9.png"/></p>
<div style="margin-left:0;">
<em><strong><span style="color:#111111;"><span style="background-color:#ffffff;">保存特殊二维码图片</span></span></strong></em>
</div>
<h2 style="margin-left:0;"><span style="color:#ff9900;"><span style="background-color:#ffffff;">二维码解码</span></span></h2>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">将<code>QRDecoder</code>包含 QR 码符号的图像文件或位图转换为<code>QRCodeResult</code>. 每个结果项包含 QR 码数据字节数组和 ECI 分配值。要解码包含一个或多个 QR 码图像的图像文件，请执行以下步骤。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">创建<code>QRDecoder</code>对象。这个对象是可重复使用的。如果你想解码一些图像，只需重用这个对象。没有初始化或处置要求。</span></span></p>
<div id="premain553659" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre553659"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; create QR Code decoder object&lt;/em&gt;&lt;/span&gt;
QRDecoder Decoder = &lt;span style="color:#0000ff"&gt;new&lt;/span&gt; QRDecoder();

&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; call image decoder method with file name&lt;/em&gt;&lt;/span&gt;
QRCodeResult[] ResultArray = Decoder.ImageDecoder(FileName)&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">每个成功解码的 QRCode 符号都会返回一个<code>QRCodeResult</code>元素。在大多数情况下，它将是一个包含一个元素的数组。结果定义如下。<code>DataArray</code>代表二维码的内容。但是，在某些情况下，您可能对其他成员感兴趣。如果返回值为<code>null</code>，则表示未检测到二维码。</span></span></p>
<div id="premain391814" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre391814"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; QR Code result &lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;class&lt;/span&gt; QRCodeResult
    {
    &lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; QR Code Data array&lt;/em&gt;&lt;/span&gt;
    &lt;span style="color:#0000ff"&gt;public&lt;/span&gt; byte[] DataArray;

    &lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; ECI Assignment Value&lt;/em&gt;&lt;/span&gt;
    &lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;int&lt;/span&gt; ECIAssignValue;

    &lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; the next members are for information only&lt;/em&gt;&lt;/span&gt;
    &lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; QR Code matrix version&lt;/em&gt;&lt;/span&gt;
    &lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;int&lt;/span&gt; QRCodeVersion;

    &lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; QR Code matrix dimension in bits&lt;/em&gt;&lt;/span&gt;
    &lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;int&lt;/span&gt; QRCodeDimension;

    &lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; QR Code error correction code (L, M, Q, H)&lt;/em&gt;&lt;/span&gt;
    &lt;span style="color:#0000ff"&gt;public&lt;/span&gt; ErrorCorrection ErrorCorrection;
    }&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">要将数据字节数组转换<code>QRCodeResult.DataArray</code>为文本，请<code>string</code>使用：</span></span></p>
<div id="premain552848" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre552848"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; convert binary result to text string&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#0000ff"&gt;string&lt;/span&gt; TextResult = QRCode.ByteArrayToStr(ResultArray[Index].DataArray);&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">该<code>ByteArrayToStr</code>方法将字节数组转换<code>string</code>为以下方式：</span></span></p>
<div id="premain800680" style="margin-left:0;">
<div style="margin-left:0;"></div>
</div>
<pre class="has" id="pre800680"><code class="language-lang-csharp">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; The QRDecoder converts byte array to text string &lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#008000"&gt;&lt;em&gt;//&lt;/em&gt;&lt;/span&gt;&lt;span style="color:#008000"&gt;&lt;em&gt; using this conversion&lt;/em&gt;&lt;/span&gt;
&lt;span style="color:#0000ff"&gt;public&lt;/span&gt; &lt;span style="color:#0000ff"&gt;static&lt;/span&gt; &lt;span style="color:#0000ff"&gt;string&lt;/span&gt; ByteArrayToStr(byte[] DataArray)
	{
	Decoder = Encoding.UTF8.GetDecoder();
	&lt;span style="color:#0000ff"&gt;int&lt;/span&gt; CharCount = Decoder.GetCharCount(DataArray, &lt;span style="color:#000080"&gt;0&lt;/span&gt;, DataArray.Length);
	char[] CharArray = &lt;span style="color:#0000ff"&gt;new&lt;/span&gt; char[CharCount];
	Decoder.GetChars(DataArray, &lt;span style="color:#000080"&gt;0&lt;/span&gt;, DataArray.Length, CharArray, &lt;span style="color:#000080"&gt;0&lt;/span&gt;);
	&lt;span style="color:#0000ff"&gt;return&lt;/span&gt; &lt;span style="color:#0000ff"&gt;new&lt;/span&gt; &lt;span style="color:#0000ff"&gt;string&lt;/span&gt;(CharArray);
	}&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">例如，下图是两个 QR 码一个内一个。大一数据是：大二维码，小一数据是：小二维码。大的将纠错设置为高。该程序将找到两个 QR 码并使用纠错恢复大的缺失区域以获得正确的内容。</span></span></p>
<p class="img-center"><img alt="" src="image\7c4da557027daf87f9b2b2df15efd716.png"/></p>
<div id="premain476016" style="margin-left:0;">
<div style="margin-left:0;"></div>
<div style="margin-left:0;">
<span style="background-color:#fbedbb;"><span style="color:#999999;"><span style="color:#999999;">复制代码</span></span></span>
</div>
</div>
<pre class="has" id="pre476016"><code class="language-notranslate">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;QR Code 1
Big QR Code
QR Code 2
Small QR Code&lt;/span&gt;&lt;/span&gt;</code></pre>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">三个二维码的另一个例子。解码器在图片中找到 9 个查找器。测试所有可能的 9 个查找器中的 3 个。结果是三组三个查找器测试有效的二维码结构。结果如下图所示。</span></span></p>
<p class="img-center"><img alt="" src="image\0986575fb44bafca677e8481f3a02365.png"/></p>
<div id="premain556923" style="margin-left:0;">
<div style="margin-left:0;"></div>
<div style="margin-left:0;">
<span style="background-color:#fbedbb;"><span style="color:#999999;"><span style="color:#999999;">复制代码</span></span></span>
</div>
</div>
<pre class="has" id="pre556923"><code class="language-notranslate">&lt;span style="color:#000000"&gt;&lt;span style="background-color:#fbedbb"&gt;QR Code 1
Top left corner
QR Code 2
Top right corner
QR Code 3
Bottom left corner&lt;/span&gt;&lt;/span&gt;</code></pre>
<h2 style="margin-left:0;"><span style="color:#ff9900;"><span style="background-color:#ffffff;">二维码解码器演示</span></span></h2>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">QR Code Decoder Demo 是一个测试程序，展示如何扫描图像文件或视频图像以获取 QR 码。接下来，它将展示如何将解码后的数据转换为文本<code>string</code>。视频解码器是一个测试/演示应用程序，它将使用系统中第一个找到的网络摄像头。一个结合了二维码解码器和摄像机图像捕获的演示程序。摄像机软件基于 Direct Show Library。</span></span></p>
<p></p>
<ul style="margin-left:0;"><li>单击图像文件按钮或摄像机按钮。</li><li>对于图像文件，将显示一个打开文件对话框。</li><li>将显示图像。</li><li>对于视频，请将您的二维码放在相机前面。</li><li>如果解码成功，解码数据区会显示结果。</li><li>如果解码不成功，Decoded data 区域将为空白。</li><li>如果图像包含多个二维码，解码数据将显示所有二维码的结果。</li></ul>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">供您参考，视频捕获使用了在 CodeProject.com 和<a href="https://github.com/free5lot/Camera_Net" title="Github上发布的">Github上发布的</a><a href="https://www.codeproject.com/Articles/671407/Camera_Net-Library" title="Camera_Net 项目">Camera_Net 项目</a>的一些源模块。该项目基于<a href="http://sourceforge.net/projects/directshownet/" title="DirectShowLib。">DirectShowLib。</a>. 请注意，这个项目中是原始源模块的修改子集。<code>DirectShowLib</code></span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">请注意，我只在我自己的摄像机上测试过这个应用程序。我的相机是罗技高清网络摄像头 C615。我正在使用 640 x 480 像素的帧大小。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">该程序设置相机软件在屏幕的预览区域显示视频流。扫描速度为每秒 5 帧。每个帧都被捕获并测试一个 QR 码。找到 QR 码后，结果将显示在解码数据文本框中。如果解码的数据是 URI，则启用“转到 URI”按钮，您可以在默认 Web 浏览器上显示此 URI。</span></span></p>
<p><span style="color:#111111;"><span style="background-color:#ffffff;">为了使视频解码成功，每个 QR 码模块必须由几个摄像头像素表示。例如，4 x 4 或更多像素。QR 码必须相当清晰、平坦且与相机平行。下图说明了该软件将图像转换为正方形的功能，其中取景器符号位于正确的位置。</span></span></p>
<p></p>
</div>
</div>
</div>
</div>