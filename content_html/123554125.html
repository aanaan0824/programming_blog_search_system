<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3>文章目录</h3>
<ul><li><a href="#1_nodejs_1">1. 初识node.js与内置模块</a></li><li><ul><li><ul><li><a href="#11__2">1.1 回顾与思考</a></li><li><a href="#12_Nodejs_21">1.2 Node.js简介</a></li><li><a href="#13Nodejs_35">1.3Node.js环境的安装</a></li><li><a href="#14NodejsJS_40">1.4在Node.js环境中执行JS代码</a></li></ul>
</li></ul>
</li><li><a href="#2fs_48">2.fs文件系统模块</a></li><li><ul><li><ul><li><a href="#21_49">2.1什么是文件系统模块</a></li><li><a href="#22_52">2.2读取指定文件中的内容</a></li><li><a href="#23_92">2.3向指定的文件中写入内容</a></li><li><a href="#_107">案例：考试成绩整理</a></li><li><a href="#24_151">2.4路径问题</a></li></ul>
</li></ul>
</li><li><a href="#3_path_153">3 path路径模块</a></li><li><ul><li><ul><li><a href="#31_pathjoin_160">3.1 path.join()语法格式</a></li><li><a href="#32_pathbasename_169">3.2 path.basename（）</a></li><li><a href="#33_pathextname_180">3.3 path.extname()</a></li><li><a href="#_189">案例：时钟</a></li></ul>
</li></ul>
</li><li><a href="#4http_205">4.http模块</a></li><li><ul><li><ul><li><a href="#41__206">4.1 基础概念</a></li><li><a href="#42_web_218">4.2 创建最基本的web服务器</a></li><li><a href="#43_req_247">4.3 req请求对象</a></li><li><a href="#44_res_261">4.4 res响应对象</a></li><li><a href="#45_272">4.5解决中文乱码问题</a></li><li><a href="#46urlhtml_284">4.6根据不同的url响应不同的html内容</a></li></ul>
</li></ul>
</li><li><a href="#5_301">5.模块化</a></li><li><ul><li><ul><li><a href="#51__302">5.1 模块化的基本概念</a></li><li><a href="#52Nodejs_310">5.2Node.js中的模块化</a></li><li><a href="#53_npm_331">5.3 npm与包</a></li><li><ul><li><ul><li><ul><li><a href="#_332">包的基本概念</a></li><li><a href="#_337">格式化时间的高级做法</a></li><li><a href="#_351">在项目中安装包的命令</a></li><li><a href="#_375">包管理配置文件</a></li><li><a href="#_403">解决下包速度慢的问题</a></li><li><a href="#_423">包的分类</a></li><li><a href="#_453">开发属于自己的包</a></li></ul>
</li></ul>
</li></ul>
</li><li><a href="#54__458">5.4 模块的加载机制</a></li></ul>
</li></ul>
</li><li><a href="#6express_476">6.express</a></li><li><ul><li><ul><li><a href="#61express_477">6.1express简介</a></li><li><a href="#62_Express_501">6.2 Express的基本使用</a></li><li><ul><li><ul><li><ul><li><a href="#GET_502">监听GET请求</a></li><li><a href="#POST_512">监听POST请求</a></li><li><a href="#_522">把内容响应给客户端</a></li><li><a href="#URL_535">获取URL中携带的查询参数</a></li><li><a href="#URL_550">获取URL的动态参数</a></li></ul>
</li></ul>
</li></ul>
</li><li><a href="#63__597">6.3 托管静态资源</a></li><li><a href="#64_nodemon_602">6.4 nodemon</a></li></ul>
</li></ul>
</li><li><a href="#7express__611">7.express 路由</a></li><li><ul><li><ul><li><a href="#71__612">7.1 路由的概念</a></li><li><a href="#72__657">7.2 路由的使用</a></li></ul>
</li></ul>
</li><li><a href="#8_express_721">8 express中间件</a></li><li><ul><li><ul><li><a href="#81_Express_722">8.1 Express中间件的概念</a></li><li><a href="#82__727">8.2 中间件的初体验</a></li><li><ul><li><ul><li><ul><li><a href="#_728">定义中间件函数</a></li><li><a href="#_738">全局生效的中间件函数</a></li><li><a href="#_745">定义全局中间件的简化形式</a></li><li><a href="#_790">中间件的作用</a></li><li><a href="#_818">定义多个全局中间件</a></li><li><a href="#_846">局部生效的中间件</a></li><li><a href="#_875">定义多个局部中间件</a></li><li><a href="#_908">了解中间件的注意事项</a></li></ul>
</li></ul>
</li></ul>
</li><li><a href="#83__910">8.3 中间件的分类</a></li><li><a href="#84__1002">8.4 自定义中间件</a></li><li><ul><li><ul><li><ul><li><a href="#_1004">定义中间件</a></li><li><a href="#reqdata_1012">监听req的data事件</a></li><li><a href="#reqend_1014">监听req的end事件</a></li><li><a href="#querystring_1016">使用querystring模块解析请求体数据</a></li><li><a href="#reqbody_1018">将解析出来的数据对象挂载为req.body</a></li><li><a href="#_1061">将自定义中间件封装为模块</a></li></ul>
</li></ul>
</li></ul>
</li></ul>
</li></ul>
</li><li><a href="#9express_1087">9.使用express写接口</a></li><li><ul><li><ul><li><a href="#91__1088">9.1 创建基本的服务器</a></li><li><a href="#92_API_1103">9.2 创建API路由模块</a></li><li><a href="#93GET_1107">9.3编写GET接口</a></li><li><a href="#94_Post_1110">9.4 编写Post接口</a></li><li><a href="#95CORS_1113">9.5CORS跨域</a></li><li><a href="#96_JSONP_1133">9.6 JSONP接口</a></li></ul>
</li></ul>
</li></ul>
</div>
<p></p>
<h1><a id="1_nodejs_1"></a>1. 初识node.js与内置模块</h1>
<h3><a id="11__2"></a>1.1 回顾与思考</h3>
<p><strong>浏览器中的javaScript的组成部分</strong></p>
<ul><li>JS核心语法</li><li>webAPI</li></ul>
<p><strong>为什么JavaScript可以再浏览器中被执行？</strong><br/> 待执行的JS代码<br/> JS解析引擎<br/> 不同的浏览器使用不同的JS解析引擎<br/> <strong>为什么JS可以操作DOM还有BOM?</strong><br/> 每个浏览器中内置了DOM，BOM这样的API函数，因此浏览器中的javaScript才可以调用它们<br/> <strong>浏览器中JS的运行环境</strong><br/> 运行环境是指代码正常运行所需要的必要环境<br/> Chrome浏览器运行环境：<br/> V8引擎和内置API函数</p>
<ul><li>v8引擎负责解析和执行js代码</li><li>内置API是由运行环境提供的特殊接口，只能在所属的运行环境中被调用<br/> ** js能否做后端开发？**</li></ul>
<h3><a id="12_Nodejs_21"></a>1.2 Node.js简介</h3>
<p><strong>1.什么是Node.js?</strong><br/> Node.js是一个基于Chrome V8引擎的JS运行环境<br/> <strong>2.Node.js中的JS运行环境</strong><br/> V8引擎和内置API函数</p>
<ul><li>浏览器是JS的前端运行环境</li><li>Node.js是Js的后端运行环境</li><li>Node.js中无法调用DOM和BOM等浏览器内置API</li></ul>
<p><strong>3. Node.js可以做什么？</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2c665c24cbef42ef8fdc99a193bff463.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p><strong>4. Node.js学习路径</strong><br/> JS基础语法- Node.js内置API模块（fs,path,http）-第三方API模块(express,mysql)</p>
<h3><a id="13Nodejs_35"></a>1.3Node.js环境的安装</h3>
<p><strong>什么是终端？</strong><br/> 终端是专门为开发人员设计的，用于实现人机交互的一种方式<br/> 1.windows+R<br/> 2.输入cmd</p>
<h3><a id="14NodejsJS_40"></a>1.4在Node.js环境中执行JS代码</h3>
<p>1.打开终端<br/> 直接在地址栏敲cmd，可以使cmd切换到当下文件的地址<br/> 还可以在当前目录下的空白处按住shift键，右键打开powerShell<br/> 2.输入node 要执行的js文件的路径<br/> node 空格 文件名<br/> <strong>终端中的快捷键</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6f0c92c5c60141f984f892695dc297a7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h1><a id="2fs_48"></a>2.fs文件系统模块</h1>
<h3><a id="21_49"></a>2.1什么是文件系统模块</h3>
<p>fs模块是Node.js官方提供的、用来操作文件的模块，它提供了一系列的方法和属性，用来满足用户对文件的操作需求<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b73df2122835405f93f6044e9625e5df.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="22_52"></a>2.2读取指定文件中的内容</h3>
<p>fs.readFile()的语法格式<br/> 使用fs.readFile()方法，可以读取指定文件中的内容，语法格式如下：</p>
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span>options<span class="token punctuation">]</span><span class="token punctuation">,</span>callback<span class="token punctuation">)</span>
</code></pre>
<ul><li>参数1：必选参数，字符串，表示文件的路径</li><li>参数2：可选参数，表示以什么编码格式来读取文件</li><li>参数3：必选参数，文件读取完成后，通过回调函数拿到读取的结果。</li></ul>
<pre><code class="prism language-javascript"><span class="token comment">// 1.导入fs模块,来操作文件</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 2.调用fs.readFile()方法读取文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./file/1.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> dataStr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 打印失败的结果，如果读取成功，则err的值为null</span>
    <span class="token comment">// 如果读取失败，则err的值为错误对象，dataStr的值为undefined</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token comment">// 打印成功的结果</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dataStr<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>判断文件是否读取成功</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">// 1.导入fs模块,来操作文件</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 2.调用fs.readFile()方法读取文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./file/1.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> dataStr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 打印失败的结果，如果读取成功，则err的值为null</span>
    <span class="token comment">// 如果读取失败，则err的值为错误对象，dataStr的值为undefined</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件失败'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件成功'</span> <span class="token operator">+</span> dataStr<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="23_92"></a>2.3向指定的文件中写入内容</h3>
<p>fs.writeFile()的语法格式<br/> 使用该方法，可以向指定的文件中写入内容，语法格式如下</p>
<pre><code class="prism language-javascript">fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre>
<ul><li>参数1：必选参数，字符串，表示文件的存放路径</li><li>参数2：必选参数，表示要写入的内容</li><li>参数3：可选参数，表示以什么编码格式来读取文件，默认值是utf8</li><li>参数4：必选参数，文件写入完成后的回调函数。</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8d2103da10ac454d9f3e612ef1a3cb11.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>判断文件是否读取成功</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1c96dfccc84c4510b639987d839b2b9d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="_107"></a>案例：考试成绩整理</h3>
<p>核心实现步骤</p>
<ul><li>导入需要的fs文件系统模块</li><li>使用fs.readFile()方法，读取素材目录下的成绩.txt文件</li><li>判断文件是否读取失败</li><li>文件读取成功后，处理成绩数据</li><li>将处理完成的成绩数据，调用fs.writeFile()方法，写入到新文件中<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/84bece3ef89c42ffb9ea2598c3514ff1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></li></ul>
<pre><code class="prism language-javascript"><span class="token comment">// 导入fs模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 2.调用fs.readFile()方法读取文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./file/2.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> dataStr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 打印失败的结果，如果读取成功，则err的值为null</span>
    <span class="token comment">// 如果读取失败，则err的值为错误对象，dataStr的值为undefined</span>
    <span class="token comment">// 3.判断文件是否读取成功</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件失败'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件成功'</span> <span class="token operator">+</span> dataStr<span class="token punctuation">)</span>


    <span class="token comment">// 4.1先把成绩的数据，按照空格进行分割</span>
    <span class="token keyword">const</span> arrOld <span class="token operator">=</span> dataStr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
    <span class="token comment">// 4.2循环分割后的数组，对每一项的数据，进行字符串的替换操作</span>
    <span class="token keyword">const</span> arrNew <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    arrOld<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        arrNew<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrNew<span class="token punctuation">)</span>
    <span class="token comment">// 4.3把新数组中的每一项，进行合并，得到新的字符串</span>
    <span class="token keyword">const</span> newStr <span class="token operator">=</span> arrNew<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n\r'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newStr<span class="token punctuation">)</span>
    <span class="token comment">// 5.调用fs.writeFile()方法，把处理完毕的成绩，写入到新文件中</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./file/成绩ok.txt'</span><span class="token punctuation">,</span> newStr<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入文件失败！'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入文件成功！'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h3><a id="24_151"></a>2.4路径问题</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/769f9b7fec7f44149a239cd759e1b52b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h1><a id="3_path_153"></a>3 path路径模块</h1>
<p>path模块是Node.js官方提供的，用来处理路径的模块，它提供一系列的方法和属性，用来满足用户对于路径的处理需求<br/> 如果要在JS代码中，使用path模块来处理路径，则需要使用以下的方式先导入它</p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="31_pathjoin_160"></a>3.1 path.join()语法格式</h3>
<p>使用path.join方法，可以把多个路径片段拼接为较为完整的路径字符串</p>
<pre><code class="prism language-javascript">path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>paths<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>注意：今后凡是涉及路径拼接的操作，都是使用path.join()方法进行处理，不要直接使用+进行字符串的拼接<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f1d0fb4a2e37423baa863beb1a636811.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="32_pathbasename_169"></a>3.2 path.basename（）</h3>
<p>使用该方法可以获取路径中的最后一部分，经常通过这个方法获取路径中的文件名，语法格式如下</p>
<pre><code class="prism language-javascript">path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span>ext<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p>参数：path:必选参数，表示一个路径的字符串<br/> ext可选参数，表示文件拓展名<br/> 返回：表示路径中的最后一部分<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0062bb23a4cb43139b6799ea360d75a6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="33_pathextname_180"></a>3.3 path.extname()</h3>
<p>使用该方法可以获取路径中的拓展名部分，语法格式如下</p>
<pre><code class="prism language-javascript">path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
</code></pre>
<p>path:必选参数，表示一个路径的字符串<br/> 返回：返回得到的拓展名字符串<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d5eb1e11c1fe467cb0edafab2e96b92f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="_189"></a>案例：时钟</h3>
<pre><code class="prism language-javascript"><span class="token comment">// 1.1 导入需要的模块并创建正则表达式</span>
<span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 1.2导入path路径处理模块</span>
<span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// 1.3匹配标签</span>
<span class="token comment">// 其中\s表示空白字符，\S表示非空白字符，*表示匹配任意次</span>
<span class="token keyword">const</span> regStyle<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;style&gt;[\s\S]*&lt;\style&gt;</span><span class="token regex-delimiter">/</span></span>
<span class="token comment">// 1.4匹配&lt;stript&gt;&lt;/stript&gt;标签的正则</span>
<span class="token keyword">const</span> regScript<span class="token operator">=</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;script&gt;[\s\S]*&lt;script&gt;</span><span class="token regex-delimiter">/</span></span>
</code></pre>
<p><strong>注意</strong><br/> 1.fs.write()方法只能用来创建文件，不能用来创建路径<br/> 2.重复调用fs.writeFile()只能写入同一个文件，新写入的内容会覆盖之前的旧内容</p>
<h1><a id="4http_205"></a>4.http模块</h1>
<h3><a id="41__206"></a>4.1 基础概念</h3>
<p>什么是客户端，什么是服务器？<br/> 在网络节点中，负责消费资源的电脑，叫做客户端。<br/> 负责对外提供网络资源的电脑，叫做服务器。<br/> Http模块是Node.js官方提供的，用来创建web服务器的模块。通过http模块提供的Http.createServer()方法，就能方便的把一台普通电脑，变成一台web服务器，从而对外提供Web资源服务。</p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/241eb69384f2414ba57ec5fa3edaf526.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/17d2d3eeb0b2400684fdbb320b3e95b9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/194086598a8e4a8d9502e24c235840ff.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/aceef08928ed4e5f8a50b365a2950b1a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="42_web_218"></a>4.2 创建最基本的web服务器</h3>
<p><strong>1.导入Http模块</strong></p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>2.创建web服务器实例</strong></p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> server<span class="token operator">=</span>http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>3.为服务器实例绑定request事件，监听客户端的请求</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">//使用服务器实例的.on()方法，为服务器绑定一个request事件</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//只要有客户端来请求我们自己的服务器，就会触发request事件，从而调用这个事件处理函数</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'someone visit our web server.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>4.启动服务器</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">//调用server.listen(端口号，cb回调）方法，即可启动web服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="43_req_247"></a>4.3 req请求对象</h3>
<p>只要服务器接收到了客户端的请求，就会调用server.on（）为服务器绑定的request事件处理函数<br/> 如果想在事件处理函数中，访问与客户端相关的数据或属性，可以使用如下的方式：</p>
<pre><code class="prism language-javascript">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//req是请求对象，它包含了与客户端相关的数据和属性，例如：</span>
<span class="token comment">//req.url是客户端相关的数据和属性，例如：</span>
<span class="token comment">//req.url是客户端请求的url地址</span>
<span class="token comment">//req.method 是客户端的method请求类型</span>
<span class="token keyword">const</span> str<span class="token operator">=</span><span class="token string">'Your request url is ${req.url},and request method is ${req.method}'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">}</span>）
</code></pre>
<h3><a id="44_res_261"></a>4.4 res响应对象</h3>
<pre><code class="prism language-javascript">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//res是响应对象，它包含了与服务器相关的数据和属性，例如：</span>
<span class="token comment">//要发送到客户端的字符串</span>
<span class="token keyword">const</span> str<span class="token operator">=</span><span class="token string">'Your request url is ${req.url},and request method is ${req.method}'</span>
<span class="token comment">//res.end()方法的调用：</span>
<span class="token comment">//向客户端发送指定内容，并结束这次请求的处理过程</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">}</span>）
</code></pre>
<h3><a id="45_272"></a>4.5解决中文乱码问题</h3>
<p>当调用res.end()方法，向客户端发送中文内容的时候，会出现乱码问题，此时，需要手动设置内容的编码格式</p>
<pre><code class="prism language-javascript">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//发送的内容包含中文</span>
conststr<span class="token operator">=</span><span class="token string">'您请求的url地址是${req.url},请求的method类型是${req.method}'</span>
<span class="token comment">//为了防止中文显示乱码的问题，需要设置响应头</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span>
<span class="token comment">//把包含中文的内容，响应给客户端</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="46urlhtml_284"></a>4.6根据不同的url响应不同的html内容</h3>
<pre><code class="prism language-javascript">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">const</span> url <span class="token operator">=</span>req<span class="token punctuation">.</span>url <span class="token comment">//1.获取请求的Url地址</span>
<span class="token keyword">let</span> content <span class="token operator">=</span><span class="token string">'&lt;h1&gt;404 Not found!&lt;/h1&gt;'</span><span class="token comment">//2.设置默认的内容</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>url<span class="token operator">==</span><span class="token string">'/'</span><span class="token operator">||</span>url <span class="token operator">===</span><span class="token string">'/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
content<span class="token operator">=</span><span class="token string">'&lt;h1&gt;首页&lt;/h1&gt;'</span><span class="token comment">//3.用户请求的是首页</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>url<span class="token operator">===</span><span class="token string">'/about.html'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
content<span class="token operator">=</span><span class="token string">'&lt;h1&gt;关于页面&lt;/h1&gt;'</span>
<span class="token punctuation">}</span>
<span class="token comment">//为了防止中文显示乱码的问题，需要设置响应头</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/html;charset=utf-8'</span><span class="token punctuation">)</span>
<span class="token comment">//把包含中文的内容，响应给客户端</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h1><a id="5_301"></a>5.模块化</h1>
<h3><a id="51__302"></a>5.1 模块化的基本概念</h3>
<p><strong>什么是模块化？</strong><br/> 模块化是指解决一个复杂问题时，自顶向下逐层把系统划分为若干模块的过程。对于整个系统来说，模块是可组合、分解和变换的单元<br/> 编程领域中的模块化：就是遵守固定的规则，把一个大文件拆成独立并且互相依赖的多个小模块。<br/> <strong>模块化规范</strong><br/> 就是对代码进行模块化的拆分与组合时，需要遵守的规则<br/> 使用什么样的语法格式来引用模块<br/> 在模块中使用什么样的语法格式向外暴露成员</p>
<h3><a id="52Nodejs_310"></a>5.2Node.js中的模块化</h3>
<p>根据模块来源的不同，将模块分为了三大类，分别是：<br/> 内置模块（fs，path，http）<br/> 自定义模块（用户创建的每个Js文件）<br/> 第三方模块（由第三方开发出来的模块）<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/59780a8656b145459a199b93fb12fa00.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>什么是模块作用域？</strong><br/> 和函数作用域类似，在自定义模块中定义的变量、方法等成员，只能在当前模块内被访问，这种模块级别的访问限制，叫做模块作用域<br/> 防止了全局变量污染的问题<br/> <strong>向外共享模块作用域中的成员</strong><br/> <strong>module对象</strong>：在每个·.js自定义模块中都有一个module对象，它里面存储了和当前模块有关的信息<br/> module.export对象<br/> 可以使用该对象将模块内的成员共享出去，供外界使用。外界用require方法导入自定义模块时，得到的就是Module.exports所指的对象<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e6f727025db240f5963d133cd64cb5b1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>exports对象</strong><br/> 由于module.exports单词写起来比较复杂，为了简化向外共享成员的代码，Node提供了exports对象。默认情况下，exports和module.exports指向同一个对象，最终共享的结果，还是以module.exports指向的结果为准<br/> <strong>exports和module.exports的使用误区</strong></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/149930fbe6a74880a16049ea6f5eba9c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>模块化规范</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4a550c1db0c1455092b81b16c564c2ef.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="53_npm_331"></a>5.3 npm与包</h3>
<h6><a id="_332"></a>包的基本概念</h6>
<p>Node.js中的第三方模块又叫做包<br/> 从哪里搜索包：<a href="https://www.npmjs.com/">全球最大的包共享平台</a><br/> 从哪里下载包：<a href="https://registry.npmjs.org/">下载包的服务器</a><br/> 如何下载包？npm包管理工具</p>
<h6><a id="_337"></a>格式化时间的高级做法</h6>
<p>1.使用npm包管理工具，在项目中安装格式化时间的包moment<br/> 2.使用require()导入格式化时间的包<br/> 3.参考Moment的官方API文档对时间进行格式化</p>
<pre><code class="prism language-javascript"><span class="token comment">//1.导入Moment包,注意导入的名称，就是装包时候的名称</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span><span class="token comment">//注意是字符串node 6    </span>

<span class="token keyword">const</span> dt <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span>

</code></pre>
<h6><a id="_351"></a>在项目中安装包的命令</h6>
<pre><code class="prism language-javascript">npm install 包的完整名称
</code></pre>
<p>简写形式</p>
<pre><code class="prism language-javascript">npm i 包的完整名称
</code></pre>
<p><strong>注意点</strong><br/> 1.初次装包完成后，在项目文件夹下多一个叫做node_modules的文件夹和package-lock.json的配置文件，其中node_modules文件夹用来存放所有已安装到项目中的包。require（）导入第三方包时，就是从这个目录中查找并加载包<br/> package-lock.json配置文件用来记录node_modules目录下的每一个包的下载信息，例如包的版本号，下载地址等<br/> 2.安装指定版本的包：<br/> 默认情况下，会自定安装最新版本的包，如果需要安装指定版本的包，可以在包名之后，通过@符号指定具体的版本</p>
<pre><code class="prism language-javascript">npm i moment@<span class="token number">2.22</span><span class="token number">.2</span>
</code></pre>
<p>3.包的语义化版本规范<br/> 包的版本号是以“点分十进制”形式进行定义的，总共有三位数字，例如2.24.0<br/> 其中每一位数字所代表的含义如下：第一位:大版本<br/> 第二位：功能版本 第三位：bug修复版本<br/> 只要前面的版本号增长了，则后面的版本号归零</p>
<h6><a id="_375"></a>包管理配置文件</h6>
<p>1.多人协作的问题：第三方的包的体积过大，不方便成员之间共享项目源代码<br/> 解决方案：共享时剔除node_modules<br/> 2.在项目根目录中，创建一个叫做package.json的配置文件，即可用来记录在项目中安装了哪些包，从而方便剔除node_modules目录之后，在团队成员之间共享项目的源代码<br/> 今后在项目开发中，一定要把Node_modules文件夹，添加到.gitignore忽略文件夹中<br/> 3.npm包管理工具提供了一个快捷命令，可以在执行命令时所处的目录中，快速创建package.json这个包管理配置文件：</p>
<pre><code class="prism language-javascript">npm init <span class="token operator">-</span>y
</code></pre>
<p>上述命令只能在英文的目录下运行成功！所以项目文件夹的名称一定要使用英文命名，不能出现空格。运行npm install命令安装包的时候，npm包管理工具，会自动把包的名称和版本号，记录到package.json中<br/> 4.一次性安装所有包<br/> 可以运行npm install命令，一次性安装所有安装所有的依赖包</p>
<pre><code class="prism language-javascript"><span class="token comment">//执行npm install 命令时，npm 包管理工具会先读取package.json中的dependencies节点</span>
<span class="token comment">//读取到记录的所有依赖包名称和版本号之后，包管理工具会把这些包一次性的下载到项目中去</span>
npm install 
</code></pre>
<p>5.卸载包<br/> 可以npm uninstall</p>
<pre><code class="prism language-javascript"><span class="token comment">//使用npm uninstall 具体的包名 来卸载包</span>
npm uninstall moment
</code></pre>
<p>注意 npm uninstall命令执行成功后，会把卸载的包，自动从package.json的dependencies中移除掉<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4db4079f45374693937ff837414af39c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h6><a id="_403"></a>解决下包速度慢的问题</h6>
<p>淘宝NPM镜像服务器<br/> 镜像：是一种文件存储形式每一个磁盘上的数据在另一个磁盘上存在完全相同的副本即为镜像<br/> 切换npm的下包镜像源。下包的镜像源，指的就是下包的服务器地址</p>
<pre><code class="prism language-javascript">npm config <span class="token keyword">get</span> registry
npm config <span class="token keyword">set</span> registry<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">registry.npm.taobao.org</span><span class="token regex-delimiter">/</span></span>
</code></pre>
<p><strong>nrm</strong><br/> 为了更方便的切换下包镜像源，我们可以安装nrm这个小工具，利用nrm提供的终端命令，可以快速查看和切换下包的镜像源</p>
<pre><code class="prism language-javascript"><span class="token comment">//通过npm包管理工具，将nrm安装为全局可用的工具</span>
npm i nrm <span class="token operator">-</span>g
<span class="token comment">//查看所有能用的镜像原</span>
nrm ls
<span class="token comment">//将下包的镜像原切换为taobao镜像</span>
nrm use taobao
</code></pre>
<h6><a id="_423"></a>包的分类</h6>
<p>项目包：那些被安装到项目的node_modules目录中的包，都是项目包<br/> 项目包又分为两类，分别是开发依赖包和核心依赖包</p>
<pre><code class="prism language-javascript">npm i 包名<span class="token operator">-</span><span class="token constant">D</span> <span class="token comment">//开发依赖包（会被记录到devDependencies节点下）</span>
npm i 包名<span class="token comment">//核心依赖包（会被记录到）</span>
</code></pre>
<p>1.全局包<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3ac73d1ba2604c2098732e219eff5af5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-javascript">npm i包名<span class="token operator">-</span>g <span class="token comment">//全局安装指定的包</span>
npm uninstall 包名<span class="token operator">-</span>g<span class="token comment">//卸载全局安装的包</span>
</code></pre>
<p>注意：只要工具性质的包，才有全局安装的必要性，因为它们提供了很好的终端命令<br/> 判断某个包是否需要全局安装后才能使用，可以参考官方提供的使用说明即可<br/> 2.i5ting_toc<br/> i5ting_toc是一个可以把md文档转为Html页面的小工具，使用步骤如下</p>
<pre><code class="prism language-javascript"><span class="token comment">//将i5ting_toc安装为全局包</span>
npm install <span class="token operator">-</span>g i5ting_toc
<span class="token comment">//调用,轻松实现md转换为html的功能</span>
i5ting_toc <span class="token operator">-</span>f 要转换的md文件路径 <span class="token operator">-</span>o

</code></pre>
<p>3.规范的包结构<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/00171b5472eb4362a6d0b9703db64620.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h6><a id="_453"></a>开发属于自己的包</h6>
<p>1.需要实现的功能<br/> 格式化日期<br/> 转义Html中的特殊字符<br/> 还原html中的特殊字符</p>
<h3><a id="54__458"></a>5.4 模块的加载机制</h3>
<p><strong>优先从缓存中加载</strong><br/> 模块在第一次被加载后会被缓存。这也意味着多次调用require()不会导致模块的代码被多次执行。注意：不论是内置模块，自定义模块，还是第三方模块，它们都会优先从缓存中加载，从而提高模块的加载效率。<br/> <strong>内置模块的加载机制</strong><br/> 内置模块加载优先级最高。<br/> <strong>自定义模块的加载机制</strong><br/> 使用require（）加载自定义模块时，必须指定以./或…/开头的路径标识符。在加载自定义模块时，如果没有指定的话，则node模块就会把他当成内置模块或者第三方模块进行加载<br/> 同时，在使用require（）导入自定义模块时，如果省略了文件的拓展名，则node.js就会按顺序分别尝试加载以下的文件<br/> 1.按照确切的文件名进行加载<br/> 2.补全.js拓展名进行加载<br/> 3.补全.json拓展名进行加载<br/> 4.补全.node拓展名进行加载<br/> 5.加载失败，终端报错<br/> <strong>第三方模块的加载机制</strong><br/> 如果传递给require()的模块标识符不是一个内置模块，也没有./等等开题，则Node.js会从当前模块的父目录开始，尝试从.node_modules文件夹中加载第三方模块。如果没有找到第三方模块，则移动到再上一层父目录中，进行加载，直到文件系统的根目录<br/> <strong>目录作为模块</strong></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ad4d8c6e147e46beb897635569c7563d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h1><a id="6express_476"></a>6.express</h1>
<h3><a id="61express_477"></a>6.1express简介</h3>
<p>Express是基于Node.js平台，快速，开放，极简的Web开发框架<br/> 思考：不使用Express能否创建Web服务器？<br/> 能，使用Node.js提供原生的http模块即可<br/> 但是http内置模块用起来很复杂，Express是基于内置的http模块进一步封装起来的，能够极大的提高开发效率<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4823c992274140778e69fe0d87722e60.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>express的安装</strong><br/> 在项目所处的目录中，运行如下的终端命令，即可将express安装到项目中使用：</p>
<pre><code class="prism language-javascript">npm i express@<span class="token number">4.17</span><span class="token number">.1</span>
</code></pre>
<p><strong>使用express创建最基本的服务器</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">//1.导入express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">//2.创建web服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//3.启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="62_Express_501"></a>6.2 Express的基本使用</h3>
<h6><a id="GET_502"></a>监听GET请求</h6>
<p>通过app.get()方法，可以监听客户端的GET请求，具体的语法格式如下:</p>
<pre><code class="prism language-javascript"><span class="token comment">//参数1：客户端请求的url地址</span>
<span class="token comment">//参数2：请求对应的处理函数</span>
<span class="token comment">//req：请求对象（包含了与请求属性相关的属性与方法）</span>
<span class="token comment">//res:响应对象（包含了与响应对象相关的属性与方法）</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'请求url'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">/*处理函数*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h6><a id="POST_512"></a>监听POST请求</h6>
<p>通过app.post()方法，可以监听客户端的POST请求，具体的语法格式如下:</p>
<pre><code class="prism language-javascript"><span class="token comment">//参数1：客户端请求的url地址</span>
<span class="token comment">//参数2：请求对应的处理函数</span>
<span class="token comment">//req：请求对象（包含了与请求属性相关的属性与方法）</span>
<span class="token comment">//res:响应对象（包含了与响应对象相关的属性与方法）</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'请求url'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">/*处理函数*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h6><a id="_522"></a>把内容响应给客户端</h6>
<p>通过res.send()方法，可以把处理好的内容，发送给客户端</p>
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//向客户发送json请求</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'zs'</span><span class="token punctuation">,</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token literal-property property">gender</span><span class="token operator">:</span><span class="token string">'男'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//向客户端发送文本内容</span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求帮助'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h6><a id="URL_535"></a>获取URL中携带的查询参数</h6>
<p>通过req.query对象，可以访问到客户端通过查询字符串的形式，发送到服务器的参数：</p>
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//通过req.query可以获取到客户端发送过来的查询参数</span>
    <span class="token comment">//注意：在默认情况下，req.query是一个空对象</span>
    <span class="token comment">//客户端使用？name=zs&amp;age=20这种查询字符串形式，发送到服务器参数</span>
    <span class="token comment">//可以通过req.query对象访问到，例如：</span>
    <span class="token comment">//req.query.name req.query.age</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h6><a id="URL_550"></a>获取URL的动态参数</h6>
<p>通过req.params对象，可以访问到Url中，通过：匹配到的动态参数</p>
<pre><code class="prism language-javascript"><span class="token comment">//url地址中，我们开业通过：参数名的形式，匹配动态参数值</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'user/:id'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//req.params默认是一个空对象</span>
<span class="token comment">//里面存放这通过：动态匹配到的参数值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>汇总</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">//1.导入express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express/lib/response'</span><span class="token punctuation">)</span>
<span class="token comment">//2.创建web服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//4.监听客户端的GET和POST请求，并向客户端响应具体的内容</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//调用express提高的res.send()方法，向客户端响应一个json对象</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zs'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token literal-property property">gender</span><span class="token operator">:</span> <span class="token string">'男'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//调用express提供的res.send()方法，向客户端响应一个文本字符串</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'请求成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//通过req.query可以获取到客户端发送过来的查询参数</span>
    <span class="token comment">//注意：在默认情况下，req.query是一个空对象</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//url地址中，我们开业通过：参数名的形式，匹配动态参数值</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//req.params默认是一个空对象</span>
    <span class="token comment">//里面存放这通过：动态匹配到的参数值</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//3.启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h3><a id="63__597"></a>6.3 托管静态资源</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/07b59941bc434e9f8476c22edd8924ec.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/070b83668ded465d8849f76254f82de3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/beab4c45fb5f4010989faef5f8d694e4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="64_nodemon_602"></a>6.4 nodemon</h3>
<p>当基于Node.js编写了一个网站应用的时候，传统的方式，是运行node.app.js命令，来启动项目。这样做的坏处是：当代码被修改之后，需要手动重启项目。<br/> 现在，我们可以node命令替换为nodemon命令，使用nodemon app.js来启动项目，这样做的好处是：代码被修改之后，会被nodemon监听到，从而实现自动重启项目的效果</p>
<pre><code class="prism language-javascript">node app<span class="token punctuation">.</span>js
<span class="token comment">//将上面的终端命令，替换为下面的终端命令，即可实现自动重启项目的效果</span>
nodemon app<span class="token punctuation">.</span>js
</code></pre>
<h1><a id="7express__611"></a>7.express 路由</h1>
<h3><a id="71__612"></a>7.1 路由的概念</h3>
<p>广义上来讲，路由就是映射关系<br/> 在Express中，路由指的是客户端请求与服务器处理函数之间的映射关系<br/> Express中的路由分三部分组成，分别是请求的类型，请求的URL地址，处理函数。格式如下：</p>
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">(</span><span class="token constant">PATH</span><span class="token punctuation">,</span><span class="token constant">HANDLER</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>express中路由的例子</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">//匹配GET请求，且请求URL为/</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//匹配post请求，且请求URL为/</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Got a POST request'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>路由的匹配过程</strong><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/796b3116f35148b9a16980620976cb90.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p><strong>路由的使用</strong><br/> 在express中使用路由最简单的方式，就是把路由器挂载到APP上，示例代码如下</p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">//创建web服务器，命名为app</span>
<span class="token keyword">const</span> app<span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//挂载路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Post Request.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1'</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h3><a id="72__657"></a>7.2 路由的使用</h3>
<p>模块化路由：为了方便对路由进行模块化的管理，Express不建议将路由直接挂载到app上，而是推荐将路由抽离为单独的模块。将路由抽离为单独模块的步骤如下：<br/> 1.创建路由模块对应的.js文件<br/> 2.调用express.Router()函数创建路由对象<br/> 3.向路由对象挂载具体的路由<br/> 4.使用module.exports向外共享路由对象<br/> 5.使用app.use()函数注册路由模块</p>
<p><strong>创建路由模块</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">// 这是路由模块</span>
<span class="token comment">// 1. 导入 express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 创建路由对象</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 3. 挂载具体的路由</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/list'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Get user list.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//获取挂载用户列表的路由</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user/add'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Add new user.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//获取添加用户的路由</span>
<span class="token comment">// 4. 向外导出路由对象</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router

</code></pre>
<p><strong>注册路由模块</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">// 1. 导入路由模块</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./03.router'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 注册路由模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>
</code></pre>
<p><strong>为路由模块添加前缀</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">// 1. 导入路由模块</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./03.router'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 注册路由模块，使用app.use()注册路由模块，并添加统一的访问前缀/api</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> userrouter<span class="token punctuation">)</span>
</code></pre>
<p><strong>全部代码</strong></p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// app.use('/files', express.static('./files'))</span>

<span class="token comment">// 1. 导入路由模块</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./03.router'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 注册路由模块</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span>

<span class="token comment">// 注意： app.use() 函数的作用，就是来注册全局中间件</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h1><a id="8_express_721"></a>8 express中间件</h1>
<h3><a id="81_Express_722"></a>8.1 Express中间件的概念</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c80087426d714e40b11d8da110b8b514.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2fd719e246b5452b889ea105a3b4e0c6.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6c4648c896244810bebbcd12bd72dc1d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="82__727"></a>8.2 中间件的初体验</h3>
<h6><a id="_728"></a>定义中间件函数</h6>
<pre><code class="prism language-javascript"><span class="token comment">//常量mv所指向的，就是一个中间价函数</span>
<span class="token keyword">const</span> mv<span class="token operator">=</span><span class="token function">funcntion</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是一个最简单的中间件函数'</span><span class="token punctuation">)</span>
<span class="token comment">//注意：在当前中间价的业务处理完毕后，必须调用next()函数</span>
<span class="token comment">//表示把流转关系交给下一个中间价或路由器</span>
<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h6><a id="_738"></a>全局生效的中间件函数</h6>
<p>客户端发起的任何请求，到达服务器之后，都会触发的中间件，叫做全局生效的中间价。通过调用app.use(中间件函数），即可定义一个全局生效的中间价，示例代码如下：</p>
<pre><code class="prism language-javascript"><span class="token comment">//全局生效的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>mv<span class="token punctuation">)</span>
</code></pre>
<h6><a id="_745"></a>定义全局中间件的简化形式</h6>
<pre><code class="prism language-javascript"><span class="token comment">// 这是定义全局中间件的简化形式</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是最简单的中间件函数'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>全部代码</strong></p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// // 定义一个最简单的中间件函数</span>
<span class="token comment">// const mw = function (req, res, next) {<!-- --></span>
<span class="token comment">//   console.log('这是最简单的中间件函数')</span>
<span class="token comment">//   // 把流转关系，转交给下一个中间件或路由</span>
<span class="token comment">//   next()</span>
<span class="token comment">// }</span>

<span class="token comment">// // 将 mw 注册为全局生效的中间件</span>
<span class="token comment">// app.use(mw)</span>

<span class="token comment">// 这是定义全局中间件的简化形式</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'这是最简单的中间件函数'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了 / 这个路由'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Home page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了 /user 这个路由'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'User page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h6><a id="_790"></a>中间件的作用</h6>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0a873d0147df44b79e88d3222bc9d967.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 这是定义全局中间件的简化形式</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 获取到请求到达服务器的时间</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 为 req 对象，挂载自定义属性，从而把时间共享给后面的所有路由</span>
  req<span class="token punctuation">.</span>startTime <span class="token operator">=</span> time
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Home page.'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'User page.'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>startTime<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h6><a id="_818"></a>定义多个全局中间件</h6>
<p>可以使用app.use()连续定义多个全局中间件，客户端请求到达服务器之后，会按照中间件定义的先后顺序依次进行调用，示例代码如下</p>
<pre><code class="prism language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 定义第一个全局中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了第1个全局中间件'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 定义第二个全局中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了第2个全局中间件'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 定义一个路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'User page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h6><a id="_846"></a>局部生效的中间件</h6>
<p>不使用app.use()定义的中间件，叫做局部生效的中间件</p>
<pre><code class="prism language-javascript"><span class="token comment">// 导入 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 express 的服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 1. 定义中间件函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了局部生效的中间件'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 创建路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> mw1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Home page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'User page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h6><a id="_875"></a>定义多个局部中间件</h6>
<p>可以在路由中，通过如下两种等价的方式，使用多个局部中间件</p>
<pre><code class="prism language-javascript"><span class="token comment">// 导入 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 express 的服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 1. 定义中间件函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">mw1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了第一个局部生效的中间件'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mw2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'调用了第二个局部生效的中间件'</span><span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 创建路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>mw1<span class="token punctuation">,</span> mw2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Home page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'User page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h6><a id="_908"></a>了解中间件的注意事项</h6>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3586b30d6fa14f91a95e964cef261f55.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="83__910"></a>8.3 中间件的分类</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0e15d46c50ff448baf87501c6bf806ae.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/67bf7b9d3a1d456fb0d261f8dc4ff88b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ee4b3591b8fd49879859512514639461.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/60f5f5d5335a491999052a14b4a94331.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-javascript"><span class="token comment">// 导入 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 express 的服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 1. 定义路由</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 1.1 人为的制造错误</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'服务器内部发生了错误！'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Home page.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 2. 定义错误级别的中间件，捕获整个项目的异常错误，从而防止程序的崩溃</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发生了错误！'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error：'</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<p>错误级别的中间件，放到所有路由之后</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/bba31aa3ee5b4cae9325c92141aeed0d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-javascript"><span class="token comment">// 导入 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 express 的服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 注意：除了错误级别的中间件，其他的中间件，必须在路由之前进行配置</span>
<span class="token comment">// 通过 express.json() 这个中间件，解析表单中的 JSON 格式的数据</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 通过 express.urlencoded() 这个中间件，来解析 表单中的 url-encoded 格式的数据</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 在服务器，可以使用 req.body 这个属性，来接收客户端发送过来的请求体数据</span>
  <span class="token comment">// 默认情况下，如果不配置解析表单数据的中间件，则 req.body 默认等于 undefined</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/book'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 在服务器端，可以通过 req,body 来获取 JSON 格式的表单数据和 url-encoded 格式的数据</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/039cc555cea14654b37229ca6119390e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-javascript"><span class="token comment">// 导入 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 express 的服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 1. 导入解析表单数据的中间件 body-parser</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 使用 app.use() 注册中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// app.use(express.urlencoded({ extended: false }))</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 如果没有配置任何解析表单数据的中间件，则 req.body 默认等于 undefined</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h3><a id="84__1002"></a>8.4 自定义中间件</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8ea36314dd574529b90df38f797858ab.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h6><a id="_1004"></a>定义中间件</h6>
<p>使用app.use()来定义全局生效的中间件，代码如下</p>
<pre><code class="prism language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 定义中间件具体的业务逻辑</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h6><a id="reqdata_1012"></a>监听req的data事件</h6>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/524f0a735c8748e5bccab7fb26afef52.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h6><a id="reqend_1014"></a>监听req的end事件</h6>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a974941afa954e7f950821527b6ed6eb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h6><a id="querystring_1016"></a>使用querystring模块解析请求体数据</h6>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e7ab04c13e6449fb8edaccd1d1da0852.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h6><a id="reqbody_1018"></a>将解析出来的数据对象挂载为req.body</h6>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c590cd8c6e5d486b857e33cddd1118e3.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>完整代码</strong></p>
<pre><code class="prism language-javascript"><span class="token comment">// 导入 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 express 的服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 导入 Node.js 内置的 querystring 模块</span>
<span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>

<span class="token comment">// 这是解析表单数据的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 定义中间件具体的业务逻辑</span>
  <span class="token comment">// 1. 定义一个 str 字符串，专门用来存储客户端发送过来的请求体数据</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token comment">// 2. 监听 req 的 data 事件</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    str <span class="token operator">+=</span> chunk
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 3. 监听 req 的 end 事件</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 在 str 中存放的是完整的请求体数据</span>
    <span class="token comment">// console.log(str)</span>
    <span class="token comment">// TODO: 把字符串格式的请求体数据，解析成对象格式</span>
    <span class="token keyword">const</span> body <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
    req<span class="token punctuation">.</span>body <span class="token operator">=</span> body
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h6><a id="_1061"></a>将自定义中间件封装为模块</h6>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c9774594300c46e49aca9aace739494f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<pre><code class="prism language-javascript"><span class="token comment">// 导入 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 express 的服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 1. 导入自己封装的中间件模块</span>
<span class="token keyword">const</span> customBodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./14.custom-body-parser'</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 将自定义的中间件函数，注册为全局可用的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>customBodyParser<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 调用 app.listen 方法，指定端口号并启动web服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Express server running at http://127.0.0.1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h1><a id="9express_1087"></a>9.使用express写接口</h1>
<h3><a id="91__1088"></a>9.1 创建基本的服务器</h3>
<pre><code class="prism language-go"><span class="token comment">// 导入 express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token char">'express'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建服务器实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment">// 启动服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'express server running at http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>'<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre>
<h3><a id="92_API_1103"></a>9.2 创建API路由模块</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c2e1d0e8764841a0ba79d29b231aa2ae.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="93GET_1107"></a>9.3编写GET接口</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1574eaf1facc4fcab7b881d205a0df70.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="94_Post_1110"></a>9.4 编写Post接口</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/76ebc1fd17f44f1c9320fd89c5463b3c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="95CORS_1113"></a>9.5CORS跨域</h3>
<p>接口的跨域问题：刚才编写的GET和POST请求，存在一个很严重的问题：不支持跨域请求。<br/> 解决接口跨域问题的方案主要有两种：<br/> 1.CORS（主流的方案，推荐使用）<br/> 2.JSONP（有缺陷的解决方案:只支持GET请求）<br/> 使用cors中间件解决跨域问题<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/18e9f597be6d41d8acf63e5a8e304c20.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/cc905583841e4b57a0da612479f89ced.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c4718cda398d4dc689125533b1f6fce1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/80e8c04f07184aa1a8ca0263b197480b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8c61948c27bf44c491464a0ceccaa9f2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/88ea7d13a7274b5a8785bae31206f2dd.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ca1a93acc3a14aa0adb57b8fa732e765.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <strong>CORS请求的分类</strong><br/> 客户端在请求CORS接口时，根据请求方式和请求头的不同，可以将CORS的请求分为两大类，分别是：<br/> 1.简单请求<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/aaa0199abc3346679ed42c51069d8d52.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<p>2.预检请求<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f029e14ec80d4bdbb7deaefb751ed368.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
<h3><a id="96_JSONP_1133"></a>9.6 JSONP接口</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/806622a3db1f48f2ac61a12fa0757abb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/045c808f184f43beb72ea75f60103d13.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/659196004d7347029dffaa005ed41088.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2be6ca408cd343d4993ad508f2ec1477.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/cb10b9e867b94877a443c1574fe43329.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2hlcnJ5IOayiA==,size_20,color_FFFFFF,t_70,g_se,x_16"/></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>