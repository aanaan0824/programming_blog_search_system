<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h3><a id="_netframeworknetcore50_0"></a>一 .netframework程序迁移到.netcore5.0</h3>
<p>对于.netframwork程序想要升级为.netcore5.0的方法,微软官方也给出了方法见 <a href="https://docs.microsoft.com/en-us/dotnet/desktop/winforms/migration/?view=netdesktop-5.0">https://docs.microsoft.com/en-us/dotnet/desktop/winforms/migration/?view=netdesktop-5.0</a>,我这里总结记录一下.</p>
<h3><a id="1_2"></a>1.首先要检查自己应用程序适不适合迁移</h3>
<p>.netframework框架和.netcore框架有很大的不同,首先得确保自己当前基于.netframework程序迁移到.netcore上要改变哪些东西。下载迁移分析工具<strong>NET Portability Analyzer</strong> ,这个可以到visual Studio的<strong>管理扩展</strong>中进行下载,这个分析工具的作用就是告诉我们,从当前版本升级到.netcore5.0版本,你的程序需要改变的库或者是<strong>Nuget</strong>包,因为升级后.netcore程序可能不支持以前的的<strong>Nuget</strong>包或者库.<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8d5a83cf370343aeb0521bf818036ea8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> 安装完成后,先要进行迁移框架的选择,比如我先迁移到.netcore5.0上面去<br/> <img alt="选择" src="https://img-blog.csdnimg.cn/8b4f866fa0824bcdab742d9947d45fba.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/91b434203dba4281b18fd87bb46f4164.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> 开始对工程开始进行升级前分析<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4bc05a8b98b4472281859d6597d840a4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> 分析完成后会有生成的报告结果<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/527db2603c144a1f81a0d25f75f3a33f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> 分析和解释分析报告<br/> Portability Summary<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/728da580e3924e2db5988f363e1ffa2a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> Details(分析细节部分)<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/dd4bcfd0d23342bab778d9ac258354d5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> 细节分析罗列了在目标框架下会确实的API函数</p>
<ul><li>Target type: 目标平台下缺失的API</li><li>Target member:目标平台下缺失的方法</li><li>Assembly name:.NET Framework下存在已经缺失的API</li></ul>
<p>Missing Assemblies(缺失的程序集)<br/> 比如我这里的EntityFramework.dll,这个程序集只支持.netframework4.8的,在.netcore5.0下面是不受支持的,所以报告中会显示出这一项,但是在net5.0下可以用Microsoft.EntityFrameworkCore<br/> 下替换,因此还是可以进行迁移。<img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d7d25a8991bf443fbf211d19601b0127.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<h3><a id="2csproj_26"></a>2.修改项目的工程文件(.csproj)</h3>
<p>net5使用sdk风格的项目文件,不会加载net Framework使用的Visual Studio项目文件,因此需要修改工程文件.</p>
<h4><a id="21_28"></a>2.1首先,在解决方案中要迁移的工程项目进行卸载,然后对项目文件进行编辑</h4>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5f8f4a4abd5a4b9a8f65c2d2d95c16a7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/318b575c38bd482aa2d8fbae5704c7b2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5byg5Lqi,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/> 把项目文件中的内容都剪切到别的地方(之后还有用)</p>
<h4><a id="2_34"></a>2.复制以下文件到项目文件中</h4>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Project</span> <span class="token attr-name">Sdk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Microsoft.NET.Sdk<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OutputType</span><span class="token punctuation">&gt;</span></span>WinExe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>OutputType</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetFramework</span><span class="token punctuation">&gt;</span></span>net5.0-windows<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetFramework</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UseWindowsForms</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UseWindowsForms</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GenerateAssemblyInfo</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GenerateAssemblyInfo</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Project</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>上述的<strong>XML</strong>文件给出了工程文件project的基本结构,但是他并没有包含旧工程文件中的工程名相关的信息,因此需要拷贝旧工程文件下的<strong>RootNamespace</strong>和<strong>AssemblyName</strong>所在标签中的行的内容(比如我这里面的SqlDemo工程)</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Project</span> <span class="token attr-name">Sdk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Microsoft.NET.Sdk<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OutputType</span><span class="token punctuation">&gt;</span></span>WinExe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>OutputType</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetFramework</span><span class="token punctuation">&gt;</span></span>net5.0-windows<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetFramework</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UseWindowsForms</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UseWindowsForms</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GenerateAssemblyInfo</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GenerateAssemblyInfo</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--工程名相关的信息--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RootNamespace</span><span class="token punctuation">&gt;</span></span>SqlDemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RootNamespace</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AssemblyName</span><span class="token punctuation">&gt;</span></span>SqlDemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AssemblyName</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Project</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h4><a id="3__ItemGroup____ProjectReference__or__PackageReference______PropertyGroup_____ItemGroup__PropertyGroup__project___name__61"></a>3.复制旧工程中 <strong>&lt; ItemGroup &gt;</strong> 下包含 <strong>&lt; ProjectReference &gt;</strong> or <strong>&lt; PackageReference &gt;</strong> 到 <strong>&lt; PropertyGroup &gt;</strong> 到新工程的下的 <strong>&lt; ItemGroup &gt;</strong>(位于&lt; PropertyGroup &gt;后面),并且可以移除旧版本中的&lt; <strong>project</strong> &gt;和 &lt; <strong>name</strong> &gt;标签</h4>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Project</span> <span class="token attr-name">Sdk</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Microsoft.NET.Sdk<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OutputType</span><span class="token punctuation">&gt;</span></span>WinExe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>OutputType</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetFramework</span><span class="token punctuation">&gt;</span></span>net5.0-windows<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetFramework</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>UseWindowsForms</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>UseWindowsForms</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GenerateAssemblyInfo</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GenerateAssemblyInfo</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--工程名相关的信息--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RootNamespace</span><span class="token punctuation">&gt;</span></span>SqlDemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RootNamespace</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AssemblyName</span><span class="token punctuation">&gt;</span></span>SqlDemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AssemblyName</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">&gt;</span></span>
  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
       <span class="token comment">&lt;!--包含另外一个工程的路径,移除旧版本中的&lt;project&gt;和&lt;name&gt;标签--&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProjectReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>..\SqlDataSetLib\SqlDataSetLib.csproj<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--引用的Nuget包名或者某个外部程序集以及填写版本号,不支持的程序集不要引进来--&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Microsoft.EntityFrameworkCore<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Version</span><span class="token punctuation">&gt;</span></span>3.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Version</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PackageReference</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Project</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h4><a id="4_89"></a>4.复制旧版本中的资源和设置项标签</h4>
<p>旧版本中如果有设置项的资源,如下面所示的这样,直接把<strong>include</strong>改为<strong>Update</strong>加入到新工程中</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--设置文件--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>None</span> <span class="token attr-name">Update</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Properties\Settings.settings<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Generator</span><span class="token punctuation">&gt;</span></span>SettingsSingleFileGenerator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Generator</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LastGenOutput</span><span class="token punctuation">&gt;</span></span>Settings.Designer.cs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LastGenOutput</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>None</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Compile</span> <span class="token attr-name">Update</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Properties\Settings.Designer.cs<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AutoGen</span><span class="token punctuation">&gt;</span></span>True<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AutoGen</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DependentUpon</span><span class="token punctuation">&gt;</span></span>Settings.settings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DependentUpon</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DesignTimeSharedInput</span><span class="token punctuation">&gt;</span></span>True<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DesignTimeSharedInput</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Compile</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>复制资源文件,同理,把资源文件的<strong>include</strong>替换成<strong>Update</strong>即可</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EmbeddedResource</span> <span class="token attr-name">Update</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Properties\Resources.resx<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Generator</span><span class="token punctuation">&gt;</span></span>ResXFileCodeGenerator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Generator</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LastGenOutput</span><span class="token punctuation">&gt;</span></span>Resources.Designer.cs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LastGenOutput</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EmbeddedResource</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Compile</span> <span class="token attr-name">Update</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Properties\Resources.Designer.cs<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AutoGen</span><span class="token punctuation">&gt;</span></span>True<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AutoGen</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DependentUpon</span><span class="token punctuation">&gt;</span></span>Resources.resx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DependentUpon</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DesignTime</span><span class="token punctuation">&gt;</span></span>True<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DesignTime</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Compile</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>最后把保存编辑的.csproj文件,然后点击重新加载项目,即可迁移到.net5.0.</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>