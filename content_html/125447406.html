<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atelier-sulphurpool-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<ul><li> <h2><a id="nacos_0"></a>nacos服务注册</h2>
<ul><li> <p>安装统一接入层<br/> composer require hyperf/service-governance</p> </li><li> <p>安装nacos<br/> composer require hyperf/service-governance-nacos</p> </li><li> <p>配置文件(组件由 config/autoload/services.php 配置文件来驱动)</p> <pre><code class="prism language-php">		<span class="token keyword">return</span> <span class="token punctuation">[</span>
				    <span class="token string single-quoted-string">'enable'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
				        <span class="token comment">// 开启服务发现</span>
				        <span class="token string single-quoted-string">'discovery'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
				        <span class="token comment">// 开启服务注册</span>
				        <span class="token string single-quoted-string">'register'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
				    <span class="token punctuation">]</span><span class="token punctuation">,</span>
				    <span class="token comment">// 服务消费者相关配置</span>
				    <span class="token string single-quoted-string">'consumers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				    <span class="token comment">// 服务提供者相关配置</span>
				    <span class="token string single-quoted-string">'providers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				    <span class="token comment">// 服务驱动相关配置</span>
				    <span class="token string single-quoted-string">'drivers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
				        <span class="token string single-quoted-string">'consul'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
				            <span class="token string single-quoted-string">'uri'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'http://127.0.0.1:8500'</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'token'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'check'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
				                <span class="token string single-quoted-string">'deregister_critical_service_after'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'90m'</span><span class="token punctuation">,</span>
				                <span class="token string single-quoted-string">'interval'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'1s'</span><span class="token punctuation">,</span>
				            <span class="token punctuation">]</span><span class="token punctuation">,</span>
				        <span class="token punctuation">]</span><span class="token punctuation">,</span>
				        <span class="token string single-quoted-string">'nacos'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
				            <span class="token comment">// nacos server url like https://nacos.hyperf.io, Priority is higher than host:port</span>
				            <span class="token comment">// 'url' =&gt; '',</span>
				            <span class="token comment">// The nacos host info</span>
				            <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">8848</span><span class="token punctuation">,</span>
				            <span class="token comment">// The nacos account info</span>
				            <span class="token string single-quoted-string">'username'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'password'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'guzzle'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
				                <span class="token string single-quoted-string">'config'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
				            <span class="token punctuation">]</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'group_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'api'</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'namespace_id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'namespace_id'</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'heartbeat'</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span>
				            <span class="token string single-quoted-string">'ephemeral'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否注册临时实例</span>
				        <span class="token punctuation">]</span><span class="token punctuation">,</span>
				    <span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> </li></ul> </li><li> <h2><a id="nacos_49"></a>nacos配置中心</h2>
<ul><li>配置中心统一接入层<br/> composer require hyperf/config-center</li><li>Nacos 安装<br/> composer require hyperf/config-nacos</li><li>配置中心 (config目录下config_center.php)<pre><code class="prism language-php">	<span class="token string single-quoted-string">'drivers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
			<span class="token string single-quoted-string">'nacos'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=&gt;</span> <span class="token class-name class-name-fully-qualified static-context">Hyperf<span class="token punctuation">\</span>ConfigNacos<span class="token punctuation">\</span>NacosDriver</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
            <span class="token comment">// 配置合并方式，支持覆盖和合并</span>
            <span class="token string single-quoted-string">'merge_mode'</span> <span class="token operator">=&gt;</span> <span class="token class-name class-name-fully-qualified static-context">Hyperf<span class="token punctuation">\</span>ConfigNacos<span class="token punctuation">\</span>Constants</span><span class="token operator">::</span><span class="token constant">CONFIG_MERGE_OVERWRITE</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'interval'</span> <span class="token operator">=&gt;</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token comment">// 如果对应的映射 key 没有设置，则使用默认的 key</span>
            <span class="token string single-quoted-string">'default_key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'nacos_config'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'listener_config'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token comment">// dataId, group, tenant, type, content</span>
                <span class="token comment">// 映射后的配置 KEY =&gt; Nacos 中实际的配置</span>
                <span class="token string single-quoted-string">'nacos_config'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'tenant'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'tenant'</span><span class="token punctuation">,</span> <span class="token comment">// corresponding with service.namespaceId</span>
                    <span class="token string single-quoted-string">'data_id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'hyperf-service-config'</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'group'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'DEFAULT_GROUP'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'nacos_config.data'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'data_id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'hyperf-service-config-yml'</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'group'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'DEFAULT_GROUP'</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'yml'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span>
</code></pre> </li><li>nacos配置和hyperf调用 
    <ul><li><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/bf20552d52f94d6ca7bb3c51a69c474a.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f80dab22bca74817898ef493ff61dcf0.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/278c97166e6a46ccaedf2ad0e2eb85be.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8242355f050644f788571c6d6460e2bb.png"/></li></ul> </li></ul> </li><li> <h2><a id="json_rpc_85"></a>json_rpc调用</h2>
<ul><li> <p>安装<br/> composer require hyperf/json-rpc<br/> composer require hyperf/rpc-server(JSON RPC 服务端)<br/> composer require hyperf/rpc-client(JSON RPC 客户端)</p> </li><li> <p>服务提供者</p> <pre><code class="prism language-php">		<span class="token operator">&lt;</span><span class="token operator">?</span>php
		
		<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>JsonRpc</span><span class="token punctuation">;</span>
		
		<span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>RpcServer<span class="token punctuation">\</span>Annotation<span class="token punctuation">\</span>RpcService</span><span class="token punctuation">;</span>
		
		<span class="token comment">/**
		 * 注意，如希望通过服务中心来管理服务，需在注解内增加 publishTo 属性
		 */</span>
		<span class="token attribute"><span class="token delimiter punctuation">#[</span><span class="token attribute-content"><span class="token attribute-class-name class-name">RpcService</span><span class="token punctuation">(</span><span class="token attribute-class-name class-name">name</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"CalculatorService"</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">protocol</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"jsonrpc-http"</span><span class="token punctuation">,</span> <span class="token attribute-class-name class-name">server</span><span class="token punctuation">:</span> <span class="token string double-quoted-string">"jsonrpc-http"</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">]</span></span>
		<span class="token keyword">class</span> <span class="token class-name-definition class-name">CalculatorService</span> <span class="token keyword">implements</span> <span class="token class-name">CalculatorServiceInterface</span>
		<span class="token punctuation">{<!-- --></span>
		    <span class="token comment">// 实现一个加法方法，这里简单的认为参数都是 int 类型</span>
		    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span>
		    <span class="token punctuation">{<!-- --></span>
		        <span class="token comment">// 这里是服务方法的具体实现</span>
		        <span class="token keyword">return</span> <span class="token variable">$a</span> <span class="token operator">+</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		
		<span class="token operator">&lt;</span><span class="token operator">?</span>php
		
		<span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Server<span class="token punctuation">\</span>Server</span><span class="token punctuation">;</span>
		<span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>Server<span class="token punctuation">\</span>Event</span><span class="token punctuation">;</span>
		
		<span class="token keyword">return</span> <span class="token punctuation">[</span>
		    <span class="token comment">// 这里省略了该文件的其它配置</span>
		    <span class="token string single-quoted-string">'servers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		        <span class="token punctuation">[</span>
		            <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'jsonrpc-http'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Server</span><span class="token operator">::</span><span class="token constant">SERVER_HTTP</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'0.0.0.0'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">9504</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'sock_type'</span> <span class="token operator">=&gt;</span> <span class="token constant">SWOOLE_SOCK_TCP</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'callbacks'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		                <span class="token class-name static-context">Event</span><span class="token operator">::</span><span class="token constant">ON_REQUEST</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Hyperf<span class="token punctuation">\</span>JsonRpc<span class="token punctuation">\</span>HttpServer</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'onRequest'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		            <span class="token punctuation">]</span><span class="token punctuation">,</span>
		        <span class="token punctuation">]</span><span class="token punctuation">,</span>
		    <span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>发布到服务中心</p> <pre><code class="prism language-php">		<span class="token operator">&lt;</span><span class="token operator">?</span>php
		<span class="token keyword">return</span> <span class="token punctuation">[</span>
		    <span class="token string single-quoted-string">'enable'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		        <span class="token string single-quoted-string">'discovery'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
		        <span class="token string single-quoted-string">'register'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
		    <span class="token punctuation">]</span><span class="token punctuation">,</span>
		    <span class="token string single-quoted-string">'consumers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		    <span class="token string single-quoted-string">'providers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		    <span class="token string single-quoted-string">'drivers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		        <span class="token string single-quoted-string">'consul'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		            <span class="token string single-quoted-string">'uri'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'http://127.0.0.1:8500'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'token'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
		        <span class="token punctuation">]</span><span class="token punctuation">,</span>
		        <span class="token string single-quoted-string">'nacos'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		            <span class="token comment">// nacos server url like https://nacos.hyperf.io, Priority is higher than host:port</span>
		            <span class="token comment">// 'url' =&gt; '',</span>
		            <span class="token comment">// The nacos host info</span>
		            <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">8848</span><span class="token punctuation">,</span>
		            <span class="token comment">// The nacos account info</span>
		            <span class="token string single-quoted-string">'username'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'password'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'guzzle'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		                <span class="token string single-quoted-string">'config'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
		            <span class="token punctuation">]</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'group_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'api'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'namespace_id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'namespace_id'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'heartbeat'</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span>
		        <span class="token punctuation">]</span><span class="token punctuation">,</span>
		    <span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>定义消费者</p> <pre><code class="prism language-php">		<span class="token operator">&lt;</span><span class="token operator">?</span>php
		
		<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>JsonRpc</span><span class="token punctuation">;</span>
		
		<span class="token keyword">use</span> <span class="token package">Hyperf<span class="token punctuation">\</span>RpcClient<span class="token punctuation">\</span>AbstractServiceClient</span><span class="token punctuation">;</span>
		
		<span class="token keyword">class</span> <span class="token class-name-definition class-name">CalculatorServiceConsumer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractServiceClient</span> <span class="token keyword">implements</span> <span class="token class-name">CalculatorServiceInterface</span>
		<span class="token punctuation">{<!-- --></span>
		    <span class="token comment">/**
		     * 定义对应服务提供者的服务名称
		     */</span>
		    <span class="token keyword">protected</span> <span class="token keyword type-declaration">string</span> <span class="token variable">$serviceName</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'CalculatorService'</span><span class="token punctuation">;</span>
		    
		    <span class="token comment">/**
		     * 定义对应服务提供者的服务协议
		     */</span>
		    <span class="token keyword">protected</span> <span class="token keyword type-declaration">string</span> <span class="token variable">$protocol</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'jsonrpc-http'</span><span class="token punctuation">;</span>
		
		    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword type-hint">int</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">int</span>
		    <span class="token punctuation">{<!-- --></span>
		        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">__request</span><span class="token punctuation">(</span><span class="token constant">__FUNCTION__</span><span class="token punctuation">,</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		services<span class="token operator">.</span>php
		<span class="token operator">&lt;</span><span class="token operator">?</span>php
		<span class="token keyword">return</span> <span class="token punctuation">[</span>
		    <span class="token comment">// 此处省略了其它同层级的配置</span>
		    <span class="token string single-quoted-string">'consumers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		        <span class="token punctuation">[</span>
		            <span class="token comment">// 对应消费者类的 $serviceName</span>
		            <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'CalculatorService'</span><span class="token punctuation">,</span>
		            <span class="token comment">// 这个消费者要从哪个服务中心获取节点信息，如不配置则不会从服务中心获取节点信息</span>
		            <span class="token string single-quoted-string">'registry'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		                <span class="token string single-quoted-string">'protocol'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'nacos'</span><span class="token punctuation">,</span>
		                <span class="token string single-quoted-string">'address'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'http://192.168.61.111:8848'</span><span class="token punctuation">,</span>
		            <span class="token punctuation">]</span><span class="token punctuation">,</span>
		            <span class="token comment">// 如果没有指定上面的 registry 配置，即为直接对指定的节点进行消费，通过下面的 nodes 参数来配置服务提供者的节点信息</span>
		<span class="token comment">//            'nodes' =&gt; [</span>
		<span class="token comment">//                ['host' =&gt; '172.19.60.77', 'port' =&gt; 9504],</span>
		<span class="token comment">//            ],</span>
		        <span class="token punctuation">]</span>
		    <span class="token punctuation">]</span><span class="token punctuation">,</span>
		    <span class="token string single-quoted-string">'drivers'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		        <span class="token string single-quoted-string">'nacos'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		            <span class="token comment">// nacos server url like https://nacos.hyperf.io, Priority is higher than host:port</span>
		            <span class="token comment">// 'url' =&gt; '',</span>
		            <span class="token comment">// The nacos host info</span>
		            <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'192.168.61.111'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">8848</span><span class="token punctuation">,</span>
		            <span class="token comment">// The nacos account info</span>
		            <span class="token string single-quoted-string">'username'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'nacos'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'password'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'nacos'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'guzzle'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
		                <span class="token string single-quoted-string">'config'</span> <span class="token operator">=&gt;</span> <span class="token constant">null</span><span class="token punctuation">,</span>
		            <span class="token punctuation">]</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'group_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'DEFAULT_GROUP'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'namespace_id'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'8ab0c40e-3e16-4809-836d-a2947589276f'</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'heartbeat'</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span>
		            <span class="token string single-quoted-string">'ephemeral'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否注册临时实例</span>
		        <span class="token punctuation">]</span><span class="token punctuation">,</span>
		    <span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <p>这样我们便可以通过 CalculatorService 类来实现对服务的消费了，为了让这里的关系逻辑更加的合理，还应该在 config/autoload/dependencies.php 内定义 CalculatorServiceInterface 和 CalculatorServiceConsumer 的关系，示例如下：</p> <pre><code class="prism language-php"><span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>JsonRpc<span class="token punctuation">\</span>CalculatorServiceInterface</span><span class="token operator">::</span><span class="token keyword">class</span> <span class="token operator">=&gt;</span> <span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>JsonRpc<span class="token punctuation">\</span>CalculatorServiceConsumer</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> </li></ul> </li></ul>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>