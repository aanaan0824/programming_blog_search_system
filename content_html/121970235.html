<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p></p>
<div class="toc">
<h3> </h3>
<ul><li><a href="#VOC2007_2">一、VOC2007数据集</a></li><li><a href="#DOTA_57">二、DOTA数据集</a></li><li><a href="#DOTAVOC2007_86">三、将DOTA数据集的格式转换成VOC2007数据集的格式</a></li></ul>
</div>
<p></p>
<h1><a id="VOC2007_2"></a>一、VOC2007数据集</h1>
<p>  VOC2007数据集的文件结构如下图所示。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5c0b67fea4904b19ac1bc3684812e467.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_10,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/>   其中，文件夹<code>Annotations</code>中存放的是图像的标注信息的xml文件，命名从<code>000001.xml</code>开始；文件夹<code>ImageSets</code>中存放的是图像划分的集合的txt文件，目标检测任务对应的train、val、trainval、test数据集的txt文件存放在<code>Main</code>文件夹中；文件夹<code>JPEGImages</code>中存放的是所有图片的jpg文件，命名从<code>000001.jpg</code>开始；文件夹<code>SegmentationClass</code>和<code>SegmentationObject</code>中存放的是其他任务的数据信息。<br/>   文件夹<code>Annotations</code>中存放的某一张图像的标注信息的xml文件里面的内容如下所示。</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>annotation</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>folder</span><span class="token punctuation">&gt;</span></span>VOC2007<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>folder</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--文件名--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span>000007.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filename</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--数据来源--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>
	    <span class="token comment">&lt;!--数据来源--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>database</span><span class="token punctuation">&gt;</span></span>The VOC2007 Database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>database</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>annotation</span><span class="token punctuation">&gt;</span></span>PASCAL VOC2007<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>annotation</span><span class="token punctuation">&gt;</span></span>
		 <span class="token comment">&lt;!--来源是flickr，一个雅虎的图像分享网站，下面是id，对于我们没有用--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">&gt;</span></span>flickr<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flickrid</span><span class="token punctuation">&gt;</span></span>194179466<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flickrid</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--图片的所有者，也没有用--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>owner</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flickrid</span><span class="token punctuation">&gt;</span></span>monsieurrompu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>flickrid</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Thom Zemanek<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>owner</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--图像尺寸,宽、高、长--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>size</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">&gt;</span></span>500<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">&gt;</span></span>333<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>size</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--是否用于分割，0表示用于，1表示不用于--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>segmented</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>segmented</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--下面是图像中标注的物体,每一个object包含一个标准的物体--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span>
	    <span class="token comment">&lt;!--物体名称，拍摄角度--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>car<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pose</span><span class="token punctuation">&gt;</span></span>Unspecified<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pose</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--是否被裁减，0表示完整，1表示不完整--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>truncated</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>truncated</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--是否容易识别，0表示容易，1表示困难--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>difficult</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>difficult</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--bounding box的四个坐标--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bndbox</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xmin</span><span class="token punctuation">&gt;</span></span>141<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>xmin</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ymin</span><span class="token punctuation">&gt;</span></span>50<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ymin</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xmax</span><span class="token punctuation">&gt;</span></span>500<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>xmax</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ymax</span><span class="token punctuation">&gt;</span></span>330<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ymax</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bndbox</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>object</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>annotation</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>  关于VOC2007数据集的其他详细信息可见→<a href="https://blog.csdn.net/HUAI_BI_TONG/article/details/121499060">VOC2007数据集详细分析</a>。</p>
<h1><a id="DOTA_57"></a>二、DOTA数据集</h1>
<p>  DOTA数据集的官方链接→<a href="https://captain-whu.github.io/DOTA/dataset.html">DOTA数据集链接</a>。</p>
<p>  DOTA数据集（全称A Large-scale Dataset for Object DeTection in Aerial Images）是用于航拍图像中的目标检测的大型图像数据集， 它可用于发现和评估航拍图像中的物体。 对于DOTA数据集，它包含来自不同传感器和平台的2806个航拍图像。每个图像的大小在大约800×800到4000×4000像素的范围内，并且包含各种比例，方向和形状的对象。这些DOTA图像由航空影像解释专家分类为15个常见对象类别。完全注释的DOTA图像包含188、282个实例，每个实例都由任意（8自由度）四边形标记。</p>
<p>  目前DOTA数据集有三个版本：</p>
<ul><li><strong>DOTA-v1.0</strong>：包含15个常见类别，2,806个图像和188,282个实例。DOTA-V1.0中的训练集，验证集和测试集的比例分别为1/2,1 / 6和1/3。<br/>       plane, ship, storage tank, baseball diamond, tennis court, basketball court, ground track field, harbor, bridge, large vehicle, small vehicle, helicopter, roundabout, soccer ball field and swimming pool.</li><li><strong>DOTA-v1.5</strong>：使用了与DOTA-v1.0相同的图像，但是非常小的实例(小于10像素)也有注释。此外，还增加了一个新的类别"container crane"。它总共包含403,318个实例。图像和数据集分割的数量与DOTA-v1.0相同。该版本是为了与IEEE CVPR 2019联合举办的2019 DOAI航拍图像目标检测挑战赛发布的。<br/>       plane, ship, storage tank, baseball diamond, tennis court, basketball court, ground track field, harbor, bridge, large vehicle, small vehicle, helicopter, roundabout, soccer ball field, swimming pool and container crane.</li><li><strong>DOTA-v2.0</strong>：收集更多Google地球，GF-2卫星和空中图像。DOTA-v2.0中有18个常见类别，11,268个图像和1,793,658个实例。与DOTA-V1.5相比，它进一步增加了新类别的"airport"和"helipad"。DOTA的11,268个图像分为训练、验证、测试验证和测试挑战集。<br/>       plane, ship, storage tank, baseball diamond, tennis court, basketball court, ground track field, harbor, bridge, large vehicle, small vehicle, helicopter, roundabout, soccer ball field, swimming pool, container crane, airport and helipad.</li></ul>
<p>  DOTA数据集的文件结构如下图所示。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4d9634eb11994e42b02d04c35ebaca86.png#pic_center"/><br/>   数据集DOTA文件夹下有<code>train</code>、<code>val</code>、<code>test</code>三个文件夹。文件夹<code>train</code>、<code>val</code>下各有<code>images</code>、<code>labelTxt-v1.0</code>、<code>labelTxt-v1.5</code>三个文件夹，文件夹<code>test</code>下只有<code>images</code>一个文件夹。<br/>   其中<code>images</code>文件夹中存放的是遥感图像，如下图所示。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6c0aeee1c4d346daa82b464473099eeb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_15,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/>   <code>labelTxt-v1.0</code>文件夹中存放的是DOTA v1.0版本的标签信息，如下图所示，有<code>labelTxt</code>、<code>trainset_reclabelTxt</code>两个文件夹。<code>labelTxt</code>文件夹中存放的是obb（定向边界框）标签信息，<code>trainset_reclabelTxt</code>文件夹中存放的是hbb（水平边界框）标签信息。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/445859cd66e447e0a7262ab74820774e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_15,color_FFFFFF,t_70,g_se,x_16#pic_center"/><br/>   <code>labelTxt-v1.5</code>文件夹中存放的是DOTA v1.5版本的标签信息，与<code>labelTxt-v1.0</code>文件夹类似，如下图所示，该文件夹下有存放obb（定向边界框）标签信息的文件夹<code>DOTA-v1.5_train</code>和存放hbb（水平边界框）标签信息的文件夹<code>DOTA-v1.5_train_hbb</code>。</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/73c980c3ec9b48d7b4fbcb0681868418.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_15,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<h1><a id="DOTAVOC2007_86"></a>三、将DOTA数据集的格式转换成VOC2007数据集的格式</h1>
<p>  使用Python将DOTA数据集的格式转换成VOC2007数据集的格式需要进行以下操作。</p>
<ol><li>首先可以对DOTA数据集中图片的ground truth进行可视化，可视化的代码<code>visual_DOTA.py</code>及结果如下所示。</li></ol>
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 
<span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
 
thr<span class="token operator">=</span><span class="token number">0.95</span>
<span class="token keyword">def</span> <span class="token function">custombasename</span><span class="token punctuation">(</span>fullname<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">return</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>fullname<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
  
<span class="token keyword">def</span> <span class="token function">GetFileFromThisRootDir</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">,</span>ext <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
  allfiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  
  needExtFilter <span class="token operator">=</span> <span class="token punctuation">(</span>ext <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">)</span>  
  <span class="token keyword">for</span> root<span class="token punctuation">,</span>dirs<span class="token punctuation">,</span>files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    <span class="token keyword">for</span> filespath <span class="token keyword">in</span> files<span class="token punctuation">:</span>  
      filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> filespath<span class="token punctuation">)</span>  
      extension <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  
      <span class="token keyword">if</span> needExtFilter <span class="token keyword">and</span> extension <span class="token keyword">in</span> ext<span class="token punctuation">:</span>  
        allfiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>  
      <span class="token keyword">elif</span> <span class="token keyword">not</span> needExtFilter<span class="token punctuation">:</span>  
        allfiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>  
  <span class="token keyword">return</span> allfiles  
 
<span class="token keyword">def</span> <span class="token function">visualise_gt</span><span class="token punctuation">(</span>label_path<span class="token punctuation">,</span> pic_path<span class="token punctuation">,</span> newpic_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    results <span class="token operator">=</span>  GetFileFromThisRootDir<span class="token punctuation">(</span>label_path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
        f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment">#如果为空</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'文件为空'</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        boxes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span>line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>lines<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment">#score = float(line.strip().split(' ')[8])</span>
            <span class="token comment">#if i in [0,1]:   #如果可视化DOTA-v1.5,前两行不需要，跳过，取消注释；如果可视化DOTA-v1.0,前两行需要，注释掉这两行代码</span>
            <span class="token comment">#    continue</span>
            name <span class="token operator">=</span> result<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            box<span class="token operator">=</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span>
            box <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>box<span class="token punctuation">,</span>dtype <span class="token operator">=</span> np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
            <span class="token comment">#if float(score)&gt;thr:</span>
            boxes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>box<span class="token punctuation">)</span>
        boxes <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>boxes<span class="token punctuation">,</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>   
        filepath<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>pic_path<span class="token punctuation">,</span> name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'.png'</span><span class="token punctuation">)</span>
        im<span class="token operator">=</span>cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
        <span class="token comment">#print line3</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>boxes<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            box <span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> \
                            <span class="token punctuation">[</span>boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>boxes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
            box <span class="token operator">=</span> box<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            cv2<span class="token punctuation">.</span>polylines<span class="token punctuation">(</span>im<span class="token punctuation">,</span><span class="token punctuation">[</span>box<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>newpic_path<span class="token punctuation">,</span>result<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>im<span class="token punctuation">)</span>
        <span class="token comment">#下面是有score的        </span>
        <span class="token comment">#        x,y,w,h,score=box.split('_')#</span>
        <span class="token comment">#        score=float(score)</span>
        <span class="token comment">#        cv2.rectangle(im,(int(x),int(y)),(int(x)+int(w),int(y)+int(h)),(0,0,255),1)</span>
        <span class="token comment">#        cv2.putText(im,'%3f'%score, (int(x)+int(w),int(y)+int(h)+5),cv2.FONT_HERSHEY_SIMPLEX,0.5,(0,255,0),1)</span>
        <span class="token comment">#        cv2.imwrite(newpic_path+filename,im)</span>
 
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    pic_path <span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/DOTA/train/images/'</span> <span class="token comment">#样本图片路径</span>
    label_path <span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/DOTA/train/labelTxt-v1.0/trainset_reclabelTxt/'</span><span class="token comment">#DOTA标签的所在路径    </span>
    newpic_path<span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/DOTA/hbbshow/train/'</span>  <span class="token comment">#可视化保存路径</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>newpic_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>newpic_path<span class="token punctuation">)</span>
    visualise_gt<span class="token punctuation">(</span>label_path<span class="token punctuation">,</span> pic_path<span class="token punctuation">,</span> newpic_path<span class="token punctuation">)</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9655f6a85e4046b682d9c70fc4a3ce77.PNG?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_15,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<ol start="2"><li> <p>新建一个与VOC2007数据集的文件结构类似的DOTA数据集文件结构，只保留我们需要的部分。<br/>  <br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/16f81780019b4ae5bf460697676d0640.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_10,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p> </li><li> <p>由于DOTA数据集中有的图片纵横比太大，不能直接用于后续的训练，所以需要对DOTA数据集进行切割。将数据集中的图片切割为600 <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      
       
        
         
          ×
         
        
        
         \times
        
       
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord">×</span></span></span></span></span> 600固定大小的图片，并对切割后的图片生成相对应的标注信息xml文件。切割的代码<code>DOTA_VOC.py</code>及结果如下所示。</p> </li></ol>
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> imageio
<span class="token keyword">from</span> xml<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>minidom <span class="token keyword">import</span> Document
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> copy<span class="token punctuation">,</span> cv2

<span class="token keyword">def</span> <span class="token function">save_to_xml</span><span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> im_width<span class="token punctuation">,</span> im_height<span class="token punctuation">,</span> objects_axis<span class="token punctuation">,</span> label_name<span class="token punctuation">,</span> name<span class="token punctuation">,</span> hbb<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    im_depth <span class="token operator">=</span> <span class="token number">0</span>
    object_num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">)</span>
    doc <span class="token operator">=</span> Document<span class="token punctuation">(</span><span class="token punctuation">)</span>

    annotation <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'annotation'</span><span class="token punctuation">)</span>
    doc<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>annotation<span class="token punctuation">)</span>

    folder <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'folder'</span><span class="token punctuation">)</span>
    folder_name <span class="token operator">=</span> doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'VOC2007'</span><span class="token punctuation">)</span>
    folder<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>folder_name<span class="token punctuation">)</span>
    annotation<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>folder<span class="token punctuation">)</span>

    filename <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">)</span>
    filename_name <span class="token operator">=</span> doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    filename<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>filename_name<span class="token punctuation">)</span>
    annotation<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

    source <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'source'</span><span class="token punctuation">)</span>
    annotation<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>source<span class="token punctuation">)</span>

    database <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'database'</span><span class="token punctuation">)</span>
    database<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'The VOC2007 Database'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    source<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>database<span class="token punctuation">)</span>

    annotation_s <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'annotation'</span><span class="token punctuation">)</span>
    annotation_s<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'PASCAL VOC2007'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    source<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>annotation_s<span class="token punctuation">)</span>

    image <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span>
    image<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'flickr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    source<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>image<span class="token punctuation">)</span>

    flickrid <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'flickrid'</span><span class="token punctuation">)</span>
    flickrid<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'322409915'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    source<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>flickrid<span class="token punctuation">)</span>

    owner <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'owner'</span><span class="token punctuation">)</span>
    annotation<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>owner<span class="token punctuation">)</span>

    flickrid_o <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'flickrid'</span><span class="token punctuation">)</span>
    flickrid_o<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'knautia'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    owner<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>flickrid_o<span class="token punctuation">)</span>

    name_o <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
    name_o<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'yang'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    owner<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>name_o<span class="token punctuation">)</span>

    size <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">)</span>
    annotation<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>size<span class="token punctuation">)</span>
    width <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">)</span>
    width<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>im_width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    height <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">)</span>
    height<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>im_height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    depth <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'depth'</span><span class="token punctuation">)</span>
    depth<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>im_depth<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    size<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>width<span class="token punctuation">)</span>
    size<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>height<span class="token punctuation">)</span>
    size<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>depth<span class="token punctuation">)</span>
    segmented <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'segmented'</span><span class="token punctuation">)</span>
    segmented<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    annotation<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>segmented<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>object_num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        objects <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">)</span>
        annotation<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>objects<span class="token punctuation">)</span>
        object_name <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
        object_name<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span>label_name<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        objects<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>object_name<span class="token punctuation">)</span>
        pose <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'pose'</span><span class="token punctuation">)</span>
        pose<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'Unspecified'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        objects<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>pose<span class="token punctuation">)</span>
        truncated <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'truncated'</span><span class="token punctuation">)</span>
        truncated<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        objects<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>truncated<span class="token punctuation">)</span>
        difficult <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'difficult'</span><span class="token punctuation">)</span>
        difficult<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        objects<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>difficult<span class="token punctuation">)</span>
        bndbox <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'bndbox'</span><span class="token punctuation">)</span>
        objects<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>bndbox<span class="token punctuation">)</span>
        <span class="token keyword">if</span> hbb<span class="token punctuation">:</span>
           x0 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'xmin'</span><span class="token punctuation">)</span>
           x0<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>x0<span class="token punctuation">)</span>
           y0 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'ymin'</span><span class="token punctuation">)</span>
           y0<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>y0<span class="token punctuation">)</span>

           x1 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'xmax'</span><span class="token punctuation">)</span>
           x1<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
           y1 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'ymax'</span><span class="token punctuation">)</span>
           y1<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>y1<span class="token punctuation">)</span>       
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            x0 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'x0'</span><span class="token punctuation">)</span>
            x0<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>x0<span class="token punctuation">)</span>
            y0 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'y0'</span><span class="token punctuation">)</span>
            y0<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>y0<span class="token punctuation">)</span>

            x1 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'x1'</span><span class="token punctuation">)</span>
            x1<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
            y1 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'y1'</span><span class="token punctuation">)</span>
            y1<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>y1<span class="token punctuation">)</span>
            
            x2 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'x2'</span><span class="token punctuation">)</span>
            x2<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>x2<span class="token punctuation">)</span>
            y2 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'y2'</span><span class="token punctuation">)</span>
            y2<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>y2<span class="token punctuation">)</span>

            x3 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'x3'</span><span class="token punctuation">)</span>
            x3<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
            y3 <span class="token operator">=</span> doc<span class="token punctuation">.</span>createElement<span class="token punctuation">(</span><span class="token string">'y3'</span><span class="token punctuation">)</span>
            y3<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>createTextNode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>objects_axis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            bndbox<span class="token punctuation">.</span>appendChild<span class="token punctuation">(</span>y3<span class="token punctuation">)</span>
        
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>save_path<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>doc<span class="token punctuation">.</span>toprettyxml<span class="token punctuation">(</span>indent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 


class_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'plane'</span><span class="token punctuation">,</span> <span class="token string">'baseball-diamond'</span><span class="token punctuation">,</span> <span class="token string">'bridge'</span><span class="token punctuation">,</span> <span class="token string">'ground-track-field'</span><span class="token punctuation">,</span> 
              <span class="token string">'small-vehicle'</span><span class="token punctuation">,</span> <span class="token string">'large-vehicle'</span><span class="token punctuation">,</span> <span class="token string">'ship'</span><span class="token punctuation">,</span> 
              <span class="token string">'tennis-court'</span><span class="token punctuation">,</span> <span class="token string">'basketball-court'</span><span class="token punctuation">,</span>  
              <span class="token string">'storage-tank'</span><span class="token punctuation">,</span> <span class="token string">'soccer-ball-field'</span><span class="token punctuation">,</span> 
              <span class="token string">'roundabout'</span><span class="token punctuation">,</span> <span class="token string">'harbor'</span><span class="token punctuation">,</span> 
              <span class="token string">'swimming-pool'</span><span class="token punctuation">,</span> <span class="token string">'helicopter'</span><span class="token punctuation">]</span>  <span class="token comment"># DOTA v1.0有15个类别；DOTA v1.5有16个类别，比DOTA v1.0多一个container-crane类别</span>


<span class="token keyword">def</span> <span class="token function">format_label</span><span class="token punctuation">(</span>txt_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    format_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> txt_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 处理DOTA v1.0为txt_list[0:]；处理DOTA v1.5改为txt_list[2:]</span>
        format_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
        <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>xy<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> xy <span class="token keyword">in</span> i<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span>class_list<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token comment"># {'x0': int(i.split(' ')[0]),</span>
        <span class="token comment"># 'x1': int(i.split(' ')[2]),</span>
        <span class="token comment"># 'x2': int(i.split(' ')[4]),</span>
        <span class="token comment"># 'x3': int(i.split(' ')[6]),</span>
        <span class="token comment"># 'y1': int(i.split(' ')[1]),</span>
        <span class="token comment"># 'y2': int(i.split(' ')[3]),</span>
        <span class="token comment"># 'y3': int(i.split(' ')[5]),</span>
        <span class="token comment"># 'y4': int(i.split(' ')[7]),</span>
        <span class="token comment"># 'class': class_list.index(i.split(' ')[8]) if i.split(' ')[8] in class_list else 0, </span>
        <span class="token comment"># 'difficulty': int(i.split(' ')[9])}</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">if</span> i<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> class_list <span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'warning found a new label :'</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>format_data<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">clip_image</span><span class="token punctuation">(</span>file_idx<span class="token punctuation">,</span> image<span class="token punctuation">,</span> boxes_all<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># print ('image shape', image.shape)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>boxes_all<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        shape <span class="token operator">=</span> image<span class="token punctuation">.</span>shape
        <span class="token keyword">for</span> start_h <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> start_w <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                boxes <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>boxes_all<span class="token punctuation">)</span>
                box <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>boxes_all<span class="token punctuation">)</span>
                start_h_new <span class="token operator">=</span> start_h
                start_w_new <span class="token operator">=</span> start_w
                <span class="token keyword">if</span> start_h <span class="token operator">+</span> height <span class="token operator">&gt;</span> shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                  start_h_new <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> height
                <span class="token keyword">if</span> start_w <span class="token operator">+</span> width <span class="token operator">&gt;</span> shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                  start_w_new <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> width
                top_left_row <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>start_h_new<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                top_left_col <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>start_w_new<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                bottom_right_row <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>start_h <span class="token operator">+</span> height<span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                bottom_right_col <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>start_w <span class="token operator">+</span> width<span class="token punctuation">,</span> shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                
                subImage <span class="token operator">=</span> image<span class="token punctuation">[</span>top_left_row<span class="token punctuation">:</span>bottom_right_row<span class="token punctuation">,</span> top_left_col<span class="token punctuation">:</span> bottom_right_col<span class="token punctuation">]</span>
              
                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> top_left_col
                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> top_left_col
                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">-</span> top_left_col
                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">-</span> top_left_col

                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> top_left_row
                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> top_left_row
                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> top_left_row
                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">-</span> top_left_row
                box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> boxes<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
                center_y <span class="token operator">=</span> <span class="token number">0.25</span><span class="token operator">*</span><span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                center_x <span class="token operator">=</span> <span class="token number">0.25</span><span class="token operator">*</span><span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token comment"># print('center_y', center_y)</span>
                <span class="token comment"># print('center_x', center_x)</span>
                <span class="token comment"># print ('boxes', boxes)</span>
                <span class="token comment"># print ('boxes_all', boxes_all)</span>
                <span class="token comment"># print ('top_left_col', top_left_col, 'top_left_row', top_left_row)</span>

                cond1 <span class="token operator">=</span> np<span class="token punctuation">.</span>intersect1d<span class="token punctuation">(</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>center_y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>center_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                cond2 <span class="token operator">=</span> np<span class="token punctuation">.</span>intersect1d<span class="token punctuation">(</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>center_y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>bottom_right_row <span class="token operator">-</span> top_left_row<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                        np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>center_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>bottom_right_col <span class="token operator">-</span> top_left_col<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                idx <span class="token operator">=</span> np<span class="token punctuation">.</span>intersect1d<span class="token punctuation">(</span>cond1<span class="token punctuation">,</span> cond2<span class="token punctuation">)</span>
                <span class="token comment"># idx = np.where(center_y[:]&gt;=0 and center_x[:]&gt;=0 and center_y[:] &lt;= (bottom_right_row - top_left_row) and center_x[:] &lt;= (bottom_right_col - top_left_col))[0]</span>
                <span class="token comment"># save_path, im_width, im_height, objects_axis, label_name</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    name<span class="token operator">=</span><span class="token string">"%s_%04d_%04d.png"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>file_idx<span class="token punctuation">,</span> top_left_row<span class="token punctuation">,</span> top_left_col<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                    xml <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_dir<span class="token punctuation">,</span> <span class="token string">'Annotations'</span><span class="token punctuation">,</span> <span class="token string">"%s_%04d_%04d.xml"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>file_idx<span class="token punctuation">,</span> top_left_row<span class="token punctuation">,</span> top_left_col<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    save_to_xml<span class="token punctuation">(</span>xml<span class="token punctuation">,</span> subImage<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> subImage<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> box<span class="token punctuation">[</span>idx<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> class_list<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment"># print ('save xml : ', xml)</span>
                    <span class="token keyword">if</span> subImage<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token keyword">and</span> subImage<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span><span class="token number">5</span><span class="token punctuation">:</span>
                        img <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>save_dir<span class="token punctuation">,</span> <span class="token string">'JPEGImages'</span><span class="token punctuation">,</span> <span class="token string">"%s_%04d_%04d.png"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>file_idx<span class="token punctuation">,</span> top_left_row<span class="token punctuation">,</span> top_left_col<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">#cv2.imwrite(img, subImage)</span>
                        cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>subImage<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span><span class="token punctuation">)</span>
        

<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'class_list'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>class_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
raw_images_dir <span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/DOTA/train/images/'</span>
raw_label_dir <span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/DOTA/train/labelTxt-v1.0/trainset_reclabelTxt/'</span>

save_dir <span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/VOCdevkit2007/VOC2007/'</span>

images <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>raw_images_dir<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token string">'png'</span> <span class="token keyword">in</span> i<span class="token punctuation">]</span>
labels <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>raw_label_dir<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token string">'txt'</span> <span class="token keyword">in</span> i<span class="token punctuation">]</span>

<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'find image'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'find label'</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">)</span>

min_length <span class="token operator">=</span> <span class="token number">1e10</span>
max_length <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">for</span> idx<span class="token punctuation">,</span> img <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token string">'read image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
    img_data <span class="token operator">=</span> imageio<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>raw_images_dir<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># if len(img_data.shape) == 2:</span>
        <span class="token comment"># img_data = img_data[:, :, np.newaxis]</span>
        <span class="token comment"># print ('find gray image')</span>

    txt_data <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>raw_label_dir<span class="token punctuation">,</span> img<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'png'</span><span class="token punctuation">,</span> <span class="token string">'txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># print (idx, len(format_label(txt_data)), img_data.shape)</span>
    <span class="token comment"># if max(img_data.shape[:2]) &gt; max_length:</span>
        <span class="token comment"># max_length = max(img_data.shape[:2])</span>
    <span class="token comment"># if min(img_data.shape[:2]) &lt; min_length:</span>
        <span class="token comment"># min_length = min(img_data.shape[:2])</span>
    <span class="token comment"># if idx % 50 ==0:</span>
        <span class="token comment"># print (idx, len(format_label(txt_data)), img_data.shape)</span>
        <span class="token comment"># print (idx, 'min_length', min_length, 'max_length', max_length)</span>
    box <span class="token operator">=</span> format_label<span class="token punctuation">(</span>txt_data<span class="token punctuation">)</span>
    clip_image<span class="token punctuation">(</span>img<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img_data<span class="token punctuation">,</span> box<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b7c454782cc045ea863cbba18161a1d9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_10,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<ol start="4"><li>对切割后得到的<code>./VOCdevkit2007/VOC2007/Annotations/</code>文件夹下的xml文件进行处理，删除不符合要求的xml文件及<code>./VOCdevkit2007/VOC2007/JPEGImages/</code>文件夹下对应的图片。不符合要求的xml文件有以下三种情况：1. 标注目标为空；2. 所有标注目标的difficult均为1；3. 标注目标存在越界的问题（注：标注越界有六种情况 xmin&lt;0、ymin&lt;0、xmax&gt;width、ymax&gt;height、xmax&lt;xmin、ymax&lt;ymin）。处理xml文件的代码<code>remove.py</code>及结果如下所示。</li></ol>
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> xml<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>minidom
<span class="token keyword">import</span> xml<span class="token punctuation">.</span>etree<span class="token punctuation">.</span>ElementTree <span class="token keyword">as</span> ET
 
<span class="token keyword">def</span> <span class="token function">custombasename</span><span class="token punctuation">(</span>fullname<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>fullname<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
<span class="token keyword">def</span> <span class="token function">GetFileFromThisRootDir</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">,</span>ext <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  allfiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  needExtFilter <span class="token operator">=</span> <span class="token punctuation">(</span>ext <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> root<span class="token punctuation">,</span>dirs<span class="token punctuation">,</span>files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> filespath <span class="token keyword">in</span> files<span class="token punctuation">:</span>
      filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> filespath<span class="token punctuation">)</span>
      extension <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> needExtFilter <span class="token keyword">and</span> extension <span class="token keyword">in</span> ext<span class="token punctuation">:</span>
        allfiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
      <span class="token keyword">elif</span> <span class="token keyword">not</span> needExtFilter<span class="token punctuation">:</span>
        allfiles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
  <span class="token keyword">return</span> allfiles
  
<span class="token keyword">def</span> <span class="token function">cleandata</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> img_path<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> label_ext<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> custombasename<span class="token punctuation">(</span>path<span class="token punctuation">)</span>  <span class="token comment">#名称</span>
    <span class="token keyword">if</span> label_ext <span class="token operator">==</span> <span class="token string">'.xml'</span><span class="token punctuation">:</span>
        tree <span class="token operator">=</span> ET<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        root <span class="token operator">=</span> tree<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>

        size<span class="token operator">=</span>root<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">)</span>
        width<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'width'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token comment">#print(width)</span>
        height<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token comment">#print(height)</span>

        objectlist <span class="token operator">=</span> root<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">)</span>
        num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>objectlist<span class="token punctuation">)</span>
        <span class="token comment">#print(num)</span>

        count<span class="token operator">=</span><span class="token number">0</span>
        count1<span class="token operator">=</span><span class="token number">0</span>
        minus<span class="token operator">=</span><span class="token number">0</span>
        <span class="token keyword">for</span> <span class="token builtin">object</span> <span class="token keyword">in</span> objectlist<span class="token punctuation">:</span>
            difficult <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'difficult'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
            <span class="token comment">#print(difficult)</span>

            bndbox<span class="token operator">=</span><span class="token builtin">object</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'bndbox'</span><span class="token punctuation">)</span>
            xmin <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>bndbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'xmin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
            <span class="token comment">#print(xmin)</span>
            ymin <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>bndbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ymin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
            <span class="token comment">#print(ymin)</span>
            xmax <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>bndbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'xmax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
            <span class="token comment">#print(xmax)</span>
            ymax <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>bndbox<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ymax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
            <span class="token comment">#print(ymax)</span>
            <span class="token keyword">if</span> xmin<span class="token operator">&lt;</span><span class="token number">0</span> <span class="token keyword">or</span> ymin<span class="token operator">&lt;</span><span class="token number">0</span> <span class="token keyword">or</span> width<span class="token operator">&lt;</span>xmax <span class="token keyword">or</span> height<span class="token operator">&lt;</span>ymax <span class="token keyword">or</span> xmax<span class="token operator">&lt;</span>xmin <span class="token keyword">or</span> ymax<span class="token operator">&lt;</span>ymin<span class="token punctuation">:</span>  <span class="token comment"># 目标标注越界的六种情况</span>
                minus<span class="token operator">+=</span><span class="token number">1</span>
            count <span class="token operator">=</span> count1 <span class="token operator">+</span> difficult
            count1 <span class="token operator">=</span> count
            
        <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> count <span class="token operator">==</span> num <span class="token keyword">or</span> minus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 不符合要求的三种情况</span>
            image_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> name <span class="token operator">+</span> ext<span class="token punctuation">)</span> <span class="token comment">#样本图片的名称</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>  <span class="token comment">#移除该标注文件</span>
            os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>path<span class="token punctuation">)</span>     <span class="token comment">#移除该图片文件</span>
                                           
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    root <span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/VOCdevkit2007/VOC2007/'</span>
    img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'JPEGImages'</span><span class="token punctuation">)</span>  <span class="token comment">#分割后的样本集</span>
    label_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">'Annotations'</span><span class="token punctuation">)</span>  <span class="token comment">#分割后的标签</span>
    ext <span class="token operator">=</span> <span class="token string">'.png'</span> <span class="token comment">#图片的后缀</span>
    label_ext <span class="token operator">=</span> <span class="token string">'.xml'</span>
        
    label_list <span class="token operator">=</span> GetFileFromThisRootDir<span class="token punctuation">(</span>label_path<span class="token punctuation">)</span>
    <span class="token keyword">for</span> path <span class="token keyword">in</span> label_list<span class="token punctuation">:</span>
        cleandata<span class="token punctuation">(</span>path<span class="token punctuation">,</span> img_path<span class="token punctuation">,</span> ext<span class="token punctuation">,</span> label_ext<span class="token punctuation">)</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e0774e453ddc4109b0613280e07bdfab.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_10,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<ol start="5"><li>对DOTA数据集进行划分，划分为train、val、trainval、test四个文件。划分代码<code>split_data.py</code>及结果如下所示。</li></ol>
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> random

trainval_percent <span class="token operator">=</span> <span class="token number">0.8</span>  <span class="token comment"># 表示训练集和验证集(交叉验证集)所占总图片的比例</span>
train_percent <span class="token operator">=</span> <span class="token number">0.75</span>  <span class="token comment"># 训练集所占验证集的比例</span>
xmlfilepath <span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/VOCdevkit2007/VOC2007/Annotations'</span>
txtsavepath <span class="token operator">=</span> <span class="token string">'E:/Remote Sensing/Data Set/VOCdevkit2007/VOC2007/ImageSets/Main'</span>
total_xml <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>xmlfilepath<span class="token punctuation">)</span>
num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>total_xml<span class="token punctuation">)</span>
<span class="token builtin">list</span> <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>

tv <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>num <span class="token operator">*</span> trainval_percent<span class="token punctuation">)</span>  <span class="token comment"># xml文件中的交叉验证集数</span>
tr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tv <span class="token operator">*</span> train_percent<span class="token punctuation">)</span>  <span class="token comment"># xml文件中的训练集数，注意，我们在前面定义的是训练集占验证集的比例</span>
trainval <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">,</span> tv<span class="token punctuation">)</span>
train <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>trainval<span class="token punctuation">,</span> tr<span class="token punctuation">)</span>

ftrainval <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'E:/Remote Sensing/Data Set/VOCdevkit2007/VOC2007/ImageSets/Main/trainval.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
ftest <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'E:/Remote Sensing/Data Set/VOCdevkit2007/VOC2007/ImageSets/Main/test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
ftrain <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'E:/Remote Sensing/Data Set/VOCdevkit2007/VOC2007/ImageSets/Main/train.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
fval <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'E:/Remote Sensing/Data Set/VOCdevkit2007/VOC2007/ImageSets/Main/val.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> total_xml<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\n'</span>
    <span class="token keyword">if</span> i <span class="token keyword">in</span> trainval<span class="token punctuation">:</span>
        ftrainval<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> i <span class="token keyword">in</span> train<span class="token punctuation">:</span>
            ftrain<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            fval<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        ftest<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>

ftrainval<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
ftrain<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
fval<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
ftest<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"done!"</span><span class="token punctuation">)</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f0c550b17430414286ee6fbb62c717b6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_10,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<ol start="6"><li>最后，将VOC2007数据集下的<code>result</code>文件夹复制到新建的DOTA数据集的VOC文件结构中，后面训练测试模型时会用到。<br/>  <br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/fbb53c49b311413e9fe1912b09ee1a21.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_70,text_Q1NETiBA5aSn5b2k5bCP5b-G,size_10,color_FFFFFF,t_70,g_se,x_16#pic_center"/></li></ol>
<p>  至此，就可以将DOTA数据集的格式转换成VOC2007数据集的的格式了，我们得到一个属于DOTA数据集的<code>VOCdevkit2007</code>文件夹！</p>
<p>  参考文章：https://blog.csdn.net/mary_0830/article/details/104263619</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>