<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-tomorrow-night" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<blockquote>
<p></p>
<div class="toc">
<h3>✨Spring Boot整合持久层</h3>
<ul><li><a href="#1_7">1.基本工程</a></li><li><ul><li><a href="#11_8">1.1基本工程</a></li><li><a href="#12mybatis_15">1.2修改mybatis配置信息</a></li><li><a href="#13_39">1.3创建实体类及其接口</a></li><li><a href="#14_44">1.4单元测试</a></li></ul>
</li><li><a href="#2Mapper_65">2.Mapper接口扫描</a></li><li><a href="#3_71">3.注解式开发</a></li><li><ul><li><a href="#31_72">3.1环境准备</a></li><li><a href="#32mybatis_147">3.2.mybatis的单表操作</a></li><li><a href="#33_155">3.3查询所有商品信息</a></li><li><a href="#34_160">3.4根据商品编号查询指定的商品信息</a></li><li><a href="#35_162">3.5根据商品名称模糊查询商品</a></li><li><a href="#36_166">3.6根据商品价格，查询指定范围的商品</a></li><li><a href="#37_172">3.7插入一条商品数据</a></li><li><ul><li><a href="#371_173">3.7.1代码演示</a></li><li><a href="#372__178">3.7.2 获取自增的主键</a></li></ul>
</li><li><a href="#38_181">3.8根据编号删除指定商品</a></li><li><a href="#39_196">3.9根据商品编号，修改商品价格</a></li></ul>
</li><li><a href="#4_215">4.映射文件开发</a></li><li><ul><li><a href="#41_216">4.1基本操作</a></li><li><a href="#42_258">4.2查询所有商品信息以及商品类别的详细信息(多对一)</a></li><li><a href="#43_271">4.3查询所有商品类别及其商品信息(一对多)</a></li></ul>
</li><li><a href="#5Druid_317">5.整合Druid</a></li><li><ul><li><a href="#51_318">5.1传统获取连接的问题</a></li><li><a href="#52_324">5.2数据库连接池</a></li><li><a href="#53_330">5.3整合步骤</a></li><li><ul><li><a href="#531pom_333">5.3.1引入pom依赖</a></li><li><a href="#532druid_344">5.3.2添加druid配置</a></li><li><a href="#533_351">5.3.3完整配置</a></li><li><a href="#534_371">5.3.4代码测试</a></li></ul>
</li></ul>
</li><li><a href="#6_380">6.事务管理</a></li><li><ul><li><a href="#61_381">6.1事务的概念</a></li><li><a href="#62ACID_385">6.2事务的四大特性(ACID)</a></li><li><a href="#63_392">6.3事务的隔离级别</a></li><li><a href="#64_399">6.4事务的传播机制(图解)</a></li><li><a href="#65_428">6.5事务的实现</a></li><li><a href="#66_433">6.6代码实现</a></li></ul>
</li><li><a href="#7Mybatis_450">7.Mybatis缓存</a></li><li><ul><li><a href="#71_451">7.1使用缓存的原因</a></li><li><a href="#72Mybatis_455">7.2Mybatis的缓存分类</a></li><li><a href="#73_Spring_BootMybatis_465">7.3 Spring Boot对Mybatis的支持</a></li><li><a href="#74_474">7.4代码实现</a></li><li><a href="#75_533">7.5缓存的底层细节(博客推荐)</a></li></ul>
</li></ul>
</div>
<p></p>
<p>📃个人主页:<a href="https://blog.csdn.net/qq_52797170?spm=1010.2135.3001.5343">不断前进的皮卡丘</a><br/> 🌞博客描述:<strong>梦想也许遥不可及，但重要的是追梦的过程，用博客记录自己的成长，记录自己一步一步向上攀登的印记</strong><br/> <strong>🔥网站推荐：千里之行，始于足下。每天坚持刷题，巩固所学知识，也为将来找工作，面试做好准备</strong>-----<a href="https://www.nowcoder.com/link/pc_csdncpt_pkq_sf">刷题神器</a></p>
</blockquote>
<h1><a id="1_7"></a>1.基本工程</h1>
<h2><a id="11_8"></a>1.1基本工程</h2>
<ul><li>创建一个Spring Boot工程，添加Web依赖，Mybatis依赖以及MySQL驱动依赖</li><li>创建成功以后，删除MySQL运行域scope</li></ul>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a805eff3793148a7b79533a1caf6696d.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ade7ece4f63f4e11ae656b844d352284.png"/></p>
<h2><a id="12mybatis_15"></a>1.2修改mybatis配置信息</h2>
<p>在application.properties中修改配置信息<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2749f80fa1134c898256dc2f1d0d70bd.png"/></p>
<pre><code class="prism language-sql"><span class="token comment"># 指定Mybatis的Mapper接口的xml映射文件的路径</span>
mybatis<span class="token punctuation">.</span>mapper<span class="token operator">-</span>locations<span class="token operator">=</span>classpath:mapper<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>xml
<span class="token comment"># MySQL数据库驱动</span>
<span class="token comment">#这个驱动也可以省略，可以根据使用的MySQL自动加载相应的驱动</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>driver<span class="token operator">-</span>class<span class="token operator">-</span>name<span class="token operator">=</span>com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>Driver
<span class="token comment"># 数据源名称</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>name<span class="token operator">=</span>defaultDataSource
<span class="token comment"># 数据库连接地址</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>url<span class="token operator">=</span>jdbc:mysql:<span class="token comment">//localhost:3306/bjpowernode?serverTimezone=UTC</span>
<span class="token comment"># 数据库用户名和密码</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>username<span class="token operator">=</span>root
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token number">123456</span>
<span class="token comment"># 设置日志级别</span>
logging<span class="token punctuation">.</span><span class="token keyword">level</span><span class="token punctuation">.</span>com<span class="token punctuation">.</span>zyh<span class="token punctuation">.</span>springboot<span class="token operator">=</span>debug
</code></pre>
<p>数据库(大家可以用以前创建的数据库来进行测试)<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2c2d0bc05e5f4381a4cdab1171ee7044.png"/></p>
<h2><a id="13_39"></a>1.3创建实体类及其接口</h2>
<p><font color="red" size="4">@Mapper注解：<br/> 作用：在接口类上添加了@Mapper，在编译之后会生成相应的接口实现类<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d3479f92fd78451b99428ef7f8e0a5c7.png"/></font></p>
<h2><a id="14_44"></a>1.4单元测试</h2>
<p><font size="4">我们可以选中mapper接口，使用快捷键alt+/,就可以创建junit单元测试<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/177499a38f3c495f95c03c23ef1dd8aa.png"/></font></p>
<pre><code class="prism language-css">2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>13.453  INFO 10228 --- [           main] c.zyh.springboot.mapper.<span class="token property">DeptMapperTest</span>   <span class="token punctuation">:</span> Starting DeptMapperTest using Java 1.8.0_131 on LAPTOP-59BP4RH1 with PID 10228 <span class="token punctuation">(</span>started by 17614 in <span class="token property">D</span><span class="token punctuation">:</span>\springboot\springboot09_base<span class="token punctuation">)</span>
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>13.453 DEBUG 10228 --- [           main] c.zyh.springboot.mapper.<span class="token property">DeptMapperTest</span>   <span class="token punctuation">:</span> Running with Spring Boot v2.7.2<span class="token punctuation">,</span> Spring v5.3.22
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>13.453  INFO 10228 --- [           main] c.zyh.springboot.mapper.<span class="token property">DeptMapperTest</span>   <span class="token punctuation">:</span> No active profile set<span class="token punctuation">,</span> falling back to 1 default <span class="token property">profile</span><span class="token punctuation">:</span> <span class="token string">"default"</span>
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>15.183  INFO 10228 --- [           main] c.zyh.springboot.mapper.<span class="token property">DeptMapperTest</span>   <span class="token punctuation">:</span> Started DeptMapperTest in 2.055 seconds <span class="token punctuation">(</span>JVM running for 3.177<span class="token punctuation">)</span>
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>15.390  INFO 10228 --- [           main] com.zaxxer.hikari.<span class="token property">HikariDataSource</span>       <span class="token punctuation">:</span> defaultDataSource - Starting...
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.720  INFO 10228 --- [           main] com.zaxxer.hikari.<span class="token property">HikariDataSource</span>       <span class="token punctuation">:</span> defaultDataSource - Start completed.
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.720 DEBUG 10228 --- [           main] c.z.s.mapper.DeptMapper.<span class="token property">queryAllDept</span>     <span class="token punctuation">:</span> ==&gt;  <span class="token property">Preparing</span><span class="token punctuation">:</span> select * from dept
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.751 DEBUG 10228 --- [           main] c.z.s.mapper.DeptMapper.<span class="token property">queryAllDept</span>     <span class="token punctuation">:</span> ==&gt; <span class="token property">Parameters</span><span class="token punctuation">:</span> 
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.782 DEBUG 10228 --- [           main] c.z.s.mapper.DeptMapper.<span class="token property">queryAllDept</span>     <span class="token punctuation">:</span> &lt;==      <span class="token property">Total</span><span class="token punctuation">:</span> 3
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.782 DEBUG 10228 --- [           main] c.zyh.springboot.mapper.<span class="token property">DeptMapperTest</span>   <span class="token punctuation">:</span> <span class="token function">Dept</span><span class="token punctuation">(</span>deptno=10<span class="token punctuation">,</span> dname=媒体部<span class="token punctuation">,</span> loc=上海<span class="token punctuation">)</span>
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.782 DEBUG 10228 --- [           main] c.zyh.springboot.mapper.<span class="token property">DeptMapperTest</span>   <span class="token punctuation">:</span> <span class="token function">Dept</span><span class="token punctuation">(</span>deptno=20<span class="token punctuation">,</span> dname=研发部<span class="token punctuation">,</span> loc=上海<span class="token punctuation">)</span>
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.782 DEBUG 10228 --- [           main] c.zyh.springboot.mapper.<span class="token property">DeptMapperTest</span>   <span class="token punctuation">:</span> <span class="token function">Dept</span><span class="token punctuation">(</span>deptno=30<span class="token punctuation">,</span> dname=人事部<span class="token punctuation">,</span> loc=杭州<span class="token punctuation">)</span>
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.798  INFO 10228 --- [ionShutdownHook] com.zaxxer.hikari.<span class="token property">HikariDataSource</span>       <span class="token punctuation">:</span> defaultDataSource - Shutdown initiated...
2022-07-31 12<span class="token punctuation">:</span>35<span class="token punctuation">:</span>18.813  INFO 10228 --- [ionShutdownHook] com.zaxxer.hikari.<span class="token property">HikariDataSource</span>       <span class="token punctuation">:</span> defaultDataSource - Shutdown completed.
</code></pre>
<h1><a id="2Mapper_65"></a>2.Mapper接口扫描</h1>
<p><font color="red" size="4">@MapperScan<br/> 作用：指定要变成实现类的接口所在的包，然后包下面的所有接口在编译之后都会生成相应的实现类<br/> 添加位置：是在Springboot启动类上面添加。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/bfd810f20b104a788a35a272f640a13d.png"/></font></p>
<h1><a id="3_71"></a>3.注解式开发</h1>
<h2><a id="31_72"></a>3.1环境准备</h2>
<p><font size="4">我们先准备数据库和表</font></p>
<pre><code class="prism language-sql"><span class="token comment"># 创建数据库</span>
 <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> shop<span class="token punctuation">;</span>
<span class="token comment"># 使用数据库</span>
<span class="token keyword">USE</span> shop<span class="token punctuation">;</span>
<span class="token comment"># 创建商品类别表: type</span>
	<span class="token comment"># id 主键自增</span>
	<span class="token comment"># name 类别名称</span>
<span class="token comment"># 创建表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>type<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">DESC</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>type<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment"># 创建商品表 product</span>
	<span class="token comment"># id 主键自增</span>
	<span class="token comment"># name 商品名称</span>
	<span class="token comment"># price 要求是非负的浮点数</span>
	<span class="token comment"># sell 布尔类型 sell=0表示售卖，sell=1表示下架</span>
	<span class="token comment">#c_date 开始售卖时间，精确到年月日即可</span>
	<span class="token comment"># tid商品类型id，外键，管理type表的id</span>
	
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> product<span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
	NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	price <span class="token keyword">DOUBLE</span> <span class="token keyword">UNSIGNED</span><span class="token punctuation">,</span>
	sell <span class="token keyword">TINYINT</span> <span class="token keyword">UNSIGNED</span><span class="token punctuation">,</span>
	c_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
	tid <span class="token keyword">INT</span><span class="token punctuation">,</span>
	<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>tid<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token identifier"><span class="token punctuation">`</span>type<span class="token punctuation">`</span></span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>	
	
	
<span class="token comment"># 插入数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>type<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">'手机'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">'电脑'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">'平板'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>type<span class="token punctuation">`</span></span><span class="token punctuation">;</span>	
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> product <span class="token keyword">VALUES</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">"华为手机"</span><span class="token punctuation">,</span><span class="token number">5000.0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'2022-7-31'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">"苹果手机"</span><span class="token punctuation">,</span><span class="token number">9000.0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'2012-5-26'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">"华为电脑"</span><span class="token punctuation">,</span><span class="token number">8000.0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'2010-5-26'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">"苹果电脑"</span><span class="token punctuation">,</span><span class="token number">12000.0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'2012-3-10'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">"华为平板"</span><span class="token punctuation">,</span><span class="token number">2000.0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'2019-4-8'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">(</span><span class="token keyword">DEFAULT</span><span class="token punctuation">,</span><span class="token string">"苹果平板"</span><span class="token punctuation">,</span><span class="token number">6000.0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'2016-3-2'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>然后创建spring boot项目，修改相关配置</p>
<pre><code class="prism language-sql"><span class="token comment"># 指定Mybatis的Mapper接口的xml映射文件的路径</span>
mybatis<span class="token punctuation">.</span>mapper<span class="token operator">-</span>locations<span class="token operator">=</span>classpath:mapper<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>xml
<span class="token comment"># MySQL数据库驱动</span>
<span class="token comment">#这个驱动也可以省略，可以根据使用的MySQL自动加载相应的驱动</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>driver<span class="token operator">-</span>class<span class="token operator">-</span>name<span class="token operator">=</span>com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>cj<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>Driver
<span class="token comment"># 数据源名称</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>name<span class="token operator">=</span>defaultDataSource
<span class="token comment"># 数据库连接地址</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>url<span class="token operator">=</span>jdbc:mysql:<span class="token comment">//localhost:3306/shop?serverTimezone=UTC&amp;zeroDateTimeBehavior=convertToNull</span>
<span class="token comment"># 数据库用户名和密码</span>
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>username<span class="token operator">=</span>root
spring<span class="token punctuation">.</span>datasource<span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token number">123456</span>
<span class="token comment"># 设置日志级别</span>
logging<span class="token punctuation">.</span><span class="token keyword">level</span><span class="token punctuation">.</span>com<span class="token punctuation">.</span>zyh<span class="token punctuation">.</span>springboot<span class="token operator">=</span>debug
<span class="token comment"># 开启mybatis驼峰命名规则自动转换功能</span>
mybatis<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>map<span class="token operator">-</span>underscore<span class="token operator">-</span><span class="token keyword">to</span><span class="token operator">-</span>camel<span class="token operator">-</span><span class="token keyword">case</span><span class="token operator">=</span><span class="token boolean">true</span>

</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7b0e2c8e34134aa6bfa578546b1ceecb.png"/></p>
<h2><a id="32mybatis_147"></a>3.2.mybatis的单表操作</h2>
<ul><li>查询所有商品信息</li><li>根据商品编号查询指定的商品信息</li><li>根据商品名称模糊查询商品</li><li>根据商品价格，查询指定范围的商品</li><li>插入一条商品数据</li><li>根据编号删除指定商品</li><li>根据商品编号，修改商品价格</li></ul>
<h2><a id="33_155"></a>3.3查询所有商品信息</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2a052427c56a4b4bb370974506778ae5.png"/><br/> <font color="red" size="4">可能遇到的问题:org.springframework.dao.TransientDataAccessResourceException: Error attempting to get column ‘c_date’ from result set.<br/> 解决方法如下:<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/48ec12d50bf54f56994d360d8bf517c2.png"/></font></p>
<h2><a id="34_160"></a>3.4根据商品编号查询指定的商品信息</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5397f754442a458ebc8cfcaabd474e4c.png"/></p>
<h2><a id="35_162"></a>3.5根据商品名称模糊查询商品</h2>
<p>这里面涉及到的知识点是mybatis的内容，大家忘记的可以去复习复习，<a href="https://zengyihong.blog.csdn.net/article/details/123895394">Mybatis特殊SQL的执行</a><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d8e2f5b13cb1490a9a13d43d6e003965.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ece42bbd0ee14204b36e31f763e059de.png"/></p>
<h2><a id="36_166"></a>3.6根据商品价格，查询指定范围的商品</h2>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b7aca7251e1647d6999553fb509e45e4.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/94284a7db8214f0aaa3eb69ffa9fdbd0.png"/><br/> <font color="red" size="4">我们也可以通过map来传参<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1facfdfd96c849ba9bdcefa25d7d102c.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9ee4476c083b43ebb16271a130ec5311.png"/></font></p>
<h2><a id="37_172"></a>3.7插入一条商品数据</h2>
<h3><a id="371_173"></a>3.7.1代码演示</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b6444c6db73f46e6aeaa220f861a70ae.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/508c66a01da84a29a7f51e74c897f36d.png"/><br/> <font size="4">我们发现此时打印的信息中，主键为空，但是事实上，数据插入在数据库中是有主键的<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c49517e1c6464750b4dac6613654134f.png"/></font></p>
<h3><a id="372__178"></a>3.7.2 获取自增的主键</h3>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/fb6178dd61514e5b9ffaa743f3400ecc.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/401153c7e2e9422eaa98d083d63cdb70.png"/></p>
<h2><a id="38_181"></a>3.8根据编号删除指定商品</h2>
<pre><code class="prism language-css">//  根据编号删除指定商品
    <span class="token atrule"><span class="token rule">@Delete</span><span class="token punctuation">(</span>"delete from product where id=#</span><span class="token punctuation">{<!-- --></span>id<span class="token punctuation">}</span>"<span class="token punctuation">)</span>
    void <span class="token function">deleteById</span><span class="token punctuation">(</span>Integer id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre><code class="prism language-css">   <span class="token atrule"><span class="token rule">@Test</span>
    public void <span class="token function">testDeleteById</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">{<!-- --></span>
        productMapper.<span class="token function">deleteById</span><span class="token punctuation">(</span>8<span class="token punctuation">)</span><span class="token punctuation">;</span>
         
    <span class="token punctuation">}</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/675b14658ba141629e2b99b1c77b96a6.png"/></p>
<h2><a id="39_196"></a>3.9根据商品编号，修改商品价格</h2>
<pre><code class="prism language-css">//  根据商品编号，修改商品价格
    <span class="token atrule"><span class="token rule">@Update</span><span class="token punctuation">(</span>"update product set price=#</span><span class="token punctuation">{<!-- --></span>price<span class="token punctuation">}</span> <span class="token selector">where id=#</span><span class="token punctuation">{<!-- --></span>id<span class="token punctuation">}</span>"<span class="token punctuation">)</span>
    void <span class="token function">updateById</span><span class="token punctuation">(</span><span class="token atrule"><span class="token rule">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> Integer id<span class="token punctuation">,</span><span class="token atrule"><span class="token rule">@Param</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">)</span> Double price<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span>
</code></pre>
<pre><code class="prism language-css">  <span class="token atrule"><span class="token rule">@Test</span>
    public void <span class="token function">testUpdateById</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">{<!-- --></span>
        productMapper.<span class="token function">updateById</span><span class="token punctuation">(</span>8<span class="token punctuation">,</span> 3000.0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ef77a31f00b746f587722b928fdb4914.png"/></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9880ecfdb6cf476984b64587c60532b9.png"/></p>
<h1><a id="4_215"></a>4.映射文件开发</h1>
<h2><a id="41_216"></a>4.1基本操作</h2>
<p>大家可以先把这个插件下载下来，可以帮助我们快速开发<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/eee4da1bbf144c489c1534a9ebfe5d9f.png"/><br/> 环境配置和上面的注解开发是一样的</p>
<pre><code class="prism language-yml"><span class="token comment"># 指定Mybatis的Mapper接口的xml映射文件的路径</span>
mybatis.mapper<span class="token punctuation">-</span>locations=classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
<span class="token comment"># MySQL数据库驱动</span>
<span class="token comment">#这个驱动也可以省略，可以根据使用的MySQL自动加载相应的驱动</span>
spring.datasource.driver<span class="token punctuation">-</span>class<span class="token punctuation">-</span>name=com.mysql.cj.jdbc.Driver
<span class="token comment"># 数据源名称</span>
spring.datasource.name=defaultDataSource
<span class="token comment"># 数据库连接地址</span>
spring.datasource.url=jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/shop<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;zeroDateTimeBehavior=convertToNull</span>
<span class="token comment"># 数据库用户名和密码</span>
spring.datasource.username=root
spring.datasource.password=123456
<span class="token comment"># 设置日志级别</span>
logging.level.com.zyh.springboot=debug
<span class="token comment"># 开启mybatis驼峰命名规则自动转换功能</span>
mybatis.configuration.map<span class="token punctuation">-</span>underscore<span class="token punctuation">-</span>to<span class="token punctuation">-</span>camel<span class="token punctuation">-</span>case=true

</code></pre>
<p>提供对应的实体类和mapper接口<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c46ff5619f5d4e328ee16a48b1b1b7bf.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/69671eb75a7f4f4eb2de1174f1365f7b.png"/></p>
<p>mapper</p>
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> <span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.zyh.springboot.mapper.ProductMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>queryById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.zyh.springboot.bean.Product<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        select * from product where id=#{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>测试<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/657b6aedc0044c8fb4cc2a8f3dbd1afb.png"/></p>
<h2><a id="42_258"></a>4.2查询所有商品信息以及商品类别的详细信息(多对一)</h2>
<blockquote>
<p><font size="4">因为涉及到多表查询，我们这个时候需要新增加一个类Type<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/eae1d35ecbb94a7484f1a69ad90779b2.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/64ec084c12424b119cf3a5622ca8e2e8.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/684613601daa4f8d8e1ff851d33c5e23.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/235fd78c73f64438bbebc854bdb22254.png"/><br/> 测试代码<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9fdbbf715f41496482deabf36ec77665.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8f854a43ac624488a4a9457e9a8a67a2.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/c82cd195ae7341e1b6c4e3fc657ffc66.png"/></font></p>
</blockquote>
<h2><a id="43_271"></a>4.3查询所有商品类别及其商品信息(一对多)</h2>
<blockquote>
<p><font size="4"><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e50a1d5d8c2748e892f66cf7306db6c3.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/9b56b8f94e974b9ebddd6c3f87676eaf.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/f51f66e9856d471c84c9fd65f6c191f6.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/db60771e6ab7491f99d03fcb93f26f86.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/fe842430e1234c51a07531ee202c0098.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/701fc0b756cd453f90f7677aeea70f20.png"/><br/> 测试<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/858dd732a6334a2faa97e1e9b316fbde.png"/><br/> 测试结果</font></p>
</blockquote>
<pre><code class="prism language-css">2022-08-01 09<span class="token punctuation">:</span>34<span class="token punctuation">:</span>53.982  INFO 30284 --- [           main] c.zyh.springboot.mapper.<span class="token property">TypeMapperTest</span>   <span class="token punctuation">:</span> Starting TypeMapperTest using Java 1.8.0_131 on LAPTOP-59BP4RH1 with PID 30284 <span class="token punctuation">(</span>started by 17614 in <span class="token property">D</span><span class="token punctuation">:</span>\springboot\springboot11_mybatis_xml<span class="token punctuation">)</span>
2022-08-01 09<span class="token punctuation">:</span>34<span class="token punctuation">:</span>53.982 DEBUG 30284 --- [           main] c.zyh.springboot.mapper.<span class="token property">TypeMapperTest</span>   <span class="token punctuation">:</span> Running with Spring Boot v2.7.2<span class="token punctuation">,</span> Spring v5.3.22
2022-08-01 09<span class="token punctuation">:</span>34<span class="token punctuation">:</span>53.982  INFO 30284 --- [           main] c.zyh.springboot.mapper.<span class="token property">TypeMapperTest</span>   <span class="token punctuation">:</span> No active profile set<span class="token punctuation">,</span> falling back to 1 default <span class="token property">profile</span><span class="token punctuation">:</span> <span class="token string">"default"</span>
2022-08-01 09<span class="token punctuation">:</span>34<span class="token punctuation">:</span>58.015  INFO 30284 --- [           main] c.zyh.springboot.mapper.<span class="token property">TypeMapperTest</span>   <span class="token punctuation">:</span> Started TypeMapperTest in 4.63 seconds <span class="token punctuation">(</span>JVM running for 7.326<span class="token punctuation">)</span>
2022-08-01 09<span class="token punctuation">:</span>34<span class="token punctuation">:</span>58.388  INFO 30284 --- [           main] com.zaxxer.hikari.<span class="token property">HikariDataSource</span>       <span class="token punctuation">:</span> defaultDataSource - Starting...
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.138  INFO 30284 --- [           main] com.zaxxer.hikari.<span class="token property">HikariDataSource</span>       <span class="token punctuation">:</span> defaultDataSource - Start completed.
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.166 DEBUG 30284 --- [           main] c.z.s.m.T.<span class="token property">queryAllTypeAndProduct</span>         <span class="token punctuation">:</span> ==&gt;  <span class="token property">Preparing</span><span class="token punctuation">:</span> select * from type<span class="token punctuation">;</span>
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.249 DEBUG 30284 --- [           main] c.z.s.m.T.<span class="token property">queryAllTypeAndProduct</span>         <span class="token punctuation">:</span> ==&gt; <span class="token property">Parameters</span><span class="token punctuation">:</span> 
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.370 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> ====&gt;  <span class="token property">Preparing</span><span class="token punctuation">:</span> select * from product where tid=?
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.372 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> ====&gt; <span class="token property">Parameters</span><span class="token punctuation">:</span> <span class="token function">1</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.396 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> &lt;====      <span class="token property">Total</span><span class="token punctuation">:</span> 3
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.414 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> ====&gt;  <span class="token property">Preparing</span><span class="token punctuation">:</span> select * from product where tid=?
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.415 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> ====&gt; <span class="token property">Parameters</span><span class="token punctuation">:</span> <span class="token function">2</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.419 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> &lt;====      <span class="token property">Total</span><span class="token punctuation">:</span> 2
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.420 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> ====&gt;  <span class="token property">Preparing</span><span class="token punctuation">:</span> select * from product where tid=?
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.421 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> ====&gt; <span class="token property">Parameters</span><span class="token punctuation">:</span> <span class="token function">3</span><span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.425 DEBUG 30284 --- [           main] c.z.s.mapper.ProductMapper.<span class="token property">queryByTid</span>    <span class="token punctuation">:</span> &lt;====      <span class="token property">Total</span><span class="token punctuation">:</span> 2
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.426 DEBUG 30284 --- [           main] c.z.s.m.T.<span class="token property">queryAllTypeAndProduct</span>         <span class="token punctuation">:</span> &lt;==      <span class="token property">Total</span><span class="token punctuation">:</span> 3
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.430 DEBUG 30284 --- [           main] c.zyh.springboot.mapper.<span class="token property">TypeMapperTest</span>   <span class="token punctuation">:</span> <span class="token function">Type</span><span class="token punctuation">(</span>id=1<span class="token punctuation">,</span> name=手机<span class="token punctuation">,</span> products=[<span class="token function">Product</span><span class="token punctuation">(</span>id=1<span class="token punctuation">,</span> name=华为手机<span class="token punctuation">,</span> price=5000.0<span class="token punctuation">,</span> sell=false<span class="token punctuation">,</span> cDate=Sun Jul 31 00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>00 CST 2022<span class="token punctuation">,</span> tid=1<span class="token punctuation">,</span> type=null<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Product</span><span class="token punctuation">(</span>id=2<span class="token punctuation">,</span> name=苹果手机<span class="token punctuation">,</span> price=9000.0<span class="token punctuation">,</span> sell=false<span class="token punctuation">,</span> cDate=Sat May 26 00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>00 CST 2012<span class="token punctuation">,</span> tid=1<span class="token punctuation">,</span> type=null<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Product</span><span class="token punctuation">(</span>id=8<span class="token punctuation">,</span> name=小米手机<span class="token punctuation">,</span> price=3000.0<span class="token punctuation">,</span> sell=true<span class="token punctuation">,</span> cDate=Sun Jul 31 00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>00 CST 2022<span class="token punctuation">,</span> tid=1<span class="token punctuation">,</span> type=null<span class="token punctuation">)</span>]<span class="token punctuation">)</span>
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.430 DEBUG 30284 --- [           main] c.zyh.springboot.mapper.<span class="token property">TypeMapperTest</span>   <span class="token punctuation">:</span> <span class="token function">Type</span><span class="token punctuation">(</span>id=2<span class="token punctuation">,</span> name=电脑<span class="token punctuation">,</span> products=[<span class="token function">Product</span><span class="token punctuation">(</span>id=3<span class="token punctuation">,</span> name=华为电脑<span class="token punctuation">,</span> price=8000.0<span class="token punctuation">,</span> sell=false<span class="token punctuation">,</span> cDate=Wed May 26 00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>00 CST 2010<span class="token punctuation">,</span> tid=2<span class="token punctuation">,</span> type=null<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Product</span><span class="token punctuation">(</span>id=4<span class="token punctuation">,</span> name=苹果电脑<span class="token punctuation">,</span> price=12000.0<span class="token punctuation">,</span> sell=false<span class="token punctuation">,</span> cDate=Sat Mar 10 00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>00 CST 2012<span class="token punctuation">,</span> tid=2<span class="token punctuation">,</span> type=null<span class="token punctuation">)</span>]<span class="token punctuation">)</span>
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.431 DEBUG 30284 --- [           main] c.zyh.springboot.mapper.<span class="token property">TypeMapperTest</span>   <span class="token punctuation">:</span> <span class="token function">Type</span><span class="token punctuation">(</span>id=3<span class="token punctuation">,</span> name=平板<span class="token punctuation">,</span> products=[<span class="token function">Product</span><span class="token punctuation">(</span>id=5<span class="token punctuation">,</span> name=华为平板<span class="token punctuation">,</span> price=2000.0<span class="token punctuation">,</span> sell=false<span class="token punctuation">,</span> cDate=Mon Apr 08 00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>00 CST 2019<span class="token punctuation">,</span> tid=3<span class="token punctuation">,</span> type=null<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Product</span><span class="token punctuation">(</span>id=6<span class="token punctuation">,</span> name=苹果平板<span class="token punctuation">,</span> price=6000.0<span class="token punctuation">,</span> sell=false<span class="token punctuation">,</span> cDate=Wed Mar 02 00<span class="token punctuation">:</span>00<span class="token punctuation">:</span>00 CST 2016<span class="token punctuation">,</span> tid=3<span class="token punctuation">,</span> type=null<span class="token punctuation">)</span>]<span class="token punctuation">)</span>
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.480  INFO 30284 --- [ionShutdownHook] com.zaxxer.hikari.<span class="token property">HikariDataSource</span>       <span class="token punctuation">:</span> defaultDataSource - Shutdown initiated...
2022-08-01 09<span class="token punctuation">:</span>35<span class="token punctuation">:</span>02.500  INFO 30284 --- [ionShutdownHook] com.zaxxer.hikari.<span class="token property">HikariDataSource</span>       <span class="token punctuation">:</span> defaultDataSource - Shutdown completed.
</code></pre>
<h1><a id="5Druid_317"></a>5.整合Druid</h1>
<h2><a id="51_318"></a>5.1传统获取连接的问题</h2>
<blockquote>
<p><font size="4">连接底层是socket连接，比较耗费时间，Java程序在连接数据库的时候，它的最大连接数也是有要求的，如果连接过多的话，可能数据库就崩了。 而且，效率还低。—可以自己去测试一下时间<br/> 所以，为了解决这个问题，我们引入了数据库连接池。<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/49dcb9f06da34d21a48462e8d1c45bf4.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/60c6e9bab7054008ac136439ef699f94.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/31e02da2cb274c42bf9815fab8d764a1.png"/></font></p>
</blockquote>
<h2><a id="52_324"></a>5.2数据库连接池</h2>
<blockquote>
<p><font size="4"><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/3789fe27ffb74dd5a5b7ea1f9af8d529.png"/><br/> <font size="4">接下来我对上面做一下解释<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/6aaca7e2507a4866a53db6bc75b2e9ca.png"/></font></font></p>
</blockquote>
<h2><a id="53_330"></a>5.3整合步骤</h2>
<p><font size="4">druid是alibaba的一个开源项目，是目前比较主流的数据库连接技术</font></p>
<h3><a id="531pom_333"></a>5.3.1引入pom依赖</h3>
<pre><code class="prism language-xml">   <span class="token comment">&lt;!-- druid --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3><a id="532druid_344"></a>5.3.2添加druid配置</h3>
<pre><code class="prism language-css"># 数据源名称
spring.datasource.name=com.alibaba.druid.pool.DruidDataSource
</code></pre>
<h3><a id="533_351"></a>5.3.3完整配置</h3>
<pre><code class="prism language-yml"><span class="token comment"># 指定Mybatis的Mapper接口的xml映射文件的路径</span>
mybatis.mapper<span class="token punctuation">-</span>locations=classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
<span class="token comment"># MySQL数据库驱动</span>
<span class="token comment">#这个驱动也可以省略，可以根据使用的MySQL自动加载相应的驱动</span>
spring.datasource.driver<span class="token punctuation">-</span>class<span class="token punctuation">-</span>name=com.mysql.cj.jdbc.Driver
<span class="token comment"># 数据源名称</span>
spring.datasource.name=com.alibaba.druid.pool.DruidDataSource
<span class="token comment"># 数据库连接地址</span>
spring.datasource.url=jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/bjpowernode<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;zeroDateTimeBehavior=convertToNull</span>
<span class="token comment"># 数据库用户名和密码</span>
spring.datasource.username=root
spring.datasource.password=123456
<span class="token comment"># 设置日志级别</span>
logging.level.com.zyh.springboot=debug
<span class="token comment"># 开启mybatis驼峰命名规则自动转换功能</span>
mybatis.configuration.map<span class="token punctuation">-</span>underscore<span class="token punctuation">-</span>to<span class="token punctuation">-</span>camel<span class="token punctuation">-</span>case=true
</code></pre>
<h3><a id="534_371"></a>5.3.4代码测试</h3>
<blockquote>
<p><font size="4"><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/714a1f0556bb46c3a66682a22b7c84c0.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/598c1aa07ead4c7dace35e6e1b94bdf6.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b966cc5c9c894cdfb85cc3b9b0f4362e.png"/></font></p>
</blockquote>
<h1><a id="6_380"></a>6.事务管理</h1>
<h2><a id="61_381"></a>6.1事务的概念</h2>
<ul><li><font size="4">事务我们可以理解成是在一系列的操作中，<font color="red">这些操作要么全部成功，要么全部不成功。</font></font></li><li><font size="4">最经典的就是银行的转帐问题，比如说张三要转账给李四，我们是不是得保证张三账户的转出和李四账户的转入操作要么都成功，要么都失败，如果一个成功一个失败，就会导致 <font color="red">转入金额和转出金额不一致</font> 的情况，为了防止这种情况，需要使用事务来处理。</font></li></ul>
<h2><a id="62ACID_385"></a>6.2事务的四大特性(ACID)</h2>
<table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>原子性(Atomicity）</td><td>事务是一个不可分割的单位，事务中包含的操作要么全部执行，要么全部不执行</td></tr><tr><td>一致性（Consistency）</td><td>事务执行前后数据的完整性必须保持一致。例如：在转账时，只有保证转出和转入的金额一致才能构成事务。也就是说事务发生前和发生后，数据的总额依然匹配。一致性是通过原子性来保证的</td></tr><tr><td>隔离性(Isolation)</td><td>一个事务不会影响其他事务的运行,多个事务并发要互相隔离。</td></tr><tr><td>持久性 (Durability)</td><td>在事务完成以后，该事务对数据库所作的更改将持久地保存在数据库之中，并不会被回滚。</td></tr></tbody></table>
<h2><a id="63_392"></a>6.3事务的隔离级别</h2>
<blockquote>
<p><font size="4">1. <code>Isolation.DEFAULT</code>: 以连接的数据库的事务隔离级别为主<br/> 2. <code>Isolation.READ_UNCOMMITTED</code>: 读未提交, 可以读取到未提交的事务, 存在脏读<br/> 3.<code> Isolation.READ_COMMITTED</code>: 读已提交, 只能读取到已经提交的事务, 解决了脏读, 但存在不可重复读<br/> 4 <code>Isolation.REPEATABLE_READ</code>: 可重复读, 解决了不可重复读, 但存在幻读<br/> 5.<code> Isolation.SERIALIZABLE</code>: 串行化, 可以解决所有并发问题, 但性能低</font></p>
</blockquote>
<h2><a id="64_399"></a>6.4事务的传播机制(图解)</h2>
<p><strong>Spring 事务传播机制定义了多个包含了事务的方法, 相互调用时, 事务是如何在这些方法间进行传递的</strong><br/> <font color="red">Spring 事务的传播机制包含以下 7 种 :</font></p>
<blockquote>
<p><font size="4">1. <code>Propagation.REQUIRED</code>: 默认的事务传播级别, 它表示如果A当前存在事务, B则使用该事务; 如果A当前没有事务,则B创建一个新的事务.<br/> 2.<code> Propagation.SUPPORTS</code>: 如果A当前存在事务, 则B使用该事务; 如果A当前没有事务, 则B以非事务的方式继续运行.<br/> 3.<code> Propagation.MANDATORY</code>: 如果A当前存在事务, 则B使用该事务; 如果A当前没有事务,则B抛出异常.<br/> 4.<code> Propagation.REQUIRES_NEW</code>: 表示创建一个新的事务, 如果A当前存在事务, 则把A当前事务挂起，B创建新事务，A如果没有事务，B创建一个新事务<br/> 5. <code>Propagation.NOT_SUPPORTED</code>: 以非事务方式运行, 如果A当前存在事务, 则把A当前事务挂起.B以非事务执行；如果A没有事务，则B以非事务执行<br/> 6. <code> Propagation.NEVER</code>: 以非事务方式运行, 如果A当前存在事务, 则抛出异常.如果A没有事务，则B以非事务执行<br/> 7. <code>Propagation.NESTED</code>: 嵌套的事务，自己会创建一个新事务，但是这个新事务并<code>不是自己单独提交的</code>，而是等待外层事务一起提交，所以事务B后面 事务 A中的其他代码如果造成了<code>rollback</code>则也会导致事务B <code>rollback</code><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/20bf3cde50364e098e5f3a24829cdeaf.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/8437c374d6874f2191e1ad4ae5e3174d.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/49a6733166424646abfb78802e07ce83.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1d8fb82bd38c40f4bf2b6b45cb75a33f.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2ad51ecedbb74200a2edc409a41b8c81.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b7141d1998a947358002cd614e372845.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/46949d186f054a698138657c5bc2f8bc.png"/></font></p>
</blockquote>
<h2><a id="65_428"></a>6.5事务的实现</h2>
<p><font size="4">Spring对数据库事务的支持有两种方式</font></p>
<ul><li>编程式事务管理:手动实现事务管理，需要通过TransactionManager手动管理事务</li><li>声明式事务管理:在service的方法实现上，用@Transaction注解进行事务管理</li></ul>
<h2><a id="66_433"></a>6.6代码实现</h2>
<blockquote>
<p><font color="red" size="4"><strong>事务操作的代码级别应该放在service层(涉及业务逻辑)</strong><br/> ①创建Spring Boot项目<br/> ②环境配置<br/> ③准备好数据库和表(dept)<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/7ace580fbd5b4e289b8dadf82c6523c3.png"/><br/> ④提供对应mapper接口和相关操作数据库方法，以及对应的实体类<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d37b2df69733495d9d9fae93bb047019.png"/><br/> ⑤准备service层<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/634c445ecc1147dca3be8693dc77343a.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/e1fc1623447f4abaa4a569de1b79a0ea.png"/><br/> ⑥测试<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4de49b7a2c424a0eac7eaa18915140a7.png"/><br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/fd469085f3374f99a783e21364268e2e.png"/></font></p>
</blockquote>
<blockquote>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/0bda1729a7f546039df43641a3c8703e.png"/></p>
</blockquote>
<h1><a id="7Mybatis_450"></a>7.Mybatis缓存</h1>
<h2><a id="71_451"></a>7.1使用缓存的原因</h2>
<p><font size="4">对于一些我们经常查询但是又不经常改变的数据，如果每次查询都要和数据库进行交互，会大大降低效率，因此我们可以使用缓存，把一些对结果影响不大但是经常查询的数据存放在内存中，从而减少和数据库的交互来提高效率。</font></p>
<h2><a id="72Mybatis_455"></a>7.2Mybatis的缓存分类</h2>
<ul><li>一级缓存 
  <ul><li>SqlSession级别的缓存</li><li>同一个SqlSession对象，在参数和SQL完全一样的情况下，只执行一次SQL语句(基本不用)</li></ul> </li><li>二级缓存 
  <ul><li>Mapper命名空间级别的缓存</li><li>二级缓存的作用域是同一个namespace映射文件内容，多个SqlSession共享</li></ul> </li></ul>
<h2><a id="73_Spring_BootMybatis_465"></a>7.3 Spring Boot对Mybatis的支持</h2>
<p>Spring Boot默认支持二级缓存<br/> Mybatis默认支持一级缓存</p>
<ul><li><font color="red">Mapper中的实体类需要实现序列化</font></li><li>注解式开发需要在Mapper接口添加<code>@CacheNamespace</code>,开启二级缓存</li><li>xml映射文件通过<code>&lt;cache/&gt;</code>,开启二级缓存</li><li>使用二级缓存的时候，sql语句的映射要么全部都是xml格式表示，要么都是注解表示，选中其中一种情况就可以</li><li><font color="red">在实际项目中，一般会使用Redis非关系型数据库作为缓存数据库</font></li></ul>
<h2><a id="74_474"></a>7.4代码实现</h2>
<p>首先是环境搭建，然后是代码实现<br/> 提供实体类</p>
<pre><code class="prism language-css"><span class="token atrule"><span class="token rule">@Data</span>
@AllArgsConstructor
@NoArgsConstructor
public class Dept implements Serializable</span> <span class="token punctuation">{<!-- --></span>
    private Integer deptno<span class="token punctuation">;</span>
    private String dname<span class="token punctuation">;</span>
    private String loc<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>提供对应的接口</p>
<pre><code class="prism language-css"><span class="token atrule"><span class="token rule">@Mapper</span>
@CacheNamespace
public interface DeptMapper</span> <span class="token punctuation">{<!-- --></span>
    //查询所有部门信息
    <span class="token atrule"><span class="token rule">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from dept "</span><span class="token punctuation">)</span>
    List&lt;Dept&gt; <span class="token function">queryAllDept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token punctuation">}</span>

</code></pre>
<p>测试</p>
<pre><code class="prism language-css"><span class="token atrule"><span class="token rule">@SpringBootTest</span>
@Slf4j
class DeptMapperTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token atrule"><span class="token rule">@Autowired</span>
    private DeptMapper deptMapper<span class="token punctuation">;</span></span>
    <span class="token atrule"><span class="token rule">@Test</span>
    public void <span class="token function">testQueryAllDept</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">{<!-- --></span>
        List&lt;Dept&gt; deptList = deptMapper.<span class="token function">queryAllDept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token selector">for (Dept dept:deptList)</span><span class="token punctuation">{<!-- --></span>

            log.<span class="token function">debug</span><span class="token punctuation">(</span>dept.<span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        List&lt;Dept&gt; deptList2 = deptMapper.<span class="token function">queryAllDept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token selector">for (Dept dept:deptList2)</span><span class="token punctuation">{<!-- --></span>
            log.<span class="token function">debug</span><span class="token punctuation">(</span>dept.<span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/07fe2aabbd714c21a9908ddd5e857193.png"/></p>
<h2><a id="75_533"></a>7.5缓存的底层细节(博客推荐)</h2>
<p>这部分内容，我推荐大家去看亦山大佬的博客，讲解很清楚<a href="https://blog.csdn.net/luanlouis/category_9263284.html">深入理解MyBatis原理</a><br/> 如果想要更透彻的理解的话，其实大家可以去看看计算机组成原理。</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>