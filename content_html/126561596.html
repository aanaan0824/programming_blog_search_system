<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p id="main-toc"><strong>目录</strong></p>
<p id="%E4%B8%80%E3%80%81%E6%95%B0%E4%BB%93%E5%88%86%E5%B1%82-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E6%95%B0%E4%BB%93%E5%88%86%E5%B1%82">一、数仓分层</a></p>
<p id="1%E3%80%81%C2%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%86%E5%B1%82-toc" style="margin-left:40px;"><a href="#1%E3%80%81%C2%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%86%E5%B1%82">1、 为什么要分层</a></p>
<p id="2%E3%80%81%E6%95%B0%E6%8D%AE%E9%9B%86%E5%B8%82%E5%92%8C%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%A6%82%E5%BF%B5-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E6%95%B0%E6%8D%AE%E9%9B%86%E5%B8%82%E5%92%8C%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%A6%82%E5%BF%B5">2、数据集市和数据仓库概念</a></p>
<p id="3%E3%80%81%E6%95%B0%E4%BB%93%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E6%95%B0%E4%BB%93%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83">3、数仓命名规范</a></p>
<p id="3.1%20%E8%A1%A8%E5%91%BD%E5%90%8D-toc" style="margin-left:80px;"><a href="#3.1%20%E8%A1%A8%E5%91%BD%E5%90%8D">3.1 表命名</a></p>
<p id="3.2%20%E8%84%9A%E6%9C%AC%E5%91%BD%E5%90%8D-toc" style="margin-left:80px;"><a href="#3.2%20%E8%84%9A%E6%9C%AC%E5%91%BD%E5%90%8D">3.2 脚本命名</a></p>
<p id="3.3%20%E8%A1%A8%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B-toc" style="margin-left:80px;"><a href="#3.3%20%E8%A1%A8%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B">3.3 表字段类型</a></p>
<p id="%E4%BA%8C%E3%80%81%E6%95%B0%E4%BB%93%E7%90%86%E8%AE%BA-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E6%95%B0%E4%BB%93%E7%90%86%E8%AE%BA">二、数仓理论</a></p>
<p id="1%E3%80%81%E8%8C%83%E5%BC%8F%E7%90%86%E8%AE%BA-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E8%8C%83%E5%BC%8F%E7%90%86%E8%AE%BA">1、范式理论</a></p>
<p id="1.1%20%E8%8C%83%E5%BC%8F%E6%A6%82%E5%BF%B5-toc" style="margin-left:80px;"><a href="#1.1%20%E8%8C%83%E5%BC%8F%E6%A6%82%E5%BF%B5">1.1 范式概念</a></p>
<p id="1.2%20%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96-toc" style="margin-left:80px;"><a href="#1.2%20%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96">1.2 函数依赖</a></p>
<p id="1.3%20%E4%B8%89%E8%8C%83%E5%BC%8F%E5%8C%BA%E5%88%86-toc" style="margin-left:80px;"><a href="#1.3%20%E4%B8%89%E8%8C%83%E5%BC%8F%E5%8C%BA%E5%88%86">1.3 三范式区分</a></p>
<p id="2%E3%80%81%E5%85%B3%E7%B3%BB%E5%BB%BA%E6%A8%A1%E4%B8%8E%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E5%85%B3%E7%B3%BB%E5%BB%BA%E6%A8%A1%E4%B8%8E%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1">2、关系建模与维度建模</a></p>
<p id="2.1%20%E5%85%B3%E7%B3%BB%E5%BB%BA%E6%A8%A1-toc" style="margin-left:80px;"><a href="#2.1%20%E5%85%B3%E7%B3%BB%E5%BB%BA%E6%A8%A1">2.1 关系建模</a></p>
<p id="2.2%20%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1-toc" style="margin-left:80px;"><a href="#2.2%20%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1">2.2 维度建模</a></p>
<p id="3%E3%80%81%E7%BB%B4%E5%BA%A6%E8%A1%A8%E5%92%8C%E4%BA%8B%E5%AE%9E%E8%A1%A8-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E7%BB%B4%E5%BA%A6%E8%A1%A8%E5%92%8C%E4%BA%8B%E5%AE%9E%E8%A1%A8">3、维度表和事实表</a></p>
<p id="3.1%20%E7%BB%B4%E5%BA%A6%E8%A1%A8-toc" style="margin-left:80px;"><a href="#3.1%20%E7%BB%B4%E5%BA%A6%E8%A1%A8">3.1 维度表</a></p>
<p id="3.2%20%E4%BA%8B%E5%AE%9E%E8%A1%A8-toc" style="margin-left:80px;"><a href="#3.2%20%E4%BA%8B%E5%AE%9E%E8%A1%A8">3.2 事实表</a></p>
<p id="4%E3%80%81%E7%BB%B4%E5%BA%A6%E6%A8%A1%E5%9E%8B%E5%88%86%E7%B1%BB%C2%A0-toc" style="margin-left:40px;"><a href="#4%E3%80%81%E7%BB%B4%E5%BA%A6%E6%A8%A1%E5%9E%8B%E5%88%86%E7%B1%BB%C2%A0">4、维度模型分类 </a></p>
<p id="5%E3%80%81%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E6%A8%A1-toc" style="margin-left:40px;"><a href="#5%E3%80%81%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E6%A8%A1">5、数据仓库建模</a></p>
<p id="5.1%20ODS%E5%B1%82-toc" style="margin-left:80px;"><a href="#5.1%20ODS%E5%B1%82">5.1 ODS层</a></p>
<p id="5.2%20DIM%E5%B1%82%E5%92%8CDWD%E5%B1%82-toc" style="margin-left:80px;"><a href="#5.2%20DIM%E5%B1%82%E5%92%8CDWD%E5%B1%82">5.2 DIM层和DWD层</a></p>
<p id="5.3%20DWS%E5%B1%82%E4%B8%8EDWT%E5%B1%82-toc" style="margin-left:80px;"><a href="#5.3%20DWS%E5%B1%82%E4%B8%8EDWT%E5%B1%82">5.3 DWS层与DWT层</a></p>
<p id="5.4%20ADS%E5%B1%82-toc" style="margin-left:80px;"><a href="#5.4%20ADS%E5%B1%82">5.4 ADS层</a></p>
<p id="%E4%B8%89%E3%80%81%E6%95%B0%E4%BB%93%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E6%95%B0%E4%BB%93%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">三、数仓环境搭建</a></p>
<p id="1%E3%80%81Hive%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-toc" style="margin-left:40px;"><a href="#1%E3%80%81Hive%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">1、Hive环境搭建</a></p>
<p id="1.1%20Hive-toc" style="margin-left:80px;"><a href="#1.1%20Hive">1.1 Hive</a></p>
<p id="1.2%20Hive%20on%20Spark-toc" style="margin-left:80px;"><a href="#1.2%20Hive%20on%20Spark">1.2 Hive on Spark</a></p>
<p id="1.3%20Hive%20on%20Spark-toc" style="margin-left:80px;"><a href="#1.3%20Hive%20on%20Spark">1.3 Hive on Spark</a></p>
<p id="2%E3%80%81Yarn%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#2%E3%80%81Yarn%E9%85%8D%E7%BD%AE">2、Yarn配置</a></p>
<p id="2.1%20%E5%A2%9E%E5%8A%A0ApplicationMaster%E8%B5%84%E6%BA%90%E6%AF%94%E4%BE%8B-toc" style="margin-left:80px;"><a href="#2.1%20%E5%A2%9E%E5%8A%A0ApplicationMaster%E8%B5%84%E6%BA%90%E6%AF%94%E4%BE%8B">2.1 增加ApplicationMaster资源比例</a></p>
<p id="3%E3%80%81%E6%95%B0%E4%BB%93%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E6%95%B0%E4%BB%93%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">3、数仓开发环境</a></p>
<p id="4%E3%80%81%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#4%E3%80%81%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87">4、数据准备</a></p>
<hr id="hr-toc"/>
<p></p>
<h1 id="%E4%B8%80%E3%80%81%E6%95%B0%E4%BB%93%E5%88%86%E5%B1%82">一、数仓分层</h1>
<h2 id="1%E3%80%81%C2%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%86%E5%B1%82">1、 为什么要分层</h2>
<p><img alt="" height="1200" src="image\30e0892de28d48ad8d9a825d9f804bac.png" width="1200"/></p>
<p></p>
<h2 id="2%E3%80%81%E6%95%B0%E6%8D%AE%E9%9B%86%E5%B8%82%E5%92%8C%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%A6%82%E5%BF%B5">2、数据集市和数据仓库概念</h2>
<p><img alt="" height="1200" src="image\38772e9915c14431b9419e80147d202a.png" width="1200"/></p>
<p></p>
<h2 id="3%E3%80%81%E6%95%B0%E4%BB%93%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83">3、数仓命名规范</h2>
<h3 id="3.1%20%E8%A1%A8%E5%91%BD%E5%90%8D">3.1 表命名</h3>
<ul><li style="text-align:justify;">ODS层命名为ods_表名</li><li style="text-align:justify;">DIM层命名为dim_表名</li><li style="text-align:justify;">DWD层命名为dwd_表名</li><li style="text-align:justify;">DWS层命名为dws_表名  </li><li style="text-align:justify;">DWT层命名为dwt_表名</li><li style="text-align:justify;">ADS层命名为ads_表名</li><li style="text-align:justify;">临时表命名为tmp_表名</li></ul>
<p style="text-align:justify;"></p>
<h3 id="3.2%20%E8%84%9A%E6%9C%AC%E5%91%BD%E5%90%8D" style="text-align:justify;">3.2 脚本命名</h3>
<ul><li style="text-align:justify;">数据源_to_目标_db/log.sh</li><li style="text-align:justify;">用户行为脚本以log为后缀；业务数据脚本以db为后缀。</li></ul>
<p style="text-align:justify;"></p>
<h3 id="3.3%20%E8%A1%A8%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B" style="text-align:justify;">3.3 表字段类型</h3>
<ul><li style="text-align:justify;">数量类型为bigint</li><li style="text-align:justify;">金额类型为decimal(16, 2)，表示：16位有效数字，其中小数部分2位</li><li style="text-align:justify;">字符串(名字，描述信息等)类型为string</li><li style="text-align:justify;">主键外键类型为string</li><li style="text-align:justify;">时间戳类型为bigint</li></ul>
<p style="text-align:justify;"></p>
<h1 id="%E4%BA%8C%E3%80%81%E6%95%B0%E4%BB%93%E7%90%86%E8%AE%BA" style="text-align:justify;">二、数仓理论</h1>
<h2 id="1%E3%80%81%E8%8C%83%E5%BC%8F%E7%90%86%E8%AE%BA">1、范式理论</h2>
<h3 id="1.1%20%E8%8C%83%E5%BC%8F%E6%A6%82%E5%BF%B5">1.1 范式概念</h3>
<p><img alt="" height="672" src="image\a41502e4d7144c19903ae17ed8d3c741.png" width="1111"/></p>
<p></p>
<h3 id="1.2%20%E5%87%BD%E6%95%B0%E4%BE%9D%E8%B5%96">1.2 函数依赖</h3>
<p><img alt="" height="1200" src="image\ff1b13cf5a6f4dabacc65c7b4100cc8e.png" width="1200"/></p>
<p></p>
<h3 id="1.3%20%E4%B8%89%E8%8C%83%E5%BC%8F%E5%8C%BA%E5%88%86">1.3 三范式区分</h3>
<p><strong>第一范式：</strong></p>
<p><img alt="" height="1200" src="image\87d0679e785340bab5991ab7c4dda00b.png" width="1200"/></p>
<p></p>
<p><strong>第二范式：</strong></p>
<p><img alt="" height="1200" src="image\6fc534f254cc4d87ad6c1a47e0fb7ea6.png" width="1200"/></p>
<blockquote>
<p>这里的部份依赖是和主键有关，再拆分成两张表的时候，不仅把部分依赖消除了，同时也消除了部分数据冗余</p>
</blockquote>
<p></p>
<p><strong>第三范式：</strong></p>
<p><img alt="" height="1096" src="image\afa93ce540ca48d09ab798a5d058d7e2.png" width="1200"/></p>
<p></p>
<h2 id="2%E3%80%81%E5%85%B3%E7%B3%BB%E5%BB%BA%E6%A8%A1%E4%B8%8E%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1">2、关系建模与维度建模</h2>
<p style="margin-left:0;text-align:justify;">关系建模和维度建模是两种数据仓库的建模技术。关系建模由Bill Inmon所倡导，维度建模由Ralph Kimball所倡导。</p>
<p style="margin-left:0;text-align:justify;"></p>
<h3 id="2.1%20%E5%85%B3%E7%B3%BB%E5%BB%BA%E6%A8%A1" style="margin-left:0px;text-align:justify;">2.1 关系建模</h3>
<p><img alt="" height="758" src="image\1048fed41fd940ac90ee6d6c0cc8c1b7.png" width="956"/></p>
<p></p>
<h3 id="2.2%20%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1">2.2 维度建模</h3>
<p><img alt="" height="887" src="image\2c6e05b8d2af4df3942278f1e153640e.png" width="1026"/></p>
<p></p>
<h2 id="3%E3%80%81%E7%BB%B4%E5%BA%A6%E8%A1%A8%E5%92%8C%E4%BA%8B%E5%AE%9E%E8%A1%A8">3、维度表和事实表</h2>
<h3 id="3.1%20%E7%BB%B4%E5%BA%A6%E8%A1%A8">3.1 维度表</h3>
<p style="margin-left:0;text-align:justify;"><strong>维度表</strong>：一般是对事实的<strong><span style="color:#ff0000;">描述信息</span></strong>。每一张维表对应现实世界中的一个对象或者概念。    例如：用户、商品、日期、地区等。</p>
<p style="margin-left:0;text-align:justify;"><img alt="" height="474" src="image\e787d8c67a8645c19239349d71df30f5.png" width="1068"/></p>
<p></p>
<h3 id="3.2%20%E4%BA%8B%E5%AE%9E%E8%A1%A8">3.2 事实表</h3>
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#000000;">事实表中的</span></strong><strong><span style="color:#ff0000;">每行数据代表一个业务事件（下单、支付、退款、评价等）</span></strong>。“事实”这个术语表示的是业务事件的<strong><span style="color:#ff0000;">度量值（可统计次数、个数、金额等）</span></strong>，例如，2020年5月21日，宋宋老师在京东花了250块钱买了一瓶海狗人参丸。维度表：时间、用户、商品、商家。事实表：250块钱、一瓶</p>
<p style="margin-left:0;text-align:justify;">每一个事实表的行包括：具有可加性的数值型的度量值、与维表相连接的外键，通常具有两个和两个以上的外键。</p>
<p style="margin-left:0;text-align:justify;">事实表的特征：</p>
<ul><li style="text-align:justify;">非常的大</li><li style="text-align:justify;">内容相对的窄：列数较少（主要是外键id和度量值）</li><li style="text-align:justify;">经常发生变化，每天会新增加很多。</li></ul>
<p><img alt="" height="785" src="image\d66293f62e7c497d9d00bed672b1c791.png" width="1038"/></p>
<p></p>
<h2 id="4%E3%80%81%E7%BB%B4%E5%BA%A6%E6%A8%A1%E5%9E%8B%E5%88%86%E7%B1%BB%C2%A0">4、维度模型分类 </h2>
<p>在维度建模的基础上又分为三种模型：星型模型、雪花模型、星座模型。</p>
<p><img alt="" height="785" src="image\4e3188bb946e4e66836d3d0d48cd6869.png" width="1200"/></p>
<p><img alt="" height="929" src="image\c42670c562fb4fc39cbb9e5982a1ea4c.png" width="1200"/></p>
<p></p>
<h2 id="5%E3%80%81%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E6%A8%A1">5、数据仓库建模</h2>
<h3 id="5.1%20ODS%E5%B1%82">5.1 ODS层</h3>
<p><img alt="" height="503" src="image\eff05d72e3ed4d579fa25e563a52d076.png" width="1146"/></p>
<p><img alt="" height="847" src="image\f51cd46ef5e248b182c88cd530acccb1.png" width="1170"/></p>
<p></p>
<h3 id="5.2%20DIM%E5%B1%82%E5%92%8CDWD%E5%B1%82">5.2 DIM层和DWD层</h3>
<p><img alt="" height="786" src="image\92723c7e309f4c2eb14472a166291c95.png" width="1190"/></p>
<p><img alt="" height="717" src="image\1d878c003c5d464bbcc4ab7dc357fb58.png" width="1200"/></p>
<p><img alt="" height="677" src="image\691649f7cb434782811d5cca101d490d.png" width="1200"/></p>
<p></p>
<h3 id="5.3%20DWS%E5%B1%82%E4%B8%8EDWT%E5%B1%82">5.3 DWS层与DWT层</h3>
<p><img alt="" height="916" src="image\b9e36bb6d5ff4754a58da0c8943c9278.png" width="1200"/></p>
<p></p>
<h3 id="5.4%20ADS%E5%B1%82">5.4 ADS层</h3>
<p>对电商系统各大主题指标分别进行分析。</p>
<p></p>
<h1 id="%E4%B8%89%E3%80%81%E6%95%B0%E4%BB%93%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">三、数仓环境搭建</h1>
<h2 id="1%E3%80%81Hive%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">1、Hive环境搭建</h2>
<h3 id="1.1%20Hive">1.1 Hive</h3>
<p style="margin-left:0;text-align:justify;">Hive引擎包括：默认MR、tez、spark</p>
<p style="margin-left:0;text-align:justify;">Hive on Spark：Hive既作为存储元数据又负责SQL的解析优化，<span style="color:#ff0000;">语法是</span><span style="color:#ff0000;">HQL</span><span style="color:#ff0000;">语法</span>，执行引擎变成了Spark，Spark负责采用RDD执行。</p>
<p style="margin-left:0;text-align:justify;">Spark on Hive : Hive只作为存储元数据，Spark负责SQL解析优化，<span style="color:#ff0000;">语法是</span><span style="color:#ff0000;">Spark SQL</span><span style="color:#ff0000;">语法</span>，Spark负责采用RDD执行。</p>
<p style="margin-left:0;text-align:justify;"></p>
<h3 id="1.2%20Hive%20on%20Spark" style="margin-left:0px;text-align:justify;">1.2 Hive on Spark</h3>
<p><img alt="" height="1198" src="image\f9a529dd312240e09dc6d5121fe372bd.png" width="1200"/></p>
<p><img alt="" height="1158" src="image\f4ee9301f070465783af321b8ebaba75.png" width="1200"/></p>
<p><img alt="" height="480" src="image\24c84a393564460491e55fb2d44a0527.png" width="1200"/></p>
<p></p>
<h3 id="1.3%20Hive%20on%20Spark">1.3 Hive on Spark</h3>
<p><img alt="" height="997" src="image\62de92bd286140e5b789e7c0748fccca.png" width="1200"/></p>
<p></p>
<h2 id="2%E3%80%81Yarn%E9%85%8D%E7%BD%AE">2、Yarn配置</h2>
<h3 id="2.1%20%E5%A2%9E%E5%8A%A0ApplicationMaster%E8%B5%84%E6%BA%90%E6%AF%94%E4%BE%8B">2.1 增加ApplicationMaster资源比例</h3>
<p><img alt="" height="938" src="image\1531b6e0d1844b1fa2088fcde1f3b399.png" width="1200"/></p>
<p></p>
<h2 id="3%E3%80%81%E6%95%B0%E4%BB%93%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">3、数仓开发环境</h2>
<p style="margin-left:0;text-align:justify;">数仓开发工具可选用DBeaver或者DataGrip。两者都需要用到JDBC协议连接到Hive，故需要启动HiveServer2。</p>
<p style="margin-left:0;text-align:justify;"></p>
<h2 id="4%E3%80%81%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87" style="margin-left:0px;text-align:justify;">4、数据准备</h2>
<p><img alt="" height="974" src="image\9cc1f750ff324e20992ea7d391c89de1.png" width="1200"/></p>
<p></p>
<p></p>
<p></p>
<p></p>
</div>
</div>