<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-light" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="CUDAWin10__CUDA_116__VS2019_0"></a>最新CUDA环境配置(Win10 + CUDA 11.6 + VS2019)</h1>
<p>本篇博客根据NVIDIA 官方文档所述, 并根据自己实践得出. 供各位需要的朋友参考.</p>
<h2><a id="1_4"></a>1.前言</h2>
<p>本篇文章的软件环境为:</p>
<ul><li>Windows 10</li><li>CUDA 11.6</li><li>VS2019</li></ul>
<p>CUDA是目前做人工智能, 深度学习等方向的必备工具库. 由CUDA衍生出的加速工具很多, 如: cuDNN, TensorRT, cuBLAS等HPC加速库, 或者涉及最新的元宇宙概念中的Omniverse等.</p>
<p>在很多时候, 非常多的NVIDIA加速库的底层加速方案都是CUDA. 我们可能在绝大多数时候不会直接利用CUDA写代码, 但是了解CUDA如何运转或者基本概念一定能让你如虎添翼.</p>
<p>如果大家感兴趣也可以查看本人翻译的官方的CUDA编程手册,希望能帮到大家.<br/> <a href="https://blog.csdn.net/kunhe0512/category_11774233.html">https://blog.csdn.net/kunhe0512/category_11774233.html</a></p>
<h2><a id="2VS_2019_17"></a>2.VS 2019</h2>
<p>对于VS, 我用的其实极少. 本人从一开始就被老板带进了Vim + Makefile的环境. 这里简单提一下.</p>
<p>目前我用的是VS2019, 大家可以根据自己需要下载所需版本, 下面是链接地址.<br/> <a href="https://visualstudio.microsoft.com/zh-hans/vs/">https://visualstudio.microsoft.com/zh-hans/vs/</a></p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/089c67cf98604249ab3e2d08bda60203.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>这里需要重点提的是, 尽量把使用C++的桌面开发选择上.后续在用CMake的时候会比较方便.</p>
<h2><a id="3CUDA_29"></a>3.CUDA下载</h2>
<p><strong>CUDA官方安装教程:</strong> <a href="https://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html">https://docs.nvidia.com/cuda/cuda-installation-guide-microsoft-windows/index.html</a></p>
<p><strong>CUDA Toolkit的下载:</strong> <a href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a></p>
<p>点击上述下载页面之后, 你会看到:<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ef4455fc7e68404f9351b8446ded5bf2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>你需要自己选择你的操作系统, 系统架构, 系统版本 和 安装方式.</p>
<p>选择完成之后, 点击 <strong>Download(2.5 GB)</strong> 的按钮,就可以下载了.</p>
<p>当然, 如果你想安装历史版本(更早期的版本), 那么也可以点击下面的<a href="https://developer.nvidia.com/cuda-toolkit-archive">Archive of Previous CUDA Releases</a>来下载, 操作方法同上.</p>
<p>下载好之后, 你就可以看到以下图标:</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/4587dc2356e7487aa6a5ae0660f38591.png#pic_center"/></p>
<h2><a id="4_50"></a>4.安装配置</h2>
<p>双击你下载的CUDA Toolkit, 你就会看到工具包的解压路径(推荐默认).</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/cfdfa02e7d534a5faba4f4e0afd33539.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_14,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>解压完毕之后, 就开始安装了, 接下来点击同意并继续:<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/d5a4cd2ac3a04de69ba9081f763cd892.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_19,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>接下来设置安装选项, 这里推荐点击自定义(特别是第一次安装):</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/1ab10017f72e477ca6ab28e4b05865ba.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>然后将能选的都选上, 很多东西可能你一开始用不上(比如nsight系统), 但是当你做的越来越多, 涉及的越来越深的时候就可能会用到.<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ad9c48d1570a429d81f62200349e942c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_19,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>然后选择安装路径, 这里也推荐默认, 毕竟是底层的调用库</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/2121664f9ba948e988fc607234107579.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>接下来就不用你在操作了, 直到CUDA Toolkit 安装完毕.</p>
<h2><a id="5_77"></a>5.环境变量</h2>
<p>右键点击我的电脑(此电脑) --&gt; 属性 --&gt; 高级系统设置 --&gt; 环境变量, 查看CUDA路径是否已经在系统中, 如果没有记得添加上.</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/837dd9eb32c948068e702490c60d3461.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<h2><a id="6CUDA_83"></a>6.测试CUDA安装是否成功</h2>
<p>利用(Win + R)–&gt;cmd, 打开系统终端命令行, 输入</p>
<pre><code>nvcc -V
</code></pre>
<p>如果你看到如下结果, 证明你的CUDA已经安装完毕.<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/ba965185ecda4fe2b2be14f1949c94e4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<h2><a id="7Visual_Studio_2019_CUDA_93"></a>7.利用Visual Studio 2019 进行CUDA程序开发</h2>
<p>打开已经安装好的VS 2019, 选择创建新项目:<br/> <img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/b05be6490c564322acefd265a635f3f1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>选择CUDA 11.xx Runtime, 这里的xx代表你的版本.</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5f25b932318c47e9a450a3b469bfdd31.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>给你的CUDA程序起个名字: <em><strong>Matrix_transpose</strong></em><br/> 这里的名字随便起的, 因为我后面要写一个矩阵转置的示例,所以才用Matrix_transpose这个名字</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/563e886a0180428e8ebc3b41e8cb168c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>创建之后, 你会发现里面已经有了一些代码, 那个是向量相加的示例. 你不用管他, 把kernel.cu中的代码删掉, 就可以开始你自己的开发了.</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5f6da1e78d6148ec9c5934b8bc43f29f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>你可以尝试输入一下代码, 完成一个矩阵转置的实例:</p>
<pre><code class="prism language-C++">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include "error.cuh"

#define TILE_DIM 32   //Don't ask me why I don't set these two values to one
#define BLOCK_SIZE 32
#define N 3001 // for huanhuan, you know that!

__managed__ int input_M[N * N];      //input matrix &amp; GPU result
int cpu_result[N * N];   //CPU result


//in-place matrix transpose
__global__ void ip_transpose(int* data)
{
    __shared__ int tile_s[TILE_DIM ][TILE_DIM + 1];
    __shared__ int tile_d[TILE_DIM ][TILE_DIM + 1];

    int x = blockIdx.x * TILE_DIM + threadIdx.x;
    int y = blockIdx.y * TILE_DIM + threadIdx.y;

    //Threads in the triangle below
    if (blockIdx.y &gt; blockIdx.x) {
        int dx = blockIdx.y * TILE_DIM + threadIdx.x;
        int dy = blockIdx.x * TILE_DIM + threadIdx.y;
        if (x &lt; N &amp;&amp; y &lt; N)
        {
            tile_s[threadIdx.y][threadIdx.x] = data[(y)*N + x];
        }
        if (dx &lt; N &amp;&amp; dy &lt; N)
        {
            tile_d[threadIdx.y][threadIdx.x] = data[(dy)*N + dx];
        }

        __syncthreads();
        if (dx &lt; N &amp;&amp; dy &lt; N)
        {
            data[(dy)*N + dx] = tile_s[threadIdx.x][threadIdx.y];
        }
        if (x &lt; N &amp;&amp; y &lt; N)
        {
            data[(y)*N + x] = tile_d[threadIdx.x][threadIdx.y];
        }
    }
    else if (blockIdx.y == blockIdx.x)//Threads on the diagonal
    {
        if (x &lt; N &amp;&amp; y &lt; N)
        {
            tile_s[threadIdx.y][threadIdx.x] = data[(y)*N + x];
        }
        __syncthreads();
        if (x &lt; N &amp;&amp; y &lt; N)
        {
            data[(y)*N + x] = tile_s[threadIdx.x][threadIdx.y];
        }
    }
}

void cpu_transpose(int* A, int* B)
{
    for (int j = 0; j &lt; N; j++)
    {
        for (int i = 0; i &lt; N; i++)
        {
            B[i * N + j] = A[j * N + i];
        }
    }
}

int main(int argc, char const* argv[])
{

    cudaEvent_t start, stop_gpu;
    CHECK(cudaEventCreate(&amp;start));
    CHECK(cudaEventCreate(&amp;stop_gpu));


    for (int i = 0; i &lt; N; ++i) {
        for (int j = 0; j &lt; N; ++j) {
            input_M[i * N + j] = rand() % 1000;
        }
    }
    cpu_transpose(input_M, cpu_result);

    CHECK(cudaEventRecord(start));
    unsigned int grid_rows = (N + BLOCK_SIZE - 1) / BLOCK_SIZE;
    unsigned int grid_cols = (N + BLOCK_SIZE - 1) / BLOCK_SIZE;
    dim3 dimGrid(grid_cols, grid_rows);
    dim3 dimBlock(BLOCK_SIZE, BLOCK_SIZE);
    ip_transpose &lt;&lt; &lt;dimGrid, dimBlock &gt;&gt; &gt; (input_M);
    CHECK(cudaDeviceSynchronize());
    CHECK(cudaEventRecord(stop_gpu));
    CHECK(cudaEventSynchronize(stop_gpu));

    float elapsed_time_gpu;
    CHECK(cudaEventElapsedTime(&amp;elapsed_time_gpu, start, stop_gpu));
    printf("Time_GPU = %g ms.\n", elapsed_time_gpu);

    CHECK(cudaEventDestroy(start));
    CHECK(cudaEventDestroy(stop_gpu));

    int ok = 1;
    for (int i = 0; i &lt; N; ++i)
    {
        for (int j = 0; j &lt; N; ++j)
        {
            if (fabs(input_M[i * N + j] - cpu_result[i * N + j]) &gt; (1.0e-10))
            {
                ok = 0;
            }
        }
    }


    if (ok)
    {
        printf("Pass!!!\n");
    }
    else
    {
        printf("Error!!!\n");
    }

    return 0;
}
</code></pre>
<p>点击运行之后, 你就可以看到如下结果:</p>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/a51bfe6fb507474a9e84c137fc11ecf5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5omr5Zyw55qE5bCP5L2V5bCa,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center"/></p>
<p>OK, 到这里你就完成了CUDA环境的搭建, 并且写了第一个CUDA程序</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>