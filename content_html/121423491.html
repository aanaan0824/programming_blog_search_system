<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p id="main-toc"><strong>目录</strong></p>
<p id="-toc" style="margin-left:0px;"></p>
<p id="%E5%AE%89%E8%A3%85SQLServer-toc" style="margin-left:0px;"><a href="#%E5%AE%89%E8%A3%85SQLServer">安装SQLServer</a></p>
<p id="%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE-toc" style="margin-left:0px;"><a href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE">创建新项目</a></p>
<p id="%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E8%A1%A8-toc" style="margin-left:0px;"><a href="#%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E8%A1%A8">建数据库建表</a></p>
<p id="%E7%AA%97%E4%BD%93%E8%AE%BE%E8%AE%A1-toc" style="margin-left:0px;"><a href="#%E7%AA%97%E4%BD%93%E8%AE%BE%E8%AE%A1">窗体设计</a></p>
<p id="%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-toc" style="margin-left:0px;"><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">代码实现</a></p>
<p id="%C2%A0%E6%95%B4%E4%BD%93%E6%95%88%E6%9E%9C-toc" style="margin-left:0px;"><a href="#%C2%A0%E6%95%B4%E4%BD%93%E6%95%88%E6%9E%9C"> 整体效果</a></p>
<p id="%E2%80%8B-toc" style="margin-left:0px;"><a href="#%E2%80%8B">​</a></p>
<hr id="hr-toc"/>
<h1 id="%E5%AE%89%E8%A3%85SQLServer">安装SQLServer</h1>
<p>用SQLServer连接Visual Studio,首先需要下载SQLServer app。</p>
<p>下载教程，我之前写过，可以点击如下链接先下载安装SQLServer：</p>
<p><img alt="" height="26" src="image\58cb5f9eeda443f78a904bbe59627eff.png" width="25"/></p>
<p><a class="link-info" href="https://blog.csdn.net/weixin_45906196/article/details/121206306?spm=1001.2014.3001.5501" title="SQL Server(express)安装教程">SQL Server(express)安装教程</a></p>
<p></p>
<h1 id="%E5%88%9B%E5%BB%BA%E6%96%B0%E9%A1%B9%E7%9B%AE">创建新项目</h1>
<p></p>
<p>安装好SQL之后，打开VisualStudio2019，新建一个window项目</p>
<p>，步骤如下：选择<strong>创建新项目 </strong></p>
<p><img alt="" height="850" src="image\1b097ad913824d519bd47691a807c61f.png" width="1200"/></p>
<p>选择<strong>Windows窗体应用(.NET Framework)  </strong>点击下一步。</p>
<p><img alt="" height="850" src="image\06545e72fa654123a558794b672bcf01.png" width="1200"/></p>
<p>给文件命名为：<strong>WinFormsApplicationStudentManagement </strong>,点击下一步</p>
<p> <img alt="" height="850" src="image\d561746864d54206b94f9b478d221c65.png" width="1200"/></p>
<p> 点击创建，就建好了</p>
<p><img alt="" height="850" src="image\dc4c8450e27c4cba80fd2a84cfece6ea.png" width="1200"/></p>
<h1 id="%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BB%BA%E8%A1%A8">建数据库建表</h1>
<p>项目建好之后我们先连接数据库。</p>
<p>1.找到服务器资源管理器</p>
<p>2.找到数据连接，右键，添加连接</p>
<p><img alt="" height="1039" src="image\6ed4872150b64e1f95621de8ee244a1d.png" width="1200"/></p>
<p>数据源选择<strong>Microsoft SQL Server数据库文件（SqlClient）</strong></p>
<p>数据库文件名输入<strong>StudentManagement </strong>这是我们创建的数据库的名称</p>
<p>登录方式身份验证，选<strong>Windows身份验证</strong></p>
<p>点击<strong>确定</strong></p>
<p><img alt="" height="1039" src="image\d0a5e91948da44589e7fb2a3a3c75c25.png" width="1200"/></p>
<p>点击<strong>是 </strong>这样就建好了数据库</p>
<p><img alt="" height="1039" src="image\a526b01a02064488804cf48e9b2bbf2a.png" width="1200"/></p>
<p> 下面我们新建两个表。</p>
<p>一个student表，存储学号(主键）、姓名、年龄、分数。</p>
<p>一个college表，存储专业号（主键），和专业名。</p>
<p>按照步骤：</p>
<p>选择刚建好的数据库，双击打开。</p>
<p>打开后找到表，右键，选择<strong>添加新表</strong>。</p>
<p><img alt="" height="1039" src="image\573edea0cf9743259ffc2de800a5485b.png" width="1200"/></p>
<p> 添加新表后，会出现如下界面：</p>
<p><img alt="" height="1039" src="image\bd9d3b649c3f457587a2684ee9b477dd.png" width="1200"/></p>
<p>按照我这样设计表，设计完成后，点击<strong>更新  </strong>注意要更改表名。</p>
<p><img alt="" height="1039" src="image\197399ba5c314d80a0ae6b22dc58b0fc.png" width="1200"/> 点击更新后，会出现如下界面：点击<strong>更新数据库</strong>即可。</p>
<p><img alt="" height="1039" src="image\a4bee10aab6c43f3850ba614d4387cfe.png" width="1200"/></p>
<p></p>
<p>点击更新数据库按钮。</p>
<p><img alt="" height="1039" src="image\dcd8c4a3277343e1b43498c6f52dba19.png" width="1200"/></p>
<p> 这是刷新之后的样子，能看到刚才建立的student表。</p>
<p><img alt="" height="1039" src="image\3a222c16cecc4a31abbb4739d5cb9cda.png" width="1200"/></p>
<p> 同样方法，我们新建一个college表。</p>
<p><img alt="" height="1039" src="image\4439cbf9dbb148be8bc42ead7b3ccdc9.png" width="1200"/></p>
<p> 这是college表建好之后的样子。</p>
<p><img alt="" height="1039" src="image\8815edbf40934f9ba29942db4db5fa95.png" width="1200"/></p>
<h1 id="%E7%AA%97%E4%BD%93%E8%AE%BE%E8%AE%A1">窗体设计</h1>
<p>表建好了，我们开始设计窗体。</p>
<p>打开<strong>Form1.cs[Design]</strong></p>
<p>设计如下页面</p>
<p><img alt="" height="1039" src="image\071af39050c14c95a375576a50757293.png" width="1200"/></p>
<p> 布局如下：</p>
<p><img alt="" height="1039" src="image\ef86f99d5f61418780bb7537bfa693c2.png" width="1200"/></p>
<p>组件在<strong>工具箱</strong>中添加；</p>
<p>组件name text 事件在<strong>属性</strong>中编辑</p>
<p>左部：name=groupbox1 text=学生列表</p>
<p>中间：name=groupbox2 text=学生详情</p>
<p>右边：name=groupbox3 text=操作</p>
<p>下边：richtextbox name=rtxtStudentList</p>
<p>写完是这样的。</p>
<p><img alt="" height="1039" src="image\be930dff5161424dae16e72c9f5b6c2c.png" width="1200"/></p>
<p> 再来设计里面的界面：</p>
<p></p>
<p><img alt="" height="1039" src="image\b4667dd82eaa47229cd2e6a86249e68b.png" width="1200"/></p>
<p>设计好之后</p>
<p>给<strong>label</strong>改text 分别改成 学号 姓名 年龄 分数</p>
<p>给<strong>textbox</strong>改name 分别是txtId txtName txtAge txtScore</p>
<p>给<strong>button</strong>改name和text</p>
<p>name分别改成 btnnew btnInsert btnUpdate btnDelete btnSave</p>
<p>text分别改成 新建 插入 更新 删除 保存</p>
<p>给<strong>ComboBox</strong>改name改成cboColleges</p>
<p><img alt="" height="1039" src="image\a896ee4fe79643efbe42057da4bf655d.png" width="1200"/></p>
<p> 忘了，学生列表里还要建一个listbox 名字是listStudent</p>
<p><img alt="" height="1039" src="image\5495322118dd41afa82fd31e6d56de96.png" width="1200"/></p>
<p> 布局部分完成了。</p>
<p>开始写代码了。</p>
<h1 id="%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">代码实现</h1>
<p>我们使用的是Sqlconnection连接数据库，所以要新增引用</p>
<p>using System.Data.SqlClient;</p>
<p><img alt="" height="1039" src="image\d53a56df3c254372812dfc9f293c418f.png" width="1200"/></p>
<p>找到数据库，右键属性，找到连接字符串，全选复制到代码中。</p>
<p><img alt="" height="1039" src="image\be8f5f0d89064fa6ab10ce3003ddcb49.png" width="1200"/></p>
<p> 我这是连好的：</p>
<p><img alt="" height="1039" src="image\e506ee9186c243a7bdc678164063b1e8.png" width="1200"/></p>
<p>之后的代码如下：</p>
<pre><code class="language-cs">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using System.Data.SqlClient;

namespace WindowsFormsApplicationNonetSql
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
            LoadDatabase();
            BindStudentList();
            BindCollegeList();
        }
        string connectionString = @"Data Source=pc\sqlexpress;Initial Catalog=ailintext;Integrated Security=True";

        DataSet dataSet = new DataSet();

        DataTable students;
        DataTable colleges;
        private void BindStudentList()
        {

            listStudent.SelectedIndexChanged -= listStudent_SelectedIndexChanged;
            listStudent.DataSource = students;
            listStudent.DisplayMember = "student_name";
            listStudent.ValueMember = "student_id";
            listStudent.SelectedIndexChanged += listStudent_SelectedIndexChanged;

        }
        private void BindCollegeList()
        {

            listStudent.SelectedIndexChanged -= cboColleges_SelectedIndexChanged;
            cboColleges.DataSource = colleges;
            cboColleges.DisplayMember = "college_name";
            cboColleges.ValueMember = "college_id";
            listStudent.SelectedIndexChanged += cboColleges_SelectedIndexChanged;

        }

        private void LoadDatabase()
        {
            SqlConnection connection =new SqlConnection(connectionString);

            string selectCommand = "select * from student";

            SqlCommand command = new SqlCommand();
            command.CommandText = selectCommand;
            command.Connection = connection;
            //适配器
            SqlDataAdapter studentAdapter = new SqlDataAdapter();
            studentAdapter.SelectCommand = command;
            //读入数据 适配器填充数据
            studentAdapter.Fill(dataSet, "student");

            students = dataSet.Tables["student"];
            /*command.CommandText = "select * from college";*/

            /* SqlDataAdapter collegeAdapter = new SqlDataAdapter(command);
             collegeAdapter.Fill(dataSet, "college");

             colleges = dataSet.Tables["college"];*/
            students.PrimaryKey = new DataColumn[]
            {
               students.Columns["student_id"]
            };


            selectCommand = "select * from college";
            command.CommandText = selectCommand;

            SqlDataAdapter collegeAdapter = new SqlDataAdapter();
            collegeAdapter.SelectCommand = command;

            collegeAdapter.Fill(dataSet, "college");
            colleges = dataSet.Tables["college"];

            colleges.PrimaryKey = new DataColumn[]
            {
                colleges.Columns["college_id"]
            };
            DataRelation dr = new DataRelation(
                "FK_student_college",
                colleges.Columns["college_id"],
                students.Columns["college_id"]);

            dataSet.Relations.Add(dr);
        }

        private void listStudent_SelectedIndexChanged(object sender, EventArgs e)
        {
            //点击学生姓名，返回学生信息
            if (listStudent.SelectedIndex &lt; 0)
            {
                return ;
            }
            //拿到信息
            DataRow student = students.Rows.Find(listStudent.SelectedValue);
            //显示信息
            txtId.Text = student["student_id"].ToString();
            txtName.Text = student["student_name"].ToString();
            txtAge.Text = student["student_age"].ToString();
            txtScore.Text = student["student_score"].ToString();

            cboColleges.SelectedValue = student["college_id"];

        }

        private void btnnew_Click(object sender, EventArgs e)
        {
            txtId.Text = string.Empty;
            txtName.Text = string.Empty;
            txtAge.Text = string.Empty;
            txtScore.Text = string.Empty;
        }

        private void btnInsert_Click(object sender, EventArgs e)
        {
            DataRow newStudent = students.NewRow();

            newStudent["student_id"] = txtId.Text;
            newStudent["student_name"] = txtName.Text;
            newStudent["student_age"] = txtAge.Text;
            newStudent["student_score"] = txtScore.Text;

            students.Rows.Add(newStudent);
        }

        private void btnUpdate_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrEmpty(txtId.Text))
            {
                return;
            }

            listStudent.SelectedIndexChanged -= listStudent_SelectedIndexChanged;

            DataRow oldStudent = students.Rows.Find(txtId.Text);

            oldStudent["student_id"] = txtId.Text;
            oldStudent["student_name"] = txtName.Text;
            oldStudent["student_age"] = txtAge.Text;
            oldStudent["student_score"] = txtScore.Text;

            if (cboColleges.SelectedIndex &gt;= 0)
            {
                oldStudent["college_id"] = cboColleges.SelectedValue;
            }
            listStudent.SelectedIndexChanged += listStudent_SelectedIndexChanged;
        }

        private void btnSave_Click(object sender, EventArgs e)
        {
            SqlConnection connection = new SqlConnection(connectionString);

            string selectCommand = "select * from student";

            SqlCommand command = new SqlCommand();
            //command.CommandText = "select * from student";
            command.CommandText = selectCommand;
            command.Connection = connection;
            //适配器
            SqlDataAdapter studentAdapter = new SqlDataAdapter();
            studentAdapter.SelectCommand = command;
            //
            SqlCommandBuilder studentCommandBuilder = new SqlCommandBuilder();
            studentCommandBuilder.DataAdapter = studentAdapter;

            studentAdapter.Update(students);
        }

        private void btnDelete_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrEmpty(txtId.Text))
            {
                return;
            }
            DataRow oldStudent = students.Rows.Find(txtId.Text);
            oldStudent.Delete();
        }

        private void cboColleges_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (cboColleges.SelectedIndex &lt; 0)
            {
                return;
            }

            DataRow college = colleges.Rows.Find(cboColleges.SelectedValue);

            string s = string.Empty;

            foreach(var item in college.GetChildRows(dataSet.Relations["FK_student_college"]))
            {
                s += item["student_id"] + "\t" + item["student_name"];
            }
            rtxtStudentList.Text = s;
        }
    }
}
//单表改</code></pre>
<h1 id="%C2%A0%E6%95%B4%E4%BD%93%E6%95%88%E6%9E%9C"> 整体效果</h1>
<h1 id="%E2%80%8B" style="text-align:center;"><img alt="" src="https://img-blog.csdnimg.cn/0bf2bcde301a48abb8fe7f1ffd9d47c0.gif"/></h1>
<p>源码下载：</p>
<blockquote>
<p>链接：https://pan.baidu.com/s/1AksyhybGOjPy_3sgX_YqYw<br/> 提取码：5ae1</p>
</blockquote>
<p>用我的代码 改一下数据库连接字符串即可。仍有问题可以私信我，看到就回~</p>
</div>
</div>