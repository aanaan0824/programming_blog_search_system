<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="htmledit_views" id="content_views">
<p id="main-toc"><strong>目录</strong></p>
<p id="-toc" style="margin-left:0px;"></p>
<p id="1.%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%9A%84%E6%B5%81%E7%A8%8B-toc" style="margin-left:0px;"><a href="#1.%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%9A%84%E6%B5%81%E7%A8%8B">1.微信支付的流程</a></p>
<p id="2.%E5%BE%AE%E4%BF%A1%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3-toc" style="margin-left:0px;"><a href="#2.%E5%BE%AE%E4%BF%A1%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3">2.微信的接口文档</a></p>
<p id="3.%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAspring-boot%E7%9A%84%E9%A1%B9%E7%9B%AE-toc" style="margin-left:0px;"><a href="#3.%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAspring-boot%E7%9A%84%E9%A1%B9%E7%9B%AE">3.新建一个spring-boot的项目</a></p>
<p id="4.%E5%AF%BC%E5%85%A5%E9%9C%80%E8%A6%81%E7%9A%84%E4%BE%9D%E8%B5%96%C2%A0-toc" style="margin-left:0px;"><a href="#4.%E5%AF%BC%E5%85%A5%E9%9C%80%E8%A6%81%E7%9A%84%E4%BE%9D%E8%B5%96%C2%A0">4.导入需要的依赖 </a></p>
<p id="%C2%A05.%E9%85%8D%E7%BD%AEapplication%E6%96%87%E4%BB%B6-toc" style="margin-left:0px;"><a href="#%C2%A05.%E9%85%8D%E7%BD%AEapplication%E6%96%87%E4%BB%B6"> 5.配置application文件</a></p>
<p id="6.%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHttpclient%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB-%E9%BB%98%E8%AE%A4%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8-toc" style="margin-left:0px;"><a href="#6.%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHttpclient%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB-%E9%BB%98%E8%AE%A4%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8">6.创建一个Httpclient的工具类-默认浏览器进行远程调用</a></p>
<p id="7.%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%99%A8--%E5%B8%AE%E6%88%91%E4%BB%AC%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%B1%BB%2C%E6%8E%A5%E5%8F%A3%E7%AD%89-toc" style="margin-left:0px;"><a href="#7.%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%99%A8--%E5%B8%AE%E6%88%91%E4%BB%AC%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%B1%BB%2C%E6%8E%A5%E5%8F%A3%E7%AD%89">7.自动生成器--帮我们自动生成类,接口等</a></p>
<p id="8.%20%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81-toc" style="margin-left:0px;"><a href="#8.%20%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81">8. 前端代码</a></p>
<p id="8.1.%E6%96%B0%E5%BB%BAvue%E9%A1%B9%E7%9B%AE-toc" style="margin-left:40px;"><a href="#8.1.%E6%96%B0%E5%BB%BAvue%E9%A1%B9%E7%9B%AE">8.1.新建vue项目</a></p>
<p id="8.1.1.%E6%89%93%E5%BC%80cmd%E5%91%BD%E4%BB%A4%E7%AA%97%E5%8F%A3%2C%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E6%89%93%E5%BC%80%E7%AA%97%E5%8F%A3-toc" style="margin-left:80px;"><a href="#8.1.1.%E6%89%93%E5%BC%80cmd%E5%91%BD%E4%BB%A4%E7%AA%97%E5%8F%A3%2C%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E6%89%93%E5%BC%80%E7%AA%97%E5%8F%A3">8.1.1.打开cmd命令窗口,输入命令打开窗口</a></p>
<p id="8.1.2.%20%E6%96%B0%E5%BB%BA-toc" style="margin-left:80px;"><a href="#8.1.2.%20%E6%96%B0%E5%BB%BA">8.1.2. 新建</a></p>
<p id="8.2.%E5%AE%89%E8%A3%85element%E6%8F%92%E4%BB%B6%E5%92%8Caxios%E7%9A%84%E4%BE%9D%E8%B5%96(%E7%9C%81%E7%95%A5)-toc" style="margin-left:40px;"><a href="#8.2.%E5%AE%89%E8%A3%85element%E6%8F%92%E4%BB%B6%E5%92%8Caxios%E7%9A%84%E4%BE%9D%E8%B5%96%28%E7%9C%81%E7%95%A5%29">8.2.安装element插件和axios的依赖(省略)</a></p>
<p id="8.3.%E5%BC%95%E5%85%A5axios%E5%92%8C%E8%AE%BE%E7%BD%AEaxios%E5%9F%BA%E7%A1%80%E8%B7%AF%E5%BE%84-toc" style="margin-left:40px;"><a href="#8.3.%E5%BC%95%E5%85%A5axios%E5%92%8C%E8%AE%BE%E7%BD%AEaxios%E5%9F%BA%E7%A1%80%E8%B7%AF%E5%BE%84">8.3.引入axios和设置axios基础路径</a></p>
<p id="8.4.%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2-toc" style="margin-left:40px;"><a href="#8.4.%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2">8.4.前端页面</a></p>
<p id="9.%E6%A0%B9%E6%8D%AE%E8%AE%A2%E5%8D%95%E5%8F%B7%E5%88%9B%E5%BB%BA%E4%BA%8C%E7%BB%B4%E7%A0%81--%E5%90%8E%E7%AB%AF-toc" style="margin-left:0px;"><a href="#9.%E6%A0%B9%E6%8D%AE%E8%AE%A2%E5%8D%95%E5%8F%B7%E5%88%9B%E5%BB%BA%E4%BA%8C%E7%BB%B4%E7%A0%81--%E5%90%8E%E7%AB%AF">9.根据订单号创建二维码--后端</a></p>
<p id="9.1.controller%E5%B1%82-toc" style="margin-left:40px;"><a href="#9.1.controller%E5%B1%82">9.1.controller层</a></p>
<p id="9.2.Iservice-toc" style="margin-left:40px;"><a href="#9.2.Iservice">9.2.Iservice</a></p>
<p id="9.3.service%E5%B1%82-toc" style="margin-left:40px;"><a href="#9.3.service%E5%B1%82">9.3.service层</a></p>
<p id="9.4.%E5%AE%9E%E4%BD%93%E7%B1%BB-toc" style="margin-left:40px;"><a href="#9.4.%E5%AE%9E%E4%BD%93%E7%B1%BB">9.4.实体类</a></p>
<p id="9.4.1.CommonResult-toc" style="margin-left:80px;"><a href="#9.4.1.CommonResult">9.4.1.CommonResult</a></p>
<p id="9.4.2.Order-toc" style="margin-left:80px;"><a href="#9.4.2.Order">9.4.2.Order</a></p>
<p id="10.%E6%A0%B9%E6%8D%AE%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E6%9F%A5%E8%AF%A2%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E6%83%85%E5%86%B5-toc" style="margin-left:0px;"><a href="#10.%E6%A0%B9%E6%8D%AE%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E6%9F%A5%E8%AF%A2%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E6%83%85%E5%86%B5">10.根据订单状态查询微信支付情况</a></p>
<p id="10.1.%E5%89%8D%E7%AB%AF-toc" style="margin-left:40px;"><a href="#10.1.%E5%89%8D%E7%AB%AF">10.1.前端</a></p>
<p id="10.2.%E5%90%8E%E7%AB%AF-toc" style="margin-left:40px;"><a href="#10.2.%E5%90%8E%E7%AB%AF">10.2.后端</a></p>
<p id="10.2.1.controller-toc" style="margin-left:80px;"><a href="#10.2.1.controller">10.2.1.controller</a></p>
<p id="10.2.2.Iservice-toc" style="margin-left:80px;"><a href="#10.2.2.Iservice">10.2.2.Iservice</a></p>
<p id="10.2.3.service%E5%B1%82-toc" style="margin-left:80px;"><a href="#10.2.3.service%E5%B1%82">10.2.3.service层</a></p>
<hr id="hr-toc"/>
<p></p>
<h1 id="1.%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%9A%84%E6%B5%81%E7%A8%8B">1.微信支付的流程</h1>
<p><img alt="" height="408" src="image\4a995251c1894e91968463a88a788e74.png" width="867"/></p>
<p></p>
<h1 id="2.%E5%BE%AE%E4%BF%A1%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3">2.微信的接口文档</h1>
<p><a href="https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_1" title="https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_1">https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_1</a></p>
<h1 id="3.%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAspring-boot%E7%9A%84%E9%A1%B9%E7%9B%AE">3.新建一个spring-boot的项目</h1>
<p><img alt="" height="582" src="image\1835c36b0e8042c786af3a6aae5146fa.png" width="492"/></p>
<h1 id="4.%E5%AF%BC%E5%85%A5%E9%9C%80%E8%A6%81%E7%9A%84%E4%BE%9D%E8%B5%96%C2%A0">4.导入需要的依赖 </h1>
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.3.12.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;springboot&lt;/groupId&gt;
    &lt;artifactId&gt;demo&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;WeChatPay&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;!--微信需要的依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.github.wxpay&lt;/groupId&gt;
            &lt;artifactId&gt;wxpay-sdk&lt;/artifactId&gt;
            &lt;version&gt;0.0.3&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--java端发送的请求  在java端远程模拟浏览器能访问微信的接口--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;repMaven.org.apache.httpcomponents&lt;/groupId&gt;
            &lt;artifactId&gt;httpclient&lt;/artifactId&gt;
            &lt;version&gt;4.5.3&lt;/version&gt;
        &lt;/dependency&gt;
        
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt;
            &lt;version&gt;3.5.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.freemarker&lt;/groupId&gt;
            &lt;artifactId&gt;freemarker&lt;/artifactId&gt;
            &lt;version&gt;2.3.31&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--mybatis-plus的依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.5.2&lt;/version&gt;
        &lt;/dependency&gt;
 
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.2.8&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--swagger的依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;
            &lt;artifactId&gt;swagger-bootstrap-ui&lt;/artifactId&gt;
            &lt;version&gt;1.9.6&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--spring的依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.spring4all&lt;/groupId&gt;
            &lt;artifactId&gt;swagger-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;1.9.1.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
 
 
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.2.2&lt;/version&gt;
        &lt;/dependency&gt;
 
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
 
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
 
&lt;/project&gt;</code></pre>
<h1 id="%C2%A05.%E9%85%8D%E7%BD%AEapplication%E6%96%87%E4%BB%B6"> 5.配置application文件</h1>
<pre><code class="language-html">server.port=8888
spring.datasource.druid.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.druid.password=****
spring.datasource.druid.url=jdbc:mysql://localhost:3306/wechatpay?serverTimezone=Asia/Shanghai
 
#微信app的id 商家的id 秘钥--我们自己没有办法申请，因为申请需要营业执照
weixin.appid=wx8087d8149331d27c
weixin.mch_id=1532192611
weixin.api_key=Cc158380629071583806290715838062</code></pre>
<h1 id="6.%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHttpclient%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB-%E9%BB%98%E8%AE%A4%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8">6.创建一个Httpclient的工具类-默认浏览器进行远程调用</h1>
<pre><code class="language-java">package springboot.util;
 
 
import org.apache.http.Consts;
import org.apache.http.HttpEntity;
import org.apache.http.NameValuePair;
import org.apache.http.client.ClientProtocolException;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.*;
import org.apache.http.conn.ssl.SSLConnectionSocketFactory;
import org.apache.http.conn.ssl.SSLContextBuilder;
import org.apache.http.conn.ssl.TrustStrategy;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.util.EntityUtils;
 
import javax.net.ssl.SSLContext;
import java.io.IOException;
import java.security.cert.CertificateException;
import java.security.cert.X509Certificate;
import java.text.ParseException;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
 
/**
 * http请求客户端
 * 
 * @author 必须引入httpclient的依赖：在java端模拟浏览器的效果。
 * 
 */
public class HttpClient {
   private String url;
   private Map&lt;String, String&gt; param;
   private int statusCode;
   private String content;
   private String xmlParam;
   private boolean isHttps;
   public boolean isHttps() {
      return isHttps;
   }
   public void setHttps(boolean isHttps) {
      this.isHttps = isHttps;
   }
   public String getXmlParam() {
      return xmlParam;
   }
   public void setXmlParam(String xmlParam) {
      this.xmlParam = xmlParam;
   }
   public HttpClient(String url, Map&lt;String, String&gt; param) {
      this.url = url;
      this.param = param;
   }
   public HttpClient(String url) {
      this.url = url;
   }
   public void setParameter(Map&lt;String, String&gt; map) {
      param = map;
   }
   public void addParameter(String key, String value) {
      if (param == null)
         param = new HashMap&lt;String, String&gt;();
      param.put(key, value);
   }
   public void post() throws ClientProtocolException, IOException {
      HttpPost http = new HttpPost(url);
      setEntity(http);
      execute(http);
   }
   public void put() throws ClientProtocolException, IOException {
      HttpPut http = new HttpPut(url);
      setEntity(http);
      execute(http);
   }
   public void get() throws ClientProtocolException, IOException {
      if (param != null) {
         StringBuilder url = new StringBuilder(this.url);
         boolean isFirst = true;
         for (String key : param.keySet()) {
            if (isFirst)
               url.append("?");
            else
               url.append("&amp;");
            url.append(key).append("=").append(param.get(key));
         }
         this.url = url.toString();
      }
      HttpGet http = new HttpGet(url);
      execute(http);
   }
   /**
    * set http post,put param
    */
   private void setEntity(HttpEntityEnclosingRequestBase http) {
      if (param != null) {
         List&lt;NameValuePair&gt; nvps = new LinkedList&lt;NameValuePair&gt;();
         for (String key : param.keySet())
            nvps.add(new BasicNameValuePair(key, param.get(key))); // 参数
         http.setEntity(new UrlEncodedFormEntity(nvps, Consts.UTF_8)); // 设置参数
      }
      if (xmlParam != null) {
         http.setEntity(new StringEntity(xmlParam, Consts.UTF_8));
      }
   }
   private void execute(HttpUriRequest http) throws ClientProtocolException,
         IOException {
      CloseableHttpClient httpClient = null;
      try {
         if (isHttps) {
            SSLContext sslContext = new SSLContextBuilder()
                  .loadTrustMaterial(null, new TrustStrategy() {
                     // 信任所有
                     public boolean isTrusted(X509Certificate[] chain,
                           String authType)
                           throws CertificateException {
                        return true;
                     }
                  }).build();
            SSLConnectionSocketFactory sslsf = new SSLConnectionSocketFactory(
                  sslContext);
            httpClient = HttpClients.custom().setSSLSocketFactory(sslsf)
                  .build();
         } else {
            httpClient = HttpClients.createDefault();
         }
         CloseableHttpResponse response = httpClient.execute(http);
         try {
            if (response != null) {
               if (response.getStatusLine() != null)
                  statusCode = response.getStatusLine().getStatusCode();
               HttpEntity entity = response.getEntity();
               // 响应内容
               content = EntityUtils.toString(entity, Consts.UTF_8);
            }
         } finally {
            response.close();
         }
      } catch (Exception e) {
         e.printStackTrace();
      } finally {
         httpClient.close();
      }
   }
   public int getStatusCode() {
      return statusCode;
   }
   public String getContent() throws ParseException, IOException {
      return content;
   }
}</code></pre>
<h1 id="7.%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%99%A8--%E5%B8%AE%E6%88%91%E4%BB%AC%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%B1%BB%2C%E6%8E%A5%E5%8F%A3%E7%AD%89">7.自动生成器--帮我们自动生成类,接口等</h1>
<pre><code class="language-java">public class Generator {
    public static void main(String[] args) {
        FastAutoGenerator.create("jdbc:mysql://localhost:3306/wechatpay?serverTimezone=Asia/Shanghai", "root", "****" +
                "")//你的数据库账号密码
                .globalConfig(builder -&gt; {
                    builder.author("guan") // 设置作者
                            .enableSwagger() // 开启 swagger 模式
                            .fileOverride() // 覆盖已生成文件
                            .outputDir(".\\src\\main\\java\\"); // 指定输出目录
                })
                .packageConfig(builder -&gt; {
                    builder.parent("springboot") // 设置父包名
                            .moduleName("system") // 设置父包模块名
                            .pathInfo(Collections.singletonMap(OutputFile.xml, "src\\main\\resources\\mapper\\")); // 设置mapperXml生成路径
                })
                .strategyConfig(builder -&gt; {
                    builder.addInclude("t_order")// 设置需要生成的表名
                            .addTablePrefix("t_"); // 设置过滤表前缀
                })
                .templateEngine(new FreemarkerTemplateEngine()) // 使用Freemarker引擎模板，默认的是Velocity引擎模板
                .execute();
 
    }</code></pre>
<h1 id="8.%20%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81">8. 前端代码</h1>
<h2 id="8.1.%E6%96%B0%E5%BB%BAvue%E9%A1%B9%E7%9B%AE"><a name="t8"></a>8.1.新建vue项目</h2>
<h3 id="8.1.1.%E6%89%93%E5%BC%80cmd%E5%91%BD%E4%BB%A4%E7%AA%97%E5%8F%A3%2C%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E6%89%93%E5%BC%80%E7%AA%97%E5%8F%A3"><a name="t9"></a>8.1.1.打开cmd命令窗口,输入命令打开窗口</h3>
<blockquote>
<p>vue ui</p>
</blockquote>
<h3 id="8.1.2.%20%E6%96%B0%E5%BB%BA">8.1.2. 新建</h3>
<p><img alt="" height="158" src="image\680e62a5718f483d99db13ec848cd127.png" width="708"/></p>
<p><img alt="" height="514" src="image\b7687a7617b44b36b6c8c0981d76a684.png" width="727"/></p>
<p></p>
<h2 id="8.2.%E5%AE%89%E8%A3%85element%E6%8F%92%E4%BB%B6%E5%92%8Caxios%E7%9A%84%E4%BE%9D%E8%B5%96(%E7%9C%81%E7%95%A5)">8.2.安装element插件和axios的依赖(省略)</h2>
<h2 id="8.3.%E5%BC%95%E5%85%A5axios%E5%92%8C%E8%AE%BE%E7%BD%AEaxios%E5%9F%BA%E7%A1%80%E8%B7%AF%E5%BE%84"><a name="t12"></a>8.3.引入axios和设置axios基础路径</h2>
<blockquote>
<p>//引入axios<br/> import axios from "axios";<br/> Vue.config.productionTip = false<br/> //设置axios基础路径<br/> axios.defaults.baseURL="http://localhost:8888"</p>
<p>Vue.prototype.axios=axios;</p>
</blockquote>
<h2 id="8.4.%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2">8.4.前端页面</h2>
<pre><code class="language-html">&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;el-button type="primary" @click="pay"&gt;支付&lt;/el-button&gt;
    &lt;!--二维码的弹出层--&gt;
    &lt;el-dialog
            title="收银台"
            :visible.sync="dislogVisible"
            width="30%"&gt;
      &lt;div style="text-align: center"&gt;
        &lt;p&gt;微信支付{<!-- -->{payResult.price}}元&lt;/p&gt;
        &lt;div style="border: 1px solid #f3f3f3; width: 220px;padding: 0px;margin: 0px auto"&gt;
          &lt;!--使用vue-qr--&gt;
          &lt;vue-qr
                  :text="payResult.codeUrl"
                  :margin="0"
                  colorDark="green"
                  :logo="require('@/assets/logo.png')"
                  colorLight="#fff"
                  :size="200"&gt;
 
          &lt;/vue-qr&gt;
        &lt;/div&gt;
 
      &lt;/div&gt;
      &lt;el-divider&gt;&lt;/el-divider&gt;
      &lt;div style="font-size: 13px;"&gt;
        提示:&lt;br&gt;
        二维码两小时内有效，请及时扫码支付&lt;br&gt;
      &lt;/div&gt;
 
    &lt;/el-dialog&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
  //引入vue-qr
  import vueQr from 'vue-qr'
  export default {
    name: 'app',
    //注册vue-qr
    components:{
      vueQr
    },
    data(){
      return{
        orderNo:"c60801fbdd2d45f9adg",
        codeUrl:"",
        //定时器
        timer1:"",
        dislogVisible:false,
        //得到响应的结果
        payResult:{
          //价格
          price:0,
          //二维码路径  借助vue-qr 可以把二维码地址转为二维码图片
          codeUrl:"",
 
          orderNo:"",
        }
 
      }
    },
    methods:{
 
      pay(){
        this.dislogVisible=true;
        this.axios.post("/system/order/createNavite/"+this.orderNo).then(result=&gt;{
          if(result.data.code===2000){
            console.log(result)
            this.payResult=result.data.data;
            //设置一个定时器任务,每隔3秒调用一次
            this.timer1=setInterval(()=&gt;{
              this.queryPayStatus(this.payResult.orderNo)
            },3000);
          }
 
        })
      }
    }
  }
&lt;/script&gt;
 
&lt;style&gt;
 
 
&lt;/style&gt;</code></pre>
<h1 id="9.%E6%A0%B9%E6%8D%AE%E8%AE%A2%E5%8D%95%E5%8F%B7%E5%88%9B%E5%BB%BA%E4%BA%8C%E7%BB%B4%E7%A0%81--%E5%90%8E%E7%AB%AF">9.根据订单号创建二维码--后端</h1>
<h2 id="9.1.controller%E5%B1%82"><a name="t15"></a>9.1.controller层</h2>
<pre><code class="language-java">@CrossOrigin
@RestController
@RequestMapping("/system/order")
public class OrderController {
    //自动注入
    @Autowired
    private IOrderService orderService;
    //根据订单号创建二维码
    @RequestMapping("createNavite/{orderNo}")
    public CommonResult createNative(@PathVariable String orderNo){
        return orderService.createNative(orderNo);
    }
   
}</code></pre>
<h2 id="9.2.Iservice">9.2.Iservice</h2>
<pre><code class="language-java">CommonResult createNative(String orderNo);</code></pre>
<h2 id="9.3.service%E5%B1%82">9.3.service层</h2>
<pre><code class="language-java">@Service
public class OrderServiceImpl extends ServiceImpl&lt;OrderMapper, Order&gt; implements IOrderService {
    @Autowired
    private OrderMapper orderMapper;
    @Value("${weixin.appid}")
    private String appId;
    @Value("${weixin.mch_id}")
    private String mchId;
    @Value("${weixin.api_key}")
    private String apikey;
    @Override
    public CommonResult createNative(String orderNo) {
        //1.根据订单号查询出订单信息
        QueryWrapper wrapper=new QueryWrapper();
        //前端传过来的订单号跟数据库中的订单号一致
        wrapper.eq("order_no",orderNo);
        //订单状态为0
        wrapper.eq("status",0);
        Order order=orderMapper.selectOne(wrapper);
        //判断订单信息不为空
        if (order != null) {
            try {
                //接口里面的参数要的是xml类型
                //设置请求的参数个数格式为xml格式
                //将请求参数封装成map
                Map&lt;String, String&gt; params = new HashMap&lt;&gt;();
                //添加公众账号Id
                params.put("appid", appId);
                //添加商品号
                params.put("mch_id", mchId);
                //添加随机字符串--微信自带算法
                params.put("nonce_str", WXPayUtil.generateNonceStr());
                //添加商品描述
                params.put("body", order.getCourseTitle());
                //添加商品订单号
                params.put("out_trade_no", orderNo);
                //添加标价金额 --单位是分，要转换
                params.put("total_fee", new BigDecimal(0.01).multiply(new BigDecimal(100)).longValue() + "");
                //添加终端ip
                params.put("spbill_create_ip", "127.0.0.1");
                //添加通知地址
                params.put("notify_url", "http://localhost:8888/pay/back");
                //添加交易类型
                params.put("trade_type", "NATIVE");
 
                //创建HttpClient对象--作用远程调用
                HttpClient client = new HttpClient("https://api.mch.weixin.qq.com/pay/unifiedorder");
                //支持https协议
                client.setHttps(true);
                //将map转为xml格式--设置请求的参数
                client.setXmlParam(WXPayUtil.generateSignedXml(params,apikey));
                //发送请求
                client.post();
                //获取请求响应响应的结果
                String content = client.getContent();
                System.out.println(content);
                //将String类型转换为map返货给前端
                Map&lt;String, String&gt; map = WXPayUtil.xmlToMap(content);
                if (map.get("result_code").equals("SUCCESS")){
                    Map&lt;String,Object&gt; result=new HashMap&lt;&gt;();
                    result.put("codeUrl",map.get("code_url"));
                    result.put("price",order.getTotalFee());
                    result.put("orderNo",orderNo);
                    return new CommonResult(2000,"生成二维码",result);
                }
 
            }catch (Exception e){
                e.printStackTrace();
            }
 
        }
        return new CommonResult(5000,"订单失效",null);
 
    }
    }</code></pre>
<h2 id="9.4.%E5%AE%9E%E4%BD%93%E7%B1%BB">9.4.实体类</h2>
<h3 id="9.4.1.CommonResult"><a name="t19"></a>9.4.1.CommonResult</h3>
<pre><code class="language-java">@Data
@NoArgsConstructor
@AllArgsConstructor
@ApiModel("返回同一的信息")
public class CommonResult {
    @ApiModelProperty("状态码 2000成功，5000失败")
    private int code;
    @ApiModelProperty("信息")
    private String msg;
    @ApiModelProperty("数据")
    private Object data;
}</code></pre>
<h3 id="9.4.2.Order">9.4.2.Order</h3>
<pre><code class="language-java">package springboot.system.entity;
 
import com.baomidou.mybatisplus.annotation.TableName;
import java.io.Serializable;
import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.Date;
 
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
 
/**
 * &lt;p&gt;
 * 订单
 * &lt;/p&gt;
 *
 * @author guan
 * @since 2022-08-13
 */
@TableName("t_order")
@ApiModel(value = "Order对象", description = "订单")
public class Order implements Serializable {
 
    private static final long serialVersionUID = 1L;
 
    private String id;
 
    @ApiModelProperty("订单号")
    private String orderNo;
 
    @ApiModelProperty("课程id")
    private String courseId;
 
    @ApiModelProperty("课程名称")
    private String courseTitle;
 
    @ApiModelProperty("课程封面")
    private String courseCover;
 
    @ApiModelProperty("讲师名称")
    private String teacherName;
 
    @ApiModelProperty("会员id")
    private String memberId;
 
    @ApiModelProperty("会员昵称")
    private String nickname;
 
    @ApiModelProperty("会员手机")
    private String mobile;
 
    @ApiModelProperty("订单金额（分）")
    private BigDecimal totalFee;
 
    @ApiModelProperty("支付类型（0：微信 1：支付宝）")
    private Integer payType;
 
    @ApiModelProperty("订单状态（0：未支付 1：已支付）")
    private Integer status;
 
    @ApiModelProperty("逻辑删除 1（true）已删除， 0（false）未删除")
    private Boolean isDeleted;
 
    @ApiModelProperty("创建时间")
    private LocalDateTime gmtCreate;
 
    @ApiModelProperty("更新时间")
    private LocalDateTime gmtModified;
 
    public String getId() {
        return id;
    }
 
    public void setId(String id) {
        this.id = id;
    }
    public String getOrderNo() {
        return orderNo;
    }
 
    public void setOrderNo(String orderNo) {
        this.orderNo = orderNo;
    }
    public String getCourseId() {
        return courseId;
    }
 
    public void setCourseId(String courseId) {
        this.courseId = courseId;
    }
    public String getCourseTitle() {
        return courseTitle;
    }
 
    public void setCourseTitle(String courseTitle) {
        this.courseTitle = courseTitle;
    }
    public String getCourseCover() {
        return courseCover;
    }
 
    public void setCourseCover(String courseCover) {
        this.courseCover = courseCover;
    }
    public String getTeacherName() {
        return teacherName;
    }
 
    public void setTeacherName(String teacherName) {
        this.teacherName = teacherName;
    }
    public String getMemberId() {
        return memberId;
    }
 
    public void setMemberId(String memberId) {
        this.memberId = memberId;
    }
    public String getNickname() {
        return nickname;
    }
 
    public void setNickname(String nickname) {
        this.nickname = nickname;
    }
    public String getMobile() {
        return mobile;
    }
 
    public void setMobile(String mobile) {
        this.mobile = mobile;
    }
    public BigDecimal getTotalFee() {
        return totalFee;
    }
 
    public void setTotalFee(BigDecimal totalFee) {
        this.totalFee = totalFee;
    }
    public Integer getPayType() {
        return payType;
    }
 
    public void setPayType(Integer payType) {
        this.payType = payType;
    }
    public Integer getStatus() {
        return status;
    }
 
    public void setStatus(Integer status) {
        this.status = status;
    }
    public Boolean getIsDeleted() {
        return isDeleted;
    }
 
    public void setIsDeleted(Boolean isDeleted) {
        this.isDeleted = isDeleted;
    }
    public LocalDateTime getGmtCreate() {
        return gmtCreate;
    }
 
    public void setGmtCreate(LocalDateTime gmtCreate) {
        this.gmtCreate = gmtCreate;
    }
    public LocalDateTime getGmtModified() {
        return gmtModified;
    }
 
    public void setGmtModified(LocalDateTime gmtModified) {
        this.gmtModified = gmtModified;
    }
 
    @Override
    public String toString() {
        return "Order{" +
            "id=" + id +
            ", orderNo=" + orderNo +
            ", courseId=" + courseId +
            ", courseTitle=" + courseTitle +
            ", courseCover=" + courseCover +
            ", teacherName=" + teacherName +
            ", memberId=" + memberId +
            ", nickname=" + nickname +
            ", mobile=" + mobile +
            ", totalFee=" + totalFee +
            ", payType=" + payType +
            ", status=" + status +
            ", isDeleted=" + isDeleted +
            ", gmtCreate=" + gmtCreate +
            ", gmtModified=" + gmtModified +
        "}";
    }
}</code></pre>
<h1 id="10.%E6%A0%B9%E6%8D%AE%E8%AE%A2%E5%8D%95%E7%8A%B6%E6%80%81%E6%9F%A5%E8%AF%A2%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E6%83%85%E5%86%B5">10.根据订单状态查询微信支付情况</h1>
<h2 id="10.1.%E5%89%8D%E7%AB%AF"><a name="t22"></a>10.1.前端</h2>
<pre><code class="language-html"> //根据订单号查询支付状态
      queryPayStatus(orderNo){
      this.axios.post("system/order/queryPayStatus/"+orderNo).then(result=&gt;{
        if (result.data.code===2000){
 
          //清除定时器
          clearInterval(this.timer1)
          this.timer1=null;
          this.$message.success("支付成功")
          //关闭弹出层
          this.dislogVisible=false;
        }
      })
      },</code></pre>
<h2 id="10.2.%E5%90%8E%E7%AB%AF">10.2.后端</h2>
<h3 id="10.2.1.controller"><a name="t24"></a>10.2.1.controller</h3>
<pre><code class="language-java"> @RequestMapping("queryPayStatus/{orderNo}")
    public CommonResult queryPayStatus(@PathVariable String orderNo){
        return orderService.queryPayStatus(orderNo);
    }</code></pre>
<h3 id="10.2.2.Iservice">10.2.2.Iservice</h3>
<pre><code class="language-java"> CommonResult queryPayStatus(String orderNo);</code></pre>
<h3 id="10.2.3.service%E5%B1%82">10.2.3.service层</h3>
<pre><code class="language-java"> @Override
    public CommonResult queryPayStatus(String orderNo) {
        //1.根据订单状态查询微信支付情况
        try {
            HttpClient client=new HttpClient("https://api.mch.weixin.qq.com/pay/orderquery");
            //设置参数--分装成map在转为xml格式
            Map&lt;String, String&gt; params = new HashMap&lt;&gt;();
            //添加公众账号Id
            params.put("appid", appId);
            //添加商品号
            params.put("mch_id", mchId);
            //添加商品订单号
            params.put("out_trade_no",orderNo);
            //添加随机字符串
            params.put("nonce_str",WXPayUtil.generateNonceStr());
            //支持Https
            client.setHttps(true);
            client.setXmlParam(WXPayUtil.generateSignedXml(params,apikey));
            client.post();
            String content = client.getContent();
            //转换为map
            Map&lt;String, String&gt; map = WXPayUtil.xmlToMap(content);
            if (map.get("trade_state").equals("SUCCESS")){
                //1.修改订单的状态
                Order order=new Order();
                order.setStatus(1);
                order.setGmtModified(LocalDateTime.now() );
                QueryWrapper&lt;Order&gt; wrapper=new QueryWrapper&lt;&gt;();
                //根据订单号
                wrapper.eq("order_no",orderNo);
                wrapper.eq("status",0);
                orderMapper.update(order,wrapper);
                return new CommonResult(2000,"支付成功",null);
            }
 
        }catch (Exception e){
            e.printStackTrace();
        }
 
        return new CommonResult(5000,"支付失败",null);
    }</code></pre>
<p></p>
</div>
</div>