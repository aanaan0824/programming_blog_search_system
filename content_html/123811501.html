<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p>因开发插件需要，将另一个网站的数据通过AJAX添加到ThinkPHP制作 的一个网站上的购物车。<br/> 需要网站支持跨域请求同步COOKE，具体操作如下：<br/> /public/index.php<br/> 第二行添加以下代码：<br/> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        A
       
       
        C
       
       
        A
       
       
        O
       
       
        
         =
        
        
         ′
        
       
       
        
         ∗
        
        
         ′
        
       
       
        ;
       
       
        h
       
       
        e
       
       
        a
       
       
        d
       
       
        e
       
       
        r
       
       
        (
       
       
        "
       
       
        A
       
       
        c
       
       
        c
       
       
        e
       
       
        s
       
       
        s
       
       
        −
       
       
        C
       
       
        o
       
       
        n
       
       
        t
       
       
        r
       
       
        o
       
       
        l
       
       
        −
       
       
        A
       
       
        l
       
       
        l
       
       
        o
       
       
        w
       
       
        −
       
       
        C
       
       
        r
       
       
        e
       
       
        d
       
       
        e
       
       
        n
       
       
        t
       
       
        i
       
       
        a
       
       
        l
       
       
        s
       
       
        :
       
       
        t
       
       
        r
       
       
        u
       
       
        e
       
       
        "
       
       
        )
       
       
        ;
       
       
        /
       
       
        /
       
       
        允
       
       
        许
       
       
        C
       
       
        O
       
       
        O
       
       
        K
       
       
        I
       
       
        E
       
       
        共
       
       
        享
       
       
        h
       
       
        e
       
       
        a
       
       
        d
       
       
        e
       
       
        r
       
       
        (
       
       
        "
       
       
        X
       
       
        D
       
       
        o
       
       
        m
       
       
        a
       
       
        i
       
       
        n
       
       
        R
       
       
        e
       
       
        q
       
       
        u
       
       
        e
       
       
        s
       
       
        t
       
       
        A
       
       
        l
       
       
        l
       
       
        o
       
       
        w
       
       
        e
       
       
        d
       
       
        :
       
       
        1
       
       
        "
       
       
        )
       
       
        ;
       
       
        /
       
       
        /
       
       
        允
       
       
        许
       
       
        C
       
       
        O
       
       
        O
       
       
        K
       
       
        I
       
       
        E
       
       
        共
       
       
        享
       
       
        I
       
       
        E
       
       
        i
       
       
        f
       
       
        (
       
       
        !
       
       
        e
       
       
        m
       
       
        p
       
       
        t
       
       
        y
       
       
        (
       
      
      
       ACAO = '*'; header("Access-Control-Allow-Credentials: true"); //允许COOKIE共享 header("XDomainRequestAllowed: 1"); //允许COOKIE共享IE if(!empty(
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel"><span class="mrel">=</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00189em; vertical-align: -0.25em;"></span><span class="mord"><span class="mbin">∗</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mopen">(</span><span class="mord">"</span><span class="mord mathdefault">A</span><span class="mord mathdefault">c</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.77777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.77777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mord">"</span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mord">/</span><span class="mord cjk_fallback">允</span><span class="mord cjk_fallback">许</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord cjk_fallback">共</span><span class="mord cjk_fallback">享</span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mopen">(</span><span class="mord">"</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mord mathdefault" style="margin-right: 0.02778em;">D</span><span class="mord mathdefault">o</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mord">"</span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mord">/</span><span class="mord cjk_fallback">允</span><span class="mord cjk_fallback">许</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord cjk_fallback">共</span><span class="mord cjk_fallback">享</span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mopen">(</span><span class="mclose">!</span><span class="mord mathdefault">e</span><span class="mord mathdefault">m</span><span class="mord mathdefault">p</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mopen">(</span></span></span></span></span>_SERVER[‘HTTP_ORIGIN’])) $ACAO = $_SERVER[‘HTTP_ORIGIN’] ;<br/> header(“Access-Control-Allow-Origin: $ACAO”);<br/> // header(“Access-Control-Allow-Origin: *”);<br/> header(“Access-Control-Allow-Credentials: true”);//是否允许后续请求携带认证信息（cookies）,该值只能是true,否则不返回<br/> header(“Access-Control-Allow-Methods: GET, POST, OPTIONS”);<br/> header(“Access-Control-Allow-Headers: Origin, No-Cache, X-Requested-With, If-Modified-Since, Pragma, Last-Modified, Cache-Control, Expires, Content-Type, X-E4M-With, X-Ds-Key”);<br/> header(“P3P: CP=CURa ADMa DEVa PSAo PSDo OUR BUS UNI PUR INT DEM STA PRE COM NAV OTC NOI DSP COR”);</p>
<p>/thinkphp/library/think/Cookie.php<br/> 的<span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        
        
         C
        
       
       
        O
       
       
        O
       
       
        K
       
       
        I
       
       
        E
       
       
        [
       
      
      
       _COOKIE[
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class=""></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mord mathdefault" style="margin-right: 0.05764em;">E</span><span class="mopen">[</span></span></span></span></span>name] = $value;下添加</p>
<p><span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: cookie = "{<!-- --></span>var}={<!-- --><span class="katex--inline">KaTeX parse error: Expected 'EOF', got '}' at position 6: value}̲"; if(</span>time) <span class="katex--inline"><span class="katex"><span class="katex-mathml">
    
     
      
       
        c
       
       
        o
       
       
        o
       
       
        k
       
       
        i
       
       
        e
       
       
        .
       
       
        =
       
       
        "
       
       
        ;
       
       
        e
       
       
        x
       
       
        p
       
       
        i
       
       
        r
       
       
        e
       
       
        s
       
       
        =
       
       
        "
       
       
        .
       
       
        g
       
       
        m
       
       
        s
       
       
        t
       
       
        r
       
       
        f
       
       
        t
       
       
        i
       
       
        m
       
       
        e
       
       
        (
       
       
        "
       
      
      
       cookie .= "; expires=".gmstrftime("%A, %d-%b-%Y %H:%M:%S GMT",
      
     
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord">"</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">"</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault">m</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord">"</span></span></span></span></span>time + 86400)."";<br/> if($path) <span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …ie .= "; path={<!-- --></span>path}";<br/> if($host) <span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: … .= "; domain={<!-- --></span>host}";<br/> $cookie .= “; SameSite=None”;<br/> <span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …("Set-Cookie: {<!-- --></span>cookie}");</p>
<p>即可。<br/> 注意事项：</p>
<p>跨域Cookie要求带SameSite=None; Secure<br/> 而Secure属性要求当前页面必须是HTTPS<br/> 所以在HTTP下发送带Secure参数的Cookie会被浏览器忽略<br/> 导致不是https时登录或语言切换设置Cookie无法记录<br/> 而在https下切换语言和登录会正常.<br/> 解决方案：<br/> 在以下文件添加代码<br/> /application/当前模板名/index/view/common/meta.html</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>