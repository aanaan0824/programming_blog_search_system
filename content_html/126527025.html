<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/f9e7290d231c413fbc3f595656951ea9.gif#pic_center"/></p>
<blockquote>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/7e2fbc76b4204f17a877e3ec28ae9696.jpeg#pic_center"/><br/> ğŸ<code>åšå®¢ä¸»é¡µï¼š</code><a href="https://blog.csdn.net/qq_43514330?type=blog">@ä¸ä¼šå‹å¼¯çš„å°é£ä¾ </a><br/> âœ¨<code>æ¬¢è¿å…³æ³¨ï¼š</code>ğŸ‘‰<code>ç‚¹èµ</code>ğŸ‘<code>æ”¶è—</code>â­<code>ç•™è¨€</code>âœ’<br/> âœ¨<code>ç³»åˆ—ä¸“æ ï¼š</code>ğŸ‘‰<a href="https://blog.csdn.net/qq_43514330/category_11944099.html?spm=1001.2014.3001.5482">SpringCloudä¸“æ </a><br/> âœ¨<code>æ¬¢è¿åŠ å…¥ç¤¾åŒºï¼š</code> ğŸ‘‰<a href="https://bbs.csdn.net/forums/bhywdxfx">ä¸ä¼šå‹å¼¯çš„å°é£ä¾ </a><br/> âœ¨<code>äººç”Ÿæ ¼è¨€ï¼šçŸ¥è¶³ä¸Šè¿›ï¼Œä¸è´Ÿé‡å¿ƒã€‚</code><br/> ğŸ”¥<code>æ¬¢è¿å¤§ä½¬æŒ‡æ­£ï¼Œä¸€èµ·å­¦ä¹ ï¼ä¸€èµ·åŠ æ²¹ï¼</code></p>
</blockquote>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/f9e7290d231c413fbc3f595656951ea9.gif#pic_center"/></p>
<p></p>
<div class="toc">
<h3>ç›®å½•</h3>
<ul><li><a href="#Feign_15">ğŸFeignçš„ä»‹ç»</a></li><li><a href="#Feign_19">ğŸå®šä¹‰å’Œä½¿ç”¨Feignå®¢æˆ·ç«¯</a></li><li><a href="#_89">ğŸè‡ªå®šä¹‰é…ç½®</a></li><li><ul><li><a href="#_101">ğŸ”¥é…ç½®æ–‡ä»¶æ–¹å¼</a></li><li><a href="#_132">ğŸ”¥ä»£ç æ–¹å¼</a></li></ul>
</li><li><a href="#Feign_158">ğŸFeignä½¿ç”¨ä¼˜åŒ–</a></li></ul>
</div>
<p></p>
<hr/>
<h1><a id="Feign_15"></a>ğŸFeignçš„ä»‹ç»</h1>
<ul><li>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„httpå®¢æˆ·ç«¯ï¼Œå®˜æ–¹åœ°å€:<a href="https://github.com/0penFeign/feign"> https://github.com/0penFeign/feign</a>ä½œç”¨å°±æ˜¯å¸®åŠ©æˆ‘ä»¬ä¼˜é›…çš„å®ç°httpè¯·æ±‚çš„å‘é€ï¼Œè§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚</li></ul>
<h1><a id="Feign_19"></a>ğŸå®šä¹‰å’Œä½¿ç”¨Feignå®¢æˆ·ç«¯</h1>
<ul><li>1.å¼•å…¥ä¾èµ–</li><li>åœ¨order-serviceæœåŠ¡çš„pomæ–‡ä»¶ä¸­å¼•å…¥feignçš„ä¾èµ–ï¼š</li></ul>
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>openfeign<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

</code></pre>
<ul><li>2.åœ¨order-serviceçš„å¯åŠ¨ç±»æ·»åŠ æ³¨è§£å¼€å¯Feignçš„åŠŸèƒ½</li></ul>
<pre><code class="prism language-java"><span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.jkj.order.mapper"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">OrderApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>3.ç¼–å†™Feignçš„å®¢æˆ·ç«¯</li><li>åœ¨order-serviceä¸­æ–°å»ºä¸€ä¸ªUserClientæ¥å£</li></ul>
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"userservice"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user/{id}"</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul><li>è¿™ä¸ªå®¢æˆ·ç«¯ä¸»è¦æ˜¯åŸºäºSpringMVCçš„æ³¨è§£æ¥å£°æ˜è¿œç¨‹è°ƒç”¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š 
  <ul><li>æœåŠ¡åç§°ï¼šuserservice</li><li>è¯·æ±‚æ–¹å¼ï¼šGET</li><li>è¯·æ±‚è·¯å¾„ï¼š/user/{id}</li><li>è¯·æ±‚å‚æ•°ï¼šLong id</li><li>è¿”å›å€¼ç±»å‹ï¼šUser</li></ul> </li><li>4.æµ‹è¯•</li><li>ä¿®æ”¹order-serviceä¸­çš„OrderServiceç±»ä¸­çš„queryOrderByIdæ–¹æ³•ï¼Œä½¿ç”¨Feignå®¢æˆ·ç«¯ä»£æ›¿RestTemplate</li></ul>
<pre><code class="prism language-java"> <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserClient</span> userClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">queryOrderById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1.æŸ¥è¯¢è®¢å•</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> orderMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.ç”¨Feignè¿œç¨‹è°ƒç”¨</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userClient<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//3.å°è£…useråˆ°order</span>
        order<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4.è¿”å›</span>
        <span class="token keyword">return</span> order<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<ul><li>Feignçš„ä½¿ç”¨æ­¥éª¤ 
  <ul><li>å¼•å…¥ä¾èµ–</li><li>æ·»åŠ @EnableFeignClientsæ³¨è§£</li><li>ç¼–å†™FeignClientæ¥å£</li><li>ä½¿ç”¨FeignClientä¸­å®šä¹‰çš„æ–¹æ³•ä»£æ›¿RestTemplate</li></ul> </li></ul>
<h1><a id="_89"></a>ğŸè‡ªå®šä¹‰é…ç½®</h1>
<ul><li>Feignæ”¯æŒè‡ªå®šä¹‰é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li></ul>
<table><thead><tr><th>ç±»å‹</th><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>feign.Logger.Level</td><td>ä¿®æ”¹æ—¥å¿—çº§åˆ«</td><td>åŒ…å«å››ç§ä¸åŒçš„çº§åˆ«ï¼šNONEã€BASICã€HEADERSã€FULL</td></tr><tr><td>feign.codec.Decoder</td><td>å“åº”ç»“æœçš„è§£æå™¨</td><td>httpè¿œç¨‹è°ƒç”¨çš„ç»“æœåšè§£æï¼Œä¾‹å¦‚è§£æjsonå­—ç¬¦ä¸²ä¸ºjavaå¯¹è±¡</td></tr><tr><td>feign.codec.Encoder</td><td>è¯·æ±‚å‚æ•°ç¼–ç </td><td>å°†è¯·æ±‚å‚æ•°ç¼–ç ï¼Œä¾¿äºé€šè¿‡httpè¯·æ±‚å‘é€</td></tr><tr><td>feign. Contract</td><td>æ”¯æŒçš„æ³¨è§£æ ¼å¼</td><td>é»˜è®¤æ˜¯SpringMVCçš„æ³¨è§£</td></tr><tr><td>feign. Retryer</td><td>å¤±è´¥é‡è¯•æœºåˆ¶</td><td>è¯·æ±‚å¤±è´¥çš„é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰ï¼Œä¸è¿‡ä¼šä½¿ç”¨Ribbonçš„é‡è¯•</td></tr></tbody></table>
<h2><a id="_101"></a>ğŸ”¥é…ç½®æ–‡ä»¶æ–¹å¼</h2>
<ul><li>åŸºäºé…ç½®æ–‡ä»¶ä¿®æ”¹feignçš„æ—¥å¿—çº§åˆ«å¯ä»¥é’ˆå¯¹å•ä¸ªæœåŠ¡ï¼š</li></ul>
<pre><code class="prism language-java">feign<span class="token operator">:</span>  
  client<span class="token operator">:</span>
    config<span class="token operator">:</span> 
      userservice<span class="token operator">:</span> # é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®
        loggerLevel<span class="token operator">:</span> FULL #  æ—¥å¿—çº§åˆ« 

</code></pre>
<ul><li>é’ˆå¯¹æ‰€æœ‰æœåŠ¡ï¼š</li></ul>
<pre><code class="prism language-java">feign<span class="token operator">:</span>  
  client<span class="token operator">:</span>
    config<span class="token operator">:</span> 
      <span class="token keyword">default</span><span class="token operator">:</span> # è¿™é‡Œç”¨<span class="token keyword">default</span>å°±æ˜¯å…¨å±€é…ç½®ï¼Œå¦‚æœæ˜¯å†™æœåŠ¡åç§°ï¼Œåˆ™æ˜¯é’ˆå¯¹æŸä¸ªå¾®æœåŠ¡çš„é…ç½®
        loggerLevel<span class="token operator">:</span> FULL #  æ—¥å¿—çº§åˆ« 

</code></pre>
<ul><li>æ—¥å¿—çš„çº§åˆ«åˆ†ä¸ºå››ç§ï¼š 
  <ul><li>NONEï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚</li><li>BASICï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´</li><li>HEADERSï¼šåœ¨BASICçš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li><li>FULLï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚</li></ul> </li></ul>
<h2><a id="_132"></a>ğŸ”¥ä»£ç æ–¹å¼</h2>
<ul><li>åŸºäºJavaä»£ç æ¥ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œå…ˆå£°æ˜ä¸€ä¸ªç±»ï¼Œç„¶åå£°æ˜ä¸€ä¸ªLogger.Levelçš„å¯¹è±¡ï¼š</li></ul>
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultFeignConfiguration</span>  <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span> <span class="token function">feignLogLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Logger<span class="token punctuation">.</span>Level</span><span class="token punctuation">.</span>BASIC<span class="token punctuation">;</span> <span class="token comment">// æ—¥å¿—çº§åˆ«ä¸ºBASIC</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<ul><li>å¦‚æœè¦å…¨å±€ç”Ÿæ•ˆï¼Œå°†å…¶æ”¾åˆ°å¯åŠ¨ç±»çš„@EnableFeignClientsè¿™ä¸ªæ³¨è§£ä¸­ï¼š</li></ul>
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>defaultConfiguration <span class="token operator">=</span> <span class="token class-name">DefaultFeignConfiguration</span> <span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> 
</code></pre>
<ul><li>å¦‚æœæ˜¯å±€éƒ¨ç”Ÿæ•ˆï¼Œåˆ™æŠŠå®ƒæ”¾åˆ°å¯¹åº”çš„@FeignClientè¿™ä¸ªæ³¨è§£ä¸­ï¼š</li></ul>
<pre><code class="prism language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"userservice"</span><span class="token punctuation">,</span> configuration <span class="token operator">=</span> <span class="token class-name">DefaultFeignConfiguration</span> <span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> 
</code></pre>
<h1><a id="Feign_158"></a>ğŸFeignä½¿ç”¨ä¼˜åŒ–</h1>
<ul><li> <p>Feignåº•å±‚å‘èµ·httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚å®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p> </li><li> <p>URLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </p> </li><li> <p>Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± </p> </li><li> <p>OKHttpï¼šæ”¯æŒè¿æ¥æ± </p> </li><li> <p>å› æ­¤æé«˜Feignçš„æ€§èƒ½ä¸»è¦æ‰‹æ®µå°±æ˜¯ä½¿ç”¨è¿æ¥æ± ä»£æ›¿é»˜è®¤çš„URLConnectionã€‚</p> </li><li> <p>1.å¼•å…¥ä¾èµ–</p>
<ul><li>åœ¨order-serviceçš„pomæ–‡ä»¶ä¸­å¼•å…¥Apacheçš„HttpClientä¾èµ–ï¼š</li></ul> </li></ul>
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>httpClientçš„ä¾èµ– <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>openfeign<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>feign<span class="token operator">-</span>httpclient<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre>
<ul><li>2.é…ç½®è¿æ¥æ±  
  <ul><li>åœ¨order-serviceçš„application.ymlä¸­æ·»åŠ é…ç½®ï¼š</li></ul> </li></ul>
<pre><code class="prism language-java">feign<span class="token operator">:</span>
  client<span class="token operator">:</span>
    config<span class="token operator">:</span>
      <span class="token keyword">default</span><span class="token operator">:</span> # <span class="token keyword">default</span>å…¨å±€çš„é…ç½®
        loggerLevel<span class="token operator">:</span> BASIC # æ—¥å¿—çº§åˆ«ï¼ŒBASICå°±æ˜¯åŸºæœ¬çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯
  httpclient<span class="token operator">:</span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span> # å¼€å¯feignå¯¹<span class="token class-name">HttpClient</span>çš„æ”¯æŒ
    max<span class="token operator">-</span>connections<span class="token operator">:</span> <span class="token number">200</span> # æœ€å¤§çš„è¿æ¥æ•°
    max<span class="token operator">-</span>connections<span class="token operator">-</span>per<span class="token operator">-</span>route<span class="token operator">:</span> <span class="token number">50</span> # æ¯ä¸ªè·¯å¾„çš„æœ€å¤§è¿æ¥æ•°
</code></pre>
<p>ç„¶ååœ¨FeignClientFactoryBeanä¸­çš„loadBalanceæ–¹æ³•ä¸­æ‰“æ–­ç‚¹ï¼ŒDebugæ–¹å¼å¯åŠ¨order-serviceæœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„clientï¼Œåº•å±‚å°±æ˜¯Apache HttpClientã€‚</p>
<ul><li>Feignçš„ä¼˜åŒ–ï¼š 
  <ul><li>1.æ—¥å¿—çº§åˆ«å°½é‡ç”¨basic</li><li>2.ä½¿ç”¨HttpClientæˆ–OKHttpä»£æ›¿URLConnection 
    <ul><li>å¼•å…¥feign-httpClientä¾èµ–</li><li>é…ç½®æ–‡ä»¶å¼€å¯httpClientåŠŸèƒ½ï¼Œè®¾ç½®è¿æ¥æ± å‚æ•°</li></ul> </li></ul> </li></ul>
<hr/>
<p><img alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" src="https://img-blog.csdnimg.cn/78a2e208b59549ccb3782503cebd6d93.jpeg#pic_center"/></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>