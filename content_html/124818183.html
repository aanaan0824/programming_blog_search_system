<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/5d0954f63a0544e7b69d43b12d8c7251.gif"/><br/> </p>
<div class="toc">
<h3>类和对象（上）</h3>
<ul><li><a href="#_2">前言</a></li><li><a href="#1_7">1.面向过程和面向对象初步认识</a></li><li><a href="#2__13">2. 类的引入</a></li><li><a href="#3_53">3.类的定义</a></li><li><a href="#4__107">4. 类的访问限定符及封装</a></li><li><ul><li><a href="#41__109">4.1 访问限定符</a></li><li><a href="#42__134">4.2 封装</a></li></ul>
</li><li><a href="#5_142">5.类的作用域</a></li><li><a href="#6__163">6. 类的实例化</a></li><li><a href="#7__193">7. 类对象模型</a></li><li><ul><li><a href="#71__195">7.1 如何计算类对象的大小</a></li><li><a href="#72__212">7.2 类对象的存储方式猜测</a></li></ul>
</li><li><a href="#8this_255">8.this指针</a></li><li><ul><li><a href="#81_this_257">8.1 this指针的引出</a></li><li><a href="#82_this_298">8.2 this指针的特性</a></li><li><a href="#83__358">8.3 【面试题】</a></li><li><ul><li><a href="#831_1_368">8.3.1 面试题1</a></li><li><a href="#832_2_423">8.3.2 面试题2</a></li></ul>
</li></ul>
</li></ul>
</div>
<p></p>
<h1><a id="_2"></a>前言</h1>
<blockquote>
<p><img alt="在这里插入图片描述" src="https://img-blog.csdnimg.cn/678bddc564ac4be68fa374357f4d5d96.png"/>哈喽大家好，我是<span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
          
           鹿
          
          
           九
          
          
           丸
          
         
        
       
       
        \color{red}{鹿九丸}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0em; vertical-align: 0em;"></span><span class="mord" style="color: red;"><span class="mord cjk_fallback" style="color: red;">鹿</span><span class="mord cjk_fallback" style="color: red;">九</span><span class="mord cjk_fallback" style="color: red;">丸</span></span></span></span></span></span>，今天给大家带来的是C++系列类和对象的上卷内容。<br/> 如果大家在看我的博客的过程中或者学习的过程中以及在学习方向上有什么问题或者想跟我交流的话可以加我的企鹅号：<span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
          2361038962
         
        
       
       
        \color{red}{2361038962}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">2</span><span class="mord" style="color: red;">3</span><span class="mord" style="color: red;">6</span><span class="mord" style="color: red;">1</span><span class="mord" style="color: red;">0</span><span class="mord" style="color: red;">3</span><span class="mord" style="color: red;">8</span><span class="mord" style="color: red;">9</span><span class="mord" style="color: red;">6</span><span class="mord" style="color: red;">2</span></span></span></span></span></span>，或者寄邮件到相应的邮箱里：<span class="katex--inline"><span class="katex"><span class="katex-mathml">
     
      
       
        
         
          
           2361038962
          
          
           @
          
          
           q
          
          
           q
          
          
           .
          
          
           c
          
          
           o
          
          
           m
          
         
        
       
       
        \color{red}{2361038962@qq.com}
       
      
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord" style="color: red;"><span class="mord" style="color: red;">2</span><span class="mord" style="color: red;">3</span><span class="mord" style="color: red;">6</span><span class="mord" style="color: red;">1</span><span class="mord" style="color: red;">0</span><span class="mord" style="color: red;">3</span><span class="mord" style="color: red;">8</span><span class="mord" style="color: red;">9</span><span class="mord" style="color: red;">6</span><span class="mord" style="color: red;">2</span><span class="mord" style="color: red;">@</span><span class="mord mathdefault" style="margin-right: 0.03588em; color: red;">q</span><span class="mord mathdefault" style="margin-right: 0.03588em; color: red;">q</span><span class="mord" style="color: red;">.</span><span class="mord mathdefault" style="color: red;">c</span><span class="mord mathdefault" style="color: red;">o</span><span class="mord mathdefault" style="color: red;">m</span></span></span></span></span></span>，我会尽量帮大家进行解答！</p>
</blockquote>
<h1><a id="1_7"></a>1.面向过程和面向对象初步认识</h1>
<blockquote>
<p>C语言是<strong>面向过程</strong>的，<strong>关注</strong>的是<strong>过程</strong>（函数），分析出求解问题的步骤，通过函数调用逐步解决问题。</p>
<p>C++是基于<strong>面向对象</strong>的，<strong>关注</strong>的是<strong>对象</strong>（类），将一件事情拆分成不同的对象，靠对象之间的交互完成。</p>
</blockquote>
<h1><a id="2__13"></a>2. 类的引入</h1>
<p><strong>C语言中，结构体中只能定义变量。在C++中，结构体内不仅可以定义变量</strong>，<mark>也可以定义函数</mark>，<strong>同时结构体的名称可以做类型。（在C++中struct 被升级成了类）</strong></p>
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> <span class="token class-name">Student</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">void</span> <span class="token function">SetStudentInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> gender<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">strcpy</span><span class="token punctuation">(</span>_name<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">strcpy</span><span class="token punctuation">(</span>_gender<span class="token punctuation">,</span> gender<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_age <span class="token operator">=</span> age<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">PrintStudentInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> _name <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> _gender <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> _age <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">char</span> _name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//_用来标识成员变量，同时可以区分成员变量和形参</span>
	<span class="token keyword">char</span> _gender<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> _age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Student s<span class="token punctuation">;</span><span class="token comment">//结构体的名称做类型</span>
	s<span class="token punctuation">.</span><span class="token function">SetStudentInfo</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">PrintStudentInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上面结构体的定义，在C++中更喜欢用class来代替。</p>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">student</span>
<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre>
<p><mark>注意：C++中struct被升级成类，类是一个整体，比如上面的函数SetStudentInfo()中使用到了_name，虽然类中的_name在后面，但是在SetStudentInfo()函数中也是可以使用的。</mark></p>
<h1><a id="3_53"></a>3.类的定义</h1>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">className</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 类体：由成员函数和成员变量组成</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 一定要注意后面的分号</span>
</code></pre>
<p><strong>class</strong>为定义类的<strong>关键字</strong>，<strong>ClassName为类的名字</strong>，<strong>{}中为类的主体</strong>，<strong>注意</strong>类定义结束时后面<strong>分号</strong>。</p>
<p>类中的元素称为类的成员：类中的数据称为类的属性或者成员变量; 类中的函数称为类的方法或者成员函数。</p>
<p><strong>类的两种定义方式：</strong></p>
<ol><li> <p>声明和定义全部放在类体中，需要注意：<mark>成员函数如果在类中定义，编译器可能会将其当成内联函数处理（一般较短的函数会在类内定义）。</mark></p> <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">student</span><span class="token comment">//学生类</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//显示学生基本信息</span>
	<span class="token keyword">void</span> <span class="token function">showInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		···
	<span class="token punctuation">}</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">char</span><span class="token operator">*</span> _name<span class="token punctuation">;</span><span class="token comment">//学生的姓名</span>
	<span class="token keyword">int</span> _age<span class="token punctuation">;</span><span class="token comment">//学生的年龄</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>声明放在.h文件中，类的定义放在.cpp文件中</p> <pre><code class="prism language-cpp"><span class="token comment">//student.h文件</span>
<span class="token keyword">class</span> <span class="token class-name">student</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">printInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//student.cpp文件</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"student.h"</span></span>
<span class="token keyword">void</span> student <span class="token double-colon punctuation">::</span> <span class="token function">printInfr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> <p>一般情况下我们会采用第二种方式。</p> </li></ol>
<h1><a id="4__107"></a>4. 类的访问限定符及封装</h1>
<h2><a id="41__109"></a>4.1 访问限定符</h2>
<p>C++实现封装的方式：用类将对象的属性与方法结合在一块，让对象更加完善，通过访问权限选择性的将其接口提供给外部的用户使用。</p>
<p>访问限定符有三种：</p>
<ul><li>public（公有）</li><li>protected（保护）</li><li>private（私有）</li></ul>
<blockquote>
<p>【<strong>访问限定符说明</strong>】</p>
<ol><li>public修饰的成员在类外可以直接被访问</li><li>protected和private修饰的成员在类外不能直接被访问(此处protected和private是类似的) ，但是在类内可以直接被访问</li><li>访问权限作用域从该访问限定符出现的位置开始直到下一个访问限定符出现时为止</li><li><mark>class的默认访问权限为private（我们也可以手动去加）</mark>，<mark>struct为public(因为struct要兼容C)</mark></li></ol>
</blockquote>
<p><mark>注意：访问限定符只在编译时有用，当数据映射到内存后，没有任何访问限定符上的区别</mark></p>
<p>【面试题】</p>
<p>问题：<strong>C++中struct和class的区别是什么？</strong></p>
<p>解答：C++需要兼容C语言，所以C++中struct可以当成结构体去使用。另外C++中struct还可以用来定义类。 和class是定义类是一样的，区别是struct的成员默认访问方式是public，class是的成员默认访问方式是 private。</p>
<h2><a id="42__134"></a>4.2 封装</h2>
<p>【<strong>面试题</strong>】 面向对象的三大特性：<strong>封装、继承、多态</strong>。</p>
<p>在类和对象阶段，我们只研究类的封装特性，那什么是封装呢？</p>
<p><strong>封装：将数据和操作数据的方法进行有机结合，隐藏对象的属性和实现细节，仅对外公开接口来和对象进行 交互。</strong></p>
<h1><a id="5_142"></a>5.类的作用域</h1>
<p>类定义了一个新的作用域，类的所有成员都在类的作用域中。在类体外定义成员，需要使用 :: 作用域解析符 指明成员属于哪个类域。</p>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Person</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">PrintPersonInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">char</span> _name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> _gender<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> _age<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 这里需要指定PrintPersonInfo是属于Person这个类域</span>
<span class="token keyword">void</span> <span class="token class-name">Person</span><span class="token double-colon punctuation">::</span><span class="token function">PrintPersonInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> _name <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span>_gender <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> _age <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token comment">//_name和_gender都是类里面的</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><a id="6__163"></a>6. 类的实例化</h1>
<p><strong>用类类型创建对象的过程，称为类的实例化</strong></p>
<ol><li>类只是一个模型一样的东西，限定了类有哪些成员，定义出一个类并没有分配实际的内存空间来存储它</li><li>一个类可以实例化出多个对象，实例化出的对象 占用实际的物理空间，存储类成员变量</li><li>做个比方。类实例化出对象就像现实中使用建筑设计图建造出房子，类就像是设计图，只设计出需要什 么东西，但是并没有实体的建筑存在，同样类也只是一个设计，实例化出的对象才能实际存储数据，占用物理空间</li></ol>
<p><img alt="image-20220512180502101" src="https://img-blog.csdnimg.cn/img_convert/47bf25ad1dd6fc21b6bac1f40a057ab6.png"/></p>
<p><img alt="image-20220512191918308" src="https://img-blog.csdnimg.cn/img_convert/594520d4eace029747254c626f0fe7a1.png"/></p>
<ol start="4"><li> <p>类的定义不能像下面这样进行定义，否则在实例化的时候会出现错误。</p> <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Person</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">PrintPersonInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">char</span> _name<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> _gender<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> _age<span class="token punctuation">;</span>
    Person p<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <p>在实例化的过程中将会无穷无尽，这是被C++语法所不允许的。<br/> <strong>结论：在类的定义中成员变量中不能出现当前成员变量的变量。</strong></p> </li></ol>
<h1><a id="7__193"></a>7. 类对象模型</h1>
<h2><a id="71__195"></a>7.1 如何计算类对象的大小</h2>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">PrintA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> _a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">char</span> _a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>问题：类中既可以有成员变量，又可以有成员函数，那么一个类的对象中包含了什么？如何计算一个类的大小？</p>
<h2><a id="72__212"></a>7.2 类对象的存储方式猜测</h2>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">stu</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">SetStuInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>

	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">PrintInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>

	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">char</span> _name<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> _age<span class="token punctuation">;</span>
	<span class="token keyword">char</span> _sex<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<ul><li> <p>对象中包含类的各个成员<br/> <img alt="image-20220512193608794" src="https://img-blog.csdnimg.cn/img_convert/1d08553db1b87138eee8236eae06382a.png"/></p> <p>缺陷：每个对象中成员变量是不同的，但是调用同一份函数，如果按照此种方式存储，当一个类创建多 个对象时，每个对象中都会保存一份代码，相同代码保存多次，浪费空间。</p> </li><li> <p>只保存成员变量，成员函数存放在公共的代码段</p> <p><img alt="image-20220512193819869" src="https://img-blog.csdnimg.cn/img_convert/81b99fd986c840dc7eda0a438bcf6154.png"/></p> </li></ul>
<p><mark>对于上述两种方式，计算机采用的是第二种方式，在计算类变量所占内存空间的时候和结构体相类似（C语言中已经介绍），也遵循内存对齐。</mark></p>
<blockquote>
<p>注意：空的类，即像下面这样的类，也会在内存中占据一个字节：</p>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>问：为什么一定要在内存中占据一个字节呢？</p>
<p>答：因为定义变量的时候总要在内存中占据一个地址空间的，用来标识变量的存在。</p>
</blockquote>
<h1><a id="8this_255"></a>8.this指针</h1>
<h2><a id="81_this_257"></a>8.1 this指针的引出</h2>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Date</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> _year <span class="token operator">&lt;&lt;</span> <span class="token string">"-"</span> <span class="token operator">&lt;&lt;</span> _month <span class="token operator">&lt;&lt;</span> <span class="token string">"-"</span> <span class="token operator">&lt;&lt;</span> _day <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> month<span class="token punctuation">,</span> <span class="token keyword">int</span> day<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_year <span class="token operator">=</span> year<span class="token punctuation">;</span>
		_month <span class="token operator">=</span> month<span class="token punctuation">;</span>
		_day <span class="token operator">=</span> day<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _year<span class="token punctuation">;</span> <span class="token comment">// 年</span>
	<span class="token keyword">int</span> _month<span class="token punctuation">;</span> <span class="token comment">// 月</span>
	<span class="token keyword">int</span> _day<span class="token punctuation">;</span> <span class="token comment">// 日</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Date d1<span class="token punctuation">,</span> d2<span class="token punctuation">;</span>
	d1<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	d2<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	d1<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	d2<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>输出结果：</p>
<p><img alt="image-20220512195003971" src="https://img-blog.csdnimg.cn/img_convert/ef45636f68cdb78366aad8fd8a04f5ca.png"/></p>
<p>对于上述类，有这样的一个问题： Date类中有Init与Print两个成员函数，函数体中没有关于不同对象的区分，那当s1调用Init函数时，该函数是如何知道应该设置s1对象，而不是设置s2对象呢？当s1调用Print函数时，该函数是如何知道打印的是s1对象而不是s2对象呢？</p>
<p>C++中通过引入this指针解决该问题，即：<strong>C++编译器给每个“非静态的成员函数“增加了一个隐藏的指针参 数，让该指针指向当前对象(函数运行时调用该函数的对象)，在函数体中所有成员变量的操作，都是通过该指针去访问。只不过所有的操作对用户是透明的，即用户不需要来传递，编译器自动完成。</strong></p>
<h2><a id="82_this_298"></a>8.2 this指针的特性</h2>
<blockquote>
<ol><li><em><em>this指针的类型：类类型</em> const</em>*</li><li><strong>只能在“成员函数”的内部使用</strong></li><li><strong>this指针本质上其实是一个成员函数的形参，是对象调用成员函数时，将对象地址作为实参传递给this形参。所以对象中不存储this指针。</strong></li><li>**this指针是成员函数第一个隐含的指针形参，一般情况由编译器通过ecx寄存器自动传递，不需要用户传递，如果用户强制传递，那么编译器会报错，当然，我们可以在成员函数中使用this指针但是不能对this指针的指向进行修改（当然，我们可以通过一些其它的方法进行修改，此处的不可修改是不可显式的进行修改），**即<mark>this是一个指针常量</mark>，<strong>但是不能在参数（实参和形参中均不可）中写this指针。</strong></li><li><strong>this指针式编译器默认加上的，无论在我们的成员函数内是否用的到，即使你的函数内容为空</strong></li></ol>
</blockquote>
<p>例如上面的函数被编译器处理之后就变成了下面的函数：</p>
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span>Date<span class="token operator">*</span> <span class="token keyword">const</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>_year <span class="token operator">&lt;&lt;</span> <span class="token string">"-"</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>_month <span class="token operator">&lt;&lt;</span> <span class="token string">"-"</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>_day <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Init</span><span class="token punctuation">(</span>Date<span class="token operator">*</span> <span class="token keyword">const</span> <span class="token keyword">this</span><span class="token punctuation">,</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> month<span class="token punctuation">,</span> <span class="token keyword">int</span> day<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>_year <span class="token operator">=</span> year<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>_month <span class="token operator">=</span> month<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token operator">-&gt;</span>_day <span class="token operator">=</span> day<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>调用的位置就变成了下面这样：</p>
<pre><code class="prism language-cpp">d1<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d1<span class="token punctuation">,</span> <span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d2<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d2<span class="token punctuation">,</span> <span class="token number">2022</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d1<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>
d2<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>但是我们如果像上面那样直接定义函数和调用函数编译器就会报错（<strong>因为形参和实参中均主动加上了this指针</strong>）。为什么？因为这是编译器的任务，而不是程序员的任务！</p>
<p>注意：我们可以在函数体内显式的使用this指针，例如下面的代码中我们就显式的使用了this指针：</p>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Date</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span> <span class="token operator">-&gt;</span> _year <span class="token operator">&lt;&lt;</span> <span class="token string">"-"</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span> <span class="token operator">-&gt;</span> _month <span class="token operator">&lt;&lt;</span> <span class="token string">"-"</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span> <span class="token operator">-&gt;</span> _day <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> month<span class="token punctuation">,</span> <span class="token keyword">int</span> day<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span> <span class="token operator">-&gt;</span> _year <span class="token operator">=</span> year<span class="token punctuation">;</span>
		<span class="token keyword">this</span> <span class="token operator">-&gt;</span> _month <span class="token operator">=</span> month<span class="token punctuation">;</span>
		<span class="token keyword">this</span> <span class="token operator">-&gt;</span> _day <span class="token operator">=</span> day<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _year<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _month<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _day<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>在上面的函数定义代码中我们就显式的使用了this指针。</p>
<h2><a id="83__358"></a>8.3 【面试题】</h2>
<blockquote>
<ol><li> <p>问：this指针是存在哪的？</p> <p>答：是存在于栈区上的，因为this指针是形参。当然，有的编译器会使用寄存器进行优化（为什么进行优化？<strong>因为我们可能在函数中频繁的使用this指针</strong>），将this指针存放在ecx寄存器上，比如下面的汇编代码中的第一行代码中，将指针变量p中存放的值0传递到ecx寄存器中。</p> </li><li> <p>问：this指针可以为空吗？</p> <p>答：可以，因为无论是传递什么，传递过去的都是一个值，空指针也只是一个值（0），但是我们无法通过空指针进行访问成员变量，它指向的空间无法被访问。</p> </li></ol>
</blockquote>
<h3><a id="831_1_368"></a>8.3.1 面试题1</h3>
<pre><code class="prism language-cpp"><span class="token comment">//1.下面程序编译运行结果是？A、编译报错 B、运行崩溃 C、正常运行</span>
<span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//void Show(A * const this)</span>
	<span class="token keyword">void</span> <span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//传过来的是一个空指针</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Show()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	A<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	p<span class="token operator">-&gt;</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//p-&gt;Show(p)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>首先排除A，为什么？因为即使程序出现了对空指针的解引用问题，那么报错的地方也应该是运行崩溃，所以答案在B和C之间进行选择。</strong></p>
<p>然后查看编译器修饰之后的程序，发现在函数调用Show的过程中并没有对p即空指针指向的那块空间进行访问，所以程序并不会出现崩溃的现象，程序会正常运行，且能打印出Show()来。</p>
<blockquote>
<p>问：为什么<code>p-&gt;Show</code>这个代码没有出现错误呢？</p>
<p>答：首先<mark>因为p是一个A*类型的指针变量，所以可以能够进行-&gt;操作对Show()函数进行调用</mark>，换句话说，即使我们随便对p赋一个值像下面这样进行操作，程序依旧能够正常运行。</p>
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Show()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	A<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token punctuation">(</span>A<span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x11223344</span><span class="token punctuation">;</span>
	p<span class="token operator">-&gt;</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上面的代码中，我们随便给p赋了一个地址值0x11223344，此时依旧能够正确打印出来结果，即<code>Show()</code>，首先我们需要明确为什么对空指针不能进行解引用？因为NULL代表逻辑地址０，指向那段空间被认为是不可访问的且在那块空间中没有存在有效且合法的数据。而对象中只有成员变量，只有对对象指针指向的成员变量进行访问才属于对空指针的解引用，上面的例子中我们<mark>通过p指针访问的是公共代码区中的函数show()</mark>，这是完全合法的。如果我们<mark>通过指针ｐ对_ａ进行访问那就属于对空指针进行解引用</mark>了，这也是为什么下一个面试题会出现程序崩溃的原因。</p>
<p>下面我们看一下汇编：</p>
<p><img alt="image-20220515155707490" src="https://img-blog.csdnimg.cn/img_convert/b434b08ed296276f5286fa2da67c12f8.png"/></p>
</blockquote>
<h3><a id="832_2_423"></a>8.3.2 面试题2</h3>
<pre><code class="prism language-cpp"><span class="token comment">//2.下面程序编译运行结果是？A、编译报错 B、运行崩溃 C、正常运行</span>
<span class="token keyword">class</span> <span class="token class-name">A</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">PrintA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> _a <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token comment">//this-&gt;_a，此时出现了对this指针的解引用，即对空指针的解引用，访问this指针指向的对象空间，所以程序会运行崩溃</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _a<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	A<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	p<span class="token operator">-&gt;</span><span class="token function">PrintA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里不会出现问题，只是将p赋值给this指针</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>