<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<br/>
<hr/>
<blockquote>
<ul><li><strong>💂 个人网站:</strong> <font color="1E88E5"><a href="http://www.it-learning.cn/">IT知识小屋</a></font></li><li><strong>🤟 版权:</strong> 本文由【IT学习日记】原创、在CSDN首发、需要转载请联系博主</li><li>💬 如果文章对你有帮助、<strong><font color="1E88E5">欢迎关注、点赞、收藏(一键三连)和订阅专栏哦</font></strong></li><li>💅 <strong><font color="1E88E5">开源项目:【<a href="https://gitee.com/it-learning-diary/it-wheels-king">轮子之王</a>】</font></strong></li></ul>
</blockquote>
<hr/>
<p></p>
<div class="toc">
<h3>文章目录</h3>
<ul><li><ul><li><a href="#_16">前言</a></li><li><a href="#_24">工具介绍</a></li><li><ul><li><a href="#excel_40">一、excel工具</a></li><li><a href="#csv_165">二、csv工具</a></li><li><a href="#ftp_298">三、ftp工具</a></li><li><a href="#_431">四、分布式文件系统工具</a></li></ul>
</li><li><a href="#_524">工具更新</a></li><li><a href="#_534">集成方案介绍关联文章</a></li><li><a href="#_541">写在最后</a></li></ul>
</li></ul>
</div>
<p></p>
<hr/>
<h2><a id="_16"></a>前言</h2>
<p>  <strong>一个优秀的开发者，一定是会利用各种工具来提升自己的开发效率。</strong> 前段时间，博主在Gitee/Github开源了一个提升开发效率的工具，工具内集成了各种常用工具如csv、excel、ftp、文件系统等等，<strong>只需要简单调用API，就可以得到想要的结果，可以极大帮助开发者提升效率</strong>，下面来一起看看这款工具如何使用吧。</p>
<p><img alt="image-20220806204935635" src="https://img-blog.csdnimg.cn/img_convert/efeb4ee7f26aa90e7700851341045f23.png"/></p>
<h2><a id="_24"></a>工具介绍</h2>
<p>  报表的导出、导入功能、文件上传、下载等在平常业务中是最常见不过的功能了，<strong>许多小伙伴在开发的时候才会去网上找之前别人编写过的案例参考，但是许多博客记载的都是时间比较长远或者不完整的代码，这导致在引入的时候还要处理引入的许多未知问题。</strong></p>
<p>  现在博主开源的“轮子之王”包含了这些常见的功能，<strong>源码全开发，每种功能都有相应的例子说明，项目会持续更新迭代，有问题还可以及时给项目提issue，相信比大多数网上的博客代码可靠性更高。</strong></p>
<p>  <strong>项目地址如下：</strong></p>
<p>  Github：<a href="https://github.com/it-learning-diary/it-wheels-king">https://github.com/it-learning-diary/it-wheels-king</a></p>
<p>  Gitee：<a href="https://gitee.com/it-learning-diary/it-wheels-king">https://gitee.com/it-learning-diary/it-wheels-king</a></p>
<p>  <strong>项目结构如下：</strong></p>
<p><img alt="image-20220807104023940" src="https://img-blog.csdnimg.cn/img_convert/21adc2f399aace29368ddeb1fdf5dcbc.png"/></p>
<h3><a id="excel_40"></a>一、excel工具</h3>
<p>  该工具实现采用的是开源的easyexcel框架。easyexcel是阿里的开发人员对poi框架进行了优化，解决了poi在大数据量时可能出现OOM异常，并且兼容xls和xlsx两种文件类型的一个开源框架。</p>
<p>  <strong>excel工具集成功能如下：</strong></p>
<ul><li>excel的导入(可以自定义转换后的excel数据处理的业务逻辑，支持抛出异常、事务回滚、记录解析时的异常数据)</li><li>导出(支持固定表头,兼容多sheet页和动态表头,兼容多sheet页)功能。</li></ul>
<p>  <strong>excel工具的特点如下：</strong></p>
<p>  使用过easyexcel框架的一些读者知道，每个导入功能都要写一个对应的Listener进行数据转换，在很多时间其实转换的逻辑都是类似的，不同的只不过是转换后数据处理的业务逻辑不一样。</p>
<p>  <strong>本开源项目的excel工具则利用Java中的泛型和Java8中的Consumer接口将相同的部分(转换逻辑)抽取出来，不同的部分则单独传入(数据处理的业务逻辑)，这样就避免了每个导入都需要创建一个相类似的Listerner，减少了类的创建和提高了开发效率。</strong></p>
<p>  <strong>部分源码如下：</strong></p>
<pre><code class="prism language-java"> <span class="token comment">/**
     * 通用导入excel文件方法
     *
     * @param fileStream 导入的文件流
     * @param rowDto 接收excel每行数据的实体
     * @param rowAction 将接收到的实体进行自定义的业务处理逻辑方法
     * @param &lt;T&gt; 实体类型
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">importFile</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> fileStream<span class="token punctuation">,</span> <span class="token class-name">T</span> rowDto<span class="token punctuation">,</span> <span class="token class-name">ThrowingConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> rowAction<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取excel通用监听器</span>
        <span class="token class-name">ExcelImportCommonListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> commonListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelImportCommonListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>rowAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取excel文件并导入</span>
        <span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">,</span> rowDto<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> commonListener<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token comment">/**
     * excel文件导出(可以包含多个sheet页)，固定表头(通过实体指定属性的方式)
     * @param response
     * @param fileName   导出文件名
     * @param head       导出表头(多个sheet页就是多个集合元素)
     * @param exportData 需要导出数据
     * @param sheetNames sheet页的名称，为空则默认以:sheet + 数字规则命名
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">exportFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> head<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> exportData<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sheetNames<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ExcelExportUtil exportFile required param can't be empty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">ExcelWriter</span> writer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>EXCEL_CONTENT_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>CONTENT_DISPOSITION<span class="token punctuation">,</span> <span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>ATTACHMENT_FILENAME <span class="token operator">+</span> fileName <span class="token operator">+</span> <span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>XLSX_SUFFIX<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置导出的表格样式</span>
            <span class="token class-name">HorizontalCellStyleStrategy</span> horizontalCellStyleStrategy <span class="token operator">=</span> <span class="token function">getExportDefaultStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer <span class="token operator">=</span> <span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerWriteHandler</span><span class="token punctuation">(</span>horizontalCellStyleStrategy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> itemIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> itemIndex <span class="token operator">&lt;</span> exportData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> itemIndex<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 表头数据</span>
                <span class="token class-name">Object</span> headData <span class="token operator">=</span> head<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>itemIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// sheet页的数据</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> exportData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>itemIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">WriteSheet</span> sheet <span class="token operator">=</span> <span class="token class-name">EasyExcel</span><span class="token punctuation">.</span><span class="token function">writerSheet</span><span class="token punctuation">(</span>itemIndex<span class="token punctuation">,</span> <span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>sheetNames<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>SHEET_NAME <span class="token operator">+</span> itemIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> sheetNames<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>itemIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span>headData<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> sheet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ExcelExportUtil exportFile in error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> writer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                writer<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre>
<p>  <strong>使用案例如下(在工具中每个项目都有具体的案例，不懂的还可以留言跟博主沟通)：</strong></p>
<pre><code class="prism language-java"><span class="token comment">/**
     * 导入用户数据案例
     *
     * @param file
     */</span>
    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uploadUserListDemoWithExcel</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 此处先校验导入的文件类型是否为excel</span>
        <span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token class-name">FileTypeUtil</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span> type<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ImportConstant</span><span class="token punctuation">.</span>XLS_TYPE<span class="token punctuation">)</span> <span class="token operator">||</span> type<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ImportConstant</span><span class="token punctuation">.</span>XLSX_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 返回校验失败信息</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"外层"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"外层"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用统一导入方法</span>
        <span class="token class-name">ExcelImportUtil</span><span class="token punctuation">.</span><span class="token function">importFile</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UserDto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">UserServiceImpl</span><span class="token operator">::</span><span class="token function">saveUserList</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

 <span class="token comment">/**
     * 导出案例
     *
     * @param response
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exportUserListDemoWithExcel</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 表头(使用excel中的注解定义，如果表头不固定，请使用ExcelExportUtil.exportWithDynamicData进行导出)</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserExportVo</span><span class="token punctuation">&gt;</span></span> head <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserExportVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 数据(使用两层list为了兼容多个sheet页，如果是不同的sheet页则放在不同的List集合中)</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">UserExportVo</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> exportDataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserExportVo</span><span class="token punctuation">&gt;</span></span> exportItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 查询数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> dbData <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将数据转换成导出需要的实际数据格式,此处只是演示</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> dbData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">UserExportVo</span> vo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserExportVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            exportItem<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>vo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        exportDataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>exportItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// sheet页名称-自定义，如果没有则传空</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sheetNameList <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"sheet1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExcelExportUtil</span><span class="token punctuation">.</span><span class="token function">exportFile</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> head<span class="token punctuation">,</span> exportDataList<span class="token punctuation">,</span> sheetNameList<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<h3><a id="csv_165"></a>二、csv工具</h3>
<p>  Csv即逗号分隔值，也可以称为字符分隔符，<strong>与excel等文件相比，excel文件中会包含许多格式信息，占用的空间会更大，所以Csv在很多大数据场景导出、导入场景是非常常见的。该工具实现采用的是开源的univocity-parsers框架实现。</strong></p>
<p>  之前有一篇专门讲解轮子之王项目为何使用univocity-parsers框架集成csv的详细过程，有兴趣的读者可以点击链接查看：<a href="https://juejin.cn/post/7099613370248069134">集成csv工具的前因后果</a></p>
<p>  <strong>部分源码如下：</strong></p>
<pre><code class="prism language-java"> <span class="token comment">/**
     * 使用实体bean接收csv数据文件并进行数据落盘
     *
     * @param inputStream
     * @param errorList
     * @param rowDtoClass
     * @param rowAction
     * @param &lt;T&gt;
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">importCsvWithBean</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errorList<span class="token punctuation">,</span> <span class="token class-name">Class</span> rowDtoClass<span class="token punctuation">,</span> <span class="token class-name">ThrowingConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> rowAction<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 定义bean解析者：用于将csv中数据绑定到实体属性中，然后存储带list集合上</span>
        <span class="token class-name">BeanListProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> rowProcessor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanListProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>rowDtoClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CsvParserSettings</span> setting <span class="token operator">=</span> <span class="token function">getDefaultSetting</span><span class="token punctuation">(</span>errorList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        setting<span class="token punctuation">.</span><span class="token function">setProcessor</span><span class="token punctuation">(</span>rowProcessor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建csv文件解析</span>
        <span class="token class-name">CsvParser</span> csvParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CsvParser</span><span class="token punctuation">(</span>setting<span class="token punctuation">)</span><span class="token punctuation">;</span>
        csvParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取数据映射后的集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> rowProcessor<span class="token punctuation">.</span><span class="token function">getBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 校验必填字段</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> row <span class="token operator">:</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 校验导入字段</span>
            <span class="token class-name">ImportValid</span><span class="token punctuation">.</span><span class="token function">validRequireField</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span> errorList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 执行数据持久化</span>
        <span class="token function">persistentBeanDataToDb</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> rowAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
   <span class="token comment">/**
     * 导出csv文件(表头和行都以实体的方式)
     *
     * @param response
     * @param head
     * @param rowDataList
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">exportCsvWithBean</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">,</span> <span class="token class-name">T</span> head<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> rowDataList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">CsvWriter</span> writer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 设置响应头格式</span>
            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>EXCEL_CONTENT_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>CONTENT_DISPOSITION<span class="token punctuation">,</span> <span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>ATTACHMENT_FILENAME <span class="token operator">+</span> fileName <span class="token operator">+</span> <span class="token class-name">ExportConstant</span><span class="token punctuation">.</span>CSV_SUFFIX<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 设置导出格式</span>
            <span class="token class-name">CsvWriterSettings</span> setting <span class="token operator">=</span> <span class="token function">getDefaultWriteSetting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 创见bean处理器，用于处理写入数据</span>
            <span class="token class-name">BeanWriterProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanWriterProcessor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>head<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            setting<span class="token punctuation">.</span><span class="token function">setRowWriterProcessor</span><span class="token punctuation">(</span>beanWriter<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 导出数据</span>
            writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CsvWriter</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> setting<span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">processRecords</span><span class="token punctuation">(</span>rowDataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"CsvExportUtil exportCsvWithBean in error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>writer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 

</code></pre>
<p>  <strong>使用案例如下:</strong></p>
<pre><code class="prism language-java"><span class="token comment">/**
     * 导出案例
     *
     * @param response
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exportUserListWithCsv</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserExportCsvVo</span><span class="token punctuation">&gt;</span></span> exportItem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 查询数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> dbData <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用字符串数组方式作为表头导出csv数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> head <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> dbData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> row <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            row<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            row<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            row<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">CsvExportUtil</span><span class="token punctuation">.</span><span class="token function">exportCsvWithString</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token string">"demo"</span><span class="token punctuation">,</span> head<span class="token punctuation">,</span> dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

 <span class="token comment">/**
     * 导入用户数据案例（csv模式）
     *
     * @param file
     */</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uploadUserListWithCsv</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 此处先校验导入的文件类型是否为csv</span>
        <span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token class-name">FileTypeUtil</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">||</span> type<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ImportConstant</span><span class="token punctuation">.</span>CSV_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 返回校验失败信息</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"外层"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"外层"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errorLogList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用统一导入方法</span>
        <span class="token comment">// 方式一：使用csv数据映射到dto实体的方式进行数据导入</span>
        <span class="token comment">//CsvImportUtil.importCsvWithBean(file.getInputStream(), errorLogList, UserCsvDto.class, UserServiceImpl::saveUserListWithCsv);</span>

        <span class="token comment">// 方式二、使用csv数据映射到字符串数组的方式进行数据导入</span>
        <span class="token class-name">CsvImportUtil</span><span class="token punctuation">.</span><span class="token function">importCsvWithString</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> errorLogList<span class="token punctuation">,</span> <span class="token class-name">UserCsvDto</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">UserServiceImpl</span><span class="token operator">::</span><span class="token function">saveUserListWithCsvStringArrDemo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果存在解析异常，输出解析异常并进行事务回滚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>errorLogList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>errorLogList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
</code></pre>
<h3><a id="ftp_298"></a>三、ftp工具</h3>
<p>  Ftp文件上传下载相比excel、csv等出现的场景较少，<strong>但是，如果你参与的项目是政府或者涉及到第三方旧系统对接的时候，很多时候就需要使用到它。因为很多旧系统或者政府项目使用的技术比较旧或者有制度限制，一般都是以文件的形式与你进行交互，此时ftp工具就很有效了。</strong></p>
<p>  Ftp工具使用的commons-net开源框架进行实现，具体的集成流程之前单独使用一篇文章进行了非常详细的介绍，有需要的读者可以点击后面链接查看：<a href="https://juejin.cn/post/7025778008791187469">手把手教你搭建ftp服务器，并用程序完成ftp上传下载功能</a></p>
<p>  <strong>部分源码如下：</strong></p>
<pre><code class="prism language-java"><span class="token comment">/**
     * 上传
     *
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">FtpUploadParam</span> param<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">FTPClient</span> ftpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FTPClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1 测试连接</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>ftpClient<span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getHostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//2 检查工作目录是否存在，不存在则创建</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ftpClient<span class="token punctuation">.</span><span class="token function">changeWorkingDirectory</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getWorkingPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    ftpClient<span class="token punctuation">.</span><span class="token function">makeDirectory</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getWorkingPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 将文件编码成Ftp服务器支持的编码类型（FTP协议里面，规定文件名编码为iso-8859-1，所以目录名或文件名需要转码。）</span>
                <span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSaveName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>ftpClientCharset<span class="token punctuation">)</span><span class="token punctuation">,</span> ftpServerCharset<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 3 上传文件</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ftpClient<span class="token punctuation">.</span><span class="token function">storeFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"FtpUtils uploadFile unsuccessfully!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"FtpUtils upload in error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">disconnect</span><span class="token punctuation">(</span>ftpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> flag<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">/**
     * @description: 下载ftp文件
     * @param:
     * @param: param
     * @param: downloadFileName
     * @return:
     * @date: 2022/7/14 10:56
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token class-name">FtpDownloadParam</span> param<span class="token punctuation">,</span> <span class="token class-name">String</span> downloadFileName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">FTPClient</span> ftpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FTPClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> downloadResult <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">//1 测试连接</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>ftpClient<span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getHostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> localPath <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">getDownloadPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> param<span class="token punctuation">.</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>localPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//2 检查工作目录是否存在，不存在返回</span>
                <span class="token comment">// if (!ftpClient.changeWorkingDirectory(param.getWorkingPath())) {<!-- --></span>
                <span class="token comment">//    return false;</span>
                <span class="token comment">// }</span>
                <span class="token comment">/*
                 * 打开FTP服务器的PASS模式(不记得FTP协议支持的模式请翻到文章第一阶段)
                 * 这个方法的意思就是每次数据连接之前，ftp client告诉ftp server开通一个端口来传输数据. 因为ftp
                 * server可能每次开启不同的端口来传输数据，但是在linux上，由于安全限制，可能某些端口没有开启，可能出现出现阻塞
                 */</span>
                ftpClient<span class="token punctuation">.</span><span class="token function">enterLocalPassiveMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 设置文件的传输方式-二进制</span>
                ftpClient<span class="token punctuation">.</span><span class="token function">setFileType</span><span class="token punctuation">(</span>FTP<span class="token punctuation">.</span>BINARY_FILE_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将文件编码成Ftp服务器支持的编码类型（FTP协议里面，规定文件名编码为iso-8859-1，所以目录名或文件名需要转码。）</span>
                <span class="token comment">// 缺少编码转换会导致：从FTP服务器下载下来的文件是破损的，无法被打开</span>
                downloadResult <span class="token operator">=</span> ftpClient<span class="token punctuation">.</span><span class="token function">retrieveFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>downloadFileName
                        <span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>ftpClientCharset<span class="token punctuation">)</span><span class="token punctuation">,</span> ftpServerCharset<span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
                out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"FtpUtils upload in error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"FtpUtils upload in error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">disconnect</span><span class="token punctuation">(</span>ftpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> downloadResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>  <strong>具体使用案例如下：</strong></p>
<pre><code class="prism language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/ftp/upload"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">FtpUploadParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FtpUploadParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setHostname</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerHostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setWorkingPath</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerWorkingPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setSaveName</span><span class="token punctuation">(</span><span class="token string">"xxx.mp3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"D:/uploadfile/like.mp3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ftpUtils<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"TestFtpServerController upload 错误:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/ftp/download"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">FtpDownloadParam</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FtpDownloadParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setHostname</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerHostname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setWorkingPath</span><span class="token punctuation">(</span>ftpConfig<span class="token punctuation">.</span><span class="token function">getServerWorkingPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setDownloadPath</span><span class="token punctuation">(</span><span class="token string">"D:/downloadFile/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            param<span class="token punctuation">.</span><span class="token function">setFileName</span><span class="token punctuation">(</span><span class="token string">"xxx.mp3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ftpUtils<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> <span class="token string">"xxxx.mp3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"TestFtpServerController download 错误:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

</code></pre>
<h3><a id="_431"></a>四、分布式文件系统工具</h3>
<p>  <strong>非结构化数据通常是使用文件的方式进行存储，这时候不可避免地要使用到文件系统进行管理。</strong> 分布式文件系统工具使用了第三方开源框架seaweedfs进行搭建，可以实现程序上传，删除、下载、查询，并有文件分布式存储，避免单点故障，节约成本等特点。</p>
<p>  前面也专门通过一篇文章讲解了：为何要使用seaweedfs框架搭建分布式文件系统的，感兴趣的读者可以通过下方链接进行查看：<a href="https://juejin.cn/post/7127104556328026148">Gitee图床崩溃后，我使用Seaweedfs搭建了文件系统并封装成轮子开源</a></p>
<p>  <strong>部分源码如下：</strong></p>
<pre><code class="prism language-java"><span class="token comment">/**
     * @description: 上传单个文件到文件服务器
     * @param: file
     * @return: 文件的fid + 文件的请全访问地址
     * @author: it
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">FileSource</span> fileSource <span class="token operator">=</span> <span class="token function">getFileSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileTemplate</span> fileTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTemplate</span><span class="token punctuation">(</span>fileSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 上传文件</span>
        <span class="token class-name">FileHandleStatus</span> handleStatus <span class="token operator">=</span> fileTemplate<span class="token punctuation">.</span><span class="token function">saveFileByStream</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取上传文件的访问地址</span>
        <span class="token class-name">String</span> fileUrl <span class="token operator">=</span> fileTemplate<span class="token punctuation">.</span><span class="token function">getFileUrl</span><span class="token punctuation">(</span>handleStatus<span class="token punctuation">.</span><span class="token function">getFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 关闭当前连接</span>
        fileSource<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> handleStatus<span class="token punctuation">.</span><span class="token function">getFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span>DASHED <span class="token operator">+</span> fileUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">/**
     * @description: 根据文件下载文件
     * @param: fid
     * @param: response
     * @param: fileName
     * @author: it
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downloadFileByFid</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> fid<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">FileSource</span> fileSource <span class="token operator">=</span> <span class="token function">getFileSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileTemplate</span> fileTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileTemplate</span><span class="token punctuation">(</span>fileSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StreamResponse</span> fileStream <span class="token operator">=</span> fileTemplate<span class="token punctuation">.</span><span class="token function">getFileStream</span><span class="token punctuation">(</span>fid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置响应头</span>
        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token class-name">CommonConstant</span><span class="token punctuation">.</span>CONTENT_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">CommonConstant</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> encodeFileName <span class="token operator">=</span> <span class="token function">buildingFileNameAdapterBrowser</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token class-name">CommonConstant</span><span class="token punctuation">.</span>CONTENT_DISPOSITION<span class="token punctuation">,</span> <span class="token class-name">CommonConstant</span><span class="token punctuation">.</span>ATTACHMENT_FILENAME <span class="token operator">+</span> encodeFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取并写入到响应输出</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> fileStream<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fileByte <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>inputStream<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fileByte<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fileByte<span class="token punctuation">)</span><span class="token punctuation">;</span>
        response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileSource<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>  <strong>具体使用案例如下：</strong></p>
<pre><code class="prism language-java"><span class="token comment">/**
     * @description: 上传文件
     * @param:
     * @param: file
     * @return:
     * @author: it
     * @date: 2022/7/14 17:01
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"upload"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> fileUrl <span class="token operator">=</span> seaweedFsUtil<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"TestSeaweedFsController uploadFile in error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @description: 下载文件
     * @param:
     * @param: fileId
     * @return:
     * @author: it
     * @date: 2022/7/14 17:01
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"download"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> fileId<span class="token punctuation">,</span> <span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            seaweedFsUtil<span class="token punctuation">.</span><span class="token function">downloadFileByFid</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> request<span class="token punctuation">,</span> fileId<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"TestSeaweedFsController downloadFile in error:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<h2><a id="_524"></a>工具更新</h2>
<p>  到此为止，轮子之王已集成的工具就介绍完毕了，后续还会不断更新、集成新的轮子，下面给大家介绍一下下一段时间项目的一些工作(<strong>如果读者有想要集成的轮子，欢迎提issue或者这文章下面留言</strong>)：</p>
<ul><li>集成一个可视化界面，更好地介绍开源工具中各个轮子的引入案例，方便大家使用。</li><li>集成word文件导出工具</li><li>集成pdf文件导出工具</li><li>集成复杂报表的报表导出工具(使用freemaker框架)</li><li>待更新…</li></ul>
<h2><a id="_534"></a>集成方案介绍关联文章</h2>
<ul><li><a href="https://blog.csdn.net/qq_40891009/article/details/120497976">手把手教你搭建ftp服务器，并用程序完成ftp上传下载功能</a></li><li><a href="https://blog.csdn.net/qq_40891009/article/details/124874311">集成csv工具的前因后果</a></li><li><a href="https://it-learning-diary.blog.csdn.net/article/details/126114259">Gitee图床崩溃后，我使用Seaweedfs搭建了文件系统并封装成轮子开源</a></li></ul>
<h2><a id="_541"></a>写在最后</h2>
<p>  开源之路不容易，开源之心不忘记！<strong>如果博主开源的项目对您有所帮助，请给项目star，给博主更多动力，如果阅读文章给您有所帮助，请给博主点赞、关注。</strong></p>
<p>  该开源项目会持续更新和维护，希望有更多读者能够提出建议和想法，<strong>如果有需要集成的工具，欢迎给项目提issue或者这文章下面留言，博主看到后会及时回复。</strong></p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>