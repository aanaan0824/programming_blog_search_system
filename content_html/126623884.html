<div class="article_content clearfix" id="article_content">
<link href="style.css" rel="stylesheet"/>
<div class="markdown_views prism-atom-one-dark" id="content_views">
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<path d="M5,0 0,2.5 5,5z" id="raphael-marker-block" stroke-linecap="round" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
</svg>
<h1><a id="magicapi_0"></a>【实用工具】magic-api接口快速开发框架</h1>
<p><code>magic-api</code>是一个基于Java的接口快速开发框架，编写接口将通过<code>magic-api</code>提供的<code>UI</code>界面完成，自动映射为<code>HTTP</code>接口。 无需定义<code>Controller</code>、<code>Service</code>、<code>Dao</code>、<code>Mapper</code>、<code>XML</code>、<code>VO</code>等Java对象即可完成常见的<code>HTTP API</code>接口开发。</p>
<p>自学能力较强的朋友传送门：https://www.ssssssss.org/magic-api/</p>
<p><strong>友情提示：如果不是急需使用的，请从第二节开始阅读</strong></p>
<h3><a id="1magicapi_8"></a>1、安装使用magic-api</h3>
<p>springboot项目中引入依赖</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.ssssssss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>magic-api-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>同时还需要其它依赖（一般项目中都会使用到）</p>
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.27<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>在application.yml中配置（主要看magic-api部分即可，其它的是spring配置）</p>
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9999</span>
<span class="token key atrule">magic-api</span><span class="token punctuation">:</span>
  <span class="token comment">#配置web页面入口</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span> /magic/web
  <span class="token key atrule">resource</span><span class="token punctuation">:</span>
  	<span class="token comment">#配置文件存储位置。当以classpath开头时，为只读模式</span>
    <span class="token comment">#mac用户请改为可读写的目录</span>
    <span class="token comment">#如果不想存到文件中，可以参考配置将接口信息存到数据库、Redis中（或自定义）</span>
    <span class="token key atrule">location</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>/data/magic<span class="token punctuation">-</span>api

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/magic<span class="token punctuation">-</span>api<span class="token punctuation">-</span>test<span class="token punctuation">?</span>allowMultiQueries=true<span class="token important">&amp;useUnicode=true&amp;characterEncoding=UTF-</span><span class="token number">8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> test
</code></pre>
<p>然后就可以通过web访问地址：http://localhost:9999/magic/web即可看到magic-api配置界面。</p>
<p>这个web访问地址对应application.yml配置文件中的magic-api.web配置路径</p>
<p>web界面中操作如下图</p>
<p><img alt="magic-api操作界面" src="image\e8c696e16eef42b47ed27383132517ef.png"/></p>
<h3><a id="2magicapi_77"></a>2、magic-api应用场景</h3>
<p>为让大家体会到magic-api的用途，这里列举一些应用场景，以备不时之需。</p>
<h4><a id="api_81"></a>模拟api接口</h4>
<p>magic-api的返回json功能，可以模拟一个api接口，用于调试或者防止终端测试。</p>
<p>场景：开发过程中系统对接了一些第三方平台，但是这些第三方平台不在互联网，而是在一些内网（比如公安网、视频专网、政务网等等），开发、测试环境肯定没法访问到这些平台的服务接口，那么此时可以使用magic-api模拟接口，防止调用不到接口而导致的中断性测试。</p>
<p>示例：</p>
<p>内网接口 /getUserInfo</p>
<p>magic-api创建同名接口 /getUserInfo返回内容如下</p>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> response<span class="token punctuation">;</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
   <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'请求成功'</span><span class="token punctuation">,</span>
   <span class="token literal-property property">code</span><span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">,</span>
   <span class="token literal-property property">obj</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'张三'</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="_105"></a>大屏看板快速开发</h4>
<p>开发可视化大屏数据呈现报表，各单位领导当下数一数二的装逼方式，大家应该都遇到过这样的需求。面对echart报表所需的大量接口，是否需要开发实体类、dao、service、controller呢？</p>
<p>使用magic-api就完全不用写这些三层结构代码（即便你们框架是自动生成代码），因为magic-api可以直接创建接口查询数据库sql</p>
<p>如下代码</p>
<pre><code class="prism language-sql">var id <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token keyword">select</span><span class="token punctuation">(</span><span class="token string">"""
    select * from sys_user where id = #{id}
"""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>这样就可以直接返回数据库查询结果，API接口直达数据库，无需三层结构代码。</p>
<p>Tips：不仅仅是支持sql查询，insert、update、分页操作都是支持，并且有事务管理、并且还支持mybatis语法，相当强大。而且magic-api中是支持逻辑判断、循环遍历等操作的。自带一套语法结构（逻辑判断、运算符等等）。</p>
<p>magic-api语法相关传送门：https://www.ssssssss.org/magic-api/pages/base/script/#关键字</p>
<h4><a id="_126"></a>接口相关的事情都可以做</h4>
<ul><li>返回固定json、字符串</li><li>数据库CRUD</li><li>获取http接口请求参数、处理返回参数</li><li>接口参数校验</li><li>调用java代码</li><li>接口鉴权、拦截器</li><li>拦截器</li><li>默认支持mysql，插件支持redis、mongo、elasticsearch等。</li></ul>
<h3><a id="3Demo_137"></a>3、示例Demo</h3>
<h4><a id="json_139"></a>返回json</h4>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> response<span class="token punctuation">;</span>
<span class="token comment">//直接返回该json，不会被包装处理</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">success</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span> <span class="token operator">:</span> <span class="token string">'执行成功'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="db_150"></a>db分页</h4>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> response<span class="token punctuation">;</span>
<span class="token comment">//返回： 共计10条，第一页的5条数据</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">page</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="db_158"></a>db查询</h4>
<pre><code class="prism language-javascript"><span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'select * from sys_user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="db_164"></a>db插入</h4>
<pre><code class="prism language-javascript"><span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"insert into sys_user(username,password) values('admin','admin)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="db_170"></a>db更新</h4>
<pre><code class="prism language-javascript"><span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">'delete from sys_user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre>
<h4><a id="_176"></a>返回文本</h4>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> response<span class="token punctuation">;</span>
<span class="token comment">//直接返回该text，不会被包装处理</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="_184"></a>重定向</h4>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> response<span class="token punctuation">;</span>
<span class="token comment">//重定向到该地址，内部利用HttpServletResponse的sendRedirect方法</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/xxx/xx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="_192"></a>文件下载</h4>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> response<span class="token punctuation">;</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token string">'文件内容'</span><span class="token punctuation">,</span><span class="token string">'test.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>输出图片</p>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> response<span class="token punctuation">;</span>
<span class="token comment">// 输出图片</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="API_207"></a>请求第三方API接口</h4>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> http<span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9999/sql/select"</span><span class="token punctuation">)</span> 
</code></pre>
<h4><a id="_214"></a>输出图片</h4>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> response<span class="token punctuation">;</span>
<span class="token comment">// 输出图片</span>
<span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a id="API_222"></a>请求第三方API接口</h4>
<pre><code class="prism language-javascript"><span class="token keyword">import</span> http<span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9999/sql/select"</span><span class="token punctuation">)</span> 
</code></pre>
<p>还有许许多多的操作，这里就不做介绍了，这个工具非常强大，使用过才知道有多好，在某些使用场景中非常方便快捷。</p>
</div>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css" rel="stylesheet"/>
<link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css" rel="stylesheet"/>
</div>