{"blogid": "126729798", "writerAge": "码龄1年", "writerBlogNum": "80", "writerCollect": "3793", "writerComment": "3341", "writerFan": "5954", "writerGrade": "7级", "writerIntegral": "9984", "writerName": "knighthood2001", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126729798.jpg", "writerRankTotal": "1343", "writerRankWeekly": "41", "writerThumb": "3306", "writerVisitNum": "159186", "blog_read_count": "153", "blog_time": "已于 2022-09-06 23:46:43 修改", "blog_title": "【UI自动化】微信群聊未添加人数统计", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<blockquote>\n<p> 🔝🔝🔝🔝🔝🔝🔝🔝🔝🔝🔝🔝🔝🔝🔝🔝🔝</p>\n<p><strong>🥰 博客首页：<strong><strong><strong><a href=\"https://blog.csdn.net/knighthood2001?type=blog\" title=\"knighthood2001\">knighthood2001</a></strong></strong></strong></strong></p>\n<p><strong>😗 欢迎点赞👍评论🗨️</strong></p>\n<p><strong>❤️ 热爱python，期待与大家一同进步成长！！❤️</strong></p>\n<p><strong>👀<strong><strong><strong><a href=\"https://www.nowcoder.com/link/pc_csdncpt_knight_python\" title=\"给大家推荐一款很火爆的刷题、面试求职网站\">给大家推荐一款很火爆的刷题、面试求职网站</a></strong></strong></strong>👀</strong></p>\n<p><strong>每日刷题，跟我一起来巩固基础和刷题吧</strong></p>\n</blockquote>\n<p><strong>目的：本来想写个小学、初中、高中、大学中班群中未添加好友的统计，目前就先把最近写的分享出来，方便一起学习、交流！</strong></p>\n<p><strong>步骤：</strong></p>\n<pre><code class=\"language-python\">import subprocess\nimport uiautomation as auto\nimport time\n# ToDo 这里需要更改微信所在地址，可通过桌面微信图标右键打开文件所在的位置查找到路径\nsubprocess.Popen('E:\\微信\\WeChat\\WeChat.exe')\n\nwechatWindow = auto.WindowControl(Name='微信', className=\"WeChatMainWndForPC\")</code></pre>\n<p>        首先是导入相应的模块，如uiautomation和subprocess，然后使用</p>\n<pre>subprocess.Popen()</pre>\n<p>        打开微信（注意是登录状态），接着定义微信窗格对象，使用inspect.exe即可轻松搞定。</p>\n<pre><code class=\"language-python\"># 获取微信窗格的宽和高\nw = wechatWindow.BoundingRectangle.width()\nh = wechatWindow.BoundingRectangle.height()\n# 将微信移到左上角，方便后续操作\nwechatWindow.MoveWindow(0, 0, w, h)</code></pre>\n<p>        这里尽量将微信移到左上角，因为后续点击微信用户时候，需要右击，这样可以防止出错（不信的人可以去试试） </p>\n<p>        接下来定义聊天信息和聊天成员的窗格对象。 </p>\n<pre><code class=\"language-python\">b = wechatWindow.ButtonControl(Name='聊天信息')\nb.Click()\nb1 = wechatWindow.ListControl(Name='聊天成员')\nb2 = wechatWindow.ButtonControl(Name='查看更多')\nif b2.Exists():\n    b2.Click()\n</code></pre>\n<p><img alt=\"\" height=\"331\" src=\"..\\..\\static\\image\\40ce15bc71e9459ca1906fac90e5441a.png\" width=\"363\"/></p>\n<p></p>\n<pre><code class=\"language-python\"># 选框底部\nrect_btm = b1.GetParentControl().BoundingRectangle.bottom</code></pre>\n<p>选框如下图 </p>\n<p><img alt=\"\" height=\"562\" src=\"..\\..\\static\\image\\36db9d4fdde644c18cc4586e88a7b37a.png\" width=\"251\"/></p>\n<pre><code class=\"language-python\"># 定位具体群成员\nspecific_mem = b1.GetChildren()</code></pre>\n<p><strong>重点：</strong></p>\n<pre><code class=\"language-python\">num = 0\nfor member in specific_mem:\n    if not b1.Exists(0, 0):\n        break\n    if member.Name == '添加' or member.Name == '删除':\n        continue\n    if member.BoundingRectangle.bottom &gt; rect_btm:\n        auto.WheelDown(waitTime=0.01)\n    member.Click(15, 15)\n    # 主要是判断“添加到通讯录”按钮是否存在来判断是否添加好友\n    mail = wechatWindow.ButtonControl(Name=\"添加到通讯录\")\n    if mail.Exists(0, 0):\n        num += 1\n        print(member.Name)\n    member.RightClick(15, 15)\n    if auto.IsKeyPressed(auto.Keys.VK_F4):\n        break\n\nprint('未添加的成员个数：', num)\nwechatWindow.MoveToCenter()</code></pre>\n<p>①首先定义num，用来计算未加好友的人数，</p>\n<p>②Exists(0, 0)大致意思表示最快时间搜索</p>\n<p>③对于群中的添加、删除按钮，我们pass即可</p>\n<p>④对于显示不出的群成员，需要进行滚轮滚动，通过判断控件底部的位置高低，实行滚轮滚动。</p>\n<p>⑤主要是判断“添加到通讯录”按钮是否存在来判断是否添加好友，该按钮存在，则计数。</p>\n<p>⑥</p>\n<p><img alt=\"\" height=\"120\" src=\"..\\..\\static\\image\\50f937a520ae48ffb330becb57e4ec55.png\" width=\"178\"/></p>\n<p><strong>我们判断好后，需要让该选框消失，我们可以点击鼠标右键或者点击头像右上角部分，这里笔者采用点击鼠标右键（弊端是不能用在自己创建的群）。</strong></p>\n<p>⑦最后打印，并将微信界面居中。</p>\n<p>这样，我们就实现了一开头的目的。😀😀</p>\n<p></p>\n</div>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-06 23:46:43", "summary": "博客首页：欢迎点赞评论热爱，期待与大家一同进步成长！！给大家推荐一款很火爆的刷题、面试求职网站给大家推荐一款很火爆的刷题、面试求职网站每日刷题，跟我一起来巩固基础和刷题吧目的：本来想写个小学、初中、高"}