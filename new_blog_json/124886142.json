{"blogid": "124886142", "writerAge": "码龄2年", "writerBlogNum": "48", "writerCollect": "52", "writerComment": "3", "writerFan": "51", "writerGrade": "3级", "writerIntegral": "573", "writerName": "厄尔尼诺的夏天", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124886142.jpg", "writerRankTotal": "38444", "writerRankWeekly": "359712", "writerThumb": "25", "writerVisitNum": "33474", "blog_read_count": "3174", "blog_time": "已于 2022-05-20 17:09:42 修改", "blog_title": "MySQL的on duplicate key update 的使用", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p><span style=\"background-color:#fbd4d0;\"> mysql的存在就更新不存在就插入实现</span></p>\n<p>先建数据库表，重点要添加<span style=\"background-color:#c7e6ea;\">主键索引（id列，</span><span style=\"background-color:#fbd4d0;\">没有测试</span><span style=\"background-color:#c7e6ea;\">）和唯一索引（branch_no列）</span>，<span style=\"background-color:#efedf6;\">随便找表测试</span></p>\n<p></p>\n<pre><code class=\"language-sql\">INSERT INTO t_name ( c1, c2, c3 )\nVALUES\n\t( 1, '1', '1') \n\tON DUPLICATE KEY UPDATE\n\tc2 = '2';</code></pre>\n<p>测试：</p>\n<p>1、organ_no, branch_no, branch_name, created_by字段都不相同</p>\n<p>2、branch_name, created_by不同</p>\n<p>3、唯一索引branch_no不同</p>\n<p>4、修改的值包括了唯一索引值branch_no</p>\n<p></p>\n<p>现在数据库表内容</p>\n<p><img alt=\"\" height=\"158\" src=\"..\\..\\static\\image\\5a89cd88889c4258afddc150b3474ac3.png\" width=\"1200\"/></p>\n<p>1、执行sql  ：organ_no, branch_no, branch_name, created_by字段都不相同</p>\n<pre><code class=\"language-sql\">INSERT INTO t_bank_organ_copy1 ( organ_no, branch_no, branch_name, created_by )\nVALUES\n\t( 1, '3', '浙江分行', '3' ) \n\tON DUPLICATE KEY UPDATE\n\tbranch_name = '江苏分行';</code></pre>\n<p><img alt=\"\" height=\"160\" src=\"..\\..\\static\\image\\1bfadff565bc47559584a6bb0f08a863.png\" width=\"1200\"/></p>\n<p> 因为没有值相同，所以一定添加</p>\n<p></p>\n<p>2、branch_name, created_by与表中数据不同</p>\n<p><img alt=\"\" height=\"160\" src=\"..\\..\\static\\image\\1bfadff565bc47559584a6bb0f08a863.png\" width=\"1200\"/></p>\n<pre><code class=\"language-sql\">INSERT INTO t_bank_organ_copy1 ( organ_no, branch_no, branch_name, created_by )\nVALUES\n\t( 1, '3', '海南分行', '4' ) \n\tON DUPLICATE KEY UPDATE\n\tbranch_name = '江苏分行';</code></pre>\n<p><img alt=\"\" height=\"163\" src=\"..\\..\\static\\image\\6a3d4857282c4f39a08ac2c823caf6b3.png\" width=\"1200\"/></p>\n<p>第三条数据从浙江分行改变成了江苏分行</p>\n<p> <span style=\"background-color:#fbd4d0;\">ON DUPLICATE KEY UPDATE 后的值是要修改的值</span></p>\n<p>而这个会根据<span style=\"background-color:#f9eda6;\">唯一索引进行查询，其他普通列不做匹配</span>（主键也是做匹配的）</p>\n<p>可以通过下条验证</p>\n<p></p>\n<p>3、唯一索引branch_no不同</p>\n<p><img alt=\"\" height=\"163\" src=\"..\\..\\static\\image\\6a3d4857282c4f39a08ac2c823caf6b3.png\" width=\"1200\"/></p>\n<pre><code class=\"language-sql\">INSERT INTO t_bank_organ_copy1 ( organ_no, branch_no, branch_name, created_by )\nVALUES\n\t( 1, '4', '江苏分行', '3' ) \n\tON DUPLICATE KEY UPDATE\n\tbranch_name = '海南分行';</code></pre>\n<p>除了唯一索引branch_no不同，其他列都相同</p>\n<p><img alt=\"\" height=\"185\" src=\"..\\..\\static\\image\\3323e68a52eb4856a09e653dae00da67.png\" width=\"1200\"/></p>\n<p>执行后数据库增加一条 </p>\n<p></p>\n<p>4、修改的值包括了唯一索引值branch_no</p>\n<p><img alt=\"\" height=\"185\" src=\"..\\..\\static\\image\\3323e68a52eb4856a09e653dae00da67.png\" width=\"1200\"/></p>\n<p>下面对唯一索引进行修改尝试</p>\n<pre><code class=\"language-sql\">INSERT INTO t_bank_organ_copy1 ( organ_no, branch_no, branch_name, created_by )\nVALUES\n\t( 1, '4', '江苏分行', '3' ) \n\tON DUPLICATE KEY UPDATE\n\tbranch_name = '海南分行',\n\tbranch_no = '8';\n\t</code></pre>\n<p>修改branch_no 4为8，并修改branch_name为海南分行</p>\n<p><img alt=\"\" height=\"183\" src=\"..\\..\\static\\image\\ef5b969aa11f41ac92e2c0e1742d3394.png\" width=\"1200\"/></p>\n<p>可以看出对唯一索引和普通列都做了修改</p>\n<p></p>\n<p><span style=\"background-color:#ed7976;\">总结</span>：</p>\n<p>1、mysql的存在就更新不存在就插入可由on duplicate key update语法实现；</p>\n<p>2、<span style=\"background-color:#fef2f0;\">不过只会检查添加列中有没有匹配到主键id和唯一索引的重复项；</span></p>\n<p>3、<span style=\"background-color:#fef2f0;\">如果有重复项会在on duplicate key update后进行修改指定的字段和内容；</span></p>\n<p>4、所涉及的唯一索引也是可以修改的；</p>\n<p></p>\n<p>最后也可这样写：</p>\n<p>原数据库表</p>\n<p><img alt=\"\" height=\"183\" src=\"..\\..\\static\\image\\ef5b969aa11f41ac92e2c0e1742d3394.png\" width=\"1200\"/></p>\n<pre><code class=\"language-sql\">INSERT INTO t_bank_organ_copy1 ( organ_no, branch_no, branch_name, created_by )\nVALUES\n\t( 1, '8', '河南分行', '3' ) \n\tON DUPLICATE KEY UPDATE\n\tbranch_name = values(branch_name);</code></pre>\n<p><img alt=\"\" height=\"175\" src=\"..\\..\\static\\image\\d8738ec12f3d44e0975849032f91bac3.png\" width=\"1200\"/></p>\n<p> 修改成了河南分行</p>\n</div>\n</div>", "first_tag": "SQL", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 1, "php": 0, "time": "2022-05-20 17:09:42", "summary": "的存在就更新不存在就插入实现先建数据库表，重点要添加主键索引列，没有测试和唯一索引列，随便找表测试测试：、字段都不相同、不同、唯一索引不同、修改的值包括了唯一索引值现在数据库表内容、执行：字段都不相同"}