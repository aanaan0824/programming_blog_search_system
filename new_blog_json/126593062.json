{"blogid": "126593062", "writerAge": "码龄3年", "writerBlogNum": "40", "writerCollect": "44", "writerComment": "9", "writerFan": "584", "writerGrade": "3级", "writerIntegral": "518", "writerName": "会说话的皮卡丘", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126593062.jpg", "writerRankTotal": "30487", "writerRankWeekly": "4062", "writerThumb": "107", "writerVisitNum": "8391", "blog_read_count": "534", "blog_time": "于 2022-09-03 16:09:04 发布", "blog_title": "深入理解redis", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>最近想要手写 一个redis，找到了网上的一门教程，想先跟着过一遍可长城，然后再去复现，具体大概入下</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\5a747a403ae544b8b615037c020989e3.png\"/><br/> 要理解redis我们主要从核心概念，主要流程，数据结构这三个方面去理解<br/> 下图是redis的数据结构部分<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\5a779af258fe477181e0b8c1c10240a4.png\"/><br/> 如图，redis1.0也就只有几千行，代码很少，主要有上图的几个包组成，redis.c ，redis-cli.c(redis-client以及redis-server） ae.c（ae事件库）,anet.c（ae网络库）,zmalloc.c（内存库）<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\0c11c5b6821c488fb945aa1a1b76cf43.png\"/><br/> 上图是redis核心概念图<br/> redisclient主要有四个组成部分，fd文件描述符，db是一个指向redisDBList的指针，clients是指向redisClientList的指针，最后是最后一个最核心的事件循环，是指向AeEventLoop的指针<br/> redisServer主要也是四个，fd，db同上queryBuffer主要是用来存储查询请求的，reply是一个指向redisObjectList的指针，用来存储返回值</p>\n<p>redis里面有一个RedisDB，是一个很大的字典，并且其中的expire表示其有过期时间，int唯一标识</p>\n<p>redisObj的结构非常有意思，他的ptr是一个指向任意类型的指针，type表示指向对象的类型，refcount表示指向对象的引用次数<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\368da66fddb142ceb133aadeab2570fc.png\"/><br/> redis的核心流程主要分为启动流程以及请求流程两部分<br/> 关于为什么不用libevent.C是因为这个包太重了，redis只有几千行没必要再引入一个很重的包<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\6e19edc558ce4c60894582f3c0b1bcc9.png\"/><br/> redis的核心数据结构如上，RedisObj，Dict，adlist</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-03 16:09:04", "summary": "最近想要手写一个，找到了网上的一门教程，想先跟着过一遍可长城，然后再去复现，具体大概入下在这里插入图片描述要理解我们主要从核心概念，主要流程，数据结构这三个方面去理解下图是的数据结构部分在这里插入图片"}