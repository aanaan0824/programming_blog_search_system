{"blogid": "124010475", "writerAge": "码龄6年", "writerBlogNum": "5", "writerCollect": "5", "writerComment": "0", "writerFan": "0", "writerGrade": "1级", "writerIntegral": "63", "writerName": "CubeSun", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124010475.jpg", "writerRankTotal": "173473", "writerRankWeekly": "1055067", "writerThumb": "1", "writerVisitNum": "3130", "blog_read_count": "1700", "blog_time": "于 2022-04-07 11:31:59 发布", "blog_title": ".Net Core定时任务简单实现", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>/// &lt;summary&gt;<br/>     /// 定时任务<br/>     /// &lt;/summary&gt;<br/>     public class TimeJobService : BackgroundService<br/>     {<!-- --><br/>         private readonly ITaskServices _service;<br/>         /// &lt;summary&gt;<br/>         /// 构造函数<br/>         /// &lt;/summary&gt;<br/>         /// &lt;param name=\"service\"&gt;&lt;/param&gt;<br/>         public TimeJobService(ITaskServices service)<br/>         {<!-- --><br/>             _service = service;<br/>         }<br/>         /// &lt;summary&gt;<br/>         /// <br/>         /// &lt;/summary&gt;<br/>         /// &lt;param name=\"stoppingToken\"&gt;&lt;/param&gt;<br/>         /// &lt;returns&gt;&lt;/returns&gt;<br/>         protected override async Task ExecuteAsync(CancellationToken stoppingToken)<br/>         {<!-- --></p>\n<p>            while (!stoppingToken.IsCancellationRequested)<br/>             {<!-- --><br/>                 await new TaskFactory().StartNew(() =&gt;<br/>                 {<!-- --><br/>                     try<br/>                     {<!-- --><br/>                         //满足某种条件执行 比如每天凌晨执行<br/>                         var time = DateTime.Now;<br/>                         var nowDay = DateTime.Now.ToString(\"yyyy-MM-dd\");<br/>                         var benginDate = DateTime.Parse(nowDay + \" 00:00:01\");<br/>                         var endDate = DateTime.Parse(nowDay + \" 00:11:01\");<br/>                         if (time &gt;= benginDate &amp;&amp; time &lt;= endDate)<br/>                         {<!-- --><br/>                             _service.TaskRun();<br/>                         }<br/>                     }<br/>                     catch (Exception e)<br/>                     {<!-- --><br/>                     }</p>\n<p>                    //定时任务休眠，10分钟执行一次<br/>                     Thread.Sleep(60 * 1000 * 10);<br/>                 });<br/>             }<br/>         }<br/>     }</p>\n<p>Startup.cs注入</p>\n<p>//自动注入定时器开始,//后台任务启动专用.   <br/> services.AddTransient&lt;Microsoft.Extensions.Hosting.IHostedService, TimeJobService&gt;(); </p>\n</div>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-04-07 11:31:59", "summary": "定时任务构造函数满足某种条件执行比如每天凌晨执行定时任务休眠，分钟执行一次注入自动注入定时器开始后台任务启动专用"}