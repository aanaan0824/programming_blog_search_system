{"blogid": "126657082", "writerAge": "码龄99天", "writerBlogNum": "176", "writerCollect": "2299", "writerComment": "180", "writerFan": "774", "writerGrade": "5级", "writerIntegral": "3008", "writerName": "Mdc_stdio", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126657082.jpg", "writerRankTotal": "5961", "writerRankWeekly": "245", "writerThumb": "1072", "writerVisitNum": "144618", "blog_read_count": "1037", "blog_time": "于 2022-09-02 10:15:43 发布", "blog_title": "【毕业设计】单片机家用燃气的可视化实时监控报警仪 - 物联网 嵌入式 stm32", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#0__5\">0 前言</a></li><li><a href=\"#1__28\">1 简介</a></li><li><a href=\"#2__34\">2 主要器件</a></li><li><a href=\"#3__42\">3 实现效果</a></li><li><a href=\"#4__50\">4 设计原理</a></li><li><ul><li><a href=\"#41__52\">4.1 硬件部分</a></li><li><a href=\"#42__72\">4.2 软件部分</a></li></ul>\n</li><li><a href=\"#5__79\">5 部分核心代码</a></li><li><a href=\"#6__379\">6 最后</a></li></ul>\n</div>\n<p></p>\n<hr color=\"#000000\" size='1\"'/>\n<h1><a id=\"0__5\"></a>0 前言</h1>\n<p>🔥 这两年开始毕业设计和毕业答辩的要求和难度不断提升，传统的毕设题目缺少创新和亮点，往往达不到毕业答辩的要求，这两年不断有学弟学妹告诉学长自己做的项目系统达不到老师的要求。</p>\n<p>为了大家能够顺利以及最少的精力通过毕设，学长分享优质毕业设计项目，今天要分享的是</p>\n<p>🚩 <strong>基于单片机的家用燃气的可视化实时监控报警仪</strong></p>\n<p>🥇学长这里给一个题目综合评分(每项满分5分)</p>\n<ul><li>难度系数：4分</li><li>工作量：4分</li><li>创新点：3分</li></ul>\n<p>🧿 <strong>选题指导, 项目分享：</strong></p>\n<p><a href=\"https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md\">https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md</a></p>\n<br/>\n<h1><a id=\"1__28\"></a>1 简介</h1>\n<p>本项目设计主要功能是可以用于家用燃气的可视化实时监控的迷你报警器，传感器部分和米家等绝大多数网络上的家用燃气报警使用的一致，还支持便捷更换传感器。具备WIFI模块，支持AT命令的设置。</p>\n<h1><a id=\"2__34\"></a>2 主要器件</h1>\n<ul><li>HK32F031K6U6主控芯片</li><li>SP485E芯片</li><li>ch340e芯片</li><li>MIC5219-3.3稳压芯片</li><li>WiFi模块</li></ul>\n<h1><a id=\"3__42\"></a>3 实现效果</h1>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9400f0b487e042c4ae54651e946b6509.png\"/></p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\2ecc837c88ec41fbbad6b8fe2934d7f9.png\"/><br/> <img alt=\" \" src=\"..\\..\\static\\image\\42c6a7dd78624441a866f847a6367634.png\"/></p>\n<h1><a id=\"4__50\"></a>4 设计原理</h1>\n<h2><a id=\"41__52\"></a>4.1 硬件部分</h2>\n<p>本项目涉及到的功能模块有：</p>\n<ul><li>USB转TTL通信</li><li>USB与单片机通信</li><li>USB与WIFI模块通信</li><li>单片机驱动OLED液晶屏</li><li>单片机驱动AHT20/21温湿度芯片</li><li>单片机PWM驱动蜂鸣器</li><li>单片机AD采集可燃传感器的电压值等功能。</li></ul>\n<p>前面和USB相关的测试方法就是插电脑和正常使用的485转接线进行连线传输，尝试不同的波特率和传输速率进行收发通信，不丢包，稳定传输就是通过测试，否则要检查硬件电路上的问题，是否有虚焊和器件上的损坏。<br/> OLED和温湿度芯片采用IIC相关的驱动，单输出IIC可以不加上拉电阻能实现功能，但是交互式的，要获取数据的就必须加上上拉电阻才能收数正常。而且燃气传感器是催化燃烧方式的，本身会发热，且发热量还不小，故应该尽可能的把温湿度芯片和可燃传感器分的远点，不然温度和湿度测试的都不准确。每个功能模块通过软件编程实现功能后都要进行对比。屏幕驱动比较直观，看到什么就是什么了，温湿度需要进行一定的补偿。<br/> 最后蜂鸣器和按键功能的增加，蜂鸣器是5020的封装，想要实现比较亮的声音就要分析和测试，不断调教，找到比较响亮的蜂鸣声。按键功能可以做很多的联动，这里把它做成了控制屏幕显示反转的功能。</p>\n<p><strong>主要原理图</strong><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\950b1561e3f141d7b235341e8888b991.png\"/></p>\n<h2><a id=\"42__72\"></a>4.2 软件部分</h2>\n<p>整体逻辑流程如下：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e821873305704bcfa5e6a6356a44091e.png\"/></p>\n<h1><a id=\"5__79\"></a>5 部分核心代码</h1>\n<pre><code class=\"prism language-c\"><span class=\"token keyword\">void</span> <span class=\"token function\">HAL_Delay_us_init</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint8_t</span> SYSCLK<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\tfac_us<span class=\"token operator\">=</span>SYSCLK<span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">void</span> <span class=\"token function\">HAL_Delay_us</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint32_t</span> nus<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token class-name\">uint32_t</span> ticks<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">uint32_t</span> told<span class=\"token punctuation\">,</span>tnow<span class=\"token punctuation\">,</span>tcnt<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">uint32_t</span> reload<span class=\"token operator\">=</span>SysTick<span class=\"token operator\">-&gt;</span>LOAD<span class=\"token punctuation\">;</span>\n\tticks<span class=\"token operator\">=</span>nus<span class=\"token operator\">*</span>fac_us<span class=\"token punctuation\">;</span> \n\ttold<span class=\"token operator\">=</span>SysTick<span class=\"token operator\">-&gt;</span>VAL<span class=\"token punctuation\">;</span> \n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\ttnow<span class=\"token operator\">=</span>SysTick<span class=\"token operator\">-&gt;</span>VAL<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>tnow<span class=\"token operator\">!=</span>told<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>tnow<span class=\"token operator\">&lt;</span>told<span class=\"token punctuation\">)</span>tcnt<span class=\"token operator\">+=</span>told<span class=\"token operator\">-</span>tnow<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">else</span> tcnt<span class=\"token operator\">+=</span>reload<span class=\"token operator\">-</span>tnow<span class=\"token operator\">+</span>told<span class=\"token punctuation\">;</span>\n\t\t\t\ttold<span class=\"token operator\">=</span>tnow<span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>tcnt<span class=\"token operator\">&gt;=</span>ticks<span class=\"token punctuation\">)</span><span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span> \n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">/* USER CODE END PFP */</span>\n\n<span class=\"token comment\">/* Private user code ---------------------------------------------------------*/</span>\n<span class=\"token comment\">/* USER CODE BEGIN 0 */</span>\n<span class=\"token comment\">/*\n****************************************************************************************************\n** 函数名称： Get_analog_voltage(u8 ch)\n** 完成时间:  2017.5.24\n** 编 写 人:  DIX\n** 入口参数： u8 ch\n** 返 回 值： 电压值\n** 功能说明： ADC信号转换为电压值mV\n** 备注说明： 获得ADC模拟出的电压 12位精度 (0~3.3V之间的mV值)\n****************************************************************************************************\n*/</span>\n<span class=\"token class-name\">uint16_t</span> <span class=\"token function\">Get_analog_voltage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint8_t</span> AD<span class=\"token punctuation\">)</span>                  \n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token class-name\">uint32_t</span> sum<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>                                 <span class=\"token comment\">//采样20次的累计和</span>\n\t<span class=\"token class-name\">uint8_t</span>  count<span class=\"token punctuation\">;</span>\t  \n\t<span class=\"token class-name\">uint16_t</span> A_AD_Value<span class=\"token punctuation\">;</span>                            <span class=\"token comment\">//单通道AD的变量值</span>\n\tADC_ChannelConfTypeDef sConfig<span class=\"token punctuation\">;</span>\n\thadc<span class=\"token punctuation\">.</span>Instance<span class=\"token operator\">-&gt;</span>CHSELR <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\t\n  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>AD<span class=\"token operator\">==</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\tsConfig<span class=\"token punctuation\">.</span>Channel <span class=\"token operator\">=</span> ADC_CHANNEL_8<span class=\"token punctuation\">;</span>\t\n\t<span class=\"token punctuation\">}</span>\t\n\t<span class=\"token keyword\">else</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\tsConfig<span class=\"token punctuation\">.</span>Channel <span class=\"token operator\">=</span> ADC_CHANNEL_TEMPSENSOR<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\t\n\tsConfig<span class=\"token punctuation\">.</span>Rank <span class=\"token operator\">=</span> ADC_RANK_CHANNEL_NUMBER<span class=\"token punctuation\">;</span>\n\tsConfig<span class=\"token punctuation\">.</span>SamplingTime <span class=\"token operator\">=</span> ADC_SAMPLETIME_239CYCLES_5<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">HAL_ADC_ConfigChannel</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>hadc<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>sConfig<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t\n\tA_AD_Value<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>                                   <span class=\"token comment\">//AD值清0</span>\n\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>count<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>count<span class=\"token operator\">&lt;</span><span class=\"token number\">50</span><span class=\"token punctuation\">;</span>count<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>                   <span class=\"token comment\">//重复采样50次</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token function\">HAL_ADCEx_Calibration_Start</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>hadc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">//校准ADC</span>\n\t\t<span class=\"token function\">HAL_ADC_Start</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>hadc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                         <span class=\"token comment\">//开启ADC</span>\n\t\t<span class=\"token function\">HAL_ADC_PollForConversion</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>hadc<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t      <span class=\"token comment\">//等待转换过程</span>\n\t\tsum <span class=\"token operator\">+=</span> <span class=\"token function\">HAL_ADC_GetValue</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>hadc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//获得50采样的累计和</span>\n\t<span class=\"token punctuation\">}</span>\n\tA_AD_Value<span class=\"token operator\">=</span>sum<span class=\"token operator\">/</span><span class=\"token number\">50</span><span class=\"token punctuation\">;</span>                              <span class=\"token comment\">//AD采样50次后取平均值</span>\n\tA_AD_Value<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">uint16_t</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>A_AD_Value<span class=\"token operator\">*</span><span class=\"token number\">3300</span><span class=\"token operator\">/</span><span class=\"token number\">4096</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">//扩大了1000倍整数为1mV值</span>\n\t\n\tsum<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>                                          <span class=\"token comment\">//清0总值</span>\n\t<span class=\"token keyword\">return</span> A_AD_Value<span class=\"token punctuation\">;</span>                              <span class=\"token comment\">//返回值</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">int8_t</span> <span class=\"token function\">Temper_Judgment</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token class-name\">int8_t</span>  temper<span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">uint16_t</span> adc_value<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\tadc_value <span class=\"token operator\">=</span> <span class=\"token function\">Get_analog_voltage</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  temper <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">int8_t</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>adc_value<span class=\"token operator\">-</span><span class=\"token number\">449</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">1.61</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">return</span> temper<span class=\"token punctuation\">;</span>                                   <span class=\"token comment\">//返回值</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">//u16进制转换为字符串</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">u16tostr</span><span class=\"token punctuation\">(</span>u16 dat<span class=\"token punctuation\">)</span> \n<span class=\"token punctuation\">{<!-- --></span>\n\tu8 temp<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\tu8 i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>j<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>k<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>dat<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\ttemp<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>dat<span class=\"token operator\">%</span><span class=\"token number\">10</span><span class=\"token operator\">+</span><span class=\"token number\">0x30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ti<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n\t\tdat<span class=\"token operator\">/=</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\tj<span class=\"token operator\">=</span>i<span class=\"token punctuation\">;</span>\n\tk<span class=\"token operator\">=</span>j<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//\tfor(i=0;i&lt;j;i++)</span>\n<span class=\"token comment\">//\t{<!-- --></span>\n<span class=\"token comment\">//\t\tstr1[i] = temp[j-i-1];</span>\n<span class=\"token comment\">//\t}</span>\n\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">4</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token operator\">-</span>k<span class=\"token operator\">&gt;</span>i<span class=\"token punctuation\">)</span>\n\t\t\tstr1<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span><span class=\"token char\">' '</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">else</span> \n\t\t<span class=\"token punctuation\">{<!-- --></span>\t\n\t\t  <span class=\"token comment\">//j=j-1;</span>\n\t\t  str1<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> temp<span class=\"token punctuation\">[</span><span class=\"token operator\">--</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\t\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>i<span class=\"token punctuation\">)</span> \n\t<span class=\"token punctuation\">{<!-- --></span>str1<span class=\"token punctuation\">[</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token char\">'0'</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n\t<span class=\"token comment\">//return str1;</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n<span class=\"token comment\">/* USER CODE END 0 */</span>\n\n<span class=\"token comment\">/**\n  * @brief  The application entry point.\n  * @retval int\n  */</span>\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token comment\">/* USER CODE BEGIN 1 */</span>\n\tu8 x<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//\tu32 CT_data[2]={0};</span>\n<span class=\"token comment\">//  volatile float  hum=0,tem=0;   </span>\n  <span class=\"token comment\">/* USER CODE END 1 */</span>\n  \n\n  <span class=\"token comment\">/* MCU Configuration--------------------------------------------------------*/</span>\n\n  <span class=\"token comment\">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span>\n  <span class=\"token function\">HAL_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* USER CODE BEGIN Init */</span>\n\t<span class=\"token function\">HAL_Delay_us_init</span><span class=\"token punctuation\">(</span><span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>   <span class=\"token comment\">//系统24MHz时钟</span>\n  <span class=\"token comment\">/* USER CODE END Init */</span>\n\n  <span class=\"token comment\">/* Configure the system clock */</span>\n  <span class=\"token function\">SystemClock_Config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/* USER CODE BEGIN SysInit */</span>\n\n  <span class=\"token comment\">/* USER CODE END SysInit */</span>\n\n  <span class=\"token comment\">/* Initialize all configured peripherals */</span>\n  <span class=\"token function\">MX_GPIO_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">MX_DMA_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">MX_ADC_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">MX_USART2_UART_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">MX_TIM3_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">MX_TIM1_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">MX_TIM2_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">MX_TIM6_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">MX_USART1_UART_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/* USER CODE BEGIN 2 */</span>\n\t<span class=\"token function\">HAL_TIM_Base_Start_IT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>htim2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                           <span class=\"token comment\">//开启定时器2</span>\n\t<span class=\"token function\">HAL_TIM_Base_Start_IT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>htim3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                           <span class=\"token comment\">//开启定时器3</span>\n\t<span class=\"token function\">HAL_TIM_Base_Start_IT</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>htim1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                           <span class=\"token comment\">//开启定时器6</span>\n  <span class=\"token function\">OLED_Init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">OLED_Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n\t<span class=\"token function\">OLED_DisplayTurn</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token comment\">//AHT20.alive=!AHT20_Init();\t                             //AHT20温湿度传感器初始化</span>\n\t<span class=\"token function\">temphum_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                                          <span class=\"token comment\">//ATH20初始化</span>\n\t<span class=\"token comment\">/*打开串口1空闲中断*/</span>\n  <span class=\"token comment\">//__HAL_UART_ENABLE_IT(&amp;huart2, UART_IT_IDLE);           //使能串口2中断</span>\n\t<span class=\"token comment\">/*打开串口1接收DMA中断*/</span>\n  <span class=\"token comment\">//HAL_UART_Receive_DMA(&amp;huart2,rx_buffer,BUFFER_SIZE);   //串口接收DMA通道\t</span>\n  <span class=\"token comment\">/* USER CODE END 2 */</span>\n\n  <span class=\"token comment\">/* Infinite loop */</span>\n  <span class=\"token comment\">/* USER CODE BEGIN WHILE */</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token comment\">/* USER CODE END WHILE */</span>\n\n    <span class=\"token comment\">/* USER CODE BEGIN 3 */</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>btimer<span class=\"token punctuation\">)</span>                                  <span class=\"token comment\">//1s中断</span>\n\t\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t\tbtimer <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>bcont<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//\t\t\tNow_U = Get_analog_voltage(8);            //采用内部ADC采样</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>bcont<span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\t\t\n\t\t\t\t<span class=\"token function\">OLED_Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                             <span class=\"token comment\">//清屏</span>\n\t\t\t\t<span class=\"token comment\">//HAL_Delay(1000);                          //延时1秒</span>\n\t\t\t\t<span class=\"token function\">OLED_DrawBMP</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">,</span>BMP5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">//图片显示LOGO</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>bcont<span class=\"token operator\">==</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\t\t\n\t\t\t\t<span class=\"token function\">OLED_Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                             <span class=\"token comment\">//清屏</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                 <span class=\"token comment\">//第</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">24</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//六</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">13</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//届</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">14</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                 <span class=\"token comment\">//立</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">24</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//创</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//杯\t</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                  <span class=\"token comment\">//燃</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">17</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//气</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">19</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//监\t</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//测</span>\n\t\t\t\t<span class=\"token comment\">//OLED_ShowString(8,4,\"Ex\",16);  </span>\n\t\t\t\t<span class=\"token comment\">//OLED_ShowString(0,4,\" O L E D\",16);  </span>\n\t\t\t\t<span class=\"token comment\">//OLED_ShowString(0,4,\" 29.1\",16);           //数据</span>\n\t\t\t\t<span class=\"token comment\">//OLED_ShowCHinese(44,4,21);                 //℃</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>bcont<span class=\"token operator\">==</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\n\t\t\t\t<span class=\"token function\">OLED_Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                             <span class=\"token comment\">//清屏</span>\n\t\t\t\t<span class=\"token comment\">//OLED_ShowString(0,0,\"12.6\",16);           //数据</span>\n\t\t\t\t<span class=\"token comment\">//OLED_ShowString(32,0,\"%LEL\",16);          //可燃单位</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                 <span class=\"token comment\">//温</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">23</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//湿</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">24</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//度\t</span>\n\n\t\t\t\t<span class=\"token function\">OLED_ShowString</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token string\">\" 26.2\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>          <span class=\"token comment\">//数据</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">21</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                <span class=\"token comment\">//℃</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowString</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"50.7\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">//数据</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowString</span><span class=\"token punctuation\">(</span><span class=\"token number\">40</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"%RH\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>           <span class=\"token comment\">//湿度单位</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>bcont<span class=\"token operator\">&gt;=</span><span class=\"token number\">19</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\n\t\t\t\tNow_U <span class=\"token operator\">=</span> <span class=\"token function\">Get_analog_voltage</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//采用内部ADC采样</span>\n\t\t\t\tTemper<span class=\"token operator\">=</span><span class=\"token function\">Temper_Judgment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                 <span class=\"token comment\">//温度换算函数</span>\n<span class=\"token comment\">//\t\t\t\t/*--------AHT20读取数据---------*/</span>\n<span class=\"token comment\">//\t\t\t\tif(AHT20.alive)// 如果AHT20传感器存在，则读取温湿度数据</span>\n<span class=\"token comment\">//\t\t\t\t{<!-- --></span>\n<span class=\"token comment\">//\t\t\t\t\t//读取AHT20的 20Bit原始数据</span>\n<span class=\"token comment\">//\t\t\t\t\tAHT20.flag = AHT20_ReadHT(AHT20.HT);</span>\n<span class=\"token comment\">//\t\t\t\t\t//实际标准单位转换</span>\n<span class=\"token comment\">// \t\t\t\t\tStandardUnitCon(&amp;AHT20);</span>\n<span class=\"token comment\">//\t\t\t\t}</span>\n\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>bcont<span class=\"token operator\">==</span><span class=\"token number\">19</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\n\t\t\t\t\t<span class=\"token function\">OLED_Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                           <span class=\"token comment\">//清屏</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>Now_U<span class=\"token operator\">&gt;=</span><span class=\"token number\">900</span> <span class=\"token operator\">&amp;&amp;</span> Now_U<span class=\"token operator\">&lt;</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n\t\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\n\t\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//警\t</span>\n\t\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//戒</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>Now_U<span class=\"token operator\">&gt;=</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\t\n\t\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\n\t\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//危</span>\n\t\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>              <span class=\"token comment\">//险</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\t\t\n\t\t\t\t<span class=\"token keyword\">else</span>\n\t\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\n\t\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//安</span>\n\t\t\t\t\t<span class=\"token function\">OLED_ShowCHinese</span><span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">//全</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\t\t\t\n\t\t\t\t<span class=\"token function\">u16tostr</span><span class=\"token punctuation\">(</span>Now_U<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowString</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"U:\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>             <span class=\"token comment\">//电压</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowString</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>str1<span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//数据</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowString</span><span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"mV\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            <span class=\"token comment\">//电压单位</span>\n\t\t\t  <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>str1<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token function\">Calculate_Concentration</span><span class=\"token punctuation\">(</span>Now_U<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//显示浓度</span>\n\t\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">Calculate_Concentration</span><span class=\"token punctuation\">(</span>Now_U<span class=\"token punctuation\">)</span><span class=\"token operator\">&gt;=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token function\">HAL_TIM_PWM_Start</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>htim3<span class=\"token punctuation\">,</span>TIM_CHANNEL_4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">else</span>\n\t\t\t\t\t<span class=\"token function\">HAL_TIM_PWM_Stop</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>htim3<span class=\"token punctuation\">,</span>TIM_CHANNEL_4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t  <span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>str1<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowString</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"%LEL\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>          <span class=\"token comment\">//可燃单位</span>\n\t\t\t\t<span class=\"token function\">OLED_ShowString</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Ex\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>             <span class=\"token comment\">//可燃标致</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>bcont<span class=\"token operator\">&gt;=</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">{<!-- --></span>\t\n<span class=\"token comment\">//\t\t\t\tAHT20_Read_CTdata(CT_data);            //不经过CRC校验，直接读取AHT20的温度和湿度数据 </span>\n<span class=\"token comment\">//        hum = CT_data[0]*100*10/1024/1024;     //计算得到湿度值（放大了10倍）</span>\n<span class=\"token comment\">//        tem = CT_data[1]*200*10/1024/1024-500; //计算得到温度值（放大了10倍）</span>\n<span class=\"token comment\">//\t\t\t\tHAL_Delay(2000);                       //延时1秒</span>\n\t\t\t\tbcont<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\t\t\t\t\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">HAL_GPIO_ReadPin</span><span class=\"token punctuation\">(</span>KEY_GPIO_Port<span class=\"token punctuation\">,</span> KEY_Pin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">{<!-- --></span>\t\t<span class=\"token comment\">//读取KEY按键引脚，低电平表示按下</span>\n\t\t\t<span class=\"token comment\">//HAL_GPIO_TogglePin(LED_GPIO_Port, LED_Pin);\t\t//LED引脚电平取反</span>\n\t\t\t<span class=\"token function\">HAL_Delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t\t\t\t\t\t                  <span class=\"token comment\">//延时</span>\n\t\t\t<span class=\"token function\">OLED_Clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n\t\t\tx<span class=\"token operator\">=</span><span class=\"token operator\">!</span>x<span class=\"token punctuation\">;</span>                                           <span class=\"token comment\">//变量取反</span>\n\t\t\t<span class=\"token function\">OLED_DisplayTurn</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">HAL_GPIO_ReadPin</span><span class=\"token punctuation\">(</span>KEY_GPIO_Port<span class=\"token punctuation\">,</span> KEY_Pin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//等待松手，防松手抖动</span>\n\t\t\t<span class=\"token function\">HAL_Delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t\t\t\t\t\t\t\t                  <span class=\"token comment\">//延时</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t\n\t<span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/* USER CODE END 3 */</span>\n<span class=\"token punctuation\">}</span>\n\n\n\n</code></pre>\n<br/>\n<h1><a id=\"6__379\"></a>6 最后</h1>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-02 10:15:43", "summary": "文章目录前言简介主要器件实现效果设计原理硬件部分软件部分部分核心代码最后前言这两年开始毕业设计和毕业答辩的要求和难度不断提升，传统的毕设题目缺少创新和亮点，往往达不到毕业答辩的要求，这两年不断有学弟学"}