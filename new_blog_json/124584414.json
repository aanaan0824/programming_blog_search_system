{"blogid": "124584414", "writerAge": "码龄5年", "writerBlogNum": "49", "writerCollect": "130", "writerComment": "23", "writerFan": "17", "writerGrade": "3级", "writerIntegral": "680", "writerName": "Sunny Feng", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124584414.jpg", "writerRankTotal": "48477", "writerRankWeekly": "366783", "writerThumb": "43", "writerVisitNum": "102214", "blog_read_count": "2436", "blog_time": "已于 2022-05-05 16:46:08 修改", "blog_title": "配置nginx反向代理", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>在之前nginx， php ,mariadb 的基础上配置反向代理<br/> 之前的配置链接<br/> https://blog.csdn.net/weixin_38232096/article/details/124557082</p>\n<p>克隆快照，创建两个新系统<br/> web 代理服务器 222.111.106.11；<br/> server1 222.111.106.12;<br/> server2 222.111.106.13;</p>\n<ol><li>Nginx反向代理后端http网站<br/> 分别重新安装httpd, php<br/> yum -y install httpd php<br/> [root@sunny2 ~]# vim /etc/httpd/conf/httpd.conf</li></ol>\n<pre><code>DocumentRoot \"/var/www/webhtml\"\n\n#\n# Relax access to content within /var/www.\n#\n&lt;Directory \"/var/www\"&gt;\n    AllowOverride None\n    # Allow open access:\n    Require all granted\n&lt;/Directory&gt;\n\n# Further relax access to the default document root:\n&lt;Directory \"/var/www/webhtml\"&gt;\n\n</code></pre>\n<p>[root@sunny2 ~]# cat /var/www/webhtml/index.php<br/> This is www2<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\236b35ac0c824a93ba340a2aac033c5b.png\"/><br/> [root@sunny2 ~]# vim /var/www/webhtml/index.php<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\76e9fb58b09742acb7c1e2a376ad4e25.png\"/></p>\n<p>下面在主服务器配置代理<br/> [root@sunny ~]# vim /usr/local/nginx/conf/nginx.conf</p>\n<pre><code>    upstream cluster1 {\n         server 222.111.106.12;\n         server 222.111.106.13;\n    }\n\n\n</code></pre>\n<pre><code>    location / {\n        root   html;\n        index  index.php index.html;\n        **proxy_pass http://cluster1;**\n     }\n</code></pre>\n<p>重启nginx<br/> #ngx-reload</p>\n<p>Ctrl+F5 刷新页面<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\cf51c9b214174c5eb76fb6fdfa340b75.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\13b0254ecfdf44f28c1f022f8cd61dfd.png\"/><br/> 2. Nginx 反向代理后端ssh服务器<br/> 配置nginx.conf<br/> [root@sunny ~]# vim /usr/local/nginx/conf/nginx.conf</p>\n<pre><code>stream {\n    upstream ssh_node2{\n      server 222.111.106.17:22 max_fails=3 fail_timeout=30s;\n}\n\n    server {\n     listen 2222;\n     proxy_connect_timeout 60s;\n     proxy_timeout 10m;\n     proxy_pass ssh_node2;\n\n  }\n\n}\n\n</code></pre>\n<p>测试：</p>\n<pre><code>[root@sunny ~]# netstat -tnl|grep 2222\ntcp        0      0 0.0.0.0:2222            0.0.0.0:*               LISTEN  \n</code></pre>\n<p>在另外一台电脑测试，通过代理服务器访问</p>\n<pre><code>Connection to 222.111.106.18 closed.\n[root@sunny2 ~]# ssh -p 2222  root@222.111.106.18\nroot@222.111.106.18's password: \nLast login: Thu May  5 15:45:36 2022 from 222.111.106.18\n[root@sunny2 ~]# \n\n在这里插入代码片\n</code></pre>\n<pre><code>[root@sunny2 ~]# ifconfig\nens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 222.111.106.17  netmask 255.255.0.0  broadcast 222.111.255.255\n        inet6 fe80::a143:dcb9:e70f:b133  prefixlen 64  scopeid 0x20&lt;link&gt;\n        inet6 fe80::80e1:a1cc:ff67:ab7c  prefixlen 64  scopeid 0x20&lt;link&gt;\n        inet6 fe80::eaa:1060:4b26:40f6  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:0c:29:ec:58:39  txqueuelen 1000  (Ethernet)\n        RX packets 490525  bytes 37520797 (35.7 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 4145  bytes 837842 (818.2 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-05-05 16:46:08", "summary": "在之前，的基础上配置反向代理之前的配置链接克隆快照，创建两个新系统代理服务器；反向代理后端网站分别重新安装在这里插入图片描述在这里插入图片描述下面在主服务器配置代理重启刷新页面在这里插入图片描述在这里"}