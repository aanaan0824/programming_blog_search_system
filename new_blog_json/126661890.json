{"blogid": "126661890", "writerAge": "码龄3年", "writerBlogNum": "155", "writerCollect": "929", "writerComment": "102", "writerFan": "665", "writerGrade": "5级", "writerIntegral": "2035", "writerName": "小绵杨Yancy", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126661890.jpg", "writerRankTotal": "9039", "writerRankWeekly": "10303", "writerThumb": "201", "writerVisitNum": "175127", "blog_read_count": "338", "blog_time": "于 2022-09-02 15:08:45 发布", "blog_title": "【Vue】Axios取消请求", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"_0\"></a>一、前言</h1>\n<p>有的时候我们需要取消axios发出的请求，例如在退出页面时，取消掉仍然在进行的请求。</p>\n<h1><a id=\"AbortController_2\"></a>二、AbortController</h1>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController\">mdn中AbortController的介绍。</a><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\dee7c665b8ca47788a49855d1b407693.png\"/><br/> 从 v0.22.0 开始，Axios 支持以 fetch API 方式—— AbortController 取消请求：</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">const</span> controller <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AbortController</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\naxios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/foo/bar'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{<!-- --></span>\n   <span class=\"token literal-property property\">signal</span><span class=\"token operator\">:</span> controller<span class=\"token punctuation\">.</span>signal\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n   <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 取消请求</span>\ncontroller<span class=\"token punctuation\">.</span><span class=\"token function\">abort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>注意这里在发送请求时，额外携带了一个signal参数：</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token literal-property property\">signal</span><span class=\"token operator\">:</span> controller<span class=\"token punctuation\">.</span>signal\n</code></pre>\n<p>这是AbortController实例（<code>controller.abort()</code>）去取消请求的<code>标记</code>。</p>\n<h1><a id=\"CancelToken_24\"></a>三、CancelToken</h1>\n<p>您还可以使用 cancel token 取消一个请求。</p>\n<ul><li>Axios 的 cancel token API 是基于被撤销 cancelable promises proposal。</li><li>此 API 从 v0.22.0 开始已被弃用，不应在新项目中使用。</li></ul>\n<p>可以使用 CancelToken.source 工厂方法创建一个 cancel token ，如下所示：</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">const</span> CancelToken <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span>CancelToken<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> source <span class=\"token operator\">=</span> CancelToken<span class=\"token punctuation\">.</span><span class=\"token function\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\naxios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user/12345'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token literal-property property\">cancelToken</span><span class=\"token operator\">:</span> source<span class=\"token punctuation\">.</span>token\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">thrown</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>axios<span class=\"token punctuation\">.</span><span class=\"token function\">isCancel</span><span class=\"token punctuation\">(</span>thrown<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Request canceled'</span><span class=\"token punctuation\">,</span> thrown<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token comment\">// 处理错误</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\naxios<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user/12345'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'new name'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token literal-property property\">cancelToken</span><span class=\"token operator\">:</span> source<span class=\"token punctuation\">.</span>token\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 取消请求（message 参数是可选的）</span>\nsource<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Operation canceled by the user.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "JavaScript", "cpp": 0, "csharp": 0, "python": 0, "javascript": 1, "java": 0, "sql": 0, "php": 0, "time": "2022-09-02 15:08:45", "summary": "一、前言有的时候我们需要取消发出的请求，例如在退出页面时，取消掉仍然在进行的请求。二、中的介绍。在这里插入图片描述从开始，支持以方式取消请求：取消请求注意这里在发送请求时，额外携带了一个参数：这是实例"}