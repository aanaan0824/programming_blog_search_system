{"blogid": "126503545", "writerAge": "码龄5年", "writerBlogNum": "111", "writerCollect": "48", "writerComment": "6", "writerFan": "9", "writerGrade": "4级", "writerIntegral": "1143", "writerName": "南风知我意丿", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126503545.jpg", "writerRankTotal": "18272", "writerRankWeekly": "5740", "writerThumb": "15", "writerVisitNum": "32432", "blog_read_count": "291", "blog_time": "于 2022-08-24 15:38:18 发布", "blog_title": "Spark/Hive 行列转换", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>Spark/hive Sql 行列转换</h3>\n<ul><li><a href=\"#explode_1\">explode</a></li><li><ul><li><a href=\"#demo_8\">demo</a></li><li><ul><li><ul><li><a href=\"#explodemap_9\">explode(map)</a></li><li><a href=\"#lateral_view_explodemap_17\">lateral view explode(map)</a></li><li><a href=\"#explodearray_26\">explode(array)</a></li></ul>\n</li></ul>\n</li></ul>\n</li><li><a href=\"#lateral_view_36\">lateral view</a></li><li><ul><li><a href=\"#demo_40\">demo</a></li><li><ul><li><ul><li><a href=\"#lateral_view_explode_41\">lateral view explode</a></li><li><a href=\"#id_53\">统计id出现次数</a></li><li><a href=\"#lateral_view_parse_url_tuple_62\">lateral view parse_url_tuple</a></li></ul>\n</li></ul>\n</li></ul>\n</li><li><a href=\"#_86\">列转行</a></li><li><ul><li><a href=\"#_98\">单列转多行</a></li><li><ul><li><ul><li><a href=\"#LATERAL_VIEW_explode_99\">LATERAL VIEW explode</a></li></ul>\n</li></ul>\n</li><li><a href=\"#_117\">多列转多行</a></li><li><ul><li><ul><li><a href=\"#LATERAL_VIEW_posexplode_118\">LATERAL VIEW posexplode</a></li><li><a href=\"#split_137\">split</a></li></ul>\n</li></ul>\n</li></ul>\n</li><li><a href=\"#_169\">行转列</a></li><li><ul><li><a href=\"#_170\">单行转多列</a></li><li><ul><li><ul><li><a href=\"#split_171\">split</a></li></ul>\n</li></ul>\n</li><li><a href=\"#_180\">多行转多列</a></li><li><ul><li><ul><li><a href=\"#max_case_when_181\">max case when</a></li></ul>\n</li></ul>\n</li></ul>\n</li></ul>\n</div>\n<p></p>\n<h1><a id=\"explode_1\"></a>explode</h1>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\607a310cc7554e468d8998189c8e48a0.png\"/></p>\n<blockquote>\n<p>分类：UDTF<br/> 功能：函数可以将一个array或者map展开<br/> 1.explode(array)：将array列表里的每个元素生成一行<br/> 2.explode(map)：每一对元素作为一行，key为一列，value为一列</p>\n</blockquote>\n<h2><a id=\"demo_8\"></a>demo</h2>\n<ul><li> <h4><a id=\"explodemap_9\"></a>explode(map)</h4> </li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token comment\">//todo explode(map)</span>\n\n<span class=\"token keyword\">select</span> explode<span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">(</span><span class=\"token string\">'A'</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token string\">'B'</span><span class=\"token punctuation\">,</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span><span class=\"token string\">'C'</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">key</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\dd2c61dd47de48588f0becc0ed315153.png\"/></p>\n<ul><li> <h4><a id=\"lateral_view_explodemap_17\"></a>lateral view explode(map)</h4> </li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">select</span>\n    tf<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>\n<span class=\"token keyword\">from</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">select</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> t\nlateral <span class=\"token keyword\">view</span> explode<span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">(</span><span class=\"token string\">'A'</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token string\">'B'</span><span class=\"token punctuation\">,</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span><span class=\"token string\">'C'</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> tf <span class=\"token keyword\">as</span> <span class=\"token keyword\">key</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8582a68a71c14052804f613d971c5609.png\"/></p>\n<ul><li> <h4><a id=\"explodearray_26\"></a>explode(array)</h4> </li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token comment\">//todo explode(array)</span>\n<span class=\"token keyword\">SELECT</span> explode<span class=\"token punctuation\">(</span>split<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">FROM</span> hobbies\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\c20cc9cb89e543c69eeb3b83c773a8a9.png\"/></p>\n<hr/>\n<h1><a id=\"lateral_view_36\"></a>lateral view</h1>\n<blockquote>\n<p>分类：视图<br/> 功能：配合UDTF来使用,把某一行数据拆分成多行数据<br/> 很多的UDTF不能将结果与源表进行关联，使用lateral view ，可以将UDTF拆分的单个字段数据与原始表数据关联上</p>\n</blockquote>\n<h2><a id=\"demo_40\"></a>demo</h2>\n<ul><li> <h4><a id=\"lateral_view_explode_41\"></a>lateral view explode</h4> </li><li> <p>原表<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\0aad0671881b4a3194618063a4715b23.png\"/></p> </li><li> <p>转换</p> </li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span> name<span class=\"token punctuation\">,</span>ids\n<span class=\"token keyword\">from</span> hobbies\nLATERAL <span class=\"token keyword\">VIEW</span> explode<span class=\"token punctuation\">(</span>id_list<span class=\"token punctuation\">)</span> tmp_view <span class=\"token keyword\">AS</span> ids<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\79c5ebc82419474194e2496642d7f876.png\"/></p>\n<ul><li> <h4><a id=\"id_53\"></a>统计id出现次数</h4> </li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span> ids<span class=\"token punctuation\">,</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> ids_cnt\n<span class=\"token keyword\">from</span> hobbies\nLATERAL <span class=\"token keyword\">VIEW</span> explode<span class=\"token punctuation\">(</span>id_list<span class=\"token punctuation\">)</span> tmp_view <span class=\"token keyword\">AS</span> ids\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> ids<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\01dea8e260684e7eb07d2927d0e2a6f7.png\"/></p>\n<ul><li> <h4><a id=\"lateral_view_parse_url_tuple_62\"></a>lateral view parse_url_tuple</h4> </li><li>原表</li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> urls <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span>\n    <span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"http://facebook.com/path/p1.php?query=1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"http://www.baidu.com/news/index.jsp?uuid=frank\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token string\">\"3\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"http://www.jd.com/index?source=baidu\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> urls<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\14c2772c756b4c4fbcf7d0a76b23327a.png\"/></p>\n<ul><li>转换</li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span>\n    a<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token punctuation\">,</span>\n    b<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">,</span>\n    b<span class=\"token punctuation\">.</span>path\n<span class=\"token keyword\">FROM</span> urls a\nLATERAL <span class=\"token keyword\">VIEW</span> parse_url_tuple<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token string\">'HOST'</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"PATH\"</span><span class=\"token punctuation\">)</span> b <span class=\"token keyword\">as</span> host<span class=\"token punctuation\">,</span>path<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\84a6a43ffac1488cb3f8332965a44801.png\"/></p>\n<hr/>\n<h1><a id=\"_86\"></a>列转行</h1>\n<ul><li>原表</li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span>\n    name<span class=\"token punctuation\">,</span>\n    concat_ws<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span>collect_set<span class=\"token punctuation\">(</span>course<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> course<span class=\"token punctuation\">,</span>\n    concat_ws<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span>collect_set<span class=\"token punctuation\">(</span>cast<span class=\"token punctuation\">(</span>score <span class=\"token keyword\">AS</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> score\n<span class=\"token keyword\">FROM</span> posexplode\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> name<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\b9cc3b4b225e48998cedc49195b14ab9.png\"/></p>\n<h2><a id=\"_98\"></a>单列转多行</h2>\n<ul><li> <h4><a id=\"LATERAL_VIEW_explode_99\"></a>LATERAL VIEW explode</h4> </li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token comment\">// todo 单列转多行</span>\n<span class=\"token keyword\">WITH</span> t1 <span class=\"token keyword\">AS</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">SELECT</span>\n        name<span class=\"token punctuation\">,</span>\n        concat_ws<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span>collect_set<span class=\"token punctuation\">(</span>course<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> course<span class=\"token punctuation\">,</span>\n        concat_ws<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span>collect_set<span class=\"token punctuation\">(</span>cast<span class=\"token punctuation\">(</span>score <span class=\"token keyword\">AS</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> score\n    <span class=\"token keyword\">FROM</span> posexplode\n    <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> name\n <span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">SELECT</span>\n    name<span class=\"token punctuation\">,</span>pose_course<span class=\"token punctuation\">,</span>SCORE\n<span class=\"token keyword\">FROM</span> t1\nLATERAL <span class=\"token keyword\">VIEW</span> explode<span class=\"token punctuation\">(</span>split<span class=\"token punctuation\">(</span>t1<span class=\"token punctuation\">.</span>COURSE<span class=\"token punctuation\">,</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> tmp_view <span class=\"token keyword\">AS</span> pose_course\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\962d1c01fc6a4ea097f1afb5d696fba5.png\"/></p>\n<h2><a id=\"_117\"></a>多列转多行</h2>\n<ul><li> <h4><a id=\"LATERAL_VIEW_posexplode_118\"></a>LATERAL VIEW posexplode</h4> </li></ul>\n<pre><code class=\"prism language-sql\"><span class=\"token comment\">// todo 多列转多行</span>\n<span class=\"token keyword\">WITH</span> t1 <span class=\"token keyword\">AS</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">SELECT</span>\n        name<span class=\"token punctuation\">,</span>\n        concat_ws<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span>collect_set<span class=\"token punctuation\">(</span>course<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> course<span class=\"token punctuation\">,</span>\n        concat_ws<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span>collect_set<span class=\"token punctuation\">(</span>cast<span class=\"token punctuation\">(</span>score <span class=\"token keyword\">AS</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> score\n    <span class=\"token keyword\">FROM</span> posexplode\n    <span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> name\n <span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">SELECT</span>\n    name<span class=\"token punctuation\">,</span>pos_course<span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">,</span>pos_score<span class=\"token punctuation\">,</span>b\n<span class=\"token keyword\">FROM</span> t1\nLATERAL <span class=\"token keyword\">VIEW</span> posexplode<span class=\"token punctuation\">(</span>split<span class=\"token punctuation\">(</span>t1<span class=\"token punctuation\">.</span>COURSE<span class=\"token punctuation\">,</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> cr <span class=\"token keyword\">AS</span> a<span class=\"token punctuation\">,</span> pos_course\nLATERAL <span class=\"token keyword\">VIEW</span> posexplode<span class=\"token punctuation\">(</span>split<span class=\"token punctuation\">(</span>t1<span class=\"token punctuation\">.</span>SCORE<span class=\"token punctuation\">,</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> cr <span class=\"token keyword\">AS</span> b<span class=\"token punctuation\">,</span> pos_score\n<span class=\"token keyword\">WHERE</span> a<span class=\"token operator\">=</span>b\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\be5ce98dcd284eeb85634debd5040c5a.png\"/></p>\n<ul><li> <h4><a id=\"split_137\"></a>split</h4> </li></ul>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\c8d7249f63704d9aac846ef4a4a19873.png\"/></p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">select</span>\n    concat_ws<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span>\n        concat<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span><span class=\"token string\">':c:'</span><span class=\"token punctuation\">,</span>c2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        concat<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span><span class=\"token string\">':d:'</span><span class=\"token punctuation\">,</span>c3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        concat<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span><span class=\"token string\">':e:'</span><span class=\"token punctuation\">,</span>c4<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">value</span>\n<span class=\"token keyword\">from</span>  col2row<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\3ef4f60a6ce248ab93cfb1646a6bac4c.png\"/></p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span>\n     split<span class=\"token punctuation\">(</span>value_list<span class=\"token punctuation\">,</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> c1<span class=\"token punctuation\">,</span>\n     split<span class=\"token punctuation\">(</span>value_list<span class=\"token punctuation\">,</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> c2<span class=\"token punctuation\">,</span>\n     split<span class=\"token punctuation\">(</span>value_list<span class=\"token punctuation\">,</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> c3\n<span class=\"token keyword\">FROM</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">select</span>\n        concat_ws<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">,</span>\n            concat<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span><span class=\"token string\">':c:'</span><span class=\"token punctuation\">,</span>c2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            concat<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span><span class=\"token string\">':d:'</span><span class=\"token punctuation\">,</span>c3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            concat<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span><span class=\"token string\">':e:'</span><span class=\"token punctuation\">,</span>c4<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">value</span>\n    <span class=\"token keyword\">from</span>  col2row\n<span class=\"token punctuation\">)</span>t1\nLATERAL <span class=\"token keyword\">VIEW</span> explode<span class=\"token punctuation\">(</span>split<span class=\"token punctuation\">(</span>t1<span class=\"token punctuation\">.</span><span class=\"token keyword\">VALUE</span><span class=\"token punctuation\">,</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> tmp_view <span class=\"token keyword\">AS</span> value_list<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\5dd361f2f1c14ee88d1da161963aa4f6.png\"/></p>\n<h1><a id=\"_169\"></a>行转列</h1>\n<h2><a id=\"_170\"></a>单行转多列</h2>\n<ul><li> <h4><a id=\"split_171\"></a>split</h4> </li></ul>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\95a5f610731f45b49cfa79aacc4cef71.png\"/></p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span>\n   split<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> id<span class=\"token punctuation\">,</span>\n   split<span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">,</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> name\n<span class=\"token keyword\">FROM</span> test\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a5908e56ee1246cfb2cb5daf2b080dc6.png\"/></p>\n<h2><a id=\"_180\"></a>多行转多列</h2>\n<ul><li> <h4><a id=\"max_case_when_181\"></a>max case when</h4> </li></ul>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\74f79b1609c345fbb5165d92ef6fc40b.png\"/></p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span>\n    c1<span class=\"token punctuation\">,</span>\n <span class=\"token keyword\">CASE</span> <span class=\"token keyword\">WHEN</span> c2<span class=\"token operator\">=</span><span class=\"token string\">'c'</span> <span class=\"token keyword\">THEN</span> c3 <span class=\"token keyword\">ELSE</span> <span class=\"token number\">0</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">,</span>\n <span class=\"token keyword\">CASE</span> <span class=\"token keyword\">WHEN</span> c2<span class=\"token operator\">=</span><span class=\"token string\">'d'</span> <span class=\"token keyword\">THEN</span> c3 <span class=\"token keyword\">ELSE</span> <span class=\"token number\">0</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">,</span>\n <span class=\"token keyword\">CASE</span> <span class=\"token keyword\">WHEN</span> c2<span class=\"token operator\">=</span><span class=\"token string\">'e'</span> <span class=\"token keyword\">THEN</span> c3 <span class=\"token keyword\">ELSE</span> <span class=\"token number\">0</span> <span class=\"token keyword\">END</span>\n<span class=\"token keyword\">from</span> row2col\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\0a304bd599ae4fa4b608a9cc4a2bc164.png\"/></p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">SELECT</span>\n    c1<span class=\"token punctuation\">,</span>\n <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">CASE</span> <span class=\"token keyword\">WHEN</span> c2<span class=\"token operator\">=</span><span class=\"token string\">'c'</span> <span class=\"token keyword\">THEN</span> c3 <span class=\"token keyword\">ELSE</span> <span class=\"token number\">0</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">)</span> c<span class=\"token punctuation\">,</span>\n <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">CASE</span> <span class=\"token keyword\">WHEN</span> c2<span class=\"token operator\">=</span><span class=\"token string\">'d'</span> <span class=\"token keyword\">THEN</span> c3 <span class=\"token keyword\">ELSE</span> <span class=\"token number\">0</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">)</span> d<span class=\"token punctuation\">,</span>\n <span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">CASE</span> <span class=\"token keyword\">WHEN</span> c2<span class=\"token operator\">=</span><span class=\"token string\">'e'</span> <span class=\"token keyword\">THEN</span> c3 <span class=\"token keyword\">ELSE</span> <span class=\"token number\">0</span> <span class=\"token keyword\">END</span><span class=\"token punctuation\">)</span> e\n<span class=\"token keyword\">from</span> row2col\n<span class=\"token keyword\">GROUP</span> <span class=\"token keyword\">BY</span> c1<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\15e0da012a024068bdd02f850983dc3c.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 1, "php": 1, "time": "2022-08-24 15:38:18", "summary": "行列转换统计出现次数列转行单列转多行多列转多行行转列单行转多列多行转多列在这里插入图片描述分类：功能：函数可以将一个或者展开：将列表里的每个元素生成一行：每一对元素作为一行，为一列，为一列在这里插入图"}