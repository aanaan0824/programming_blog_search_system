{"blogid": "123557570", "writerAge": "码龄3年", "writerBlogNum": "79", "writerCollect": "288", "writerComment": "19", "writerFan": "23", "writerGrade": "4级", "writerIntegral": "868", "writerName": "Ricardo0324", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123557570.jpg", "writerRankTotal": "20651", "writerRankWeekly": "35586", "writerThumb": "49", "writerVisitNum": "69032", "blog_read_count": "8062", "blog_time": "已于 2022-03-18 11:35:12 修改", "blog_title": "Spring Boot面试必问：启动流程", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"__0\"></a>一 面试提问</h1>\n<h2><a id=\"11_Spring_Boot_2\"></a>1.1 Spring Boot启动流程</h2>\n<p>👨‍💻<strong>面试官</strong>：说说SpringBoot启动流程吧</p>\n<p>🙋 <strong>我</strong> ：</p>\n<ol><li>首先从main找到run()方法，在执行run()方法之前new一个<code>SpringApplication</code>对象</li><li>进入run()方法，创建应用监听器<code>SpringApplicationRunListeners</code>开始监听</li><li>然后加载SpringBoot配置环境(<code>ConfigurableEnvironment</code>)，然后把配置环境(Environment)加入监听对象中</li><li>然后加载应用上下文(<code>ConfigurableApplicationContext</code>)，当做run方法的返回对象</li><li>最后创建Spring容器，<code>refreshContext(context)</code>，实现starter自动化配置和bean的实例化等工作。</li></ol>\n<h2><a id=\"12_SpringBoot_15\"></a>1.2 SpringBoot自动装配</h2>\n<p>👨‍💻<strong>面试官</strong>：说说SpringBoot自动配置的原理</p>\n<p>🙋 <strong>我</strong>：通过<code>@EnableAutoConfiguration</code>注解在类路径的META-INF/spring.factories文件中找到所有的对应配置类，然后将这些自动配置类加载到spring容器中。</p>\n<h1><a id=\"__21\"></a>二 知识点详解</h1>\n<h2><a id=\"21_SpringBoot_23\"></a>2.1 SpringBoot核心注解：</h2>\n<p><code>@SpringBootApplication</code>注解是Spring Boot的核心注解，它其实是一个组合注解，包括三个注解</p>\n<ol><li> <p><code>@Configuration</code>:被标注的类等于在Spring的XML配置文件中（applicationContext.xml）,装配所有bean事务，提供了一个Spring的上下文环境</p> </li><li> <p><code>@EnableAutoConfiguration</code>:SpringBoot根据应用所声明的依赖来对Spring框架进行自动配置，其中包括两个重要注解：</p>\n<ul><li> <p><code>@AutoConfigurationPackage</code>：该注解上有一个@Import({Registrar.class})注解，其中Registrar类的作用是将启动类所在的包下的所有子包组件扫描注入到spring容器中。</p> <p><strong>因此这就是为什么将controller、service等包放在启动类的同级目录下的原因</strong></p> </li><li> <p><code>@Import({AutoConfigurationImportSelector.class})</code>：其中AutoConfigurationImportSelector类中有一个getCandidateConfigurations()方法，这个方法通过SpringFactoriesLoader.loadFactoryNames()查找位于META-INF/spring.factories文件中的所有自动配置类并加载这些类。</p> <p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\def4707a4c0c45fda29bafe58cea47ba.png\"/></p> </li></ul> </li><li> <p><code>@ComponentScan</code>:组件扫描，自动扫描和装配Bean，扫描SpringApplication的run方法中的ExammanagerApplication.class所在的包路径下的文件，因此将启动类（main）放在跟包路径下。它去寻找带有<code>@Component</code>注解的类，并为其创建bean。</p> </li></ol>\n<h2><a id=\"22_42\"></a>2.2详细启动流程（结合源码）</h2>\n<ol><li> <p>首先进入run()方法，run方法中new创建了一个<code>SpringApplication</code>实例</p> <pre><code class=\"prism language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> ConfigurableApplicationContext <span class=\"token function\">run</span><span class=\"token punctuation\">(</span>Class<span class=\"token operator\">&lt;</span><span class=\"token operator\">?</span><span class=\"token operator\">&gt;</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> primarySources<span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">(</span>primarySources<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre> </li><li> <p>在SpringApplication的构造方法里为SpringApplication对象赋一些初值。</p> <p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e8193dc3b5cb4f439a48d5961301f68e.png\"/></p> </li><li> <p>构造方法执行完后，回到run()方法</p> <p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\eb3cf3db954242739febaace64e01614.png\"/></p> <p>该方法中实现了如下几个关键步骤：</p>\n<ol><li>创建了应用的监听器SpringApplicationRunListeners并开始监听</li><li>加载SpringBoot配置环境(ConfigurableEnvironment)，如果是通过web容器发布，会加载StandardEnvironment，其最终也是继承了ConfigurableEnvironment</li><li>配置环境(Environment)加入到监听器对象中(SpringApplicationRunListeners)</li><li>创建run方法的返回对象：ConfigurableApplicationContext(应用配置上下文)</li><li>回到run方法内，prepareContext方法将listeners、environment、applicationArguments、banner等重要组件与上下文对象关联</li><li>接下来的refreshContext(context)方法(初始化方法如下)将是实现spring-boot-starter-*(mybatis、redis等)自动化配置的关键，包括spring.factories的加载，bean的实例化等核心工作。</li></ol> <p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\45e2e4b19a5f4f4ab8371279a77f85f3.png\"/><br/> 配置结束后，Springboot做了一些基本的收尾工作，返回了应用环境上下文。回顾整体流程，Springboot的启动，主要创建了配置环境(environment)、事件监听(listeners)、应用上下文(applicationContext)，并基于以上条件，在容器中开始实例化我们需要的Bean，至此，通过SpringBoot启动的程序已经构造完成。</p> </li></ol>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Java", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 1, "sql": 0, "php": 0, "time": "2022-03-18 11:35:12", "summary": "一面试提问启动流程面试官：说说启动流程吧我：首先从找到方法，在执行方法之前一个对象进入方法，创建应用监听器开始监听然后加载配置环境，然后把配置环境加入监听对象中然后加载应用上下文，当做方法的返回对象最"}