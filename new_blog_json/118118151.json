{"blogid": "118118151", "writerAge": "码龄1年", "writerBlogNum": "141", "writerCollect": "34100", "writerComment": "6418", "writerFan": "71133", "writerGrade": "7级", "writerIntegral": "23034", "writerName": "五包辣条！", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_118118151.jpg", "writerRankTotal": "406", "writerRankWeekly": "826", "writerThumb": "12222", "writerVisitNum": "1620229", "blog_read_count": "248430", "blog_time": "于 2021-06-23 12:41:13 发布", "blog_title": "我用Python采集了班花的空间数据集，除了美照竟然再一次发现了她另外的秘密！", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>大家好，我是辣条。</p>\n<p>室友知道了我上次给班花修过电脑，追了我三条街，嘴里大骂我不当人子，怪我这种事情没带他。最后又舔着脸求我支招，这货竟然想追班花！辣条我为了兄弟两（收）肋（钱）插（办）刀（事），毫不犹豫的答应了。但是我只有班花的QQ和微信怎么办呢，那就从她平时发的动态着手，于是就有了这篇文章，不过最后我又发现了她的另一秘密！</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"..\\..\\static\\image\\20210623123414390.png\"/></p>\n<h2>采集数据目标</h2>\n<p>网址：<a href=\"https://i.qq.com/\">QQ空间</a><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20210622135424790.png\"/></p>\n<h2>工具使用</h2>\n<p>开发环境：win10、python3.7 开发工具：pycharm、Chrome 工具包：selenium，re，time</p>\n<h2>重点内容学习</h2>\n<ul><li> <p>selenium使用 -gtk的加密方式 -数据信息的获取</p> </li></ul>\n<h2>前言</h2>\n<p>selenium为测试工具需要先配置安装驱动 博主用的是chorme浏览器，下载chormedrive 驱动下载地址<a href=\"https://npm.taobao.org/mirrors/chromedriver\">驱动下载地址</a> 下载完成之后将驱动exe放到Python安装目录 <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20210622172421982.png\"/></p>\n<h2>项目思路解析</h2>\n<p>控制selenium登录QQ空间</p>\n<pre><code class=\"language-html hljs\">    driver = webdriver.Chrome()  # 这个是chormedriver的地址\n    driver.get('https://qzone.qq.com/')\n    driver.switch_to.frame('login_frame')\n    driver.find_element_by_id('switcher_plogin').click()\n    driver.find_element_by_id('u').clear()\n    driver.find_element_by_id('u').send_keys(\"QQ号\")  \n    driver.find_element_by_id('p').clear()\n    driver.find_element_by_id('p').send_keys(“QQ密码”)  \n    driver.find_element_by_id('login_button').click()\n    time.sleep(2)</code></pre>\n<p>获取到好友QQ昵称以及QQ名称 <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20210622192449856.png\"/> g_tk为加密参数找到加密方法 <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20210622192823199.png\"/><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20210622193404199.png\"/> g_tk值为cookie值进行加密获取p_skey的值进行加密 <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\2021062219361830.png\"/> 通过selenium提取到当前网页的cookie值 <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20210622193741118.png\"/> Python解密代码</p>\n<pre><code class=\"language-html hljs\">def getGTK(cookie):\n    hashes = 5381\n    for letter in cookie['p_skey']:\n        hashes += (hashes &lt;&lt; 5) + ord(letter)\n    return hashes &amp; 0x7fffffff\ncookie = {}  # 初始化cookie字典\nfor elem in driver.get_cookies():  # 取cookies\n    cookie[elem['name']] = elem['value']\ngtk = tool.getGTK(cookie)  # 通过getGTK函数计算gtk\n​</code></pre>\n<p>获取到好友的QQ号的方法有很多，只有能提取到就行 获取好友说说信息的链接 <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20210622194640575.png\"/> 获取到链接的数据信息 <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20210622194950937.png\"/></p>\n<h2>简易源码展示</h2>\n<pre><code class=\"language-python\">import json\nimport re\nfrom selenium import webdriver\nimport time\n\n\ndef getGTK(cookie):\n    hashes = 5381\n    for letter in cookie['p_skey']:\n        hashes += (hashes &lt;&lt; 5) + ord(letter)\n    return hashes &amp; 0x7fffffff\n\n# 封装函数的关键字\ndef start_spider():\n    driver = webdriver.Chrome()\n    driver.get(\"https://i.qq.com/\")\n    driver.switch_to.frame('login_frame')\n    # time.sleep(10)\n    driver.find_element_by_id('bottom_qlogin').click()\n    # time.sleep(5)\n    driver.find_element_by_name('u').clear()\n    driver.find_element_by_name('u').send_keys('qq号')\n    # time.sleep(5)\n    driver.find_element_by_name('p').clear()\n    driver.find_element_by_name('p').send_keys('qq密码')\n    driver.find_element_by_id('login_button').click()\n    time.sleep(2)\n    cookie = {}\n\n    for i in driver.get_cookies():\n        cookie[i['name']] = i['value']\n\n    gtk = getGTK(cookie)\n    driver.get('https://user.qzone.qq.com/proxy/domain/r.qzone.qq.com/cgi-bin/tfriend/friend_hat_get.cgi?hat_seed=1&amp;uin=1727948159fupdate=2&amp;g_tk=' + str(\n            gtk) + '&amp;qzonetoken=e794139a284d6ea9e0b26826e541b55df37d0667a3544f534de25aebdb64628d3ab75e1d7104bbb22a' + '&amp;g_tk=' + str(\n            gtk))\n    time.sleep(4)\n    friend_list = driver.page_source\n    # print(friend_list)\n    abtract_pattern = '''\"(.*?)\":{\n\"realname\":\"(.*?)\"}'''\n    qq_name_list = re.findall(abtract_pattern, str(friend_list))  # 数组\n    print(qq_name_list)\n    for qq_info in qq_name_list:\n        qq_num = qq_info[0]\n        qq_name = qq_info[1]\n        if qq_num == \"对方QQ号\": # 我只获取了一个\n            count = 0\n            begin = 0\n\n            driver.get('https://user.qzone.qq.com/proxy/domain/taotao.qq.com/cgi-bin/emotion_cgi_msglist_v6?uin=' + qq_num + '&amp;ftype=0&amp;sort=0&amp;pos=' + str(\n                        begin) + '&amp;num=40&amp;replynum=200&amp;g_tk=' + str(\n                        gtk) + '&amp;callback=_preloadCallback&amp;code_version=1&amp;format=jsonp&amp;need_private_comment=1&amp;qzonetoken=e794139a284d6ea9e0b26826e541b55df37d0667a3544f534de25aebdb64628d3ab75e1d7104bbb22a&amp;g_tk=' + str(\n                        gtk))\n\n            msg_json = driver.page_source\n            # print(msg_json)\n            msg_json_list = re.findall('_preloadCallback\\((.*?)\\);', str(msg_json))\n            print(msg_json_list)\n            data = json.loads(msg_json_list[0])\n            # print(data)\n            for text in data['msglist']:\n                content = text['content']\n                createTime = text['createTime']\n                f = open(\"shuoshuo.text\", \"a\", encoding=\"utf-8\")\n                f.write('{},{},{},{}\\n\\n'.format(qq_num, qq_name, createTime, content))\n\n\n\nstart_spider()</code></pre>\n<h2>效果图展示</h2>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"..\\..\\static\\image\\20210623124028811.png\"/></p>\n<p> </p>\n<p> </p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"..\\..\\static\\image\\20210622222423962.jpg\"/></p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"..\\..\\static\\image\\20210622222441780.jpg\"/></p>\n<h2>结尾</h2>\n<p>我成功的把班花空间的数据爬取下来了，主要还是说说的内容，通过她的说说<strong>我竟然发现了她喜欢王俊凯，</strong>而且还是铁粉的那种，这下我室友是没戏了，哎可怜的娃儿...</p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"..\\..\\static\\image\\20210622222911656.png\"/></p>\n<p><em><strong>PS：纯属技术交流学习，抓取的都是公开数据，没有进行非法牟利获取，最后室友转给我的钱请他吃饭喝酒去了【谁都有过这时候】，最后提醒大家，不要利用爬虫进行违规违法操作，一定要遵纪守法！</strong></em></p>\n</div>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2021-06-23 12:41:13", "summary": "大家好，我是辣条。室友知道了我上次给班花修过电脑，追了我三条街，嘴里大骂我不当人子，怪我这种事情没带他。最后又舔着脸求我支招，这货竟然想追班花！辣条我为了兄弟两收肋钱插办刀事，毫不犹豫的答应了。但是我"}