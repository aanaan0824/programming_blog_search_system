{"blogid": "125675599", "writerAge": "码龄2年", "writerBlogNum": "3", "writerCollect": "2", "writerComment": "2", "writerFan": "1", "writerGrade": "1级", "writerIntegral": "37", "writerName": "玖柒°-yk", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125675599.jpg", "writerRankTotal": "161028", "writerRankWeekly": "452790", "writerThumb": "5", "writerVisitNum": "1708", "blog_read_count": "1139", "blog_time": "已于 2022-07-22 09:58:34 修改", "blog_title": "Nginx/Apache/PHP 防止恶意User-Agent方法", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>------------------------------------------------------------------------</p>\n<p>！！！以下配置方法（简单易通）</p>\n<p>------------------------------------------------------------------------</p>\n<blockquote>\n<p>通过恶意的User-Agent关键词来屏蔽访问，包含<a href=\"https://so.csdn.net/so/search?q=%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F&amp;spm=1001.2101.3001.7020\" title=\"漏洞扫描\">漏洞扫描</a>，无用蜘蛛，采集爬虫，cc攻击，sq注入等。</p>\n</blockquote>\n<h2>Nginx </h2>\n<p>修改配置文件，内容：</p>\n<pre><code>#禁止Scrapy等工具的抓取\nif ($http_user_agent ~* (Scrapy|Curl|HttpClient)) {\n     return 403;\n}\n#禁止指定UA\nif ($http_user_agent ~* \"User-Agent关键词|User-Agent关键词\")\n{\n    return 403;\n}\n#禁止非GET|HEAD|POST方式的抓取\nif ($request_method !~ ^(GET|HEAD|POST)$) {\n    return 403;\n}\n\n\n\n</code></pre>\n<h2>Apache</h2>\n<p>修改配置文件，内容： </p>\n<pre><code>DocumentRoot /home/wwwroot/xxx\n&lt;Directory \"/home/wwwroot/xxx\"&gt;\n    SetEnvIfNoCase User-Agent \".*(User-Agent关键词|User-Agent关键词)\" BADBOT\n    Order allow,deny\n    Allow from all\n    deny from env=BADBOT\n&lt;/Directory&gt;\n\n\n</code></pre>\n<h2>PHP</h2>\n<p>项目入口文件或者启动文件中，设置内容：</p>\n<pre><code class=\"language-php\">//获取UA信息\n$ua = $_SERVER['HTTP_USER_AGENT'];\n\n//将恶意USER_AGENT关键词存入数组\n$now_ua = [USER_AGENT关键词];\n\n//禁止空USER_AGENT，dedecms等主流采集程序都是空USER_AGENT，部分sql注入工具也是空USER_AGENT\n//判断是否是数组中存在的UA\nif (!$ua || in_array($ua, $now_ua)) {\n    die('页面错误，请稍后重试！！！');\n}\n</code></pre>\n<hr/>\n<h3><strong>最后，网络搜索的恶意User-Agent关键词列表（参考）</strong></h3>\n<blockquote>\n<pre><span style=\"color:#0d0016;\">'FeedDemon', 'BOT/0.1 (BOT for JCE)', 'CrawlDaddy', 'Java', 'Feedly', 'UniversalFeedParser', 'ApacheBench', 'Swiftbot', 'ZmEu', 'Indy Library', 'oBot', 'jaunty', 'YandexBot', 'AhrefsBot', 'MJ12bot', 'WinHttp', 'EasouSpider', 'HttpClient', 'Microsoft URL Control', 'YYSpider', 'jaunty', 'Python-urllib', 'lightDeckReports Bot', 'Abonti', 'aggregator', 'AhrefsBot', 'asterias', 'BDCbot', 'BLEXBot', 'BuiltBotTough', 'Bullseye', 'BunnySlippers', 'ca-crawler', 'CCBot', 'Cegbfeieh', 'CheeseBot', 'CherryPicker', 'CopyRightCheck', 'cosmos', 'Crescent', 'discobot', 'DittoSpyder', 'DOC', 'DotBot', 'Download Ninja', 'EmailCollector', 'EmailSiphon', 'EmailWolf', 'EroCrawler', 'Exabot', 'ExtractorPro', 'Fasterfox', 'FeedBooster', 'Foobot', 'Genieo'</span>, 'grub-client', 'Harvest', 'hloader', 'httplib', 'humanlinks', 'ieautodiscovery', 'InfoNaviRobot', 'IstellaBot', 'JennyBot', 'k2spider', 'Kenjin Spider', 'Keyword Density0.9', 'larbin', 'LexiBot', 'libWeb', 'LinkextractorPro', 'linko', 'LinkScan8.1a Unix', 'LinkWalker', 'LNSpiderguy', 'lwp-trivial', 'magpie', 'Mata Hari', 'MaxPointCrawler', 'MegaIndex', 'Microsoft URL Control', 'MIIxpc', 'Mippin', 'Missigua Locator', 'Mister PiX', 'MJ12bot', 'moget', 'MSIECrawler', 'NetAnts', 'NICErsPRO', 'Niki-Bot', 'NPBot', 'Nutch', 'Offline Explorer', 'Openfind', 'panscient.com', 'ProPowerBot2.14', 'ProWebWalker', 'QueryN Metasearch', 'RepoMonkey', 'RMA', 'SemrushBot', 'SeznamBot', 'SISTRIX', 'sitecheck.Internetseer.com', 'SiteSnagger', 'SnapPreviewBot', 'Sogou', 'SpankBot', 'spanner', 'spbot', 'Spinn3r', 'suzuran', 'Szukacz1.4', 'Teleport', 'Telesoft', 'The Intraformant', 'TheNomad', 'TightTwatBot', 'Titan', 'True_Robot', 'turingos', 'TurnitinBot', 'UbiCrawler', 'UnisterBot', 'URLy Warning', 'VCI', 'WBSearchBot', 'Web Downloader6.9', 'WebAuto', 'WebBandit', 'WebCopier', 'WebEnhancer', 'WebmasterWorldForumBot', 'WebReaper', 'WebSauger', 'Website Quester', 'Webster Pro', 'WebStripper', 'WebZip', 'Wotbox', 'wsr-agent', 'WWW-Collector-E', 'Xenu', 'yandex', 'Zao', 'Zeus', 'ZyBORG', 'coccoc', 'Incutio', 'lmspider', 'memoryBot', 'SemrushBot', 'serf', 'Unknown', 'uptime files', 'BOT/0.1', 'YisouSpider', 'Jullo', 'YandexBot', 'WinHttp', 'Linguee Bot', 'HTTrack', 'harvest', 'audit', 'dirbuster', 'pangolin', 'nmap', 'sqln', 'hydra', 'Parser', 'libwww', 'BBBike', 'sqlmap', 'w3af', 'owasp', 'Nikto', 'fimap', 'havij', 'zmeu', 'FeedDemon', 'Indy Library', 'Alexa Toolbar', 'AskTbFXTV', 'AhrefsBot', 'CrawlDaddy', 'CoolpadWebkit', 'Java', 'Feedly', 'UniversalFeedParser', 'ApacheBench', 'Swiftbot', 'ZmEu', 'oBot', 'jaunty', 'Python-urllib', 'lightDeckReports Bot', 'YYSpider', 'DigExt', 'HttpClient', 'MJ12bot', 'heritrix', 'EasouSpider', 'Ezooms', 'BabyKrokodil', 'netsparker', 'httperf', 'SF'\n</pre>\n</blockquote>\n<p>--------------------------------</p>\n<p><strong>！！！仅供参考！！！</strong></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n</div>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 1, "sql": 1, "php": 1, "time": "2022-07-22 09:58:34", "summary": "！！！以下配置方法简单易通通过恶意的关键词来屏蔽访问，包含漏洞扫描漏洞扫描，无用蜘蛛，采集爬虫，攻击，注入等。修改配置文件，内容：禁止等工具的抓取禁止指定关键词关键词禁止非方式的抓取修改配置文件，内容"}