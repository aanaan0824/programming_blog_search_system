{"blogid": "126498945", "writerAge": "码龄2年", "writerBlogNum": "146", "writerCollect": "4997", "writerComment": "978", "writerFan": "1241", "writerGrade": "6级", "writerIntegral": "5082", "writerName": "天桥下的卖艺者", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126498945.jpg", "writerRankTotal": "3161", "writerRankWeekly": "7364", "writerThumb": "554", "writerVisitNum": "678403", "blog_read_count": "254", "blog_time": "于 2022-08-24 10:13:27 发布", "blog_title": "全中文网首份：R包上传到CRAN的心得分享", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>今天我的写的R包ggrcs已经在CARN上架了，不再是一个野包了，属于正规军了，以后有需要的可以通过下面命令下载了</p>\n<pre><code class=\"prism language-r\">install.packages<span class=\"token punctuation\">(</span><span class=\"token string\">\"ggrcs\"</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\b8a8f2d289cf414ea437b558c0cc69c6.png\"/><br/> R包写好以后，本来想更新一些内容，完善R包，但是有大佬提醒我要先进行上传到CRAN，免得名字被别人抢注册了。于是这几天都在研究怎么上传，参考的书主要就是：Hadley Wickham:R Packages和Writing R Extensions。R包上传到CRAN，也经历了一些曲折，本来想借鉴一下别人的经验，不知道是不是因为太简单了，网上这方面的东西中文的根本没人写，于是就想分享一下我的经验，让后来者少走弯路。最简单的是通过devtools包的devtools::release()，上传以后会提一些问题，回答是就可以了，然后还会进行邮箱验证，验证以后就算上传成功了。<br/> 上传以后显示<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\b2dd9f59aff84b6eac8d7c21faf82c32.png\"/><br/> 就是一个警告和3个注意，这就表示上传失败，我们要弄成0警告和0注意才有可能上传成功<br/> 1个警告是：命名空间没有我的这些变量<br/> Undefined global functions or variables:<br/> …density… Pre0 aes density element_blank geom_histogram geom_line<br/> geom_ribbon ggplot labs lower rescale scale_y_continuous sec_axis<br/> theme theme_bw upper yhat<br/> Consider adding<br/> importFrom(“stats”, “density”)<br/> to your NAMESPACE file.<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\c90c0dd1732d45cc81a7c2ee61e0b8ea.png\"/><br/> 就是说这些变量要写入命名空间，这些变量是我的主函数的变量<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\5a18d4989b064edd938703c1db70b9d8.png\"/><br/> 但是命名空间没有上面的这些<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\f03bd7f91d884d3681afc003c26c60f7.png\"/><br/> 所以我们要用importFrom（）形式把它列出来的这些变量写入命名空间，不能直接在命名空间（NAMESPACE）修改，我们要现在主程序中我的这里是ggrcs.R添加，形式如下这种形式：</p>\n<pre><code class=\"prism language-r\">importFrom <span class=\"token string\">\"stats\"</span> <span class=\"token string\">\"density\"</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e3e86b877e34408991bafad3e57666ff.png\"/><br/> 填好以后还需要使用代码devtools::document()重新写入，进行代码更新，这样我们看到命名空间的内容就更新了<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\04f3a3605e734ba0a1f068d9b96af0d8.png\"/><br/> 接下来我们来看看3个注意，有一个是英文拼写不对就不说了。其中有一个是<br/> checking R code for possible problems … NOTE<br/> ggrcs: no visible global function definition for ‘density’<br/> ggrcs: no visible global function definition for ‘ggplot’<br/> ggrcs: no visible global function definition for ‘aes’<br/> ggrcs: no visible global function definition for ‘geom_histogram’<br/> ggrcs: no visible global function definition for ‘rescale’<br/> ggrcs: no visible binding for global variable ‘…density…’<br/> ggrcs: no visible global function definition for ‘geom_line’<br/> ggrcs: no visible binding for global variable ‘yhat’<br/> ggrcs: no visible global function definition for ‘geom_ribbon’<br/> ggrcs: no visible binding for global variable ‘lower’<br/> ggrcs: no visible binding for global variable ‘upper’<br/> ggrcs: no visible global function definition for ‘theme_bw’<br/> ggrcs: no visible global function definition for ‘theme’<br/> ggrcs: no visible global function definition for ‘element_blank’<br/> ggrcs: no visible global function definition for ‘labs’<br/> ggrcs: no visible global function definition for ‘sec_axis’<br/> predata.coxph: no visible binding for global variable ‘Pre0’<br/> predata.lrm: no visible binding for global variable ‘Pre0’<br/> Undefined global functions or variables:<br/> …density… Pre0 aes density element_blank geom_histogram geom_line<br/> geom_ribbon ggplot labs lower rescale sec_axis theme theme_bw upper<br/> yhat<br/> Consider adding<br/> importFrom(“stats”, “density”)<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a674273593294925bda982c0f4ef1bb5.png\"/><br/> 说我的变量如Pre0在函数中没有进行绑定<br/> 这个很好解决，你写得函数开头中加一句</p>\n<pre><code class=\"prism language-r\">Pre0<span class=\"token operator\">&lt;-</span><span class=\"token keyword\">NULL</span>\n</code></pre>\n<p>就可以了，其他没有绑定的变量也是这样解决。<br/> no visible global function definition<br/> 函数没有在全局定义这个有点麻烦，我查看了一下别人的做法是使用globalVariables函数，可以在你的函数名头前加一下代码</p>\n<pre><code class=\"prism language-r\">globalVariables<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'Pre0'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'aes'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'..density..'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'density'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'element_blank'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'geom_histogram'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'geom_line'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'geom_ribbon'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'ggplot'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'labs'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'lower'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'rescale'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'scale_y_continuous'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'sec_axis'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'theme'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'theme_bw'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'upper'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'yhat'</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>这个代码就是告诉R函数这些变量视为全局定义了。<br/> 还有一个注意点是<br/> Namespaces in Imports field not imported from:<br/> ‘ggplot2’ ‘rms’ ‘scales’<br/> All declared Imports should be used.<br/> 这个注意点的内容其实和警告那个点的是一样的，解决了警告的内容，这个内容也相应的解决了。有一点要注意一下，我们在Imports:部分填入R包的时候不要手工填入而是要使用代码如：</p>\n<pre><code class=\"prism language-r\">usethis<span class=\"token operator\">::</span>use_package<span class=\"token punctuation\">(</span><span class=\"token string\">'ggplot2'</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>然后在Imports:部分就会自动填入R包<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\5728067b52004ada80b3f447d5af048a.png\"/><br/> 经过一系列处理以后，终于变成全部都是0 了，然后继续使用代码devtools::release()重新上传了，接下来就是等待了。<br/> CRAN的处理效率很高，基本都是当天回复了，一般后期都是一些都是一些描述文件书写的问题，比如说我这个标题A Function to是要去掉的，关于名称的首个字母都是需要大写的。在描述文件中，R包的名称需要用单引号括起来，有关于函数（Function）的名称前面要加一个括号（），要写Authors@R添加用维护和更新R包的人是谁。弄好以后就可以通过了，CRAN的工作人员非常耐心和细心，还帮我弄了一个使用手册，这里要点一个赞。<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\7e9944d47a604c3fb06d56bd662926f1.png\"/><br/> 小提示：<br/> 上传前最好仔细研究大佬写得：Hadley Wickham:R Packages 绝对能少走弯路。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-08-24 10:13:27", "summary": "今天我的写的包已经在上架了，不再是一个野包了，属于正规军了，以后有需要的可以通过下面命令下载了在这里插入图片描述包写好以后，本来想更新一些内容，完善包，但是有大佬提醒我要先进行上传到，免得名字被别人抢"}