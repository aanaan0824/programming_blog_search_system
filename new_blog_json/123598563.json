{"blogid": "123598563", "writerAge": "码龄3年", "writerBlogNum": "23", "writerCollect": "32", "writerComment": "14", "writerFan": "3", "writerGrade": "2级", "writerIntegral": "260", "writerName": "zjy1125", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123598563.jpg", "writerRankTotal": "123254", "writerRankWeekly": "554642", "writerThumb": "12", "writerVisitNum": "19304", "blog_read_count": "1658", "blog_time": "已于 2022-09-01 10:03:32 修改", "blog_title": "php如何实现发送邮件", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<ul><li>使用php中的mail()函数</li></ul>\n<pre><code class=\"prism language-csharp\"><span class=\"token function\">mail</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">,</span>subject<span class=\"token punctuation\">,</span>message<span class=\"token punctuation\">,</span>headers<span class=\"token punctuation\">,</span>parameters<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\c96c301353e1444794810b94bc9b85b1.png\"/><br/> 出现报错：<br/> Warning: mail(): “sendmail_from” not set in php.ini or custom “From:” header missing in D:\\Program Files\\Apache Group\\Apache2\\ht<br/> 需要使用smtp发送邮件</p>\n<ul><li>QQ邮箱开启SMTP服务<br/> <a href=\"https://jingyan.baidu.com/article/0f5fb099dffe7c6d8334ea31.html\">https://jingyan.baidu.com/article/0f5fb099dffe7c6d8334ea31.html</a></li><li>查看QQ邮箱SMTP服务器以及端口<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e6bd5ee9c52945dfa2b976d87546bcd7.png\"/>email.class.php定义发送邮件的库：</li></ul>\n<pre><code class=\"prism language-csharp\"><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">?</span>php\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">smtp</span>\n<span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token comment\">/* Public Variables */</span>\n  <span class=\"token keyword\">var</span> $smtp_port<span class=\"token punctuation\">;</span> <span class=\"token comment\">//smtp_port 端口号</span>\n  <span class=\"token keyword\">var</span> $time_out<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> $host_name<span class=\"token punctuation\">;</span> <span class=\"token comment\">//服务器主机名</span>\n  <span class=\"token keyword\">var</span> $log_file<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> $relay_host<span class=\"token punctuation\">;</span> <span class=\"token comment\">//服务器主机地址</span>\n  <span class=\"token keyword\">var</span> $debug<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> $auth<span class=\"token punctuation\">;</span> <span class=\"token comment\">//验证</span>\n  <span class=\"token keyword\">var</span> $user<span class=\"token punctuation\">;</span> <span class=\"token comment\">//服务器用户名</span>\n  <span class=\"token keyword\">var</span> $pass<span class=\"token punctuation\">;</span> <span class=\"token comment\">//服务器密码</span>\n  <span class=\"token comment\">/* Private Variables */</span>\n  <span class=\"token keyword\">var</span> $sock<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/* Constractor 构造方法*/</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp</span><span class=\"token punctuation\">(</span>$relay_host <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> $smtp_port <span class=\"token operator\">=</span> <span class=\"token number\">25</span><span class=\"token punctuation\">,</span> $auth <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> $user<span class=\"token punctuation\">,</span> $pass<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>debug   <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>smtp_port <span class=\"token operator\">=</span> $smtp_port<span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>relay_host <span class=\"token operator\">=</span> $relay_host<span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>time_out  <span class=\"token operator\">=</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//is used in fsockopen()</span>\n    <span class=\"token preprocessor property\">#</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>auth    <span class=\"token operator\">=</span> $auth<span class=\"token punctuation\">;</span> <span class=\"token comment\">//auth</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>user    <span class=\"token operator\">=</span> $user<span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>pass    <span class=\"token operator\">=</span> $pass<span class=\"token punctuation\">;</span>\n    <span class=\"token preprocessor property\">#</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>host_name <span class=\"token operator\">=</span> <span class=\"token string\">\"localhost\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//is used in HELO command</span>\n    <span class=\"token comment\">// $this-&gt;host_name = \"smtp.163.com\"; //is used in HELO command</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>log_file  <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/* Main Function */</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">sendmail</span><span class=\"token punctuation\">(</span>$to<span class=\"token punctuation\">,</span> $from<span class=\"token punctuation\">,</span> $subject <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> $body <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> $mailtype<span class=\"token punctuation\">,</span> $cc <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> $bcc <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> $additional_headers <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $header  <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    $mail_from <span class=\"token operator\">=</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">get_address</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">strip_comment</span><span class=\"token punctuation\">(</span>$from<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $body   <span class=\"token operator\">=</span> <span class=\"token function\">mb_ereg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"(^|(\\r\\n))(\\\\.)\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\\1.\\\\3\"</span><span class=\"token punctuation\">,</span> $body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token string\">\"MIME-Version:1.0\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$mailtype <span class=\"token operator\">==</span> <span class=\"token string\">\"HTML\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token comment\">//邮件发送类型</span>\n      <span class=\"token comment\">//$header .= \"Content-Type:text/html\\r\\n\";</span>\n      $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> 'Content<span class=\"token operator\">-</span>type<span class=\"token punctuation\">:</span> text<span class=\"token operator\">/</span>html<span class=\"token punctuation\">;</span> charset<span class=\"token operator\">=</span>utf<span class=\"token operator\">-</span><span class=\"token number\">8</span>' <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token string\">\"To: \"</span> <span class=\"token punctuation\">.</span> $to <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$cc <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token string\">\"Cc: \"</span> <span class=\"token punctuation\">.</span> $cc <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token string\">\"From: \"</span> <span class=\"token punctuation\">.</span> $from <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// $header .= \"From: $from&lt;\".$from.\"&gt;\\r\\n\";  //这里只显示邮箱地址，不够人性化</span>\n    $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token string\">\"Subject: \"</span> <span class=\"token punctuation\">.</span> $subject <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> $additional_headers<span class=\"token punctuation\">;</span>\n    $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token string\">\"Date: \"</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token string\">\"X-Mailer:By (PHP/\"</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">phpversion</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\")\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">list</span><span class=\"token punctuation\">(</span>$msec<span class=\"token punctuation\">,</span> $sec<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">microtime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $header <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> <span class=\"token string\">\"Message-ID: &lt;\"</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"YmdHis\"</span><span class=\"token punctuation\">,</span> $sec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\".\"</span> <span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span>$msec <span class=\"token operator\">*</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\".\"</span> <span class=\"token punctuation\">.</span> $mail_from <span class=\"token punctuation\">.</span> <span class=\"token string\">\"&gt;\\r\\n\"</span><span class=\"token punctuation\">;</span>\n    $TO <span class=\"token operator\">=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">,</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">strip_comment</span><span class=\"token punctuation\">(</span>$to<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$cc <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $TO <span class=\"token operator\">=</span> <span class=\"token function\">array_merge</span><span class=\"token punctuation\">(</span>$TO<span class=\"token punctuation\">,</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">,</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">strip_comment</span><span class=\"token punctuation\">(</span>$cc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//合并一个或多个数组</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$bcc <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $TO <span class=\"token operator\">=</span> <span class=\"token function\">array_merge</span><span class=\"token punctuation\">(</span>$TO<span class=\"token punctuation\">,</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">,</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">strip_comment</span><span class=\"token punctuation\">(</span>$bcc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    $sent <span class=\"token operator\">=</span> TRUE<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span>$TO <span class=\"token keyword\">as</span> $rcpt_to<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $rcpt_to <span class=\"token operator\">=</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">get_address</span><span class=\"token punctuation\">(</span>$rcpt_to<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_sockopen</span><span class=\"token punctuation\">(</span>$rcpt_to<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: Cannot send email to \"</span> <span class=\"token punctuation\">.</span> $rcpt_to <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $sent <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_send</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>host_name<span class=\"token punctuation\">,</span> $mail_from<span class=\"token punctuation\">,</span> $rcpt_to<span class=\"token punctuation\">,</span> $header<span class=\"token punctuation\">,</span> $body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"E-mail has been sent to &lt;\"</span> <span class=\"token punctuation\">.</span> $rcpt_to <span class=\"token punctuation\">.</span> <span class=\"token string\">\"&gt;\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n        $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: Cannot send email to &lt;\"</span> <span class=\"token punctuation\">.</span> $rcpt_to <span class=\"token punctuation\">.</span> <span class=\"token string\">\"&gt;\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $sent <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Disconnected from remote host\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    echo <span class=\"token string\">\"&lt;br&gt;\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//echo $header;</span>\n    <span class=\"token keyword\">return</span> $sent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/* Private Functions */</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_send</span><span class=\"token punctuation\">(</span>$helo<span class=\"token punctuation\">,</span> $from<span class=\"token punctuation\">,</span> $to<span class=\"token punctuation\">,</span> $header<span class=\"token punctuation\">,</span> $body <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_putcmd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"HELO\"</span><span class=\"token punctuation\">,</span> $helo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending HELO command\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token preprocessor property\">#auth</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>auth<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_putcmd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"AUTH LOGIN\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending HELO command\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_putcmd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>pass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending HELO command\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token preprocessor property\">#</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_putcmd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MAIL\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"FROM:&lt;\"</span> <span class=\"token punctuation\">.</span> $from <span class=\"token punctuation\">.</span> <span class=\"token string\">\"&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending MAIL FROM command\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_putcmd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"RCPT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"TO:&lt;\"</span> <span class=\"token punctuation\">.</span> $to <span class=\"token punctuation\">.</span> <span class=\"token string\">\"&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending RCPT TO command\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_putcmd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DATA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending DATA command\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_message</span><span class=\"token punctuation\">(</span>$header<span class=\"token punctuation\">,</span> $body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending message\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_eom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt; [EOM]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_putcmd</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"QUIT\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sending QUIT command\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_sockopen</span><span class=\"token punctuation\">(</span>$address<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>relay_host <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_sockopen_mx</span><span class=\"token punctuation\">(</span>$address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_sockopen_relay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_sockopen_relay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Trying to \"</span> <span class=\"token punctuation\">.</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>relay_host <span class=\"token punctuation\">.</span> <span class=\"token string\">\":\"</span> <span class=\"token punctuation\">.</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>smtp_port <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock <span class=\"token operator\">=</span> @<span class=\"token function\">fsockopen</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>relay_host<span class=\"token punctuation\">,</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>smtp_port<span class=\"token punctuation\">,</span> $errno<span class=\"token punctuation\">,</span> $errstr<span class=\"token punctuation\">,</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>time_out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock <span class=\"token operator\">&amp;&amp;</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: Cannot connenct to relay host \"</span> <span class=\"token punctuation\">.</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>relay_host <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: \"</span> <span class=\"token punctuation\">.</span> $errstr <span class=\"token punctuation\">.</span> <span class=\"token string\">\" (\"</span> <span class=\"token punctuation\">.</span> $errno <span class=\"token punctuation\">.</span> <span class=\"token string\">\")\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> FALSE<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Connected to relay host \"</span> <span class=\"token punctuation\">.</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>relay_host <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_sockopen_mx</span><span class=\"token punctuation\">(</span>$address<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $domain <span class=\"token operator\">=</span> <span class=\"token function\">ereg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"^.+@([^@]+)$\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\\1\"</span><span class=\"token punctuation\">,</span> $address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>@<span class=\"token function\">getmxrr</span><span class=\"token punctuation\">(</span>$domain<span class=\"token punctuation\">,</span> $MXHOSTS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: Cannot resolve MX \\\"\"</span> <span class=\"token punctuation\">.</span> $domain <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> FALSE<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span>$MXHOSTS <span class=\"token keyword\">as</span> $host<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Trying to \"</span> <span class=\"token punctuation\">.</span> $host <span class=\"token punctuation\">.</span> <span class=\"token string\">\":\"</span> <span class=\"token punctuation\">.</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>smtp_port <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock <span class=\"token operator\">=</span> @<span class=\"token function\">fsockopen</span><span class=\"token punctuation\">(</span>$host<span class=\"token punctuation\">,</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>smtp_port<span class=\"token punctuation\">,</span> $errno<span class=\"token punctuation\">,</span> $errstr<span class=\"token punctuation\">,</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>time_out<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock <span class=\"token operator\">&amp;&amp;</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Warning: Cannot connect to mx host \"</span> <span class=\"token punctuation\">.</span> $host <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: \"</span> <span class=\"token punctuation\">.</span> $errstr <span class=\"token punctuation\">.</span> <span class=\"token string\">\" (\"</span> <span class=\"token punctuation\">.</span> $errno <span class=\"token punctuation\">.</span> <span class=\"token string\">\")\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Connected to mx host \"</span> <span class=\"token punctuation\">.</span> $host <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: Cannot connect to any mx hosts (\"</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">implode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\", \"</span><span class=\"token punctuation\">,</span> $MXHOSTS<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\")\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> FALSE<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_message</span><span class=\"token punctuation\">(</span>$header<span class=\"token punctuation\">,</span> $body<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function\">fputs</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock<span class=\"token punctuation\">,</span> $header <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\r\\n\"</span> <span class=\"token punctuation\">.</span> $body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&gt; \"</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\n\"</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\"&gt; \"</span><span class=\"token punctuation\">,</span> $header <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n&gt; \"</span> <span class=\"token punctuation\">.</span> $body <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n&gt; \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_eom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function\">fputs</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\r\\n.\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\". [EOM]\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $response <span class=\"token operator\">=</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock<span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_debug</span><span class=\"token punctuation\">(</span>$response <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">mb_ereg</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"^[23]\"</span><span class=\"token punctuation\">,</span> $response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token function\">fputs</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock<span class=\"token punctuation\">,</span> <span class=\"token string\">\"QUIT\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">fgets</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock<span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: Remote host returned \\\"\"</span> <span class=\"token punctuation\">.</span> $response <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> FALSE<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_putcmd</span><span class=\"token punctuation\">(</span>$cmd<span class=\"token punctuation\">,</span> $arg <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$arg <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$cmd <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n        $cmd <span class=\"token operator\">=</span> $arg<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">else</span>\n        $cmd <span class=\"token operator\">=</span> $cmd <span class=\"token punctuation\">.</span> <span class=\"token string\">\" \"</span> <span class=\"token punctuation\">.</span> $arg<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">fputs</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>sock<span class=\"token punctuation\">,</span> $cmd <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&gt; \"</span> <span class=\"token punctuation\">.</span> $cmd <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_error</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">string</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: Error occurred while \"</span> <span class=\"token punctuation\">.</span> $<span class=\"token keyword\">string</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\".\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> FALSE<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">log_write</span><span class=\"token punctuation\">(</span>$message<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_debug</span><span class=\"token punctuation\">(</span>$message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>log_file <span class=\"token operator\">==</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    $message <span class=\"token operator\">=</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"M d H:i:s \"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">get_current_user</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\"[\"</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">getmypid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\"]: \"</span> <span class=\"token punctuation\">.</span> $message<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>@<span class=\"token function\">file_exists</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>log_file<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>$fp <span class=\"token operator\">=</span> @<span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>log_file<span class=\"token punctuation\">,</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">smtp_debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Warning: Cannot open log file \\\"\"</span> <span class=\"token punctuation\">.</span> $<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>log_file <span class=\"token punctuation\">.</span> <span class=\"token string\">\"\\\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> FALSE<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">flock</span><span class=\"token punctuation\">(</span>$fp<span class=\"token punctuation\">,</span> LOCK_EX<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">fputs</span><span class=\"token punctuation\">(</span>$fp<span class=\"token punctuation\">,</span> $message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span>$fp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> TRUE<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">strip_comment</span><span class=\"token punctuation\">(</span>$address<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $comment <span class=\"token operator\">=</span> <span class=\"token string\">\"\\\\([^()]*\\\\)\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">mb_ereg</span><span class=\"token punctuation\">(</span>$comment<span class=\"token punctuation\">,</span> $address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      $address <span class=\"token operator\">=</span> <span class=\"token function\">mb_ereg_replace</span><span class=\"token punctuation\">(</span>$comment<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> $address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> $address<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">get_address</span><span class=\"token punctuation\">(</span>$address<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $address <span class=\"token operator\">=</span> <span class=\"token function\">mb_ereg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"([ \\t\\r\\n])+\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> $address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $address <span class=\"token operator\">=</span> <span class=\"token function\">mb_ereg_replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"^.*&lt;(.+)&gt;.*$\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\\1\"</span><span class=\"token punctuation\">,</span> $address<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> $address<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">smtp_debug</span><span class=\"token punctuation\">(</span>$message<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token keyword\">this</span><span class=\"token operator\">-&gt;</span>debug<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      echo $message <span class=\"token punctuation\">.</span> <span class=\"token string\">\"&lt;br&gt;\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token return-type class-name\">function</span> <span class=\"token function\">get_attach_type</span><span class=\"token punctuation\">(</span>$image_tag<span class=\"token punctuation\">)</span> <span class=\"token comment\">//</span>\n  <span class=\"token punctuation\">{<!-- --></span>\n    $filedata <span class=\"token operator\">=</span> <span class=\"token function\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $img_file_con <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span>$image_tag<span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">unset</span><span class=\"token punctuation\">(</span>$image_data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>$tem_buffer <span class=\"token operator\">=</span> <span class=\"token function\">AddSlashes</span><span class=\"token punctuation\">(</span><span class=\"token function\">fread</span><span class=\"token punctuation\">(</span>$img_file_con<span class=\"token punctuation\">,</span> <span class=\"token function\">filesize</span><span class=\"token punctuation\">(</span>$image_tag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      $image_data <span class=\"token punctuation\">.</span><span class=\"token operator\">=</span> $tem_buffer<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span>$img_file_con<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $filedata<span class=\"token punctuation\">[</span>'context'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> $image_data<span class=\"token punctuation\">;</span>\n    $filedata<span class=\"token punctuation\">[</span>'filename'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">basename</span><span class=\"token punctuation\">(</span>$image_tag<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    $extension      <span class=\"token operator\">=</span> <span class=\"token function\">substr</span><span class=\"token punctuation\">(</span>$image_tag<span class=\"token punctuation\">,</span> <span class=\"token function\">strrpos</span><span class=\"token punctuation\">(</span>$image_tag<span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>$image_tag<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token function\">strrpos</span><span class=\"token punctuation\">(</span>$image_tag<span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>$extension<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">\".gif\"</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"image/gif\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">\".gz\"</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"application/x-gzip\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">\".htm\"</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">\".html\"</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">\".jpg\"</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"image/jpeg\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">\".tar\"</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"application/x-tar\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">\".txt\"</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"text/plain\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">case</span> <span class=\"token string\">\".zip\"</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"application/zip\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span>\n        $filedata<span class=\"token punctuation\">[</span>'type'<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"application/octet-stream\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> $filedata<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>具体如何实现发送邮件：</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">?</span>php\nrequire 'email<span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">.</span>php'<span class=\"token punctuation\">;</span>\n$mailto<span class=\"token operator\">=</span>'<span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span><span class=\"token operator\">*</span>@qq<span class=\"token punctuation\">.</span>com'<span class=\"token punctuation\">;</span> <span class=\"token comment\">//收件人</span>\n$subject<span class=\"token operator\">=</span><span class=\"token string\">\"恭喜您开通年费会员成功\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//邮件主题</span>\n$body<span class=\"token operator\">=</span><span class=\"token string\">\"回复TD退订\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//邮件内容</span>\n<span class=\"token function\">sendmailto</span><span class=\"token punctuation\">(</span>$mailto<span class=\"token punctuation\">,</span>$subject<span class=\"token punctuation\">,</span>$body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\necho <span class=\"token string\">\"finish\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>'时间：Y年m月d日  H<span class=\"token punctuation\">:</span>i'<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token return-type class-name\">function</span> <span class=\"token function\">sendmailto</span><span class=\"token punctuation\">(</span>$mailto<span class=\"token punctuation\">,</span> $mailsub<span class=\"token punctuation\">,</span> $mailbd<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token comment\">//require_once ('email.class.php');</span>\n  <span class=\"token comment\">//##########################################</span>\n  $smtpserver   <span class=\"token operator\">=</span> <span class=\"token string\">\"smtp.163.com\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//SMTP服务器</span>\n  $smtpserverport <span class=\"token operator\">=</span> <span class=\"token number\">25</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//SMTP服务器端口</span>\n  $smtpusermail  <span class=\"token operator\">=</span> <span class=\"token string\">\"***********@163.com\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//SMTP服务器的用户邮箱</span>\n  $smtpemailto  <span class=\"token operator\">=</span> $mailto<span class=\"token punctuation\">;</span>\n  $smtpuser    <span class=\"token operator\">=</span> <span class=\"token string\">\"*******@163.com\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//SMTP服务器的用户帐号</span>\n  $smtppass    <span class=\"token operator\">=</span> <span class=\"token string\">\"**********\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//SMTP服务器的用户密码</span>\n  $mailsubject  <span class=\"token operator\">=</span> $mailsub<span class=\"token punctuation\">;</span> <span class=\"token comment\">//邮件主题</span>\n  $mailsubject  <span class=\"token operator\">=</span> <span class=\"token string\">\"=?UTF-8?B?\"</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">base64_encode</span><span class=\"token punctuation\">(</span>$mailsubject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span> <span class=\"token string\">\"?=\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//防止乱码</span>\n  $mailbody    <span class=\"token operator\">=</span> $mailbd<span class=\"token punctuation\">;</span> <span class=\"token comment\">//邮件内容</span>\n  <span class=\"token comment\">//$mailbody = \"=?UTF-8?B?\".base64_encode($mailbody).\"?=\"; //防止乱码</span>\n  $mailtype    <span class=\"token operator\">=</span> <span class=\"token string\">\"HTML\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//邮件格式（HTML/TXT）,TXT为文本邮件. 139邮箱的短信提醒要设置为HTML才正常</span>\n  <span class=\"token preprocessor property\">##########################################</span>\n  $smtp      <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">smtp</span><span class=\"token punctuation\">(</span>$smtpserver<span class=\"token punctuation\">,</span> $smtpserverport<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> $smtpuser<span class=\"token punctuation\">,</span> $smtppass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//这里面的一个true是表示使用身份验证,否则不使用身份验证.</span>\n  $smtp<span class=\"token operator\">-&gt;</span>debug  <span class=\"token operator\">=</span> TRUE<span class=\"token punctuation\">;</span> <span class=\"token comment\">//是否显示发送的调试信息</span>\n  $smtp<span class=\"token operator\">-&gt;</span><span class=\"token function\">sendmail</span><span class=\"token punctuation\">(</span>$smtpemailto<span class=\"token punctuation\">,</span> $smtpusermail<span class=\"token punctuation\">,</span> $mailsubject<span class=\"token punctuation\">,</span> $mailbody<span class=\"token punctuation\">,</span> $mailtype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">?</span><span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>如果出现报错：<br/> Error: Remote host returned “526 Authentication failure[0]”<br/> 则代表SMTP服务器信息填写错误<br/> 若出现该报错：<br/> 535, b’Login Fail. Please enter your authorization code to login<br/> 则代表在qq邮箱没有开启授权或是将<code>$smtppass = \"**********\"; //SMTP服务器的用户密码</code>更改为授权码<br/> <strong><a href=\"https://zhidao.baidu.com/question/237264721.html\">https://zhidao.baidu.com/question/237264721.html</a></strong><br/> <a href=\"https://www.jb51.net/article/146432.htm\">https://www.jb51.net/article/146432.htm</a></p>\n<p><strong>看到有人评论说出现了502报错，试着运行确实有该报错。起初我还以为是qq授权码的问题，qq密码更改了好几次，密码改一次授权码就得重新获取。后来改了授权码也没有解决，于是搜索了其他教程成功解决了该502报错。</strong></p>\n<ul><li><a href=\"https://blog.csdn.net/chengjianghao/article/details/103933784\">https://blog.csdn.net/chengjianghao/article/details/103933784</a>参考该博客，跳转链接下载PHP实现发送邮件的完整项目源码。</li><li>定义一个新函数</li></ul>\n<pre><code class=\"prism language-bash\"><span class=\"token keyword\">function</span> sendMail<span class=\"token punctuation\">(</span><span class=\"token variable\">$to</span>,<span class=\"token variable\">$title</span>,<span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    // 这个PHPMailer 就是之前从 Github上下载下来的那个项目\n    require <span class=\"token string\">'./PHPMailer/PHPMailerAutoload.php'</span><span class=\"token punctuation\">;</span>\n \n    <span class=\"token variable\">$mail</span> <span class=\"token operator\">=</span> new PHPMailer<span class=\"token punctuation\">;</span>\n    //使用smtp鉴权方式发送邮件\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>isSMTP<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    //smtp需要鉴权 这个必须是true\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>SMTPAuth <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    // qq 邮箱的 smtp服务器地址，这里当然也可以写其他的 smtp服务器地址\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>Host <span class=\"token operator\">=</span> <span class=\"token string\">'smtp.qq.com'</span><span class=\"token punctuation\">;</span>\n    //smtp登录的账号 这里填入字符串格式的qq号即可\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>Username <span class=\"token operator\">=</span> <span class=\"token string\">'2839247368@qq.com'</span><span class=\"token punctuation\">;</span>\n    // 这个就是之前得到的授权码，一共16位\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>Password <span class=\"token operator\">=</span> <span class=\"token string\">'xccemvofmwcvdgjg'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>setFrom<span class=\"token punctuation\">(</span><span class=\"token string\">'2839247368@qq.com'</span>, <span class=\"token string\">'你的主管'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    // <span class=\"token variable\">$to</span> 为收件人的邮箱地址，如果想一次性发送向多个邮箱地址，则只需要将下面这个方法多次调用即可\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>addAddress<span class=\"token punctuation\">(</span><span class=\"token variable\">$to</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    // 该邮件的主题\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>Subject <span class=\"token operator\">=</span> <span class=\"token variable\">$title</span><span class=\"token punctuation\">;</span>\n    // 该邮件的正文内容\n    <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>Body <span class=\"token operator\">=</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">;</span>\n \n    // 使用 send<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 方法发送邮件\n    if<span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>send<span class=\"token punctuation\">(</span><span class=\"token punctuation\">))</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token builtin class-name\">return</span> <span class=\"token string\">'发送失败: '</span> <span class=\"token builtin class-name\">.</span> <span class=\"token variable\">$mail</span>-<span class=\"token operator\">&gt;</span>ErrorInfo<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token builtin class-name\">return</span> <span class=\"token string\">\"发送成功\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre>\n<ul><li>调用该函数即可</li></ul>\n<pre><code class=\"prism language-bash\">sendMail<span class=\"token punctuation\">(</span><span class=\"token variable\">$to</span>,<span class=\"token variable\">$title</span>,<span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>成功发送邮件！</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-09-01 10:03:32", "summary": "使用中的函数在这里插入图片描述出现报错：需要使用发送邮件邮箱开启服务查看邮箱服务器以及端口在这里插入图片描述定义发送邮件的库：端口号服务器主机名服务器主机地址验证服务器用户名服务器密码构造方法"}