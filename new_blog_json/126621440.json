{"blogid": "126621440", "writerAge": "码龄5年", "writerBlogNum": "138", "writerCollect": "137", "writerComment": "9", "writerFan": "8320", "writerGrade": "4级", "writerIntegral": "1507", "writerName": "Blueeyedboy521", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126621440.jpg", "writerRankTotal": "12405", "writerRankWeekly": "474", "writerThumb": "23", "writerVisitNum": "89603", "blog_read_count": "194", "blog_time": "于 2022-08-31 12:29:18 发布", "blog_title": "Tomcat7集成链路追踪SkyWalking6.6版本", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>目录</h3>\n<ul><li><a href=\"#_4\">下载</a></li><li><a href=\"#skywalking_12\">启动skywalking</a></li><li><a href=\"#Tomcat_46\">Tomcat接入</a></li><li><ul><li><a href=\"#1Tomcat7wexejava_48\">方法1：修改Tomcat7w.exe中java参数</a></li><li><a href=\"#2catalinabat_58\">方法2：修改catalina.bat</a></li><li><a href=\"#3catalinabat_77\">方法3：修改catalina.bat</a></li></ul>\n</li><li><a href=\"#tomcat_100\">监听tomcat程序</a></li><li><ul><li><a href=\"#topology_101\">拓扑图topology</a></li><li><a href=\"#_104\">数据库监听</a></li><li><a href=\"#trace_107\">链路追踪trace</a></li></ul>\n</li></ul>\n</div>\n<br/> SkyWalking 是观察性分析平台和应用性能管理系统。\n<br/> 提供分布式追踪、服务网格遥测分析、度量聚合和可视化一体化解决方案。\n<br/> 本示例演示使用skywalking监控Tomcat下面的项目链路调用跟踪。\n<p></p>\n<h1><a id=\"_4\"></a>下载</h1>\n<p>下载地址：<a href=\"https://archive.apache.org/dist/skywalking/6.6.0/\">https://archive.apache.org/dist/skywalking/6.6.0/</a></p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\5633e98924014f219654122126b37e15.png\"/><br/> 下载链接：<a href=\"https://archive.apache.org/dist/skywalking/6.6.0/apache-skywalking-apm-6.6.0.zip\">https://archive.apache.org/dist/skywalking/6.6.0/apache-skywalking-apm-6.6.0.zip</a></p>\n<p>文档地址：<a href=\"https://skywalking.apache.org/docs/main/latest/en/changes/changes-6.x/#660\">https://skywalking.apache.org/docs/main/latest/en/changes/changes-6.x/#660</a></p>\n<h1><a id=\"skywalking_12\"></a>启动skywalking</h1>\n<p>解压压缩包，进入bin目录：C:\\05components\\apache-skywalking-apm-6.6.0\\apache-skywalking-apm-bin\\bin<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a3406d77ff334dbc9f9c994981fdef36.png\"/></p>\n<p>双击startup.bat启动<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d5eac3cbc60f4857a86f916d64854655.png\"/><br/> 显示如上说明启动成功，也可以在logs查看日志<br/> cd C:\\05components\\apache-skywalking-apm-6.6.0\\apache-skywalking-apm-bin\\logs\\skywalking-oap-server.log<br/> 可以看到监听11800，12800，8080端口<br/> 启动成功后会启动两个服务，一个是skywalking-oap-server，一个是skywalking-web-ui：8080<br/> skywalking-oap-server服务启动会暴露11800和12800两个端口，分别为收集监控数据的端口11800和接受前端请求的端口12800，修改端口可以修改config/application.yml</p>\n<pre><code class=\"prism language-bash\"><span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,397 - org.apache.skywalking.oap.server.library.server.grpc.GRPCServer - <span class=\"token number\">138</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Bind handler TraceSegmentServiceHandler into gRPC server <span class=\"token number\">0.0</span>.0.0:11800\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,410 - org.apache.skywalking.oap.server.library.server.grpc.GRPCServer - <span class=\"token number\">138</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Bind handler TraceSegmentReportServiceHandler into gRPC server <span class=\"token number\">0.0</span>.0.0:11800\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,413 - org.apache.skywalking.oap.server.library.server.jetty.JettyServer - <span class=\"token number\">74</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Bind handler TraceSegmentServletHandler into jetty server <span class=\"token number\">0.0</span>.0.0:12800\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,419 - org.apache.skywalking.oap.server.library.buffer.BufferStream - <span class=\"token number\">71</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Try to lock buffer directory, directory is: C:<span class=\"token punctuation\">\\</span>05components<span class=\"token punctuation\">\\</span>apache-skywalking-apm-6.6.0<span class=\"token punctuation\">\\</span>apache-skywalking-apm-bin<span class=\"token punctuation\">\\</span>bin<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">\\</span>trace-buffer<span class=\"token punctuation\">\\</span>v5\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,419 - org.apache.skywalking.oap.server.library.buffer.BufferStream - <span class=\"token number\">84</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Lock buffer directory successfully, directory is: C:<span class=\"token punctuation\">\\</span>05components<span class=\"token punctuation\">\\</span>apache-skywalking-apm-6.6.0<span class=\"token punctuation\">\\</span>apache-skywalking-apm-bin<span class=\"token punctuation\">\\</span>bin<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">\\</span>trace-buffer<span class=\"token punctuation\">\\</span>v5\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,420 - org.apache.skywalking.oap.server.library.buffer.OffsetStream - <span class=\"token number\">117</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Create a new offset <span class=\"token function\">file</span> offset-1661915375420.sw\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,421 - org.apache.skywalking.oap.server.library.buffer.DataStreamWriter - <span class=\"token number\">75</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Create a new buffer data file: C:<span class=\"token punctuation\">\\</span>05components<span class=\"token punctuation\">\\</span>apache-skywalking-apm-6.6.0<span class=\"token punctuation\">\\</span>apache-skywalking-apm-bin<span class=\"token punctuation\">\\</span>bin<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">\\</span>trace-buffer<span class=\"token punctuation\">\\</span>v5<span class=\"token punctuation\">\\</span>data-1661915375420.sw\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,422 - org.apache.skywalking.oap.server.library.buffer.BufferStream - <span class=\"token number\">71</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Try to lock buffer directory, directory is: C:<span class=\"token punctuation\">\\</span>05components<span class=\"token punctuation\">\\</span>apache-skywalking-apm-6.6.0<span class=\"token punctuation\">\\</span>apache-skywalking-apm-bin<span class=\"token punctuation\">\\</span>bin<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">\\</span>trace-buffer\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,424 - org.apache.skywalking.oap.server.library.buffer.BufferStream - <span class=\"token number\">84</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Lock buffer directory successfully, directory is: C:<span class=\"token punctuation\">\\</span>05components<span class=\"token punctuation\">\\</span>apache-skywalking-apm-6.6.0<span class=\"token punctuation\">\\</span>apache-skywalking-apm-bin<span class=\"token punctuation\">\\</span>bin<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">\\</span>trace-buffer\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,424 - org.apache.skywalking.oap.server.library.buffer.OffsetStream - <span class=\"token number\">117</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Create a new offset <span class=\"token function\">file</span> offset-1661915375424.sw\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,434 - org.apache.skywalking.oap.server.library.buffer.DataStreamWriter - <span class=\"token number\">75</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Create a new buffer data file: C:<span class=\"token punctuation\">\\</span>05components<span class=\"token punctuation\">\\</span>apache-skywalking-apm-6.6.0<span class=\"token punctuation\">\\</span>apache-skywalking-apm-bin<span class=\"token punctuation\">\\</span>bin<span class=\"token punctuation\">\\</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">\\</span>trace-buffer<span class=\"token punctuation\">\\</span>data-1661915375425.sw\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,435 - org.apache.skywalking.oap.server.library.module.BootstrapFlow - <span class=\"token number\">58</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - start the provider default <span class=\"token keyword\">in</span> istio-telemetry module.\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,437 - org.apache.skywalking.oap.server.library.server.grpc.GRPCServer - <span class=\"token number\">138</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Bind handler IstioTelemetryGRPCHandler into gRPC server <span class=\"token number\">0.0</span>.0.0:11800\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,443 - org.apache.skywalking.oap.server.library.module.BootstrapFlow - <span class=\"token number\">58</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - start the provider default <span class=\"token keyword\">in</span> receiver-jvm module.\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,444 - org.apache.skywalking.oap.server.library.server.grpc.GRPCServer - <span class=\"token number\">138</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Bind handler JVMMetricsServiceHandler into gRPC server <span class=\"token number\">0.0</span>.0.0:11800\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,447 - org.apache.skywalking.oap.server.library.server.grpc.GRPCServer - <span class=\"token number\">138</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - Bind handler JVMMetricReportServiceHandler into gRPC server <span class=\"token number\">0.0</span>.0.0:11800\n<span class=\"token number\">2022</span>-08-31 <span class=\"token number\">11</span>:09:35,905 - org.apache.skywalking.oap.server.library.server.jetty.JettyServer - <span class=\"token number\">93</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span> INFO  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> - start server, host: <span class=\"token number\">0.0</span>.0.0, port: <span class=\"token number\">12800</span>\n</code></pre>\n<p>访问 127.0.0.1:8080<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\aa1f1f5a29064b0d80d95e6089be16b6.png\"/></p>\n<h1><a id=\"Tomcat_46\"></a>Tomcat接入</h1>\n<h2><a id=\"1Tomcat7wexejava_48\"></a>方法1：修改Tomcat7w.exe中java参数</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9e40b9d349724deea8aca2991eae9c29.png\"/><br/> 加入如下参数</p>\n<pre><code class=\"prism language-bash\">-javaagent:C:<span class=\"token punctuation\">\\</span>05components<span class=\"token punctuation\">\\</span>apache-skywalking-apm-6.6.0<span class=\"token punctuation\">\\</span>apache-skywalking-apm-bin<span class=\"token punctuation\">\\</span>agent<span class=\"token punctuation\">\\</span>skywalking-agent.jar\n-Dskywalking.agent.service_name<span class=\"token operator\">=</span>sgb-test\n-Dskywalking.collector.backend_service<span class=\"token operator\">=</span>localhost:11800\n</code></pre>\n<h2><a id=\"2catalinabat_58\"></a>方法2：修改catalina.bat</h2>\n<p>在首行加入如下信息</p>\n<ul><li>Linux Tomcat 7-9</li></ul>\n<p>修改 tomcat/bin/catalina.sh 的第一行：</p>\n<pre><code class=\"prism language-bash\">\n<span class=\"token assign-left variable\">CATALINA_OPTS</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">$CATALINA_OPTS</span> -javaagent:/opt/agent/skywalking-agent.jar\"</span><span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">export</span> CATALINA_OPTS\n</code></pre>\n<ul><li>Windows Tomcat 7-9<br/> 修改 tomcat/bin/catalina.bat 的第一行：</li></ul>\n<pre><code class=\"prism language-bash\"><span class=\"token builtin class-name\">set</span> <span class=\"token string\">\"CATALINA_OPTS=-javaagent:/opt/agent/skywalking-agent.jar\"</span>\n</code></pre>\n<h2><a id=\"3catalinabat_77\"></a>方法3：修改catalina.bat</h2>\n<p>添加内容：</p>\n<ul><li>单个项目：</li></ul>\n<pre><code class=\"prism language-bash\"><span class=\"token builtin class-name\">set</span> <span class=\"token string\">\"CATALINA_OPTS= -javaagent:D:\\Tools<span class=\"token entity\" title=\"\\a\">\\a</span>pache-skywalking-apm-8.7.0<span class=\"token entity\" title=\"\\a\">\\a</span>gent\\skywalking-agent.jar -Dskywalking.agent.service_name=demo -Dskywalking.collector.backend_service=localhost:11800\"</span>\n</code></pre>\n<ul><li>多个项目：</li></ul>\n<pre><code class=\"prism language-bash\"><span class=\"token builtin class-name\">set</span> <span class=\"token assign-left variable\">JAVA_OPTS</span><span class=\"token operator\">=</span>-javaagent:D:<span class=\"token punctuation\">\\</span>Tools<span class=\"token punctuation\">\\</span>apache-skywalking-apm-8.7.0<span class=\"token punctuation\">\\</span>agent<span class=\"token punctuation\">\\</span>skywalking-agent.jar<span class=\"token operator\">=</span>agent.service_name<span class=\"token operator\">=</span>test1,agent.service_name<span class=\"token operator\">=</span>test2\n</code></pre>\n<p>或者</p>\n<pre><code class=\"prism language-bash\"><span class=\"token builtin class-name\">set</span> <span class=\"token string\">\"CATALINA_OPTS= -javaagent:D:\\Tools<span class=\"token entity\" title=\"\\a\">\\a</span>pache-skywalking-apm-8.7.0<span class=\"token entity\" title=\"\\a\">\\a</span>gent\\skywalking-agent.jar=agent.service_name=test1,agent.service_name=test2\"</span>\n</code></pre>\n<h1><a id=\"tomcat_100\"></a>监听tomcat程序</h1>\n<h2><a id=\"topology_101\"></a>拓扑图topology</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\2f65eb2211cf46b0954b83155af86ad1.png\"/></p>\n<h2><a id=\"_104\"></a>数据库监听</h2>\n<p>可以分析慢查询<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\30a4ece21ee0437f9d08c46c9746d336.png\"/></p>\n<h2><a id=\"trace_107\"></a>链路追踪trace</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\7f8eca6da8344b798e82bc6bb9d83408.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Java", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 1, "sql": 0, "php": 0, "time": "2022-08-31 12:29:18", "summary": "目录下载启动接入方法：修改中参数方法：修改方法：修改监听程序拓扑图数据库监听链路追踪是观察性分析平台和应用性能管理系统。提供分布式追踪、服务网格遥测分析、度量聚合和可视化一体化解决方案。本示例演示使用"}