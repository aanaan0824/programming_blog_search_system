{"blogid": "126700836", "writerAge": "码龄8年", "writerBlogNum": "149", "writerCollect": "307", "writerComment": "128", "writerFan": "4007", "writerGrade": "5级", "writerIntegral": "2378", "writerName": "牙膏上的小苏打2333", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126700836.jpg", "writerRankTotal": "7994", "writerRankWeekly": "3099", "writerThumb": "91", "writerVisitNum": "146091", "blog_read_count": "72", "blog_time": "已于 2022-09-06 15:19:29 修改", "blog_title": "Unity UI Toolkit学习笔记-C# 中创建自定义ui", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>🔮在C# 中创建自定义ui</h3>\n<ul><li><a href=\"#VisualElement_4\">🥡继承VisualElement</a></li><li><a href=\"#UxmlFactory_UI_18\">🌮定义UxmlFactory 暴露UI</a></li><li><a href=\"#_35\">🥠命名空间组织结构</a></li><li><a href=\"#__53\">🍥 添加自定义属性</a></li><li><a href=\"#_102\">🚨注意</a></li></ul>\n</div>\n<p></p>\n<p><a href=\"https://docs.unity.cn/2021.3/Documentation/Manual/UIB-structuring-ui-custom-elements.html\">参考1</a><br/> <a href=\"https://docs.unity.cn/2021.3/Documentation/Manual/UIE-UXML.html\">参考2</a></p>\n<h1><a id=\"VisualElement_4\"></a>🥡继承VisualElement</h1>\n<p>所有ui 元素都需要继承自<code>VisualElement</code></p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>UIElements</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyElement</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">VisualElement</span></span>\n<span class=\"token punctuation\">{<!-- --></span>\n    \n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<h1><a id=\"UxmlFactory_UI_18\"></a>🌮定义UxmlFactory 暴露UI</h1>\n<p>为了暴露自定义的ui 元素 需要定义<code>UxmlFactory</code></p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>UIElements</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyElement</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">VisualElement</span></span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UxmlFactory</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">UxmlFactory<span class=\"token punctuation\">&lt;</span>MyElement<span class=\"token punctuation\">,</span>UxmlTraits<span class=\"token punctuation\">&gt;</span></span></span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<p>添加好后就可以在<code>UIBuilder &gt; Library &gt; Project &gt;Custom Controls（C#）</code>中看到自己定义的ui元素了<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\62c1287b78e748eca461e1cd09e0efb4.png\"/></p>\n<h1><a id=\"_35\"></a>🥠命名空间组织结构</h1>\n<p>可以通过命名空间来组织ui结构<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d78bedd1d4fd46c495d20b142a44ac4e.png\"/></p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>UIElements</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">ZYF<span class=\"token punctuation\">.</span>UIEle</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyElement</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">VisualElement</span></span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UxmlFactory</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">UxmlFactory<span class=\"token punctuation\">&lt;</span>MyElement<span class=\"token punctuation\">,</span> UxmlTraits<span class=\"token punctuation\">&gt;</span></span></span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<h1><a id=\"__53\"></a>🍥 添加自定义属性</h1>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\54edf475284340b0a14e5587d29f5386.png\"/></p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">UnityEngine<span class=\"token punctuation\">.</span>UIElements</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">ZYF<span class=\"token punctuation\">.</span>UIEle</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyElement</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">VisualElement</span></span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UxmlFactory</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">UxmlFactory<span class=\"token punctuation\">&lt;</span>MyElement<span class=\"token punctuation\">,</span> UxmlTraits<span class=\"token punctuation\">&gt;</span></span></span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">new</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UxmlTraits</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">VisualElement<span class=\"token punctuation\">.</span>UxmlTraits</span></span> <span class=\"token punctuation\">{<!-- --></span>\n\n            <span class=\"token class-name\">UxmlStringAttributeDescription</span> m_Str <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">UxmlStringAttributeDescription</span> <span class=\"token punctuation\">{<!-- --></span> \n                name <span class=\"token operator\">=</span> <span class=\"token string\">\"string-attr\"</span><span class=\"token punctuation\">,</span>\n                defaultValue <span class=\"token operator\">=</span> <span class=\"token string\">\"str属性\"</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">UxmlIntAttributeDescription</span> m_Int <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">UxmlIntAttributeDescription</span> <span class=\"token punctuation\">{<!-- --></span>\n                name <span class=\"token operator\">=</span><span class=\"token string\">\"int-attr\"</span><span class=\"token punctuation\">,</span>\n                defaultValue<span class=\"token operator\">=</span><span class=\"token number\">2</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\">IEnumerable<span class=\"token punctuation\">&lt;</span>UxmlChildElementDescription<span class=\"token punctuation\">&gt;</span></span> uxmlChildElementsDescription\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">yield</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Init</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">VisualElement</span> ve<span class=\"token punctuation\">,</span> <span class=\"token class-name\">IUxmlAttributes</span> bag<span class=\"token punctuation\">,</span> <span class=\"token class-name\">CreationContext</span> cc<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">base</span><span class=\"token punctuation\">.</span><span class=\"token function\">Init</span><span class=\"token punctuation\">(</span>ve<span class=\"token punctuation\">,</span> bag<span class=\"token punctuation\">,</span> cc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> ate <span class=\"token operator\">=</span> ve <span class=\"token keyword\">as</span> <span class=\"token class-name\">MyElement</span><span class=\"token punctuation\">;</span>\n\n                ate<span class=\"token punctuation\">.</span>stringAttr <span class=\"token operator\">=</span> m_Str<span class=\"token punctuation\">.</span><span class=\"token function\">GetValueFromBag</span><span class=\"token punctuation\">(</span><span class=\"token named-parameter punctuation\">bag</span><span class=\"token punctuation\">:</span>bag<span class=\"token punctuation\">,</span><span class=\"token named-parameter punctuation\">cc</span><span class=\"token punctuation\">:</span>cc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                ate<span class=\"token punctuation\">.</span>intAttr <span class=\"token operator\">=</span> m_Int<span class=\"token punctuation\">.</span><span class=\"token function\">GetValueFromBag</span><span class=\"token punctuation\">(</span><span class=\"token named-parameter punctuation\">bag</span><span class=\"token punctuation\">:</span>bag<span class=\"token punctuation\">,</span><span class=\"token named-parameter punctuation\">cc</span><span class=\"token punctuation\">:</span>cc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> stringAttr <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">int</span></span> intAttr <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">set</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<p><mark>需要注意的是：</mark> C# 属性名字要根据<code>Uxml*AttributeDescription</code>中的name 来设置，首先去掉破折号，然后按驼峰命名法把它们组合一起；<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\cbdfcd0b731c4d16ba86c32238752d5d.png\"/></p>\n<h1><a id=\"_102\"></a>🚨注意</h1>\n<p>当前的UIBuilder 不支持自定义ui元素的自定义Inspector</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "C#", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-06 15:19:29", "summary": "在中创建自定义继承定义暴露命名空间组织结构添加自定义属性注意参考参考继承所有元素都需要继承自定义暴露为了暴露自定义的元素需要定义添加好后就可以在中看到自己定义的元素了在这里插入图片描述命名空间组织结构"}