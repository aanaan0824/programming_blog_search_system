{"blogid": "124285574", "writerAge": "码龄3年", "writerBlogNum": "25", "writerCollect": "89", "writerComment": "2", "writerFan": "9", "writerGrade": "2级", "writerIntegral": "258", "writerName": "太吾传人，玛卡巴卡", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124285574.jpg", "writerRankTotal": "67572", "writerRankWeekly": "137129", "writerThumb": "14", "writerVisitNum": "14625", "blog_read_count": "1357", "blog_time": "于 2022-04-19 22:53:05 发布", "blog_title": "【fastadmin】如何自定义批量操作按钮以及导入excel表格添加多个管理员", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>现在有个需求，需要用fastadmin来完成一个操作：</p>\n<ol><li>超级管理员通过导入一个excel表，批量生成若干个管理员。</li><li>对这些管理员进行批量操作，例如同时纳入教师组(二级管理员)</li></ol>\n<p>为了完成这个需求，我要做两个操作：<br/> 1、使用fastadmin自带的导入功能，进行管理员信息的统一上传。<br/> 2、添加自定义的批量操作按钮，完成向管理员组表里添加数据的功能。</p>\n<h2><a id=\"Excel_8\"></a>接下来是第一步(导入Excel表生成数据)</h2>\n<ol><li>首先在管理员的index.html中添加该代码<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\10d74b38621e4155881aa45491e687d5.png\"/></li></ol>\n<pre><code class=\"prism language-html\">{:build_toolbar('refresh,add,delete,import')}\n</code></pre>\n<ol start=\"2\"><li>在管理员的admin.js添加如下代码<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\31943196d60147129b3405b02f6dee1a.png\"/></li></ol>\n<pre><code class=\"prism language-javascript\"><span class=\"token literal-property property\">import_url</span><span class=\"token operator\">:</span> <span class=\"token string\">'auth/admin/import'</span><span class=\"token punctuation\">,</span>\n</code></pre>\n<ol start=\"3\"><li>在管理员的Admin.php文件添加如下代码：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8b8f859869844ca991a231a49273c522.png\"/></li></ol>\n<pre><code class=\"prism language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">import</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">parent</span><span class=\"token operator\">::</span><span class=\"token function\">import</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<ol start=\"4\"><li>导入按钮就会显示在管理员页面上了<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\15a73105acdb4108872ff278d56d5c59.png\"/></li><li>导入数据格式可以按照下面的来<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d9cd96897ba640099759e6912062731b.png\"/></li></ol>\n<blockquote>\n<p><strong>请注意，表格的第一行是数据库中字段的备注名，想添加哪一行就去数据库看备注是什么，然后写到表格里就可以了。</strong><br/> <strong>密码：</strong> c13f62012fd6a8fdf06b3452a94430e5<br/> <strong>密码盐：</strong> rpR6Bv<br/> 这样设置密码默认为 <strong>123456</strong></p>\n</blockquote>\n<h2><a id=\"_39\"></a>然后是第二步（添加自定义批量操作按钮）</h2>\n<ol><li>首先我们要做的操作是给这些管理员批量设置管理组级别，因此，我们去看一下fastadmin是如何设置级别的。重点代码在这里：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\638ad9013fac4ea7bc12ac5b55afc6ae.png\"/></li></ol>\n<blockquote>\n<p><strong>uid是管理员的id，group_id是管理组的id</strong></p>\n</blockquote>\n<ol start=\"2\"><li>所以我们要做的就是获取到所有选中的管理员的id，并调用模板来存入数据</li><li>添加批量操作按钮，在管理员的index.html中<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8057efb412434cf08556dbdc67704359.png\"/></li></ol>\n<pre><code class=\"prism language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>javascript:;<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary btn-changeteacher btn-disabled disabled<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">title</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{:__(<span class=\"token punctuation\">'</span>批量设置为教师<span class=\"token punctuation\">'</span>)}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fa fa-suitcase<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">&gt;</span></span> {:__('批量设置为教师')}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<ol start=\"4\"><li>在管理员的admin.js中添加如下代码：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\f6d1d919c76c4675901da8931c4b1de0.png\"/></li></ol>\n<pre><code class=\"prism language-javascript\">\t\t\t<span class=\"token comment\">/* 获取选中的id */</span>\n            <span class=\"token keyword\">function</span> <span class=\"token function\">getIdSelections</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">return</span> $<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bootstrapTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getSelections'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">row</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">return</span> row<span class=\"token punctuation\">.</span>id\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">// 批量设置权限</span>\n            <span class=\"token comment\">// 注意这里的元素你需要根据自己给&lt;a&gt;标签取的类名来获取，我的是btn-changeteacher，你可以在上一步看到。</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".btn-changeteacher\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">var</span> ids <span class=\"token operator\">=</span>table<span class=\"token punctuation\">.</span><span class=\"token function\">bootstrapTable</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getSelections'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">var</span> checkids <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                checkids <span class=\"token operator\">=</span> <span class=\"token function\">getIdSelections</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>checkids<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                Fast<span class=\"token punctuation\">.</span>api<span class=\"token punctuation\">.</span><span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n                        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span><span class=\"token string\">'auth/admin/changeteacher?ids='</span><span class=\"token operator\">+</span>checkids\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> ret</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        location<span class=\"token punctuation\">.</span><span class=\"token function\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> ret</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        location<span class=\"token punctuation\">.</span><span class=\"token function\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\t   \n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<ol start=\"5\"><li>在管理员的控制器 Admin.php中添加如下代码：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\4e12c916ca72440bb5f730262466408d.png\"/></li></ol>\n<pre><code class=\"prism language-php\">\t<span class=\"token comment\">/**\n     * 批量设置为教师组\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">changeteacher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token variable\">$lists</span><span class=\"token operator\">=</span><span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token property\">request</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">param</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'ids'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$ids</span> <span class=\"token operator\">=</span> <span class=\"token function\">explode</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">','</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$lists</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//转数组</span>\n        <span class=\"token variable\">$dataset</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">&lt;</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ids</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token variable\">$dataset</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'uid'</span> <span class=\"token operator\">=&gt;</span> <span class=\"token variable\">$ids</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'group_id'</span> <span class=\"token operator\">=&gt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">try</span><span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'AuthGroupAccess'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">saveAll</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$dataset</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name static-context\">Db</span><span class=\"token operator\">::</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"result\"</span> <span class=\"token operator\">=&gt;</span> <span class=\"token string double-quoted-string\">\"success\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name class-name-fully-qualified\"><span class=\"token punctuation\">\\</span>Exception</span> <span class=\"token variable\">$e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name static-context\">Db</span><span class=\"token operator\">::</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$this</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$e</span><span class=\"token operator\">-&gt;</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n</code></pre>\n<ol start=\"6\"><li>所有功能完成，测试前请先清理一下缓存。</li></ol>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 1, "java": 0, "sql": 0, "php": 1, "time": "2022-04-19 22:53:05", "summary": "现在有个需求，需要用来完成一个操作：超级管理员通过导入一个表，批量生成若干个管理员。对这些管理员进行批量操作，例如同时纳入教师组二级管理员为了完成这个需求，我要做两个操作：、使用自带的导入功能，进行管"}