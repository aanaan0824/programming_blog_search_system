{"blogid": "125220799", "writerAge": "码龄1年", "writerBlogNum": "26", "writerCollect": "12", "writerComment": "17", "writerFan": "13", "writerGrade": "2级", "writerIntegral": "279", "writerName": "Caree By", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125220799.jpg", "writerRankTotal": "56876", "writerRankWeekly": "64831", "writerThumb": "16", "writerVisitNum": "3872", "blog_read_count": "592", "blog_time": "已于 2022-06-10 14:38:11 修改", "blog_title": "C# Winform窗体实现支付宝扫码支付", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"C_Winform_0\"></a>C# Winform窗体项目实现支付宝扫码支付</h1>\n<h3><a id=\"_2\"></a>一、内容介绍</h3>\n<p>啪嗒!( 搬好小板凳 )</p>\n<p>大家好，本次学习的内容是在博主大一winform窗体项目中实现的一个功能——支付宝扫码支付；</p>\n<p>主要功能通过支付宝包向我们提供的SDK程序包，与支付宝沙箱中的验证/调试接口功能实现；</p>\n<p>本次学习博主将直接把饭喂大家嘴里，想学的同学认真看，不想学的同学认真CV；( =.=!!! )</p>\n<p>看完记得给博主好评 ！！！；( QAQ )</p>\n<h3><a id=\"_14\"></a>二、环境准备</h3>\n<h5><a id=\"1_16\"></a>1、首先进入支付宝开放平台；</h5>\n<blockquote>\n<p>https://open.alipay.com/platform/home.htm</p>\n</blockquote>\n<h5><a id=\"2_20\"></a>2、手机使用支付宝扫码登录；</h5>\n<h5><a id=\"3___22\"></a>3、如果是第一次使用的同学 点击 《立即入驻》；</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\90c6aa0f8e7041d6b3773ca9b578ec73.png\"/></p>\n<h5><a id=\"4_27\"></a>4、进行实名验证；</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\1d244c820fb14e37b8739f7aa46386bb.png\"/></p>\n<h5><a id=\"5__32\"></a>5、成功之后进管理平台，找到控制台中的沙箱 ；</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8fca5e0851474f5b9c5df98c75ef2b88.png\"/></p>\n<h5><a id=\"6_37\"></a>6、进入沙箱之后会自动生成我们应用的基本信息；</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d0bf3fe7e026401ab832b34dceb51306.png\"/></p>\n<h5><a id=\"7APPIDC_42\"></a>7、其中《APPID》、《支付宝网关地址》与开发信息中的点击系统默认密钥的《查看》中生成的密钥都是我们后期代码中需要的参数；直接C下来（参数中的一个字母都不能错）；</h5>\n<h5><a id=\"8CJavaC_44\"></a>8、这里是我们的三个密钥，因为我们是C#项目所以《应用私钥》选择非Java语言；先不管C就完了；</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\804516ea1d864c7dbc05ea96aae542a4.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\eec57510a86048b58a2e6b4eb6bbb937.png\"/></p>\n<h5><a id=\"9__50\"></a>9、可喜可贺 前期的准备工作就结束了啦，接下来进入代码开发环节；</h5>\n<h3><a id=\"_52\"></a>三、程序包导入</h3>\n<h5><a id=\"1Visual_Studiowinform_54\"></a>1、打开Visual Studio创建一个新winform项目；</h5>\n<h5><a id=\"2lablebuttonPictureBoxTextBox_56\"></a>2、添加《lable》、《button》、《PictureBox》、《TextBox》控件；</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\dbdf89cd05434d0e97fabddfa1d48e33.png\"/></p>\n<h5><a id=\"3PictureBoxSize_ModeZoom_61\"></a>3、在控件属性中将《PictureBox》控件中的Size Mode属性改成Zoom，用于生成二维码时填充整个控件；</h5>\n<h5><a id=\"4NuGet_63\"></a>4、右击解决方案选择《管理NuGet程序包》；</h5>\n<blockquote>\n<p>这一步是因为在C#中支付宝向我们提供了整个SDK程序包，包括二维码生成的程序包。因此我们完全不需要去官网中再去下载</p>\n<p>第二点就是去官网下载的SDK程序包是需要引用的，如果你的项目是多人开发项目 到时候在《GIt》中推送到远端时所引用的路径是绝对路径，每个人的路径都不一样；因此每次都获取不到引用的内容，每次都需要修改路径，灰常的麻烦~~~；</p>\n<p>（踩坑博主在线踩坑，博主一开始没想到这一点，结果就是因为这一点导致博主连夜加班重构了整个项目，血的教训 ( QAQ ) ）</p>\n</blockquote>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\145e80a648b84f8db5ef2b91f858ffc2.png\"/></p>\n<h5><a id=\"5NeGet_AlipayAopSdkCoreAlipayAopSdkF2F_74\"></a>5、在《NeGet》中 搜索《Alipay.AopSdk.Core》和《Alipay.AopSdk.F2F》这两个由支付宝提供程序包；</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\84310517905f48839b287b8a8d6b5230.png\"/></p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\1e5b1fdf908943e693e3a27459cac887.png\"/></p>\n<h5><a id=\"6QRCoder_82\"></a>6、继续搜索《QRCoder》程序包；</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a95d78b6170440eab133a6334521e7e3.png\"/></p>\n<blockquote>\n<p>这里选择需要引用的项目 进行安装即可；</p>\n<p>然后最重要的一步！！！</p>\n<p>那就是！！！</p>\n<p>《静静的等待安装完成即可》( x_x )</p>\n</blockquote>\n<h3><a id=\"__AliPayHelper__95\"></a>四、封装 类《 AliPayHelper 》；</h3>\n<blockquote>\n<p>可喜可贺！恭喜大家认真的看到这里啦 现在又到最重要的一步啦（ delete --&gt;“又”）；（&gt;.&lt;）</p>\n</blockquote>\n<h5><a id=\"1_99\"></a>1、代码解析；</h5>\n<blockquote>\n<p>我们可以在窗体Form1中直接代码操作，但是为了方便后期的修改，我重新的定义了一个类《 AliPayHelper 》</p>\n<p>这个类用于封装一些请求支付宝网关的参数和 亿点点定义的方法</p>\n</blockquote>\n<pre><code class=\"prism language-csharp\"><span class=\"token comment\">/* 这一大坨纯废话\t不用C\t不想深入了解的同学直接略C下面的代码块 (&gt;.&lt;)\n第一步 在《AliPayHelper》这个类中 引用程序包中提供的一些类\n第二步 定义一个公共参数，其中的参数就是 2_7 中所提到的内容（忘记的拉出去）\n第三步 就是给第二步所定义的公共参数传参\n第四步 写一个支付回调 查看用户支付\n*/</span>\n\n\n<span class=\"token comment\">// V V V 这一坨是第一步</span>\n<span class=\"token comment\">// 引用类</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Threading</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Response</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// V V V 这一坨是第二步</span>\n<span class=\"token comment\">// 公共参数</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">IAopClient</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">DefaultAopClient</span><span class=\"token punctuation\">(</span>AliPayConfigs<span class=\"token punctuation\">.</span>serverUrl<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>appId<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>merchant_private_key<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>sign_type<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>alipay_public_key<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>charset<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// V V V 这一坨是第三步</span>\n<span class=\"token comment\">// 给公共参数传参</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AliPayConfigs</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> alipay_public_key <span class=\"token operator\">=</span> <span class=\"token string\">\"填这里面\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//支付宝公钥</span>\n              \n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> merchant_private_key <span class=\"token operator\">=</span> <span class=\"token string\">\"填这里面\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//商户私钥--应用私钥</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> appId <span class=\"token operator\">=</span> <span class=\"token string\">\"填这里面\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//商户的APPID</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> serverUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"填这里面\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 网关地址</span>\n    \n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> charset <span class=\"token operator\">=</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不用改！</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> sign_type <span class=\"token operator\">=</span> <span class=\"token string\">\"RSA2\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不用改！</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> json <span class=\"token operator\">=</span> <span class=\"token string\">\"json\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不用改！</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> version <span class=\"token operator\">=</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不用改！</span>\n        <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// V V V 这一坨是第四步</span>\n<span class=\"token comment\">// 支付回调</span>\n<span class=\"token comment\">// 博主这里只写了支付成功的情况；</span>\n<span class=\"token comment\">// 例如请求超时，退出支付的情况就需要大家去好好学习啦</span>\n<span class=\"token comment\">// https://opendocs.alipay.com/apis/api_1/alipay.trade.wap.pay 给同学们挂一个API学习链接</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> Text1<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 订单编号 在form1中赋值 没有这个是会报错滴</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">AlipayTradeQueryRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">AlipayTradeQueryRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                request<span class=\"token punctuation\">.</span>BizContent <span class=\"token operator\">=</span> <span class=\"token string\">\"{\"</span> <span class=\"token operator\">+</span>\n                    <span class=\"token string\">\"\\\"out_trade_no\\\":\\\"\"</span> <span class=\"token operator\">+</span> Text1 <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"\"</span> <span class=\"token operator\">+</span>\n                    <span class=\"token string\">\"}\"</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    Thread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 每隔一秒,查询一次 查看是否支付成功</span>\n                    <span class=\"token class-name\">AlipayTradeQueryResponse</span> response <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Execute</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>Code <span class=\"token operator\">==</span> <span class=\"token string\">\"10000\"</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"支付成功！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t <span class=\"token punctuation\">}</span>\n\n</code></pre>\n<h5><a id=\"2_189\"></a>2、完整代码</h5>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Response</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Threading</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">Start_Form</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">AliPayHelper</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> Text1<span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//公共参数</span>\n       <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">IAopClient</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">DefaultAopClient</span><span class=\"token punctuation\">(</span>AliPayConfigs<span class=\"token punctuation\">.</span>serverUrl<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>appId<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>merchant_private_key<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>sign_type<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>alipay_public_key<span class=\"token punctuation\">,</span> AliPayConfigs<span class=\"token punctuation\">.</span>charset<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                                                                                                                                       \n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AliPayConfigs</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> alipay_public_key <span class=\"token operator\">=</span> <span class=\"token string\">\"填这里面\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//支付宝公钥</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> merchant_private_key <span class=\"token operator\">=</span> <span class=\"token string\">\"填这里面\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//商户私钥--应用私钥</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> appId <span class=\"token operator\">=</span> <span class=\"token string\">\"填这里面\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//商户的APPID</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> serverUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"填这里面\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 网关地址</span>\n    \n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> charset <span class=\"token operator\">=</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不用改！</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> sign_type <span class=\"token operator\">=</span> <span class=\"token string\">\"RSA2\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不用改！</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> json <span class=\"token operator\">=</span> <span class=\"token string\">\"json\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不用改！</span>\n\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> version <span class=\"token operator\">=</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 不用改！</span>\n        <span class=\"token punctuation\">}</span>\n        \n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> Text1<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">AlipayTradeQueryRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">AlipayTradeQueryRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                request<span class=\"token punctuation\">.</span>BizContent <span class=\"token operator\">=</span> <span class=\"token string\">\"{\"</span> <span class=\"token operator\">+</span>\n                    <span class=\"token string\">\"\\\"out_trade_no\\\":\\\"\"</span> <span class=\"token operator\">+</span> Text1 <span class=\"token operator\">+</span> <span class=\"token string\">\"\\\"\"</span> <span class=\"token operator\">+</span>\n                    <span class=\"token string\">\"}\"</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    Thread<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token class-name\">AlipayTradeQueryResponse</span> response <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">Execute</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>Code <span class=\"token operator\">==</span> <span class=\"token string\">\"10000\"</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"支付成功！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h5><a id=\"Form1_253\"></a>五、Form1窗口事件生成</h5>\n<h5><a id=\"1_255\"></a>1、定义一个生成二维码的方法</h5>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">AliPayCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\">AlipayTradeWapPayRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">AlipayTradeWapPayRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">AlipayTradeAppPayModel</span> aliPayRequest <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">AlipayTradeAppPayModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//这个类内容在最下面</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                OutTradeNo <span class=\"token operator\">=</span> textBox1<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span><span class=\"token comment\">// 订单号号,商户订单号（注：订单号要唯一）</span>\n                TotalAmount <span class=\"token operator\">=</span>  textBox1<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span><span class=\"token comment\">//订单金额</span>\n                Subject <span class=\"token operator\">=</span> <span class=\"token string\">\"随便写\"</span><span class=\"token comment\">//标题</span>\n                Body <span class=\"token operator\">=</span> <span class=\"token string\">\"随便写\"</span><span class=\"token punctuation\">,</span>\n                ProductCode <span class=\"token operator\">=</span> <span class=\"token string\">\"QUICK_MSECURITY_PAY\"</span><span class=\"token punctuation\">,</span>\n\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            request<span class=\"token punctuation\">.</span><span class=\"token function\">SetBizModel</span><span class=\"token punctuation\">(</span>aliPayRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">AlipayTradeWapPayResponse</span> response <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">SdkExecute</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>IsError <span class=\"token operator\">==</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"唤起支付宝二维码失败，请联系开发人员\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> payaddress <span class=\"token operator\">=</span> AliPayConfigs<span class=\"token punctuation\">.</span>serverUrl <span class=\"token operator\">+</span> <span class=\"token string\">\"?\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">QRCodeGenerator</span> qrGenerator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">QRCoder<span class=\"token punctuation\">.</span>QRCodeGenerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">QRCodeData</span> qrCodeData <span class=\"token operator\">=</span> qrGenerator<span class=\"token punctuation\">.</span><span class=\"token function\">CreateQrCode</span><span class=\"token punctuation\">(</span>payaddress<span class=\"token punctuation\">,</span> QRCodeGenerator<span class=\"token punctuation\">.</span>ECCLevel<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">QRCode</span> qrcode <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">QRCode</span><span class=\"token punctuation\">(</span>qrCodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                pictureBox1<span class=\"token punctuation\">.</span>Image <span class=\"token operator\">=</span> qrcode<span class=\"token punctuation\">.</span><span class=\"token function\">GetGraphic</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> Color<span class=\"token punctuation\">.</span>Black<span class=\"token punctuation\">,</span> Color<span class=\"token punctuation\">.</span>White<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">//将字符串生成二维码图片</span>\n                <span class=\"token comment\">//pictureBox1的SizeMode属性设为：Zoom表示图片填充</span>\n            <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">}</span>\n</code></pre>\n<h5><a id=\"2_294\"></a>2、完整代码</h5>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>ComponentModel</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Data</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Drawing</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Linq</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Threading<span class=\"token punctuation\">.</span>Tasks</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Domain</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Alipay<span class=\"token punctuation\">.</span>AopSdk<span class=\"token punctuation\">.</span>Core<span class=\"token punctuation\">.</span>Response</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">QRCoder</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">WindowsFormsApp1<span class=\"token punctuation\">.</span>AliPayHelper</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">WindowsFormsApp1</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">partial</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Form1</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Form</span></span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">Form1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">InitializeComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">button1_Click</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            AliPayHelper<span class=\"token punctuation\">.</span>Text1 <span class=\"token operator\">=</span> textBox1<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 获取订单编号 传给Query 否则报错</span>\n            <span class=\"token function\">AlipayCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 生成二维码</span>\n            <span class=\"token function\">Query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 支付回调</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">AliPayCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\">AlipayTradeWapPayRequest</span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">AlipayTradeWapPayRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">AlipayTradeAppPayModel</span> aliPayRequest <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">AlipayTradeAppPayModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//这个类内容在最下面</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                OutTradeNo <span class=\"token operator\">=</span> textBox1<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span><span class=\"token comment\">// 订单号号,商户订单号（注：订单号要唯一）</span>\n                TotalAmount <span class=\"token operator\">=</span> textBox2<span class=\"token punctuation\">.</span>Text<span class=\"token punctuation\">,</span><span class=\"token comment\">//订单金额</span>\n                Subject <span class=\"token operator\">=</span> <span class=\"token string\">\"随便填\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//标题</span>\n                Body <span class=\"token operator\">=</span> <span class=\"token string\">\"随便填\"</span><span class=\"token punctuation\">,</span>\n                ProductCode <span class=\"token operator\">=</span> <span class=\"token string\">\"QUICK_MSECURITY_PAY\"</span><span class=\"token punctuation\">,</span>\n\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            request<span class=\"token punctuation\">.</span><span class=\"token function\">SetBizModel</span><span class=\"token punctuation\">(</span>aliPayRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">AlipayTradeWapPayResponse</span> response <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">SdkExecute</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>IsError <span class=\"token operator\">==</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"唤起支付宝二维码失败，请联系开发人员\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> payaddress <span class=\"token operator\">=</span> AliPayConfigs<span class=\"token punctuation\">.</span>serverUrl <span class=\"token operator\">+</span> <span class=\"token string\">\"?\"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">QRCodeGenerator</span> qrGenerator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">QRCoder<span class=\"token punctuation\">.</span>QRCodeGenerator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">QRCodeData</span> qrCodeData <span class=\"token operator\">=</span> qrGenerator<span class=\"token punctuation\">.</span><span class=\"token function\">CreateQrCode</span><span class=\"token punctuation\">(</span>payaddress<span class=\"token punctuation\">,</span> QRCodeGenerator<span class=\"token punctuation\">.</span>ECCLevel<span class=\"token punctuation\">.</span>L<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">QRCode</span> qrcode <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">QRCode</span><span class=\"token punctuation\">(</span>qrCodeData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                pictureBox1<span class=\"token punctuation\">.</span>Image <span class=\"token operator\">=</span> qrcode<span class=\"token punctuation\">.</span><span class=\"token function\">GetGraphic</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> Color<span class=\"token punctuation\">.</span>Black<span class=\"token punctuation\">,</span> Color<span class=\"token punctuation\">.</span>White<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">15</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">//将字符串生成二维码图片</span>\n                <span class=\"token comment\">//pictureBox1的SizeMode属性设为：Zoom表示图片填充</span>\n            <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<h1><a id=\"_365\"></a>六、功能测试</h1>\n<h5><a id=\"1_367\"></a>1、全部的代码编写就已经完成了，接下来就是功能测试</h5>\n<h5><a id=\"2____369\"></a>2、我们回到支付宝开放平台控制台中 找到 《沙箱工具 》下载《支付宝客户端沙箱版》</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\de64a6a744a44406bdd1a2aba52e5793.png\"/></p>\n<h5><a id=\"3____374\"></a>3、下载安装完成后 再找到控制台中《沙箱账户》这里会提供测试时使用的商家账号 和 买家账号</h5>\n<h5><a id=\"4____376\"></a>4、最后使用邮箱登录 填写买家账户和密码 登录 最后运行程序</h5>\n<h5><a id=\"5_378\"></a>5、最后打开沙箱版支付宝扫码付款就可以了</h5>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\0e1fb0e81ee24a8f98c9774612c1e5d6.png\"/></p>\n<p>最后的测试也没问题，可能每个人还会碰到一些其他的问题 慢慢来吧</p>\n<p>本次喂饭式学习就结束了！记得点赞！ (&gt;.&lt;)</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Java", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 1, "sql": 0, "php": 0, "time": "2022-06-10 14:38:11", "summary": "窗体项目实现支付宝扫码支付一、内容介绍啪嗒搬好小板凳大家好，本次学习的内容是在博主大一窗体项目中实现的一个功能支付宝扫码支付；主要功能通过支付宝包向我们提供的程序包，与支付宝沙箱中的验证调试接口功能实"}