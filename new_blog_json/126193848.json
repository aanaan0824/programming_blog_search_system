{"blogid": "126193848", "writerAge": "码龄9年", "writerBlogNum": "34", "writerCollect": "66", "writerComment": "25", "writerFan": "626", "writerGrade": "3级", "writerIntegral": "535", "writerName": "11eleven", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126193848.jpg", "writerRankTotal": "33259", "writerRankWeekly": "4491", "writerThumb": "28", "writerVisitNum": "22517", "blog_read_count": "1189", "blog_time": "已于 2022-08-15 16:44:25 修改", "blog_title": "C#调用bartender进行动态打印以及批量打印的完整教程", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>信息化过程中难免接触到标签打印机，bartender是一款功能齐全的设计打印软件，可以设计标签模板内容，手动打印或者对接程序进行动态打印。应网友要求，出一个较为详细的教程。</p>\n<p>一、bartender软件安装</p>\n<p>        这个就不用多说了，自行网上下载安装，建议专业版或者企业版。</p>\n<p>二、标签模板设计</p>\n<p>        1.单个打印模板设计：</p>\n<p>标签内容的动态值key设置，这个是我们动态调用时需要对应的。如图。这里我定义了一个二维码和一个文本为例。</p>\n<p></p>\n<p><img alt=\"\" height=\"646\" src=\"..\\..\\static\\image\\16fee0ba8a63481db5ae2bb4ec5d9a7a.png\" width=\"1061\"/></p>\n<p></p>\n<p>先来设定单个打印的模板，这里设置数据源的名称就是单个打印的动态key了，后面在打印的时候会用到。</p>\n<p>2.批量打印模板设计</p>\n<p>批量打印的话这里以文本数据的模式为例因为比较简单。如图先设置数据库数据源</p>\n<p>根据向导下一步选择</p>\n<p><img alt=\"\" height=\"811\" src=\"..\\..\\static\\image\\655211fc335d4bd68bcfddf15c418f00.png\" width=\"1200\"/></p>\n<p></p>\n<p>文本文件。</p>\n<p><img alt=\"\" height=\"789\" src=\"..\\..\\static\\image\\92e6975da61d4499bd4dd539ba607e2f.png\" width=\"1058\"/></p>\n<p>编码注意选择UTF8不然中文会乱码。</p>\n<p><img alt=\"\" height=\"234\" src=\"..\\..\\static\\image\\b229499475c1494ab35d92e85a6010f6.png\" width=\"547\"/></p>\n<p>文本文件内容如图，两列，列用引号框起来，多列逗号分割。</p>\n<p> <img alt=\"\" height=\"461\" src=\"..\\..\\static\\image\\521dcacf05f2476a97f08c0f622c427d.png\" width=\"702\"/></p>\n<p> <img alt=\"\" height=\"566\" src=\"..\\..\\static\\image\\ef70181e7264451089d5e60b22541c31.png\" width=\"1014\"/></p>\n<p></p>\n<p>勾选第一行是列标题。完成后确定就可以刷新字段名。</p>\n<p><img alt=\"\" height=\"531\" src=\"..\\..\\static\\image\\5e13b24059d346f99e7f559ef2fde7ed.png\" width=\"780\"/></p>\n<p> 下一步就是关联我们的模板中对应组件。</p>\n<p><img alt=\"\" height=\"640\" src=\"..\\..\\static\\image\\88825346389a44ea96503674338bdc99.png\" width=\"1038\"/></p>\n<p>选择我们的数据库字段，进行字段的关联如图。</p>\n<p><img alt=\"\" height=\"611\" src=\"..\\..\\static\\image\\509a00806fa44e8bb042a05c08363c4d.png\" width=\"1080\"/></p>\n<p> 另一个字段数量也是一样。</p>\n<p><img alt=\"\" height=\"647\" src=\"..\\..\\static\\image\\2b5d2d7adc104865b4839984340cbf6a.png\" width=\"1140\"/></p>\n<p><img alt=\"\" height=\"593\" src=\"..\\..\\static\\image\\6c5faa3fc79d4908a93ed8d53c0a169a.png\" width=\"1155\"/></p>\n<p>到这里批量打印的模板就设计好了。</p>\n<p> 我这里的版本是bartender10.1</p>\n<p></p>\n<p>三、动态库引入</p>\n<p>来到visualStudio中进行动态库引入。右键添加引入DLL。</p>\n<p><img alt=\"\" height=\"676\" src=\"..\\..\\static\\image\\2e9ce340ea9f435eb0207b0ae3558498.png\" width=\"1200\"/></p>\n<p></p>\n<p>四、使用封装好的打印方法，打印测试。</p>\n<p></p>\n<p><img alt=\"\" height=\"614\" src=\"..\\..\\static\\image\\012cc1e831464003bb1b3bc8fde7512a.png\" width=\"1170\"/></p>\n<p>我们改成PDF打印输出来看看效果。</p>\n<p></p>\n<p></p>\n<p>调用稍微有点耗时，不过问题不大。</p>\n<p>批量打印的效果如下。</p>\n<p><img alt=\"\" height=\"882\" src=\"..\\..\\static\\image\\e3f803dbc2b8470695e02ebce23a33d9.png\" width=\"1157\"/></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p> /// &lt;summary&gt;<br/>         /// 单个打印<br/>         /// &lt;/summary&gt;<br/>         /// &lt;param name=\"sender\"&gt;&lt;/param&gt;<br/>         /// &lt;param name=\"e\"&gt;&lt;/param&gt;<br/>         private void BtnSinglePrint_Click(object sender, EventArgs e)<br/>         {<!-- --><br/>             BartenderHelper bartenderHelper = new BartenderHelper();<br/>             string printMsg = \"\";// 打印结果消息<br/>             Dictionary&lt;string, string&gt; data = new Dictionary&lt;string, string&gt;(); //打印内容<br/>             var dataArray = TxtSingleContent.Text.Split(\",\");<br/>             if (dataArray.Length &lt; 1) {<!-- --><br/>                 MessageBox.Show(\"fail:格式不对\");<br/>                 return;<br/>             }<br/>             // 组装内容<br/>             data.Add(\"Code\",dataArray[0]);<br/>             data.Add(\"Qty\", dataArray[1]);<br/>             string bartenderFilePath =$@\"{Environment.CurrentDirectory}//模板//test.btw\";//模板路径<br/>             var isOk = bartenderHelper.BTPrint(bartenderFilePath, data, out printMsg);<br/>             if (!isOk) {<!-- --><br/>                 MessageBox.Show(\"fail:\"+printMsg);<br/>             }<br/>         }</p>\n<p>        /// &lt;summary&gt;<br/>         /// 批量打印<br/>         /// &lt;/summary&gt;<br/>         /// &lt;param name=\"sender\"&gt;&lt;/param&gt;<br/>         /// &lt;param name=\"e\"&gt;&lt;/param&gt;<br/>         private void BtnBatchPrint_Click(object sender, EventArgs e)<br/>         {<!-- --><br/>             BartenderHelper bartenderHelper = new BartenderHelper();<br/>             var lines = TxtBatchContent.Lines;<br/>             if (lines.Count() &lt; 1) {<!-- --><br/>                 MessageBox.Show(\"fail:数据内容不对\" );<br/>                 return;<br/>             }<br/>             // 生成文本数据<br/>             string fileName = $@\"printData_{Guid.NewGuid()}\";// 文件名<br/>             List&lt;string&gt; dataList = new List&lt;string&gt;();<br/>             string title = \"\\\"Code\\\",\\\"Qty\\\"\"; //列名<br/>             dataList.Add(title);<br/>             for (int i = 0; i &lt; lines.Count(); i++) {<!-- --><br/>                 var lineArr = lines[i].Split(',');<br/>                 if (lineArr.Count() &lt; 1)<br/>                 {<!-- --><br/>                     MessageBox.Show(\"fail:数据内容不对\");<br/>                     return;<br/>                 }<br/>                 dataList.Add($\"\\\"{lineArr[0]}\\\",\\\"{lineArr[1]}\\\"\");<br/>             }<br/>             fileName = WriteLog(dataList,\"printData\", fileName);</p>\n<p>            string bartenderFilePath = $@\"{Environment.CurrentDirectory}//模板//batchTest.btw\";//模板路径<br/>             var isOk = bartenderHelper.BTPrintByDataBase(bartenderFilePath, fileName);<br/>             if (!isOk)<br/>             {<!-- --><br/>                 MessageBox.Show(\"fail:\");<br/>             }<br/>         }</p>\n<p>五、简单源码开放</p>\n<p>遇到打印有问题的话，最好管理员权限运行，bartender的打印需要管理员权限。</p>\n<p><a class=\"link-info\" href=\"https://download.csdn.net/download/u011540323/86339422\" title=\"bartender使用完整案例\">bartender使用完整案例</a></p>\n</div>\n</div>", "first_tag": "C#", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-08-15 16:44:25", "summary": "信息化过程中难免接触到标签打印机，是一款功能齐全的设计打印软件，可以设计标签模板内容，手动打印或者对接程序进行动态打印。应网友要求，出一个较为详细的教程。一、软件安装这个就不用多说了，自行网上下载安装"}