{"blogid": "126684360", "writerAge": "码龄3年", "writerBlogNum": "43", "writerCollect": "214", "writerComment": "250", "writerFan": "258", "writerGrade": "4级", "writerIntegral": "1178", "writerName": "乔伊波伊 o(*^＠^*)o", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126684360.jpg", "writerRankTotal": "16589", "writerRankWeekly": "299", "writerThumb": "269", "writerVisitNum": "6996", "blog_read_count": "174", "blog_time": "已于 2022-09-05 14:47:41 修改", "blog_title": "Qt5开发从入门到精通——第四篇十二节（不规则窗体）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p>欢迎小伙伴的点评✨✨，相互学习、互关必回、全天在线🍳🍳🍳<br/> 博主🧑🧑 本着开源的精神交流Qt开发的经验、将持续更新续章，为社区贡献博主自身的开源精神👩‍🚀</p>\n</blockquote>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#_8\">前言</a></li><li><a href=\"#_15\">一、不规则窗体概述</a></li><li><a href=\"#_19\">二、效果实例</a></li><li><a href=\"#_24\">三、原码详解</a></li><li><ul><li><a href=\"#widgeth_25\">widget.h</a></li><li><a href=\"#maincpp_51\">main.cpp</a></li><li><a href=\"#widgetcpp_67\">widget.cpp</a></li></ul>\n</li><li><a href=\"#_136\">四、总结</a></li></ul>\n</div>\n<p></p>\n<hr/>\n<h1><a id=\"_8\"></a>前言</h1>\n<p><font size=\"4\">本章节将会给大家带来不规则窗体的详细使用方法</font></p>\n<hr/>\n<h1><a id=\"_15\"></a>一、不规则窗体概述</h1>\n<p><font size=\"4\">常见的窗体通常是各种方形的对话框，但有时也需要使用非方形的窗体，如圆形、椭圆形，甚至是不规则形状的对话框。<br/> 利用 setMaskO函数为窗体设置遮罩，实现不规则窗体。设置遮罩后的窗体尺寸仍是原窗体大小，只是被遮罩的地方不可见。</font></p>\n<h1><a id=\"_19\"></a>二、效果实例</h1>\n<p><font size=\"4\"><strong>图一</strong><br/> <font size=\"4\">新建Resources 并添加图片即可（图片格式改为xxx.png）<br/> <img alt=\"在这里插入图片描述\" src=\"https://img-blog.csdnimg.cn/8fd2b99cd22c46739f0b79172f75bbc4.gif#pic_center\"/></font></font></p>\n<h1><a id=\"_24\"></a>三、原码详解</h1>\n<h2><a id=\"widgeth_25\"></a>widget.h</h2>\n<pre><code class=\"prism language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">WIDGET_H</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">WIDGET_H</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;QWidget&gt;</span></span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Widget</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">QWidget</span></span>\n<span class=\"token punctuation\">{<!-- --></span>\n    Q_OBJECT\n\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">Widget</span><span class=\"token punctuation\">(</span>QWidget <span class=\"token operator\">*</span>parent <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">~</span><span class=\"token function\">Widget</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">protected</span><span class=\"token operator\">:</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">mousePressEvent</span><span class=\"token punctuation\">(</span>QMouseEvent <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">mouseMoveEvent</span><span class=\"token punctuation\">(</span>QMouseEvent <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">paintEvent</span><span class=\"token punctuation\">(</span>QPaintEvent <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\nQPoint dragPosition<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">// WIDGET_H</span></span>\n\n</code></pre>\n<h2><a id=\"maincpp_51\"></a>main.cpp</h2>\n<pre><code class=\"prism language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"widget.h\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;QApplication&gt;</span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    QApplication <span class=\"token function\">a</span><span class=\"token punctuation\">(</span>argc<span class=\"token punctuation\">,</span> argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Widget w<span class=\"token punctuation\">;</span>\n    w<span class=\"token punctuation\">.</span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> a<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<h2><a id=\"widgetcpp_67\"></a>widget.cpp</h2>\n<pre><code class=\"prism language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"widget.h\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;QMouseEvent&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;QPainter&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;QPixmap&gt;</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;QBitmap&gt;</span></span>\n<span class=\"token class-name\">Widget</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Widget</span><span class=\"token punctuation\">(</span>QWidget <span class=\"token operator\">*</span>parent<span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">:</span> <span class=\"token function\">QWidget</span><span class=\"token punctuation\">(</span>parent<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    QPixmap pix<span class=\"token punctuation\">;</span>  <span class=\"token comment\">///新建一个 QPixmap 对象</span>\n    pix<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":/sr/16.png\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>Qt<span class=\"token double-colon punctuation\">::</span>AvoidDither<span class=\"token operator\">|</span>Qt<span class=\"token double-colon punctuation\">::</span>ThresholdDither<span class=\"token operator\">|</span>Qt<span class=\"token double-colon punctuation\">::</span>ThresholdAlphaDither<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//(a)</span>\n    <span class=\"token function\">resize</span><span class=\"token punctuation\">(</span>pix<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//(b)</span>\n    <span class=\"token function\">setMask</span><span class=\"token punctuation\">(</span><span class=\"token function\">QBitmap</span><span class=\"token punctuation\">(</span>pix<span class=\"token punctuation\">.</span><span class=\"token function\">mask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//(c)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token class-name\">Widget</span><span class=\"token double-colon punctuation\">::</span><span class=\"token operator\">~</span><span class=\"token function\">Widget</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">Widget</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">mousePressEvent</span><span class=\"token punctuation\">(</span>QMouseEvent <span class=\"token operator\">*</span>event<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">-&gt;</span><span class=\"token function\">button</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span>Qt<span class=\"token double-colon punctuation\">::</span>LeftButton<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        dragPosition <span class=\"token operator\">=</span>event<span class=\"token operator\">-&gt;</span><span class=\"token function\">globalPos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token function\">frameGeometry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">topLeft</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        event<span class=\"token operator\">-&gt;</span><span class=\"token function\">accept</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">-&gt;</span><span class=\"token function\">button</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span>Qt<span class=\"token double-colon punctuation\">::</span>RightButton<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">Widget</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">mouseMoveEvent</span><span class=\"token punctuation\">(</span>QMouseEvent <span class=\"token operator\">*</span>event<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">-&gt;</span><span class=\"token function\">buttons</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;</span>Qt<span class=\"token double-colon punctuation\">::</span>LeftButton<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token function\">move</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">-&gt;</span><span class=\"token function\">globalPos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span>dragPosition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        event<span class=\"token operator\">-&gt;</span><span class=\"token function\">accept</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">Widget</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">paintEvent</span><span class=\"token punctuation\">(</span>QPaintEvent <span class=\"token operator\">*</span>event<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    QPainter <span class=\"token function\">painter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    painter<span class=\"token punctuation\">.</span><span class=\"token function\">drawPixmap</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token function\">QPixmap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":/sr/16.png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<p><font size=\"4\">其中，<br/> （a）pix.load(“:/sr/16.png”,0,Qt::AvoidDither|Qt::ThresholdDither|Qt::ThresholdAlphaDither)：调用 QPixmap 的 load()函数为 QPixmap 对象填入图像值。<br/> load() 函数的原型如下：</font></p>\n<pre><code class=\"prism language-bash\">bool QPixmap::load <span class=\"token punctuation\">(</span>const QString <span class=\"token operator\">&amp;</span> fileName, const char* <span class=\"token assign-left variable\">format</span><span class=\"token operator\">=</span> <span class=\"token number\">0</span>, Qt::ImageConversionFlags <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span> Qt::AutoColor<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><font size=\"4\">其中，参数 fileName 为图片文件名；参数 format 表示读取图片文件采用的格式，此处为 0表示采用默认的格式；参数 flags 表示读取图片的方式，由 Qt: :ImageConversionFlags 定义，此处设置的标识为避免图片抖动方式。</font></p>\n<p><font size=\"4\">（b） resize(pix.size())：重设主窗体的尺寸为所读取的图片的大小。</font></p>\n<p><font size=\"4\">（c）setMask(QBitmap(pix.mask()))：为调用它的控件增加一个遮罩，遮住所选区域以外的部分使其看起来是透明的，它的参数可为一个 QBitmap 对象或一个 QRegion 对象，此处调用QPixmap 的 mask() 函数用千获得图片自身的遮罩，为一个 QBitmap 对象，实例中使用的是 PNG格式的图片，它的透明部分实际上是一个遮罩。<br/> 使不规则窗体能够响应鼠标事件、随意拖曳的函数，是重定义的鼠标按下响应函数mousePressEvent(QMouseEvent *), 首先判断按下的是否为鼠标左键 。 若是，则保存当前鼠标点所在的位置相对于窗体左上角的偏移值 dragPosition: 若按下的是鼠标右键，则关闭窗体。</font></p>\n<p><font size=\"4\">鼠标移动响应函数 mouseMoveEvent(QMouseEvent*), 首先判断当前鼠标状态，调用 event-&gt;buttons()返回鼠标的状态，若为左键则调用 QWidget 的 move() 函数将窗体移动至鼠标当前点。由于move()函数的参数指的是窗体的左上角的位置，因此要使用鼠标当前点的位置减去相对窗体左上角的偏移值 dragPosition。</font></p>\n<hr/>\n<h1><a id=\"_136\"></a>四、总结</h1>\n<p><font size=\"4\">不规则窗体会在应用程序开发中经常用到的</font></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-05 14:47:41", "summary": "欢迎小伙伴的点评，相互学习、互关必回、全天在线博主本着开源的精神交流开发的经验、将持续更新续章，为社区贡献博主自身的开源精神文章目录前言一、不规则窗体概述二、效果实例三、原码详解四、总结前言本章节将会"}