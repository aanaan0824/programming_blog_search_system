{"blogid": "123007198", "writerAge": "码龄5年", "writerBlogNum": "26", "writerCollect": "423", "writerComment": "14", "writerFan": "40", "writerGrade": "3级", "writerIntegral": "649", "writerName": "T_just_for_tomorrow", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123007198.jpg", "writerRankTotal": "41262", "writerRankWeekly": "88567", "writerThumb": "69", "writerVisitNum": "61200", "blog_read_count": "1643", "blog_time": "于 2022-02-18 17:31:42 发布", "blog_title": "C#---S7.Net编写PLC通讯（从资源安装到功能实现）附代码", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>在电脑实现C#控制PLC最好安装虚拟软件进行模拟，简单且方便，那么接下来让我们一步步来</p>\n<p>1.首先准备好材料，一共需要三个软件分别为：SIMATIC_PLCSIM_Advanced_V3.exe、TIA_Portal_STEP7_Prof_Safety_WINCC_Adv_Unified_V16.exe和po解的EKB</p>\n<p>这篇主要是编写如何完成，安装部分简单说明一下；</p>\n<p><img alt=\"\" height=\"661\" src=\"..\\..\\static\\image\\2c463262043e4250b4f050e2560e4011.png\" width=\"854\"/></p>\n<p>这个无脑安装即可，一路下一步就行</p>\n<p><img alt=\"\" height=\"653\" src=\"..\\..\\static\\image\\bd6b2bc170bd4a1f89df7f52bca8e15c.png\" width=\"827\"/></p>\n<p>这个也同样无脑安装</p>\n<p>安装完成之后需要进行连接，有的可能会出现提示，<span style=\"color:#fe2c24;\"><strong>显示需要连接net start npf，</strong></span><strong>那么这个可能是因为没有WinPcap，给出资源链接：https://pan.baidu.com/s/1EPyb3diTJ2Ymdn0GFBcbfA <br/> 提取码：2mzv，<span style=\"color:#fe2c24;\">打开安装就可以用</span>，安装完成之后需要管理员权限启动cmd，输入</strong><span style=\"color:#fe2c24;\"><strong>net start npf这个命令</strong></span><strong>，就可以解决了</strong></p>\n<p>2.安装和连接完成之后先输入一些数据</p>\n<p>先建一个db数据块</p>\n<p><img alt=\"\" height=\"29\" src=\"..\\..\\static\\image\\203584f9b1024b01977a38050209804a.png\" width=\"380\"/></p>\n<p>输入一些数据</p>\n<p><img alt=\"\" height=\"271\" src=\"..\\..\\static\\image\\1a03327af1d047edad30dbd854a7352a.png\" width=\"1087\"/> 3.对命令的解释</p>\n<p>要明白这些都应该怎么用，首先是db的名字DB109之后是根据数据类型进行分类，不同的数据类型，后面跟着的是不一样的，其中DBW是字，DBX是位，DBD是双字，这个要明确，比如int就是</p>\n<p> DBW，后面就是偏移量，那么连起来就是DB109.DBW.0.0</p>\n<p>4.对程序的实现</p>\n<p>首先是连接：</p>\n<pre><code class=\"language-cs\">public void open()\n        {\n            CpuType cpu = (CpuType)(Enum.Parse(typeof(CpuType), comboBox1.Text, true));\n            plc = new Plc(cpu, textBox1.Text, 0, 1);\n            try\n            {\n                plc.Open();\n                link = true;\n                timer1.Enabled = true;\n                button1.Text = \"关闭\";\n                button1.ForeColor = Color.Green;\n            }\n            catch(Exception)\n            {\n                Console.WriteLine($\"连接到PLC设备失败：IsConnect = {plc.IsConnected}\");\n                return;\n            }\n\n        }</code></pre>\n<p>再是关闭：</p>\n<pre><code class=\"language-cs\">public void close()\n        {\n            try\n            {\n                plc.Close();\n                link = false;\n                timer1.Enabled = false;\n                button1.Text = \"打开\";\n                button1.ForeColor = Color.Red;\n            }\n            catch\n            {\n\n            }\n        }</code></pre>\n<p>再是读：</p>\n<p>使用plc.Read函数</p>\n<pre><code class=\"language-cs\">public void Read(string variable)\n        {\n            if (link == false)\n            {\n                Console.WriteLine(\"未连接，状态：\",plc.IsConnected);\n            }\n            else\n            {\n                try\n                {\n                    string[] arr = (comboBox2.Text.ToUpper()).Split('.');\n                    string val = arr[1].Substring(0, 3);\n                    Console.WriteLine(val);\n                    if (val == \"DBX\")\n                    {\n                        bool text1 = (bool)plc.Read(comboBox2.Text.ToUpper());\n                        bt = text1;\n                        Console.WriteLine(\"读取数据为:\" + text1);\n                    }\n                    else if (val == \"DBW\") {\n                        int text2 = (ushort)plc.Read(comboBox2.Text.ToUpper());\n                        Console.WriteLine(\"读取数据为:\" + text2);\n                    }\n                    else if(val == \"DBD\")\n                    {\n                        var text3 = (uint)plc.Read(comboBox2.Text.ToUpper());\n                        Console.WriteLine(\"读取数据为:\" + text3);\n                    }\n                }\n                catch\n                {\n\n                }\n            }\n        }</code></pre>\n<p> 最后是写：</p>\n<pre><code class=\"language-cs\">public void write()\n        {\n            string nm = textBox2.Text;\n            string mm = comboBox2.Text;\n            string[] var = (comboBox2.Text.ToUpper()).Split('.');\n            string val1 = var[1].Substring(0, 3);\n            if (val1 == \"DBW\")\n            {\n                plc.Write(mm, Convert.ToInt16(nm));\n                Console.Write(\"写入数据为：\" + nm);\n            }\n            else if (val1 == \"DBD\")\n            {\n                plc.Write(mm, Convert.ToInt32 (nm));\n                Console.Write(\"写入数据为：\" + nm);\n            }\n        }</code></pre>\n<p>按照我的写法基本应该没问题，如果有任何疑问可与我沟通</p>\n<p>特别的，如果有朋友实现或者安装上有问题可以咨询我哈</p>\n</div>\n</div>", "first_tag": "C#", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-02-18 17:31:42", "summary": "在电脑实现控制最好安装虚拟软件进行模拟，简单且方便，那么接下来让我们一步步来首先准备好材料，一共需要三个软件分别为：、和解的这篇主要是编写如何完成，安装部分简单说明一下；这个无脑安装即可，一路下一步就"}