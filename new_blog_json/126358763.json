{"blogid": "126358763", "writerAge": "ç é¾„98å¤©", "writerBlogNum": "174", "writerCollect": "2274", "writerComment": "178", "writerFan": "759", "writerGrade": "5çº§", "writerIntegral": "2985", "writerName": "Mdc_stdio", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126358763.jpg", "writerRankTotal": "5961", "writerRankWeekly": "245", "writerThumb": "1071", "writerVisitNum": "142949", "blog_read_count": "9302", "blog_time": "äºÂ 2022-08-16 09:14:30Â å‘å¸ƒ", "blog_title": "ã€æ¯•ä¸šè®¾è®¡ã€‘stm32æœºå™¨è§†è§‰çš„äººè„¸è¯†åˆ«ç³»ç»Ÿ - å•ç‰‡æœº ç‰©è”ç½‘ åµŒå…¥å¼", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>æ–‡ç« ç›®å½•</h3>\n<ul><li><a href=\"#0__5\">0 å‰è¨€</a></li><li><a href=\"#1__27\">1 ç®€ä»‹</a></li><li><a href=\"#2__31\">2 ä¸»è¦å™¨ä»¶</a></li><li><a href=\"#3__41\">3 å®ç°æ•ˆæœ</a></li><li><a href=\"#4__48\">4 è®¾è®¡åŸç†</a></li><li><ul><li><a href=\"#K210_50\">K210å®ç°äººè„¸è¯†åˆ«</a></li></ul>\n</li><li><a href=\"#5__74\">5 éƒ¨åˆ†æ ¸å¿ƒä»£ç </a></li><li><a href=\"#6__369\">6 æœ€å</a></li></ul>\n</div>\n<p></p>\n<hr color=\"#000000\" size='1\"'/>\n<h1><a id=\"0__5\"></a>0 å‰è¨€</h1>\n<p>ğŸ”¥ è¿™ä¸¤å¹´å¼€å§‹æ¯•ä¸šè®¾è®¡å’Œæ¯•ä¸šç­”è¾©çš„è¦æ±‚å’Œéš¾åº¦ä¸æ–­æå‡ï¼Œä¼ ç»Ÿçš„æ¯•è®¾é¢˜ç›®ç¼ºå°‘åˆ›æ–°å’Œäº®ç‚¹ï¼Œå¾€å¾€è¾¾ä¸åˆ°æ¯•ä¸šç­”è¾©çš„è¦æ±‚ï¼Œè¿™ä¸¤å¹´ä¸æ–­æœ‰å­¦å¼Ÿå­¦å¦¹å‘Šè¯‰å­¦é•¿è‡ªå·±åšçš„é¡¹ç›®ç³»ç»Ÿè¾¾ä¸åˆ°è€å¸ˆçš„è¦æ±‚ã€‚</p>\n<p>ä¸ºäº†å¤§å®¶èƒ½å¤Ÿé¡ºåˆ©ä»¥åŠæœ€å°‘çš„ç²¾åŠ›é€šè¿‡æ¯•è®¾ï¼Œå­¦é•¿åˆ†äº«ä¼˜è´¨æ¯•ä¸šè®¾è®¡é¡¹ç›®ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯</p>\n<p>ğŸš© <strong>åŸºäºstm32æœºå™¨è§†è§‰çš„äººè„¸è¯†åˆ«ç³»ç»Ÿ</strong></p>\n<p>ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)</p>\n<ul><li>éš¾åº¦ç³»æ•°ï¼š4åˆ†</li><li>å·¥ä½œé‡ï¼š4åˆ†</li><li>åˆ›æ–°ç‚¹ï¼š3åˆ†</li></ul>\n<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p>\n<p><a href=\"https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md\">https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md</a></p>\n<br/>\n<h1><a id=\"1__27\"></a>1 ç®€ä»‹</h1>\n<p>æœ¬ç³»ç»Ÿæ˜¯ç”±stm32f103c8t6å•ç‰‡æœºæœ€å°ç³»ç»Ÿç”µè·¯+k210äººè„¸è¯†åˆ«æ¨¡å—å®ç°çš„äººè„¸æ™ºèƒ½é—¨ç¦ç³»ç»Ÿï¼Œå¯å®ç°äººè„¸å½•å…¥ï¼Œäººè„¸è¯†åˆ«ç­‰åŠŸèƒ½ã€‚</p>\n<h1><a id=\"2__31\"></a>2 ä¸»è¦å™¨ä»¶</h1>\n<ul><li>STM32F103C8T6</li><li>K210äººè„¸è¯†åˆ«ç”µè·¯</li><li>è¯­éŸ³æ’­æŠ¥ç”µè·¯</li><li>è‡ªåŠ¨å¼€å…³é—¨ç”µè·¯(èˆµæœºé©±åŠ¨)</li><li>oledå±å¹•æ˜¾ç¤ºç”µè·¯</li><li>æŒ‰é”®ç”µè·¯</li><li>ç”µæºç”µè·¯ç»„æˆ</li></ul>\n<h1><a id=\"3__41\"></a>3 å®ç°æ•ˆæœ</h1>\n<p>æ•´ä½“å±•ç¤º<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\b54618cf8ab24ad4a8813d05b83526ac.png\" width=\"400\"/><br/> äººè„¸è¯†åˆ«åï¼Œèˆµæœºä¼šæ—‹è½¬æ‰“å¼€<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\2ad3e31388434e3885bfae3d213f08da.png\" width=\"400\"/></p>\n<h1><a id=\"4__48\"></a>4 è®¾è®¡åŸç†</h1>\n<h2><a id=\"K210_50\"></a>K210å®ç°äººè„¸è¯†åˆ«</h2>\n<p><strong>äººè„¸è¯†åˆ«æ¨¡å‹æºç è·å–</strong></p>\n<p>å»å®˜ç½‘è·å–äººè„¸è¯†åˆ«æºç å’Œæ¨¡å‹<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\13040fc534464f3ba2e712543d822240.png\"/><br/> æ³¨ï¼šå…ˆè·å–æœºå™¨ç ï¼ˆhttps://cn.bbs.sipeed.com/d/541-maixhubï¼‰åœ¨ä¸‹è½½ã€‚<br/> æ‰€éœ€è¦çš„æ–‡ä»¶æœ‰ï¼šæ¨¡å‹æ–‡ä»¶ï¼Œç¨‹åºè¿è¡Œçš„è„šæœ¬æ–‡ä»¶ï¼Œideéœ€è¦çš„binæ–‡ä»¶ã€‚<br/> ç”¨MaixPyè¿æ¥å¼€å‘æ¿è¿è¡Œä»£ç ï¼Œè‡³æ­¤å°±å®Œæˆäº†åŸºæœ¬çš„äººè„¸è¯†åˆ«åŠŸèƒ½ï¼Œä¸Šè¿°ä»£ç å«æœ‰ä¸­æ–‡æ³¨é‡Šï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ä»£ç ã€‚<br/> æ ¹æ®å®˜ç½‘æä¾›çš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“äººè„¸è¯†åˆ«å¤§æ¦‚æ˜¯æ€ä¹ˆä¸ªæµç¨‹ã€‚<br/> æ ¹æ®ä»£ç æ¥çœ‹ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹ï¼š<br/> 1ã€åŠ è½½å„ç§æ¨¡å‹<br/> 2ã€è¿è¡Œäººè„¸æ£€æµ‹æ¨¡å‹ï¼Œåœ¨å›¾ç‰‡ä¸­æ‰¾åˆ°äººè„¸ä½ç½®å¹¶æ¡†å‡ºäººè„¸<br/> 3ã€å°†è£å‡ºçš„äººè„¸å›¾ç‰‡è½¬æ¢æˆkpuæ¥æ”¶çš„æ ¼å¼<br/> 4ã€è¿è¡Œäººè„¸5ç‚¹å…³é”®ç‚¹æ¨¡å‹ï¼Œè·å–åˆ°å·¦çœ¼ã€å³çœ¼ã€é¼»å­ã€å·¦å˜´è§’ã€å³å˜´è§’çš„ä½ç½®<br/> 5ã€å¯¹åŸå§‹å›¾ç‰‡äººè„¸å›¾ç‰‡è¿›è¡Œä»¿å°„å˜æ¢ï¼Œå˜æ¢ä¸ºæ­£è„¸å›¾åƒï¼Œå°†æ­£è„¸å›¾åƒè½¬ä¸ºkpuæ ¼å¼<br/> 6ã€ä½¿ç”¨äººè„¸196ç»´ç‰¹å¾å€¼æ¨¡å‹è®¡ç®—æ­£è„¸å›¾ç‰‡çš„196ç»´ç‰¹å¾å€¼ï¼Œè®¡ç®—å¾—åˆ°æœ€ç»ˆçš„äººè„¸ç‰¹å¾feature<br/> å†å°†å¾—åˆ°çš„äººè„¸ç‰¹å¾ä¸ä¹‹å‰ä¿å­˜è¿‡çš„äººè„¸ç‰¹å¾è¿›è¡Œå¯¹æ¯”å¾—åˆ°ä¸€ç»„åˆ†æ•°ï¼Œé€‰æ‹©å…¶ä¸­æœ€å¤§çš„ä¸€ä¸ªåˆ†æ•°ï¼Œä¸”è¯¥åˆ†æ•°è¶…è¿‡85åˆ†ï¼ˆå¯ä»¥è‡ªå·±è®¾ç½®ï¼‰å°±è®¤ä¸ºè¯†åˆ«å‡ºè¯¥äººï¼Œå¹¶æ ¹æ®å¯¹åº”ä¸‹æ ‡ä»namesåˆ—è¡¨ä¸­å¾—åˆ°è¯¥äººçš„å§“åã€‚<br/> <strong>çƒ§å½•</strong><br/> ä¸‹è½½å¥½åï¼Œæ¥ä¸‹æ¥å®ç°çš„å°±æ˜¯å›ºä»¶çƒ§å½•ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªè½¯ä»¶kflash_guiï¼Œæ˜¯ä¸“é—¨ç”¨æ¥çƒ§å½•å›ºä»¶çš„ï¼Œåœ¨sipeedå®˜ç½‘ä¼šæä¾›ä¸€ä¸ªGitHubç½‘å€ï¼Œé‡Œé¢ä¸ä»…æœ‰è¯¥è½¯ä»¶ï¼Œè¿˜æœ‰å¤§ä¼™æ‰€éœ€è¦çš„ä¾‹ç¨‹ï¼Œåœ¨ä¾‹ç¨‹ä¸­å¯ä»¥æ‰¾åˆ°å·²ç»è®­ç»ƒå¥½çš„äººè„¸æ¨¡å‹ã€‚å¦‚ä¸‹å›¾ï¼ŒæŒ‰ç…§è¿™æ ·é…ç½®å³å¯ï¼Œè¿æ¥å¥½æ¿å­å°±å¯ä»¥çƒ§å½•äº†ã€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\0193d67bd94c4e35b99a8dfa8ca51a6a.png\"/> ç»ˆäºï¼Œç°åœ¨å°±å¯ä»¥ç‚¹å‡»ideæ‰“å¼€äº†ï¼Œè¿™å°±æ˜¯ideçš„ç•Œé¢ï¼Œç‚¹å·¦ä¸‹è§’çš„è¿æ¥æ¿å­ï¼Œå°±å¯ä»¥æ„‰å¿«çš„è·‘ç¨‹åºäº†ã€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\4b3fecea27874b3ca9b0e57be2a6f1ff.png\"/></p>\n<h1><a id=\"5__74\"></a>5 éƒ¨åˆ†æ ¸å¿ƒä»£ç </h1>\n<p><strong>STM32ä»£ç </strong></p>\n<pre><code class=\"prism language-c\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"HLK210.h\"</span></span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"bsp_i2c_gpio.h\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"bsp_i2c_OLED.h\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"delay.h\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"usart3.h\"</span> </span>\n\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> HLK210_FaceStorageCmd<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">0x5A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x03</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x06</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xE5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//äººè„¸å½•å…¥æŒ‡ä»¤</span>\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> HLK210_FaceCheckCmd<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">0x5A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x02</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x01</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x34</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xA8</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//äººè„¸è¯†åˆ«æŒ‡ä»¤</span>\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> HLK210_FaceDelete<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">0x5A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0D</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x87</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x1E</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//äººè„¸æ¸…ç©ºæŒ‡ä»¤</span>\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> HLK210_LightOn<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token number\">0x5A</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x2C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x12</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x0C</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x00</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0xAA</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0x15</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//å¼€è¡¥å…‰ç¯æŒ‡ä»¤</span>\n\n<span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> HLK210_RECEICV_BUFFER<span class=\"token punctuation\">[</span>HLK210_USART_REC_LEN<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n_HLK210_Data HLK210_Data<span class=\"token punctuation\">;</span>\nu8 HLK210_point<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">HLK210_Receive_Byte</span><span class=\"token punctuation\">(</span>u8 res<span class=\"token punctuation\">)</span> <span class=\"token comment\">//å°†æ­¤å‡½æ•°æ”¾åˆ°ä¸²å£ä¸­æ–­å‡½æ•°é‡Œï¼Œreså½¢å‚æ”¾ä¸²å£æ¥æ”¶å€¼ã€‚</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\tHLK210_RECEICV_BUFFER<span class=\"token punctuation\">[</span>HLK210_point<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>HLK210_point<span class=\"token operator\">&gt;</span><span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>HLK210_RECEICV_BUFFER<span class=\"token punctuation\">[</span>HLK210_point<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">==</span><span class=\"token number\">0x5a</span> <span class=\"token operator\">&amp;&amp;</span> HLK210_RECEICV_BUFFER<span class=\"token punctuation\">[</span>HLK210_point<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">==</span><span class=\"token number\">0x2c</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\tHLK210_RECEICV_BUFFER<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>HLK210_RECEICV_BUFFER<span class=\"token punctuation\">[</span>HLK210_point<span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\tHLK210_RECEICV_BUFFER<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>HLK210_RECEICV_BUFFER<span class=\"token punctuation\">[</span>HLK210_point<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\tHLK210_point<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>HLK210_point<span class=\"token operator\">&gt;=</span>HLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\tHLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">=</span> TRUE<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>HLK210_Buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> HLK210_USART_REC_LEN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//æ¸…ç©º</span>\n\t\t<span class=\"token function\">memcpy</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>HLK210_Buffer<span class=\"token punctuation\">,</span>HLK210_RECEICV_BUFFER<span class=\"token punctuation\">,</span> HLK210_point<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \t<span class=\"token comment\">//ä¿å­˜æ•°æ®</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>HLK210_point<span class=\"token operator\">&gt;</span>HLK210_USART_REC_LEN<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\tHLK210_point<span class=\"token operator\">=</span>HLK210_USART_REC_LEN<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">HLK210_ClearDate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>HLK210_RECEICV_BUFFER<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> HLK210_USART_REC_LEN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//æ¸…ç©º</span>\n\tHLK210_point<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t\n\tHLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen <span class=\"token operator\">=</span> HLK210_NORMALANSWERLEN<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">memset</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>HLK210_Buffer<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> HLK210_USART_REC_LEN<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>      <span class=\"token comment\">//æ¸…ç©º</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>isParseData <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>isUsefull <span class=\"token operator\">=</span>  FALSE<span class=\"token punctuation\">;</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>NowMode <span class=\"token operator\">=</span> NORMAL<span class=\"token punctuation\">;</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>TimeCount <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">HLK210_Send_Cmd</span><span class=\"token punctuation\">(</span>u8 <span class=\"token operator\">*</span>cmd<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\tu8 i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">18</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token function\">HLK210_SendByte</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>cmd<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// == *(cmd++) å–cmdæ‰€æŒ‡å•å…ƒçš„å€¼ï¼ŒcmdæŒ‡å‘ä¸‹ä¸€å•å…ƒï¼Œå³cmdè‡ªåŠ 1</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">HLK210_InputFaceID</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\tu8 i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">HLK210_ClearDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen <span class=\"token operator\">=</span> HLK210_NORMALANSWERLEN<span class=\"token punctuation\">;</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>NowMode <span class=\"token operator\">=</span> INPUTFACEID<span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token function\">HLK210_Send_Cmd</span><span class=\"token punctuation\">(</span>HLK210_LightOn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//å¼€è¡¥å…‰ç¯</span>\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">==</span> FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ç­‰å¾…æ¥æ”¶å®Œåº”ç­”æ•°æ®</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>HLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token function\">USART3_SendByte</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>HLK210_Buffer<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token function\">HLK210_Send_Cmd</span><span class=\"token punctuation\">(</span>HLK210_FaceStorageCmd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">==</span> FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ç­‰å¾…æ¥æ”¶å®Œåº”ç­”æ•°æ®</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>HLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token function\">USART3_SendByte</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>HLK210_Buffer<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen <span class=\"token operator\">=</span> HLK210_FACEANSWERLEN<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">//\twhile(HLK210_Data.isGetData == FALSE); //ç­‰å¾…æ¥æ”¶å®Œåº”ç­”æ•°æ®</span>\n<span class=\"token comment\">//\tHLK210_Data.isGetData = FALSE;</span>\n<span class=\"token comment\">//\tfor(i=0;i&lt;HLK210_Data.CmdDataLen;i++)</span>\n<span class=\"token comment\">//\t{<!-- --></span>\n<span class=\"token comment\">//\t\tUSART3_SendByte(HLK210_Data.HLK210_Buffer[i]);</span>\n<span class=\"token comment\">//\t}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">HLK210_CheckFaceID</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\tu8 i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">HLK210_ClearDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen <span class=\"token operator\">=</span> HLK210_NORMALANSWERLEN<span class=\"token punctuation\">;</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>NowMode <span class=\"token operator\">=</span> CHECKFACEID<span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token function\">HLK210_Send_Cmd</span><span class=\"token punctuation\">(</span>HLK210_LightOn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//å¼€è¡¥å…‰ç¯</span>\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">==</span> FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ç­‰å¾…æ¥æ”¶å®Œåº”ç­”æ•°æ®</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>HLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token function\">USART3_SendByte</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>HLK210_Buffer<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token function\">HLK210_Send_Cmd</span><span class=\"token punctuation\">(</span>HLK210_FaceCheckCmd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">==</span> FALSE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ç­‰å¾…æ¥æ”¶å®Œåº”ç­”æ•°æ®</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>isGetData <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>HLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token function\">USART3_SendByte</span><span class=\"token punctuation\">(</span>HLK210_Data<span class=\"token punctuation\">.</span>HLK210_Buffer<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\tHLK210_Data<span class=\"token punctuation\">.</span>CmdDataLen <span class=\"token operator\">=</span> HLK210_RECOANSWERLEN<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n\n</code></pre>\n<p>k210ä»£ç </p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> sensor<span class=\"token punctuation\">,</span>image<span class=\"token punctuation\">,</span>lcd  <span class=\"token comment\"># import ç›¸å…³åº“</span>\n<span class=\"token keyword\">import</span> KPU <span class=\"token keyword\">as</span> kpu\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> Maix <span class=\"token keyword\">import</span> FPIOA<span class=\"token punctuation\">,</span>GPIO\n<span class=\"token keyword\">from</span> fpioa_manager <span class=\"token keyword\">import</span> fm\n<span class=\"token keyword\">import</span> ubinascii\n<span class=\"token keyword\">from</span> machine <span class=\"token keyword\">import</span> UART\n<span class=\"token keyword\">from</span> machine <span class=\"token keyword\">import</span> Timer\n<span class=\"token keyword\">import</span> time\n\nfm<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span><span class=\"token number\">23</span><span class=\"token punctuation\">,</span>fm<span class=\"token punctuation\">.</span>fpioa<span class=\"token punctuation\">.</span>UART1_TX<span class=\"token punctuation\">)</span><span class=\"token comment\">#ä¸²å£å¼•è„šæ˜ å°„</span>\nfm<span class=\"token punctuation\">.</span>register<span class=\"token punctuation\">(</span><span class=\"token number\">19</span><span class=\"token punctuation\">,</span>fm<span class=\"token punctuation\">.</span>fpioa<span class=\"token punctuation\">.</span>UART1_RX<span class=\"token punctuation\">)</span><span class=\"token comment\">#è¿™ä¸¤ä¸ªå¼•è„šæ˜¯å¯ä»¥ä»»æ„ä¿®æ”¹çš„</span>\n\ncom <span class=\"token operator\">=</span> UART<span class=\"token punctuation\">(</span>UART<span class=\"token punctuation\">.</span>UART1<span class=\"token punctuation\">,</span> <span class=\"token number\">115200</span><span class=\"token punctuation\">,</span> timeout<span class=\"token operator\">=</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span> read_buf_len<span class=\"token operator\">=</span><span class=\"token number\">4096</span><span class=\"token punctuation\">)</span><span class=\"token comment\">#æ„å»ºä¸²å£å¯¹è±¡</span>\n\n<span class=\"token comment\">#å®šæ—¶å™¨ä¸­æ–­å›è°ƒå‡½æ•°</span>\ntem <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\nb <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ncheck <span class=\"token operator\">=</span> <span class=\"token number\">0</span>  <span class=\"token comment\">#å­˜å‚¨</span>\nsave <span class=\"token operator\">=</span> <span class=\"token number\">0</span>   <span class=\"token comment\">#ä¸´æ—¶å­˜å‚¨</span>\nswitch <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token comment\">#åˆ‡æ¢</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">on_timer</span><span class=\"token punctuation\">(</span>timer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\">#å›è°ƒå‡½æ•°</span>\n    <span class=\"token keyword\">global</span> check\n    <span class=\"token keyword\">global</span> save\n    data <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    data <span class=\"token operator\">=</span> com<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> data<span class=\"token operator\">!=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n        check <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token comment\">#ä»£è¡¨å­˜å‚¨äººè„¸ç‰¹å¾</span>\n        <span class=\"token keyword\">if</span> data <span class=\"token operator\">==</span> <span class=\"token string\">b'A'</span><span class=\"token punctuation\">:</span>\n            save <span class=\"token operator\">=</span> <span class=\"token number\">0</span>  <span class=\"token comment\">#ä¸å­˜åˆ°SDå¡ä¸­</span>\n        <span class=\"token keyword\">elif</span> data <span class=\"token operator\">==</span> <span class=\"token string\">b'C'</span><span class=\"token punctuation\">:</span>\n            save <span class=\"token operator\">=</span> <span class=\"token number\">1</span>  <span class=\"token comment\">#å­˜åˆ°SDå¡ä¸­</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#å®šæ—¶å™¨ä¸­æ–­åˆå§‹åŒ–</span>\ntim <span class=\"token operator\">=</span> Timer<span class=\"token punctuation\">(</span>Timer<span class=\"token punctuation\">.</span>TIMER0<span class=\"token punctuation\">,</span> Timer<span class=\"token punctuation\">.</span>CHANNEL0<span class=\"token punctuation\">,</span> mode<span class=\"token operator\">=</span>Timer<span class=\"token punctuation\">.</span>MODE_ONE_SHOT<span class=\"token punctuation\">,</span> period<span class=\"token operator\">=</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\n             unit<span class=\"token operator\">=</span>Timer<span class=\"token punctuation\">.</span>UNIT_MS<span class=\"token punctuation\">,</span>callback<span class=\"token operator\">=</span>on_timer<span class=\"token punctuation\">,</span> arg<span class=\"token operator\">=</span>on_timer<span class=\"token punctuation\">,</span>start<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n\nfeature_file_exists <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">for</span> v <span class=\"token keyword\">in</span> os<span class=\"token punctuation\">.</span>ilistdir<span class=\"token punctuation\">(</span><span class=\"token string\">'/sd'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token comment\">#to check key directorys or files in sd card.sd card should be formated to fat32</span>\n    <span class=\"token keyword\">if</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'features.txt'</span> <span class=\"token keyword\">and</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token number\">0x8000</span><span class=\"token punctuation\">:</span><span class=\"token comment\">#0x8000 is file</span>\n        feature_file_exists <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\nrecord_ftr<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">#ç©ºåˆ—è¡¨ ç”¨äºå­˜å‚¨å½“å‰196ç»´ç‰¹å¾</span>\nrecord_ftrs<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">#ç©ºåˆ—è¡¨ ç”¨äºå­˜å‚¨æŒ‰é”®è®°å½•ä¸‹äººè„¸ç‰¹å¾ï¼Œ å¯ä»¥å°†ç‰¹å¾ä»¥txtç­‰æ–‡ä»¶å½¢å¼ä¿å­˜åˆ°sdå¡åï¼Œè¯»å–åˆ°æ­¤åˆ—è¡¨ï¼Œå³å¯å®ç°äººè„¸æ–­ç”µå­˜å‚¨ã€‚</span>\nnames <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'LX'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'HLF'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'MR.3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Mr.4'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Mr.5'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Mr.6'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Mr.7'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Mr.8'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Mr.9'</span> <span class=\"token punctuation\">,</span> <span class=\"token string\">'Mr.10'</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># äººåæ ‡ç­¾ï¼Œä¸ä¸Šé¢åˆ—è¡¨ç‰¹å¾å€¼ä¸€ä¸€å¯¹åº”ã€‚</span>\nreco <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\nrecord <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">save_feature</span><span class=\"token punctuation\">(</span>feat<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/sd/features.txt'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n        record <span class=\"token operator\">=</span>ubinascii<span class=\"token punctuation\">.</span>b2a_base64<span class=\"token punctuation\">(</span>feat<span class=\"token punctuation\">)</span>\n        f<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>record<span class=\"token punctuation\">)</span>\n\nst <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>feature_file_exists<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/sd/features.txt'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'rb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span>\n        s <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>readlines<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">#print(s)</span>\n        <span class=\"token keyword\">for</span> line <span class=\"token keyword\">in</span> s<span class=\"token punctuation\">:</span>\n            <span class=\"token comment\">#print(ubinascii.a2b_base64(line))</span>\n            record_ftrs<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">bytearray</span><span class=\"token punctuation\">(</span>ubinascii<span class=\"token punctuation\">.</span>a2b_base64<span class=\"token punctuation\">(</span>line<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>record_ftr<span class=\"token punctuation\">,</span>names<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>record_ftr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end\"</span><span class=\"token punctuation\">)</span>\n\ntask_fd <span class=\"token operator\">=</span> kpu<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span><span class=\"token number\">0x300000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># ä»flash 0x200000 åŠ è½½äººè„¸æ£€æµ‹æ¨¡å‹</span>\ntask_ld <span class=\"token operator\">=</span> kpu<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span><span class=\"token number\">0x400000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># ä»flash 0x300000 åŠ è½½äººè„¸äº”ç‚¹å…³é”®ç‚¹æ£€æµ‹æ¨¡å‹</span>\ntask_fe <span class=\"token operator\">=</span> kpu<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span><span class=\"token number\">0x500000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># ä»flash 0x400000 åŠ è½½äººè„¸196ç»´ç‰¹å¾å€¼æ¨¡å‹</span>\nclock <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>clock<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># åˆå§‹åŒ–ç³»ç»Ÿæ—¶é’Ÿï¼Œè®¡ç®—å¸§ç‡</span>\n\nlcd<span class=\"token punctuation\">.</span>init<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># åˆå§‹åŒ–lcd</span>\nsensor<span class=\"token punctuation\">.</span>reset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#åˆå§‹åŒ–sensor æ‘„åƒå¤´</span>\nsensor<span class=\"token punctuation\">.</span>set_pixformat<span class=\"token punctuation\">(</span>sensor<span class=\"token punctuation\">.</span>RGB565<span class=\"token punctuation\">)</span>\nsensor<span class=\"token punctuation\">.</span>set_framesize<span class=\"token punctuation\">(</span>sensor<span class=\"token punctuation\">.</span>QVGA<span class=\"token punctuation\">)</span>\nsensor<span class=\"token punctuation\">.</span>set_hmirror<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#è®¾ç½®æ‘„åƒå¤´é•œåƒ</span>\nsensor<span class=\"token punctuation\">.</span>set_vflip<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">#è®¾ç½®æ‘„åƒå¤´ç¿»è½¬</span>\nlcd<span class=\"token punctuation\">.</span>rotation<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsensor<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#ä½¿èƒ½æ‘„åƒå¤´</span>\n\nanchor <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1.889</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2.5245</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2.9465</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3.94056</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3.99987</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5.3658</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5.155437</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6.92275</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6.718375</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9.01025</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#anchor for face detect ç”¨äºäººè„¸æ£€æµ‹çš„Anchor</span>\ndst_point <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token number\">44</span><span class=\"token punctuation\">,</span><span class=\"token number\">59</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">,</span><span class=\"token number\">59</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span><span class=\"token number\">82</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token number\">47</span><span class=\"token punctuation\">,</span><span class=\"token number\">105</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token number\">81</span><span class=\"token punctuation\">,</span><span class=\"token number\">105</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">#standard face key point position æ ‡å‡†æ­£è„¸çš„5å…³é”®ç‚¹åæ ‡ åˆ†åˆ«ä¸º å·¦çœ¼ å³çœ¼ é¼»å­ å·¦å˜´è§’ å³å˜´è§’</span>\na <span class=\"token operator\">=</span> kpu<span class=\"token punctuation\">.</span>init_yolo2<span class=\"token punctuation\">(</span>task_fd<span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> anchor<span class=\"token punctuation\">)</span> <span class=\"token comment\">#åˆå§‹åŒ–äººè„¸æ£€æµ‹æ¨¡å‹</span>\nimg_lcd<span class=\"token operator\">=</span>image<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># è®¾ç½®æ˜¾ç¤ºbuf</span>\nimg_face<span class=\"token operator\">=</span>image<span class=\"token punctuation\">.</span>Image<span class=\"token punctuation\">(</span>size<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">,</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#è®¾ç½® 128 * 128 äººè„¸å›¾ç‰‡buf</span>\na<span class=\"token operator\">=</span>img_face<span class=\"token punctuation\">.</span>pix_to_ai<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># å°†å›¾ç‰‡è½¬ä¸ºkpuæ¥å—çš„æ ¼å¼</span>\n\n<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ä¸»å¾ªç¯</span>\n    check <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    save <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    tim<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">#å®šæ—¶å™¨ä¸­æ–­å¼€å§‹</span>\n    img <span class=\"token operator\">=</span> sensor<span class=\"token punctuation\">.</span>snapshot<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#ä»æ‘„åƒå¤´è·å–ä¸€å¼ å›¾ç‰‡</span>\n    clock<span class=\"token punctuation\">.</span>tick<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#è®°å½•æ—¶åˆ»ï¼Œç”¨äºè®¡ç®—å¸§ç‡</span>\n    code <span class=\"token operator\">=</span> kpu<span class=\"token punctuation\">.</span>run_yolo2<span class=\"token punctuation\">(</span>task_fd<span class=\"token punctuation\">,</span> img<span class=\"token punctuation\">)</span> <span class=\"token comment\"># è¿è¡Œäººè„¸æ£€æµ‹æ¨¡å‹ï¼Œè·å–äººè„¸åæ ‡ä½ç½®</span>\n    <span class=\"token comment\">#b = img.draw_string(0,0, (\"tem\"), color=(0,255,0),scale=2)</span>\n    <span class=\"token keyword\">if</span> code<span class=\"token punctuation\">:</span> <span class=\"token comment\"># å¦‚æœæ£€æµ‹åˆ°äººè„¸</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> code<span class=\"token punctuation\">:</span> <span class=\"token comment\"># è¿­ä»£åæ ‡æ¡†</span>\n            <span class=\"token comment\"># Cut face and resize to 128x128</span>\n            a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_rectangle<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>rect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># åœ¨å±å¹•æ˜¾ç¤ºäººè„¸æ–¹æ¡†</span>\n            face_cut<span class=\"token operator\">=</span>img<span class=\"token punctuation\">.</span>cut<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># è£å‰ªäººè„¸éƒ¨åˆ†å›¾ç‰‡åˆ° face_cut</span>\n            face_cut_128<span class=\"token operator\">=</span>face_cut<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">,</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># å°†è£å‡ºçš„äººè„¸å›¾ç‰‡ ç¼©æ”¾åˆ°128 * 128åƒç´ </span>\n            a<span class=\"token operator\">=</span>face_cut_128<span class=\"token punctuation\">.</span>pix_to_ai<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># å°†çŒœå‡ºå›¾ç‰‡è½¬æ¢ä¸ºkpuæ¥å—çš„æ ¼å¼</span>\n            <span class=\"token comment\">#a = img.draw_image(face_cut_128, (0,0))</span>\n            <span class=\"token comment\"># Landmark for face 5 points</span>\n            fmap <span class=\"token operator\">=</span> kpu<span class=\"token punctuation\">.</span>forward<span class=\"token punctuation\">(</span>task_ld<span class=\"token punctuation\">,</span> face_cut_128<span class=\"token punctuation\">)</span> <span class=\"token comment\"># è¿è¡Œäººè„¸5ç‚¹å…³é”®ç‚¹æ£€æµ‹æ¨¡å‹</span>\n            plist<span class=\"token operator\">=</span>fmap<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># è·å–å…³é”®ç‚¹é¢„æµ‹ç»“æœ</span>\n            le<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># è®¡ç®—å·¦çœ¼ä½ç½®ï¼Œ è¿™é‡Œåœ¨wæ–¹å‘-10 ç”¨æ¥è¡¥å¿æ¨¡å‹è½¬æ¢å¸¦æ¥çš„ç²¾åº¦æŸå¤±</span>\n            re<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># è®¡ç®—å³çœ¼ä½ç½®</span>\n            nose<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#è®¡ç®—é¼»å­ä½ç½®</span>\n            lm<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#è®¡ç®—å·¦å˜´è§’ä½ç½®</span>\n            rm<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">8</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>plist<span class=\"token punctuation\">[</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>i<span class=\"token punctuation\">.</span>h<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#å³å˜´è§’ä½ç½®</span>\n            a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_circle<span class=\"token punctuation\">(</span>le<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> le<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n            a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_circle<span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> re<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n            a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_circle<span class=\"token punctuation\">(</span>nose<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> nose<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n            a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_circle<span class=\"token punctuation\">(</span>lm<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> lm<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n            a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_circle<span class=\"token punctuation\">(</span>rm<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> rm<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># åœ¨ç›¸åº”ä½ç½®å¤„ç”»å°åœ†åœˆ</span>\n            <span class=\"token comment\"># align face to standard position</span>\n            src_point <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>le<span class=\"token punctuation\">,</span> re<span class=\"token punctuation\">,</span> nose<span class=\"token punctuation\">,</span> lm<span class=\"token punctuation\">,</span> rm<span class=\"token punctuation\">]</span> <span class=\"token comment\"># å›¾ç‰‡ä¸­ 5 åæ ‡çš„ä½ç½®</span>\n            T<span class=\"token operator\">=</span>image<span class=\"token punctuation\">.</span>get_affine_transform<span class=\"token punctuation\">(</span>src_point<span class=\"token punctuation\">,</span> dst_point<span class=\"token punctuation\">)</span> <span class=\"token comment\"># æ ¹æ®è·å¾—çš„5ç‚¹åæ ‡ä¸æ ‡å‡†æ­£è„¸åæ ‡è·å–ä»¿å°„å˜æ¢çŸ©é˜µ</span>\n            a<span class=\"token operator\">=</span>image<span class=\"token punctuation\">.</span>warp_affine_ai<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> img_face<span class=\"token punctuation\">,</span> T<span class=\"token punctuation\">)</span> <span class=\"token comment\">#å¯¹åŸå§‹å›¾ç‰‡äººè„¸å›¾ç‰‡è¿›è¡Œä»¿å°„å˜æ¢ï¼Œå˜æ¢ä¸ºæ­£è„¸å›¾åƒ</span>\n            a<span class=\"token operator\">=</span>img_face<span class=\"token punctuation\">.</span>ai_to_pix<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># å°†æ­£è„¸å›¾åƒè½¬ä¸ºkpuæ ¼å¼</span>\n            <span class=\"token comment\">#a = img.draw_image(img_face, (128,0))</span>\n            <span class=\"token keyword\">del</span><span class=\"token punctuation\">(</span>face_cut_128<span class=\"token punctuation\">)</span> <span class=\"token comment\"># é‡Šæ”¾è£å‰ªäººè„¸éƒ¨åˆ†å›¾ç‰‡</span>\n            <span class=\"token comment\"># calculate face feature vector</span>\n            fmap <span class=\"token operator\">=</span> kpu<span class=\"token punctuation\">.</span>forward<span class=\"token punctuation\">(</span>task_fe<span class=\"token punctuation\">,</span> img_face<span class=\"token punctuation\">)</span> <span class=\"token comment\"># è®¡ç®—æ­£è„¸å›¾ç‰‡çš„196ç»´ç‰¹å¾å€¼</span>\n            feature<span class=\"token operator\">=</span>kpu<span class=\"token punctuation\">.</span>face_encode<span class=\"token punctuation\">(</span>fmap<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#è·å–è®¡ç®—ç»“æœ</span>\n            reg_flag <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\n            scores <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># å­˜å‚¨ç‰¹å¾æ¯”å¯¹åˆ†æ•°</span>\n            <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>record_ftrs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#è¿­ä»£å·²å­˜ç‰¹å¾å€¼</span>\n                score <span class=\"token operator\">=</span> kpu<span class=\"token punctuation\">.</span>face_compare<span class=\"token punctuation\">(</span>record_ftrs<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> feature<span class=\"token punctuation\">)</span> <span class=\"token comment\">#è®¡ç®—å½“å‰äººè„¸ç‰¹å¾å€¼ä¸å·²å­˜ç‰¹å¾å€¼çš„åˆ†æ•°</span>\n                scores<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>score<span class=\"token punctuation\">)</span> <span class=\"token comment\">#æ·»åŠ åˆ†æ•°æ€»è¡¨</span>\n            max_score <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n            index <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n            <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>scores<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#è¿­ä»£æ‰€æœ‰æ¯”å¯¹åˆ†æ•°ï¼Œæ‰¾åˆ°æœ€å¤§åˆ†æ•°å’Œç´¢å¼•å€¼</span>\n                <span class=\"token keyword\">if</span> max_score <span class=\"token operator\">&lt;</span> scores<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n                    max_score <span class=\"token operator\">=</span> scores<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span>\n                    index <span class=\"token operator\">=</span> k\n            <span class=\"token keyword\">if</span> max_score <span class=\"token operator\">&gt;</span> <span class=\"token number\">80</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># å¦‚æœæœ€å¤§åˆ†æ•°å¤§äº85ï¼Œ å¯ä»¥è¢«è®¤å®šä¸ºåŒä¸€ä¸ªäºº</span>\n                a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_string<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"%s :%2.1f\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> max_score<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>scale<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># æ˜¾ç¤ºäººå ä¸ åˆ†æ•°</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_string<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"X :%2.1f\"</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">(</span>max_score<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>scale<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#æ˜¾ç¤ºæœªçŸ¥ ä¸ åˆ†æ•°</span>\n                <span class=\"token keyword\">if</span> check <span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#å¦‚æœæ£€æµ‹åˆ°ä¸²å£æ•°æ®</span>\n                   check <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n                   record_ftr <span class=\"token operator\">=</span> feature\n                   record_ftrs<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>record_ftr<span class=\"token punctuation\">)</span> <span class=\"token comment\">#å°†å½“å‰ç‰¹å¾æ·»åŠ åˆ°å·²çŸ¥ç‰¹å¾åˆ—è¡¨</span>\n                   <span class=\"token keyword\">if</span> save<span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\">#å¦‚æœå­˜å‚¨</span>\n                      save <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n                      a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_string<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Stor successful\"</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>scale<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n                      <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stor successful\"</span><span class=\"token punctuation\">)</span>\n                      save_feature<span class=\"token punctuation\">(</span>record_ftr<span class=\"token punctuation\">)</span> <span class=\"token comment\">#å­˜åˆ°SDå¡</span>\n                   <span class=\"token keyword\">break</span>\n    a <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>draw_string<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">220</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"face\"</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>scale<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#æ˜¾ç¤ºæœªçŸ¥ ä¸ åˆ†æ•°</span>\n    a <span class=\"token operator\">=</span> lcd<span class=\"token punctuation\">.</span>display<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span> <span class=\"token comment\">#åˆ·å±æ˜¾ç¤º</span>\n\n\n</code></pre>\n<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p>\n<p><a href=\"https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md\">https://gitee.com/dancheng-senior/project-sharing-1/blob/master/%E6%AF%95%E8%AE%BE%E6%8C%87%E5%AF%BC/README.md</a></p>\n<br/>\n<h1><a id=\"6__369\"></a>6 æœ€å</h1>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-08-16 09:14:30", "summary": "æ–‡ç« ç›®å½•å‰è¨€ç®€ä»‹ä¸»è¦å™¨ä»¶å®ç°æ•ˆæœè®¾è®¡åŸç†å®ç°äººè„¸è¯†åˆ«éƒ¨åˆ†æ ¸å¿ƒä»£ç æœ€åå‰è¨€è¿™ä¸¤å¹´å¼€å§‹æ¯•ä¸šè®¾è®¡å’Œæ¯•ä¸šç­”è¾©çš„è¦æ±‚å’Œéš¾åº¦ä¸æ–­æå‡ï¼Œä¼ ç»Ÿçš„æ¯•è®¾é¢˜ç›®ç¼ºå°‘åˆ›æ–°å’Œäº®ç‚¹ï¼Œå¾€å¾€è¾¾ä¸åˆ°æ¯•ä¸šç­”è¾©çš„è¦æ±‚ï¼Œè¿™ä¸¤å¹´ä¸æ–­æœ‰å­¦å¼Ÿå­¦å¦¹å‘Š"}