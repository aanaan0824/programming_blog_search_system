{"blogid": "123806599", "writerAge": "码龄4年", "writerBlogNum": "12", "writerCollect": "25", "writerComment": "2", "writerFan": "4", "writerGrade": "2级", "writerIntegral": "133", "writerName": "我是齐潇哇", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123806599.jpg", "writerRankTotal": "143401", "writerRankWeekly": "538778", "writerThumb": "9", "writerVisitNum": "28000", "blog_read_count": "3184", "blog_time": "于 2022-03-28 21:36:56 发布", "blog_title": "php危险函数总结", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1 style=\"margin-left:0;\"><a name=\"1760-1648469385415\"></a></h1>\n<h1 style=\"margin-left:0;\">一、os命令执行函数</h1>\n<h2 style=\"margin-left:0;\"><a name=\"2067-1648471366904\"></a>1.system（）</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"9750-1648469437764\"></a>将输入的字符串作为os命令执行，并且输出</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"8810-1648469427462\"></a></p>\n<pre><code class=\"language-php\">&lt;?php\nif(isset($_GET['cmd'])){\necho \"&lt;pre&gt;\"; \nsystem($_GET['cmd']);\n}else{\necho \"Useage:http://IpAddress/?cmd=net user\";\n}\n?&gt;\n</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"5871-1648469432054\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"1377-1648469432054\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"7628-1648469421904\"></a></p>\n<h2 style=\"margin-left:0;\"><a name=\"6023-1648469415335\"></a><img alt=\"\" height=\"170\" src=\"..\\..\\static\\image\\a44b062c16034559b8975de233100fcd.png\" width=\"578\"/></h2>\n<p> </p>\n<h2 style=\"margin-left:0;\">2.exec()</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"7085-1648469601349\"></a>将输入的字符串作为os命令执行，并且输出，但只输出最后一行</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"6175-1648469709804\"></a></p>\n<pre><code class=\"language-php\">&lt;?php\nif(isset($_GET['cmd'])){\necho \"&lt;pre&gt;\";\nprint exec($_GET['cmd']);\n}else{\necho \"Useage:http://IpAddress/?cmd=whoami\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"9310-1648469709804\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"4344-1648469698350\"></a></p>\n<h2 style=\"margin-left:0;\"><a name=\"6510-1648469594335\"></a><img alt=\"\" height=\"155\" src=\"..\\..\\static\\image\\cb107c4234ce4c8696742e7ca74b1ff7.png\" width=\"553\"/></h2>\n<p> </p>\n<h2 style=\"margin-left:0;\">3.shell_exec()</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"2720-1648469925764\"></a>将函数中的参数当做os命令执行，完整显示</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"7939-1648469989192\"></a></p>\n<pre><code class=\"language-php\">&lt;?php\nif(isset($_GET['cmd'])){\necho \"&lt;pre&gt;\";\nprint shell_exec($_GET['cmd']);\n}else{\necho \"Useage:http://IpAddress/?cmd=ipconfig\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"5770-1648470068954\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"5314-1648470068954\"></a></p>\n<h2 style=\"margin-left:0;\"><a name=\"3091-1648469857082\"></a><img alt=\"\" height=\"455\" src=\"..\\..\\static\\image\\b62e667c5cb0464ea7b80c6a13e33e6e.png\" width=\"690\"/></h2>\n<p> </p>\n<h2 style=\"margin-left:0;\">4.passthru()</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"5495-1648470085773\"></a>自带输出功能</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"2064-1648470110387\"></a></p>\n<pre><code>&lt;?php\nif(isset($_GET['cmd'])){\necho \"&lt;pre&gt;\";\npassthru($_GET['cmd']);\n}else{\necho \"Useage:http://IpAddress/?cmd=ipconfig\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"8721-1648470198395\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"5729-1648470198395\"></a></p>\n<h2 style=\"margin-left:0;\"><a name=\"9550-1648469564023\"></a><img alt=\"\" height=\"349\" src=\"..\\..\\static\\image\\f174227bb76141d5a7c529e4440c8f11.png\" width=\"567\"/></h2>\n<p> </p>\n<h2 style=\"margin-left:0;\">5.popen()</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"5777-1648470227625\"></a>此函数没有回显，因此需要将数据导入到一个文件中</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"3364-1648470822689\"></a></p>\n<pre><code class=\"language-php\">&lt;?php\nif(isset($_GET['cmd'])){\necho \"&lt;pre&gt;\";\npopen($_GET['cmd'],'r');\n}else{\necho \"Useage:http://IpAddress/?cmd=ipconfig &gt; 1.txt\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"5611-1648473503294\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"2036-1648473503294\"></a></p>\n<h2 style=\"margin-left:0;\"><a name=\"4060-1648473502070\"></a><img alt=\"\" height=\"539\" src=\"..\\..\\static\\image\\9bf1b9354da742e2ada3e9c619aae2f6.png\" width=\"610\"/></h2>\n<p> </p>\n<h2 style=\"margin-left:0;\">6.反引号``</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"1173-1648471521369\"></a>将反引号中的参数当做os命令执行</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"3086-1648471555279\"></a></p>\n<pre><code>&lt;?php\nif(isset($_GET['cmd'])){\n$info = $_GET['cmd'];\nprint `$info`;\n}else{\necho \"Useage:http://IpAddress/?cmd=ipconfig\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"3716-1648471633884\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"2090-1648471633884\"></a></p>\n<h1 style=\"margin-left:0;\"><a name=\"5839-1648471633884\"></a><img alt=\"\" height=\"160\" src=\"..\\..\\static\\image\\596829c964f348bd9602e0df6110502e.png\" width=\"555\"/></h1>\n<p> </p>\n<h1 style=\"margin-left:0;\">二、php代码执行函数</h1>\n<h2 style=\"margin-left:0;\"><a name=\"1843-1648471706794\"></a>1.eval()</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"7794-1648471719943\"></a>将字符串当作php代码执行</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"4340-1648471847063\"></a>注意：输入的字符串需要以分号结尾</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"6030-1648471744841\"></a></p>\n<pre><code class=\"language-php\">&lt;?php\n$str = \"phpinfo();\";\necho $str;\neval($str);\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"3561-1648471809857\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"3779-1648471809857\"></a></p>\n<h2 style=\"margin-left:0;\"><a name=\"1649-1648471809857\"></a><img alt=\"\" height=\"269\" src=\"..\\..\\static\\image\\8fd169ff43394e3ca49fc4372581b151.png\" width=\"640\"/></h2>\n<p> </p>\n<h2 style=\"margin-left:0;\">2.assert()</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"5683-1648471904492\"></a>将字符串当作php代码执行</p>\n<pre><code class=\"language-php\">&lt;?php\nif(isset($_GET['code'])){\n$code=$_GET['code'];\nassert($code);\n}else{\necho \"please submit code!&lt;br&gt;?code=phpinfo()\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"1240-1648472097888\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"3961-1648472097888\"></a></p>\n<h2 style=\"margin-left:0;\"><a name=\"5213-1648472097888\"></a><img alt=\"\" height=\"264\" src=\"..\\..\\static\\image\\76f488d048a847cd8e98fbbd71bb11b7.png\" width=\"675\"/></h2>\n<p> </p>\n<h2 style=\"margin-left:0;\">3.preg_replace()</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"3849-1648472122673\"></a>利用正则表达式提取出指定字符串，字符串会被当成代码执行</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"5053-1648472279608\"></a></p>\n<pre><code class=\"language-php\">&lt;?php\nif(isset($_GET['code'])){\n$code = $_GET['code'];\npreg_replace(\"/\\[(.*)\\]/e\",\"\\\\1\", $code);\n}else{\necho \"?code=[phpinfo()]\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"7161-1648472379375\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"8527-1648472379375\"></a></p>\n<p style=\"margin-left:.0001pt;\"><img alt=\"\" height=\"314\" src=\"..\\..\\static\\image\\9675ed956a07478089eca5596f058195.png\" width=\"635\"/></p>\n<p> </p>\n<h2 style=\"margin-left:0;\"><a name=\"5854-1648472379375\"></a>4.call_user_func()</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"1717-1648472950468\"></a>funName是函数名称</p>\n<p style=\"margin-left:.0001pt;\"><a name=\"1251-1648473173423\"></a>stra是函数中的参数</p>\n<pre><code class=\"language-php\">&lt;?php\nif(isset($_GET['funName'])){\n$fun = $_GET['funName'];\n$para = $_GET['stra'];\ncall_user_func($fun,$para);\n}else{\necho\"?funName=assert&amp;stra=phpinfo()\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><a name=\"7044-1648473141692\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"4892-1648473141692\"></a></p>\n<h2 style=\"margin-left:0;\"><a name=\"9624-1648472406958\"></a><img alt=\"\" height=\"379\" src=\"..\\..\\static\\image\\c70762380c8b453bbab82b691a29e1b1.png\" width=\"607\"/></h2>\n<p> </p>\n<h2 style=\"margin-left:0;\">5.动态函数$a($b)</h2>\n<p style=\"margin-left:.0001pt;\"><a name=\"2794-1648473278293\"></a>类似于call_user_func()</p>\n<pre><code class=\"language-php\">&lt;?php\nif(isset($_GET['a'])){\n$a = $_GET['a'];\n$b = $_GET['b'];\n$a($b);\n}else{\necho \"?a=assert&amp;b=phpinfo()\";\n}\n?&gt;</code></pre>\n<p style=\"margin-left:.0001pt;\"><img alt=\"\" height=\"309\" src=\"..\\..\\static\\image\\0a644a42e52e4cb983a148345302e542.png\" width=\"624\"/></p>\n<h1> 防御方法：</h1>\n<ul><li>尽量不要使用eval等危险函数</li><li>如果不得已使用，一定要进行严格过滤</li><li>减少危险函数的使用，并在php.ini中修改disable_functions添加禁用的函数</li><li>参数的值尽量使用引号包裹，并在拼接前调用 addslashes() 进行转义</li></ul>\n<p style=\"margin-left:.0001pt;\"></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"8346-1648473362057\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"6696-1648473362057\"></a></p>\n<p style=\"margin-left:.0001pt;\"><a name=\"9994-1648473217864\"></a></p>\n</div>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-03-28 21:36:56", "summary": "一、命令执行函数将输入的字符串作为命令执行，并且输出将输入的字符串作为命令执行，并且输出，但只输出最后一行将函数中的参数当做命令执行，完整显示自带输出功能此函数没有回显，因此需要将数据导入到一个文件中"}