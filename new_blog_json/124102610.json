{"blogid": "124102610", "writerAge": "码龄5年", "writerBlogNum": "1", "writerCollect": "0", "writerComment": "0", "writerFan": "0", "writerGrade": "1级", "writerIntegral": "10", "writerName": "qq_38215832", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124102610.jpg", "writerRankTotal": "252544", "writerRankWeekly": "1322569", "writerThumb": "0", "writerVisitNum": "796", "blog_read_count": "796", "blog_time": "已于 2022-04-11 16:35:31 修改", "blog_title": "AES/CBC/PKCS5Padding的php用法", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p>提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档</p>\n</blockquote>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n</div>\n<p></p>\n<p>AES/CBC/PKCS5Padding的php用法</p>\n<p>加密模式：AES/CBC/PKCS5Padding l 加密初始化向量：长度为 16 的空字节数组<br/> 加密样例如下<br/> 原文：<br/> abcdefghigklmnopqrstuvwxyz0123456789<br/> 加密后：<br/> 8Z3dZzqn05FmiuBLowExK0CAbs4TY2GorC2dDPVlsn/t<br/> P+VuJGePqIMv1uSaVErr</p>\n<p>代码如下（示例）：</p>\n<p>class MagicCrypt<br/> {<!-- --></p>\n<pre><code>const TOKEN = '2qDhQh2L63kV7Szs';\n\npublic static $key_usage = self::TOKEN;\n\npublic static function encrypt($jsonResponse){\n\n    $iv = pack('H*', \"00000000000000000000000000000000\");\n\n    $pkcs5Padded = self::pkcs5Pad($jsonResponse);\n\n    $encrypted = mcrypt_encrypt(MCRYPT_RIJNDAEL_128, self::$key_usage, $pkcs5Padded, MCRYPT_MODE_CBC, $iv);\n\n    $encoded = base64_encode($encrypted);\n\n    return $encoded;\n\n}\n\npublic static function decrypt($text) {\n\n    $iv = pack('H*', \"00000000000000000000000000000000\");\n\n    $key = self::$key_usage;\n\n    $toDecrypt = base64_decode($text);\n\n    $decoded = mcrypt_decrypt(MCRYPT_RIJNDAEL_128, $key, $toDecrypt, MCRYPT_MODE_CBC, $iv);\n\n    $pkcs5Padded = self::pkcs5Unpad($decoded);\n\n    return $pkcs5Padded ;\n\n}\n\nprivate static function ordutf8($string, &amp;$offset){\n\n    $code = ord(substr($string, $offset,1));\n    if ($code &gt;= 128) {        //otherwise 0xxxxxxx\n        if ($code &lt; 224) $bytes_number = 2;                //110xxxxx\n        else if ($code &lt; 240) $bytes_number = 3;        //1110xxxx\n        else if ($code &lt; 248) $bytes_number = 4;    //11110xxx\n        $code_temp = $code - 192 - ($bytes_number &gt; 2 ? 32 : 0) - ($bytes_number &gt; 3 ? 16 : 0);\n        for ($i = 2; $i &lt;= $bytes_number; $i++) {\n            $offset ++;\n            $code2 = ord(substr($string, $offset, 1)) - 128;        //10xxxxxx\n            $code_temp = $code_temp*64 + $code2;\n        }\n        $code = $code_temp;\n    }\n    $offset += 1;\n    if ($offset &gt;= strlen($string)) $offset = -1;\n    return $code;\n\n}\n\nprivate static function pkcs5Pad($text){\n\n    $size = mcrypt_get_block_size(MCRYPT_RIJNDAEL_128, MCRYPT_MODE_CBC);\n\n    $pad = $size - (mb_strlen($text) % $size);\n\n    return $text . str_repeat(chr($pad), $pad);\n\n}\n\nprivate static function pkcs5Unpad($text){\n\n    $offset = mb_strlen($text) - 1;\n\n    $pad = self::ordutf8($text, $offset);\n\n    if ($pad &gt; mb_strlen($text)) {\n\n        return $text;\n\n    }\n\n    if (strspn($text, $text{mb_strlen($text) - 1}, mb_strlen($text) - $pad) != $pad) {\n\n        return $text;\n\n    }\n\n    return mb_substr($text, 0, -1 * $pad);\n\n}\n</code></pre>\n<p>}</p>\n<p>//开始解密</p>\n<p>$MagicCrypt= new MagicCrypt();</p>\n<p>$string = ‘8Z3dZzqn05FmiuBLowExK0CAbs4TY2GorC2dDPVlsn/tP+VuJGePqIMv1uSaVErr’;</p>\n<p>//要解密的加密值，亦可使用页头方式(//$string)得到的外部传递值</p>\n<p>$data = <span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n    \n     \n      \n       \n        M\n       \n       \n        a\n       \n       \n        g\n       \n       \n        i\n       \n       \n        c\n       \n       \n        C\n       \n       \n        r\n       \n       \n        y\n       \n       \n        p\n       \n       \n        t\n       \n       \n        −\n       \n       \n        &gt;\n       \n       \n        d\n       \n       \n        e\n       \n       \n        c\n       \n       \n        r\n       \n       \n        y\n       \n       \n        p\n       \n       \n        t\n       \n       \n        (\n       \n      \n      \n       MagicCrypt-&gt;decrypt(\n      \n     \n    </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.87777em; vertical-align: -0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right: 0.10903em;\">M</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right: 0.03588em;\">g</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">c</span><span class=\"mord mathdefault\" style=\"margin-right: 0.07153em;\">C</span><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right: 0.03588em;\">y</span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">t</span><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right: 0.277778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right: 0.277778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathdefault\">d</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">c</span><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right: 0.03588em;\">y</span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">t</span><span class=\"mopen\">(</span></span></span></span></span>string); // 解密调用</p>\n<p>echo “解密值：”.$data;//显示解密值</p>\n<p>echo \"<br/> \";</p>\n<p>$encodeString = <span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n    \n     \n      \n       \n        M\n       \n       \n        a\n       \n       \n        g\n       \n       \n        i\n       \n       \n        c\n       \n       \n        C\n       \n       \n        r\n       \n       \n        y\n       \n       \n        p\n       \n       \n        t\n       \n       \n        −\n       \n       \n        &gt;\n       \n       \n        e\n       \n       \n        n\n       \n       \n        c\n       \n       \n        r\n       \n       \n        y\n       \n       \n        p\n       \n       \n        t\n       \n       \n        (\n       \n      \n      \n       MagicCrypt-&gt;encrypt(\n      \n     \n    </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.87777em; vertical-align: -0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right: 0.10903em;\">M</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\" style=\"margin-right: 0.03588em;\">g</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">c</span><span class=\"mord mathdefault\" style=\"margin-right: 0.07153em;\">C</span><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right: 0.03588em;\">y</span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">t</span><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right: 0.277778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right: 0.277778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">c</span><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">r</span><span class=\"mord mathdefault\" style=\"margin-right: 0.03588em;\">y</span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">t</span><span class=\"mopen\">(</span></span></span></span></span>data); // 加密调用</p>\n<p>echo “加密值：”.$encodeString;</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-04-11 16:35:31", "summary": "提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档文章目录的用法加密模式：加密初始化向量：长度为的空字节数组加密样例如下原文：加密后：代码如下示例：开始解密要解密的加密值，亦可使用页头方"}