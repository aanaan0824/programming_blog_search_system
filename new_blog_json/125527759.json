{"blogid": "125527759", "writerAge": "ç é¾„1å¹´", "writerBlogNum": "25", "writerCollect": "2049", "writerComment": "1518", "writerFan": "2633", "writerGrade": "6çº§", "writerIntegral": "4561", "writerName": "çŒ¿åŠ›çŒª", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125527759.jpg", "writerRankTotal": "4640", "writerRankWeekly": "15864", "writerThumb": "1555", "writerVisitNum": "113016", "blog_read_count": "1373", "blog_time": "å·²äºÂ 2022-07-13 12:16:53Â ä¿®æ”¹", "blog_title": "ã€Linuxç½‘ç»œç¼–ç¨‹ã€‘é«˜å¹¶å‘æœåŠ¡å™¨ socket+epollå°è£… æœåŠ¡å™¨/å®¢æˆ·ç«¯ä¸¾ä¾‹", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1 id=\"%E7%9B%AE%E5%BD%95\">ç›®å½•</h1>\n<p id=\"%E5%89%8D%E8%A8%80-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%89%8D%E8%A8%80\">å‰è¨€</a></p>\n<p id=\"%E4%B8%80%E3%80%81%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%80%E3%80%81%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8\">ä¸€ã€é«˜å¹¶å‘æœåŠ¡å™¨</a></p>\n<p id=\"%F0%9F%92%BB%E4%BB%80%E4%B9%88%E6%98%AF%E9%AB%98%E5%B9%B6%E5%8F%91%EF%BC%9F-toc\" style=\"margin-left:40px;\"><a href=\"#%F0%9F%92%BB%E4%BB%80%E4%B9%88%E6%98%AF%E9%AB%98%E5%B9%B6%E5%8F%91%EF%BC%9F\">ğŸ’»ä»€ä¹ˆæ˜¯é«˜å¹¶å‘ï¼Ÿ</a></p>\n<p id=\"%F0%9F%92%BB%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E5%A4%84%E7%90%86%E6%8C%87%E6%A0%87%EF%BC%9F-toc\" style=\"margin-left:40px;\"><a href=\"#%F0%9F%92%BB%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E5%A4%84%E7%90%86%E6%8C%87%E6%A0%87%EF%BC%9F\">ğŸ’»é«˜å¹¶å‘çš„å¤„ç†æŒ‡æ ‡ï¼Ÿ</a></p>\n<p id=\"%F0%9F%92%BB%E9%AB%98%E5%B9%B6%E5%8F%91%E5%92%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%B3%E7%B3%BB%E5%92%8C%E5%8C%BA%E5%88%AB%EF%BC%9F-toc\" style=\"margin-left:40px;\"><a href=\"#%F0%9F%92%BB%E9%AB%98%E5%B9%B6%E5%8F%91%E5%92%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%B3%E7%B3%BB%E5%92%8C%E5%8C%BA%E5%88%AB%EF%BC%9F\">ğŸ’»é«˜å¹¶å‘å’Œå¤šçº¿ç¨‹çš„å…³ç³»å’ŒåŒºåˆ«ï¼Ÿ</a></p>\n<p id=\"%E4%BA%8C%E3%80%81%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%2F%E5%AE%A2%E6%88%B7%E7%AB%AF-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%8C%E3%80%81%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%2F%E5%AE%A2%E6%88%B7%E7%AB%AF\">äºŒã€æ­å»ºæœåŠ¡å™¨/å®¢æˆ·ç«¯</a></p>\n<p id=\"%F0%9F%92%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81-toc\" style=\"margin-left:40px;\"><a href=\"#%F0%9F%92%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81\">ğŸ’»æœåŠ¡å™¨ä»£ç ï¼ˆ4ç§ç±»çš„å°è£…ï¼‰</a></p>\n<p id=\"%F0%9F%8C%88%E5%9C%B0%E5%9D%80%E7%B1%BB%EF%BC%88CHostAddress%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%F0%9F%8C%88%E5%9C%B0%E5%9D%80%E7%B1%BB%EF%BC%88CHostAddress%EF%BC%89\">ğŸŒˆåœ°å€ç±»ã€CHostAddressã€‘</a></p>\n<p id=\"%F0%9F%8C%88socket%E5%9F%BA%E7%B1%BB%EF%BC%88CBaseSocket%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%F0%9F%8C%88socket%E5%9F%BA%E7%B1%BB%EF%BC%88CBaseSocket%EF%BC%89\">ğŸŒˆsocketç±»ã€CBaseSocketã€‘</a></p>\n<p id=\"%F0%9F%8C%88TCP%E6%B4%BE%E7%94%9F%E7%B1%BB%EF%BC%88CTcpServer%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%F0%9F%8C%88TCP%E6%B4%BE%E7%94%9F%E7%B1%BB%EF%BC%88CTcpServer%EF%BC%89\">ğŸŒˆTCPç±»ã€CTcpServerã€‘</a></p>\n<p id=\"%F0%9F%8C%88epoll%E7%B1%BB%20%EF%BC%88CEpollServer%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%F0%9F%8C%88epoll%E7%B1%BB%20%EF%BC%88CEpollServer%EF%BC%89\">ğŸŒˆepollç±» ã€CEpollServerã€‘</a></p>\n<p id=\"%F0%9F%92%BB%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-toc\" style=\"margin-left:40px;\"><a href=\"#%F0%9F%92%BB%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81\">ğŸ’»å®¢æˆ·ç«¯ä»£ç </a></p>\n<p id=\"%F0%9F%92%BB%E6%A1%88%E4%BE%8B%E6%B5%8B%E8%AF%95-toc\" style=\"margin-left:40px;\"><a href=\"#%F0%9F%92%BB%E6%A1%88%E4%BE%8B%E6%B5%8B%E8%AF%95\">ğŸ’»æ¡ˆä¾‹æµ‹è¯•</a></p>\n<hr/>\n<h1 id=\"%E5%89%8D%E8%A8%80\">å‰è¨€</h1>\n<p>æœ¬æ–‡ä¸»è¦å­¦ä¹ <span style=\"color:#be191c;\"><strong>Linuxå†…æ ¸ç¼–ç¨‹</strong></span>ï¼Œç»“åˆ<span style=\"color:#be191c;\"><strong>Visual Studio 2019</strong></span>è¿›è¡Œè·¨å¹³å°ç¼–ç¨‹ï¼Œå†…å®¹åŒ…æ‹¬é«˜å¹¶å‘æœåŠ¡å™¨çš„ä»‹ç»ã€æœåŠ¡å™¨ä»£ç å°è£…ï¼ˆsocket+epollï¼‰ã€æœåŠ¡å™¨/å®¢æˆ·ç«¯æµ‹è¯•</p>\n<h1 id=\"%E4%B8%80%E3%80%81%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8\">ä¸€ã€é«˜å¹¶å‘æœåŠ¡å™¨</h1>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"335\" src=\"..\\..\\static\\image\\0dedfc5dee0a4fdabd57bf3abb7c2a64.png\" width=\"377\"/></p>\n<h2 id=\"%F0%9F%92%BB%E4%BB%80%E4%B9%88%E6%98%AF%E9%AB%98%E5%B9%B6%E5%8F%91%EF%BC%9F\">ğŸ’»ä»€ä¹ˆæ˜¯é«˜å¹¶å‘ï¼Ÿ</h2>\n<blockquote>\n<p><span style=\"color:#be191c;\"><strong>ğŸ“˜  é«˜å¹¶å‘ </strong></span>æ˜¯ä¸€ç§ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€ç§<strong> </strong> <strong>â€œçŸ­æ—¶é—´å†…é‡åˆ°å¤§é‡æ“ä½œè¯·æ±‚â€</strong>  çš„æƒ…å†µ</p>\n<p>      ã€ä¸»è¦å‘ç”Ÿåœ¨webç³»ç»Ÿé›†ä¸­å¤§é‡è®¿é—®æ”¶åˆ°å¤§é‡è¯·æ±‚ã€‘</p>\n<p></p>\n<p>ğŸŒ°ä¸¾ä¸ªä¾‹å­ï¼š12306çš„æŠ¢ç¥¨æƒ…å†µï¼›å¤©çŒ«åŒåä¸€æ´»åŠ¨ã€çªç„¶ä¸‹å•ä¸€ä¸‡å¼ ç¥¨ï¼Œä¸Šä¸‡äººä¸‹å•è´­ç‰©ã€‘</p>\n<p></p>\n<p>è¯¥æƒ…å†µå‘ç”Ÿä¼šå¯¼è‡´ç³»ç»Ÿåœ¨è¿™æ®µæ—¶é—´å†…æ‰§è¡Œå¤§é‡æ“ä½œï¼Œä¾‹å¦‚ï¼Œå¯¹èµ„æºçš„è¯·æ±‚ï¼Œæ•°æ®åº“çš„æ“ä½œç­‰</p>\n</blockquote>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"290\" src=\"..\\..\\static\\image\\ba232185ba154127ab745dedb9e0c393.png\" width=\"434\"/></p>\n<h2 id=\"%F0%9F%92%BB%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E5%A4%84%E7%90%86%E6%8C%87%E6%A0%87%EF%BC%9F\">ğŸ’»é«˜å¹¶å‘çš„å¤„ç†æŒ‡æ ‡ï¼Ÿ</h2>\n<blockquote>\n<p><strong>é«˜å¹¶å‘ç›¸å…³å¸¸ç”¨çš„ä¸€äº›æŒ‡æ ‡æœ‰ï¼š</strong></p>\n<p><br/><strong>1ï¸âƒ£å“åº”æ—¶é—´ï¼ˆResponse Timeï¼‰</strong></p>\n<p>ğŸ“—å«ä¹‰ï¼šç³»ç»Ÿå¯¹è¯·æ±‚åšå‡ºå“åº”çš„æ—¶é—´</p>\n<p>ğŸŒ°ä¸¾ä¸ªä¾‹å­ï¼šç³»ç»Ÿå¤„ç†ä¸€ä¸ªHTTPè¯·æ±‚éœ€è¦200msï¼Œè¿™ä¸ª200mså°±æ˜¯ç³»ç»Ÿçš„å“åº”æ—¶é—´</p>\n<hr/>\n<p><strong>2ï¸âƒ£ååé‡ï¼ˆThroughputï¼‰</strong></p>\n<p>ğŸ“—å«ä¹‰ï¼šå•ä½æ—¶é—´å†…å¤„ç†çš„è¯·æ±‚æ•°é‡</p>\n<hr/>\n<p><strong>3ï¸âƒ£æ¯ç§’æŸ¥è¯¢ç‡QPSï¼ˆQuery Per Secondï¼‰</strong></p>\n<p>ğŸ“—å«ä¹‰ ï¼šæ¯ç§’å“åº”è¯·æ±‚æ•°</p>\n<p>ğŸ“–åœ¨äº’è”ç½‘é¢†åŸŸï¼Œè¿™ä¸ªæŒ‡æ ‡å’Œååé‡åŒºåˆ†çš„æ²¡æœ‰è¿™ä¹ˆæ˜æ˜¾</p>\n<hr/>\n<p><strong>4ï¸âƒ£å¹¶å‘ç”¨æˆ·æ•°</strong></p>\n<p>ğŸ“—å«ä¹‰ï¼šåŒæ—¶æ‰¿è½½æ­£å¸¸ä½¿ç”¨ç³»ç»ŸåŠŸèƒ½çš„ç”¨æˆ·æ•°é‡</p>\n<p>ğŸŒ°ä¸¾ä¸ªä¾‹å­ï¼šä¾‹å¦‚ä¸€ä¸ªå³æ—¶é€šè®¯ç³»ç»Ÿï¼ŒåŒæ—¶åœ¨çº¿é‡ä¸€å®šç¨‹åº¦ä¸Šä»£è¡¨äº†ç³»ç»Ÿçš„å¹¶å‘ç”¨æˆ·æ•°</p>\n</blockquote>\n<h2 id=\"%F0%9F%92%BB%E9%AB%98%E5%B9%B6%E5%8F%91%E5%92%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%B3%E7%B3%BB%E5%92%8C%E5%8C%BA%E5%88%AB%EF%BC%9F\">ğŸ’»<strong>é«˜å¹¶å‘å’Œå¤šçº¿ç¨‹çš„å…³ç³»å’ŒåŒºåˆ«ï¼Ÿ</strong></h2>\n<blockquote>\n<p><strong>â€œé«˜å¹¶å‘å’Œå¤šçº¿ç¨‹â€</strong>   æ€»æ˜¯è¢«ä¸€èµ·æèµ·ï¼Œç»™äººæ„Ÿè§‰ä¸¤è€…å¥½åƒç›¸ç­‰ï¼Œå®åˆ™    ã€<strong><span style=\"color:#be191c;\">é«˜å¹¶å‘ â‰  å¤šçº¿ç¨‹</span><span style=\"color:#0d0016;\">ã€‘</span></strong></p>\n<hr/>\n<p><strong>1ï¸âƒ£å¤šçº¿ç¨‹</strong></p>\n<p></p>\n<ul><li>å¤šçº¿ç¨‹æ˜¯javaçš„ç‰¹æ€§ï¼Œå› ä¸ºç°åœ¨CPUéƒ½æ˜¯å¤šæ ¸å¤šçº¿ç¨‹çš„ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œå‡ ä¸ªä»»åŠ¡ï¼Œä¸ºäº†æé«˜jvmçš„æ‰§è¡Œæ•ˆç‡ï¼Œjavaæä¾›äº†è¿™ç§å¤šçº¿ç¨‹çš„æœºåˆ¶ï¼Œä»¥å¢å¼ºæ•°æ®å¤„ç†æ•ˆç‡</li><li>å¤šçº¿ç¨‹å¯¹åº”çš„æ˜¯CPUï¼Œé«˜å¹¶å‘å¯¹åº”çš„æ˜¯è®¿é—®è¯·æ±‚ï¼Œå¯ä»¥ç”¨å•çº¿ç¨‹å¤„ç†æ‰€æœ‰è®¿é—®è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ç”¨å¤šçº¿ç¨‹åŒæ—¶å¤„ç†è®¿é—®è¯·æ±‚</li><li>åœ¨è¿‡å»å•CPUæ—¶ä»£ï¼Œå•ä»»åŠ¡åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹åªèƒ½æ‰§è¡Œå•ä¸€ç¨‹åºã€‚ä¹‹åå‘å±•åˆ°å¤šä»»åŠ¡é˜¶æ®µï¼Œè®¡ç®—æœºèƒ½åœ¨åŒä¸€æ—¶é—´ç‚¹å¹¶è¡Œæ‰§è¡Œå¤šä»»åŠ¡æˆ–å¤šè¿›ç¨‹</li><li>è™½ç„¶å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ <strong>â€œåŒä¸€æ—¶é—´ç‚¹â€</strong>ï¼Œè€Œæ˜¯å¤šä¸ªä»»åŠ¡æˆ–è¿›ç¨‹å…±äº«ä¸€ä¸ªCPUï¼Œå¹¶äº¤ç”±æ“ä½œç³»ç»Ÿæ¥å®Œæˆå¤šä»»åŠ¡é—´å¯¹CPUçš„è¿è¡Œåˆ‡æ¢ï¼Œä»¥ä½¿å¾—æ¯ä¸ªä»»åŠ¡éƒ½æœ‰æœºä¼šè·å¾—ä¸€å®šçš„æ—¶é—´ç‰‡è¿è¡Œ</li><li>å†åæ¥å‘å±•åˆ°å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œä½¿å¾—åœ¨ä¸€ä¸ªç¨‹åºå†…éƒ¨èƒ½æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªCPUåœ¨æ‰§è¡Œè¯¥ç¨‹åºã€‚å½“ä¸€ä¸ªç¨‹åºè¿è¡Œåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œå°±å¥½åƒæœ‰å¤šä¸ªCPUåœ¨åŒæ—¶æ‰§è¡Œè¯¥ç¨‹åº</li><li>ğŸ“—æ€»ç»“ï¼šå¤šçº¿ç¨‹æ˜¯å¤„ç†é«˜å¹¶å‘çš„ä¸€ç§ç¼–ç¨‹æ–¹æ³•ï¼Œå³å¹¶å‘éœ€è¦ç”¨å¤šçº¿ç¨‹å®ç°</li></ul>\n<hr/>\n<p><strong>2ï¸âƒ£é«˜å¹¶å‘</strong></p>\n<p></p>\n<ul><li>é«˜å¹¶å‘ä¸æ˜¯JAVAçš„ä¸“æœ‰çš„ä¸œè¥¿ï¼Œæ˜¯è¯­è¨€æ— å…³çš„å¹¿ä¹‰çš„ï¼Œä¸ºæä¾›æ›´å¥½äº’è”ç½‘æœåŠ¡è€Œæå‡ºçš„æ¦‚å¿µ</li><li>å…¸å‹çš„åœºæ™¯ï¼šä¾‹å¦‚ï¼Œ12306æŠ¢ç«è½¦ç¥¨ï¼Œå¤©çŒ«åŒåä¸€ç§’æ€æ´»åŠ¨ç­‰ã€‚è¯¥æƒ…å†µçš„å‘ç”Ÿä¼šå¯¼è‡´ç³»ç»Ÿåœ¨è¿™æ®µæ—¶é—´å†…æ‰§è¡Œå¤§é‡æ“ä½œï¼Œä¾‹å¦‚å¯¹èµ„æºçš„è¯·æ±‚ï¼Œæ•°æ®åº“çš„æ“ä½œç­‰ã€‚</li><li>å¦‚æœé«˜å¹¶å‘å¤„ç†ä¸å¥½ï¼Œä¸ä»…ä»…é™ä½äº†ç”¨æˆ·çš„ä½“éªŒåº¦ï¼ˆè¯·æ±‚å“åº”æ—¶é—´è¿‡é•¿ï¼‰ï¼ŒåŒæ—¶å¯èƒ½å¯¼è‡´ç³»ç»Ÿå®•æœºï¼Œä¸¥é‡çš„ç”šè‡³å¯¼è‡´OOMå¼‚å¸¸ï¼Œç³»ç»Ÿåœæ­¢å·¥ä½œç­‰</li><li>å¦‚æœï¼Œè¦æƒ³ç³»ç»Ÿèƒ½å¤Ÿé€‚åº”é«˜å¹¶å‘çŠ¶æ€ï¼Œåˆ™éœ€è¦ä»å„ä¸ªæ–¹é¢è¿›è¡Œç³»ç»Ÿä¼˜åŒ–ï¼ŒåŒ…æ‹¬ï¼Œç¡¬ä»¶ã€ç½‘ç»œã€ç³»ç»Ÿæ¶æ„ã€å¼€å‘è¯­è¨€çš„é€‰å–ã€æ•°æ®ç»“æ„çš„è¿ç”¨ã€ç®—æ³•ä¼˜åŒ–ã€æ•°æ®åº“ä¼˜åŒ–ç­‰ï¼Œè€Œå¤šçº¿ç¨‹åªæ˜¯å…¶ä¸­è§£å†³æ–¹æ³•ä¹‹ä¸€</li></ul>\n</blockquote>\n<h1 id=\"%E4%BA%8C%E3%80%81%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E5%99%A8%2F%E5%AE%A2%E6%88%B7%E7%AB%AF\">äºŒã€æ­å»ºæœåŠ¡å™¨/å®¢æˆ·ç«¯</h1>\n<h2 id=\"%F0%9F%92%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81\">ğŸ’»æœåŠ¡å™¨ä»£ç ï¼ˆ4ç§ç±»çš„å°è£…ï¼‰</h2>\n<blockquote>\n<ul><li><strong>ğŸ”åœ°å€ç±»</strong></li><li><strong>ğŸŸsocketåŸºç±»</strong></li><li><strong>ğŸ•TCPæ´¾ç”Ÿç±»</strong></li><li><strong>ğŸ¿epollç±»</strong></li></ul>\n</blockquote>\n<h3 id=\"%F0%9F%8C%88%E5%9C%B0%E5%9D%80%E7%B1%BB%EF%BC%88CHostAddress%EF%BC%89\">ğŸŒˆåœ°å€ç±»ã€CHostAddressã€‘</h3>\n<p id=\"1%EF%BC%89CHostAddress.h\"><strong>ğŸ“CHostAddress.h</strong></p>\n<pre><code class=\"language-cpp\">#pragma once\n#include &lt;sys/types.h&gt;          /* See NOTES */\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;string.h&gt;\n#include &lt;arpa/inet.h&gt;\n\nclass CHostAddress\n{\npublic:\n\tCHostAddress(char* ip, unsigned short port);\n\t~CHostAddress();\n\n\tchar* getIp();\n\tvoid setIp(char* ip);\n\n\tunsigned short getPort();\n\tvoid setPort(unsigned short port);\n\n\tstruct sockaddr_in getAddr_in();\n\tstruct sockaddr* getAddr();\n\n\tint getLength();\n\nprivate:\n\tchar ip[16]; //ä¿å­˜ipåœ°å€\n\tint length; //ä¿å­˜ sockaddr_in ç»“æ„ä½“é•¿åº¦\n\tunsigned short port; //ç«¯å£å·\n\tstruct sockaddr_in s_addr;\n\n};\n</code></pre>\n<p id=\"%C2%A0%F0%9F%93%8DCHostAddress.cpp\"><strong>ğŸ“CHostAddress.cpp</strong></p>\n<pre><code class=\"language-cpp\">#include \"CHostAddress.h\"\n\nCHostAddress::CHostAddress(char* ip, unsigned short port)\n{\n    memset(this-&gt;ip, 0, sizeof(this-&gt;ip));\n    strcpy(this-&gt;ip, ip);\n\n    this-&gt;port = port;\n\n    this-&gt;s_addr.sin_family = AF_INET; \n    this-&gt;s_addr.sin_port = htons(this-&gt;port); \n    this-&gt;s_addr.sin_addr.s_addr = inet_addr(this-&gt;ip);\n\n    this-&gt;length = sizeof(this-&gt;s_addr);\n}\n\nCHostAddress::~CHostAddress()\n{\n\n}\n\nchar* CHostAddress::getIp()\n{\n    return this-&gt;ip;\n}\n\nvoid CHostAddress::setIp(char* ip)\n{\n    strcpy(this-&gt;ip, ip);\n}\n\nunsigned short CHostAddress::getPort()\n{\n    return this-&gt;port;\n}\n\nvoid CHostAddress::setPort(unsigned short port)\n{\n    this-&gt;port = port;\n}\n\nsockaddr_in CHostAddress::getAddr_in()\n{\n    return this-&gt;s_addr;\n}\n\nsockaddr* CHostAddress::getAddr()\n{\n    // bindå‡½æ•°éœ€è¦ç”¨åˆ°struct sockaddr *ï¼Œå› æ­¤returnç±»å‹è½¬æ¢ä¹‹åæ•°æ®\n    return (struct sockaddr*)&amp;(this-&gt;s_addr);\n}\n\nint CHostAddress::getLength()\n{\n    return this-&gt;length;\n}</code></pre>\n<h3 id=\"%F0%9F%8C%88socket%E5%9F%BA%E7%B1%BB%EF%BC%88CBaseSocket%EF%BC%89\">ğŸŒˆsocketç±»ã€CBaseSocketã€‘</h3>\n<p id=\"1%EF%BC%89CBaseSocket.h\"><strong>ğŸ“CBaseSocket.h</strong></p>\n<pre><code class=\"language-cpp\">#pragma once\n\n#include &lt;sys/types.h&gt; //socketå¤´æ–‡ä»¶        \n#include &lt;sys/socket.h&gt;//socketå¤´æ–‡ä»¶  \n#include &lt;netinet/in.h&gt;\n#include &lt;stdio.h&gt;\n\nclass CBaseSocket\n{\npublic:\n\tCBaseSocket(char* ip, unsigned short port);\n\t~CBaseSocket();\n\tvoid Start();\n\tint getSocketFd();\n\tvirtual void Run() = 0;//å†™æˆçº¯è™šå‡½æ•°ï¼Œå­ç±»æ¥å®ç°\n\tvirtual void Stop() = 0;//å†™æˆçº¯è™šå‡½æ•°ï¼Œå­ç±»æ¥å®ç°\n\nprotected:\n\tint socketFd;//å†™åˆ°å—ä¿æŠ¤åŒºï¼Œå­ç±»å¯ä»¥ç”¨åˆ°\n\n};</code></pre>\n<p id=\"%F0%9F%93%8DCBaseSocket.cpp%C2%A0\">ğŸ“<strong>CBaseSocket.cpp </strong></p>\n<pre><code class=\"language-cpp\">#include \"CBaseSocket.h\"\n\nCBaseSocket::CBaseSocket(char* ip, unsigned short port)\n{\n\tthis-&gt;socketFd = 0;\n}\n\nCBaseSocket::~CBaseSocket()\n{\n}\n\nvoid CBaseSocket::Start()\n{\n\t//æ‰“é€šç½‘ç»œé€šé“\n\tthis-&gt;socketFd = socket(AF_INET, SOCK_STREAM, 0);//IPPROTO_TCPç”¨0æ›¿æ¢ä¹Ÿè¡Œ\n\n\tif (this-&gt;socketFd &lt; 0)//å¤§äº0æˆåŠŸï¼Œå°äº0å¤±è´¥\n\t{\n\t\tperror(\"socket error\");//socketåˆ›å»ºå¤±è´¥\n\t}\n\n\tthis-&gt;Run();//å­ç±»å®ç°çš„runå‡½æ•°\n}\n\nint CBaseSocket::getSocketFd()\n{\n\treturn this-&gt;socketFd;\n}</code></pre>\n<h3 id=\"%F0%9F%8C%88TCP%E6%B4%BE%E7%94%9F%E7%B1%BB%EF%BC%88CTcpServer%EF%BC%89\">ğŸŒˆTCPç±»ã€CTcpServerã€‘</h3>\n<p id=\"%F0%9F%93%8DCTcpServer.h%C2%A0\">ğŸ“<strong>CTcpServer.h </strong></p>\n<pre><code class=\"language-cpp\">#pragma once\n\n#include&lt;iostream&gt;\n#include \"CBaseSocket.h\"\n#include \"CHostAddress.h\"\n#include &lt;netinet/in.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;          /* See NOTES */\n#include &lt;sys/socket.h&gt;\n\nusing namespace std;\n\n#define LISTEN_MAX_NUM 10  \n\nclass CTcpServer :\n    public CBaseSocket\n{\npublic:\n    CTcpServer(char* ip, unsigned short port);\n    ~CTcpServer();\n    void Run();\n    void Stop();\n    CHostAddress* getAddress();\n    void setAddress(CHostAddress* address);\n\nprivate:\n    CHostAddress* address;//åœ°å€ç±»\n};</code></pre>\n<p id=\"%F0%9F%93%8DCTcpServer.cpp%C2%A0\">ğŸ“<strong>CTcpServer.cpp </strong></p>\n<pre><code class=\"language-cpp\">#include \"CTcpSever.h\"\n\nCTcpServer::CTcpServer(char* ip, unsigned short port)\n    :CBaseSocket(ip, port)\n{\n    this-&gt;address = new CHostAddress(ip, port);\n}\n\nCTcpServer::~CTcpServer()\n{\n}\n\nvoid CTcpServer::Run()\n{\n    int opt_val = 1;\n    int res = 0;\n\n    //ç«¯å£å¤ç”¨ è§£å†³å‡ºç° adress already useçš„é—®é¢˜\n    res = setsockopt(this-&gt;socketFd, SOL_SOCKET, SO_REUSEADDR, (const void*)&amp;opt_val, sizeof(opt_val));\n    if (res == -1)\n    {\n        perror(\"setsockopt error\");\n    }\n    //ç»‘å®šç«¯å£å·å’Œåœ°å€ åè®®æ—\n    res = bind(this-&gt;socketFd, this-&gt;address-&gt;getAddr(), this-&gt;address-&gt;getLength());\n    if (res == -1)\n    {\n        perror(\"bind error\");\n    }\n    //ç›‘å¬è¿™ä¸ªåœ°å€å’Œç«¯å£æœ‰æ²¡æœ‰å®¢æˆ·ç«¯æ¥è¿æ¥\n    res = listen(this-&gt;socketFd, LISTEN_MAX_NUM);\n    if (res == -1)\n    {\n        perror(\"listen error\");\n    }\n    cout &lt;&lt; \"Server start success socketFd = \" &lt;&lt; this-&gt;socketFd &lt;&lt; endl;\n}\n\nvoid CTcpServer::Stop()\n{\n    if (this-&gt;socketFd != 0)\n    {\n        close(this-&gt;socketFd);\n        this-&gt;socketFd = 0;\n    }\n}\n\nCHostAddress* CTcpServer::getAddress()\n{\n    return this-&gt;address;\n}\n\nvoid CTcpServer::setAddress(CHostAddress* address)\n{\n    this-&gt;address = address;\n}</code></pre>\n<h3 id=\"%F0%9F%8C%88epoll%E7%B1%BB%20%EF%BC%88CEpollServer%EF%BC%89\">ğŸŒˆepollç±» ã€CEpollServerã€‘</h3>\n<p id=\"%C2%A0%F0%9F%93%8DCEpollServer.h\"><strong> </strong>ğŸ“<strong>CEpollServer.h</strong></p>\n<pre><code class=\"language-cpp\">#pragma once\n#include &lt;sys/epoll.h&gt;\n#include &lt;iostream&gt;\n#include \"CTcpSever.h\"\n\n#define EPOLL_SIZE 5\n\nusing namespace std;\n\nclass CEpollServer\n{\npublic:\n\tCEpollServer(char* ip, unsigned short port);\n\t~CEpollServer();\n\tvoid Start();\n\nprivate:\n\tint epollfd;\n\tint epollwaitefd;\n\tint acceptFd;\n\tchar buf[1024]; //å­˜æ”¾å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯\n\tstruct epoll_event epollEvent;\n\tstruct epoll_event epollEventArray[5];\n\tCTcpServer* tcp;//TCPç±»\n\n};\n</code></pre>\n<p id=\"%F0%9F%93%8D%C2%A0CEpollServer.cpp\">ğŸ“<strong> CEpollServer.cpp</strong></p>\n<pre><code class=\"language-cpp\">#include \"CEpollServer.h\"\n\nCEpollServer::CEpollServer(char* ip, unsigned short port)\n{\n\t//åˆå§‹åŒ– TcpServerç±»\n\tthis-&gt;tcp = new CTcpServer(ip, port);\n\tthis-&gt;tcp-&gt;Start();\n\tcout &lt;&lt; \"socketFd = \" &lt;&lt; this-&gt;tcp-&gt;getSocketFd() &lt;&lt; endl;\n\n\t//åˆå§‹åŒ–æ•°æ®æˆå‘˜\n\tthis-&gt;epollfd = 0;\n\tthis-&gt;epollwaitefd = 0;\n\tthis-&gt;acceptFd = 0;\n\tbzero(this-&gt;buf, sizeof(this, buf));\n\n\t//äº‹ä»¶ç»“æ„ä½“åˆå§‹åŒ–\n\tbzero(&amp;(this-&gt;epollEvent), sizeof(this-&gt;epollEvent));\n\t//ç»‘å®šå½“å‰å‡†å¤‡å¥½çš„sockedfdï¼ˆå¯ç”¨ç½‘ç»œå¯¹è±¡ï¼‰\n\tthis-&gt;epollEvent.data.fd = this-&gt;tcp-&gt;getSocketFd();\n\t//ç»‘å®šäº‹ä»¶ä¸ºå®¢æˆ·ç«¯æ¥å…¥äº‹ä»¶\n\tthis-&gt;epollEvent.events = EPOLLIN;\n\t//åˆ›å»ºepoll\n\tthis-&gt;epollfd = epoll_create(EPOLL_SIZE);\n\t//å°†å·²ç»å‡†å¤‡å¥½çš„ç½‘ç»œæè¿°ç¬¦æ·»åŠ åˆ°epolläº‹ä»¶é˜Ÿåˆ—ä¸­\n\tepoll_ctl(this-&gt;epollfd, EPOLL_CTL_ADD, this-&gt;tcp-&gt;getSocketFd(), &amp;(this-&gt;epollEvent));\n}\n\nCEpollServer::~CEpollServer()\n{\n}\n\nvoid CEpollServer::Start()\n{\n\twhile (1)\n\t{\n\t\tcout &lt;&lt; \"epoll wait client\" &lt;&lt; endl;\n\t\tthis-&gt;epollwaitefd = epoll_wait(this-&gt;epollfd, epollEventArray, EPOLL_SIZE, -1);\n\t\tif (this-&gt;epollwaitefd &lt; 0)\n\t\t{\n\t\t\tperror(\"epoll wait error\");\n\t\t}\n\t\tfor (int i = 0; i &lt; this-&gt;epollwaitefd; i++)\n\t\t{\n\t\t\t//åˆ¤æ–­æ˜¯å¦æœ‰å®¢æˆ·ç«¯ä¸Šçº¿\n\t\t\tif (epollEventArray[i].data.fd == this-&gt;tcp-&gt;getSocketFd())\n\t\t\t{\n\t\t\t\tcout &lt;&lt; \"ç½‘ç»œ_å¼€å§‹å·¥ä½œ_ç­‰å¾…å®¢æˆ·ç«¯_ä¸Šçº¿\" &lt;&lt; endl;\n\t\t\t\tthis-&gt;acceptFd = accept(this-&gt;tcp-&gt;getSocketFd(), NULL, NULL);\n\t\t\t\tcout &lt;&lt; \"acceptfd = \" &lt;&lt; this-&gt;acceptFd &lt;&lt; endl;\n\n\t\t\t\t//ä¸Šçº¿çš„å®¢æˆ·ç«¯æè¿°ç¬¦æ˜¯acceptfd ç»‘å®šäº‹ä»¶æ·»åŠ åˆ°epoll\n\t\t\t\tepollEvent.data.fd = this-&gt;acceptFd;\n\t\t\t\tepollEvent.events = EPOLLIN; //EPOLLINè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»\n\t\t\t\tepoll_ctl(this-&gt;epollfd, EPOLL_CTL_ADD, this-&gt;acceptFd, &amp;epollEvent);\n\t\t\t}\n\t\t\telse if (epollEventArray[i].events &amp; EPOLLIN)\n\t\t\t{\n\t\t\t\tbzero(this-&gt;buf, sizeof(this-&gt;buf));\n\t\t\t\tint res = read(epollEventArray[i].data.fd, this-&gt;buf, sizeof(this-&gt;buf));\n\t\t\t\tif (res &gt; 0)\n\t\t\t\t{\n\t\t\t\t\tcout &lt;&lt; \"æœåŠ¡å™¨_æ”¶åˆ° fd = \" &lt;&lt; epollEventArray[i].data.fd &lt;&lt; \"  é€è¾¾æ•°æ®: buf = \" &lt;&lt; this-&gt;buf &lt;&lt; endl;\n\t\t\t\t}\n\t\t\t\telse if (res &lt;= 0)\n\t\t\t\t{\n\t\t\t\t\tcout &lt;&lt; \"å®¢æˆ·ç«¯ fd = \" &lt;&lt; epollEventArray[i].data.fd &lt;&lt; \" _æ‰çº¿_\" &lt;&lt; endl;\n\t\t\t\t\tclose(epollEventArray[i].data.fd);\n\n\t\t\t\t\t//ä»epollä¸­åˆ é™¤å®¢æˆ·ç«¯æè¿°ç¬¦\n\t\t\t\t\tepollEvent.data.fd = epollEvent.data.fd;\n\t\t\t\t\tepollEvent.events = EPOLLIN;\n\t\t\t\t\tepoll_ctl(this-&gt;epollfd, EPOLL_CTL_DEL, epollEventArray[i].data.fd, &amp;epollEvent);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}</code></pre>\n<h2 id=\"%F0%9F%92%BB%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81\">ğŸ’»<strong>å®¢æˆ·ç«¯ä»£ç </strong></h2>\n<pre><code class=\"language-cpp\">#include &lt;iostream&gt;\n#include &lt;sys/types.h&gt;          \n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;arpa/inet.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;string.h&gt;\n\nusing namespace std;\n\nint main()\n{\n\tint socketfd = 0;\n\tint acceptfd = 0;\n\tint len = 0;\n\tint res = 0;\n\tchar buf[255] = { 0 };//åˆå§‹åŒ–\n\n\t//åˆå§‹åŒ–ç½‘ç»œ\n\tsocketfd = socket(AF_INET, SOCK_STREAM, 0);\n\tif (socketfd == -1)\n\t{\n\t\tperror(\"socket error\");\n\t}\n\telse\n\t{\n\t\tstruct sockaddr_in s_addr;\n\t\t//ç¡®å®šä½¿ç”¨å“ªä¸ªåè®®æ—  ipv4\n\t\ts_addr.sin_family = AF_INET;\n\n\t\t//å¡«å…¥æœåŠ¡å™¨çš„ipåœ°å€  ä¹Ÿå¯ä»¥æ˜¯  127.0.0.1 ï¼ˆå›ç¯åœ°å€ï¼‰\n\t\ts_addr.sin_addr.s_addr = inet_addr(\"192.168.48.129\");\n\n\t\t//ç«¯å£ä¸€ä¸ªè®¡ç®—æœºæœ‰65535ä¸ª  10000ä»¥ä¸‹æ˜¯æ“ä½œç³»ç»Ÿè‡ªå·±ä½¿ç”¨çš„ï¼Œè‡ªå·±å®šä¹‰çš„ç«¯å£å·ä¸º10000ä»¥å\n\t\ts_addr.sin_port = htons(12345);  //è‡ªå®šä¹‰ç«¯å£å·ä¸º12345\n\n\t\tlen = sizeof(s_addr);\n\n\t\t//ç»‘å®šipåœ°å€å’Œç«¯å£å·\n\t\tint res = connect(socketfd, (struct sockaddr*)&amp;s_addr, len);\n\t\tif (res == -1)\n\t\t{\n\t\t\tperror(\"connect error\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\twhile (1)\n\t\t\t{\n\t\t\t\tcout &lt;&lt; \"è¯·è¾“å…¥å†…å®¹ï¼š\" &lt;&lt; endl;\n\t\t\t\tcin &gt;&gt; buf;\n\t\t\t\twrite(socketfd, buf, sizeof(buf));\n\t\t\t\tbzero(buf, sizeof(buf));\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}</code></pre>\n<h2 id=\"%F0%9F%92%BB%E6%A1%88%E4%BE%8B%E6%B5%8B%E8%AF%95\">ğŸ’»<strong>æ¡ˆä¾‹æµ‹è¯•</strong></h2>\n<p id=\"main.cpp\">ğŸ“<strong>main.cpp</strong></p>\n<pre><code class=\"language-cpp\">#include &lt;iostream&gt;\n#include \"CEpollServer.h\"\n\nusing namespace std;\n\nint main()\n{\n\tCEpollServer* epoll = new CEpollServer(\"192.168.48.129\", 12345);\n\tepoll-&gt;Start();\n\treturn 0;\n}</code></pre>\n<p id=\"%F0%9F%93%8D%E6%B5%8B%E8%AF%95%E6%95%88%E6%9E%9C%C2%A0\">ğŸ“<strong>æµ‹è¯•æ•ˆæœ </strong></p>\n<p>é€šè¿‡Linuxè¿æ¥VSè¿›è¡Œè·¨å¹³å°ç¼–ç¨‹ï¼Œä¸Šä¸ºæœ¬æ–‡è®¾è®¡çš„æœåŠ¡å™¨ï¼Œä¸‹ä¸ºä¸¤ä¸ªä¸ä¹‹ç›¸è¿çš„å®¢æˆ·ç«¯ï¼Œåœ¨å®¢æˆ·ç«¯1å’Œå®¢æˆ·ç«¯2ä¸­è¾“å…¥å†…å®¹ï¼ŒæœåŠ¡å™¨ä¸Šèƒ½æ¥æ”¶åˆ°ç›¸åº”çš„ä¿¡æ¯ï¼Œå³è¡¨ç¤ºæµ‹è¯•æˆåŠŸï¼å¦‚ä¸‹åŠ¨å›¾æ‰€ç¤ºï¼š </p>\n<p><img alt=\"\" src=\"https://img-blog.csdnimg.cn/e5b46f537b794429b321992e509f28a9.gif\"/></p>\n<p></p>\n<p><strong>å‚è€ƒï¼š</strong></p>\n<p><a href=\"https://www.csdn.net/tags/MtjaUgxsMzAzMjgtYmxvZwO0O0OO0O0O.html\" title=\"https://www.csdn.net/tags/MtjaUgxsMzAzMjgtYmxvZwO0O0OO0O0O.html\">https://www.csdn.net/tags/MtjaUgxsMzAzMjgtYmxvZwO0O0OO0O0O.html</a>  </p>\n<p><a href=\"https://blog.csdn.net/wmcy123/article/details/124054385\" title=\"ã€Linuxã€‘é«˜å¹¶å‘æœåŠ¡å™¨è®¾è®¡â€”â€”socketå°è£…_ä¼¼æœ«çš„åšå®¢-CSDNåšå®¢_linux socket é«˜å¹¶å‘\">ã€Linuxã€‘é«˜å¹¶å‘æœåŠ¡å™¨è®¾è®¡â€”â€”socketå°è£…_ä¼¼æœ«çš„åšå®¢-CSDNåšå®¢_linux socket é«˜å¹¶å‘</a></p>\n<p></p>\n<p><span style=\"color:#38d8f0;\"><strong><em>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹å•¦ï¼å¦‚æœå¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œéº»çƒ¦ç‚¹èµå•¦ï¼æ”¶è—å•¦ï¼æ¬¢è¿å„ä½è¯„è®ºåŒºç•™è¨€</em>ï¼ï¼ï¼</strong></span></p>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"https://img-blog.csdnimg.cn/9b848022d42d491cb0d59ea13b5f2f84.gif\"/></p>\n<p style=\"text-align:center;\"></p>\n</div>\n</div>", "first_tag": "Java", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 1, "sql": 0, "php": 0, "time": "2022-07-13 12:16:53", "summary": "ç›®å½•å‰è¨€ä¸€ã€é«˜å¹¶å‘æœåŠ¡å™¨ä»€ä¹ˆæ˜¯é«˜å¹¶å‘ï¼Ÿé«˜å¹¶å‘çš„å¤„ç†æŒ‡æ ‡ï¼Ÿé«˜å¹¶å‘å’Œå¤šçº¿ç¨‹çš„å…³ç³»å’ŒåŒºåˆ«ï¼ŸäºŒã€æ­å»ºæœåŠ¡å™¨å®¢æˆ·ç«¯æœåŠ¡å™¨ä»£ç ç§ç±»çš„å°è£…åœ°å€ç±»ç±»ç±»ç±»å®¢æˆ·ç«¯ä»£ç æ¡ˆä¾‹æµ‹è¯•å‰è¨€æœ¬æ–‡ä¸»è¦å­¦ä¹ å†…æ ¸ç¼–ç¨‹ï¼Œç»“åˆè¿›è¡Œè·¨å¹³å°ç¼–ç¨‹ï¼Œ"}