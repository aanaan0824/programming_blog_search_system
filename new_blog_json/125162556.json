{"blogid": "125162556", "writerAge": "码龄6年", "writerBlogNum": "71", "writerCollect": "40", "writerComment": "1", "writerFan": "8", "writerGrade": "4级", "writerIntegral": "1271", "writerName": ".周周", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125162556.jpg", "writerRankTotal": "27925", "writerRankWeekly": "29110", "writerThumb": "10", "writerVisitNum": "81024", "blog_read_count": "1529", "blog_time": "已于 2022-06-08 13:43:55 修改", "blog_title": "php 使用3des加解密、hmacsha256加密", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>一、3des加解密</p>\n<p>从PHP 7.2起它将被从核心代码中移除并且移到PECL中。PHP手册在7.1迁移页面给出了替代方案,就是用OpenSSL取代MCrypt。</p>\n<p>现整理PHP7.2中AES加密解密方法mcrypt_module_open()替换方案，以下为原加解密方法：</p>\n<pre><code class=\"language-php\">function encrypt($str) { \n \n        $td = mcrypt_module_open(MCRYPT_RIJNDAEL_128, '', MCRYPT_MODE_CBC, ''); \n \n        mcrypt_generic_init($td, $this-&gt;key, $this-&gt;hexToStr($this-&gt;hex_iv)); \n \n        $block = mcrypt_get_block_size(MCRYPT_RIJNDAEL_128, MCRYPT_MODE_CBC); \n \n        $pad = $block - (strlen($str) % $block); \n \n        $str .= str_repeat(chr($pad), $pad); \n \n        $encrypted = mcrypt_generic($td, $str); \n \n        mcrypt_generic_deinit($td); \n \n        mcrypt_module_close($td); \n \n        return base64_encode($encrypted); \n \n    } \n \n    function decrypt($code) { \n \n        $td = mcrypt_module_open(MCRYPT_RIJNDAEL_128, '', MCRYPT_MODE_CBC, ''); \n \n        mcrypt_generic_init($td, $this-&gt;key, $this-&gt;hexToStr($this-&gt;hex_iv)); \n \n        $str = mdecrypt_generic($td, base64_decode($code)); \n \n        $block = mcrypt_get_block_size(MCRYPT_RIJNDAEL_128, MCRYPT_MODE_CBC); \n \n        mcrypt_generic_deinit($td); \n \n        mcrypt_module_close($td); \n \n        return $this-&gt;strippadding($str); \n \n    }</code></pre>\n<p>替换后，新方法：</p>\n<pre><code class=\"language-php\">//加密\npublic function encrypt($data)\n{\n \n    if ($data== null || empty($data)) {\n        return $data;\n    }\n    $secret_key = \"your key\";\n    $iv = \"your iv\";\n    $result= base64_encode(openssl_encrypt( $data, \"aes-256-cbc\", $secret_key, OPENSSL_RAW_DATA, $iv));\n \n    return $result;\n    \n}\n \n//解密\npublic function decode($data)\n{\n    if ($data== null || empty($data)) {\n        return $data;\n    }\n    $secret_key = \"your key\";\n    $iv = \"your iv\";\n    $result= openssl_decrypt(base64_decode($data), \"aes-256-cbc\", $secret_key, OPENSSL_RAW_DATA, $iv);\n \n    return $result;\n   \n}</code></pre>\n<p>加密方法：</p>\n<p>openssl_encrypt($data, $method, $password, $options, $iv)<br/> 解密方法：</p>\n<p>openssl_decrypt($data, $method, $password, $options, $iv)<br/> 参数说明：</p>\n<p>$data 加密明文</p>\n<p>$method 加密方法</p>\n<p>1、DES-ECB<br/> 2、DES-CBC<br/> 3、DES-CTR<br/> 4、DES-OFB<br/> 5、DES-CFB<br/> $passwd 加密密钥[密码]</p>\n<p>$options 数据格式选项（可选）【选项有：】</p>\n<p>1、0<br/> 2、OPENSSL_RAW_DATA=1<br/> 3、OPENSSL_ZERO_PADDING=2<br/> 4、OPENSSL_NO_PADDING=3<br/> $iv 密初始化向量（可选）</p>\n<p>DES 是对称性加密里面常见一种，是一种使用密钥加密的块算法。</p>\n<pre>二、hmacsha256加密</pre>\n<p>使用hash_hmac()</p>\n<p>string hash_hmac ( string $algo , string $data , string $key [, bool $raw_output = false ] )</p>\n<p><br/> 参数</p>\n<p>algo</p>\n<p>    要使用的哈希算法名称，例如：\"md5\"，\"sha256\"，\"haval160,4\" 等。 如何获取受支持的算法清单，请参见 hash_algos() 。<br/> data</p>\n<p>    要进行哈希运算的消息。<br/> key</p>\n<p>    使用 HMAC 生成信息摘要时所使用的密钥。<br/> raw_output</p>\n<p>    设置为 TRUE 输出原始二进制数据， 设置为 FALSE 输出小写 16 进制字符串。</p>\n<p>返回值</p>\n<p>如果 raw_output 设置为 TRUE ， 则返回原始二进制数据表示的信息摘要， 否则返回 16 进制小写字符串格式表示的信息摘要。 如果 algo 参数指定的不是受支持的算法，返回 FALSE 。</p>\n<p></p>\n</div>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-06-08 13:43:55", "summary": "一、加解密从起它将被从核心代码中移除并且移到中。手册在迁移页面给出了替代方案就是用取代。现整理中加密解密方法替换方案，以下为原加解密方法：替换后，新方法：加密解密加密方法：解密方法：参数说明：加密明文"}