{"blogid": "124572779", "writerAge": "码龄4年", "writerBlogNum": "26", "writerCollect": "54", "writerComment": "6", "writerFan": "332", "writerGrade": "3级", "writerIntegral": "460", "writerName": "妈妈我要吃烤地瓜", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124572779.jpg", "writerRankTotal": "44861", "writerRankWeekly": "10401", "writerThumb": "14", "writerVisitNum": "24428", "blog_read_count": "2596", "blog_time": "于 2022-05-04 16:34:56 发布", "blog_title": "mysql使用on duplicate key update批量更新数据", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p><strong>创建测试---book科目表</strong></p>\n<pre><code class=\"language-sql\">CREATE TABLE `book` (\n  `id` int NOT NULL AUTO_INCREMENT,\n  `unique_code` varchar(30) NOT NULL,\n  `book_name` varchar(20) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `unique_code` (`unique_code`) USING BTREE COMMENT 'book unique_code'\n) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;</code></pre>\n<p></p>\n<p></p>\n<p>前提需要表中存在索引：如下 <span style=\"color:#fe2c24;\"><strong>unique_code 即为索引</strong></span></p>\n<p><img alt=\"\" height=\"158\" src=\"..\\..\\static\\image\\01175c8cf68c4f6aa0207545df71d9e0.png\" width=\"1200\"/></p>\n<p></p>\n<p>需求：<strong>需要导入数据到book表。 当book表中存在科目的数据时，update数据值，否则insert插入一条新记录。</strong></p>\n<p>以往做法：循环select表中的booke记录是否存在，存在则使用update；不存在则使用insert。<br/> 做法弊端：每处理一条记录需要操作两次数据库（select、update/insert）</p>\n<p>优化做法：使用insert语句搭配 on duplicate key update使用。<br/> 做法注意：比如上面的需求，需要用到 <strong>book表</strong> <strong><span style=\"color:#fe2c24;\">唯一</span></strong> <span style=\"color:#fe2c24;\"><strong>unique_code索引</strong></span></p>\n<p></p>\n<h2>一、执行如下命令</h2>\n<pre><code class=\"language-sql\">insert into book(\n            unique_code,\n           book_name\n      ) values (\n            'zs-001',\n            '中文'\n      ) on duplicate key update book_name='数学';</code></pre>\n<p><img alt=\"\" height=\"180\" src=\"..\\..\\static\\image\\912ddf495fc344008656ed29c8c23e1c.png\" width=\"613\"/></p>\n<h3></h3>\n<h2>二、再次执行步骤一命令你会发现book_name值改变</h2>\n<p><img alt=\"\" height=\"192\" src=\"..\\..\\static\\image\\293bb159f9174043b9a2b426b8b20bec.png\" width=\"561\"/></p>\n<p> </p>\n<h3> 简单明白，通俗易懂~~</h3>\n<p></p>\n<p></p>\n</div>\n</div>", "first_tag": "SQL", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 1, "php": 0, "time": "2022-05-04 16:34:56", "summary": "创建测试科目表前提需要表中存在索引：如下即为索引需求：需要导入数据到表。当表中存在科目的数据时，数据值，否则插入一条新记录。以往做法：循环表中的记录是否存在，存在则使用；不存在则使用。做法弊端：每处理"}