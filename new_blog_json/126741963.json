{"blogid": "126741963", "writerAge": "码龄1年", "writerBlogNum": "46", "writerCollect": "5", "writerComment": "1", "writerFan": "13", "writerGrade": "3级", "writerIntegral": "468", "writerName": "炸鸡嘎嘎", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126741963.jpg", "writerRankTotal": "39106", "writerRankWeekly": "16572", "writerThumb": "6", "writerVisitNum": "11705", "blog_read_count": "21", "blog_time": "于 2022-09-07 12:34:18 发布", "blog_title": "kubectl应用", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#kubectl_1\">kubectl用法概述</a></li><li><a href=\"#kubectl_36\">kubectl输出格式</a></li><li><a href=\"#kubectl_107\">kubectl操作示例</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"kubectl_1\"></a>kubectl用法概述</h1>\n<p>kubectl命令语法</p>\n<pre><code class=\"prism language-bash\"><span class=\"token comment\"># kubectl [command] [TYPE] [NAME] [flags]</span>\n</code></pre>\n<p>其中，command、TYPE、NAME、flags的含义如下。</p>\n<p>（1）command：子命令，用于操作Kubernetes集群资源对象的命令，例如create、delete、describe、get、apply等。<br/> （2）TYPE：资源对象的类型，区分大小写，能以单数形式、复数形式或者简写形式表示。例如以下3种TYPE是等价的。</p>\n<pre><code class=\"prism language-bash\"><span class=\"token comment\"># kubectl get pod pod1</span>\n<span class=\"token comment\"># kubectl get pods pod1</span>\n<span class=\"token comment\"># kubectl get po pod1</span>\n</code></pre>\n<p>3）NAME：资源对象的名称，区分大小写。如果不指定名称，则系统将返回属于TYPE的全部对象的列表，例如$ kubectl get pods将返回所有Pod的列表。<br/> （4）flags：kubectl子命令的可选参数，例如使用“-s”指定apiserver的URL地址而不用默认值。</p>\n<p>在一个命令行中也可以同时对多个资源对象进行操作，以多个TYPE和NAME的组合表示，示例如下。</p>\n<p>获取多个Pod的信息</p>\n<pre><code class=\"prism language-bash\"><span class=\"token comment\"># kubectl get pods pod1 pod2</span>\n</code></pre>\n<p>同时应用多个yaml文件，以多个-f file参数表示</p>\n<pre><code class=\"prism language-bash\"><span class=\"token comment\"># kubectl get pod -f pod1.yaml -f pod2.yaml</span>\n<span class=\"token comment\"># kubectl create -f pod1.yaml -f rc1.yaml -f service1.yaml</span>\n</code></pre>\n<h1><a id=\"kubectl_36\"></a>kubectl输出格式</h1>\n<p>kubectl 命令可以用多种格式对结果进行显示，输出的格式通过-o参数指定：</p>\n<pre><code class=\"prism language-bash\"><span class=\"token comment\"># kubectl [command] [TYPE] [NAME] -o=&lt;output_format&gt;</span>\n</code></pre>\n<p>常用的输出格式如下：</p>\n<p>（1）显示Pod更多信息</p>\n<pre><code class=\"prism language-bash\">**<span class=\"token comment\"># kubectl get pod &lt;pod-name&gt; -o wide**</span>\n</code></pre>\n<p>（2）以yaml格式显示Pod的详细信息</p>\n<pre><code class=\"prism language-bash\">**<span class=\"token comment\"># kubectl get pod &lt;pod-name&gt; -o yaml**</span>\n</code></pre>\n<p>（3）以自定义列名显示Pod的信息</p>\n<pre><code class=\"prism language-bash\">**<span class=\"token comment\"># kubectl get pod &lt;pod-name&gt; -o=custom-columns=NAME:.metadata.name,RSRC:.metadata.resourceVersion**</span>\n</code></pre>\n<p>（4）基于文件的自定义列名输出</p>\n<pre><code class=\"prism language-bash\">**<span class=\"token comment\"># kubectl get pods &lt;pod-name&gt; -o=custom-columns-file=template.txt**</span>\n</code></pre>\n<p>template.txt文件的内容为</p>\n<pre><code class=\"prism language-bash\">NAME                RSRC\nmetadata.name       metadata.resourceVersion\n</code></pre>\n<p>输出结果</p>\n<pre><code class=\"prism language-bash\">**<span class=\"token comment\"># kubectl get pods chaosfomoney-deployment-64ccd59bdc-h72gh -o=custom-columns-file=template.txt** </span>\nNAME                                       RSRC\nchaosfomoney-deployment-64ccd59bdc-h72gh   <span class=\"token number\">101119</span>\n</code></pre>\n<p>将输出结果按某个字段排序，通过–sort-by参数以jsonpath表达式进行指定</p>\n<pre><code class=\"prism language-bash\">kubectl <span class=\"token punctuation\">[</span>command<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>TYPE<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>NAME<span class=\"token punctuation\">]</span> --sort-by<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>jsonpath_exp<span class=\"token operator\">&gt;</span>\n</code></pre>\n<p>例如按照名字进行排序</p>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl get pods</span>\nNAME                      READY   STATUS             RESTARTS   AGE\napache-594d8494b4-s6dfd   <span class=\"token number\">0</span>/1     ImagePullBackOff   <span class=\"token number\">0</span>          9m1s\nnginx-6799fc88d8-nbgc2    <span class=\"token number\">1</span>/1     Running            <span class=\"token number\">0</span>          35h\n</code></pre>\n<pre><code class=\"prism language-bash\"><span class=\"token comment\"># kubectl get pods --sort-by=.metadata.name</span>\nNAME                                       READY     STATUS    RESTARTS   AGE\nchaosfomoney-deployment-64ccd59bdc-h72gh   <span class=\"token number\">1</span>/1       Running   <span class=\"token number\">0</span>          1d\nchaosfomoney-deployment-64ccd59bdc-spnpj   <span class=\"token number\">1</span>/1       Running   <span class=\"token number\">0</span>          1d\nchaosfomoney-deployment-64ccd59bdc-xhnjr   <span class=\"token number\">1</span>/1       Running   <span class=\"token number\">0</span>          1d\n</code></pre>\n<h1><a id=\"kubectl_107\"></a>kubectl操作示例</h1>\n<p>查看所有node详细信息</p>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl get nodes</span>\nNAME     STATUS   ROLES                  AGE   VERSION\nmaster   Ready    control-plane,master   36h   v1.20.0\nnode1    Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">&gt;</span>                 35h   v1.20.0\nnode2    Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">&gt;</span>                 35h   v1.20.0\n</code></pre>\n<p>查看 运行详细信息</p>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl get pods -o wide</span>\nNAME                      READY   STATUS             RESTARTS   AGE   IP           NODE    NOMINATED NODE   READINESS GATES\napache-594d8494b4-s6dfd   <span class=\"token number\">0</span>/1     ImagePullBackOff   <span class=\"token number\">0</span>          19m   <span class=\"token number\">10.244</span>.1.3   node1   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">&gt;</span>           <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">&gt;</span>\nnginx-6799fc88d8-nbgc2    <span class=\"token number\">1</span>/1     Running            <span class=\"token number\">0</span>          35h   <span class=\"token number\">10.244</span>.1.2   node1   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">&gt;</span>     \n</code></pre>\n<p>创建一个deployment类型的资源</p>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl create deployment deploy-web --image=itlang11:v0.1 --replicas=3</span>\ndeployment.apps/deploy-web created\n\n\n<span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl get pods</span>\nNAME                          READY   STATUS              RESTARTS   AGE\napache-594d8494b4-s6dfd       <span class=\"token number\">0</span>/1     ImagePullBackOff    <span class=\"token number\">0</span>          26m\ndeploy-web-79df5694b9-2sh6d   <span class=\"token number\">0</span>/1     ImagePullBackOff    <span class=\"token number\">0</span>          64s\ndeploy-web-79df5694b9-5lvqk   <span class=\"token number\">0</span>/1     ImagePullBackOff    <span class=\"token number\">0</span>          64s\ndeploy-web-79df5694b9-bqxpb   <span class=\"token number\">0</span>/1     ContainerCreating   <span class=\"token number\">0</span>          64s\n</code></pre>\n<p>删除</p>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl delete deployment deploy-web</span>\ndeployment.apps <span class=\"token string\">\"deploy-web\"</span> deleted\n</code></pre>\n<p>正在删除的显示</p>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl get pods</span>\nNAME                          READY   STATUS             RESTARTS   AGE\napache-594d8494b4-s6dfd       <span class=\"token number\">0</span>/1     ImagePullBackOff   <span class=\"token number\">0</span>          29m\ndeploy-web-79df5694b9-2sh6d   <span class=\"token number\">0</span>/1     Terminating        <span class=\"token number\">0</span>          3m25s\ndeploy-web-79df5694b9-5lvqk   <span class=\"token number\">0</span>/1     Terminating        <span class=\"token number\">0</span>          3m25s\n</code></pre>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl get pods</span>\nNAME                      READY   STATUS             RESTARTS   AGE\napache-594d8494b4-s6dfd   <span class=\"token number\">0</span>/1     ImagePullBackOff   <span class=\"token number\">0</span>          29m\nnginx-6799fc88d8-nbgc2    <span class=\"token number\">1</span>/1     Running            <span class=\"token number\">0</span>          35h\n</code></pre>\n<p>实时监控拉取镜像的状态</p>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl get pods -w</span>\n</code></pre>\n<p>暴露一个项目。让外部可以访问</p>\n<pre><code class=\"prism language-bash\"><span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl expose deployment deploy-web --port=80 --protocol=TCP</span>\nservice/deploy-web exposed\n<span class=\"token punctuation\">[</span>root@master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># kubectl get service</span>\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span>        AGE\ndeploy-web   ClusterIP   <span class=\"token number\">10.110</span>.221.73   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">&gt;</span>        <span class=\"token number\">80</span>/TCP         12s\nkubernetes   ClusterIP   <span class=\"token number\">10.96</span>.0.1       <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">&gt;</span>        <span class=\"token number\">443</span>/TCP        36h\nnginx        NodePort    <span class=\"token number\">10.110</span>.131.88   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">&gt;</span>        <span class=\"token number\">80</span>:32287/TCP   35h\n</code></pre>\n<pre><code class=\"prism language-bash\">// 查看所有的资源信息\n<span class=\"token comment\"># kubectl get all</span>\n<span class=\"token comment\"># kubectl get --all-namespaces</span>\n\n// 查看pod列表\n<span class=\"token comment\"># kubectl get pod</span>\n\n// 显示pod节点的标签信息\n<span class=\"token comment\"># kubectl get pod --show-labels</span>\n\n// 根据指定标签匹配到具体的pod\n<span class=\"token comment\"># kubectl get pods -l app=example</span>\n\n// 查看node节点列表\n<span class=\"token comment\"># kubectl get node</span>\n\n// 显示node节点的标签信息\n<span class=\"token comment\"># kubectl get node --show-labels</span>\n\n// 查看pod详细信息，也就是可以查看pod具体运行在哪个节点上（ip地址信息）\n<span class=\"token comment\"># kubectl get pod -o wide</span>\n\n// 查看服务的详细信息，显示了服务名称，类型，集群ip，端口，时间等信息\n<span class=\"token comment\"># kubectl get svc</span>\n<span class=\"token comment\"># kubectl get svc -n kube-system</span>\n\n// 查看命名空间\n<span class=\"token comment\"># kubectl get ns</span>\n<span class=\"token comment\"># kubectl get namespaces</span>\n\n// 查看所有pod所属的命名空间\n<span class=\"token comment\"># kubectl get pod --all-namespaces</span>\n\n// 查看所有pod所属的命名空间并且查看都在哪些节点上运行\n<span class=\"token comment\"># kubectl get pod --all-namespaces  -o wide</span>\n\n// 查看目前所有的replica set，显示了所有的pod的副本数，以及他们的可用数量以及状态等信息\n<span class=\"token comment\"># kubectl get rs</span>\n\n// 查看已经部署了的所有应用，可以看到容器，以及容器所用的镜像，标签等信息\n<span class=\"token comment\"># kubectl get deploy -o wide</span>\n<span class=\"token comment\"># kubectl get deployments -o wide</span>\n</code></pre>\n<p><strong>run命令</strong></p>\n<p>语法：</p>\n<pre><code class=\"prism language-bash\">run NAME --image<span class=\"token operator\">=</span>image <span class=\"token punctuation\">[</span>--env<span class=\"token operator\">=</span><span class=\"token string\">\"key=value\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--port<span class=\"token operator\">=</span>port<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--replicas<span class=\"token operator\">=</span>replicas<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--dry-run<span class=\"token operator\">=</span>bool<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--overrides<span class=\"token operator\">=</span>inline-json<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--command<span class=\"token punctuation\">]</span> -- <span class=\"token punctuation\">[</span>COMMAND<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>args<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>\n</code></pre>\n<pre><code class=\"prism language-bash\">// 示例，运行一个名称为nginx，副本数为3，标签为app<span class=\"token operator\">=</span>example，镜像为nginx:1.10，端口为80的容器实例\n\n<span class=\"token comment\"># kubectl run nginx --replicas=3 --labels=\"app=example\" --image=nginx:1.10 --port=80</span>\n// 示例，运行一个名称为nginx，副本数为3，标签为app<span class=\"token operator\">=</span>example，镜像为nginx:1.10，端口为80的容器实例，并绑定到k8s-node1上\n<span class=\"token comment\"># kubectl run nginx --image=nginx:1.10 --replicas=3 --labels=\"app=example\" --port=80 --overrides='{\"apiVersion\":\"apps/v1\",\"spec\":{\"template\":{\"spec\":{\"nodeSelector\":{\"kubernetes.io/hostname\":\"k8s-node1\"}}}}}'</span>\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-07 12:34:18", "summary": "文章目录用法概述输出格式操作示例用法概述命令语法其中，、、、的含义如下。：子命令，用于操作集群资源对象的命令，例如、、、、等。：资源对象的类型，区分大小写，能以单数形式、复数形式或者简写形式表示。例如"}