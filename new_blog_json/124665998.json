{"blogid": "124665998", "writerAge": "码龄5年", "writerBlogNum": "458", "writerCollect": "10416", "writerComment": "1760", "writerFan": "63145", "writerGrade": "7级", "writerIntegral": "15966", "writerName": "K同学啊", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124665998.jpg", "writerRankTotal": "548", "writerRankWeekly": "949", "writerThumb": "2943", "writerVisitNum": "1910711", "blog_read_count": "4734", "blog_time": "于 2022-05-23 11:00:17 发布", "blog_title": "YOLOv5解析 | 第三篇：如何改进YOLOv5？", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-github-gist\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>大家好，我是K同学啊！</p>\n<p>在前面的文章<a href=\"https://blog.csdn.net/qq_38251616/article/details/124664907\">YOLOv5解析 | 第二篇：用YOLOv5训练自己的数据集（超级详细完整版）</a>中我们介绍了使用训练自己的数据集。</p>\n<p>这一篇文章，我将带大家一起解析 <code>YOLOv5</code> 的 <code>6.0</code> 版本结构并改进模型，先看看我们模型结构图~</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\3df750575c684e0da61481553c8ca429.png\"/></p>\n<p>由于YOLOv5存在多个版本，所以你在网上可能会看到许多不同版本是网络结构图。（<strong>这里放的是最新的<code>YOLOv5</code> 的 <code>6.0</code> 版本结构图</strong>）</p>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><ul><li><a href=\"#YOLOv5_13\">一、YOLOv5的结构文件</a></li><li><a href=\"#_73\">二、如何修改网络结构</a></li><li><ul><li><a href=\"#1_yolov5syaml_81\">1. 修改yolov5s.yaml文件</a></li><li><a href=\"#2_commonpy_84\">2. 修改common.py文件</a></li><li><a href=\"#3_yolopy_87\">3. 修改yolo.py文件</a></li></ul>\n</li></ul>\n</li></ul>\n</div>\n<p></p>\n<h2><a id=\"YOLOv5_13\"></a>一、YOLOv5的结构文件</h2>\n<p><strong>我们如何找到YOLOv5的结构文件？</strong></p>\n<p>文件定位：…/models/***.yaml<br/> <img alt=\"\" src=\"..\\..\\static\\image\\51e7f56ad32f42828f8099c767fdd473.png\"/><br/> 你将会看到YOLOv5又分为<code>YOLOv5l</code>、<code>YOLOv5m</code>、<code>YOLOv5n</code>、<code>YOLOv5s</code>、<code>YOLOv5x</code>五个版本，这五个版本唯一的区别是网络深度（depth_multiple）与宽度（width_multiple）不一样，这里先不展开，你只需要知道这几个家伙都是YOLOv5只是有细微区别即可。下文我将以YOLOv5s为模板展开介绍。</p>\n<pre><code class=\"prism language-python\"><span class=\"token comment\"># YOLOv5 🚀 by Ultralytics, GPL-3.0 license</span>\n\n<span class=\"token comment\"># Parameters</span>\nnc<span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>  <span class=\"token comment\"># number of classes</span>\ndepth_multiple<span class=\"token punctuation\">:</span> <span class=\"token number\">0.33</span>  <span class=\"token comment\"># model depth multiple</span>\nwidth_multiple<span class=\"token punctuation\">:</span> <span class=\"token number\">0.50</span>  <span class=\"token comment\"># layer channel multiple</span>\nanchors<span class=\"token punctuation\">:</span>\n  <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span><span class=\"token number\">13</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span> <span class=\"token number\">33</span><span class=\"token punctuation\">,</span><span class=\"token number\">23</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\"># P3/8</span>\n  <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">,</span><span class=\"token number\">61</span><span class=\"token punctuation\">,</span> <span class=\"token number\">62</span><span class=\"token punctuation\">,</span><span class=\"token number\">45</span><span class=\"token punctuation\">,</span> <span class=\"token number\">59</span><span class=\"token punctuation\">,</span><span class=\"token number\">119</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\"># P4/16</span>\n  <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token number\">116</span><span class=\"token punctuation\">,</span><span class=\"token number\">90</span><span class=\"token punctuation\">,</span> <span class=\"token number\">156</span><span class=\"token punctuation\">,</span><span class=\"token number\">198</span><span class=\"token punctuation\">,</span> <span class=\"token number\">373</span><span class=\"token punctuation\">,</span><span class=\"token number\">326</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\"># P5/32</span>\n\n<span class=\"token comment\"># YOLOv5 v6.0 backbone</span>\nbackbone<span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># [from, number, module, args]</span>\n  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">64</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 0-P1/2</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 1-P2/4</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> C3<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 3-P3/8</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> C3<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 5-P4/16</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> C3<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">512</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 7-P5/32</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> C3<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> SPPF<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 9</span>\n  <span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># YOLOv5 v6.0 head</span>\nhead<span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> nn<span class=\"token punctuation\">.</span>Upsample<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'nearest'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Concat<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># cat backbone P4</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> C3<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 13</span>\n\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> nn<span class=\"token punctuation\">.</span>Upsample<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'nearest'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Concat<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># cat backbone P3</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> C3<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 17 (P3/8-small)</span>\n\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">256</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">14</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Concat<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># cat head P4</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> C3<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 20 (P4/16-medium)</span>\n\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Conv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Concat<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># cat head P5</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> C3<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 23 (P5/32-large)</span>\n\n   <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">17</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> Detect<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>nc<span class=\"token punctuation\">,</span> anchors<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># Detect(P3, P4, P5)</span>\n  <span class=\"token punctuation\">]</span>\n\n</code></pre>\n<h2><a id=\"_73\"></a>二、如何修改网络结构</h2>\n<p>对于网络结构的修改我们需要改动的文件如下：</p>\n<ul><li>./models/yolov5s.yaml</li><li>./models/common.py</li><li>./models/yolo.py</li></ul>\n<p>举例，我现在要将YOLOv5s中的一个<code>C3</code>模块修改为自定义的<code>C3KTongxue</code>模块，我们需要做哪些工作呢？</p>\n<h3><a id=\"1_yolov5syaml_81\"></a>1. 修改yolov5s.yaml文件</h3>\n<p>第一步，定位你想修改的那个C3模块的位置，将名字<code>C3</code>修改为<code>C3KTongxue</code>（注意根据你自定义的模块修改相关参数）。<br/> <img alt=\"\" src=\"..\\..\\static\\image\\994d9d28ef4048f8ac7a61143803e0b4.png\"/></p>\n<h3><a id=\"2_commonpy_84\"></a>2. 修改common.py文件</h3>\n<p>第二步，在<code>common.py</code>文件中添加自定义模块<code>C3KTongxue</code>的代码实现类<br/> <img alt=\"\" src=\"..\\..\\static\\image\\2d81375d06d74c1bbb81deadf1227c1a.png\"/></p>\n<h3><a id=\"3_yolopy_87\"></a>3. 修改yolo.py文件</h3>\n<p>第三步，在yolo.py文件中的相关位置添加上自定义模块<code>C3KTongxue</code>（位置已经下图中标明）。<br/> <img alt=\"\" src=\"..\\..\\static\\image\\0e63737871574cb2bf9faa493a4d72e2.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-05-23 11:00:17", "summary": "大家好，我是同学啊！在前面的文章解析第二篇：用训练自己的数据集超级详细完整版中我们介绍了使用训练自己的数据集。这一篇文章，我将带大家一起解析的版本结构并改进模型，先看看我们模型结构图由于存在多个版本，"}