{"blogid": "123163479", "writerAge": "ç é¾„6å¹´", "writerBlogNum": "193", "writerCollect": "5263", "writerComment": "4758", "writerFan": "8887", "writerGrade": "7çº§", "writerIntegral": "13586", "writerName": "å°ç‹æ›¾æ˜¯å°‘å¹´", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123163479.jpg", "writerRankTotal": "774", "writerRankWeekly": "101", "writerThumb": "3798", "writerVisitNum": "358592", "blog_read_count": "1153", "blog_time": "äºÂ 2022-09-02 19:23:48Â å‘å¸ƒ", "blog_title": "RocketMQ æ¶ˆè´¹è€…ç›‘å¬æ¨¡å‹ è§£æâ€”â€”å›¾è§£ã€æºç çº§è§£æ", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p>ğŸŠ Javaå­¦ä¹ ï¼š<a href=\"https://blog.csdn.net/HNU_Csee_wjw/article/details/108082426\">Javaä»å…¥é—¨åˆ°ç²¾é€šæ€»ç»“</a><br/> <br/></p>\n<p>ğŸŠ æ·±å…¥æµ…å‡ºRocketMQè®¾è®¡æ€æƒ³ï¼š<a href=\"https://blog.csdn.net/hnu_csee_wjw/category_11789299.html\">æ·±å…¥æµ…å‡ºRocketMQè®¾è®¡æ€æƒ³</a><br/> <br/></p>\n<p>ğŸŠ ç»å¯¹ä¸ä¸€æ ·çš„èŒåœºå¹²è´§ï¼š<a href=\"https://blog.csdn.net/hnu_csee_wjw/category_11693862.html\">å¤§å‚æœ€ä½³å®è·µç»éªŒæŒ‡å—</a><br/> <br/><br/> ğŸ“† æœ€è¿‘æ›´æ–°ï¼š2022å¹´9æœˆ1æ—¥<br/> <br/></p>\n<p>ğŸŠ ä¸ªäººç®€ä»‹ï¼šé€šä¿¡å·¥ç¨‹æœ¬ç¡•ğŸ’ªã€Javaç¨‹åºå‘˜ğŸŒ•ã€‚åšè¿‡ç§‘ç ”paperï¼Œå‘è¿‡ä¸“åˆ©ï¼Œä¼˜ç§€çš„ç¨‹åºå‘˜ä¸åº”è¯¥åªæ˜¯CRUD<br/> <br/></p>\n<p>ğŸŠ ç‚¹èµ ğŸ‘ æ”¶è— â­ç•™è¨€ ğŸ“ éƒ½æ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ï¼</p>\n</blockquote>\n<hr/>\n<p></p>\n<div class=\"toc\">\n<h3>æ–‡ç« ç›®å½•</h3>\n<ul><li><a href=\"#_30\">æ¶ˆæ¯æ¥æ”¶æ¨¡å‹</a></li><li><a href=\"#_42\">æ¶ˆè´¹ç«¯ç›‘å¬æ¨¡å‹</a></li><li><ul><li><a href=\"#_43\">ç›‘å¬å™¨è®¾è®¡æ¨¡å¼</a></li><li><a href=\"#_50\">æ³¨å†Œç›‘å¬å™¨</a></li><li><a href=\"#_83\">å¯åŠ¨æ¶ˆè´¹è€…</a></li><li><a href=\"#ConsumeMessageConcurrentlyService_207\">`ConsumeMessageConcurrentlyService`ç±»</a></li></ul>\n</li></ul>\n</div>\n<p></p>\n<p>å‰é¢å·²ç»æŠŠRocketMQå‘é€æ¶ˆæ¯çš„ä¸»è¦æµç¨‹æ¢³ç†äº†ä¸€éï¼Œæ¥ä¸‹æ¥æˆ‘å°†ä»‹ç»æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯çš„æºç åŠæµç¨‹ï¼Œä¸»è¦åŒ…å«ä½†ä¸ä»…é™äºä¸€ä¸‹å†…å®¹ï¼š</p>\n<ul><li>æ¶ˆæ¯æ¶ˆè´¹æ¨¡å¼</li><li>æ¶ˆæ¯æ¶ˆè´¹çš„æµç¨‹</li><li>æ¶ˆè´¹è€…è´Ÿè½½å‡è¡¡ç®—æ³•</li><li>æ¶ˆè´¹å¤±è´¥å¦‚ä½•è¿›è¡Œé‡è¯•</li><li>æ¶ˆæ¯å¦‚ä½•è¿›è¡Œé‡æ–°æŠ•é€’</li><li>â€¦</li></ul>\n<h1><a id=\"_30\"></a>æ¶ˆæ¯æ¥æ”¶æ¨¡å‹</h1>\n<p>Consumeræ¶ˆè´¹è€…ç»„æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œå—é™ä»æ³¨å†Œä¸­å¿ƒé‡Œè·å–BrokeræœåŠ¡å™¨ä¸­<code>Topic</code>çš„é˜Ÿåˆ—çš„åœ°å€ï¼Œç„¶åæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•è¿›è¡Œæ¶ˆè´¹ã€‚</p>\n<p>RocketMQçš„æ¶ˆæ¯æ¨é€æ–¹å¼æœ‰æ‹‰æ¨¡å¼å’Œæ¨æ¨¡å¼ï¼Œä½†å®é™…ä¸Šæ¨æ¨¡å¼çš„åº•å±‚ä¹Ÿæ˜¯ç”¨çš„æ‹‰æ¨¡å¼ã€‚</p>\n<p>æ¶ˆè´¹è€…ç»„ä¼šå°†æ‰€æœ‰MQåˆ†å‡åˆ†é…ç»™æ‰€æœ‰çš„ç»„å†…æ¶ˆè´¹è€…ï¼ŒåŒä¸€ä¸ªç»„å†…çš„æ¶ˆè´¹è€…ä¸èƒ½åŒæ—¶ç›‘å¬å¤šä¸ª<code>Topic</code>ï¼Œå¦åˆ™å¯èƒ½ç”±äºè´Ÿè½½å‡è¡¡ç®—æ³•æ˜¯çš„éƒ¨åˆ†æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹ã€‚</p>\n<p>å¦‚æœæ¶ˆæ¯æ¶ˆè´¹å¤±è´¥åˆ™ä¼šè¿›è¡Œé‡è¯•ï¼Œé»˜è®¤æ˜¯é‡è¯•6æ¬¡ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰æ¶ˆè´¹æˆåŠŸçš„è¯æ¶ˆæ¯å°±ä¼šè¢«æ”¾å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\7ebddfb1fc4a41ab84b1b03b09f5ad89.png\"/><br/> <br/><br/></p>\n<h1><a id=\"_42\"></a>æ¶ˆè´¹ç«¯ç›‘å¬æ¨¡å‹</h1>\n<h2><a id=\"_43\"></a>ç›‘å¬å™¨è®¾è®¡æ¨¡å¼</h2>\n<p>RocketMQé‡‡ç”¨äº†è®¾è®¡æ¨¡å¼ä¸­çš„ç›‘å¬å™¨è®¾è®¡æ¨¡å¼ï¼Œç±»ä¸ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»å¦‚å›¾ï¼š<br/> <img alt=\"è¯·æ·»åŠ å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\53484da853b8423497b27a720d17134e.png\"/><br/> <code>ConsumeMessageConcurrentlyService</code>å°±æ˜¯ç›‘å¬å™¨çš„æ‰§è¡Œç±»</p>\n<br/>\n<h2><a id=\"_50\"></a>æ³¨å†Œç›‘å¬å™¨</h2>\n<p>ç¼–å†™è‡ªå®šä¹‰æ¶ˆè´¹ç«¯å¹¶ç»‘å®šç›‘å¬å™¨çš„ä»£ç å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"prism language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token comment\">// åˆ›å»ºæ¶ˆè´¹è€…å¯¹è±¡ï¼Œè®¾ç½®ç»„å</span>\n    <span class=\"token class-name\">DefaultMQPushConsumer</span> consumer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultMQPushConsumer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Group A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// è®¢é˜…æ¶ˆæ¯ä¸»é¢˜target_topicä¸‹çš„æ¶ˆæ¯ï¼Œ*è¡¨ç¤ºæ‰€æœ‰æ¶ˆæ¯</span>\n    consumer<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"target_topic\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// è®¾ç½®ä»ä¸Šä¸€æ¬¡çš„ä½ç‚¹å¼€å§‹æ¶ˆè´¹</span>\n    consumer<span class=\"token punctuation\">.</span><span class=\"token function\">setConsumeFromWhere</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ConsumeFromWhere</span><span class=\"token punctuation\">.</span>CONSUME_FROM_FIRST_OFFSET<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// æ³¨å†Œç›‘å¬å™¨</span>\n    consumer<span class=\"token punctuation\">.</span><span class=\"token function\">registerMessageListener</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token comment\">// æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³•</span>\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span> <span class=\"token function\">consumeMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MessageExt</span><span class=\"token punctuation\">&gt;</span></span> msgs<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConsumeConcurrentlyContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" Receive New Messages: \"</span> <span class=\"token operator\">+</span> msgs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">ConsumeConcurrentlyStatus</span><span class=\"token punctuation\">.</span>CONSUME_SUCCESS<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// å¼€å¯æ¶ˆè´¹è€…</span>\n    consumer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Consumer Started\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p><strong>æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p>\n<ol><li>åˆ›å»ºæ¶ˆè´¹è€…ï¼ŒæŒ‡å®šæ‰€åœ¨çš„ç»„</li><li>è®¢é˜…ä¸»é¢˜<code>target_topic</code>ï¼Œå¹¶æ¶ˆè´¹æ‰€æœ‰æ¶ˆæ¯</li><li>è®¾ç½®ä»ä¸Šä¸€æ¬¡æ¶ˆè´¹åˆ°çš„ä½ç½®ç»§ç»­è¿›è¡Œæ¶ˆè´¹</li><li>æ³¨å†Œç›‘å¬å™¨<code>MessageListenerConcurrently</code>ï¼Œå®šä¹‰æ¶ˆè´¹æ¶ˆæ¯çš„é€»è¾‘<code>consumeMessage</code></li><li>å¯åŠ¨æ¶ˆè´¹è€…</li></ol>\n<br/>\n<h2><a id=\"_83\"></a>å¯åŠ¨æ¶ˆè´¹è€…</h2>\n<p>Consumeræ³¨å†Œå®Œç›‘å¬å™¨åï¼Œæ­¤æ—¶è¿˜æ²¡æœ‰å¼€å§‹æ¶ˆè´¹ï¼Œå½“Consumerè°ƒç”¨äº†startæ–¹æ³•ä¹‹åæ‰å¼€å§‹è¿›è¡Œæ¶ˆè´¹å‰çš„å„ç§å‡†å¤‡å·¥ä½œã€‚</p>\n<pre><code class=\"prism language-java\">    <span class=\"token keyword\">public</span> <span class=\"token keyword\">synchronized</span> <span class=\"token keyword\">void</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">MQClientException</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serviceState<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">case</span> CREATE_JUST<span class=\"token operator\">:</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"the consumer [{}] start beginning. messageModel={}, isUnitMode={}\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">isUnitMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serviceState <span class=\"token operator\">=</span> <span class=\"token class-name\">ServiceState</span><span class=\"token punctuation\">.</span>START_FAILED<span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// æ£€æŸ¥é…ç½®</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">checkConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// å¤åˆ¶è®¢é˜…æ•°æ®</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">copySubscription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// å°†InstanceNameè®¾ç½®ä¸ºpidï¼ˆæ•°å­—ï¼‰</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">MessageModel</span><span class=\"token punctuation\">.</span>CLUSTERING<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">changeInstanceNameToPID</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mQClientFactory <span class=\"token operator\">=</span> <span class=\"token class-name\">MQClientManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getOrCreateMQClientInstance</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rpcHook<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// è®¾ç½®è´Ÿè½½å‡è¡¡çš„å„ç§å‚æ•°</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rebalanceImpl<span class=\"token punctuation\">.</span><span class=\"token function\">setConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// é»˜è®¤ä¸ºé›†ç¾¤æ¨¡å¼ï¼Œæ¯æ¡æ¶ˆæ¯è¢«ä¸€ä¸ªç»„å†…çš„æŸä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹æ‰</span>\n                <span class=\"token comment\">// è¿˜æœ‰å¹¿æ’­æ¨¡å¼ï¼Œæ¯æ¡æ¶ˆæ¯è¢«åŒä¸€ä¸ªç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¬¡</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rebalanceImpl<span class=\"token punctuation\">.</span><span class=\"token function\">setMessageModel</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// é»˜è®¤æ˜¯å‡åŒ€åˆ†é…</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rebalanceImpl<span class=\"token punctuation\">.</span><span class=\"token function\">setAllocateMessageQueueStrategy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getAllocateMessageQueueStrategy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rebalanceImpl<span class=\"token punctuation\">.</span><span class=\"token function\">setmQClientFactory</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mQClientFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// å°è£…æ‹‰å–æ¶ˆæ¯çš„API</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pullAPIWrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PullAPIWrapper</span><span class=\"token punctuation\">(</span>\n                        mQClientFactory<span class=\"token punctuation\">,</span>\n                        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">isUnitMode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pullAPIWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">registerFilterMessageHook</span><span class=\"token punctuation\">(</span>filterMessageHookList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// å­˜å‚¨æ¶ˆè´¹è¿›åº¦ã€‚é›†ç¾¤æ¨¡å¼ä¸‹æ¶ˆè´¹è¿›åº¦ä¿å­˜åœ¨Brokerä¸Šï¼ŒåŒä¸€ç»„å†…çš„æ¶ˆè´¹è€…è¦å…±äº«æ¶ˆè´¹è¿›åº¦ï¼Œå¹¿æ’­æ¨¡å¼ä¸‹ä¿å­˜åœ¨æ¶ˆè´¹è€…æœ¬åœ°</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getOffsetStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>offsetStore <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getOffsetStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getMessageModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                        <span class=\"token keyword\">case</span> BROADCASTING<span class=\"token operator\">:</span>\n                            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>offsetStore <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LocalFileOffsetStore</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mQClientFactory<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword\">case</span> CLUSTERING<span class=\"token operator\">:</span>\n                            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>offsetStore <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RemoteBrokerOffsetStore</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mQClientFactory<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n                            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">setOffsetStore</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>offsetStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>offsetStore<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// æ ¹æ®é¡ºåºç›‘å¬è¿˜æ˜¯å¹¶å‘ç›‘å¬åˆ›å»ºç›¸åº”çš„Service</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMessageListenerInner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MessageListenerOrderly</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeOrderly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeMessageService <span class=\"token operator\">=</span>\n                            <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConsumeMessageOrderlyService</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageListenerOrderly</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMessageListenerInner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMessageListenerInner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeOrderly <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeMessageService <span class=\"token operator\">=</span>\n                            <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConsumeMessageConcurrentlyService</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MessageListenerConcurrently</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMessageListenerInner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeMessageService<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// æ£€æŸ¥æ˜¯å¦æ³¨å†ŒæˆåŠŸï¼Œå¦‚æœä¹‹å‰æœ‰é‡å¤çš„groupåç§°åˆ™å¤±è´¥</span>\n                <span class=\"token keyword\">boolean</span> registerOK <span class=\"token operator\">=</span> mQClientFactory<span class=\"token punctuation\">.</span><span class=\"token function\">registerConsumer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>registerOK<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serviceState <span class=\"token operator\">=</span> <span class=\"token class-name\">ServiceState</span><span class=\"token punctuation\">.</span>CREATE_JUST<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeMessageService<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getAwaitTerminationMillisWhenShutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"The consumer group[\"</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token operator\">+</span> <span class=\"token string\">\"] has been created before, specify another name please.\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">FAQUrl</span><span class=\"token punctuation\">.</span><span class=\"token function\">suggestTodo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FAQUrl</span><span class=\"token punctuation\">.</span>GROUP_NAME_DUPLICATE_URL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                mQClientFactory<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                log<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"the consumer [{}] start OK.\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// è®¾ç½®æœåŠ¡çŠ¶æ€</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serviceState <span class=\"token operator\">=</span> <span class=\"token class-name\">ServiceState</span><span class=\"token punctuation\">.</span>RUNNING<span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">case</span> RUNNING<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">case</span> START_FAILED<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">case</span> SHUTDOWN_ALREADY<span class=\"token operator\">:</span>\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MQClientException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"The PushConsumer service state not OK, maybe started once, \"</span>\n                        <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>serviceState\n                        <span class=\"token operator\">+</span> <span class=\"token class-name\">FAQUrl</span><span class=\"token punctuation\">.</span><span class=\"token function\">suggestTodo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FAQUrl</span><span class=\"token punctuation\">.</span>CLIENT_SERVICE_NOT_OK<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// ä»æ³¨å†Œä¸­å¿ƒè·å–TopicRouteDataï¼Œæ›´æ–°TopicPublishInfoå’ŒMQï¼ˆå‘¨æœŸæ€§è°ƒç”¨ï¼‰</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updateTopicSubscribeInfoWhenSubscriptionChanged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mQClientFactory<span class=\"token punctuation\">.</span><span class=\"token function\">checkClientInBroker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// å‘TopicRouteDataä¸­æ‰€æœ‰çš„Brokerå‘é€å¿ƒè·³ï¼Œæ³¨å†ŒConsumer/Producerä¿¡æ¯åˆ°Brokerä¸Šï¼ˆå‘¨æœŸæ€§è°ƒç”¨ï¼‰</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mQClientFactory<span class=\"token punctuation\">.</span><span class=\"token function\">sendHeartbeatToAllBrokerWithLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// å”¤é†’MQå‡è¡¡æœåŠ¡ï¼Œä¹‹åå¼€å§‹æ‹‰åŒºæ¶ˆæ¯</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mQClientFactory<span class=\"token punctuation\">.</span><span class=\"token function\">rebalanceImmediately</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre>\n<p><strong>ä¸Šé¢ä»£ç çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</strong></p>\n<p><font color=\"#33aaff\">1. å…ˆåˆ¤æ–­æœåŠ¡çŠ¶æ€ï¼ŒConsumeræ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€</font></p>\n<ul><li><code>CREATE_JUST</code>ï¼šConsumeråˆšåˆ›å»ºï¼Œè¿˜æ²¡å¼€å§‹è¿è¡Œ</li><li><code>RUNNING</code>ï¼šConsumeræ­£åœ¨è¿è¡Œ</li><li><code>SHUTDOWN_ALREADY</code>ï¼šConsumerå·²ç»å…³é—­</li><li><code>START_FAILED</code>ï¼šConsumerå¯åŠ¨å¤±è´¥</li></ul>\n<p><font color=\"#33aaff\">2. å¦‚æœConsumeråˆšåˆšåˆ›å»ºï¼Œåˆ™è¿›è¡Œä¸€ç³»åˆ—æ£€æŸ¥å·¥ä½œ</font></p>\n<ul><li>å¦‚æœæ˜¯åˆšåˆšåˆ›å»ºConsumerï¼Œåˆ™å…ˆæŠŠçŠ¶æ€ä½è®¾ç½®ä¸º<code>START_FAILED</code>ï¼Œç­‰åˆå§‹åŒ–æµç¨‹æ‰§è¡Œå®Œæ¯•åå†è®¾ç½®ä¸º<code>RUNNING</code></li><li>æ£€æŸ¥æ¥æ”¶æ¶ˆæ¯ç›¸å…³é…ç½®ï¼Œå¦‚ï¼šç»„åæ ¼å¼æ˜¯å¦æ­£ç¡®ç­‰ç­‰</li><li>è·å–Consumerçš„å”¯ä¸€æ ‡è¯†ï¼Œæ ¼å¼ä¸º<code>ip@instanceName</code></li><li>è®¾ç½®è´Ÿè½½å‡è¡¡æ¶ˆè´¹æ¨¡å¼ï¼ŒæŒ‡å®šè´Ÿè½½å‡è¡¡çš„ç»„ã€æ¶ˆæ¯æ¶ˆè´¹çš„ç­–ç•¥</li><li>å¯¹<font color=\"#33aa33\">æ‹‰å–æ¶ˆæ¯API</font>è¿›è¡Œå°è£…</li><li>åˆ›å»ºæ¶ˆè´¹è¿›åº¦å¤„ç†å™¨ï¼Œé›†ç¾¤æ¨¡å¼ä¸‹æ¶ˆè´¹è¿›åº¦åº”è¯¥ä¿å­˜åœ¨Brokerä¸Šï¼Œç»„å†…çš„æ¶ˆè´¹è€…è¦å…±äº«è¿›åº¦ã€å¹¿æ’­æ¨¡å¼ä¸‹çš„æ¶ˆè´¹è¿›åº¦ä¿å­˜åœ¨Consumer</li><li>æ ¹æ®ç›‘å¬æ—¶é¡ºåºæ¨¡å¼è¿˜æ˜¯å¹¶å‘æ¨¡å¼æ¥åˆ›å»ºç›¸åº”çš„<code>ConsumerService</code>ã€‚æ¶ˆè´¹å°±æ˜¯è¿™ä¸ªç±»çš„å®ä¾‹æ¥å®ç°çš„</li></ul>\n<p><br/><br/></p>\n<h2><a id=\"ConsumeMessageConcurrentlyService_207\"></a><code>ConsumeMessageConcurrentlyService</code>ç±»</h2>\n<pre><code class=\"prism language-java\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">ConsumeMessageOrderlyService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DefaultMQPushConsumerImpl</span> defaultMQPushConsumerImpl<span class=\"token punctuation\">,</span>\n                                    <span class=\"token class-name\">MessageListenerOrderly</span> messageListener<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token comment\">// è®¾ç½®æ¶ˆæ¯æ¶ˆè´¹è€…å¯¹è±¡</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumerImpl <span class=\"token operator\">=</span> defaultMQPushConsumerImpl<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// è®¾ç½®æ³¨å†Œç›‘å¬å™¨å¯¹è±¡</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>messageListener <span class=\"token operator\">=</span> messageListener<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// è·å–æ¶ˆæ¯æ¶ˆè´¹è€…</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumerImpl<span class=\"token punctuation\">.</span><span class=\"token function\">getDefaultMQPushConsumer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// è·å–æ¶ˆæ¯æ¶ˆè´¹è€…æ‰€åœ¨çš„ç»„</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumerGroup <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumerGroup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// åˆ›å»ºæ¶ˆè´¹è€…é˜Ÿåˆ—</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeRequestQueue <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedBlockingQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// æ¶ˆè´¹è€…çº¿ç¨‹æ± </span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeExecutor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadPoolExecutor</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumeThreadMin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>defaultMQPushConsumer<span class=\"token punctuation\">.</span><span class=\"token function\">getConsumeThreadMax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token number\">1000</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span>\n            <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>MILLISECONDS<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>consumeRequestQueue<span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadFactoryImpl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ConsumeMessageThread_\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>scheduledExecutorService <span class=\"token operator\">=</span> <span class=\"token class-name\">Executors</span><span class=\"token punctuation\">.</span><span class=\"token function\">newSingleThreadScheduledExecutor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadFactoryImpl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ConsumeMessageScheduledThread_\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æœ€ç»ˆå°±æ˜¯æŒ‡å®š<code>ConsumeMessageConcurrentlyService</code>æ¥è¿›è¡Œæ¶ˆè´¹ï¼š</p>\n<ul><li><code>MessageListenerOrderly</code>é¡ºåºæ¶ˆæ¯ç›‘å¬å™¨ï¼Œä½¿ç”¨<code>ConsumeMessageOrderlyService</code>å¯¹è±¡æ¥è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹</li><li><code>MessageListenerConcurrently</code>å¹¶å‘æ¶ˆæ¯ç›‘å¬å™¨ä½¿ç”¨<code>ConsumeMessageConcurrentlyService</code>å¯¹è±¡è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹</li></ul>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Java", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 1, "sql": 0, "php": 0, "time": "2022-09-02 19:23:48", "summary": "å­¦ä¹ ï¼šä»å…¥é—¨åˆ°ç²¾é€šæ€»ç»“æ·±å…¥æµ…å‡ºè®¾è®¡æ€æƒ³ï¼šæ·±å…¥æµ…å‡ºè®¾è®¡æ€æƒ³ç»å¯¹ä¸ä¸€æ ·çš„èŒåœºå¹²è´§ï¼šå¤§å‚æœ€ä½³å®è·µç»éªŒæŒ‡å—æœ€è¿‘æ›´æ–°ï¼šå¹´æœˆæ—¥ä¸ªäººç®€ä»‹ï¼šé€šä¿¡å·¥ç¨‹æœ¬ç¡•ã€ç¨‹åºå‘˜ã€‚åšè¿‡ç§‘ç ”ï¼Œå‘è¿‡ä¸“åˆ©ï¼Œä¼˜ç§€çš„ç¨‹åºå‘˜ä¸åº”è¯¥åªæ˜¯ç‚¹èµæ”¶è—ç•™è¨€"}