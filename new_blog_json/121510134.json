{"blogid": "121510134", "writerAge": "None", "writerBlogNum": "39", "writerCollect": "40", "writerComment": "6", "writerFan": "50", "writerGrade": "3级", "writerIntegral": "435", "writerName": "长安链开源社区", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_121510134.jpg", "writerRankTotal": "37787", "writerRankWeekly": "289880", "writerThumb": "4", "writerVisitNum": "79295", "blog_read_count": "1722", "blog_time": "于 2021-11-24 10:45:36 发布", "blog_title": "长安链自研网络Liquid详解及应用指南", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h3>Liquid作为长安链ChainMaker最新发布的自研P2P网络，拥有诸多重要的新特性，本文将为大家详细介绍Liquid诞生的来龙去脉，并横向对比Liquid和libp2p特性。</h3>\n<p></p>\n<p>1.<strong>为什么我们需要自研网络</strong></p>\n<p></p>\n<p>关注长安链的小伙伴都了解，长安链的P2P网络模块是基于libp2p开源项目进行封装的。libp2p体系完善、功能强大，为什么还要开发自研网络呢？主要有以下几个原因：<br/> （1）libp2p针对通用场景而设计，应用于区块链场景还需要进一步适配。<br/> （2）libp2p过重，长安链使用的只是冰山一角，绝大部分功能没有用武之地。<br/> （3）自研网络模块将进一步提升长安链自主可控性。<br/> 在这样的背景下，自研网络模块诞生了。<br/> 我们给自研P2P网络起了一个新名字——<strong>Liquid</strong>，寓意着快速适应<strong>复杂易变的</strong>网络环境以及<strong>流畅的</strong>传输效率。</p>\n<p></p>\n<p><strong>2.了解自研网络Liquid</strong></p>\n<p></p>\n<p><strong>2.1 Liquid简介</strong></p>\n<p>在自研网络Liquid设计和开发的过程中，我们对libp2p进行了重新梳理，同时对使用libp2p遇到的一些问题进行优化。Liquid的设计目标主要可归纳为以下几点：<br/><strong><strong>（</strong><strong>1）</strong></strong><strong><strong>Liquid与区块链场景完美适配。</strong></strong>在设计之初，我们综合考虑并融合了原网络模块补充的功能，如：多链隔离、节点黑名单等。<br/><strong><strong>（</strong><strong>2）</strong></strong><strong><strong>Liquid更加精简。</strong></strong>我们对网络模块做减法，只保留必须的功能，形成了现在极其精简的Liquid的第一个版本。<br/><strong><strong>（</strong><strong>3）</strong></strong><strong><strong>Liquid自主可控。</strong></strong>无论从技术架构、代码实现，还是后续的技术演进，我们做到了“自己说了算”。<br/><strong><strong>（</strong><strong>4）</strong></strong><strong><strong>Liquid融入更多新特性。</strong></strong>研发团队从区块链的技术特征出发，为网络模块丰富了更多特性，如：多连接并发复用、大报文拆包并行传输、消息优先级管理等。<br/> 另外，非常重要的一点，Liquid满足长安链<strong>灵活装配</strong>的特性。基于相同的模块接口与长安链无缝适配，可以根据开发者的需要快速的装配和使用。</p>\n<p></p>\n<p><strong>2.2 Liquid的特色功能</strong></p>\n<p>本次发布的Liquid alpha版本，为长安链的网络模块带来了三个新特性：<br/><strong><strong>（</strong></strong><strong><strong>1）多连接并发复用。</strong></strong>Liquid优化了libp2p节点间只建立一条物理连接的限制，多条链路可以更有效的利用网络资源。这个特性也是下面两个特色功能的实现基础。<br/><strong><strong>（</strong></strong><strong><strong>2）大报文拆包并行传输。</strong></strong>区块链系统节点间存在大报文通信的场景，如共识的区块报文，在高并发场景下会产生几十MB甚至上百MB的报文传输。将大报文拆分，并给予多连接并发复用的机制并行传输，可以极大的缩短报文传输延时，对性能的提示效果显著。<br/><strong><strong>（</strong></strong><strong><strong>3）消息优先级管理。</strong></strong>区块链节点间存在多种消息类型，如：共识投票消息、交易广播消息、区块同步消息、节点发现消息等。某些消息虽然比重不大但至关重要，例如共识投票消息控制着整个出块周期，决定着各节点间块高度的一致性。因此，Liquid增加了消息优先级管理的功能，将共识类的消息定义为最高优先级，同时也给开发者预留了定义优先级的接口，可以定制化设置。</p>\n<p><br/> 我们可以把节点间的消息传递想象成车辆通过高速公路收费站的场景，以便进一步理解。</p>\n<p>Libp2p只提供了一个收费窗口，所有车辆无差别对待，按先来后到排队通过。而Liquid则是设置了多个窗口（多连接），同时增设了速通窗口（优先级管理）保证重要车辆优先通行。如果需要运输体积较大的货物，则把货物拆分并使用多辆车运输通过收费站（拆包并行传输），提升收费站的通过效率。<br/><em>注：基于libp2p的网络模块同样做了上述特性的升级。</em></p>\n<p></p>\n<p><strong>2.3 Liquid的功能和对比</strong></p>\n<p>下面汇总liquid与现有libp2p网络模块的特性对比：</p>\n<p style=\"text-align:center;\"><img alt=\"Image\" src=\"..\\..\\static\\image\\0edb74bea44b47c33620d3d54d904476.png\"/></p>\n<p></p>\n<p><strong>3.Liquid后续规划</strong></p>\n<p></p>\n<p>未来Liquid主要有以下几个主要的技术演进路线：</p>\n<p>（1）支持复杂网络组网，目前NAT穿透、节点中继等功能还在规划中，需要在后续版本提供。</p>\n<p>（2）支持更多传输协议，扩展WebSocket、基于流的传输协议等。</p>\n<p>（3）支持层级架构的网络组网，支持万级规模节点组网，兼具良好扩展性。</p>\n<p>敬请期待。</p>\n<p></p>\n<p><strong>4.如何使用Liquid</strong></p>\n<p></p>\n<p><strong>4.1 在长安链中启用Liquid</strong></p>\n<p>在chainmaker-go中启用Liquid作为网络实现，只需将</p>\n<p><em>net:<br/>   provider: libp2p</em></p>\n<p>改为：</p>\n<p><em>net:<br/>   provider: liquid</em></p>\n<p><em>注：Liquid与libp2p传输协议不兼容，所以对于同一条链，必须装配使用同一个版本的网络模块。</em></p>\n<p>Liquid支持TCP、QUIC两种底层传输协议，具体使用哪种协议会根据本地监听地址自动识别。使用TCP的本节点地址配置：</p>\n<p><em>net:<br/>   listen_addr: /ip4/0.0.0.0/tcp/11301</em></p>\n<p>使用QUIC的本节点地址配置：</p>\n<p><em>net:<br/>   listen_addr: /ip4/0.0.0.0/udp/11301/quic</em></p>\n<p>其他节点地址的格式也需要与传输协议保持一致，例如：<br/> 使用TCP的其他节点地址配置：</p>\n<p><em>/ip4/127.0.0.1/tcp/11302/p2p/QmcQHCuAXaFkbcsPUj7e37hXXfZ9DdN7bozseo5oX4qiC4</em></p>\n<p>使用QUIC的其他节点地址配置：</p>\n<p><em>/ip4/127.0.0.1/udp/11302/quic/p2p/QmcQHCuAXaFkbcsPUj7e37hXXfZ9DdN7bozseo5oX4qiC4</em></p>\n<p><strong>4.2 Liquid的新特性使用</strong></p>\n<p>4.2.1 多连接并发复用的设置</p>\n<p>Liquid支持多连接复用并行发送，假设我们允许与每个其他节点最多创建5个连接，可通过如下配置开启：</p>\n<p><em>net:<br/>   max_conn_count_each_peer: 5</em></p>\n<p>4.2.2 大报文拆包并行传输的设置</p>\n<p>LiquidNet支持将大消息体拆分为最多256个小包并行发送，在接收端自动组装成原大体积消息的功能。可通过如下配置开启：</p>\n<p><em>net:<br/>   pkt_enabled: true</em></p>\n<p>4.2.3 消息优先级管理的设置</p>\n<p>LiquidNet支持消息发送优先级控制，可通过如下配置开启：</p>\n<p><em>net:<br/>   priority_control: true #优先级总共划分为[0-9]总共10级，值越高，优先级越高。</em></p>\n<p>开启优先级控制后，会使用下面默认优先级设置，开发者也可以根据需要自定义消息优先级。<br/> 优先级9：共识引擎消息<br/> 优先级8：区块消息<br/> 优先级7：交易消息<br/> 优先级5：同步引擎消息、</p>\n<p></p>\n<p style=\"text-align:center;\"><strong>RECOMMEND</strong></p>\n<p style=\"text-align:center;\"></p>\n<p style=\"text-align:center;\">推荐阅读</p>\n<p style=\"text-align:center;\"><a href=\"http://mp.weixin.qq.com/s?__biz=Mzg4NzU2NjYwMA==&amp;mid=2247485225&amp;idx=1&amp;sn=a4b6cd72892a5d08ed44d685ca39f444&amp;chksm=cf893f4ef8feb65802dc9329bd4b1a81677d5d965b6d2fd77f42cabad5db7cba3f5cb633e6f9&amp;scene=21#wechat_redirect\" title=\"长安链发布自研P2P网络Liquid，先睹为快\">长安链发布自研P2P网络Liquid，先睹为快</a></p>\n<p style=\"text-align:center;\"><a href=\"http://mp.weixin.qq.com/s?__biz=Mzg4NzU2NjYwMA==&amp;mid=2247485273&amp;idx=1&amp;sn=9a79c84678585359d26120b27e442e0c&amp;chksm=cf893f3ef8feb628bd7b9e5df9395610423e5db762c4f677657fce273ae848a84a0a127ec633&amp;scene=21#wechat_redirect\" title=\"直播回顾：长安链自研网络Liquid及新版本功能特性解读\">直播回顾：长安链自研网络Liquid及新版本功能特性解读</a></p>\n<p></p>\n<p>Tips</p>\n<p>更多长安链开源项目QA，可登录开源社区、技术文档库查看。</p>\n<p>下载源码</p>\n<p>https://git.chainmaker.org.cn/chainmaker/chainmaker-go</p>\n<p>查阅文档</p>\n<p>https://docs.chainmaker.org.cn/</p>\n<p style=\"text-align:center;\"><img alt=\"Image\" src=\"..\\..\\static\\image\\ce1c081ddee23d2260a16a40578fe19c.png\"/></p>\n<p style=\"text-align:center;\"><img alt=\"Image\" height=\"45\" src=\"..\\..\\static\\image\\16268ccda68753aa141885be27d1f863.png\" width=\"135\"/></p>\n<p>“长安链ChainMaker”是国内首个自主可控区块链软硬件技术体系，由微芯研究院联合头部企业和高校共同研发，具有全自主、高性能、强隐私、广协作的突出特点。长安链面向大规模节点组网、高交易处理性能、强数据安全隐私等下一代区块链技术需求，融合区块链专用加速芯片硬件和可装配底层软件平台，为构建高性能、高可信、高安全的数字基础设施提供新的解决方案，为长安链生态联盟提供强有力的区块链技术支撑。取名“长安链”，喻意“长治久安、再创辉煌、链接世界“</p>\n</div>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2021-11-24 10:45:36", "summary": "作为长安链最新发布的自研网络，拥有诸多重要的新特性，本文将为大家详细介绍诞生的来龙去脉，并横向对比和特性。为什么我们需要自研网络关注长安链的小伙伴都了解，长安链的网络模块是基于开源项目进行封装的。体系"}