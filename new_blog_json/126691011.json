{"blogid": "126691011", "writerAge": "码龄20年", "writerBlogNum": "31", "writerCollect": "16", "writerComment": "3", "writerFan": "10", "writerGrade": "3级", "writerIntegral": "576", "writerName": "爱游泳的老白", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126691011.jpg", "writerRankTotal": "32931", "writerRankWeekly": "10068", "writerThumb": "4", "writerVisitNum": "7986", "blog_read_count": "135", "blog_time": "已于 2022-09-04 20:07:01 修改", "blog_title": "从CentOS6升级到CentOS7要注意的一些事项", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"CentOS_7__1\"></a>安装完CentOS 7 后要做的几件事</h1>\n<p>CentOS：全名为“社区企业操作系统（Community Enterprise Operating System）”，提供长期免费升级和更新服务，自由使用。国内最大的服务器操作系统，现在基本所有的互联网公司后台服务器都采用CentOS。<br/> 自CentOS7后跟以前版本有了很大变化,此文详细的列出需要注意的地方.</p>\n<h2><a id=\"rootssh_6\"></a>禁止root使用ssh登入</h2>\n<p><code>vim /etc/ssh/sshd_config</code><br/> 查找：<code>#PermitRootLogin yes</code> 修改为 <code>PermitRootLogin no</code><br/> 重启sshd服务：<code>systemctl restart sshd</code></p>\n<p>对于一些需要root权限才能修改的目录(如：/var/www/html)，可使用 ACL 给普通用户单独赋值<br/> <code>setfacl -m user:ryan:rwx /var/www/html</code></p>\n<h2><a id=\"ssh_17\"></a>使用非常规的ssh端口</h2>\n<p><code>vim /etc/ssh/sshd_config</code><br/> 查找：<code>#Port 22</code> 修改为 <code>Port 9999</code><br/> 可以把9999改为任何1024 – 65535之间的任何数字</p>\n<p>重启动sshd服务：<code>systemctl restart sshd</code><br/> 最后是设定防火墙放行新端口：<br/> <code>firewall-cmd --zone=public --add-port=9999/tcp --permanent</code></p>\n<p>完成后不要登出系统，使用另一个视窗尝试登入，例如：<code>ssh -p 9999 ryan@ip</code> 登录正常即可放心登出。</p>\n<h2><a id=\"_31\"></a>开启防火墙</h2>\n<p>查看一下防火墙现在编辑了哪些服务和端口：<br/> <code>firewall-cmd --list-all</code><br/> 一般防火墙只开启了DHCP 客户端和ssh 两个服务的通讯端口，倘若日后安装了其他网络软件，如web服务器，必须要检查安装程式有否编辑他们的通讯端口，没有的话便要手动编辑。firewall几个常用命令：</p>\n<pre><code class=\"prism language-bash\"><span class=\"token comment\">#查看防火墙状态</span>\nfirewall-cmd --state\n\n<span class=\"token comment\">#启动防火墙</span>\nsystemctl start firewalld\n<span class=\"token comment\">#停止防火墙</span>\nsystemctl stop firewalld\n<span class=\"token comment\">#重启防火墙</span>\nsystemctl restart firewalld\n\n<span class=\"token comment\">#设置开机自启</span>\nsystemctl <span class=\"token builtin class-name\">enable</span> firewalld\n<span class=\"token comment\">#查看防火墙设置开机自启是否成功</span>\nsystemctl is-enabled firewalld\n\n<span class=\"token comment\">#添加一些基本的端口</span>\nfirewall-cmd --add-service<span class=\"token operator\">=</span>ftp --permanent\nfirewall-cmd --remove-service<span class=\"token operator\">=</span>ftp --permanent\nfirewall-cmd --add-port<span class=\"token operator\">=</span><span class=\"token number\">8080</span>/tcp --permanent\n\n<span class=\"token comment\">#查看放行的端口</span>\nfirewall-cmd --list-ports\n</code></pre>\n<p><strong>直接修改配置文件</strong></p>\n<p>用户自定义的规则文件<code>/etc/firewalld/zones/public.xml</code></p>\n<p>修改该配置文件，来添加8080端口。修改后的内容为</p>\n<pre><code class=\"prism language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>zone</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>short</span><span class=\"token punctuation\">&gt;</span></span>Public<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>short</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>description</span><span class=\"token punctuation\">&gt;</span></span>For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected incoming connec\ntions are accepted.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>description</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>service</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ssh<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>service</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dhcpv6-client<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>port</span> <span class=\"token attr-name\">protocol</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tcp<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">port</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>8080<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>zone</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<h2><a id=\"SElinux_82\"></a>关闭SElinux</h2>\n<p>这个是一个安全服务，但是配置复杂，会影响很多软件的部署,如samba会被阻止访问。</p>\n<p><code>vi /etc/selinux/config</code></p>\n<p>找到<code>#SELINUX=enforcing</code>，改成<code>SELINUX=disabled</code>，保存。这个操作需要重启才能永久生效，所以可以临时关闭一下。</p>\n<p>执行命令<code>setenforce 0</code></p>\n<p>查看是否生效的命令是: <code>sestatus</code></p>\n<p>再把 selinux-policy 卸载: <code>yum remove selinux-policy</code></p>\n<blockquote>\n<p>Centos 7 开机一直转圈 提示failed to load SELinux policy freezing的解决方法</p>\n<p>在一直转圈停留界面处点击键盘Esc键，即可看到 failed to load SELinux policy. freezing.</p>\n<p>解决方法如下：</p>\n<p>1、重启系统，进入boot选择系统内核的界面，按e键，找到linux16 那一行，在language 后面 也就是LANG=zh_CN.UTF-8，加上空格，再加上selinux=0。 之后按ctrl+x，稍等片刻即可进入系统登录界面；</p>\n</blockquote>\n<h2><a id=\"_106\"></a>安装一些小工具</h2>\n<p>先安装额外的仓库源</p>\n<pre><code class=\"prism language-bash\"><span class=\"token builtin class-name\">cd</span> /etc/yum.repos.d\n<span class=\"token function\">mv</span> ./CentOS-Media.repo ./CentOS-Media.repo.BAK\n\nyum <span class=\"token function\">install</span> epel-release -y\n</code></pre>\n<blockquote>\n<p>epel是社区强烈打造的免费开源发行软件包版本库。</p>\n<p>EPEL，即Extra Packages for Enterprise Linux的简称，是为企业级Linux提供的一组高质量的额外软件包，包括但不限于Red Hat Enterprise Linux (RHEL)</p>\n</blockquote>\n<p>如果在安装系统的时候选择minimal，会比之前6的时候以更小的包来安装，比如：vim、ifconfig、route、setup、netstat等等很多命令都没有了,在安装系统后可加入以下软件包：</p>\n<pre><code class=\"prism language-bash\">yum <span class=\"token function\">install</span> -y <span class=\"token function\">htop</span> lrzsz tree net-tools nmap <span class=\"token function\">vim</span> bash-completion <span class=\"token function\">lsof</span> dos2unix <span class=\"token function\">nc</span> telnet ntp <span class=\"token function\">wget</span> rng-tools psmisc <span class=\"token function\">screen</span> \n</code></pre>\n<blockquote>\n<p>htop 图示化查看系统负载<br/> lrzsz 支持windowns平台的上传下载linux。在windowns远程连接工具上可以使用。上传：<code>rz</code>; 下载：<code>sz filename</code><br/> net-tools CentOS 7.2.11 默认没有ifconfig命令。net-tools提供一些网络命令(netstat)。<br/> bash-completion 自动命令补全的工具。<br/> rng-tools 生成随机数嫡池的一个工具，有了这个工具tomcat 启动会变得非常快。<br/> psmisc 这个包含有killall命令。<br/> screen 可以新建一个窗口，把任务放在后台运行。</p>\n</blockquote>\n<h2><a id=\"_138\"></a>字符集修改</h2>\n<p>字符集配置文件: <code>/etc/locale.conf</code><br/> 设置字符集: <code>localectl set-locale LANG=zh_CN.UTF-8</code><br/> 查看字符集: <code>localectl status</code></p>\n<h2><a id=\"hostname_146\"></a>修改hostname</h2>\n<pre><code>[root@centos7 ~]$ hostnamectl set-hostname centos77.magedu.com             # 使用这个命令会立即生效且重启也生效\n[root@centos7 ~]$ hostname                                                 # 查看下\ncentos77.magedu.com\n[root@centos7 ~]$ vim /etc/hosts                                           # 编辑下hosts文件， 给127.0.0.1添加hostname\n[root@centos7 ~]$ cat /etc/hosts                                           # 检查\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 centos77.magedu.com\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n</code></pre>\n<h1><a id=\"_158\"></a>打开中文输入法</h1>\n<p>centos7自带中文输入法，可能我们在安装时会跳过选择汉语拼音，我们来重新设置一下吧</p>\n<p>假如你在命令行界面，输入Ctrl+Alt+F1进入图形界面</p>\n<p>点击左上角系统工具 --》 设置 --》 区域和语言，选择汉语（Intelligent Pinyin）</p>\n<p>好啦！最后点击桌面右上角切换至此中文输入法。（注意：不同输入法之间切换快捷键为<code>win+空格</code>，二者之间切换为<code>win+shift</code>）在终端下试试这个汉语拼音输入法吧</p>\n<p>在此输入法下，按<code>左shift</code>快捷键可中英互换哦！（桌面右上角也可切换）。</p>\n<p>假如系统没有安装汉语拼音，可以在终端输入命令安装: <code>yum install ibus-libpinyin </code></p>\n<blockquote>\n<p>如果系统按照中文环境安装完成后还是不能出现输入法，在系统【设置】-&gt;【Region&amp;Language】-&gt;【输入源】+ 添加汉语输入源后，仍然不能输入汉语,那么:查看【设置】-&gt;【Region&amp;Language】-&gt;【输入源】-&gt;【汉语(中国)】里面，有没有添加【汉语(intelligent Pinyin)】选项<br/> 注意：是<code>汉语（intelligent Pinyin）</code>选项。添加成功，点击齿轮图标进入输入法设置。</p>\n</blockquote>\n<h1><a id=\"_177\"></a>开机启动管理</h1>\n<h2><a id=\"rclocal_179\"></a>方法一：（rc.local）</h2>\n<p>1、因为在<a href=\"https://so.csdn.net/so/search?q=centos7&amp;spm=1001.2101.3001.7020\">centos7</a>中<code>/etc/rc.d/rc.local</code>的权限被降低了，所以需要赋予其可执行权</p>\n<pre><code class=\"prism language-bash\"><span class=\"token function\">chmod</span> +x /etc/rc.d/rc.local\n</code></pre>\n<p>2、赋予脚本可执行权限<br/> 假设<code>/usr/local/script/autostart.sh</code>是你的脚本路径，给予执行权限</p>\n<pre><code class=\"prism language-bash\"><span class=\"token function\">chmod</span> +x /usr/local/script/autostart.sh\n</code></pre>\n<p>3、打开<code>/etc/rc.d/rc.local</code>文件，在末尾增加如下内容</p>\n<pre><code class=\"prism language-bash\">/usr/local/script/autostart.sh\n</code></pre>\n<h2><a id=\"chkconfig_200\"></a>方法二：（chkconfig）</h2>\n<p>1、将脚本移动到<code>/etc/rc.d/init.d</code>目录下</p>\n<pre><code class=\"prism language-bash\"><span class=\"token function\">mv</span>  /usr/local/script/autostart.sh /etc/rc.d/init.d\n</code></pre>\n<p>2、增加脚本的可执行权限</p>\n<pre><code class=\"prism language-bash\"><span class=\"token function\">chmod</span> +x  /etc/rc.d/init.d/autostart.sh\n</code></pre>\n<p>3、添加脚本到开机自动启动项目中</p>\n<pre><code class=\"prism language-bash\"><span class=\"token builtin class-name\">cd</span> /etc/rc.d/init.d\n\n<span class=\"token function\">chkconfig</span> --add autostart.sh\n<span class=\"token function\">chkconfig</span> autostart.sh on\n</code></pre>\n<p>chkconfig启动脚本规范 在脚本开头加入下面内容：</p>\n<pre><code class=\"prism language-properties\">#!/bin/sh\n\n#chkconfig:2345 80 90\n#decription:autostart\n</code></pre>\n<blockquote>\n<p><strong>说明：</strong> chkonfig后面是启动级别和优先级，description后面是服务描述。如上面脚本意思是，<br/> 服务必须在运行级2，3，4，5下被启动或关闭，启动的优先级是90，停止的优先级是10。<br/> 优先级范围是0－100，数字越大，优先级越低。</p>\n</blockquote>\n<h1><a id=\"runlevel_238\"></a>运行级别runlevel</h1>\n<p><code>/etc/inittab</code>是无效的被system target替代</p>\n<p>永久生效下次登录生效</p>\n<pre><code>systemctl get-default graphical.target 切换到5\nsystemctl get-default multi-user.target 切换到3\n</code></pre>\n<p>只有五种运行级别</p>\n<pre><code>[root@centos7 ~]# ls -lh /usr/lib/systemd/system/runlevel*.target\nlrwxrwxrwx. 1 root root 15 Apr 20 22:31 /usr/lib/systemd/system/runlevel0.target -&gt; poweroff.target\nlrwxrwxrwx. 1 root root 13 Apr 20 22:31 /usr/lib/systemd/system/runlevel1.target -&gt; rescue.target\nlrwxrwxrwx. 1 root root 17 Apr 20 22:31 /usr/lib/systemd/system/runlevel2.target -&gt; multi-user.target\nlrwxrwxrwx. 1 root root 17 Apr 20 22:31 /usr/lib/systemd/system/runlevel3.target -&gt; multi-user.target\nlrwxrwxrwx. 1 root root 17 Apr 20 22:31 /usr/lib/systemd/system/runlevel4.target -&gt; multi-user.target\nlrwxrwxrwx. 1 root root 16 Apr 20 22:31 /usr/lib/systemd/system/runlevel5.target -&gt; graphical.target\nlrwxrwxrwx. 1 root root 13 Apr 20 22:31 /usr/lib/systemd/system/runlevel6.target -&gt; reboot.target\n</code></pre>\n<h1><a id=\"yum_260\"></a>配置yum源</h1>\n<pre><code>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\nwget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\n</code></pre>\n<p>官方epel源</p>\n<pre><code>wget http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nrpm -ivh epel-release-latest-7.noarch.rpm\n</code></pre>\n<h1><a id=\"IP_273\"></a>配置IP地址</h1>\n<p>进入网卡配置文件目录<code>cd /etc/sysconfig/network-scripts/</code></p>\n<p>centos7默认没有ifconfig命令，需<code>yum install net-tools</code>安装; 可通过命令<code>ip addr</code>查看</p>\n<p><strong>动态获取ip（前提是你的路由器已经开启了DHCP）</strong></p>\n<p>修改网卡配置文件 <code>vi /etc/sysconfig/network-scripts/ifcfg-ens32</code> (最后一个为网卡名称)</p>\n<p>动态获取IP地址需要修改两处地方即可<br/> （1） bootproto=dhcp<br/> （2） onboot=yes</p>\n<blockquote>\n<p>修改后重启一下网络服务即可<code>systemctl restart network</code></p>\n</blockquote>\n<p><strong>配置静态IP地址</strong></p>\n<p>设置静态IP地址与动态iIP差不多，也是要修改网卡配置文件<code>vi /etc/sysconfig/network-scripts/ifcfg-ens32</code> (最后一个为网卡名称)</p>\n<p>（1）bootproto=static</p>\n<p>（2）onboot=yes</p>\n<p>（3）在最后加上几行，IP地址、子网掩码、网关、dns服务器</p>\n<pre><code class=\"prism language-properties\">IPADDR=192.168.1.160\nNETMASK=255.255.255.0\nGATEWAY=192.168.1.1\nDNS1=114.114.114.114\nDNS2=8.8.8.8\n</code></pre>\n<blockquote>\n<p>修改后重启一下网络服务即可<code>systemctl restart network</code></p>\n</blockquote>\n<h1><a id=\"_309\"></a>服务管理</h1>\n<p>centos6 采用 service和chconfig管理服务<br/> centos7 采用systemctl 管理服务，但是还可以使用service和chkconfig命令<br/> 下面以sshd服务为实例</p>\n<table><thead><tr><th>sysvinit命令</th><th>systemd命令</th><th>备注</th></tr></thead><tbody><tr><td>service sshd start/stop/restart/status</td><td>systemctl start/stop/restart/status sshd</td><td>服务的开始/停止/重启/状态</td></tr><tr><td>service sshd reload</td><td>systemctl reload sshd</td><td>重启读取配置文件（不停掉服务）</td></tr><tr><td>chkconfig sshd on/off</td><td>systemctl enable/disable sshd</td><td>服务开机自启/不开机自启</td></tr><tr><td>chkconfig --list</td><td>systemtcl list-unit-files</td><td>查看所有服务开机自启动或者禁止情况</td></tr><tr><td>chkconfig --list sshd</td><td>systemctl is-enabled sshd</td><td>查看单个服务是否开机自启</td></tr><tr><td>chkconfig --add sshd</td><td>systemctl daemon-reload</td><td>修改服务文件（不是配置文件）后，重新加载服务</td></tr></tbody></table>\n<p>centos7查看系统开机时间占用（优化开机）<br/> systemd-analyze time<br/> systemd-analyze blame</p>\n<h1><a id=\"_328\"></a>文件结构变化</h1>\n<p>centos6的/bin, /sbin, /lib, and /lib64在/下<br/> centos7的/bin, /sbin, /lib, and /lib64移到/usr下</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-04 20:07:01", "summary": "安装完后要做的几件事：全名为社区企业操作系统，提供长期免费升级和更新服务，自由使用。国内最大的服务器操作系统，现在基本所有的互联网公司后台服务器都采用。自后跟以前版本有了很大变化此文详细的列出需要注意"}