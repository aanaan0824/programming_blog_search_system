{"blogid": "126742510", "writerAge": "码龄14年", "writerBlogNum": "131", "writerCollect": "391", "writerComment": "26", "writerFan": "3767", "writerGrade": "5级", "writerIntegral": "3082", "writerName": "程序之巅", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126742510.jpg", "writerRankTotal": "17136", "writerRankWeekly": "4364", "writerThumb": "105", "writerVisitNum": "393154", "blog_read_count": "20", "blog_time": "已于 2022-09-07 12:01:15 修改", "blog_title": "Pyinstaller生成的exe程序，运行时找不到自定义模块", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p><strong>问题描述</strong><br/> 今日用pyinstaller生成了一个exe文件，运行时一直出现ModuleNotFoundError: No module named 'models’错误。</p>\n<pre><code class=\"prism language-python\"><span class=\"token punctuation\">(</span>maskrcnn_yolov5<span class=\"token punctuation\">)</span> D<span class=\"token punctuation\">:</span>\\project\\cell_experts\\dist\\experts<span class=\"token operator\">&gt;</span>experts<span class=\"token punctuation\">.</span>exe\nTraceback <span class=\"token punctuation\">(</span>most recent call last<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  File <span class=\"token string\">\"experts.py\"</span><span class=\"token punctuation\">,</span> line <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">in</span> <span class=\"token operator\">&lt;</span>module<span class=\"token operator\">&gt;</span>\n  File <span class=\"token string\">\"PyInstaller\\loader\\pyimod03_importers.py\"</span><span class=\"token punctuation\">,</span> line <span class=\"token number\">495</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">in</span> exec_module\n  File <span class=\"token string\">\"cell_detection\\cell_detector_batches.py\"</span><span class=\"token punctuation\">,</span> line <span class=\"token number\">19</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">in</span> <span class=\"token operator\">&lt;</span>module<span class=\"token operator\">&gt;</span>\nModuleNotFoundError<span class=\"token punctuation\">:</span> No module named <span class=\"token string\">'models'</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">138248</span><span class=\"token punctuation\">]</span> Failed to execute script <span class=\"token string\">'experts'</span> due to unhandled exception!\n</code></pre>\n<p>我的项目的目录结构如下所示：</p>\n<pre><code class=\"prism language-python\"><span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>cell_experts\n<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span>cell_detection\n                    <span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>models\n                    <span class=\"token operator\">|</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span>utils\n<span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span>cell_analyser\n</code></pre>\n<p>cell_detector_batches.py的代码如下所示例：</p>\n<pre><code class=\"prism language-python\"><span class=\"token comment\">#  -*- coding:  utf-8  -*-</span>\n<span class=\"token comment\"># YOLOv5 🚀 by Ultralytics, GPL-3.0 license</span>\n<span class=\"token keyword\">import</span> argparse\n<span class=\"token keyword\">import</span> sys\n<span class=\"token keyword\">from</span> pathlib <span class=\"token keyword\">import</span> Path\n<span class=\"token keyword\">import</span> time<span class=\"token punctuation\">,</span> os\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> math\n<span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> torch\n<span class=\"token keyword\">import</span> json\n\nFILE <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">(</span>__file__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nROOT <span class=\"token operator\">=</span> FILE<span class=\"token punctuation\">.</span>parents<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\"># YOLOv5 root directory</span>\n<span class=\"token keyword\">if</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>ROOT<span class=\"token punctuation\">)</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> sys<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">:</span>\n    sys<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>ROOT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># add ROOT to PATH</span>\nROOT <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>relpath<span class=\"token punctuation\">(</span>ROOT<span class=\"token punctuation\">,</span> Path<span class=\"token punctuation\">.</span>cwd<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># relative</span>\n\n<span class=\"token keyword\">from</span> models<span class=\"token punctuation\">.</span>common <span class=\"token keyword\">import</span> DetectMultiBackend\n<span class=\"token keyword\">from</span> utils<span class=\"token punctuation\">.</span>general <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>LOGGER<span class=\"token punctuation\">,</span> check_img_size<span class=\"token punctuation\">,</span> check_requirements<span class=\"token punctuation\">,</span>\n                           increment_path<span class=\"token punctuation\">,</span> non_max_suppression<span class=\"token punctuation\">,</span>nms_double<span class=\"token punctuation\">,</span> print_args<span class=\"token punctuation\">,</span> scale_coords<span class=\"token punctuation\">,</span> strip_optimizer<span class=\"token punctuation\">,</span> xyxy2xywh<span class=\"token punctuation\">,</span>cell_classifier<span class=\"token punctuation\">,</span>correct_axis<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">from</span> utils<span class=\"token punctuation\">.</span>torch_utils <span class=\"token keyword\">import</span> select_device\n</code></pre>\n<p>使用的exe生成的命令：</p>\n<pre><code class=\"prism language-python\">pyinstaller <span class=\"token operator\">-</span>D experts<span class=\"token punctuation\">.</span>py\n</code></pre>\n<p><strong>问题产生原因</strong><br/> PyInstaller 读取您编写的 Python 脚本。它分析您的代码以发现脚本执行所需的所有其他模块和库。然后它收集所有这些文件的副本——包括活动的 Python 解释器！ – 并将它们与您的脚本放在一个文件夹中，或者可选地放在一个可执行文件中。</p>\n<p>PyInstaller 会在您的脚本中查找所有import语句。它找到导入的模块并在其中查找导入语句，以此类推，直到它拥有您的脚本可能使用的模块的完整列表。</p>\n<p>一些 Python 脚本以 PyInstaller 无法检测到的方式导入模块：例如，通过使用带有可变数据的 <strong>import</strong>() 函数、使用 importlib.import_module() 或在运行时操作 sys.path 值。如果你的脚本需要 PyInstaller 不知道的文件，你必须帮助它：</p>\n<ul><li>您可以在 pyinstaller 命令行上提供其他文件。</li><li>您可以在命令行上提供其他导入路径。</li><li>您可以编辑 PyInstaller 第一次为您的脚本运行它时编写的 myscript.spec 文件。在规范文件中，您可以告诉<br/> PyInstaller 您的脚本独有的代码模块。</li><li>您可以编写通知 PyInstaller 隐藏导入的“挂钩”文件。如果您为其他用户也可能使用的包创建“挂钩”，您可以将挂钩文件贡献给<br/> PyInstaller。</li></ul>\n<p><strong>解决方法</strong></p>\n<pre><code class=\"prism language-python\">pyinstaller <span class=\"token operator\">-</span><span class=\"token operator\">-</span>paths<span class=\"token operator\">=</span>D<span class=\"token punctuation\">:</span>\\project\\cell_experts\\cell_detection <span class=\"token operator\">-</span><span class=\"token operator\">-</span>paths<span class=\"token operator\">=</span>D<span class=\"token punctuation\">:</span>\\project\\cell_experts\\cell_analyser <span class=\"token operator\">-</span>D experts<span class=\"token punctuation\">.</span>py\n</code></pre>\n<p>同类解决方法：<br/> <a href=\"https://stackoverflow.com/questions/32093559/exe-file-created-by-pyinstaller-not-find-self-defined-modules-while-running\">https://stackoverflow.com/questions/32093559/exe-file-created-by-pyinstaller-not-find-self-defined-modules-while-running</a></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-07 12:01:15", "summary": "问题描述今日用生成了一个文件，运行时一直出现错误。我的项目的目录结构如下所示：的代码如下所示例："}