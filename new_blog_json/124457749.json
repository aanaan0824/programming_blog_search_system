{"blogid": "124457749", "writerAge": "码龄6年", "writerBlogNum": "34", "writerCollect": "28", "writerComment": "4", "writerFan": "426", "writerGrade": "4级", "writerIntegral": "817", "writerName": "MrEahon", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124457749.jpg", "writerRankTotal": "58279", "writerRankWeekly": "20276", "writerThumb": "12", "writerVisitNum": "60461", "blog_read_count": "3062", "blog_time": "已于 2022-04-28 11:03:00 修改", "blog_title": "微信小程序，安卓可以调接口，苹果调不了的解决方案", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h3>今天跟前端进行联调，遇到一个奇怪的问题，做个记录。</h3>\n<p></p>\n<p></p>\n<h3>问题描述：在微信小程序上面，同一个接口调用，在安卓可以正常访问，但是在苹果缺报错了。如下图：</h3>\n<h3>请求头提示：<span style=\"color:#fe2c24;\">Provisional headers are shown</span></h3>\n<p><img alt=\"\" height=\"518\" src=\"..\\..\\static\\image\\81eb7a864bb344858b58d4148e84ba6d.png\" width=\"1200\"/></p>\n<p></p>\n<p></p>\n<p></p>\n<h2>解决：</h2>\n<p><strong>1：跨域</strong></p>\n<p>首先第一个想法就是跨域了，不过很快就否决掉了。</p>\n<p>原因：安卓和我们自己的后台都可以正常访问</p>\n<p></p>\n<p><strong>2：tls问题</strong></p>\n<p>tls版本正常。</p>\n<p>下面附上查看tls版本的方法：</p>\n<p>1、打开浏览器（谷歌、火狐、360极速版）都可以，在地址栏中输入域名（一定要包含https的域名）<br/> 以谷歌为例：</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20200905140114660.png\"/></p>\n<p>打开域名以后，点击F12或右键检查，找到‘Security’，即可查看对应TLS版本</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20200905140251229.png\"/></p>\n<p> 附：WIndows系统对TLS的支持</p>\n<p> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\20200905140351889.png\"/></p>\n<p><span style=\"color:#fe2c24;\"> <strong>Tips:这里强调一下，tls版本必须大于或者等于1.2才可以，否则的话也会出现开头那个问题</strong></span></p>\n<p></p>\n<p></p>\n<p><span style=\"color:#0d0016;\"><strong>3：SSL证书</strong></span></p>\n<p>1：重新检查了，ssl证书正常，没有过期。</p>\n<p>2：检测证书</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\20190511165909379.png\"/></p>\n<p></p>\n<p>输入该输入的信息，读取证书。看到以下内容，说明缺少ssl证书。</p>\n<p></p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\20190511170112504.png\"/></p>\n<p></p>\n<p>网址：<a class=\"has-card\" href=\"https://www.myssl.cn/tools/check-server-cert.html\" title=\"SSL服务器证书安装检查器_OPENSSL工具包_迅通诚信\"><span class=\"link-card-box\"><span class=\"link-title\">SSL服务器证书安装检查器_OPENSSL工具包_迅通诚信</span><span class=\"link-link\"><img alt=\"\" class=\"link-link-icon\" src=\"..\\..\\static\\image\\icon-default.png\"/>https://www.myssl.cn/tools/check-server-cert.html</span></span></a></p>\n<p>情况1：</p>\n<p>我这次遇到的情况查询到最后，发现是证书pem复制少了一段，</p>\n<p>因为Apache下载下来有三个文件，一个是根证书pem，一个是中间证书pem，一个是秘钥</p>\n<p>而Nginx证书下载下来是只有两个文件，一个<strong><code>fullchain.pem，一个是key</code></strong></p>\n<p><strong><code>fullchain.pem一般会包含根证书+</code></strong><font face=\"monospace\"><strong>中间证书，所以会存在两段如下：</strong></font></p>\n<pre><code>-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----</code></pre>\n<p>但是我这次这有一段，也许是其他同事复制少了，重新下载证书内容上去，问题解决！</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\8b5327ab7961a8c8087978de7d31a6aa.png\"/></p>\n<p> 中间证书显示正常！</p>\n<p></p>\n<p><strong>另外，查阅资料的时候，还有另外一种方案可以重新生成中间件证书，记录一下：</strong></p>\n<p>首先先找到 <code>Let's Encrypt</code> 生成出证书的4个文件</p>\n<ol><li><code>cert.pem</code></li><li><code>chain.pem</code></li><li><code>fullchain.pem</code></li><li><code>privkey.pem</code></li></ol>\n<p>将 cert.pem 内容复制到这个地址解析 </p>\n<p><a class=\"link-info\" href=\"https://www.myssl.cn/tools/downloadchain.html\" title=\"https://www.myssl.cn/tools/downloadchain.html\">https://www.myssl.cn/tools/downloadchain.html</a></p>\n<p><img alt=\"\" height=\"708\" src=\"..\\..\\static\\image\\c9d188485a6940b0bfd657cfa359335e.png\" width=\"1200\"/></p>\n<p> </p>\n<p>解析成功可以获得2个下载按钮<br/> 使用 [点击下载中间证书文件]</p>\n<p>将下载到的文件中的 内容 复制到 fullchain.pem 的 两段内容的中间 ，保存即可。</p>\n<p>(需要注意 fullchain.pem 格式要求极为严格 不能存在空行 空格等)</p>\n<p>最后重启nginx 问题解决</p>\n<ol><li><code># 测试配置是否正常</code></li><li><code>nginx -t</code></li><li><code># 重新加载配置文件</code></li><li><code>nginx -s reload</code></li></ol>\n<h1>结论</h1>\n<p>原因找到，是服务器缺少中间证书导致的。</p>\n<p>问题解决！</p>\n<p></p>\n<p></p>\n</div>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-04-28 11:03:00", "summary": "今天跟前端进行联调，遇到一个奇怪的问题，做个记录。问题描述：在微信小程序上面，同一个接口调用，在安卓可以正常访问，但是在苹果缺报错了。如下图：请求头提示：解决：：跨域首先第一个想法就是跨域了，不过很快"}