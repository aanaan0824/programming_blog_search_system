{"blogid": "124788963", "writerAge": "码龄9年", "writerBlogNum": "116", "writerCollect": "177", "writerComment": "113", "writerFan": "25", "writerGrade": "4级", "writerIntegral": "1248", "writerName": "故里2130", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124788963.jpg", "writerRankTotal": "16110", "writerRankWeekly": "6433", "writerThumb": "37", "writerVisitNum": "76209", "blog_read_count": "1491", "blog_time": "已于 2022-05-15 23:17:38 修改", "blog_title": "C#创建Windows服务", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>1.打开vs2019,建立Windows服务</p>\n<p><img alt=\"\" height=\"108\" src=\"..\\..\\static\\image\\13508b02fede45788f8b57f43e2199ba.png\" width=\"587\"/></p>\n<p>2.打开Service1.cs文件，写入代码</p>\n<p><img alt=\"\" height=\"451\" src=\"..\\..\\static\\image\\e6924b16b5e44567b92b79b85ec35d66.png\" width=\"601\"/></p>\n<p></p>\n<pre><code class=\"language-cs\">using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Diagnostics;\nusing System.IO;\nusing System.Linq;\nusing System.ServiceProcess;\nusing System.Text;\nusing System.Threading.Tasks;\n\nnamespace WindowsService1\n{\n    public partial class Service1 : ServiceBase\n    {\n        public Service1()\n        {\n            InitializeComponent();\n        }\n        string filePath = \"D:\\\\Service1.txt\";\n        protected override void OnStart(string[] args)//服务启动的时候执行\n        {\n            using (FileStream stream = new FileStream(filePath, FileMode.Append))\n            using (StreamWriter writer = new StreamWriter(stream))\n            {\n                writer.WriteLine($\"{DateTime.Now},服务启动！\");\n            }\n        }\n\n        protected override void OnStop()//服务停止的时候执行\n        {\n            using (FileStream stream = new FileStream(filePath, FileMode.Append))\n            using (StreamWriter writer = new StreamWriter(stream))\n            {\n                writer.WriteLine($\"{DateTime.Now},服务停止！\");\n            }\n        }\n    }\n}\n</code></pre>\n<p>3. 回到界面上，点击增加安装程序</p>\n<p><img alt=\"\" height=\"295\" src=\"..\\..\\static\\image\\960e6f5ac6284ba3a3c172150390ad0e.png\" width=\"606\"/></p>\n<p> 4.此时产生2个组件</p>\n<p><img alt=\"\" height=\"173\" src=\"..\\..\\static\\image\\c87f721409064869b730af7e10e42ebe.png\" width=\"501\"/></p>\n<p> 5.右键属性，修改Description，就是描述服务的，ServiceName是服务的名字</p>\n<p><img alt=\"\" height=\"359\" src=\"..\\..\\static\\image\\e2cdfa16cb6a4299993f97ff13aba43b.png\" width=\"429\"/></p>\n<p> 6.点击另外一个组件，修改账号的级别，选择系统</p>\n<p><img alt=\"\" height=\"213\" src=\"..\\..\\static\\image\\52905da01d384cbab2bc409c26f546b8.png\" width=\"398\"/></p>\n<p>7.修改完成后，点击生成</p>\n<p><img alt=\"\" height=\"109\" src=\"..\\..\\static\\image\\58af1821b2924cb28d8b752d11e3db5c.png\" width=\"438\"/></p>\n<p> 8.打开生成的文件</p>\n<p><img alt=\"\" height=\"154\" src=\"..\\..\\static\\image\\e1934ed0ebe241baa92ffd6ed1f21bd2.png\" width=\"316\"/></p>\n<p>9.安装服务。这里不能直接双击。</p>\n<p>直接双击是这样的</p>\n<p><img alt=\"\" height=\"179\" src=\"..\\..\\static\\image\\5b0b72798017412bbd72e2e2fa0e44f3.png\" width=\"487\"/></p>\n<p>可以使用命令进行安装。</p>\n<p>使用管理员运行cmd，输入</p>\n<pre><code class=\"language-bash\">cd C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319</code></pre>\n<p>进入文件夹后，在输入安装服务的命令</p>\n<pre><code class=\"language-bash\">installutil.exe /i C:\\Users\\user\\source\\repos\\WindowsService1\\WindowsService1\\bin\\Debug\\WindowsService1.exe</code></pre>\n<p><img alt=\"\" height=\"146\" src=\"..\\..\\static\\image\\57d38fa10fb7482783b791d23d646b08.png\" width=\"993\"/></p>\n<p>点击回车，提示安装完成</p>\n<p><img alt=\"\" height=\"102\" src=\"..\\..\\static\\image\\7a182c3424544b80a30f9ac13b06ed88.png\" width=\"472\"/></p>\n<p> 10.此时打开Windows服务，可以看到服务已经安装好了</p>\n<p><img alt=\"\" height=\"585\" src=\"..\\..\\static\\image\\6b6c20483678431c899f644676a90d71.png\" width=\"956\"/></p>\n<p>11.右键启动服务后</p>\n<p> <img alt=\"\" height=\"154\" src=\"..\\..\\static\\image\\12c0aead2a134b638feacac80fed9277.png\" width=\"644\"/></p>\n<p>在D盘可以看到启动的日志</p>\n<p><img alt=\"\" height=\"120\" src=\"..\\..\\static\\image\\7ab71c32fb72425485a86d5b33d8ad7b.png\" width=\"779\"/></p>\n<p> 右键停止服务</p>\n<p> <img alt=\"\" height=\"130\" src=\"..\\..\\static\\image\\69f7073ba53c4e1f8d45009a4ca391f2.png\" width=\"650\"/></p>\n<p>在D盘可以看到停止的日志</p>\n<p><img alt=\"\" height=\"135\" src=\"..\\..\\static\\image\\225e39ba4f0048238bd35e7e14199058.png\" width=\"775\"/></p>\n<p>12.卸载</p>\n<p>卸载的时候，把i换u即可</p>\n<pre><code class=\"language-bash\">installutil.exe /u C:\\Users\\user\\source\\repos\\WindowsService1\\WindowsService1\\bin\\Debug\\WindowsService1.exe</code></pre>\n<p><img alt=\"\" height=\"49\" src=\"..\\..\\static\\image\\5c18b50079df4dd18d8c8a8470183b64.png\" width=\"974\"/></p>\n<p> 13.卸载成功</p>\n<p><img alt=\"\" height=\"94\" src=\"..\\..\\static\\image\\87dc0b893e8e412abfa58a9d4ff8f9bd.png\" width=\"408\"/></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n</div>\n</div>", "first_tag": "C#", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-05-15 23:17:38", "summary": "打开建立服务打开文件，写入代码服务启动的时候执行服务启动！服务停止的时候执行服务停止！回到界面上，点击增加安装程序此时产生个组件右键属性，修改，就是描述服务的，是服务的名字点击另外一个组件，修改账号的"}