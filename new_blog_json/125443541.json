{"blogid": "125443541", "writerAge": "码龄1年", "writerBlogNum": "87", "writerCollect": "694", "writerComment": "84", "writerFan": "1050", "writerGrade": "4级", "writerIntegral": "1138", "writerName": "予我心安A3", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125443541.jpg", "writerRankTotal": "19279", "writerRankWeekly": "215045", "writerThumb": "158", "writerVisitNum": "134025", "blog_read_count": "1071", "blog_time": "于 2022-06-24 20:02:09 发布", "blog_title": "用C#通过sql语句操作Sqlserver数据库教程", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"-toc\" style=\"margin-left:0px;\"></p>\n<p id=\"%E5%BF%85%E8%A6%81%E5%87%86%E5%A4%87-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%BF%85%E8%A6%81%E5%87%86%E5%A4%87\">必要准备</a></p>\n<p id=\"SQL%E8%AF%AD%E5%8F%A5%E7%BC%96%E5%86%99%E5%8A%A0%E6%89%A7%E8%A1%8C-toc\" style=\"margin-left:0px;\"><a href=\"#SQL%E8%AF%AD%E5%8F%A5%E7%BC%96%E5%86%99%E5%8A%A0%E6%89%A7%E8%A1%8C\">SQL语句编写加执行</a></p>\n<p id=\"%E7%BC%96%E5%86%99-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%BC%96%E5%86%99\">编写</a></p>\n<p id=\"%E6%89%A7%E8%A1%8C-toc\" style=\"margin-left:40px;\"><a href=\"#%E6%89%A7%E8%A1%8C\">执行</a></p>\n<p id=\"%E5%88%9B%E5%BB%BA%E6%89%A7%E8%A1%8C%E5%99%A8-toc\" style=\"margin-left:80px;\"><a href=\"#%E5%88%9B%E5%BB%BA%E6%89%A7%E8%A1%8C%E5%99%A8\">创建执行器</a></p>\n<p id=\"ExecuteNonQuery()%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C-toc\" style=\"margin-left:80px;\"><a href=\"#ExecuteNonQuery%28%29%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C\">ExecuteNonQuery()方式执行</a></p>\n<p id=\"%C2%A0ExecuteScalar()%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0ExecuteScalar%28%29%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C\"> ExecuteScalar()方式执行</a></p>\n<p id=\"%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB%C2%A0-toc\" style=\"margin-left:80px;\"><a href=\"#%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB%C2%A0\">二者区别 </a></p>\n<p id=\"%C2%A0ExecuteReader()%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C-toc\" style=\"margin-left:80px;\"><a href=\"#%C2%A0ExecuteReader%28%29%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C\"> ExecuteReader()方式执行</a></p>\n<p id=\"%E5%AE%9E%E4%BE%8B%EF%BC%9A-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%AE%9E%E4%BE%8B%EF%BC%9A\">实例：</a></p>\n<p id=\"1-%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E6%95%B0%E6%8D%AE%E8%A1%A8-toc\" style=\"margin-left:40px;\"><a href=\"#1-%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E6%95%B0%E6%8D%AE%E8%A1%A8\">1-创建一张数据表</a></p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91-toc\" style=\"margin-left:40px;\"><a href=\"#%E2%80%8B%E7%BC%96%E8%BE%91\">​编辑</a></p>\n<p id=\"2-%E5%90%91%E8%A1%A8%E4%B8%AD%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE-toc\" style=\"margin-left:40px;\"><a href=\"#2-%E5%90%91%E8%A1%A8%E4%B8%AD%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE\">2-向表中插入数据</a></p>\n<p id=\"3-%E4%BF%AE%E6%94%B9%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%C2%A0-toc\" style=\"margin-left:80px;\"><a href=\"#3-%E4%BF%AE%E6%94%B9%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%C2%A0\">3-修改表中数据 </a></p>\n<p id=\"4-%E5%88%A0%E9%99%A4%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE-toc\" style=\"margin-left:80px;\"><a href=\"#4-%E5%88%A0%E9%99%A4%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE\">4-删除表中数据</a></p>\n<p id=\"5-%E8%AF%BB%E5%8F%96%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE-toc\" style=\"margin-left:40px;\"><a href=\"#5-%E8%AF%BB%E5%8F%96%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE\">5-读取表中数据</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<h1 id=\"%E5%BF%85%E8%A6%81%E5%87%86%E5%A4%87\">必要准备</h1>\n<p>你得有一个sqlserver数据库，并且要和vs项目连接。</p>\n<p>关于VS连接sqlserver数据库的教程前几天发过了，链接如下</p>\n<p><a href=\"https://blog.csdn.net/yuwoxinanA3/article/details/125399200?spm=1001.2014.3001.5502\" title=\"VS2022连接sqlserver数据库教程_予我心安A3的博客-CSDN博客_vs如何连接数据库sqlserver\">VS2022连接sqlserver数据库教程_予我心安A3的博客-CSDN博客_vs如何连接数据库sqlserver</a></p>\n<p><strong> 调用用于访问和控制数据库的程序集。还得确保你真的安装了这个程序集</strong></p>\n<pre><code class=\"language-cs\">using System.Data.SqlClient;</code></pre>\n<p><img alt=\"\" height=\"525\" src=\"..\\..\\static\\image\\8d30d592821e4b638f09d7767e1fca20.png\" width=\"695\"/></p>\n<p> 安装好如下才对<img alt=\"\" height=\"876\" src=\"..\\..\\static\\image\\e72df90c278f4356aade6267e4339bad.png\" width=\"1200\"/></p>\n<p><strong>填写连接参数字符串</strong></p>\n<p><strong>无账号密码的数据库服务器（windows用户认证）这样写即可</strong></p>\n<pre><code class=\"language-cs\">string connStr = \"Data Source=LAPTOP-82MUPKTO;Initial Catalog=CSDN予我心安A3的数据库;Integrated Security=True\";\n\n//LAPTOP-82MUPKTO      连接的数据库服务器名\n//CSDN予我心安A3的数据库   连接的数据库名</code></pre>\n<p><strong>有账号密码登录的数据库服务器（sqlserver身份认证）这样写</strong></p>\n<pre><code class=\"language-cs\"> string connStr = \"Data Source=服务器名;Initial Catalog=数据库名;User ID = 账号;Password=密码\";</code></pre>\n<p><strong>将连接参数字符串传入数据库链接类，生成链接对象conn</strong></p>\n<pre><code class=\"language-cs\">SqlConnection conn = new SqlConnection(connStr);\n//SqlConnection 变量名 = new SqlConnection(参数字符串或存储了参数字符串的变量);</code></pre>\n<p><strong>进行链接的测试,运行不报错即链接成功</strong></p>\n<pre><code class=\"language-cs\">conn.Open();//打开数据库链接，越晚开越好\nconn.Close();//关闭数据库链接,用完就关，别挂着</code></pre>\n<p>必要准备已经OK了</p>\n<p>下面来讲sql语句的编写和执行。</p>\n<h1 id=\"SQL%E8%AF%AD%E5%8F%A5%E7%BC%96%E5%86%99%E5%8A%A0%E6%89%A7%E8%A1%8C\"><strong>SQL语句编写加执行</strong></h1>\n<h2 id=\"%E7%BC%96%E5%86%99\"><strong>编写</strong></h2>\n<p><strong>我们定义一个string类型的sql变量来存储我们的sql语句，sql语句只需用原本的语法即可，无需做变化。</strong></p>\n<p>sqlserver中创建数据表一般是这么写的</p>\n<p><img alt=\"\" height=\"91\" src=\"..\\..\\static\\image\\d568828fcba44cb99454e4ae23363e3e.png\" width=\"335\"/></p>\n<p>这里把他转成一行的，不用管缩进 。</p>\n<pre><code class=\"language-cs\">string sql = \"create table csdn予我心安的数据表1(name varchar(8) not null)\";</code></pre>\n<p>有人会问，我的sql语句内容要持续变化，但格式基本不变咋办。总不能另写一条吧。其实没那么折腾，用C#的String.Format()生成sql语句字符串就好了.</p>\n<p><a href=\"https://www.qb5200.com/article/269052.html\" title=\"C#中string.format用法 C#中string.format用法详解(IT技术)\">C#中string.format用法 C#中string.format用法详解(IT技术)</a></p>\n<p>比如说我要创建的数据表名要替换，我们在表名这加个占位符就OK</p>\n<pre><code class=\"language-cs\">string tablename=\"csdn予我心安的数据表1\";//我是表名\nstring sql = String.Format(\"create table {0}(name varchar(8) not null)\", tablename);\n//tablename的内容会替换掉字符串中的{0},所以sql的内容会随着tablename变换而改变</code></pre>\n<h2 id=\"%E6%89%A7%E8%A1%8C\"><strong>执行</strong></h2>\n<h3 id=\"%E5%88%9B%E5%BB%BA%E6%89%A7%E8%A1%8C%E5%99%A8\"><strong>创建执行器</strong></h3>\n<p>sql语句我们已经写好了，接下了就要执行了</p>\n<p>我们调用SqlCommand类生成一个sql语句执行器cmd,传入sql语句和链接变量</p>\n<pre><code class=\"language-cs\">SqlCommand cmd = new SqlCommand(sql, conn);\n//格式:    SqlCommand 自定义执行器变量名= new SqlCommand(sql字符串变量, 链接变量);</code></pre>\n<p>执行器我们创建好了，接下来要选择执行方法，不同的执行方法有不同的返回值。</p>\n<p><span style=\"color:#fe2c24;\">特别提醒：使用前记得打开链接</span></p>\n<pre><code>conn.Open();</code></pre>\n<h3 id=\"ExecuteNonQuery()%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C\"><strong>ExecuteNonQuery()方式执行</strong></h3>\n<pre><code class=\"language-cs\">cmd.ExecuteNonQuery();</code></pre>\n<h3 id=\"%C2%A0ExecuteScalar()%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C\"> ExecuteScalar()方式执行</h3>\n<pre><code>cmd.ExecuteScalar();</code></pre>\n<h3 id=\"%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB%C2%A0\">二者区别 </h3>\n<p><img alt=\"\" height=\"390\" src=\"..\\..\\static\\image\\72c43ce889ea482cb010ffa97f31ef83.png\" width=\"1071\"/></p>\n<h3 id=\"%C2%A0ExecuteReader()%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C\"> ExecuteReader()方式执行</h3>\n<pre><code class=\"language-cs\">cmd.ExecuteReader();</code></pre>\n<p>这个执行方式的作用我会在下面的实例中详细讲解</p>\n<p><span style=\"color:#fe2c24;\">特别提醒：执行完请关闭连接</span></p>\n<pre><code> conn.Close();</code></pre>\n<p></p>\n<p></p>\n<h1 id=\"%E5%AE%9E%E4%BE%8B%EF%BC%9A\">实例：</h1>\n<h2 id=\"1-%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E6%95%B0%E6%8D%AE%E8%A1%A8\">1-创建一张数据表</h2>\n<p>为小明创建一张个人成绩表</p>\n<p>要用到sql语句中创建数据表的指令</p>\n<pre><code class=\"language-sql\">create table 表名\n(\n    列名 数据类型 是否允许为空(null||not null),\n    列名2 数据类型 是否允许为空(null||not null),\n    列名3 数据类型 是否允许为空(null||not null),\n        ……\n    列名n 数据类型  是否允许为空(null||not null)\n)</code></pre>\n<p>C#代码 </p>\n<pre><code class=\"language-cs\">    using System.Data.SqlClient;//头别忘了，如果加了头还显示未调用，请检查Nuget包\n\n    public static void addtable(string tablename)\n    {\n        //测试连接数据库\n        string connStr = \"Data Source=LAPTOP-82MUPKTO;Initial Catalog=CSDN予我心安A3的数据库;Integrated Security=True\";\n        SqlConnection conn = new SqlConnection(connStr);\n        //打开数据库\n        conn.Open();\n\n        //编写sql语句,语法即sql语法\n        string sql = String.Format(\"create table {0}(课程名 varchar(11) not null,成绩  tinyint     not null)\", tablename);\n        SqlCommand cmd = new SqlCommand(sql, conn);\n        //贴心，异常处理都安排上了\n        try\n        {\n            cmd.ExecuteNonQuery();\n            Console.WriteLine(\"数据表创建成功\");\n        }\n        catch (SqlException ae)\n        {\n            Console.WriteLine(\"数据表创建失败\");\n            Console.WriteLine(ae.Message);\n        }\n        finally\n        {\n            conn.Close();//对数据库操作完成后，需要关闭数据库，释放内存\n        }\n\n    }\n\n    \n    addtable(\"考试成绩表\")\n</code></pre>\n<p><strong>芜湖起飞 </strong></p>\n<h2 id=\"%E2%80%8B%E7%BC%96%E8%BE%91\"><img alt=\"\" height=\"383\" src=\"..\\..\\static\\image\\d506e4dc9142418ebdf3c31684c45834.png\" width=\"247\"/></h2>\n<p></p>\n<h2 id=\"2-%E5%90%91%E8%A1%A8%E4%B8%AD%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE\">2-向表中插入数据</h2>\n<p>小明的计算机科学考试考了100分，帮他录进去</p>\n<p>要用到sql中的插入数据指令</p>\n<pre><code class=\"language-sql\">insert into 表名\nvalues\n('数据1','数据2','数据3')//第一行数据,表结构有几列就几个呗，允许为空的地方可以就打''\n('数据1','数据2','数据3')//第二行数据,表结构有几列就几个呗，允许为空的地方可以就打''</code></pre>\n<pre><code class=\"language-cs\">    public static void adddata(string classname,int grade)\n    {\n        //测试连接数据库\n        string connStr = \"Data Source=LAPTOP-82MUPKTO;Initial Catalog=CSDN予我心安A3的数据库;Integrated Security=True\";\n        SqlConnection conn = new SqlConnection(connStr);\n        //打开数据库\n        conn.Open();\n\n        //编写sql语句,语法即sql语法\n        string sql = String.Format(\"insert into 考试成绩表 values('{0}','{1}')\",classname,grade);\n        SqlCommand cmd = new SqlCommand(sql, conn);\n        try\n        {\n            cmd.ExecuteNonQuery();\n            Console.WriteLine(\"成绩录入成功\");\n        }\n        catch (SqlException ae)\n        {\n            Console.WriteLine(\"成绩录入失败\");\n            Console.WriteLine(ae.Message);\n        }\n        finally\n        {\n            conn.Close();//对数据库操作完成后，需要关闭数据库，释放内存\n        }\n    }\n\n\n\ndata_Control.adddata(\"计算机科学\",100);</code></pre>\n<p><img alt=\"\" height=\"84\" src=\"..\\..\\static\\image\\e08370c340324cc28c0750c11cfc33f0.png\" width=\"217\"/></p>\n<p></p>\n<h3 id=\"3-%E4%BF%AE%E6%94%B9%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE%C2%A0\">3-修改表中数据 </h3>\n<p>我去，小明考试作弊被发现，成绩0分，帮他改过来</p>\n<pre><code class=\"language-cs\">update 表名\nset 列名1='值',列名2='值' where 筛选条件</code></pre>\n<pre><code class=\"language-cs\">    public static void changedata(string classname,int new_grade)\n    {\n        //测试连接数据库\n        string connStr = \"Data Source=LAPTOP-82MUPKTO;Initial Catalog=CSDN予我心安A3的数据库;Integrated Security=True\";\n        SqlConnection conn = new SqlConnection(connStr);\n        //打开数据库\n        conn.Open();\n\n        //编写sql语句,语法即sql语法\n        string sql = String.Format(\"update 考试成绩表 set 成绩='{0}' where 课程名='{1}'\", new_grade,classname);\n        SqlCommand cmd = new SqlCommand(sql, conn);\n        try\n        {\n            cmd.ExecuteNonQuery();\n            Console.WriteLine(\"成绩修改成功\");\n        }\n        catch (SqlException ae)\n        {\n            Console.WriteLine(\"成绩修改失败\");\n            Console.WriteLine(ae.Message);\n        }\n        finally\n        {\n            conn.Close();//对数据库操作完成后，需要关闭数据库，释放内存\n        }\n    }\n\nchangedata(\"计算机科学\",0);</code></pre>\n<p><img alt=\"\" height=\"80\" src=\"..\\..\\static\\image\\2a35ec1ad3714d3fb6b83b840917f9b8.png\" width=\"212\"/></p>\n<p></p>\n<h3 id=\"4-%E5%88%A0%E9%99%A4%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE\">4-删除表中数据</h3>\n<p>小明害怕被老爸竹笋炒肉丝，给我1包辣条贿赂我删掉这条记录，我肯定不会为了一包辣条就帮他</p>\n<p>，但他拿了2包就是另一回事了。</p>\n<pre><code class=\"language-sql\">delete from 表名 where 筛选条件</code></pre>\n<pre><code class=\"language-cs\">    public static void delete_data(string classname)\n    {\n        //测试连接数据库\n        string connStr = \"Data Source=LAPTOP-82MUPKTO;Initial Catalog=CSDN予我心安A3的数据库;Integrated Security=True\";\n        SqlConnection conn = new SqlConnection(connStr);\n        //打开数据库\n        conn.Open();\n\n        //编写sql语句,语法即sql语法\n        string sql = String.Format(\"delete from 考试成绩表 where 课程名='{0}'\", classname);\n        SqlCommand cmd = new SqlCommand(sql, conn);\n        try\n        {\n            cmd.ExecuteNonQuery();\n            Console.WriteLine(\"成绩删除成功\");\n        }\n        catch (SqlException ae)\n        {\n            Console.WriteLine(\"成绩删除失败\");\n            Console.WriteLine(ae.Message);\n        }\n        finally\n        {\n            conn.Close();//对数据库操作完成后，需要关闭数据库，释放内存\n        }\n    }\n\ndelete_data(\"计算机科学\");</code></pre>\n<p> <img alt=\"\" height=\"67\" src=\"..\\..\\static\\image\\0fcbde282dd74daeb0e9e0e14ebf7a73.png\" width=\"175\"/></p>\n<p>小明开心的回家了，他一走我又把成绩写回去了……</p>\n<p></p>\n<h2 id=\"5-%E8%AF%BB%E5%8F%96%E8%A1%A8%E4%B8%AD%E6%95%B0%E6%8D%AE\">5-读取表中数据</h2>\n<p>学校要把小明的成绩单打印出来。</p>\n<p> ExecuteReader()的用法来了啊，谢谢你看到这里。</p>\n<p>用法就在下面的代码中啦</p>\n<pre><code class=\"language-sql\">select * from 考试成绩表</code></pre>\n<pre><code class=\"language-cs\">    public static void get_data()\n    {\n        //测试连接数据库\n        string connStr = \"Data Source=LAPTOP-82MUPKTO;Initial Catalog=CSDN予我心安A3的数据库;Integrated Security=True\";\n        SqlConnection conn = new SqlConnection(connStr);\n        //打开数据库\n        conn.Open();\n\n        //编写sql语句,语法即sql语法\n        string sql = String.Format(\"select * from 考试成绩表\");\n        SqlCommand cmd = new SqlCommand(sql, conn);\n\n        SqlDataReader rdr = cmd.ExecuteReader();//定义数据读取器rdr获取传回的数据\n        while (rdr.Read())//每次执行一次Read(),从数据里读取一行数据\n        {\n            string classname=rdr[\"课程名\"].ToString();//根据列名，获得该行里的课程名信息,由于rdr[\"课程名\"]返回的是object类型，所以要进行类型转化,下面成绩一样的原理\n            int grade = Convert.ToInt32(rdr[\"成绩\"]);//根据列名，获得该行里的成绩信息\n            Console.WriteLine(\"课程名:{0},成绩:{1}\",classname,grade);\n        }\n        conn.Close();//读取时要一直保证数据库是打开的\n\n    }\n\n</code></pre>\n<p><img alt=\"\" height=\"66\" src=\"..\\..\\static\\image\\b2328998a7ec4d6c902156ae5b2932d5.png\" width=\"349\"/></p>\n<p> 小明伤心的拿着成绩单走了..........</p>\n<p></p>\n<p></p>\n<p></p>\n<p></p>\n</div>\n</div>", "first_tag": "SQL", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 1, "php": 0, "time": "2022-06-24 20:02:09", "summary": "目录必要准备语句编写加执行编写执行创建执行器方式执行方式执行二者区别方式执行实例：创建一张数据表编辑向表中插入数据修改表中数据删除表中数据读取表中数据必要准备你得有一个数据库，并且要和项目连接。关于连"}