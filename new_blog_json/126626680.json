{"blogid": "126626680", "writerAge": "码龄8年", "writerBlogNum": "121", "writerCollect": "4527", "writerComment": "155", "writerFan": "15166", "writerGrade": "5级", "writerIntegral": "3221", "writerName": "沧海一升", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126626680.jpg", "writerRankTotal": "4918", "writerRankWeekly": "871", "writerThumb": "481", "writerVisitNum": "384029", "blog_read_count": "126", "blog_time": "已于 2022-09-02 11:41:34 修改", "blog_title": "IC Compiler指南——布图规划（一）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1>一、概述</h1>\n<p><span style=\"color:#000000;\">        在前端设计完成逻辑综合得到门级网表,并在后端完成 数据设置后，需要进行布图规划</span><span style=\"color:#000000;\">（floorplanning）</span><span style=\"color:#000000;\">。后续的布局、时钟树综合</span><span style=\"color:#000000;\">CTS</span><span style=\"color:#000000;\">、布线等步骤都是在设计布图的基础上进行。</span></p>\n<p><span style=\"color:#000000;\">        芯片级布图定义的芯片信息包括：芯片核心</span><span style=\"color:#000000;\">（core,</span><span style=\"color:#000000;\">即芯片内部逻辑功能区）设置，包括 核心的尺寸、形状、布局的行（标准单元布局按横条排列）；外设，包括</span><span style=\"color:#000000;\">IO</span><span style=\"color:#000000;\">、电源、拐角管脚</span><span style=\"color:#000000;\">（</span><span style=\"color:#000000;\">cor­ner pad） </span><span style=\"color:#000000;\">以及填充单元的位置;宏块的布局；标准单元的布局约束，用于定义禁止布局的区域； 电源的网格，包括电源环、条带和电源轨道。</span></p>\n<p><span style=\"color:#000000;\">        布图规划流程及主要命令示意图，主要包括设计的设置阶段、布图规划阶段、虚拟展开布局</span><span style=\"color:#000000;\">VFP</span><span style=\"color:#000000;\">、电源网络综合与分析、布图阶段原型布线（全局布线）及时序分析</span><span style=\"color:#000000;\">5</span><span style=\"color:#000000;\">个阶段。</span></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"325\" src=\"..\\..\\static\\image\\72d5134753ff4f8ea17c9563c6d9a60c.png\" width=\"520\"/></p>\n<p>         <span style=\"color:#000000;\">在完成虚拟展开布局</span><span style=\"color:#000000;\">VFP</span><span style=\"color:#000000;\">后，需要根据拥塞情况进行宏块位置的优化调整，以尽可能改善布线阶段的拥塞状态。原型布线和原位优化</span><span style=\"color:#000000;\">IPO</span><span style=\"color:#000000;\">主要用于对布图规划的设计时序结果进行较准确的评估和优化。</span></p>\n<p><span style=\"color:#000000;\">        布图规划输出的DEF</span><span style=\"color:#000000;\">布图文件可供综合工具</span><span style=\"color:#000000;\">DCT</span><span style=\"color:#000000;\">参考，流程分为设计布图和重新综合两步。设计布图规划结合重新综合流程的分步流程图如图</span><span style=\"color:#000000;\">所示。</span></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"307\" src=\"..\\..\\static\\image\\43ef59a1b0114c03bec575125bee346e.png\" width=\"330\"/></p>\n<p> <span style=\"color:#000000;\">        ICC布图与综合DCT</span><span style=\"color:#000000;\">的联合优化利用了布图的拓扑</span><span style=\"color:#000000;\">(topology)</span><span style=\"color:#000000;\">信息，二次综合结 果与后端设计电路结构的拟合度更好。二次综合流程中DCT</span><span style=\"color:#000000;\">利用布图规划导出的</span><span style=\"color:#000000;\">DEF</span><span style=\"color:#000000;\">布图文件重新综合完成后，综合网表再次导入</span><span style=\"color:#000000;\">ICC</span><span style=\"color:#000000;\">完成数据设置步骤，读入</span><span style=\"color:#000000;\">DEF</span><span style=\"color:#000000;\">文件，完成了设计规划工作。下一步标准单元布局将基于性能改进的门级网表进行。</span></p>\n<p><strong><span style=\"color:#000000;\">模块级布图规划的初始化步骤如下：</span></strong></p>\n<div>\n<ol><li><span style=\"color:#000000;\">写入</span><span style=\"color:#000000;\">IO</span><span style=\"color:#000000;\">约束信息；</span></li><li><a name=\"bookmark257\"></a><span style=\"color:#000000;\">添加单元行，并进行</span><span style=\"color:#000000;\">VFP</span><span style=\"color:#000000;\">及电路性能分析</span></li><li><a name=\"bookmark258\"></a><span style=\"color:#000000;\">去除单元行；</span></li><li><span style=\"color:#000000;\">读入</span><span style=\"color:#000000;\">IO</span><span style=\"color:#000000;\">约束；</span></li><li><span style=\"color:#000000;\">定义内核区域，摆放</span><span style=\"color:#000000;\">IO</span><span style=\"color:#000000;\">管脚；</span></li><li>定义布图的直角多边形(rectilinear)区域</li><li><span style=\"color:#000000;\">保存布图的初始信息。</span></li></ol>\n</div>\n<p><span style=\"color:#000000;\">        对于直角多边形的布图区域设置可以调用预定义的模板，实现较典型的复杂形状。</span></p>\n<p style=\"text-align:justify;\"><strong><span style=\"color:#000000;\">芯片级的初始布图规划步骤如下：</span></strong></p>\n<ol><li><a name=\"bookmark261\"></a><span style=\"color:#000000;\">创建仅在物理设计使用的管脚</span><span style=\"color:#000000;\">(pad cells)</span><span style=\"color:#000000;\">；</span></li><li><a name=\"bookmark262\"></a><span style=\"color:#000000;\">指定管脚单元的位置；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark263\"></a><span style=\"color:#000000;\">初始化设计布图；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark264\"></a><span style=\"color:#000000;\">在管脚之间添加管脚填充单元</span><span style=\"color:#000000;\">(</span><span style=\"color:#000000;\">pad filler cells)</span><span style=\"color:#000000;\">；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark265\"></a><span style=\"color:#000000;\">创建管脚的电源/地环</span><span style=\"color:#000000;\">(</span><span style=\"color:#000000;\">P/G pad rings)</span><span style=\"color:#000000;\">；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark266\"></a><span style=\"color:#000000;\">指定忽略的走线层；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark267\"></a><span style=\"color:#000000;\">定义已知(确定)的宏块和标准单元布局</span><span style=\"color:#000000;\">(placement)</span><span style=\"color:#000000;\">；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark268\"></a><span style=\"color:#000000;\">指定已知的电源网络结构；</span></li><li style=\"text-align:justify;\">定义已知的布局禁止区域(placement blockage)。</li></ol>\n<h1>二、初始化布图规划</h1>\n<p style=\"text-align:justify;\"><span style=\"color:#000000;\">        初始化布图规划这一步的工作完成了后端设计芯片基本形态定义，主要完成以下设置：</span></p>\n<ul><li style=\"text-align:justify;\"><span style=\"color:#000000;\">创建芯片核心区域和外设（外围）区域，核心区用于放置宏块、标准单元等，而外设区域主要摆放芯片的管脚；</span></li><li style=\"text-align:justify;\"><span style=\"color:#000000;\">定义核心区域的标准单元布局行属性、芯片的边界或外围区域设置，如核心利用率、长宽比、核心到管脚的距离等；</span></li><li><span style=\"color:#000000;\">按照物理约束，例如设置的</span><span style=\"color:#000000;\">tdf</span><span style=\"color:#000000;\">文件或者管脚约束</span><span style=\"color:#000000;\">tcl</span><span style=\"color:#000000;\">文件放置</span><span style=\"color:#000000;\">io</span><span style=\"color:#000000;\">管脚，包括网表定义的管脚和物理设计创建的管脚。</span></li></ul>\n<h2>1、设置管脚约束</h2>\n<h3>1）<span style=\"color:#000000;\">创建芯片管脚单元(</span><span style=\"color:#000000;\">pad cell)</span></h3>\n<p><span style=\"color:#000000;\">        在</span><span style=\"color:#000000;\">DC</span><span style=\"color:#000000;\">综合得到的门级网表没有定义的电源、地管脚以及芯片外围边沿</span><span style=\"color:#000000;\">4</span><span style=\"color:#000000;\">个拐角的管脚 单元。这些仅用于物理设计的管脚需要在指定信号管脚单元的位置前定义。仅用于物理设计的管脚的定义采用命令</span><span style=\"color:#000000;\">create_cell,</span><span style=\"color:#000000;\">举例如下：</span></p>\n<pre><code class=\"language-Scala\">create_cell {vss_l vss_r vss_t vss_b} pvOi\ncreate_cell （vdd_l vdd_r vdd_t vdd_b} pvdi\ncreate_cell （CornerLL CornerLR CornerTR CornerTL} pfrelr\n</code></pre>\n<p>        <span style=\"color:#000000;\">上述示例脚本创建了上下左右</span><span style=\"color:#000000;\">4</span><span style=\"color:#000000;\">边各一个电源管脚和一个地管脚，并且创建了芯片</span><span style=\"color:#000000;\">4</span><span style=\"color:#000000;\">个拐角单元。</span><span style=\"color:#000000;\">管脚的添加一般按照电源、拐角、信号脚的顺序。</span> </p>\n<h3>2）<span style=\"color:#000000;\">基于tdf</span><span style=\"color:#000000;\">文件设置芯片管脚顺序</span></h3>\n<p style=\"text-align:justify;\"><span style=\"color:#000000;\">        设计中添加完仅用于物理设计的管脚后，下一步需要导入tdf</span><span style=\"color:#000000;\">文件，即</span><span style=\"color:#000000;\">Top Design File</span><span style=\"color:#000000;\">顶层设计文件。</span><span style=\"color:#000000;\">tdf</span><span style=\"color:#000000;\">主要的作用是定义管脚位置，可以用来配置芯片管脚的名称、位置对应关系。 </span></p>\n<p style=\"text-align:justify;\"><span style=\"color:#000000;\">        拐角管脚 的定义格式如下：</span></p>\n<pre><code class=\"language-Scala\">pad padName padSide [padOrder] [padOffset] [\"reflect\"]</code></pre>\n<p style=\"text-align:justify;\"><span style=\"color:#000000;\">        管脚定义中，padName</span><span style=\"color:#000000;\">指定管脚的名称，</span><span style=\"color:#000000;\">padSide</span><span style=\"color:#000000;\">指定管脚所在边，数值</span><span style=\"color:#000000;\">padOrder指定管脚在所在边的序号。拐角管脚在所在边的顶角，因此不标序号。非拐角管脚的</span><span style=\"color:#000000;\">tdf</span><span style=\"color:#000000;\">定义格式为与拐角管脚格式相同，但管脚所在边序号</span><span style=\"color:#000000;\">padOrder</span><span style=\"color:#000000;\">需要标出。padOffset指的是管脚相对于参考边的绝对偏移量，单位是微米，该偏移量设置是可选的。</span><span style=\"color:#000000;\">如果没有加</span><span style=\"color:#000000;\">padOffset</span><span style=\"color:#000000;\">偏移距离控制，管脚默认在每一边是均匀排列。</span></p>\n<pre><code class=\"language-Scala\">;tdf文件\n;放置管脚单元\npad \"cornerLL\" \"bottom\"\npad \"cornerLR\" \"right\"\npad \"cornerTR\" \"top\"\npad \"cornerTL\" \"left\"\n;放置io和电源管脚\n;左右边的管脚编号从下往上顺序编号（除了拐角的管脚）\npad \"pad_data_0\" \"left\" 1\npad \"pad_data_1\" \"left\" 2\npad \"VDD_LEFT\"   \"left\" 3\npad \"VSS_LEFT\"   \"left\" 4\npad \"pad_data_2\" \"left\" 5\n;下边和上边的管脚编号从左往右顺序编号（除了拐角的管脚）\npad \"Clk\" \"bottom\" 1\npad \"A_0\" \"bottom\" 2\npad\t\"A_1\" \"bottom\" 3\n</code></pre>\n<p>        上面脚本定义的芯片管脚如下：</p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"310\" src=\"..\\..\\static\\image\\671151cef9e547e3b8131b94f43c4455.png\" width=\"300\"/></p>\n<p>         <span style=\"color:#000000;\">完成芯片级布图规划的管脚顺序定义文件</span><span style=\"color:#000000;\">tdf</span><span style=\"color:#000000;\">后，可采用如下</span><span style=\"color:#000000;\">tcl</span><span style=\"color:#000000;\">命令将管脚顺序读 入 </span><span style=\"color:#000000;\">ICC</span><span style=\"color:#000000;\">：</span></p>\n<pre><code class=\"language-Scala\">read_io_constraints [-append] [-cel_namel [-child_cell] &lt; TDF_file&gt;</code></pre>\n<h3 style=\"text-align:justify;\">3）<span style=\"color:#000000;\">基于tcl</span><span style=\"color:#000000;\">命令设置芯片管脚顺序</span></h3>\n<p><span style=\"color:#000000;\">        在新版本</span><span style=\"color:#000000;\">ICC</span><span style=\"color:#000000;\">中，</span><span style=\"color:#000000;\">pad</span><span style=\"color:#000000;\">管脚位置设置可采用</span><span style=\"color:#000000;\">tcl</span><span style=\"color:#000000;\">命令实现，代替单独的</span><span style=\"color:#000000;\">tdf</span><span style=\"color:#000000;\">文件设置。</span><span style=\"color:#000000;\">采用的命令是</span><span style=\"color:#000000;\">set_pad_physical_constraints,</span><span style=\"color:#000000;\">命令格式如下</span><span style=\"color:#000000;\">：</span></p>\n<pre><code class=\"language-Scala\">set_pad_physical constraints [-pad_name][-side][-order]</code></pre>\n<p>         <span style=\"color:#000000;\">芯片的四边side l.side 2.side 3.side 4</span><span style=\"color:#000000;\">分别对应的是左、上、右、下四边；左上、右上、右下、左下四个拐角管脚分别属于side1.side 2.side 3.side 4</span><span style=\"color:#000000;\">。</span></p>\n<h2>2、布图创建 </h2>\n<p><span style=\"color:#000000;\">        布图创建的命令是initialize_floorplan</span><span style=\"color:#000000;\">或采用命令</span><span style=\"color:#000000;\">initialize_rectilinear_block</span><span style=\"color:#000000;\">创建直角多 边形的规划区域。</span><span style=\"color:#000000;\">initialize_floorplan</span><span style=\"color:#000000;\">的图形化界面设置以及创建后的版图示例如</span><span style=\"color:#000000;\">所示。</span></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"254\" src=\"..\\..\\static\\image\\7d7eeac9371d41028d0a09c6812dadee.png\" width=\"634\"/></p>\n<p>        <span style=\"color:#000000;\">初始化布图完成后，芯片的管脚按照指定顺序排列在芯片的4边，而内部核心区域与管脚之间留有间距，如这里设置的</span><span style=\"color:#000000;\">50。在设置选项中的</span><span style=\"color:#000000;\">Horizontal rows</span><span style=\"color:#000000;\">指的是标准单元行的方向是否是水平方向；</span><span style=\"color:#000000;\">Double back</span><span style=\"color:#000000;\">指的是相邻两行标准单选的方向是否是翻转一行，背靠背放置。</span></p>\n<h3>1）芯<span style=\"color:#000000;\">片核心</span><span style=\"color:#000000;\">（core）</span><span style=\"color:#000000;\">区域参数设置</span></h3>\n<p><span style=\"color:#000000;\">        控制的参数包括两种可选的配置。</span></p>\n<p style=\"text-align:justify;\"><a name=\"bookmark281\"><span style=\"color:#000000;\">（</span></a><span style=\"color:#000000;\">1） </span><span style=\"color:#000000;\">通过比例控制</span></p>\n<ul><li><span style=\"color:#000000;\">设置核心区的利用率（根据网表的宏块和单元总面积及利用率可估算核心区面积）；</span></li><li><span style=\"color:#000000;\">设置高/宽比（控制芯片外形）；</span></li><li><span style=\"color:#000000;\">设置标准单元行</span><span style=\"color:#000000;\">（row）/</span><span style=\"color:#000000;\">核心区面积比（体现标准单元的芯片利用率）；</span></li></ul>\n<p><a name=\"bookmark282\"><span style=\"color:#000000;\">（</span></a><span style=\"color:#000000;\">2） </span><span style=\"color:#000000;\">通过指定高度和宽度控制</span></p>\n<ul><li><span style=\"color:#000000;\">包括芯片核心的宽度和高度具体尺寸；</span></li><li><span style=\"color:#000000;\">核心到各边管脚的距离。</span></li></ul>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"257\" src=\"..\\..\\static\\image\\c648e11737d546f189e09bfdb79cb354.png\" width=\"318\"/></p>\n<p><span style=\"color:#000000;\">        布图在初始化完成后，可以看到外围的IO</span><span style=\"color:#000000;\">管脚已经按约束排列，还没有摆放的宏块排列在芯片上方，还未布局的标准单元排列在芯片区域外右侧，核心区域内可以看到标准单元行的 </span><span style=\"color:#000000;\">site rows</span><span style=\"color:#000000;\">的位置定义。</span></p>\n<p style=\"text-align:center;\"><span style=\"color:#000000;\">       </span><img alt=\"\" height=\"347\" src=\"..\\..\\static\\image\\51e491e64bab4d9aa4ea26f26444cf73.png\" width=\"469\"/></p>\n<h3>2）<span style=\"color:#000000;\">插入管脚填充单元（filler cell）</span></h3>\n<p><span style=\"color:#000000;\">        管脚填充单元的作用为：由于管脚之间可能存在间隙，管脚填充单元使管脚之间的N阱、 </span><span style=\"color:#000000;\">P</span><span style=\"color:#000000;\">阱和</span><span style=\"color:#000000;\">P/G</span><span style=\"color:#000000;\">电源环保持连接的连续性，使得信号管脚功能正常,并获得供电。</span></p>\n<p><span style=\"color:#000000;\">        插入管脚填充单元采用的insert_pad_filler命令应用如下，其中-</span><span style=\"color:#000000;\">cell</span><span style=\"color:#000000;\">选项指定填充单元 的可选单元名称列表，例如</span><span style=\"color:#000000;\">fill5000、fill2000等。管脚填充单元的名称中数字指明了单元宽度，命令在指定填充单元时按照宽度从大到小排列，插入单元时先尽可能选择宽度大的单元, 这样可以使填充单元数量最少。</span></p>\n<pre><code class=\"language-Scala\">insert_pad_filler -cell \"fill5000 fill2000 fill1000 ...\"</code></pre>\n<p><span style=\"color:#000000;\">        插入管脚填充单元的示意效果图如下图所示，管脚之间插入的填充单元数量和类型不尽相同。</span><span style=\"color:#000000;\">右图显示插入管脚填充单元的用户设置界面。用户可填入插入单元名称、插入的区域以及选择在哪一边插入填充单元。</span> </p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"277\" src=\"..\\..\\static\\image\\9dd3e198c18c4bfd9e63ae4c0faed399.png\" width=\"585\"/></p>\n<h3> 3）<span style=\"color:#000000;\">创建管脚的电源与地（</span><span style=\"color:#000000;\">P/G）</span><span style=\"color:#000000;\">电源环</span></h3>\n<p><span style=\"color:#000000;\">        创建分两步：先创建pad的电源脚（电源和地脚各3</span><span style=\"color:#000000;\">个）到电源网络</span><span style=\"color:#000000;\">（</span><span style=\"color:#000000;\">net）</span><span style=\"color:#000000;\">的逻辑连接（虚 线）；再采用</span><span style=\"color:#000000;\">create_pad_rings</span><span style=\"color:#000000;\">命令物理连接电源环，即完成电源环布线。</span></p>\n<pre><code class=\"language-Scala\">derive_pg_connection -power_net VDD -power_pin VDD -ground_net VSS\\\n-ground_pin VSS\nderive_pg_connection -power_net VDDO -power_pin VDDO -ground_net VSSO\\\n-ground_pin VSSO\nderive_pg_connection -power_net VDDQ -power_pin VDDQ -ground_net VSSQ\\ \n-ground_pin VSSQ\nderive pg connection -power_net PWR -ground_net GND -tie \ncreate_pad_rings\n</code></pre>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"335\" src=\"..\\..\\static\\image\\7026af7a855d45379b371dcafa7b45f0.png\" width=\"558\"/></p>\n<h3>4）<span style=\"color:#000000;\">VFP(Virtual flat placement)前的准备</span></h3>\n<p><span style=\"color:#000000;\">        虚拟展开布局是在布图规划阶段通过</span><span style=\"color:#000000;\">create_fp_placement</span><span style=\"color:#000000;\">命令实现对设计的所有单元 的尝试性布局，主要用于判断布图规划是否存在潜在布线拥塞</span><span style=\"color:#000000;\">(congestion)</span><span style=\"color:#000000;\">风险。</span></p>\n<p><span style=\"color:#000000;\">        在虚拟展开布局前可以先明确非默认的约束设置，包括：</span></p>\n<ul><li><span style=\"color:#000000;\">可以先指定不用的布线层；</span></li><li><span style=\"color:#000000;\">提前定义宏块与标准单元的位置；</span></li><li><span style=\"color:#000000;\">设置已知的禁止布局区域。</span></li></ul>\n<p><span style=\"color:#000000;\">（1）忽略不用的走线层</span></p>\n<p><span style=\"color:#000000;\">        ICC默认使用所用金属走线层。但如果计划使用更少的层走线(减少使用高层金属层，降低制造成本)，但没有指明，结果会造成走线前阶段的估算利用了更多金属层，对于拥塞的分析 过于乐观;</span><span style=\"color:#000000;\">RC</span><span style=\"color:#000000;\">寄生参数不准，造成走线时延的计算偏差较大。因此需要使用</span><span style=\"color:#000000;\">set_ignored_layers</span><span style=\"color:#000000;\">命令向</span><span style=\"color:#000000;\">ICC</span><span style=\"color:#000000;\">指定哪些层不能走线，提高走线之前对拥塞和时序分析的精度。如下设置命令，只允许使用最高到</span><span style=\"color:#000000;\">M7</span><span style=\"color:#000000;\">层的金属层用于布线：</span></p>\n<pre><code class=\"language-Scala\">set_ignored_layers -max_routing_layer M7</code></pre>\n<p style=\"text-align:justify;\"><span style=\"color:#000000;\">此外，可以通过以下命令查看和去除忽略的布线层。</span></p>\n<pre><code class=\"language-Scala\">report_ignored_layers\nremove_ignored_layers\n</code></pre>\n<p>（2）<span style=\"color:#000000;\">限制宏块(macro)</span></p>\n<p><span style=\"color:#000000;\">        虚拟展开布局create_fp_placement</span><span style=\"color:#000000;\">执行后，宏块放置的位置可能不合理，造成电源网络 结构复杂，或者需要更多的总线布线资源。因此在虚拟展开布局前，可以手动在GUI</span><span style=\"color:#000000;\">界面对宏块布局，并且可以设置约束指导布局</span><span style=\"color:#000000;\">。命令如下：</span></p>\n<pre><code class=\"language-Scala\">set_fp_macro_options ...\t#设置宏块布局选项\nset_fp_macro_array ...\t    #设置宏块阵列，集中排列关联密切的宏块\n#设置关联布局，指定一个单元相对于锚点anchor的相对位置\nset_fp_relative_location ...\n</code></pre>\n<p style=\"text-align:justify;\"><span style=\"color:#000000;\">        这个阶段宏块的布局约束是软性(soft)</span><span style=\"color:#000000;\">约束，后续设计中尽可能遵守约束,但并不是必须遵守。</span><span style=\"color:#000000;\">set_fp_macro_array</span><span style=\"color:#000000;\">设置多个宏块按阵列形式排列的脚本如下</span><span style=\"color:#000000;\">：</span></p>\n<pre><code class=\"language-Scala\">set_fp_macro_array -name A_array -elements \\\n[list [get_cells Al A2] [get_cells A3 A4]] \\\n-x_offset 15 -y_offset 110 \n</code></pre>\n<p class=\"img-center\"><img alt=\"\" height=\"195\" src=\"..\\..\\static\\image\\c1da100812734b15ab7971421f2adc35.png\" width=\"504\"/></p>\n<p>        <span style=\"color:#000000;\">如图</span><span style=\"color:#000000;\">所示为布图阶段设置宏块阵列</span><span style=\"color:#000000;\">Ao</span><span style=\"color:#000000;\">以上命令指定了有</span><span style=\"color:#000000;\">A1</span><span style=\"color:#000000;\">、</span><span style=\"color:#000000;\">A2</span><span style=\"color:#000000;\">、</span><span style=\"color:#000000;\">A3</span><span style=\"color:#000000;\">、</span><span style=\"color:#000000;\">A4</span><span style=\"color:#000000;\">组成的二维阵列</span><span style=\"color:#000000;\">A_array，</span><span style=\"color:#000000;\">并设置宏块的水平和垂直方向的偏移量。</span><span style=\"color:#000000;\">在布图阶段的</span><span style=\"color:#000000;\">VFP</span><span style=\"color:#000000;\">虚拟展开布局操作中，宏块阵列被认为是单元对象，因此</span><span style=\"color:#000000;\">VFP</span><span style=\"color:#000000;\">不会在宏块之间插入标准单元。</span> </p>\n<p>        <span style=\"color:#000000;\">另一个宏块控制命令set_fp_macro_options</span><span style=\"color:#000000;\">对宏块布局的控制包括：</span></p>\n<ul><li><span style=\"color:#000000;\">通过</span><span style=\"color:#000000;\">legal_orientations</span><span style=\"color:#000000;\">选项控制宏块的布局方向</span><span style=\"color:#000000;\">；</span></li><li><span style=\"color:#000000;\">通过</span><span style=\"color:#000000;\">anchor_bound</span><span style=\"color:#000000;\">选项控制宏块限定在核心区指定的</span><span style=\"color:#000000;\">1/2</span><span style=\"color:#000000;\">或者</span><span style=\"color:#000000;\">1/4</span><span style=\"color:#000000;\">区域布局；</span></li><li><span style=\"color:#000000;\">通过</span><span style=\"color:#000000;\">side channel</span><span style=\"color:#000000;\">选项指定宏块或宏块组到核心区四边的距离。</span></li></ul>\n<p><span style=\"color:#000000;\">（3）</span><span style=\"color:#000000;\">禁止布局区域(placement blockage)</span><span style=\"color:#000000;\">设置</span></p>\n<p><span style=\"color:#000000;\">        1、全局(global)</span><span style=\"color:#000000;\">的禁止布局设置</span></p>\n<p><span style=\"color:#000000;\">        通过</span><span style=\"color:#000000;\">set_app_ var</span><span style=\"color:#000000;\">变量设置实现，硬性禁止布局设置变量 </span><span style=\"color:#000000;\">physopt_hard_keepout_distance,</span><span style=\"color:#000000;\">变量名中</span><span style=\"color:#000000;\">physopt</span><span style=\"color:#000000;\">可以理解为物理综合优化，即布局。</span></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"280\" src=\"..\\..\\static\\image\\07ff353905744fe6966ad0be4e37c5f6.png\" width=\"366\"/></p>\n<p>        <span style=\"color:#000000;\">图中</span><span style=\"color:#000000;\">RAM</span><span style=\"color:#000000;\">宏块周边的条纹框区域是硬性禁止区，在宏块的四边创建。作为全局 设置，所有固定宏块的四周会设置硬性禁止区，设置命令如下，在距离宏块四边</span><span style=\"color:#000000;\">10</span><span style=\"color:#000000;\">的距离 内禁止布局摆放其他单元。命令设置如下：</span></p>\n<pre><code class=\"language-Scala\">set_app_var physopt_hard_keepout_distance 10</code></pre>\n<p>        <span style=\"color:#000000;\">图</span><span style=\"color:#000000;\">中浅白色条带是软性禁止布局区，用于设置宏块之间或者宏块到芯片核心区边缘 的狭窄通道内禁止布线，通过</span><span style=\"color:#000000;\">placer_soft_keepout_channel_width</span><span style=\"color:#000000;\">变量设置。</span></p>\n<pre><code class=\"language-Scala\">set_app_var placer_soft_keepout_channel_width 25</code></pre>\n<p>        <span style=\"color:#000000;\">这两条全局设置可添加到.</span><span style=\"color:#000000;\">synopsys_dc. setup</span><span style=\"color:#000000;\">文件，便于</span><span style=\"color:#000000;\">ICC</span><span style=\"color:#000000;\">软件开启自动加载。</span></p>\n<p><span style=\"color:#000000;\">        2、宏块具体(specific)</span><span style=\"color:#000000;\">的禁止布局设置</span></p>\n<p><span style=\"color:#000000;\">        可以采用set_keepout_margin</span><span style=\"color:#000000;\">命令指定特定的禁止布局区。例如软性或者硬性，以及到宏块的各边距离。</span></p>\n<p style=\"text-align:center;\"><img alt=\"\" height=\"263\" src=\"..\\..\\static\\image\\b54b649eaddb41eaba57fa33e666d5e8.png\" width=\"597\"/></p>\n<p> <span style=\"color:#000000;\">        上中RAM</span><span style=\"color:#000000;\">的管脚引出的左右两边进行限制禁止区宽度</span><span style=\"color:#000000;\">10</span><span style=\"color:#000000;\">。对应的命令如下：</span></p>\n<pre><code class=\"language-Scala\">set_keepout_margin -type hard -outer {10 0 10 0} RAM5</code></pre>\n<p>        <span style=\"color:#000000;\">其中</span><span style=\"color:#000000;\">type</span><span style=\"color:#000000;\">选项可选</span><span style=\"color:#000000;\">soft</span><span style=\"color:#000000;\">或者</span><span style=\"color:#000000;\">hard,</span><span style=\"color:#000000;\">决定是软性还是硬性规定，</span><span style=\"color:#000000;\">-outer</span><span style=\"color:#000000;\">选项的｛｝内数值对应了左下右上四边的区域空白宽度。要查看或者去除设置的禁止布局空白区，可以使用如下命令：</span></p>\n<pre><code class=\"language-Scala\">report_keepout_margin\t# 报告\nremove_keepout_margin\t# 去除\n</code></pre>\n<h2>3、小结</h2>\n<p>        <span style=\"color:#000000;\">创建初始布图规划的流程图和对应命令设置:</span></p>\n<ul><li style=\"text-align:justify;\"><a name=\"bookmark301\"></a><span style=\"color:#000000;\">创建仅在物理设计使用的管脚；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark302\"></a><span style=\"color:#000000;\">指定管脚单元的位置；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark303\"></a><span style=\"color:#000000;\">初始化设计布图；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark304\"></a><span style=\"color:#000000;\">在管脚之间添加管脚填充单元；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark305\"></a><span style=\"color:#000000;\">创建管脚的电源/地环；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark306\"></a><span style=\"color:#000000;\">指定忽略的走线层；</span></li><li style=\"text-align:justify;\"><a name=\"bookmark307\"></a><span style=\"color:#000000;\">定义已知（确定）的宏块和标准单元布局;</span></li><li style=\"text-align:justify;\"><a name=\"bookmark308\"></a><span style=\"color:#000000;\">定义已知的禁止布局区域。</span></li></ul>\n<p style=\"text-align:justify;\"><span style=\"color:#000000;\">        布图规划初始化阶段的tcl</span><span style=\"color:#000000;\">脚本流程如下：</span></p>\n<pre><code class=\"language-Scala\">open_mw_cel DESIGN_data_setup    # 打开前一阶段设计\ncreate_cell . . .\t             #创建仅用于物理设计的管脚单元\nread_io_constraints &lt; TDF_file&gt;  # 或 set_pad_physical_constraints … initialize_floorplan ...\t     # 初始化设计布图\ninsert_pad_filler ...\t         #在管脚之间添加管脚填充单元\nderive_pg_connection ...\t     #\ncreate_pad_rings ...\t         #创建管脚的电源/地环\nset_ignored_layers - max M7      # 指定忽略的走线层 \n#手动放置需要设定手动定位的宏块\nset_dont_touch_placement [all_macro_cells]\t# 固定宏块的位置\nset_fp_macro_options ...\t                #设定宏块摆放的3个命令：选项、阵列、相对位置\nset_fp_macro_array . . .\nset_fp_relative_location …\nset app var physopt_hard_keepout_distance &lt; # &gt;\t    # 宏块全局硬性禁止布局区设置\nset app var placer_soft_keepout_channel_width &lt; # &gt;\t# 宏块全局软性禁止布局区设置\nset keepout margin…\t                                #宏块具体的禁止布局区设置\n</code></pre>\n<p></p>\n</div>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-02 11:41:34", "summary": "一、概述在前端设计完成逻辑综合得到门级网表并在后端完成数据设置后，需要进行布图规划。后续的布局、时钟树综合、布线等步骤都是在设计布图的基础上进行。芯片级布图定义的芯片信息包括：芯片核心即芯片内部逻辑功"}