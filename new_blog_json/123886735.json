{"blogid": "123886735", "writerAge": "码龄11年", "writerBlogNum": "2", "writerCollect": "5", "writerComment": "1", "writerFan": "1", "writerGrade": "1级", "writerIntegral": "47", "writerName": "氝阂", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123886735.jpg", "writerRankTotal": "190259", "writerRankWeekly": "439558", "writerThumb": "5", "writerVisitNum": "4895", "blog_read_count": "1637", "blog_time": "已于 2022-04-01 00:57:06 修改", "blog_title": "使用EwoMail Docker镜像 搭建邮箱服务器( 自定义mysql连接)", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<h1>背景</h1>\n<p>官网没提供Docker版本 直接部署在宿主机器且安装Mysql数据库。</p>\n<p>对此打包1.5版本 weomail 为docker镜像、并实现支持自定义数据库地址</p>\n<p></p>\n<h1>使用步骤</h1>\n<p>当前已打包好镜像到 docker hub中、直接下载使用即可。请提前保证服务器开放25端口。</p>\n<p>可运行命令 <strong> telnet smtp.qq.com 25 </strong>查看是否开放25端口。 话不多说直接开始使用步骤</p>\n<p><a class=\"link-info has-card\" href=\"https://hub.docker.com/r/lcbox229/ewomail\" title=\"DockerHub 镜像地址\"><span class=\"link-card-box\"><span class=\"link-title\">DockerHub 镜像地址</span><span class=\"link-link\"><img alt=\"\" class=\"link-link-icon\" src=\"..\\..\\static\\image\\icon-default.png\"/>https://hub.docker.com/r/lcbox229/ewomail</span></span></a></p>\n<h3>步骤1：</h3>\n<blockquote>\n<p>下载docker镜像</p>\n<pre><code class=\"language-bash\">docker pull lcbox229/ewomail</code></pre>\n</blockquote>\n<h3>步骤2：</h3>\n<blockquote>\n<p></p>\n<p>1.1、启动镜像 docker run 命令。当前选择编写sh脚本来快速启动、根据需要启动容器即可。</p>\n<p>使用 <strong>vim setup.sh </strong>命令修改好环境变量参数后插入sh脚本</p>\n<pre><code class=\"language-bash\">#!/bin/bash\nname='mail\nimage=$1\n\nif [ -z $image ];then\n        echo \"需输入镜像及其版本 xxx:1.0\"\n        exit 1\nfi\n\n# 端口\nport=\"\n-p 9005:9005\n-p 10024:10024\n-p 10025:10025\n-p 8000:8000\n-p 7000:7000\n-p 8010:8010\n-p 7010:7010\n-p 25:25\n-p 143:143\n-p 993:993\n-p 995:995\n-p 587:587\n-p 110:110\n-p 465:465\n\"\n\n# 环境变量 根据实际情况修改\nenv=\"\n-e DOMAIN=xxx.com\n-e DB_HOST=1.1.1.1\n-e DB_PORT=3306\n-e DB_ROOT_PWD=123456789\n-e URL=1.1.1.1\n-e WEBMAIL_URL=1.1.1.1:8000\n-e DB_MAIL_NAME=mailDB\n-e DB_MAIL_USERNAME=mailUser\n\"\n\n\n\n# 自定义ewomail-admin 拓展模块路径映射到 /root/ApiPHP 中即可完成拓展\n# 请求 http://xxxx.com/Service/xxx/xxx即可\n\nvolume=\"\n-v /sys/fs/cgroup:/sys/fs/cgroup:ro\n-v /root/ewomail/ApiPHP:/root/ApiPHP\n\"\n\n\ndocker run -itd --name $name $env  $volume  $port --privileged=true  $image /usr/sbin/init\n\n# 进入docker容器\ndocker exec -it $name /bin/bash\n</code></pre>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"0\"><caption>\n   环境变量介绍\n  </caption><tbody><tr><td> <pre>DOMAIN</pre> </td><td>邮箱域名</td></tr><tr><td> <pre>DB_HOST</pre> </td><td>Mysql 数据地址</td></tr><tr><td> <pre>DB_PORT</pre> </td><td>Mysql数据库端口</td></tr><tr><td> <pre>DB_ROOT_PWD</pre> </td><td>Mysql数据root密码</td></tr><tr><td> <pre>URL</pre> </td><td>前端管理地址需与端口映射保持一致，最后不要带/</td></tr><tr><td> <pre>WEBMAIL_URL</pre> </td><td>后端管理地址,最后不要带/</td></tr><tr><td> <pre>DB_MAIL_NAME</pre> </td><td>邮箱mysql待生成名称</td></tr><tr><td> <pre>DB_MAIL_USERNAME</pre> </td><td>邮箱mysql待生成用户名</td></tr></tbody></table>\n<p></p>\n<p></p>\n<p>1.2、保存后直接运行脚本</p>\n<pre><code class=\"language-bash\">sh setup.sh lcbox229/ewomail:latest</code></pre>\n<p>待安装完成后即进入到docker容器中。在<strong> /root/</strong>目录下 有启动<strong>Tools.sh</strong>脚本 根据需要启动即可。1 2 3</p>\n<pre><code class=\"language-bash\">sh /root/Tools.sh</code></pre>\n<p><img alt=\"\" height=\"253\" src=\"..\\..\\static\\image\\009db0ae80fd4637bc5ddcd7b826e200.png\" width=\"604\"/></p>\n<h2> 步骤3</h2>\n<p>配置域名 dkim._domaikey 解析、待添加解析完成后查看是否解析正确</p>\n<p><img alt=\"\" height=\"108\" src=\"..\\..\\static\\image\\17622b01b3754a6188e48a578e059249.png\" width=\"1200\"/></p>\n<p> <img alt=\"\" height=\"71\" src=\"..\\..\\static\\image\\34a5cbbc886a4e41abc61fc931fa65b4.png\" width=\"742\"/></p>\n<p></p>\n</blockquote>\n<p>完成后根据配置的 URL xxx:8000 和 WEBMAIL_URL xxxx.8010 地址 直接登录即可。后台默认账号密码为 ：admin  ewomail123 </p>\n<h2>结束语</h2>\n<blockquote>\n<p>简单打包ewomail 为docker镜像。当前未优化镜像。 当前默认拓展模块需满足ewomail-admin项目框架，需自行查看官方代码编写。个人写的拓展接口就暂不打包到容器中了。有问题也可联系 15jk2@15jk2.com或私信，本人也是小白，但会最大程度解决 。</p>\n</blockquote>\n</div>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 1, "php": 1, "time": "2022-04-01 00:57:06", "summary": "背景官网没提供版本直接部署在宿主机器且安装数据库。对此打包版本为镜像、并实现支持自定义数据库地址使用步骤当前已打包好镜像到中、直接下载使用即可。请提前保证服务器开放端口。可运行命令查看是否开放端口。话"}