{"blogid": "121080053", "writerAge": "码龄2年", "writerBlogNum": "7", "writerCollect": "67", "writerComment": "0", "writerFan": "8", "writerGrade": "1级", "writerIntegral": "50", "writerName": "沐桀", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_121080053.jpg", "writerRankTotal": "282305", "writerRankWeekly": "1019027", "writerThumb": "10", "writerVisitNum": "15471", "blog_read_count": "5550", "blog_time": "于 2021-11-03 20:28:34 发布", "blog_title": "upload-labs大详解", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h2><a id=\"pass1__httpsimgblogcsdnimgcn1308d85f7f2b418081875ae4f0ef8d2apngxossprocessimagewatermarktype_ZHJvaWRzYW5zZmFsbGJhY2sshadow_50text_Q1NETiBA5peg5ZCN5LmL5raf5aS05Y35bCP6L35byfsize_20color_FFFFFFt_70g_sex_16_0\"></a>pass1 <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\1308d85f7f2b418081875ae4f0ef8d2a.png\"/></h2>\n<p>上传一个php一句话文件（记得改成php格式）<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\561dd330d4784d198532d9ac084f9c93.png\"/> 发现不允许上传php类型的，只能上传jpg，gif，pngl的<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\00de7f41dbeb49cd825d02cf8fa9e2bc.png\"/>我们打算用burp抓包，先上传jpg的，然后用burp改成php的。<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\437298aa808c4f718a3112162a3fd2f6.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\14935ee635bb4c7389cb85ed1054b1af.png\"/>放包后，找到它的存储位置，用蚁剑连接.<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\2170bf12817146f7a004ccddca637ad6.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\6f05fc4839ee4a0a8411e70f038810e3.png\"/>成功连接。</p>\n<h2><a id=\"pass2_5\"></a>pass2</h2>\n<p>我们尝试用第一个的方法，发现还是可以直接上传成功，但是这里还有第二种方法。<br/> 直接上传php格式的文件，用burp抓包。更改这里的值。<br/> 上传php文件时，Content-Type的值是application/octet-stream，<br/> 上传jpg文件时，Content-Type的值是image/png，直接更改就可以了<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\c59f77437bc44de49350b6d22d67fb72.png\"/><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d84638ff350b4b0d964c7d0f6b1e7b18.png\"/>用蚁剑连接<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8d2f8067150744958418c35b6cbe1f3b.png\"/><br/> 成功</p>\n<h2><a id=\"pass3_11\"></a>pass3</h2>\n<p>在我们用第一关的方法上传jpg文件改包后发现不行<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\28879f2490824890916e74646d5ac5cb.png\"/>我们猜测应该是吧这几个后缀名放到黑名单了。我们可以上传例如php3, phtml后缀的文件绕过，重复上述操作后，上传成功。<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\066cd78e4f7d4c668ede2e151956d5cb.png\"/>用蚁剑连接即可</p>\n<h2><a id=\"Pass4_13\"></a>Pass4</h2>\n<p>在我们尝试了上述方法之后，发现直接传不行，抓包改成php也不行，改成php3也不行，猜测是吧这些全部放入黑名单了。<br/> 这里我们先上传一个.htaccess的文件里面内容为：SetHandler application/x-httpd-php 如图所示<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\bb229aa8b6334bf7b9500124d9935104.png\"/>这个文件的目的就是把我们上传的文件全部转成.php的。直接上传就可以。<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\7812461735ef45beaeecc9be0d037c38.png\"/>上传成功后上传我们的jpg格式的马就可以，然后用蚁剑直接连接这个马。</p>\n<h2><a id=\"Pass5_16\"></a>Pass5</h2>\n<p>我们用前面的方法尝试之后，发现都不可以，就连.htaccess都进了黑名单。只好查看源码了。<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\957e5e2e51b5458b899d663788302697.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\3590fc012ffa4aeb95575c1eb4924925.png\"/>发现第五关比第四关少了一个转小写的代码.我们直接上传.Php的一句话马，发现上传成功.直接用蚁剑连接即可。</p>\n<h2><a id=\"pass6_19\"></a>pass6</h2>\n<p>第五关源码<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\4879624086434aa5939f45b0f155203f.png\"/><br/> 第六关源码<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\dabaf2bba92649f8b50166a8f6d1b535.png\"/>对比两关的源码后发现，第六关少了首尾去空的代码，我们上次文件尝试抓包在文件名后面加一个空格<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\f418906f49a540b8bc35a8062d213e96.png\"/>发现上传成功了，直接用蚁剑连接。</p>\n<h2><a id=\"pass7_24\"></a>pass7</h2>\n<p>查看提示，发现所有可以被解析的后缀都被禁了<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\b0aacb6d828148fba1ec7378b30f0e32.png\"/><br/> 我们查看一下源码进行对比<br/> 第六关源码<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\61217cf45472420d9b9f31cd644ab5f3.png\"/>第七关源码<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\adccd0dad43749f78a4ff425087a5a16.png\"/>通过源码我们发现，第七关少了删除文件名末尾的‘.’<br/> 我们抓包后再文件名后加一个‘.’<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a4bcf555aadc45ff89e884e6da732927.png\"/>上传成功，用蚁剑连接即可。</p>\n<h2><a id=\"pass8_29\"></a>pass8</h2>\n<p>还是用上述方法对比不同，发现第八关对比于前面一关少了去除字符串<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9e3fc0a8225744f38d490fcbc4fff89c.png\"/>应该就是抓包在后缀加上::<span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n    \n     \n      \n       \n        D\n       \n       \n        A\n       \n       \n        T\n       \n       \n        A\n       \n       \n        了\n       \n       \n        在\n       \n       \n        我\n       \n       \n        查\n       \n       \n        询\n       \n       \n        后\n       \n       \n        发\n       \n       \n        现\n       \n       \n        ：\n       \n       \n        p\n       \n       \n        h\n       \n       \n        p\n       \n       \n        在\n       \n       \n        w\n       \n       \n        i\n       \n       \n        n\n       \n       \n        d\n       \n       \n        o\n       \n       \n        w\n       \n       \n        的\n       \n       \n        时\n       \n       \n        候\n       \n       \n        如\n       \n       \n        果\n       \n       \n        文\n       \n       \n        件\n       \n       \n        名\n       \n       \n        +\n       \n       \n        \"\n       \n       \n        :\n       \n       \n        :\n       \n      \n      \n       DATA了 在我查询后发现：php在window的时候如果文件名+\"::\n      \n     \n    </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.88888em; vertical-align: -0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">D</span><span class=\"mord mathdefault\">A</span><span class=\"mord mathdefault\" style=\"margin-right: 0.13889em;\">T</span><span class=\"mord mathdefault\">A</span><span class=\"mord cjk_fallback\">了</span><span class=\"mord cjk_fallback\">在</span><span class=\"mord cjk_fallback\">我</span><span class=\"mord cjk_fallback\">查</span><span class=\"mord cjk_fallback\">询</span><span class=\"mord cjk_fallback\">后</span><span class=\"mord cjk_fallback\">发</span><span class=\"mord cjk_fallback\">现</span><span class=\"mord cjk_fallback\">：</span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\">h</span><span class=\"mord mathdefault\">p</span><span class=\"mord cjk_fallback\">在</span><span class=\"mord mathdefault\" style=\"margin-right: 0.02691em;\">w</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">n</span><span class=\"mord mathdefault\">d</span><span class=\"mord mathdefault\">o</span><span class=\"mord mathdefault\" style=\"margin-right: 0.02691em;\">w</span><span class=\"mord cjk_fallback\">的</span><span class=\"mord cjk_fallback\">时</span><span class=\"mord cjk_fallback\">候</span><span class=\"mord cjk_fallback\">如</span><span class=\"mord cjk_fallback\">果</span><span class=\"mord cjk_fallback\">文</span><span class=\"mord cjk_fallback\">件</span><span class=\"mord cjk_fallback\">名</span><span class=\"mspace\" style=\"margin-right: 0.222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right: 0.222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 0.69444em; vertical-align: 0em;\"></span><span class=\"mord\">\"</span><span class=\"mspace\" style=\"margin-right: 0.277778em;\"></span><span class=\"mrel\">:</span></span><span class=\"base\"><span class=\"strut\" style=\"height: 0.43056em; vertical-align: 0em;\"></span><span class=\"mrel\">:</span></span></span></span></span>DATA“会把::<span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n    \n     \n      \n       \n        D\n       \n       \n        A\n       \n       \n        T\n       \n       \n        A\n       \n       \n        之\n       \n       \n        后\n       \n       \n        的\n       \n       \n        数\n       \n       \n        据\n       \n       \n        当\n       \n       \n        成\n       \n       \n        文\n       \n       \n        件\n       \n       \n        流\n       \n       \n        处\n       \n       \n        理\n       \n       \n        ,\n       \n       \n        不\n       \n       \n        会\n       \n       \n        检\n       \n       \n        测\n       \n       \n        后\n       \n       \n        缀\n       \n       \n        名\n       \n       \n        .\n       \n       \n        且\n       \n       \n        保\n       \n       \n        持\n       \n       \n        ”\n       \n       \n        :\n       \n       \n        :\n       \n      \n      \n       DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::\n      \n     \n    </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.88888em; vertical-align: -0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">D</span><span class=\"mord mathdefault\">A</span><span class=\"mord mathdefault\" style=\"margin-right: 0.13889em;\">T</span><span class=\"mord mathdefault\">A</span><span class=\"mord cjk_fallback\">之</span><span class=\"mord cjk_fallback\">后</span><span class=\"mord cjk_fallback\">的</span><span class=\"mord cjk_fallback\">数</span><span class=\"mord cjk_fallback\">据</span><span class=\"mord cjk_fallback\">当</span><span class=\"mord cjk_fallback\">成</span><span class=\"mord cjk_fallback\">文</span><span class=\"mord cjk_fallback\">件</span><span class=\"mord cjk_fallback\">流</span><span class=\"mord cjk_fallback\">处</span><span class=\"mord cjk_fallback\">理</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right: 0.166667em;\"></span><span class=\"mord cjk_fallback\">不</span><span class=\"mord cjk_fallback\">会</span><span class=\"mord cjk_fallback\">检</span><span class=\"mord cjk_fallback\">测</span><span class=\"mord cjk_fallback\">后</span><span class=\"mord cjk_fallback\">缀</span><span class=\"mord cjk_fallback\">名</span><span class=\"mord\">.</span><span class=\"mord cjk_fallback\">且</span><span class=\"mord cjk_fallback\">保</span><span class=\"mord cjk_fallback\">持</span><span class=\"mord\">”</span><span class=\"mspace\" style=\"margin-right: 0.277778em;\"></span><span class=\"mrel\">:</span></span><span class=\"base\"><span class=\"strut\" style=\"height: 0.43056em; vertical-align: 0em;\"></span><span class=\"mrel\">:</span></span></span></span></span>DATA\"之前的文件名<br/> 他的目的就是不检查后缀名<br/> 抓包，修改<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9c916dace145478387152513c8380a87.png\"/>上传成功，用蚁剑连接即可</p>\n<h2><a id=\"pass9_34\"></a>pass9</h2>\n<p>我们查看提示后发现，这关把前面的全部拉入了黑名单<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\61b057be24ea4c3d838dfce4c67be2f1.png\"/>查看源码分析一下<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\2e7baa3140bd443a87b246d1147dd838.png\"/><br/> 发现它先将后缀名后的‘.’删除，然后删除空格。<br/> 我们可以把文件后缀改成11.php. .,经过代码处理后变成11.php.绕过<br/> 上传php文件，然后抓包，改后缀<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9738f3761a194e78a4928c8994d07ab9.png\"/>上传成功，用蚁剑连接即可。</p>\n<h2><a id=\"pass10_39\"></a>pass10</h2>\n<p>我们查看一下源码<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\596e4b988c9240c7a0fd1c7769842172.png\"/>发现<span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n    \n     \n      \n       \n        f\n       \n       \n        i\n       \n       \n        l\n       \n       \n        \n         e\n        \n        \n         n\n        \n       \n       \n        a\n       \n       \n        m\n       \n       \n        e\n       \n       \n        =\n       \n       \n        s\n       \n       \n        t\n       \n       \n        \n         r\n        \n        \n         i\n        \n       \n       \n        r\n       \n       \n        e\n       \n       \n        p\n       \n       \n        l\n       \n       \n        a\n       \n       \n        c\n       \n       \n        e\n       \n       \n        (\n       \n      \n      \n       file_name = str_ireplace(\n      \n     \n    </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 0.88888em; vertical-align: -0.19444em;\"></span><span class=\"mord mathdefault\" style=\"margin-right: 0.10764em;\">f</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\" style=\"margin-right: 0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.151392em;\"><span class=\"\" style=\"top: -2.55em; margin-left: 0em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.15em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">m</span><span class=\"mord mathdefault\">e</span><span class=\"mspace\" style=\"margin-right: 0.277778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right: 0.277778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height: 1em; vertical-align: -0.25em;\"></span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">t</span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.311664em;\"><span class=\"\" style=\"top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.15em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mord mathdefault\" style=\"margin-right: 0.02778em;\">r</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">p</span><span class=\"mord mathdefault\" style=\"margin-right: 0.01968em;\">l</span><span class=\"mord mathdefault\">a</span><span class=\"mord mathdefault\">c</span><span class=\"mord mathdefault\">e</span><span class=\"mopen\">(</span></span></span></span></span>deny_ext,\"\", $file_name);<br/> 这个代码的意思就是把带有黑名单中的后缀替换为空。<br/> 这时我们考虑双写绕过。如上传的66.pphphp就会变成66.php绕过<br/> 直接上传成功了，<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\efa58af383d54495b78754ac922e272c.png\"/>用蚁剑连接即可</p>\n<h2><a id=\"pass11httpsimgblogcsdnimgcn74fb0a038ee047a8bd51b8c21ed5f583pngxossprocessimagewatermarktype_ZHJvaWRzYW5zZmFsbGJhY2sshadow_50text_Q1NETiBA5peg5ZCN5LmL5raf5aS05Y35bCP6L35byfsize_12color_FFFFFFt_70g_sex_16_44\"></a>pass11<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\74fb0a038ee047a8bd51b8c21ed5f583.png\"/></h2>\n<p>在我们尝试上传一个php文件后发现只允许上传jpg,gif这些类型的，所以这一关采用的是白名单过滤的方法，并且将上传文件的后缀名改为白名单里的后缀名<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\50fa0b4b64714f338d6f33c034f4c2b0.png\"/>这一关上传目录是可控的，所以可以先上传一个后缀名为.php，然后修改上传目录为.php后缀，之后在.php后使用截断后面的拼接内容，用00截断，因为00在url的GET参数中，所以需用进行url编码，最后把文件名后缀改为.jpg<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e3d593a9f69b44a7a26408ac45484661.png\"/>发现上传成功，用蚁剑连接即可</p>\n<h2><a id=\"pass12_46\"></a>pass12</h2>\n<p>我们直接上传一个php文件，发现和上一关差不多，为白名单过滤。<br/> 直接抓包，发现post里面的参数跟上一关一样，加拦截发现不行，因为在post里面%00会被认为是字符串，所以换个方式加，先在php后面加个+，然后文件名改为jpg，再到后面的hex里面加个空格<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\5aac2493b24946e48752072832f7c2ba.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e1fdcc21d4d7449aab75356f03ccbd1d.png\"/><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\430154833b1749658959eef114ed2eb7.png\"/>修改为00后点击应用就修改成功了，发送回浏览器就上传成功啦</p>\n<h2><a id=\"pass13_50\"></a>pass13</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\2964253e48cc44a48976f8cce74fd5ee.png\"/>查看提示我们知道，只检查图标内容的前两个字节，所以我们在一句话木马前加上GIF 89A就可以转换成为gif文件了。<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\285be5dfbb31498aac4a761805fdd523.png\"/><br/> 直接上传这个文件，发现上传成功，但是是gif格式的<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\cb8530ad3dda48aa9cbe33b26915b5b8.png\"/>这时需要我们写一个include.php传入，来解析图片<br/> 这时源码<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8fc9f838d6b84b09979e9dae7a3ba510.png\"/>&lt;?php<br/> /*<br/> 本页面存在文件包含漏洞，用于测试图片马是否能正常运行！<br/> */<br/> header(“Content-Type:text/html;charset=utf-8”);<br/> $file = <span class=\"katex--inline\"><span class=\"katex\"><span class=\"katex-mathml\">\n    \n     \n      \n       \n        \n        \n         G\n        \n       \n       \n        E\n       \n       \n        T\n       \n       \n        \n         [\n        \n        \n         ′\n        \n       \n       \n        f\n       \n       \n        i\n       \n       \n        l\n       \n       \n        \n         e\n        \n        \n         ′\n        \n       \n       \n        ]\n       \n       \n        ;\n       \n       \n        i\n       \n       \n        f\n       \n       \n        (\n       \n       \n        i\n       \n       \n        s\n       \n       \n        s\n       \n       \n        e\n       \n       \n        t\n       \n       \n        (\n       \n      \n      \n       _GET['file']; if(isset(\n      \n     \n    </span><span class=\"katex-html\"><span class=\"base\"><span class=\"strut\" style=\"height: 1.00189em; vertical-align: -0.25em;\"></span><span class=\"mord\"><span class=\"\"></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.328331em;\"><span class=\"\" style=\"top: -2.55em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathdefault mtight\">G</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.15em;\"><span class=\"\"></span></span></span></span></span></span><span class=\"mord mathdefault\" style=\"margin-right: 0.05764em;\">E</span><span class=\"mord mathdefault\" style=\"margin-right: 0.13889em;\">T</span><span class=\"mopen\"><span class=\"mopen\">[</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.751892em;\"><span class=\"\" style=\"top: -3.063em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mord mathdefault\" style=\"margin-right: 0.10764em;\">f</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\" style=\"margin-right: 0.01968em;\">l</span><span class=\"mord\"><span class=\"mord mathdefault\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height: 0.751892em;\"><span class=\"\" style=\"top: -3.063em; margin-right: 0.05em;\"><span class=\"pstrut\" style=\"height: 2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">]</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right: 0.166667em;\"></span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\" style=\"margin-right: 0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathdefault\">i</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">s</span><span class=\"mord mathdefault\">e</span><span class=\"mord mathdefault\">t</span><span class=\"mopen\">(</span></span></span></span></span>file)){<!-- --><br/> include $file;<br/> }else{<!-- --><br/> show_source(<strong>file</strong>);<br/> }<br/> ?&gt;<br/> 将它放入upload-labs里面（跟之前建的upload文件夹在同一级别下，后面就知道为啥了）<br/> 然后我们来解析gif文件<br/> http://127.0.0.1/upload-labs/upload/include.php?file=upload/文件名<br/> 解析时看路径就知道include.php跟upload同级了<br/> 解析成功后就可以用蚁剑直接连接了。</p>\n<h2><a id=\"pass14_70\"></a>pass14</h2>\n<p>我们查看一下提示<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\f44b404611104fe2bc683855fe5da075.png\"/><br/> getimagesize（）可以将jpg，gif等图片类型的大小并返回尺寸，也是用这个函数来确定图片类型。<br/> 其余同pass13.</p>\n<h2><a id=\"pass15_75\"></a>pass15</h2>\n<p>我们查看源码后发现有这个函数<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8bae93dc45c24821ae0ec0de8f454203.png\"/></p>\n<p>exif_imagetype()函数可以获取图片类型<br/> 同pass13。</p>\n<h2><a id=\"pass16_80\"></a>pass16</h2>\n<p>这一关是二次渲染，我们刚开始上传的图片会被渲染，导致原有的属性被改变，我们首先上传一张gif的图片<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\75c11013c25648fc8b1867830443a860.png\"/>然后点击右键将它另存到其他地方（这时的图片已经被渲染了）可以用它去制作图片马来进行上传。<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\f221f08cebfb4fbc99c550335069bc58.png\"/>剩余的同less13。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2021-11-03 20:28:34", "summary": "在这里插入图片描述上传一个一句话文件记得改成格式在这里插入图片描述发现不允许上传类型的，只能上传，，的在这里插入图片描述我们打算用抓包，先上传的，然后用改成的。在这里插入图片描述在这里插入图片描述放包"}