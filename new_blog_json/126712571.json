{"blogid": "126712571", "writerAge": "ç é¾„4å¹´", "writerBlogNum": "42", "writerCollect": "72", "writerComment": "6", "writerFan": "232", "writerGrade": "3çº§", "writerIntegral": "488", "writerName": "åŒ—åŸ åŠå¤", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126712571.jpg", "writerRankTotal": "36224", "writerRankWeekly": "23418", "writerThumb": "33", "writerVisitNum": "22817", "blog_read_count": "250", "blog_time": "å·²äºÂ 2022-09-06 19:38:13Â ä¿®æ”¹", "blog_title": "k8sè‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ï¼ˆäºŒè¿›åˆ¶ï¼‰", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>æ–‡ç« ç›®å½•</h3>\n<ul><li><ul><li><a href=\"#_1\">ä»‹ç»</a></li><li><ul><li><a href=\"#_5\">éƒ¨ç½²ç»“æ„</a></li></ul>\n</li><li><a href=\"#_12\">æ“ä½œæ­¥éª¤</a></li><li><ul><li><a href=\"#_13\">ç¯å¢ƒå‡†å¤‡</a></li><li><ul><li><a href=\"#_21\">å¤‡æ³¨</a></li><li><a href=\"#_27\">è§£å‹éƒ¨ç½²åŒ…</a></li><li><a href=\"#host_35\">ä¿®æ”¹hostæ–‡ä»¶</a></li><li><a href=\"#_87\">åˆå§‹åŒ–ç¯å¢ƒ</a></li><li><ul><li><a href=\"#_98\">æ‰§è¡Œç»“æœ</a></li></ul>\n</li><li><a href=\"#k8s_104\">å®‰è£…k8sé›†ç¾¤</a></li><li><a href=\"#master_109\">ç™»å½•masterçš„èŠ‚ç‚¹</a></li></ul>\n</li><li><a href=\"#_114\">éƒ¨ç½²åŒ…ä¸‹è½½</a></li></ul>\n</li><li><a href=\"#_123\">æ€»ç»“</a></li></ul>\n</li></ul>\n</div>\n<p></p>\n<h2><a id=\"_1\"></a>ä»‹ç»</h2>\n<p>é€šè¿‡ansibleè„šæœ¬+shellå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²k8såŸºç¡€é›†ç¾¤(v1.25.0)</p>\n<h3><a id=\"_5\"></a>éƒ¨ç½²ç»“æ„</h3>\n<p><img alt=\"è¯·æ·»åŠ å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\f0029287c34148a586e5b1dded684f5b.png\"/>1. é€šè¿‡äºŒè¿›åˆ¶éƒ¨ç½²åŒ…é•œåƒå®‰è£…k8sé›†ç¾¤ã€ç›®å½•etcdèŠ‚ç‚¹åªæ”¯æŒ1-3ä¸ªèŠ‚ç‚¹ã€æœ€å¤šä¸‰ä¸ªetcdèŠ‚ç‚¹<br/> 2. å› k8sç‰ˆæœ¬ç›¸å¯¹è¾ƒæ–°ã€éœ€è¦å‡çº§å†…æ ¸æ¥æ”¯æŒåå°ç¨‹åºã€å½“å‰ç‰ˆæœ¬åªæ”¯æŒCento7ï¼Œ<font color=\"red\">å†…æ ¸ç‰ˆæœ¬(5.19.4-1.el7.elrepo.x86_64</font>)<br/> 3. é‡‡ç”¨k8säºŒè¿›åˆ¶å®‰è£…ï¼Œé€šè¿‡systemè¿›è¡Œç®¡ç†ï¼Œé‡‡ç”¨æœ¬åœ°yumä»“åº“ï¼Œç‰ˆæœ¬æ˜¯ï¼š1.25.0<br/> 4. éƒ¨ç½²èŠ‚ç‚¹å®‰è£…dockerçš„yumæºæ˜¯åŸºäºCentos7.5/7.6,ç‰ˆæœ¬æ˜¯ï¼š19.03.14<br/> 5. éƒ¨ç½²èŠ‚ç‚¹å®‰è£…ansibleæ—¶ï¼Œä½¿ç”¨ç¦»çº¿å®‰è£…ï¼Œç‰ˆæœ¬ï¼š2.9.27</p>\n<h2><a id=\"_12\"></a>æ“ä½œæ­¥éª¤</h2>\n<h3><a id=\"_13\"></a>ç¯å¢ƒå‡†å¤‡</h3>\n<table><thead><tr><th>ä½œç”¨</th><th>IPåœ°å€</th><th>æ“ä½œç³»ç»Ÿ</th><th>é…ç½®</th></tr></thead><tbody><tr><td>k8s-master01</td><td>192.168.1.13</td><td>CentOS7</td><td>æœ€ä½é…ç½®2C2G</td></tr><tr><td>ansible</td><td>192.168.1.140</td><td>CentOS7</td><td>æœ€ä½é…ç½®1C1G</td></tr></tbody></table>\n<blockquote>\n<ol><li>nodeèŠ‚ç‚¹å¯ä»¥å¡«å†™å¤šä¸ªï¼Œæ ¹æ®å®é™…æƒ…å†µç¡®è®¤ï¼Œä½†æ˜¯ä¸èƒ½è¶…å‡ºå•masterèŠ‚ç‚¹çš„é™åˆ¶</li><li>masterèŠ‚ç‚¹è‡³å°‘æ˜¯ä¸‰ä¸ªå°‘ä¸€ä¸ªéƒ½ä¸æ˜¯é«˜å¯ç”¨ç‰ˆæœ¬</li><li>é«˜å¯ç”¨éƒ¨ç½²æ—¶éœ€è¦ä¸ºkeepalivedæå‰ç¡®è®¤å¥½vipçš„ä¿¡æ¯</li></ol>\n</blockquote>\n<h4><a id=\"_21\"></a>å¤‡æ³¨</h4>\n<ol><li><font color=\"red\">å•ç‹¬æ‰¾ä¸€å°æœºå™¨ç”¨äºéƒ¨ç½²ansibleæœåŠ¡,å‡çº§å†…æ ¸æ—¶éœ€è¦é‡å¯æœåŠ¡å™¨</font></li><li><font color=\"blue\">éƒ¨ç½²èŠ‚ç‚¹éƒ¨ç½²é‡å¯ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‰§è¡ŒæŠ¥é”™</font></li><li>ä½†æ˜¯éœ€è¦ç¡®ä¿æœºå™¨èµ„æºå……è¶³ï¼Œä¸”ç›¸å…³çš„ç«¯å£ä¸ä¼šå†²çªï¼ˆ38081ã€yumã€‘ã€38082ã€registryã€‘ï¼‰</li><li>ç›¸å…³çš„ç½‘ç»œå…³ç³»éœ€è¦æå‰ç¡®è®¤</li></ol>\n<h4><a id=\"_27\"></a>è§£å‹éƒ¨ç½²åŒ…</h4>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\">#ä¸Šä¼ éƒ¨ç½²åŒ…ï¼ˆxshellï¼‰</span>\nyum -y <span class=\"token function\">install</span> lrzsz \nrz install_k8s_binary_20220905.tar.gz\n<span class=\"token comment\">#è§£å‹</span>\n<span class=\"token function\">tar</span> -xvf install_k8s_binary_20220905.tar.gz -C /opt\n</code></pre>\n<h4><a id=\"host_35\"></a>ä¿®æ”¹hostæ–‡ä»¶</h4>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\">#éƒ¨ç½²æœºå™¨ï¼Œåˆå§‹è„šæœ¬ã€å®‰è£…åŒ…é•œåƒ</span>\n<span class=\"token punctuation\">[</span>deploy_server<span class=\"token punctuation\">]</span>\n<span class=\"token number\">192.168</span>.1.11 <span class=\"token assign-left variable\">ansible_user</span><span class=\"token operator\">=</span><span class=\"token string\">\"root\"</span> <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">\"1\"</span>  <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span> <span class=\"token assign-left variable\">hostname</span><span class=\"token operator\">=</span><span class=\"token string\">\"Ansible\"</span>\n\n<span class=\"token comment\">#apiserverã€controllerã€schedulerã€é€šè¿‡ä¸‹é¢çš„install_kubelet_enableæ¥ç¡®è®¤æ˜¯å¦åœ¨masterèŠ‚ç‚¹ä¸Šå®‰è£…kubeletã€proxyæœåŠ¡</span>\n<span class=\"token punctuation\">[</span>kubernetes_master<span class=\"token punctuation\">]</span>\n<span class=\"token number\">192.168</span>.1.12 <span class=\"token assign-left variable\">ansible_user</span><span class=\"token operator\">=</span><span class=\"token string\">\"root\"</span> <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">\"1\"</span>  <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span>  <span class=\"token assign-left variable\">hostname</span><span class=\"token operator\">=</span><span class=\"token string\">\"k8s-master01\"</span>\n\n<span class=\"token comment\">#kubeletã€proxy,å¯ä»»æ„æ·»åŠ èŠ‚ç‚¹æ•°ï¼Œåªè¦ä¸è¶…å‡ºk8sæœ¬èº«çš„é™åˆ¶å³å¯</span>\n<span class=\"token punctuation\">[</span>kubernetes_node<span class=\"token punctuation\">]</span>\n<span class=\"token comment\">#192.168.1.13 ansible_user=\"root\" ansible_ssh_pass=\"1\"  ansible_ssh_port=22  hostname=\"k8s-node01\"</span>\n\n\n<span class=\"token comment\">#å•èŠ‚ç‚¹æˆ–è€…ä¸‰èŠ‚ç‚¹å…¶ä»–çš„æš‚æ—¶ä¸æ”¯æŒï¼Œé€šè¿‡è„šæœ¬è§£æä¸»æœºä¿¡æ¯ï¼Œç›®å‰åªæ”¯æŒ1-3ä¸ªèŠ‚ç‚¹</span>\n<span class=\"token punctuation\">[</span>etcd<span class=\"token punctuation\">]</span>\n<span class=\"token number\">192.168</span>.1.12 <span class=\"token assign-left variable\">ansible_user</span><span class=\"token operator\">=</span><span class=\"token string\">\"root\"</span> <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">\"1\"</span>  <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span> <span class=\"token assign-left variable\">ETCD_NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"k8s-master01\"</span>\n\n<span class=\"token comment\">#ä¸å¡«å†™ï¼Œåˆ™ä¸å®‰è£…é•œåƒä»“åº“ã€ç›®å‰å°šæœªå®Œæˆ(å¾…å®Œå–„)</span>\n<span class=\"token punctuation\">[</span>docker_repositry<span class=\"token punctuation\">]</span>\n<span class=\"token comment\">#192.168.1.136 ansible_user=\"root\" ansible_ssh_pass=\"1\"  ansible_ssh_port=22 hostname=\"k8s-node01\"</span>\n\n<span class=\"token comment\">#åŒèŠ‚ç‚¹</span>\n<span class=\"token punctuation\">[</span>haproxy_keepalived<span class=\"token punctuation\">]</span>\n<span class=\"token comment\">#192.168.1.12 ansible_user=\"root\" ansible_ssh_pass=\"1\"  ansible_ssh_port=22 hostname=\"k8s-haproxy\"</span>\n<span class=\"token comment\">#192.168.1.12 ansible_user=\"root\" ansible_ssh_pass=\"1\"  ansible_ssh_port=22 hostname=\"k8s-haproxy\"</span>\n\n\n<span class=\"token punctuation\">[</span>nodes:children<span class=\"token punctuation\">]</span>\nkubernetes_master\nkubernetes_node\nhaproxy_keepalived\netcd\n\n<span class=\"token punctuation\">[</span>all:vars<span class=\"token punctuation\">]</span>\n<span class=\"token comment\">#interface=\"ens33\"             #éƒ¨ç½²æœºå™¨çš„ç½‘å¡åç§°</span>\n<span class=\"token assign-left variable\">master_vip</span><span class=\"token operator\">=</span><span class=\"token string\">\"192.168.1.120\"</span>     <span class=\"token comment\">#é«˜å¯ç”¨</span>\n\n<span class=\"token comment\">#å¸ƒå°”å€¼ true or false</span>\n<span class=\"token assign-left variable\">install_kubelet_enable</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>  <span class=\"token comment\">#masterèŠ‚ç‚¹æ˜¯å¦å®‰è£…kubeletã€kube-proxy  </span>\n<span class=\"token assign-left variable\">network_enable</span><span class=\"token operator\">=</span><span class=\"token string\">\"false\"</span>         <span class=\"token comment\">#è”ç½‘çŠ¶æ€ä¸‹ï¼ŒåŠ è½½ç½‘ç»œyumä»“åº“</span>\n<span class=\"token assign-left variable\">Basic_enable</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>            <span class=\"token comment\">#å®‰è£…åŸºç¡€è½¯ä»¶åŒ…    </span>\n<span class=\"token assign-left variable\">clear_cert_data</span><span class=\"token operator\">=</span><span class=\"token string\">\"false\"</span>        <span class=\"token comment\">#æ¸…ç†ä¸Šä¸€æ¬¡ç”Ÿæˆçš„è¯ä¹¦åŠæ¸…ç†cfsslçš„å®‰è£…åŒ…</span>\n\n\n<span class=\"token comment\">#k8s ç»„ä»¶æœåŠ¡</span>\n<span class=\"token assign-left variable\">dashboard_enable</span><span class=\"token operator\">=</span><span class=\"token string\">\"false\"</span>       <span class=\"token comment\">#å®‰è£…dashboardæœåŠ¡</span>\n<span class=\"token assign-left variable\">prometheus_enable</span><span class=\"token operator\">=</span><span class=\"token string\">\"false\"</span>      <span class=\"token comment\">#å®‰è£…PrometheusæœåŠ¡ï¼Œå°šæœªå®Œæˆ</span>\n<span class=\"token assign-left variable\">ingress_enable</span><span class=\"token operator\">=</span><span class=\"token string\">\"false\"</span>         <span class=\"token comment\">#å®‰è£…ingressæœåŠ¡ï¼Œå°šæœªå®Œæˆ</span>\n\n</code></pre>\n<h4><a id=\"_87\"></a>åˆå§‹åŒ–ç¯å¢ƒ</h4>\n<pre><code class=\"prism language-shell\"><span class=\"token punctuation\">[</span>root@registry<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /opt/install_k8s_binary</span>\n<span class=\"token punctuation\">[</span>root@registry install_k8s_binary<span class=\"token punctuation\">]</span><span class=\"token comment\"># sh Run.sh </span>\n<span class=\"token number\">1</span><span class=\"token punctuation\">)</span> åˆå§‹åŒ–ç¯å¢ƒ<span class=\"token punctuation\">(</span>ansible<span class=\"token punctuation\">))</span>\n<span class=\"token number\">2</span><span class=\"token punctuation\">)</span> å®‰è£…k8sé›†ç¾¤<span class=\"token punctuation\">(</span>v1.25.0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>äºŒè¿›åˆ¶<span class=\"token punctuation\">)</span>\n----------------------------------------------------------------------------\nè¯·è¾“å…¥å¯¹åº”çš„æ•°å­—ç¼–å·:1\nè¯·è¾“å…¥éƒ¨ç½²æœºçš„åœ°å€<span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.1.11<span class=\"token punctuation\">)</span>:\n<span class=\"token comment\">#éƒ¨ç½²æœºçš„åœ°å€,é€šè¿‡è„šæœ¬è·å–çš„åœ°å€ï¼Œç¡®è®¤æ— è¯¯åç›´æ¥å›è½¦å³å¯</span>\n</code></pre>\n<h5><a id=\"_98\"></a>æ‰§è¡Œç»“æœ</h5>\n<p><img alt=\"è¯·æ·»åŠ å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\fc31ef3433f24e82a71144eee168d937.png\"/></p>\n<blockquote>\n<ol><li>å®‰è£…dockeræœåŠ¡</li><li>å®‰è£…ansibleæœåŠ¡ï¼Œä¿®æ”¹ansible.cfgé…ç½®</li><li>å‡†å¤‡ç¦»çº¿yumä»“åº“æŒ‚è½½ç‚¹æ˜¯ï¼šéƒ¨ç½²åŒ…çš„ä¸‹çš„yumç›®å½•</li><li>å‡†å¤‡ç¦»çº¿registryä»“åº“ï¼Œç›¸å…³æŒ‚è½½ç‚¹æ˜¯ï¼š<strong>/var/images/</strong></li></ol>\n</blockquote>\n<h4><a id=\"k8s_104\"></a>å®‰è£…k8sé›†ç¾¤</h4>\n<p>ç™»å½•éƒ¨ç½²æœºå™¨ä¸Šæ‰§è¡ŒRun.shè„šæœ¬</p>\n<p><strong>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</strong><br/> <img alt=\"è¯·æ·»åŠ å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\5d934b81d88b44b5a5a7df1c3060b375.png\"/></p>\n<h4><a id=\"master_109\"></a>ç™»å½•masterçš„èŠ‚ç‚¹</h4>\n<img alt=\"image-20220905193211806\" src=\"..\\..\\static\\image\\c5a519cf369b4f28a0a85e1aaab5e315.png\"/>\n<blockquote>\n<ol><li>å› æœ¬åœ°è™šæ‹Ÿæœºé™åˆ¶ï¼Œç›®å‰ä½¿ç”¨å•èŠ‚ç‚¹æµ‹è¯•éƒ¨ç½²ï¼Œä¸€ä¸»ä¸€ä»çš„ä¹Ÿæµ‹è¯•å¯è¡Œ</li><li><font color=\"blue\">é«˜å¯ç”¨ç‰ˆæœ¬å°šæœªæµ‹è¯•ï¼Œè™šæ‹Ÿæœºæµ‹è¯•ç”µè„‘å®¹æ˜“æ­»æœºğŸ˜‚</font></li></ol>\n</blockquote>\n<h3><a id=\"_114\"></a>éƒ¨ç½²åŒ…ä¸‹è½½</h3>\n<p>é“¾æ¥ï¼š<a href=\"https://pan.baidu.com/s/1TERyfAG7CzXwE4ULJu0xqw?pwd=m3jc\">https://pan.baidu.com/s/1TERyfAG7CzXwE4ULJu0xqw?pwd=m3jc </a><br/> æå–ç ï¼šm3jc<br/> â€“æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V1çš„åˆ†äº«</p>\n<blockquote>\n<ol><li>ç›®å‰ç‰ˆæœ¬ï¼Œåç»­ä¼šæ›´æ–°</li><li>åˆå§‹åŒ–ç¯å¢ƒæ—¶ï¼Œå¦‚æœå¯åŠ¨æŠ¥é”™ï¼Œå‡ºç°â€¦iptableâ€¦çš„å­—æ®µè¿™å¯ä»¥é‡æ–°æ‰§è¡Œä¸€æ¬¡åˆå§‹åŒ–å³å¯æ­£å¸¸å¯åŠ¨</li><li>ç›®å‰containerdçš„é•œåƒä»“åº“é…ç½®çš„æ˜¯åˆå§‹åŒ–çš„åœ°å€ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨k8sé›†ç¾¤ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨ä¿®æ”¹containerdçš„é…ç½®æ–‡ä»¶&lt;è‡ªè¡Œç™¾åº¦æ·»åŠ &gt;ï¼ˆåç»­ä¼˜åŒ–ï¼‰</li><li>åˆ†äº«é“¾æ¥æ˜¯7å¤©ï¼Œåç»­ä¼šæ›´æ–°ç‰ˆæœ¬</li></ol>\n</blockquote>\n<h2><a id=\"_123\"></a>æ€»ç»“</h2>\n<blockquote>\n<ol><li>ä¸Šè¿°åˆ™æ˜¯å½“å‰éƒ¨ç½²ä¸­å¯è¿è¡Œæ­£å¸¸çš„æœåŠ¡</li><li>æ‰§è¡ŒRun.sh è¾“å…¥init,åˆ™å¯ä»¥è°ƒè¯•è„šæœ¬ï¼Œå¯¹åº”çš„å¯åŠ¨æ–‡ä»¶ï¼Œä¿®æ”¹ï¼Œåˆ™å¯ä»¥è¿›è¡Œè°ƒè¯•ï¼ˆplaybook/tools/deploy_test.yamlï¼‰</li></ol>\n</blockquote>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-06 19:38:13", "summary": "æ–‡ç« ç›®å½•ä»‹ç»éƒ¨ç½²ç»“æ„æ“ä½œæ­¥éª¤ç¯å¢ƒå‡†å¤‡å¤‡æ³¨è§£å‹éƒ¨ç½²åŒ…ä¿®æ”¹æ–‡ä»¶åˆå§‹åŒ–ç¯å¢ƒæ‰§è¡Œç»“æœå®‰è£…é›†ç¾¤ç™»å½•çš„èŠ‚ç‚¹éƒ¨ç½²åŒ…ä¸‹è½½æ€»ç»“ä»‹ç»é€šè¿‡è„šæœ¬å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²åŸºç¡€é›†ç¾¤éƒ¨ç½²ç»“æ„è¯·æ·»åŠ å›¾ç‰‡æè¿°é€šè¿‡äºŒè¿›åˆ¶éƒ¨ç½²åŒ…é•œåƒå®‰è£…é›†ç¾¤ã€ç›®å½•èŠ‚"}