{"blogid": "122879246", "writerAge": "码龄14年", "writerBlogNum": "24", "writerCollect": "28", "writerComment": "9", "writerFan": "1", "writerGrade": "2级", "writerIntegral": "346", "writerName": "hnhdl", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_122879246.jpg", "writerRankTotal": "51903", "writerRankWeekly": "269427", "writerThumb": "6", "writerVisitNum": "15542", "blog_read_count": "2368", "blog_time": "已于 2022-02-11 14:29:15 修改", "blog_title": "nginx下的一级域名跳转到二级域名的配置", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>今天同事反馈，阿里打电话说“网站要变更不然今天就关停。”</p>\n<p>这个事情去年年底就说了。不知道是什么原因。我们来解决这个问题。下面以testweb.com域名为例来讲讲。</p>\n<p>阿里短信内容如下：</p>\n<p><strong>testweb.com域名网站内容与备案信息不符，请修改网站内容，保持与备案主体一致，符合最新备案规则。testweb.com网站下方未显示正确备案编号或者编号未指向工信部，请尽快添加，可参考操作指南。https://help.aliyun.com/knowledge_detail/137270.html</strong></p>\n<p>也是巧了，同事把这个短信发到我的微信，我就点开那个域名，确实是跳转到了我们公司的另外一个网站去了。这就很明显了，我跟同事说不要着急，这个问题简单，它不是备案问题，技术上可以轻松处理。做个域名跳转就OK，就是网上说的服务器做301跳转，301重定向，域名重定向。</p>\n<p>那么nginx下的一级域名跳转到二级域名的配置，要怎么操作呢？我们分两步搞定。</p>\n<p>第一步进入nginx虚拟主机配置目录，编辑相应站点的配置文件<br/> [root@xxxxxxxxxxxxxxxxxxxxxxx sbin]# cd /usr/local/nginx/conf/vhost/<br/> [root@xxxxxxxxxxxxxxxxxxxxxxx vhost]# vi testweb.conf</p>\n<p>在server里面添加如下代码即可：</p>\n<p>if ($host = 'testweb.com' ) {<!-- --><br/>                 rewrite ^/(.*)$ http://www.testweb.com/$1 permanent;<br/> }</p>\n<p>完整的如下</p>\n<pre><code>server\n    {\n        listen 80;\n        server_name  www.testweb.com testweb.com;\n        index index.html index.htm index.php;\n        root /data/www/testweb/public;\n\n        location / {\n          index  index.php index.html index.htm;\n          #如果请求既不是一个文件，也不是一个目录，则执行一下重写规则\n          if (!-e $request_filename)\n          {\n             #地址作为将参数rewrite到index.php上。\n             rewrite ^/(.*)$ /index.php?s=$1;\n             #若是子目录则使用下面这句，将subdir改成目录名称即可。\n             #rewrite ^/subdir/(.*)$ /subdir/index.php?s=$1;\n          }\n        }\n        #这里就是nginx下的一级域名跳转到二级域名的配置，效果是访问testweb.com跳转到www.testweb.com\n        if ($host = 'testweb.com' ) {\n                rewrite ^/(.*)$ http://www.testweb.com/$1 permanent;\n        }\n        location /api/ {\n                index  index.php index.html index.htm;\n                #如果请求既不是一个文件，也不是一个目录，则执行一下重写规则\n                if (!-e $request_filename)\n                {\n                #若是子目录则使用下面这句，将subdir改成目录名称即可。\n                rewrite ^/api/(.*)$ /api.php?s=$1;\n                 }\n        }\n        location ~ \\.php(.*)$ {\n            fastcgi_pass   unix:/usr/local/php/var/run/php-cgi.sock;\n            fastcgi_index  index.php;\n            #fastcgi_split_path_info ^(.+\\.php)(.*)$;\n            #fastcgi_param   PATH_INFO $fastcgi_path_info;\n            fastcgi_param  SCRIPT_FILENAME   $document_root$fastcgi_script_name;\n            include        fastcgi_params;\n        }\n\n        location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf|json|swg)$\n        {\n            expires      30d;\n        }\n\n        location ~ .*\\.(js|css)?$\n        {\n            expires      12h;\n        }\n\n        location ~ /.well-known {\n            allow all;\n        }\n\n        location ~ /\\.\n        {\n            #deny all;\n        }\n\n        access_log  /data/www/nginx_log/testweb.log access;\n}</code></pre>\n<p>编辑完按esc，再按shift+：号，输入wq保存退出。</p>\n<p>第二步重启nginx<br/> [root@xxx vhost]# cd /usr/local/nginx/sbin/<br/> [root@xxxxxxxxxxxxxxxxxxxxxxx sbin]# ./nginx -s reload</p>\n<p>到此nginx下的一级域名跳转到二级域名的配置就搞定了。</p>\n<p>刷新testweb.com看效果，可以看到已经跳转到了www.testweb.com。</p>\n<p>完工。</p>\n</div>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-02-11 14:29:15", "summary": "今天同事反馈，阿里打电话说网站要变更不然今天就关停。这个事情去年年底就说了。不知道是什么原因。我们来解决这个问题。下面以域名为例来讲讲。阿里短信内容如下：域名网站内容与备案信息不符，请修改网站内容，保"}