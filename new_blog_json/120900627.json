{"blogid": "120900627", "writerAge": "码龄5年", "writerBlogNum": "39", "writerCollect": "56", "writerComment": "10", "writerFan": "6", "writerGrade": "3级", "writerIntegral": "455", "writerName": "陈家老二", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_120900627.jpg", "writerRankTotal": "944514", "writerRankWeekly": "91624", "writerThumb": "9", "writerVisitNum": "25661", "blog_read_count": "2874", "blog_time": "已于 2022-04-08 13:16:11 修改", "blog_title": "Linux编译安装PHP7.4.24及启动", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>Linux编译安装PHP7.4.24及启动</h3>\n<ul><li><a href=\"#1_PHP_1\">1. 下载安装包PHP安装包</a></li><li><a href=\"#2__9\">2. 配置安装包</a></li><li><ul><li><a href=\"#21__10\">2.1 先安装前置插件，不管有没有都安装一下</a></li><li><a href=\"#22_php_15\">2.2 配置php</a></li><li><a href=\"#23__66\">2.3 执行配置命令可能会出现如下错误</a></li><li><a href=\"#24_php_103\">2.4 运行php的配置命令出现如下示例，即为配置成功</a></li></ul>\n</li><li><a href=\"#3_107\">3编译安装包</a></li><li><ul><li><a href=\"#31__109\">3.1 执行编译命令（可能要花一点时间）</a></li><li><a href=\"#32___phpiniproductionusrlocalphpphpini_117\">3.2 在之前编译的源码包中，找到 php.ini-production，复制到/usr/local/php下，并改名为php.ini：</a></li><li><a href=\"#32__134\">3.2 修改配置文件</a></li><li><a href=\"#33__155\">3.3 新建用户组及用户</a></li></ul>\n</li><li><a href=\"#4_phpfpm_163\">4. 启动停止php-fpm</a></li><li><ul><li><a href=\"#41__164\">4.1 启动</a></li><li><a href=\"#42_php_184\">4.2 停止php</a></li><li><ul><li><a href=\"#_199\">示例</a></li></ul>\n</li></ul>\n</li><li><a href=\"#_215\">参考</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"1_PHP_1\"></a>1. 下载安装包PHP安装包</h1>\n<ul><li> <p><a href=\"https://www.php.net/downloads\">点此进入官网</a>选择对应安装包<code> php-7.4.24.tar.gz</code><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\b803f7dd2da44d83b41136b6e1d9c2a3.png\"/></p> </li><li> <p>将安装包上传至服务器自定义目录,如/usr/local/</p> </li><li> <p>解压安装包<code> tar -zxvf php-7.4.24.tar.gz</code><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e34a116ac0804cc8989243c9f0e61f75.png\"/></p> </li></ul>\n<h1><a id=\"2__9\"></a>2. 配置安装包</h1>\n<h2><a id=\"21__10\"></a>2.1 先安装前置插件，不管有没有都安装一下</h2>\n<pre><code class=\"prism language-shell\">yum <span class=\"token function\">install</span> gcc-c++ libxml2 libxml2-devel openssl openssl-devel <span class=\"token function\">bzip2</span> bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel gd sqlite sqlite-devel net-snmp net-snmp-devel oniguruma oniguruma-devel\n</code></pre>\n<h2><a id=\"22_php_15\"></a>2.2 配置php</h2>\n<ul><li>进入解压后的目录</li></ul>\n<pre><code class=\"prism language-powershell\">cd php-7<span class=\"token punctuation\">.</span>4<span class=\"token punctuation\">.</span>24\n</code></pre>\n<ul><li>执行php的配置命令如下：</li></ul>\n<pre><code class=\"prism language-powershell\"><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>configure <span class=\"token operator\">--</span>prefix=<span class=\"token operator\">/</span>usr/local/php \\ <span class=\"token comment\"># php的安装路径</span>\n<span class=\"token operator\">--</span>with-config-file-path=<span class=\"token operator\">/</span>usr/local/php/etc \\\n<span class=\"token operator\">--</span>with-mysqli=mysqlnd \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-pdo</span> \\\n<span class=\"token operator\">--</span>with-pdo-mysql=mysqlnd \\\n<span class=\"token operator\">--</span>with-iconv-<span class=\"token function\">dir</span>=<span class=\"token operator\">/</span>usr/local/ \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-fpm</span> \\\n<span class=\"token operator\">--</span>with-fpm-user=www \\\n<span class=\"token operator\">--</span>with-fpm-<span class=\"token function\">group</span>=www \\\n<span class=\"token operator\">--</span>with-pcre-regex \\\n<span class=\"token operator\">--</span>with-zlib \\\n<span class=\"token operator\">--</span>with-bz2 \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-calendar</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">disable-phar</span> \\\n<span class=\"token operator\">--</span>with-curl \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-dba</span> \\\n<span class=\"token operator\">--</span>with-libxml-<span class=\"token function\">dir</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-ftp</span> \\\n<span class=\"token operator\">--</span>with-gd \\\n<span class=\"token operator\">--</span>with-jpeg-<span class=\"token function\">dir</span> \\\n<span class=\"token operator\">--</span>with-png-<span class=\"token function\">dir</span> \\\n<span class=\"token operator\">--</span>with-zlib-<span class=\"token function\">dir</span> \\\n<span class=\"token operator\">--</span>with-freetype-<span class=\"token function\">dir</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-gd</span><span class=\"token operator\">-</span>jis-conv \\\n<span class=\"token operator\">--</span>with-mhash \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-mbstring</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">disable-opcache</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-pcntl</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-xml</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">disable-rpath</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-shmop</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-sockets</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-zip</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-bcmath</span> \\\n<span class=\"token operator\">--</span>with-snmp \\\n<span class=\"token operator\">--</span>disable-ipv6 \\\n<span class=\"token operator\">--</span>with-gettext \\\n<span class=\"token operator\">--</span><span class=\"token function\">disable-rpath</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">disable-debug</span> \\\n<span class=\"token operator\">--</span><span class=\"token function\">enable-embedded</span><span class=\"token operator\">-</span>mysqli \\\n<span class=\"token operator\">--</span>with-mysql-sock=<span class=\"token operator\">/</span>usr/local/mysql \\\n<span class=\"token operator\">--</span>with-apxs2=<span class=\"token operator\">/</span>usr/bin/apxs\n</code></pre>\n<h2><a id=\"23__66\"></a>2.3 执行配置命令可能会出现如下错误</h2>\n<ul><li>问题一<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\58e7af92caeb4d99a8a9738af7770af3.png\"/><br/> 解决办法：</li></ul>\n<pre><code class=\"prism language-powershell\">git clone https:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com/kkos/oniguruma\n\ncd oniguruma\n\n<span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>configure <span class=\"token operator\">--</span>prefix=<span class=\"token operator\">/</span>usr <span class=\"token operator\">--</span>libdir=<span class=\"token operator\">/</span>lib64\n\nmake &amp;&amp; make install\n\n</code></pre>\n<ul><li>问题二</li></ul>\n<pre><code class=\"prism language-java\"><span class=\"token class-name\">Sorry</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">I</span> cannot run <span class=\"token class-name\"><span class=\"token namespace\">apxs<span class=\"token punctuation\">.</span></span>  Possible</span> reasons follow<span class=\"token operator\">:</span>\n \n​<span class=\"token number\">1.</span> <span class=\"token class-name\">Perl</span> is not installed\n \n​<span class=\"token number\">2.</span> apxs was not <span class=\"token class-name\"><span class=\"token namespace\">found<span class=\"token punctuation\">.</span></span> Try</span> <span class=\"token keyword\">to</span> <span class=\"token namespace\">pass</span> the path using <span class=\"token operator\">--</span><span class=\"token keyword\">with</span><span class=\"token operator\">-</span>apxs2<span class=\"token operator\">=</span><span class=\"token operator\">/</span>path<span class=\"token operator\">/</span><span class=\"token keyword\">to</span><span class=\"token operator\">/</span>apxs\n \n​<span class=\"token number\">3.</span> <span class=\"token class-name\">Apache</span> was not built using <span class=\"token operator\">--</span>enable<span class=\"token operator\">-</span>so <span class=\"token punctuation\">(</span>the apxs usage page is displayed<span class=\"token punctuation\">)</span>\n \n​<span class=\"token class-name\">The</span> output of <span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>local<span class=\"token operator\">/</span>apache<span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>apxs follows<span class=\"token operator\">:</span><span class=\"token punctuation\">.</span>/configure<span class=\"token operator\">:</span> line <span class=\"token number\">6669</span><span class=\"token operator\">:</span> <span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>local<span class=\"token operator\">/</span>apache<span class=\"token operator\">/</span>b\nin<span class=\"token operator\">/</span>apxs<span class=\"token operator\">:</span> <span class=\"token class-name\">No</span> such file or directoryconfigure<span class=\"token operator\">:</span> error<span class=\"token operator\">:</span> <span class=\"token class-name\">Aborting</span>\n</code></pre>\n<p>解决办法：</p>\n<pre><code class=\"prism language-powershell\">yum install <span class=\"token operator\">-</span>y perl* \n \n​yum install <span class=\"token operator\">-</span>y httpd-devel\n</code></pre>\n<h2><a id=\"24_php_103\"></a>2.4 运行php的配置命令出现如下示例，即为配置成功</h2>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\4326ab494f4b4a03b8eef9c67e368bf5.png\"/></p>\n<h1><a id=\"3_107\"></a>3编译安装包</h1>\n<h2><a id=\"31__109\"></a>3.1 执行编译命令（可能要花一点时间）</h2>\n<pre><code class=\"prism language-powershell\">make &amp;&amp; make install\n</code></pre>\n<ul><li>如下图即为编译成功，编译后的文件在./configure --prefix=<strong>/usr/local/php</strong> \\ # php的安装路径<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\250111b2accd4b72b3c60e10e8b59aff.png\"/></li></ul>\n<h2><a id=\"32___phpiniproductionusrlocalphpphpini_117\"></a>3.2 在之前编译的源码包中，找到 php.ini-production，复制到/usr/local/php下，并改名为php.ini：</h2>\n<pre><code class=\"prism language-powershell\"><span class=\"token function\">cp</span> php<span class=\"token punctuation\">.</span>ini-production <span class=\"token operator\">/</span>usr/local/php/php<span class=\"token punctuation\">.</span>ini\n</code></pre>\n<ul><li>[可选项] 设置让PHP错误信息打印在页面上</li></ul>\n<pre><code class=\"prism language-powershell\">display_errors = On\n</code></pre>\n<ul><li>将 php.ini 文件中的配置项 cgi.fix_pathinfo 设置为 0 。</li></ul>\n<pre><code class=\"prism language-powershell\">vim <span class=\"token operator\">/</span>usr/local/php/php<span class=\"token punctuation\">.</span>ini\n<span class=\"token comment\">#定位到 cgi.fix_pathinfo= 并将其修改为如下所示：</span>\ncgi<span class=\"token punctuation\">.</span>fix_pathinfo=0\n</code></pre>\n<h2><a id=\"32__134\"></a>3.2 修改配置文件</h2>\n<ul><li>进入安装后的目录</li></ul>\n<pre><code class=\"prism language-powershell\">cd <span class=\"token operator\">/</span>usr/local/php/etc/\n<span class=\"token comment\">#修改当前目录下的配置文件php-fpm.conf.default为 php-fpm.conf</span>\n\n<span class=\"token function\">cp</span> php-fpm<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>default php-fpm<span class=\"token punctuation\">.</span>conf\n<span class=\"token comment\">#编辑一下php-fpm.conf</span>\nvim php-fpm<span class=\"token punctuation\">.</span>conf\n\npid = run/php-fpm<span class=\"token punctuation\">.</span>pid\nuser = www\n<span class=\"token function\">group</span> = www\n\n<span class=\"token comment\">#在进入php-fpm.d 目录下 </span>\ncd php-fpm<span class=\"token punctuation\">.</span>d\n\n<span class=\"token comment\">#修改当前目录下的配置文件 www.conf.default为  www.conf</span>\n<span class=\"token function\">cp</span> www<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>default www<span class=\"token punctuation\">.</span>conf\n</code></pre>\n<h2><a id=\"33__155\"></a>3.3 新建用户组及用户</h2>\n<pre><code class=\"prism language-powershell\">groupadd www\n\nuseradd <span class=\"token operator\">-</span>g www www\n</code></pre>\n<h1><a id=\"4_phpfpm_163\"></a>4. 启动停止php-fpm</h1>\n<h2><a id=\"41__164\"></a>4.1 启动</h2>\n<pre><code class=\"prism language-powershell\"><span class=\"token operator\">/</span>usr/local/php/sbin/php-fpm\n</code></pre>\n<p>没有任何的输出，表示成功了！！！</p>\n<p>php-fpm占用的是9000端口，我们查看下进程：</p>\n<pre><code class=\"prism language-powershell\"><span class=\"token function\">ps</span> <span class=\"token operator\">-</span>ef<span class=\"token punctuation\">|</span>grep php-fpm\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d64f466b5a5d43fcba670c4c4d76f4ae.png\"/><br/> 查看端口：</p>\n<pre><code class=\"prism language-powershell\">netstat <span class=\"token operator\">-</span>tnl <span class=\"token punctuation\">|</span> grep 9000\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\81d1ead46fbc45c6af9d95f4d189740a.png\"/><br/> 说明php启动成功</p>\n<h2><a id=\"42_php_184\"></a>4.2 停止php</h2>\n<p>我们在新安装扩展后，是需要重新php-fpm的，已使扩展生效。</p>\n<p>最简单粗暴的重新php-fpm的方式是：</p>\n<p>先找到php-fpm的进程号，kill 掉，再用/usr/local/php/sbin/php-fpm 这样启动。</p>\n<p>其实还有更多温和的方法，就是使用信号。</p>\n<pre><code class=\"prism language-java\">INT<span class=\"token punctuation\">,</span> TERM 立刻终止\nQUIT 平滑终止\nUSR1 重新打开日志文件\nUSR2 平滑重载所有worker进程并重新载入配置和二进制模块\n</code></pre>\n<h3><a id=\"_199\"></a>示例</h3>\n<p>php-fpm 关闭：</p>\n<pre><code class=\"prism language-shell\"><span class=\"token function\">kill</span> -INT <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">cat</span> /usr/local/php/var/run/php-fpm.pid<span class=\"token variable\">`</span></span>\n</code></pre>\n<p>php-fpm 重启：</p>\n<pre><code class=\"prism language-shell\"><span class=\"token function\">kill</span> -USR2 <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">cat</span> /usr/local/php/var/run/php-fpm.pid<span class=\"token variable\">`</span></span>\n</code></pre>\n<h1><a id=\"_215\"></a>参考</h1>\n<ul><li> <p><a href=\"https://blog.csdn.net/ivan820819/article/details/54970330?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-0.no_search_link&amp;spm=1001.2101.3001.4242.0\">php-fpm讲解</a></p> </li><li> <p><a href=\"https://www.cnblogs.com/alliancehacker/p/12255445.html\">php安装</a></p> </li><li> <p><a href=\"https://www.cnblogs.com/rxbook/p/9106513.html\">Linux下编译安装PHP7.2</a></p> </li></ul>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 1, "csharp": 0, "python": 0, "javascript": 0, "java": 1, "sql": 1, "php": 1, "time": "2022-04-08 13:16:11", "summary": "编译安装及启动下载安装包安装包配置安装包先安装前置插件，不管有没有都安装一下配置执行配置命令可能会出现如下错误运行的配置命令出现如下示例，即为配置成功编译安装包执行编译命令可能要花一点时间在之前编译的"}