{"blogid": "126717812", "writerAge": "None", "writerBlogNum": "172", "writerCollect": "3883", "writerComment": "865", "writerFan": "4635", "writerGrade": "6级", "writerIntegral": "7105", "writerName": "安信可科技", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126717812.jpg", "writerRankTotal": "2508", "writerRankWeekly": "14031", "writerThumb": "527", "writerVisitNum": "740688", "blog_read_count": "34", "blog_time": "已于 2022-09-06 09:32:19 修改", "blog_title": "安信可 RG-02 LoRaWAN 网关集成网络配置，实现MQTT配置链接至网络服务器，实现数据打通。", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"_0\"></a>文章目录</h1>\n<ul><li><a href=\"#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95\">文章目录</a>\n<ul><li><a href=\"#%E4%B8%80%E5%89%8D%E8%A8%80\">一、前言</a></li><li><a href=\"#%E4%BA%8C%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5\">二、配置网络连接</a>\n<ul><li><a href=\"#ap%E8%BF%9E%E6%8E%A5\">AP连接</a></li><li><a href=\"#%E4%BB%A5%E5%A4%AA%E7%BD%91%E6%8E%A5%E5%85%A5\">以太网接入</a></li><li><a href=\"#wifi%E8%BF%9E%E6%8E%A5%E9%85%8D%E7%BD%AE\">WiFi连接配置</a></li><li><a href=\"#%E8%9C%82%E7%AA%9D%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%85%A5\">蜂窝网络接入</a></li><li><a href=\"#%E5%8A%A8%E6%80%81%E9%9D%99%E6%80%81ip%E9%85%8D%E7%BD%AE\">动态/静态IP配置</a></li><li><a href=\"#%E6%8C%87%E7%A4%BA%E7%81%AF\">指示灯</a></li></ul> </li><li><a href=\"#%E4%B8%89lora%E9%A2%91%E6%AE%B5%E9%85%8D%E7%BD%AE\">三、LoRa频段配置</a></li><li><a href=\"#%E5%9B%9Babp%E8%A7%A3%E7%A0%81%E5%8A%9F%E8%83%BD\">四、ABP解码功能</a>\n<ul><li><a href=\"#%E5%88%9B%E5%BB%BA%E8%AE%BE%E5%A4%87\">创建设备</a></li></ul> </li><li><a href=\"#%E4%BA%94abp%E6%A8%A1%E5%BC%8F%E4%B8%8Bat%E6%8C%87%E4%BB%A4%E6%B5%81%E7%A8%8B\">五、ABP模式下AT指令流程</a></li><li><a href=\"#%E5%85%ADmqtt-client\">六、MQTT Client</a>\n<ul><li><a href=\"#%E5%88%9B%E5%BB%BAmqtt-channel\">创建MQTT Channel</a></li><li><a href=\"#%E5%90%AF%E7%94%A8mqtt-client\">启用MQTT Client</a></li><li><a href=\"#uplink-topic\">Uplink Topic</a></li><li><a href=\"#downlink-topic\">Downlink Topic</a></li></ul> </li><li><a href=\"#%E4%B8%83tcp-client\">七、TCP Client</a></li><li><a href=\"#%E5%85%ABssh%E8%BF%9E%E6%8E%A5\">八、SSH连接</a></li><li><a href=\"#%E4%B9%9D%E7%BD%91%E5%85%B3%E5%9B%BA%E4%BB%B6%E5%8D%87%E7%BA%A7\">九、网关固件升级</a></li><li><a href=\"#%E5%8D%81%E9%85%8D%E7%BD%AElorawan%E6%9C%8D%E5%8A%A1%E5%99%A8\">十、配置LoRaWAN服务器</a></li></ul> </li></ul>\n<h2><a id=\"_25\"></a>一、前言</h2>\n<p>本文章将说明如何配置安信可RG-02网关的通信网络，使用网关集成ABP解析，MQTT Client, TCP Client等内容。</p>\n<h2><a id=\"_29\"></a>二、配置网络连接</h2>\n<p>RG-02网关支持三种网络接入方式, 用户可根据部署环境的网络条件选择适合的接入方式, 使网关能够与外界网络通信。</p>\n<h3><a id=\"AP_33\"></a>AP连接</h3>\n<p>RG-02网关上电后，将默认启用AP热点. 默认名称为: <code>AiThinker-LoRaWAN-xxxxxx</code>(GWID后6位), 密码为<code>12345678</code>。通过手机或PC连接该AP并通过浏览器访问IP: <code>http://10.130.1.1/</code>。 默认登录账户为<code>root</code>，登录密码<code>123456</code>。在主页中将显示各个通信部分的状态。</p>\n<h3><a id=\"_37\"></a>以太网接入</h3>\n<p>除了AP配置方式， RG-02网关可通过有线网络直接接入以太网。 用户可通过路由器获取到设备的IP地址。 并通过浏览器访问<code>IP:8000</code>端口进入控制页面。(例：http://192.168.31.158:8000/)</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\ef0930b9b94d4fdbb1aafd9b2a1abec0.jpeg\"/></p>\n<h3><a id=\"WiFi_44\"></a>WiFi连接配置</h3>\n<p>RG-02网关支持配置WiFi无线网络连接， 点击控制页面顶部菜单栏中的<code>Network</code>选项卡-&gt;<code>Network</code>选项。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\102a93775d824d2992a097b4595436fc.jpeg\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e767a297d1c84747935dbd9ce4d6c6a5.jpeg\"/></p>\n<h3><a id=\"_52\"></a>蜂窝网络接入</h3>\n<p>RG-02集成了3G/4G蜂窝调制解调器, 实际部署时可以将其用作主互联网连接或备用连接选项。按下图演示方向安装Micro SIM卡，网关上电后将自动进行SIM卡检测。在web控制页面顶部菜单栏中的<code>Systen</code>选项卡-&gt;<code>Cellular</code>选项，在该页面中能够对蜂窝网络<code>APN</code>接入点等参数进行配置。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\755cec80256f4043b5dd4f0a544c1e2c.jpeg\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\1ac884946d034c3c9a4289037040e670.jpeg\"/></p>\n<h3><a id=\"IP_62\"></a>动态/静态IP配置</h3>\n<p>点击控制页面顶部菜单栏中的<code>Network</code>选项卡-&gt;<code>Network</code>选项，在该页面中能够对有线<code>LAN</code>，无线<code>WiFi</code>的IP Address以及掩码，DNS服务器等信息进行配置。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\681c3f4cd5a54327bba657113f90c035.jpeg\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\0176dfb690364306afe5f5e6ef34ce7e.jpeg\"/></p>\n<h3><a id=\"_70\"></a>指示灯</h3>\n<p>RG-02共有4个LED指示灯：</p>\n<ul><li>电源LED ：如果设备正确供电，此红色LED将持续亮起。</li><li>LoRa LED ：当LoRaWAN模块启动或传输数据包时，该RGB LED将闪烁绿色。</li><li>SYS LED ：此LED将在不同的状态下显示不同的颜色： \n  <ul><li>蓝色的LED：设备与LoRaWAN服务器连接处于活动状态。</li><li>闪烁的蓝色LED： \n    <ul><li>设备已连接互联网，但未连接LoRaWAN。</li><li>设备处于启动阶段，在此阶段，它将闪烁几秒钟的蓝色，然后红色LED和蓝色LED一起闪烁。</li></ul> </li><li>红色的LED：设备没有互联网连接。</li></ul> </li><li>ETH LED ：此LED显示ETH接口连接状态。</li></ul>\n<h2><a id=\"LoRa_83\"></a>三、LoRa频段配置</h2>\n<p>RG-02常规版本(推荐使用频段为CN470)和高频版本(推荐使用频段为EU868)。此外网关支持配置相近的频段，但通信距离将受到影响。例如：RG-02高频版本支持配置为标准频段或者是自定义频段，其中标准频段配置支持<code>EU868</code>、<code>IN865</code>、<code>AU915</code>、<code>US915</code>、<code>KR920</code>、<code>AS923</code>。 推荐的标准频段为<code>EU868</code>，其他频段会存在较高衰减, 可靠通信距离减少。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a7c951efa6544c37a24298f79b597e1e.jpeg\"/></p>\n<h2><a id=\"ABP_90\"></a>四、ABP解码功能</h2>\n<p>安信可RG-02网关支持ABP解码功能，无需额外连接LoRaWAN服务器即可与LoRaWAN ABP端节点通信。并通过MQTT/HTTP/TCP转发至其他服务器。</p>\n<h3><a id=\"_94\"></a>创建设备</h3>\n<p>点击控制页面顶部菜单栏中的<code>LoRa</code>选项卡-&gt;<code>ABP Decryption</code>选项，自定义添加<code>Dev Addr</code>, <code>APP Session Key</code>, <code>Network Session Key</code>。以及数据解码模式。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\82ed233ad5e74fbca2d261568b5887ac.jpeg\"/></p>\n<p>完成节点添加后，勾选左上角的<code>Enable ABP Decryption</code>选项，点击<code>Save</code>保存配置。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\bf84e2bd5cd2402890a12de161cf05dc.jpeg\"/></p>\n<h2><a id=\"ABPAT_106\"></a>五、ABP模式下AT指令流程</h2>\n<pre><code class=\"prism language-shell\">AT+CJOINMODE<span class=\"token operator\">=</span><span class=\"token number\">1</span>\nAT+CRXP<span class=\"token operator\">=</span><span class=\"token number\">1,1</span>,869525000\nAT+CDEVEUI<span class=\"token operator\">=</span>70B3D57ED005225A\nAT+CDEVADDR<span class=\"token operator\">=</span>260BDC94\nAT+CAPPSKEY<span class=\"token operator\">=</span>690D514FA8C1D7A2A22FE878A0293E55\nAT+CNWKSKEY<span class=\"token operator\">=</span>0C7232C5A2BE3BC4B10C22BBD395B87B\nAT+CULDLMODE<span class=\"token operator\">=</span><span class=\"token number\">2</span>\nAT+CCLASS<span class=\"token operator\">=</span><span class=\"token number\">2</span>\nAT+CFREQBANDMASK<span class=\"token operator\">=</span>0001\nAT+DTRX<span class=\"token operator\">=</span><span class=\"token number\">0,1</span>,10,44221111223344556677\n</code></pre>\n<h2><a id=\"MQTT_Client_121\"></a>六、MQTT Client</h2>\n<p>配置MQTT Client实现网关定时发布节点数据，外部可以通过订阅指定的Topic获取节点上行数据。</p>\n<h3><a id=\"MQTT_Channel_125\"></a>创建MQTT Channel</h3>\n<p>创建MQTT Channel匹配对应的节点addr，该Channel RemoteID将用于后续订阅MQTT Topic使用</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\fe43add11ddf42b488373e5138173dfa.jpeg\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a80fd1f1ab684e8c80d1b930ee20d566.jpeg\"/></p>\n<h3><a id=\"MQTT_Client_133\"></a>启用MQTT Client</h3>\n<p>配置MQTT Client的连接的服务器信息以及网关发布/订阅Topic的匹配规则，完成后点击下方保存&amp;启用。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\34b847070eaa4f7584942fcc5dcabedd.jpeg\"/></p>\n<h3><a id=\"Uplink_Topic_140\"></a>Uplink Topic</h3>\n<p>通过MQTT工具测试，订阅Topic。 当节点上发数据时，MQTT Client获取节点数据。</p>\n<ul><li>原始数据解析案例</li></ul>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\"># 原始数据</span>\nffffffc80000008444221111223344556677\n\n<span class=\"token comment\"># 数据解析</span>\nffffffc8是rssi\n0xffffffc8-0x10000000<span class=\"token operator\">=</span>-56\n00000084是SNR信噪比\n0x00000084 / <span class=\"token number\">10</span>% <span class=\"token operator\">=</span><span class=\"token number\">8.4</span>\n<span class=\"token number\">44221111223344556677</span>是payload部分\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\6bfab60617b24e44aa2af3ebe5aa0126.jpeg\"/></p>\n<p>修改<code>Data Format</code>选项可以变更收到的数据格式，如JSON等。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\4216cd99bf294eb7beb5f962f2d2048b.jpeg\"/></p>\n<h3><a id=\"Downlink_Topic_166\"></a>Downlink Topic</h3>\n<p>通过publish消息实现数据下行，topic默认为<code>{clientID}/#</code>，消息格式参考如下。</p>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\">#dev_adrr,imme/time,txt/hex,payload</span>\n<span class=\"token comment\">#dev_adrr,imme/time,txt/hex,payload,txpw,txbw,SF,frequency,rxwindow</span>\n018193F4,imme,hex,0101,20,1,SF12,869525000,2\n\n--------------------------------------------\ndev_addr          <span class=\"token builtin class-name\">:</span> Input the device addr\n\nimme/time:imme    <span class=\"token builtin class-name\">:</span> imme: send downstream immediately,For Class C\n                  <span class=\"token builtin class-name\">:</span> time:send downstream after receive device's uplink, For Class A\n\ntxt/hex:txt       <span class=\"token builtin class-name\">:</span> hex: send hex payload\n                  <span class=\"token builtin class-name\">:</span> txt: send string payload\n\npayload           <span class=\"token builtin class-name\">:</span> payload length should match the protocol\ntxpw              <span class=\"token builtin class-name\">:</span> Transmit Poewr: range <span class=\"token number\">14</span>-27\ntxbw              <span class=\"token builtin class-name\">:</span> bandwidth \n                    <span class=\"token number\">1</span>: 500kHz\n                    <span class=\"token number\">2</span>: 250kHz\n                    <span class=\"token number\">3</span>: 125kHz\n                    <span class=\"token number\">4</span>：62.5kHz\nSF                <span class=\"token builtin class-name\">:</span> SF7/SF8/SF9/SF10/SF11/SF12\nFrequency         <span class=\"token builtin class-name\">:</span> Transmit Frequency\nrxwindow          ：Transmit on RX1 or RX2\n</code></pre>\n<h2><a id=\"TCP_Client_196\"></a>七、TCP Client</h2>\n<p>配置TCP Client实现网关定时发布节点数据，外部的TCP服务器能够收到来自网关的数据帧，其中包含节点上行数据。(注：TCP Client模式下的downlink，只有在uplink后面的2s内会打开一个接收窗口，然后将断开连接)</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\b667bb2596d449ba999cac713ab9aa29.jpeg\"/></p>\n<h2><a id=\"SSH_203\"></a>八、SSH连接</h2>\n<p>局域网内通过SSH连接至网关，用户名为<code>root</code>，默认密码为<code>123456</code></p>\n<pre><code class=\"prism language-shell\"><span class=\"token function\">ssh</span> -p <span class=\"token number\">2222</span> root@192.168.xxx.xxx\n<span class=\"token comment\">#password:123456</span>\n</code></pre>\n<h2><a id=\"_212\"></a>九、网关固件升级</h2>\n<p>点击控制页面顶部菜单栏中的<code>System</code>选项卡-&gt;<code>Firmware Upgrade</code>选项，在该页面中点击<code>Choose File</code>选中固件，点击<code>Upload</code>上传等待自动校检，选择是否需要保存预设，最后点击<code>Proceed</code>开始升级。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9b4d7a99c3ea498fbc9264308c9f897e.jpeg\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d70fbda77260462ba67db0406c1f9f79.jpeg\"/></p>\n<ul><li>配置LoRaWAN服务器等教程，欢迎关注我们查阅。</li></ul>\n<p>联系我们<br/> 以上就是本期分享的内容，目的在于让大家快速适应新品方案的开发，更多资料可从我们官网上获取。</p>\n<p>官方官网：https://www.ai-thinker.com<br/> 开发资料：https://docs.ai-thinker.com/<br/> 官方论坛：http://bbs.ai-thinker.com<br/> 技术支持：support@aithinker.com</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-06 09:32:19", "summary": "文章目录文章目录一、前言二、配置网络连接连接以太网接入连接配置蜂窝网络接入动态静态配置指示灯三、频段配置四、解码功能创建设备五、模式下指令流程六、创建启用七、八、连接九、网关固件升级十、配置服务器一、"}