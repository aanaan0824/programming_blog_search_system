{"blogid": "124245209", "writerAge": "码龄6年", "writerBlogNum": "61", "writerCollect": "242", "writerComment": "76", "writerFan": "311", "writerGrade": "4级", "writerIntegral": "1321", "writerName": "小螺旋丸", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124245209.jpg", "writerRankTotal": "15454", "writerRankWeekly": "166407", "writerThumb": "160", "writerVisitNum": "65984", "blog_read_count": "6708", "blog_time": "于 2022-04-20 08:30:00 发布", "blog_title": "Apache Atlas精讲：由浅入深，从概念，原理，使用，到自定义数据模型，生成血缘关系，带你玩转Atlas", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#_1\">引言</a></li><li><a href=\"#Atlas__7\">Atlas 原理及相关概念</a></li><li><a href=\"#Altas__44\">Altas 使用</a></li><li><a href=\"#Atlas_Rest_Api__53\">Atlas Rest Api 详解及示例</a></li><li><a href=\"#_419\">结语</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"_1\"></a>引言</h1>\n<p>Apache Atlas 是托管于 Apache 旗下的一款元数据管理和治理的产品，目前在大数据领域应用颇为广泛，可以很好的帮助企业管理数据资产，并对这些资产进行分类和治理，为数据分析，数据治理提供高质量的元数据信息。</p>\n<p>随着企业业务量的逐渐膨胀，数据日益增多，不同业务线的数据可能在多种类型的数据库中存储，最终汇集到企业的数据仓库中进行整合分析，这个时候如果想要追踪数据来源，理清数据之间的关系将会是一件异常头疼的事情，倘若某个环节出了问题，追溯的成本将是巨大的，于是 Atlas 在这种背景下应运而生了，通过它，我们可以非常方便的管理元数据，并且可以追溯表级别，列级别之间的关系（血缘关系），为企业的数据资产提供强有力的支撑和保障。Atlas 支持从 HBase 、Hive、Sqoop、Storm、Kafka 中提取和管理元数据，同时也可以通过 Rest Api 的方式自行定义元数据模型，生成元数据。</p>\n<p>本文我们着重介绍一下 Atlas 的相关概念，帮助大家更好的理解 Atlas，同时详细讲解如何通过 Rest Api 的方式自定义数据模型，生成血缘关系，以便开发自己的个性化需求。</p>\n<h1><a id=\"Atlas__7\"></a>Atlas 原理及相关概念</h1>\n<p><strong>元数据</strong></p>\n<p>元数据其实就是描述数据的数据，比如表，字段，视图等，每个业务系统可能都会自己定义表，字段，视图，这些数据从哪来到往哪去，数据之间是否存在关联，和其他系统的数据是否存在重复和矛盾字段，这些就是元数据管理要解决的问题，也是 Atlas 要解决的问题。</p>\n<p><strong>运行原理</strong></p>\n<p>Atlas 的原理其实并不难理解，主要是通过内部提供的脚本读取数仓中的数据库结构，生成数据模型，存储到 Atlas的 Hbase 中，同时通过 hook 的方式监听数仓中的数据变化，分析执行的 sql 语句，从而生成表与表，列与列的血缘关系依赖，在前台展示给用户查看。</p>\n<p><strong>数仓支持</strong></p>\n<p>Atlas 对 Hive 支持最好，我们都知道，Hive 是依赖于 Hadoop 的，数据存储在 HDFS 中，Atlas 有专门的 shell 脚本可以直接运行读取 Hive 的表结构等元数据信息同步到 Atlas 的存储库中，自动生成元数据模型，同时 Atlas 提供的 HiveHook 可以监听 Hive 的数据变化，根据 Hive 执行的 sql 推断出数据与数据之间的关系，生成血缘关系图，如果我们想要分析其他数据存储介质的元数据和血缘关系，Atlas 的支持并不是很理想。但通常情况下，我们会定时把业务库如 mysql，oracle 中的数据定时同步到数仓中整合分析，而数仓我们一般都会采用 Hadoop 的生态体系，所以这一点并不是问题。</p>\n<p><strong>架构图解</strong></p>\n<p>以下是 Atlas 的架构图解，可以看出，Atlas 所依赖的生态体系是异常庞大的，这也直接导致了它部署起来十分繁琐，本文不再讲解 Atlas 的部署，网上相关的教程有很多，感兴趣的朋友可以自己搜索尝试。<br/> <img alt=\"Atlas 架构图解\" src=\"..\\..\\static\\image\\514f9012250f4fc2b97ca0645cd0b0a8.png\"/><br/> <strong>核心组件概念</strong></p>\n<p>Atlas 中主要有以下核心组件，这些需要我们着重了解，接下来我们通过 Rest Api 自定义建模其实就是对以下组件的增删查改操作。</p>\n<p><strong>1. Type</strong></p>\n<p>元数据类型定义，这里可以是数据库，表，列等，还可以细分 mysql 表( mysql_table )，oracle 表( oracle_table )等，atlas自带了很多类型，如 DataSet，Process 等，一般情况下，数据相关的类型在定义类型的时候都会继承 DataSet，而流程相关的类型则会继承 Process，便于生成血缘关系。我们也可以通过调用 api 自定义类型。这是一切的起点，定义完类型之后，才能生成不同类型的元数据实体，生成血缘关系，我个人更喜欢把元数据类型称之为建模。</p>\n<p><strong>2. Classification</strong></p>\n<p>分类，通俗点就是给元数据打标签，分类是可以传递的，比如 A 视图是基于 A 表生成的，那么如果 A 表打上了 a 这个标签，A 视图也会自动打上 a 标签，这样的好处就是便于数据的追踪。</p>\n<p><strong>3. Entity</strong></p>\n<p>实体，表示具体的元数据，Atlas 管理的对象就是各种 Type 的 Entity。</p>\n<p><strong>4. Lineage</strong></p>\n<p>数据血缘，表示数据之间的传递关系，通过 Lineage 我们可以清晰的知道数据的从何而来又流向何处，中间经历了哪些操作，这样一旦数据出现问题，可以迅速追溯，定位是哪个环节出现错误。</p>\n<h1><a id=\"Altas__44\"></a>Altas 使用</h1>\n<p>Altas 成功部署之后，使用还是很简单的，这是登录界面，用户名密码默认是 admin，admin：<br/> <img alt=\"atlas登录\" src=\"..\\..\\static\\image\\c364de2977954dbeab8a4fa6a770ba9e.png\"/><br/> 进入主页，点击右上角 switch to new ，使用新版界面，更直观：<br/> <img alt=\"switch to new\" src=\"..\\..\\static\\image\\159593d74b9a4981a29af1894ca98f2d.png\"/><br/> <img alt=\"主页\" src=\"..\\..\\static\\image\\53989ccf5e5f47d28a3361a312005470.png\"/>页面左侧便是 Atlas 的类型树，点击树节点的某个类型，可以查看下面的实体，这里我们点击 mysql_table：<br/> <img alt=\"mysql_table\" src=\"..\\..\\static\\image\\671da2e7a03c4084b316b54410427afc.png\"/><br/> 可以看到下面有很多表，这些都是我之前自己利用 Rest Api 上传定义的，下面我们来讲解一下如何通过 Rest Api 的方式自定义类型，生成实体，创建血缘关系。</p>\n<h1><a id=\"Atlas_Rest_Api__53\"></a>Atlas Rest Api 详解及示例</h1>\n<p>我们点击主页上方的 Help-》API Documentation，便可以查看 Atlas 所有的开放接口：<br/> <img alt=\"rest api\" src=\"..\\..\\static\\image\\0006cace9d264cd3a40efb23b1be1de2.png\"/><img alt=\"开放接口\" src=\"..\\..\\static\\image\\687bb592848a4e2d9cbaad79ddb5afc0.png\"/><br/> 有一点我们需要注意，Atlas 的接口在使用的时候是需要鉴权的，所以我们构建 http 请求的时候需要带上用户名和密码认证信息，本次示例中我们使用 atlas-client-v2 开源组件来进行 Atlas 的 api 调用。</p>\n<p>本次示例我们定义一个 my_db 类型，my_table 类型，并且让 my_db 一对多 my_table，然后创建 test_db 实体到 my_db 下，创建 test_table_source 和 test_table_target 实体到 my_table 下，并且定义 test_table_target 的数据来自 test_table_source，生成两个实体的血缘关系依赖。</p>\n<p><strong>自定义 my_db 和 my_table 类型</strong></p>\n<p>我们对 my_db 和 my_table 类型进行定义，在 Atlas 的Rest Api 中，允许一个请求定义多种类型，在这里我们先构建 json 请求体，然后再通过编码方式实现，二者对比，更容易理解，json 请求体如下（关键地方有注释）：</p>\n<pre><code class=\"prism language-json\"><span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token string-property property\">\"enumDefs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"structDefs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"classificationDefs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">//类型定义</span>\n  <span class=\"token string-property property\">\"entityDefs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">//数据类型的定义，约定俗成，继承Atlas自带的DataSet</span>\n      <span class=\"token string-property property\">\"superTypes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"DataSet\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">//服务类型（便于在界面分组显示类型）</span>\n      <span class=\"token string-property property\">\"serviceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_type\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"typeVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.1\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"attributeDefs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"superTypes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"DataSet\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"serviceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_type\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"typeVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.1\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"attributeDefs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">//定义类型之间的关系</span>\n  <span class=\"token string-property property\">\"relationshipDefs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_table_db\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"serviceType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_type\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">\"typeVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.1\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">//关系类型：ASSOCIATION：关联关系，没有容器存在，1对1 </span>\n      <span class=\"token comment\">//AGGREGATION：容器关系，1对多，而且彼此可以相互独立存在 </span>\n      <span class=\"token comment\">//COMPOSITION：容器关系，1对多，但是容器中的实例不能脱离容器存在</span>\n      <span class=\"token string-property property\">\"relationshipCategory\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AGGREGATION\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">//节点一</span>\n      <span class=\"token string-property property\">\"endDef1\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">//表中关联的属性名称，对应下面的 my_db</span>\n        <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"db\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">//代表这头是不是容器</span>\n        <span class=\"token string-property property\">\"isContainer\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">//cardinality： 三种类型SINGLE, LIST, SET</span>\n        <span class=\"token string-property property\">\"cardinality\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"SINGLE\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 节点2</span>\n      <span class=\"token string-property property\">\"endDef2\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token string-property property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tables\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string-property property\">\"isContainer\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// db 包含 table，table不能重复，所以类型设置为 SET</span>\n        <span class=\"token string-property property\">\"cardinality\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"SET\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 推导tag NONE 不推导</span>\n      <span class=\"token string-property property\">\"propagateTags\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NONE\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>编码实现：</p>\n<p>引入 pom 依赖，注意，如果要集成到自己的业务系统之中，业务系统如果使用了其他的日志框架，需要去除 slf4j-log4j12 依赖，否则日志框架会起冲突，导致启动失败，另外 atlas-client-common 中依赖了 commons-configuration 1.10，如果业务系统中有低版本依赖，记得排除，不然二者会冲突，导致 client 初始化失败。</p>\n<pre><code class=\"prism language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token comment\">&lt;!-- Apache Atlas --&gt;</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.apache.atlas<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>atlas-client-common<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>2.1.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusions</span><span class=\"token punctuation\">&gt;</span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusion</span><span class=\"token punctuation\">&gt;</span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>slf4j-log4j12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.slf4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusion</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusions</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token comment\">&lt;!-- Apache Atlas Client  Version2 --&gt;</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.apache.atlas<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>atlas-client-v2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>2.1.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusions</span><span class=\"token punctuation\">&gt;</span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusion</span><span class=\"token punctuation\">&gt;</span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>slf4j-log4j12<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.slf4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusion</span><span class=\"token punctuation\">&gt;</span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>exclusion</span><span class=\"token punctuation\">&gt;</span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>log4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>log4j<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusion</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>exclusions</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>com.alibaba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>fastjson<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">&gt;</span></span>${fastjson.version}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">&gt;</span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<p>引入 atlas-application.properties（必须得有，否则会初始化失败）：</p>\n<pre><code class=\"prism language-xml\">atlas.rest.address=http://127.0.0.1:21000\n</code></pre>\n<p>代码实现如下（对照json非常容易理解）：</p>\n<pre><code class=\"prism language-java\">\t\t<span class=\"token class-name\">AtlasClientV2</span> atlasClientV2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasClientV2</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"http://127.0.0.1:21000\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//父类集合</span>\n\t\t<span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> superTypes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tsuperTypes<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasBaseTypeDef</span><span class=\"token punctuation\">.</span>ATLAS_TYPE_DATASET<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//定义myType</span>\n\t\t<span class=\"token class-name\">AtlasTypesDef</span> myType <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasTypesDef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//定义myDb</span>\n\t\t<span class=\"token class-name\">AtlasEntityDef</span> myDb <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntityDef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyDb<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyDb<span class=\"token punctuation\">.</span><span class=\"token function\">setServiceType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyDb<span class=\"token punctuation\">.</span><span class=\"token function\">setSuperTypes</span><span class=\"token punctuation\">(</span>superTypes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyDb<span class=\"token punctuation\">.</span><span class=\"token function\">setTypeVersion</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//定义mytable</span>\n\t\t<span class=\"token class-name\">AtlasEntityDef</span> myTable <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntityDef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyTable<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyTable<span class=\"token punctuation\">.</span><span class=\"token function\">setServiceType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyTable<span class=\"token punctuation\">.</span><span class=\"token function\">setSuperTypes</span><span class=\"token punctuation\">(</span>superTypes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyTable<span class=\"token punctuation\">.</span><span class=\"token function\">setTypeVersion</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//定义relationshipDef</span>\n\t\t<span class=\"token class-name\">AtlasRelationshipDef</span> relationshipDef <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasRelationshipDef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationshipDef<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_table_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationshipDef<span class=\"token punctuation\">.</span><span class=\"token function\">setServiceType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationshipDef<span class=\"token punctuation\">.</span><span class=\"token function\">setTypeVersion</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1.1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationshipDef<span class=\"token punctuation\">.</span><span class=\"token function\">setRelationshipCategory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasRelationshipDef<span class=\"token punctuation\">.</span>RelationshipCategory</span><span class=\"token punctuation\">.</span>AGGREGATION<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationshipDef<span class=\"token punctuation\">.</span><span class=\"token function\">setPropagateTags</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasRelationshipDef<span class=\"token punctuation\">.</span>PropagateTags</span><span class=\"token punctuation\">.</span>NONE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//定义endDef1</span>\n\t\t<span class=\"token class-name\">AtlasRelationshipEndDef</span> endDef1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasRelationshipEndDef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tendDef1<span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tendDef1<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tendDef1<span class=\"token punctuation\">.</span><span class=\"token function\">setIsContainer</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tendDef1<span class=\"token punctuation\">.</span><span class=\"token function\">setCardinality</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasStructDef<span class=\"token punctuation\">.</span>AtlasAttributeDef<span class=\"token punctuation\">.</span>Cardinality</span><span class=\"token punctuation\">.</span>SINGLE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationshipDef<span class=\"token punctuation\">.</span><span class=\"token function\">setEndDef1</span><span class=\"token punctuation\">(</span>endDef1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//定义endDef2</span>\n\t\t<span class=\"token class-name\">AtlasRelationshipEndDef</span> endDef2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasRelationshipEndDef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tendDef2<span class=\"token punctuation\">.</span><span class=\"token function\">setType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tendDef2<span class=\"token punctuation\">.</span><span class=\"token function\">setName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tables\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tendDef2<span class=\"token punctuation\">.</span><span class=\"token function\">setIsContainer</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tendDef2<span class=\"token punctuation\">.</span><span class=\"token function\">setCardinality</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasStructDef<span class=\"token punctuation\">.</span>AtlasAttributeDef<span class=\"token punctuation\">.</span>Cardinality</span><span class=\"token punctuation\">.</span>SET<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationshipDef<span class=\"token punctuation\">.</span><span class=\"token function\">setEndDef2</span><span class=\"token punctuation\">(</span>endDef2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//entityDefs</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AtlasEntityDef</span><span class=\"token punctuation\">&gt;</span></span> entityDefs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tentityDefs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>myDb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tentityDefs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>myTable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyType<span class=\"token punctuation\">.</span><span class=\"token function\">setEntityDefs</span><span class=\"token punctuation\">(</span>entityDefs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//relationshipDefs</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AtlasRelationshipDef</span><span class=\"token punctuation\">&gt;</span></span> relationshipDefs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationshipDefs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>relationshipDef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmyType<span class=\"token punctuation\">.</span><span class=\"token function\">setRelationshipDefs</span><span class=\"token punctuation\">(</span>relationshipDefs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//查询是否已有my_db类型,没有则创建</span>\n\t\t<span class=\"token class-name\">SearchFilter</span> filter <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SearchFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tfilter<span class=\"token punctuation\">.</span><span class=\"token function\">setParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">AtlasTypesDef</span> allTypeDefs <span class=\"token operator\">=</span> atlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">getAllTypeDefs</span><span class=\"token punctuation\">(</span>filter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>allTypeDefs<span class=\"token punctuation\">.</span><span class=\"token function\">getEntityDefs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token comment\">//请求 rest api</span>\n\t\t\tatlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">createAtlasTypeDefs</span><span class=\"token punctuation\">(</span>myType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>执行以上代码，执行完毕后，前往 Atlas 主页查看，类型已成功创建：<br/> <img alt=\"类型\" src=\"..\\..\\static\\image\\ca91c67469264772b4cdabb2598e85b9.png\"/><br/> 查看类型模型图：<br/> <img alt=\"模型图\" src=\"..\\..\\static\\image\\6e35202e948d4fa29e4baf2c59b5b477.png\"/><br/> 类型创建完毕，接下来我们进行实体的创建。</p>\n<p><strong>创建实体 test_db，test_table_source 和 test_table_target</strong></p>\n<p>json 如下：</p>\n<pre><code class=\"prism language-json\"><span class=\"token comment\">//my_db 实体</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token string-property property\">\"typeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string-property property\">\"attributes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token string-property property\">\"qualifiedName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_db\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_db\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"测试创建db\"</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">//test_table_source 实体</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token string-property property\">\"typeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string-property property\">\"attributes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token string-property property\">\"qualifiedName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_table_source\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_table_source\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"测试创建test_table_source\"</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string-property property\">\"relationshipAttributes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token string-property property\">\"db\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token string-property property\">\"typeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token comment\">//my_db的guid（创建完my_db后会返回）</span>\n\t\t\t<span class=\"token string-property property\">\"guid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"xxxx\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">//test_table_target 实体</span>\n<span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token string-property property\">\"typeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string-property property\">\"attributes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token string-property property\">\"qualifiedName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_table_target\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_table_target\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"测试创建test_table_target\"</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string-property property\">\"relationshipAttributes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token string-property property\">\"db\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token string-property property\">\"typeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token string-property property\">\"guid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"xxx\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>代码实现如下：</p>\n<pre><code class=\"prism language-java\">\t\t<span class=\"token comment\">//创建实体 test_db</span>\n\t\t<span class=\"token class-name\">AtlasEntity</span> testDb <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttestDb<span class=\"token punctuation\">.</span><span class=\"token function\">setTypeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> attributes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qualifiedName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"description\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"测试创建db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttestDb<span class=\"token punctuation\">.</span><span class=\"token function\">setAttributes</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> queryAttributes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tqueryAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qualifiedName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">String</span> myDbGuid <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token comment\">//查询不到会报错</span>\n\t\t\t<span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span> extInfo <span class=\"token operator\">=</span> atlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">getEntityByAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">,</span> queryAttributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tmyDbGuid <span class=\"token operator\">=</span> extInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getGuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasServiceException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientResponse<span class=\"token punctuation\">.</span>Status</span><span class=\"token punctuation\">.</span>NOT_FOUND<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span> extInfo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span><span class=\"token punctuation\">(</span>testDb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token comment\">//请求</span>\n\t\t\t\t<span class=\"token class-name\">EntityMutationResponse</span> response <span class=\"token operator\">=</span> atlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">createEntity</span><span class=\"token punctuation\">(</span>extInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tmyDbGuid <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getGuidAssignments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token comment\">//创建与db的关系</span>\n\t\t<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">&gt;</span></span> relationShipAttr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> dbMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tdbMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"guid\"</span><span class=\"token punctuation\">,</span> myDbGuid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tdbMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"typeName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"my_db\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\trelationShipAttr<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"db\"</span><span class=\"token punctuation\">,</span> dbMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//创建实体 test_table_source</span>\n\t\t<span class=\"token class-name\">AtlasEntity</span> testTableSource <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttestTableSource<span class=\"token punctuation\">.</span><span class=\"token function\">setTypeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qualifiedName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_table_source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_table_source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"description\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"测试创建test_table_source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttestTableSource<span class=\"token punctuation\">.</span><span class=\"token function\">setAttributes</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttestTableSource<span class=\"token punctuation\">.</span><span class=\"token function\">setRelationshipAttributes</span><span class=\"token punctuation\">(</span>relationShipAttr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tqueryAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qualifiedName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_table_source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token comment\">//atlasClientV2.updateEntity(new AtlasEntity.AtlasEntityWithExtInfo(testTableSource));</span>\n\t\t\t<span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span> extInfo <span class=\"token operator\">=</span> atlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">getEntityByAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">,</span> queryAttributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\ttestTableSource <span class=\"token operator\">=</span> extInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasServiceException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientResponse<span class=\"token punctuation\">.</span>Status</span><span class=\"token punctuation\">.</span>NOT_FOUND<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span> extInfo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span><span class=\"token punctuation\">(</span>testTableSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token comment\">//请求</span>\n\t\t\t\t<span class=\"token class-name\">EntityMutationResponse</span> response <span class=\"token operator\">=</span> atlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">createEntity</span><span class=\"token punctuation\">(</span>extInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\ttestTableSource<span class=\"token punctuation\">.</span><span class=\"token function\">setGuid</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">getGuidAssignments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token comment\">//创建实体 test_table_target</span>\n\t\t<span class=\"token class-name\">AtlasEntity</span> testTableTarget <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttestTableTarget<span class=\"token punctuation\">.</span><span class=\"token function\">setTypeName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qualifiedName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_table_target\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_table_target\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"description\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"测试创建test_table_target\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttestTableTarget<span class=\"token punctuation\">.</span><span class=\"token function\">setAttributes</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\ttestTableTarget<span class=\"token punctuation\">.</span><span class=\"token function\">setRelationshipAttributes</span><span class=\"token punctuation\">(</span>relationShipAttr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tqueryAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qualifiedName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_table_target\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token comment\">//atlasClientV2.updateEntity(new AtlasEntity.AtlasEntityWithExtInfo(testTableTarget));</span>\n\t\t\t<span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span> extInfo <span class=\"token operator\">=</span> atlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">getEntityByAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">,</span> queryAttributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\ttestTableTarget <span class=\"token operator\">=</span> extInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasServiceException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientResponse<span class=\"token punctuation\">.</span>Status</span><span class=\"token punctuation\">.</span>NOT_FOUND<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span> extInfo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span><span class=\"token punctuation\">(</span>testTableTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token comment\">//请求</span>\n\t\t\t\t<span class=\"token class-name\">EntityMutationResponse</span> response <span class=\"token operator\">=</span> atlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">createEntity</span><span class=\"token punctuation\">(</span>extInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\ttestTableTarget<span class=\"token punctuation\">.</span><span class=\"token function\">setGuid</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">getGuidAssignments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>执行代码完毕后，查看类的树形图，发现已经产生了实体：<br/> <img alt=\"实体\" src=\"..\\..\\static\\image\\7bd928c717774144bba4683e7ac73d67.png\"/><br/> 我们点击右侧的 test_db 实体，可以看到它的基本信息，也可以看到它的 relationship 信息，包含了 test_table_source 和 test_table_target 两个实体：<br/> <img alt=\"基础信息\" src=\"..\\..\\static\\image\\5336db743f8443e193842cc0b5fd9314.png\"/><br/> 查看 relationship 信息，包含 test_table_source 和 test_table_target：<br/> <img alt=\"relationship \" src=\"..\\..\\static\\image\\63e92211fef34af2b27000302c1cac95.png\"/><br/> <strong>创建 test_table_source 和 test_table_target 的血缘关系依赖</strong></p>\n<p>前面我们提到，定义 test_table_target 的数据来自 test_table_source，血缘关系依赖在 Atlas 中其实也是作为实体 Entity 存在，只不过继承的父类是 Process，这样可以定义 inputs 和 outputs 属性，构建血缘关系，json 如下：</p>\n<pre><code class=\"prism language-json\"><span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token string-property property\">\"typeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Process\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token string-property property\">\"attributes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token string-property property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_process\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"qualifiedName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_process\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"test_table_target 的数据来自 test_table_source\"</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"inputs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token string-property property\">\"typeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token comment\">//test_table_source的guid，创建实体从返回的信息中获取</span>\n\t\t\t<span class=\"token string-property property\">\"guid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"xxx\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token string-property property\">\"outputs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token string-property property\">\"typeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my_table\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token comment\">test_table_target的guid，创建实体从返回的信息中获取</span>\n\t\t\t<span class=\"token string-property property\">\"guid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"xxx\"</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>代码实现如下：</p>\n<pre><code class=\"prism language-java\">\t\t<span class=\"token class-name\">AtlasEntity</span> lineage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//设置为process类型构建血缘</span>\n\t\tlineage<span class=\"token punctuation\">.</span><span class=\"token function\">setTypeName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasBaseTypeDef</span><span class=\"token punctuation\">.</span>ATLAS_TYPE_PROCESS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qualifiedName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_process\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_process\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"description\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_table_target 的数据来自 test_table_source\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"inputs\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getLineAgeInfo</span><span class=\"token punctuation\">(</span>testTableSource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tattributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"outputs\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getLineAgeInfo</span><span class=\"token punctuation\">(</span>testTableTarget<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tlineage<span class=\"token punctuation\">.</span><span class=\"token function\">setAttributes</span><span class=\"token punctuation\">(</span>attributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tqueryAttributes<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qualifiedName\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test_process\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SingletonObject</span><span class=\"token punctuation\">.</span>OBJECT_MAPPER<span class=\"token punctuation\">.</span><span class=\"token function\">writeValueAsString</span><span class=\"token punctuation\">(</span>lineage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token comment\">//查询是否存在</span>\n\t\t\tatlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">getEntityByAttribute</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasBaseTypeDef</span><span class=\"token punctuation\">.</span>ATLAS_TYPE_PROCESS<span class=\"token punctuation\">,</span> queryAttributes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasServiceException</span> e<span class=\"token punctuation\">)</span>  <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ClientResponse<span class=\"token punctuation\">.</span>Status</span><span class=\"token punctuation\">.</span>NOT_FOUND<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token comment\">//创建</span>\n\t\t\t\t<span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span> extInfo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AtlasEntity<span class=\"token punctuation\">.</span>AtlasEntityWithExtInfo</span><span class=\"token punctuation\">(</span>lineage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tatlasClientV2<span class=\"token punctuation\">.</span><span class=\"token function\">createEntity</span><span class=\"token punctuation\">(</span>extInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t\n\t<span class=\"token comment\">//构建inputs和outputs</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Map</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">getLineAgeInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AtlasEntity</span> entity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Map</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"guid\"</span><span class=\"token punctuation\">,</span> entity<span class=\"token punctuation\">.</span><span class=\"token function\">getGuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tmap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"typeName\"</span><span class=\"token punctuation\">,</span> entity<span class=\"token punctuation\">.</span><span class=\"token function\">getTypeName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tlist<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> list<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>执行以上代码，然后打开主页，点击 my_table 中的 test_table_source，查看 lineage 标签，血缘关系已成功构建：<br/> <img alt=\"血缘关系\" src=\"..\\..\\static\\image\\2723a0b6073241529300c2a454fe47a9.png\"/><br/> 至此，我们通过 Atlas Rest Api 的方式自行建模，创建实体，构建血缘关系就完成了。</p>\n<h1><a id=\"_419\"></a>结语</h1>\n<p>通过此文，我们可以由浅入深，理解 Atlas 的概念和原理，同时也可以掌握 Atlas 的 Rest Api，日后如果有二次开发的需求，可以为此奠定良好的基础，我所在的公司就是基于 Atlas 搭建了自己的数据中台，UI 界面也都是自己重新实现的，比原生的界面好看很多，并且实现了自己的许多个性化需求。</p>\n<p>网上 Atlas 的教程相对较少，特别是 Rest Api 这块很是缺乏，所以特地写了这篇文章。元数据管理，数据治理，在当下仍然是一个热门的话题，同时，它也可以帮助我们更好的支撑企业的数据资产，更好的分析数据，为企业的发展决策提供有效的帮助。</p>\n<p>希望本文能对你有所感悟，有所启发，我们下次更新，再见！</p>\n<p><em><strong>关注公众号<code>螺旋编程极客</code> 获取最新干货推送，感兴趣的朋友也可以在公众号下方菜单<code>进群交流</code>，期待你的关注！</strong></em></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "SQL", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 1, "sql": 1, "php": 0, "time": "2022-04-20 08:30:00", "summary": "文章目录引言原理及相关概念使用详解及示例结语引言是托管于旗下的一款元数据管理和治理的产品，目前在大数据领域应用颇为广泛，可以很好的帮助企业管理数据资产，并对这些资产进行分类和治理，为数据分析，数据治理"}