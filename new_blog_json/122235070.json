{"blogid": "122235070", "writerAge": "码龄3年", "writerBlogNum": "107", "writerCollect": "682", "writerComment": "269", "writerFan": "1517", "writerGrade": "5级", "writerIntegral": "3140", "writerName": "yu22x", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_122235070.jpg", "writerRankTotal": "8345", "writerRankWeekly": "12134", "writerThumb": "446", "writerVisitNum": "242000", "blog_read_count": "1526", "blog_time": "已于 2022-04-13 09:46:40 修改", "blog_title": "eyoucms 1.5.5任意命令执行漏洞(0day)", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"eyoucms_155_0\"></a>eyoucms 1.5.5任意命令执行漏洞</h1>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#eyoucms_155_0\">eyoucms 1.5.5任意命令执行漏洞</a></li><li><ul><li><a href=\"#_2\">一、漏洞简介</a></li><li><a href=\"#_4\">二、漏洞影响</a></li><li><a href=\"#_6\">三、复现过程</a></li><li><ul><li><a href=\"#_7\">漏洞位置</a></li><li><a href=\"#_10\">漏洞分析</a></li><li><a href=\"#_24\">漏洞利用</a></li></ul>\n</li></ul>\n</li></ul>\n</div>\n<p></p>\n<h2><a id=\"_2\"></a>一、漏洞简介</h2>\n<p>eyoucms1.5.5后台存在任意命令执行漏洞。</p>\n<h2><a id=\"_4\"></a>二、漏洞影响</h2>\n<p>eyoucms1.5.5</p>\n<h2><a id=\"_6\"></a>三、复现过程</h2>\n<h3><a id=\"_7\"></a>漏洞位置</h3>\n<p>application\\admin\\logic\\FilemanagerLogic.php editFile函数。<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\7e505883f61a4a9588bb35d8eddfe08f.png\"/></p>\n<h3><a id=\"_10\"></a>漏洞分析</h3>\n<p>当我们在模板管理功能的页面中传入php代码时会被解析。但是存在过滤，过滤如下：</p>\n<pre><code class=\"prism language-php\"><span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">htmlspecialchars_decode</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$content</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">ENT_QUOTES</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'#&lt;([^?]*)\\?php#i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'#&lt;\\?#i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'#\\?&gt;#i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token class-name\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'#\\{eyou\\:php([^\\}]*)\\}#i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token class-name\">preg_match</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'#\\{php([^\\}]*)\\}#i'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">return</span> <span class=\"token string double-quoted-string\">\"模板里不允许有php语法，为了安全考虑，请通过FTP工具进行编辑上传。\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>很明显主要的目的是不让传带php标签的内容，大体规则如下。<br/> 1、内容中不能有<code>&lt;?php</code><br/> 2、内容中不能同时有<code>&lt;? </code>和<code>?&gt;</code><br/> 3、内容中不能有<code>{eyou:phpxxx</code><br/> 4、内容中不能有<code>{php xxx</code><br/> 我们可以发现第二条存在一个隐患，即我们可以传入<code>&lt;?=要执行的代码;</code>来绕过，比如<code>&lt;?=exec('whoami');</code>，但是我们没有闭合的话后面的html内容可能会被当成php代码，所以需要把我们要用的代码放到最后即。</p>\n<h3><a id=\"_24\"></a>漏洞利用</h3>\n<p>1、登录后台修改template/pc/index.htm模板<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\790d57f1a8c74e5e8583de28d911db3f.png\"/></p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\441e3e7628a74d1eac5c9483872bfd7b.png\"/></p>\n<p>2、访问前台首页，成功得到回显信息。<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\f4dc3fac56d34b408b898879f5fd6c8d.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-04-13 09:46:40", "summary": "任意命令执行漏洞文章目录任意命令执行漏洞一、漏洞简介二、漏洞影响三、复现过程漏洞位置漏洞分析漏洞利用一、漏洞简介后台存在任意命令执行漏洞。二、漏洞影响三、复现过程漏洞位置函数。在这里插入图片描述漏洞分"}