{"blogid": "126085194", "writerAge": "码龄2年", "writerBlogNum": "589", "writerCollect": "3064", "writerComment": "4239", "writerFan": "15488", "writerGrade": "7级", "writerIntegral": "14060", "writerName": "KJ.JK", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126085194.jpg", "writerRankTotal": "743", "writerRankWeekly": "10", "writerThumb": "2812", "writerVisitNum": "474767", "blog_read_count": "12647", "blog_time": "已于 2022-08-29 10:05:18 修改", "blog_title": "Java版本新零售小程序saas商城全开源系统", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><ul><li><a href=\"#_21\">一、项目介绍</a></li><li><a href=\"#_27\">二、技术栈以及项目特点</a></li><li><a href=\"#_51\">三、系统设计</a></li><li><a href=\"#_104\">四、系统功能演示</a></li><li><ul><li><a href=\"#_108\">🚩店铺功能演示图</a></li><li><a href=\"#_135\">🚩商品功能演示图</a></li><li><a href=\"#_158\">🚩订单功能演示图</a></li><li><a href=\"#_182\">🚩客户功能演示图</a></li><li><a href=\"#_197\">🚩数据功能演示图</a></li><li><a href=\"#_216\">🚩营销功能演示图</a></li><li><a href=\"#_224\">🚩设置功能演示图</a></li></ul>\n</li><li><a href=\"#_249\">五、系统源代码</a></li></ul>\n</li><li><a href=\"#KJJK_914\">作者：KJ.JK</a></li></ul>\n</div>\n<p></p>\n<hr/>\n<blockquote>\n<p>🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈<br/>  <br/> <strong>🍂个人博客首页：</strong> <a href=\"https://blog.csdn.net/m0_47384542?type=blog\">KJ.JK</a><br/>  <br/> <strong>欢迎大家点赞👍收藏💖评论💬关注🔒</strong><br/>  <br/> <strong>💖源码获取 | 💻学习交流 | 🤝商务合作 | 💨私信作者</strong></p>\n</blockquote>\n<hr/>\n<h2><a id=\"_21\"></a>一、项目介绍</h2>\n<blockquote>\n<p>今天为大家带来的是<code>weiit-saas这款Java开源项目</code>，属于weiit团队自研产品，<code>该系统意在通过技术封装，让企业无需代码开发，帮助企业一键生成小程序、公众号，让企业拥有独立品牌的自营商城</code>，<code>weiit-saas是完全开源电商SaaS系统，属于weiit开源的社区版</code>，旧版已不在维护和更新，仅供学习和参考，<code>新版saas从底层架构到前后端UI设计已经全面优化和升级</code>，<code>新版访问地址👉</code> <a href=\"https://www.wei-it.com/\">weiit</a><br/> 该团队的后续作品博主将会为大家不断分享，也希望大家多多支持博主以及<code>weiit团队</code>！！！</p>\n</blockquote>\n<hr/>\n<h2><a id=\"_27\"></a>二、技术栈以及项目特点</h2>\n<hr/>\n<blockquote>\n<p><strong>⭐新版saas技术栈使用⭐</strong></p>\n<ul><li><code>SpringCloud + Oauth2.0 + ShiroRedis + JWT + Gateway + Nacos + Nginx + Vue </code><br/>  </li></ul>\n<p><strong>⭐项目特点⭐</strong></p>\n<ul><li>项目采用<code>Spring+SpringMVC+Mybatis主流开源框架</code>，遵循MVC架构，设计轻巧，使用简单，开发人员接手与二次开发简单易懂；</li><li>项目完成了对<code>阿里云、腾讯云、微信生态的快速接入与代码示例</code>，并成功运用到了商业中，方便大家学习对<code>OSS/COS/短信服务/快递服务/公众号/小程序/微信开放平台/微信支付的技术点与应用场景的学习</code>；</li><li>小程序与公众号第三方授权集成，让开发者与企业省去繁琐的配置，<code>对AppId/AppSecret集成彻底告别</code>；</li><li><code>微信支付第三方授权集成</code>，让开发者与企业省去繁琐的配置，让企业服务成本大大降低；</li><li><code>小程序代码自动push与升级，公众号基本常规功能（自定义菜单、图文、素材，群发）全部接管，让企业无需登录微信官方入口，统一化管理企业信息与数据</code>；</li><li>微信消息通知与模板自动同步与管理，让企业场景融合无障碍；</li><li><code>自定义装修功能</code>，实现企业电商场景多元化，解决不同行业不同模板，让企业需求得到真正解决；</li><li>丰富的营销工具，解决企业微营销需求，并集中化管理。拼团活动、积分活动、砍价，优惠券，卡券，礼品卡，邀请有礼等营销活动，方便二次开发；</li><li><code>不同企业数据隔离，真正实现SAAS数据隔离模型，让企业数据互不干扰</code></li><li>不同企业不同域名自动分配，让企业小程序、公众号前端隔离，避免因为公众号或者小程序推广时导致域名被检测导致的封号问题出现，即不同企业不同域，意在防止saas平台中的企业受到其他企业的影响</li></ul>\n</blockquote>\n<hr/>\n<h2><a id=\"_51\"></a>三、系统设计</h2>\n<hr/>\n<blockquote>\n<p><strong>SAAS微信小程序电商系统系统的主要功能模块包括 <code>概况模块，店铺管理模块，商品模块，订单管理模块，客户管理模块，数据模块，营销模块，设置模块</code></strong></p>\n</blockquote>\n<hr/>\n<p>          <strong>（1）概况模块：</strong> 可以看到具体各个功能的具体信息</p>\n<hr/>\n<p>          <strong>（2）商品模块：</strong> 该模块包含<code>微页面，全店风格，底部菜单，底部导航</code></p>\n<hr/>\n<p>          <strong>（3）店铺模块：</strong> 该模块包含<code>出售中的商品、库存紧张商品、仓库商品、商品标签、商品分组、商品导入</code></p>\n<hr/>\n<p>          <strong>（4）订单管理模块：</strong> 该模块包含<code>所有订单、维权订单、加星订单、订单设置</code></p>\n<hr/>\n<p>          <strong>（5）客户模块：</strong> 该模块包含<code>会员管理、会员卡管理、标签组管理、会员提现、会员设置</code></p>\n<hr/>\n<p>          <strong>（6）数据模块：</strong> 该模块包含<code>综合统计、店铺的概况、订单的概况、客户的分析</code></p>\n<hr/>\n<p>          <strong>（7）营销模块：</strong> 该模块包含<code>常规营销、人口设置</code></p>\n<hr/>\n<p>          <strong>（8）设置模块：</strong> 该模块包含<code>店铺设置、服务协议、支付交易、物流配送、修改密码</code></p>\n<hr/>\n<p>          <strong>（9）系统架构图</strong></p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a516f726e92641a4bd60fd6d09bd3526.png\"/></p>\n<hr/>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\2e5ba539c9384075a3e4199db27fec5f.png\"/></p>\n<hr/>\n<h2><a id=\"_104\"></a>四、系统功能演示</h2>\n<hr/>\n<h3><a id=\"_108\"></a>🚩店铺功能演示图</h3>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\fb287a74156c41e9b44a1986f48bf3b6.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\20a99716013c4c47983178c6cc2e1335.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\d4e22e97080040f98ec8ede6f8a56ee0.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\0b00051a2a9240cc89cd03907d8d6133.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\f9b96836aebf43e283d2198bbea7baf1.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\6f30f024287d482b91401fea29ee40cb.png\"/></p>\n<hr/>\n<h3><a id=\"_135\"></a>🚩商品功能演示图</h3>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\9d9d8cb6ffd242d5a1479d71f56591a9.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\a87e5aef1f03432f955bb44ae6bdb906.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\4389bc9ab4ab40ddab0aeaa98d2537a5.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\dc0d478dcd7d435d8afc4559e7119e9a.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\68fd90d7e3e34aa79d605f3354f28b16.png\"/></p>\n<hr/>\n<h3><a id=\"_158\"></a>🚩订单功能演示图</h3>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\fbdde3dbabb44cb58b375a55169d1e28.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\8037d42da7b04f678e5701ebb205fcd7.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\5752241de47c46f1b91e7563f88d4e94.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\f9da5b954a8d4d9095fc56f29328adce.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\734ec625de5d4fceaf452713de59835e.png\"/></p>\n<hr/>\n<h3><a id=\"_182\"></a>🚩客户功能演示图</h3>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\86df48863b464adb8633e3c20243ee6c.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\e0a9d7db289d4a75bf083b76d8e73f2a.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\bab690a550574e64acfbd03d4ba9c0b6.png\"/></p>\n<hr/>\n<h3><a id=\"_197\"></a>🚩数据功能演示图</h3>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\84cb999351e445cc9695e660badd166a.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\713b10856ff74afa95a9a4dadda9be88.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\5fc33356730e44e5a5b86283e70aaccb.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\ebe48d596b944e5f813a81471d75114b.png\"/></p>\n<hr/>\n<h3><a id=\"_216\"></a>🚩营销功能演示图</h3>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\6d64f27dd3de49d89e4b3bc79c730852.png\"/></p>\n<hr/>\n<h3><a id=\"_224\"></a>🚩设置功能演示图</h3>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\dc61039de89c4f51a9094c8cb504a4b9.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\474180dfa87a40c492f4b53042ad392a.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\fac48d3040ac40bdbf0887fb5eebeb47.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\e19223654199443c8f2c66b27859d3be.png\"/></p>\n<hr/>\n<p><img alt=\"请添加图片描述\" src=\"..\\..\\static\\image\\8a9d7f3277384421b62da92dc2e88d1a.png\"/></p>\n<hr/>\n<h2><a id=\"_249\"></a>五、系统源代码</h2>\n<pre><code class=\"prism language-java\"><span class=\"token comment\">/**\n * 砍价 活动\n * @company http://www.wei-it.com\n */</span>\n<span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/ump/bargain\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BargainController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AdminController</span> <span class=\"token punctuation\">{<!-- --></span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> logger <span class=\"token operator\">=</span> <span class=\"token class-name\">Logger</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BargainController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Resource</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">BargainService</span> bargainService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Resource</span>\n    <span class=\"token class-name\">ProductService</span> productService<span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token comment\">/**\n     * 砍价活动 列表\n     */</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bargainList\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">bargainList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入 bargainController-list,砍价活动列表\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//获取请求参数</span>\n        <span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//开启分页</span>\n        <span class=\"token class-name\">PageHelper</span><span class=\"token punctuation\">.</span><span class=\"token function\">startPage</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//查询展示数量</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//返回到list页面</span>\n        <span class=\"token class-name\">UIview</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/bargain/bargainList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//绑定分页返回</span>\n        result<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pageInfo\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageInfo</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//绑定上一次参数</span>\n        result<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queryParam\"</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 砍价活动 新增\n     */</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/add\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n\n        <span class=\"token class-name\">UIview</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/bargain/bargainCreate\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"砍价活动新增\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n\n    <span class=\"token comment\">/**\n     * 砍价活动 编辑\n     */</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/edit\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">edit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n\n        <span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">E</span> infoMap <span class=\"token operator\">=</span> bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">selectOne</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_id\"</span><span class=\"token punctuation\">,</span>infoMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">E</span> itemInfo <span class=\"token operator\">=</span> productService<span class=\"token punctuation\">.</span><span class=\"token function\">getItemById</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n        <span class=\"token class-name\">String</span> specString <span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>itemInfo<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> itemInfo<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spec_custom\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n            formMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"specIds\"</span><span class=\"token punctuation\">,</span> itemInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spec_custom\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> specList <span class=\"token operator\">=</span> productService<span class=\"token punctuation\">.</span><span class=\"token function\">getSpecCustomByIds</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span> spec <span class=\"token operator\">:</span>specList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n                specString<span class=\"token operator\">+=</span>spec<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key_name\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        specString<span class=\"token operator\">=</span>specString<span class=\"token operator\">==</span><span class=\"token string\">\"\"</span><span class=\"token operator\">?</span>infoMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_name\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>specString<span class=\"token punctuation\">;</span>\n\n        infoMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"skuName\"</span><span class=\"token punctuation\">,</span>specString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">UIview</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/bargain/bargainCreate\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"infoMap\"</span><span class=\"token punctuation\">,</span> infoMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"砍价活动编辑\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 砍价活动 保存\n     */</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n\n        <span class=\"token class-name\">FormMap</span> param <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"validate_id\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> param<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"validate_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\n            <span class=\"token comment\">//根据生效时间判断是否现在生效</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&gt;</span> <span class=\"token class-name\">DateUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTimeByString</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start_time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"yyyy/MM/dd HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n                param<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token comment\">//未开始状态</span>\n                param<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n            param<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"eivt\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">//失效后再编辑</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&gt;</span> <span class=\"token class-name\">DateUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTimeByString</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start_time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"yyyy/MM/dd HH:mm:ss\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">DateUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTimeByString</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end_time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"yyyy/MM/dd HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n                param<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">DateUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTimeByString</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start_time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"yyyy/MM/dd HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n                param<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">edit</span><span class=\"token punctuation\">(</span>param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token class-name\">UIview</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redirect:bargainList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 砍价活动 状态修改\n     */</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/status\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n\n        <span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"eivt\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"state\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">edit</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">UIview</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redirect:bargainList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 秒杀活动 删除\n     */</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/remove\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n\n        <span class=\"token class-name\">FormMap</span> map <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">UIview</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"redirect:bargainList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 砍价活动记录列表\n     */</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bargainDetailList\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">bargainOrderList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入 bargainController-bargainOrderList,满减送活动列表\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//获取请求参数</span>\n        <span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//开启分页</span>\n        <span class=\"token class-name\">PageHelper</span><span class=\"token punctuation\">.</span><span class=\"token function\">startPage</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//查询展示数量</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">selectBargainDetailList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//返回到list页面</span>\n        <span class=\"token class-name\">UIview</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/bargain/bargainDetailList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//绑定分页返回</span>\n        result<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pageInfo\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageInfo</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//绑定上一次参数</span>\n        result<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queryParam\"</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 砍价活动 列表\n     */</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bargainNancyList\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">bargainNancyList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入 bargainController-bargainOrderList,砍价活动列表\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//获取请求参数</span>\n        <span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//开启分页</span>\n        <span class=\"token class-name\">PageHelper</span><span class=\"token punctuation\">.</span><span class=\"token function\">startPage</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//查询展示数量</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">selectBargainNancyList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//返回到list页面</span>\n        <span class=\"token class-name\">UIview</span> result <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/bargain/bargainNancyList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//绑定分页返回</span>\n        result<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pageInfo\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageInfo</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">//绑定上一次参数</span>\n        result<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queryParam\"</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token comment\">/**\n     * 查询商品列表\n     */</span>\n    <span class=\"token annotation punctuation\">@ResponseBody</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/productList.json\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">productList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入seckillController-productList,查询商品\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_name\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBytes</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ISO-8859-1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> productList <span class=\"token operator\">=</span> bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">selectProductList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> productJson <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span> e <span class=\"token operator\">:</span> productList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token class-name\">E</span> productinfo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">E</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;img src='\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">WeiitUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFileDomain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_img\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"' width='60px' height='60px'/&gt;\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sale_price\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sale_price\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stock\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stock\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n                    productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"option\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;a href='javascript:;'   title='选取' class='btn bg-green m-r-5 m-b-5 able_product_\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_id\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"' style='height: 22px;padding-top: 0px;' οnclick='selectProduct(\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_id\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\")' price='\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sale_price\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"'spec_config='\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spec_config\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"'&gt;选取&lt;/a&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n                    productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"option\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;a href='javascript:;' class='btn bg-grey m-r-5 m-b-5' style='height: 22px;padding-top: 0px;'&gt;已参加&lt;/a&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                productJson<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>productinfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> <span class=\"token function\">toJsonAPI</span><span class=\"token punctuation\">(</span>productJson<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"出错啦...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/**\n     * 选择多规格商品  规格、价格、库存、操作\n     * produce_id\n     */</span>\n    <span class=\"token annotation punctuation\">@ResponseBody</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/skuList.json\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">skuList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"BargainController-skuList,选择多规格商品\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"is_deleted\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"is_disabled\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> productService<span class=\"token punctuation\">.</span><span class=\"token function\">selectItemList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">E</span> productInfo <span class=\"token operator\">=</span> productService<span class=\"token punctuation\">.</span><span class=\"token function\">selectById</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> productJson <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span> e <span class=\"token operator\">:</span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\">E</span> productinfo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">E</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            formMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"specIds\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"spec_custom\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> specList <span class=\"token operator\">=</span> productService<span class=\"token punctuation\">.</span><span class=\"token function\">getSpecCustomByIds</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">String</span> specString <span class=\"token operator\">=</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span> spec <span class=\"token operator\">:</span>specList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n                specString<span class=\"token operator\">+=</span>spec<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"key_name\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            specString<span class=\"token operator\">=</span>specString<span class=\"token operator\">==</span><span class=\"token string\">\"\"</span><span class=\"token operator\">?</span>productInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_name\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>specString<span class=\"token punctuation\">;</span>\n            productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"specDesc\"</span><span class=\"token punctuation\">,</span>specString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sale_price\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sale_price\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stock\"</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stock\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            productinfo<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"option\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"&lt;a href='javascript:;'   title='选取' class='btn bg-green m-r-5 m-b-5 able_item_\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_id\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"' style='height: 22px;padding-top: 0px;' οnclick='selectItem(\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_id\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\")' specDesc='\"</span> <span class=\"token operator\">+</span> specString <span class=\"token operator\">+</span> <span class=\"token string\">\"'  product_id='\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_id\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"' product_img='\"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">WeiitUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFileDomain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>productInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_img\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"' stock='\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"stock\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"' price='\"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sale_price\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"'&gt;选取&lt;/a&gt;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            productJson<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>productinfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">toJsonAPI</span><span class=\"token punctuation\">(</span>productJson<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token comment\">/**\n     * 微页面(活动页) 根据bargain_ids 获取砍价商品活动列表\n     */</span>\n    <span class=\"token annotation punctuation\">@ResponseBody</span>\n    <span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/getProductByBargainIds\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getProductByBargainIds</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> token<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> bargain_ids<span class=\"token punctuation\">,</span><span class=\"token class-name\">Integer</span> bargainGetType<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{<!-- --></span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入 bargainController-getProductByBargainIds,微页面根据bargain_ids 获取砍价商品活动列表\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n            formMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shop_id\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">DesUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token 解密失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>bargain_ids<span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span> bargainGetType<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            formMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bargain_ids\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">strip</span><span class=\"token punctuation\">(</span>bargain_ids<span class=\"token punctuation\">,</span> <span class=\"token string\">\"[]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end_time\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token class-name\">BargainList</span> <span class=\"token operator\">=</span> bargainService<span class=\"token punctuation\">.</span><span class=\"token function\">getProductByBargainIds</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">toJsonAPI</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BargainList</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<hr/>\n<pre><code class=\"prism language-java\"><span class=\"token comment\">/**\n * 营销管理-》优惠券\n * @company http://www.wei-it.com 微邦互联\n */</span>\n<span class=\"token annotation punctuation\">@Controller</span>\n<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/ump/coupons\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CouponsController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AdminController</span> <span class=\"token punctuation\">{<!-- --></span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Logger</span> logger<span class=\"token operator\">=</span> <span class=\"token class-name\">Logger</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLogger</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CouponsController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Resource</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">CouponService</span> couponService<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Resource</span>\n\t<span class=\"token class-name\">ParameterService</span> parameterService<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token annotation punctuation\">@Resource</span>\n\t<span class=\"token class-name\">WeixinOpenService</span> weixinOpenService<span class=\"token punctuation\">;</span>\n\t  \n\t<span class=\"token comment\">/**\n\t * 优惠券》优惠券列表\n\t */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/couponsList\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">couponsList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-couponsList,优惠券列表展示\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">UIview</span> view <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/coupons/couponsList\"</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token class-name\">PageHelper</span><span class=\"token punctuation\">.</span><span class=\"token function\">startPage</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list<span class=\"token operator\">=</span>couponService<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       \n    \tview<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pageInfo\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageInfo</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \tview<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queryParam\"</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n    <span class=\"token comment\">/**\n     * 优惠券》优惠券创建\n     */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/create\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token class-name\">UIview</span> view<span class=\"token operator\">=</span><span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/coupons/couponsCreate\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n    <span class=\"token comment\">/**\n     * 优惠券 》编辑\n     */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/edit\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">edit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-edit,优惠券编辑\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">UIview</span> view<span class=\"token operator\">=</span><span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/coupons/couponsCreate\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">E</span> coupon<span class=\"token operator\">=</span>couponService<span class=\"token punctuation\">.</span><span class=\"token function\">selectCoupon</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\tview<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"coupon\"</span><span class=\"token punctuation\">,</span> coupon<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n    <span class=\"token comment\">/**\n     * 优惠券 》优惠券新增保存\n     * @throws Exception \n     */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/save\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">ModelAndView</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-save,优惠券新增保存\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">UIview</span> view<span class=\"token operator\">=</span><span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponsList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token comment\">//判断优惠形式type=1,2,3</span>\n\t    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token comment\">//优惠形式表示“指定金额”</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"coupon_discount\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"random_min_price\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"random_max_price\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token comment\">//优惠形式表示“打折”</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"coupon_price\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"random_min_price\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"random_max_price\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token comment\">//优惠形式表示“指定金额（随机）”</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"coupon_discount\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"coupon_price\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span>\n\t    <span class=\"token comment\">//判断生效条件is_condition=-1,1</span>\n\t\t<span class=\"token comment\">//生效条件表示“无条件”</span>\n\t    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"is_condition\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"condition_price\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span>\n\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t    <span class=\"token comment\">//判断使用有效期方式use_type=1 固定范围  ,2  指定时间范围</span>\n\t\t<span class=\"token comment\">//使用有效期表示“固定范围”</span>\n\t    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"use_type\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"from_day\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"to_day\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        <span class=\"token comment\">//如果开始时间小于当前时间   则优惠券处于未生效状态  ,其他情况都是生效状态</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&lt;</span> <span class=\"token class-name\">DateUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTimeByString</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start_time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"yyyy/MM/dd HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"start_time\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end_time\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span>\n\t    <span class=\"token comment\">//判断没人领取限制</span>\n\t\t<span class=\"token comment\">//使用有效期表示“不限制领取熟量”</span>\n\t    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"maxLimitType\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"max_limit\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span>\n\t    <span class=\"token comment\">//判断可使用商品</span>\n\t\t<span class=\"token comment\">//使用有效期表示“全网商品通用”</span>\n\t    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_range_type\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">==</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_ids\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span>\n\t        formMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"product_ids\"</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"selectProductValues\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t    <span class=\"token punctuation\">}</span>\n\t    <span class=\"token comment\">//判断是新增还是修改</span>\n\t\t<span class=\"token comment\">//新增优惠券判断</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"validate_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\tcouponService<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token comment\">//修改优惠券</span>\n\t\t\tcouponService<span class=\"token punctuation\">.</span><span class=\"token function\">edit</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token comment\">/**\n\t * 优惠券》优惠券列表》生效&amp;不生效\n\t */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/state\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">state</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-state,优惠券生效&amp;不生效操作\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">UIview</span> view<span class=\"token operator\">=</span><span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponsList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"onlyUpdateState\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"state\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tcouponService<span class=\"token punctuation\">.</span><span class=\"token function\">edit</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token comment\">/**\n\t * 优惠券》优惠券列表》删除\n\t */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/remove\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-remove,优惠券删除\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">UIview</span> view<span class=\"token operator\">=</span><span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponsList\"</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list<span class=\"token operator\">=</span>couponService<span class=\"token punctuation\">.</span><span class=\"token function\">selectCouponUserList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span><span class=\"token comment\">//该优惠券还有未使用的用户</span>\n\t\t\tview<span class=\"token punctuation\">.</span><span class=\"token function\">addErrorMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"删除失败，该优惠券还有未使用的用户!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\tcouponService<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tview<span class=\"token punctuation\">.</span><span class=\"token function\">addPNotifyMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"优惠券删除成功！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> \n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n \n    <span class=\"token comment\">/**\n     * 优惠券 派发用户列表 \n     */</span> \n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/couponsGive\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">couponsGive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-couponsGive,优惠券推广与派发\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">UIview</span> view <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/coupons/couponsGive\"</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token class-name\">PageHelper</span><span class=\"token punctuation\">.</span><span class=\"token function\">startPage</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token comment\">//查询没有领取该优惠券的用户列表与领取了但是没有超过优惠券最大设置限购数的用户列表</span>\n\n    \t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list<span class=\"token operator\">=</span>couponService<span class=\"token punctuation\">.</span><span class=\"token function\">selectNoCouponUserList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t\n    \tview<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pageInfo\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageInfo</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \tview<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queryParam\"</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n\t\t<span class=\"token class-name\">E</span> publicInfo<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"publicInfo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>publicInfo<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token comment\">//获取公众号优惠券地址  和 链接</span>\n\t\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_name\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"COUPONSMPQRCODE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token class-name\">E</span> paramInfo <span class=\"token operator\">=</span> parameterService<span class=\"token punctuation\">.</span><span class=\"token function\">selectShopParamByName</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponMpQrCodeUrl\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span>COUPON_QR_CODE<span class=\"token punctuation\">,</span>publicInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorizer_app_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>paramInfo<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponMpQrcode\"</span><span class=\"token punctuation\">,</span>paramInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_value\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token class-name\">WeiitQrCodeUtil</span> qrCodeUtil <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WeiitQrCodeUtil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token class-name\">String</span> qrCodePath <span class=\"token operator\">=</span> qrCodeUtil<span class=\"token punctuation\">.</span><span class=\"token function\">createQRCodeAndUploadQcloud</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constants</span><span class=\"token punctuation\">.</span>COUPON_QR_CODE<span class=\"token punctuation\">,</span>publicInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorizer_app_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token comment\">//入库</span>\n\t\t\t\t<span class=\"token class-name\">FormMap</span> insertParam <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_code\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"COUPONQRCODE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_name\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"COUPONSMPQRCODE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_value\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">WeiitUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFileDomain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>qrCodePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_desc\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"公众号优惠券领取二维码\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shop_id\"</span><span class=\"token punctuation\">,</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shop_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tparameterService<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>insertParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponMpQrcode\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">WeiitUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFileDomain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>qrCodePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token class-name\">E</span> miniPublicInfo <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"miniPublicInfo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>miniPublicInfo<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token comment\">//获取公众号优惠券地址  和 链接</span>\n\t\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_name\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"COUPONSMAQRCODE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token class-name\">E</span> paramInfo <span class=\"token operator\">=</span> parameterService<span class=\"token punctuation\">.</span><span class=\"token function\">selectShopParamByName</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>paramInfo<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponMaQrcode\"</span><span class=\"token punctuation\">,</span>paramInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_value\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"appid\"</span><span class=\"token punctuation\">,</span>miniPublicInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorizer_app_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token class-name\">File</span> file <span class=\"token operator\">=</span> weixinOpenService<span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getWxOpenComponentService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getWxMaServiceByAppid</span><span class=\"token punctuation\">(</span>miniPublicInfo<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorizer_app_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getQrcodeService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">createWxaCode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pages/Receive_coupons/Receive_coupons\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">225</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token class-name\">String</span> qrCodePath <span class=\"token operator\">=</span> <span class=\"token class-name\">WeiitUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">uploadFile</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FileUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">readFileToByteArray</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\t\t\t\t<span class=\"token class-name\">FormMap</span> insertParam <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_code\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"COUPONQRCODE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_name\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"COUPONSMAQRCODE\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_value\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">WeiitUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFileDomain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>qrCodePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"item_desc\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"小程序优惠券领取二维码\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state\"</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\tinsertParam<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shop_id\"</span><span class=\"token punctuation\">,</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shop_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\tparameterService<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>insertParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponMaQrcode\"</span><span class=\"token punctuation\">,</span><span class=\"token class-name\">WeiitUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFileDomain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>qrCodePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t\te<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token comment\">/**\n\t * 派发优惠券  保存 \n\t * @return\n\t * @throws Exception\n\t */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/couponsGiveSave\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">couponsGiveSave</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-couponsGiveSave,优惠券推广提交\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">String</span> message<span class=\"token operator\">=</span>couponService<span class=\"token punctuation\">.</span><span class=\"token function\">insertCouponUserTrans</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">UIview</span> view <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponsGive?validate_id=\"</span><span class=\"token operator\">+</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"validate_id\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\"&amp;validate_id_token=\"</span><span class=\"token operator\">+</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"validate_id_token\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\tview<span class=\"token punctuation\">.</span><span class=\"token function\">addPNotifyMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"会员优惠券派送成功！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\tview<span class=\"token punctuation\">.</span><span class=\"token function\">addErrorMessage</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n\t<span class=\"token comment\">/**\n\t * 派发优惠券记录\n\t * @return\n\t * @throws Exception\n\t */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/couponsUserList\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">couponsUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-couponsUserList,发优惠券记录\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">UIview</span> view <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/center/ump/coupons/couponsUserList\"</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token class-name\">E</span> coupon <span class=\"token operator\">=</span> couponService<span class=\"token punctuation\">.</span><span class=\"token function\">selectOne</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token class-name\">PageHelper</span><span class=\"token punctuation\">.</span><span class=\"token function\">startPage</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getRows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t<span class=\"token comment\">//查询该优惠券已经派发过的用户</span>\n    \t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list<span class=\"token operator\">=</span>couponService<span class=\"token punctuation\">.</span><span class=\"token function\">selectCouponUserList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \t\n    \tview<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pageInfo\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PageInfo</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \tview<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queryParam\"</span><span class=\"token punctuation\">,</span> formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \tview<span class=\"token punctuation\">.</span><span class=\"token function\">addObject</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"coupon\"</span><span class=\"token punctuation\">,</span> coupon<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span> \n\t<span class=\"token punctuation\">}</span>\n\n\t\n\t<span class=\"token comment\">/**\n\t * 派发优惠券》回收\n\t * @return\n\t * @throws Exception\n\t */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/couponsUserRemove\"</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">UIview</span> <span class=\"token function\">couponsUserRemove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-couponsUserRemove,派发优惠券 回收\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\n\t\t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token function\">getFormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">String</span> message<span class=\"token operator\">=</span>couponService<span class=\"token punctuation\">.</span><span class=\"token function\">removeCouponUserTrans</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">UIview</span> view <span class=\"token operator\">=</span> <span class=\"token class-name\">UIView</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponsUserList?validate_id=\"</span><span class=\"token operator\">+</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"validate_id\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">\"&amp;validate_id_token=\"</span><span class=\"token operator\">+</span>formMap<span class=\"token punctuation\">.</span><span class=\"token function\">getStr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"validate_id_token\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">==</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\tview<span class=\"token punctuation\">.</span><span class=\"token function\">addPNotifyMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"优惠券回收成功!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\tview<span class=\"token punctuation\">.</span><span class=\"token function\">addErrorMessage</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> view<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\n\t<span class=\"token comment\">/**\n\t * 装修页面 获取优惠券列表\n\t *\n\t *\n\t * */</span>\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/getCouponList\"</span><span class=\"token punctuation\">,</span>method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span>GET<span class=\"token punctuation\">)</span>\n\t<span class=\"token annotation punctuation\">@ResponseBody</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">E</span> <span class=\"token function\">getCouponList</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> token<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> coupon_name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"进入CouponsController-getCouponList,获取优惠券列表\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">FormMap</span> formMap<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">E</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">E</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shop_id\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">DesUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\te<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token 解密失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tresult<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponList\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"coupon_name\"</span><span class=\"token punctuation\">,</span>coupon_name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> couponService<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tresult<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponList\"</span><span class=\"token punctuation\">,</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token comment\">//绑定上一次参数</span>\n\t\t<span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\n\t<span class=\"token comment\">/**\n\t * 微页面  优惠券展示   不展示是否领取  过滤失效优惠券\n\t * @author lhq\n\t * @date 2018年5月10日\n\t * */</span>\n\n\t<span class=\"token annotation punctuation\">@RequestMapping</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"/couponListByIds\"</span><span class=\"token punctuation\">,</span>method <span class=\"token operator\">=</span> <span class=\"token class-name\">RequestMethod</span><span class=\"token punctuation\">.</span>GET<span class=\"token punctuation\">)</span>\n\t<span class=\"token annotation punctuation\">@ResponseBody</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">couponListByIds</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token class-name\">String</span> token<span class=\"token punctuation\">,</span><span class=\"token class-name\">String</span> coupon_ids<span class=\"token punctuation\">,</span><span class=\"token class-name\">Integer</span> couponType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ActivityController-couponListByIds，微页面  优惠券展示\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">FormMap</span> formMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormMap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"shop_id\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">DesUtil</span><span class=\"token punctuation\">.</span><span class=\"token function\">decrypt</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\te<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tlogger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token 解密失败\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"couponType\"</span><span class=\"token punctuation\">,</span>couponType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>coupon_ids<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> couponType<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"coupon_ids\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">strip</span><span class=\"token punctuation\">(</span>coupon_ids<span class=\"token punctuation\">,</span> <span class=\"token string\">\"[]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\tformMap<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"end_time\"</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">&gt;</span></span> list <span class=\"token operator\">=</span> couponService<span class=\"token punctuation\">.</span><span class=\"token function\">couponListByIds</span><span class=\"token punctuation\">(</span>formMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token function\">toJsonAPI</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<hr/>\n<blockquote>\n<p>🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈 🌈<br/>  <br/> <strong>🍂个人博客首页：</strong> <a href=\"https://blog.csdn.net/m0_47384542?type=blog\">KJ.JK</a><br/>  <br/> <strong>欢迎大家点赞👍收藏💖评论💬关注🔒</strong><br/>  <br/> <strong>💖源码获取 | 💻学习交流 | 🤝商务合作 | 💨私信作者</strong></p>\n</blockquote>\n<hr/>\n<h1><a id=\"KJJK_914\"></a>作者：KJ.JK</h1>\n<p>文章对你有所帮助的话，欢迎给个赞或者 star，你的支持是对作者最大的鼓励，不足之处可以在评论区多多指正，交流学习</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "JavaScript", "cpp": 0, "csharp": 0, "python": 0, "javascript": 1, "java": 0, "sql": 0, "php": 0, "time": "2022-08-29 10:05:18", "summary": "文章目录一、项目介绍二、技术栈以及项目特点三、系统设计四、系统功能演示店铺功能演示图商品功能演示图订单功能演示图客户功能演示图数据功能演示图营销功能演示图设置功能演示图五、系统源代码作者：个人博客首页"}