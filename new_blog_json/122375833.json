{"blogid": "122375833", "writerAge": "码龄6年", "writerBlogNum": "102", "writerCollect": "212", "writerComment": "51", "writerFan": "39", "writerGrade": "5级", "writerIntegral": "1841", "writerName": "komla168", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_122375833.jpg", "writerRankTotal": "11463", "writerRankWeekly": "14627", "writerThumb": "65", "writerVisitNum": "140732", "blog_read_count": "1817", "blog_time": "于 2022-01-10 09:50:23 发布", "blog_title": "3 、OpenCvSharp 图片转视频", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>写作原因：前段时间做图像识别，一朋友用python将一张图片合成了一段视频，用于测试使用，先就c#做一个图片转视频的记录，使用的是Opencvsharp，如有不对的地方，请多多指教。</p>\n<h3>一、准备</h3>\n<p>需要使用到的对象为VideoWriter</p>\n<p><img alt=\"\" height=\"695\" src=\"..\\..\\static\\image\\e14ec1d235ba4cccbafae8076fb87324.png\" width=\"1200\"/> 其中重载函数有好几个，用来对应不同的需求。</p>\n<p><img alt=\"\" height=\"685\" src=\"..\\..\\static\\image\\d5dc227cc2d3469a8c76915d351d3f80.png\" width=\"1200\"/></p>\n<h3> 二、参数解释</h3>\n<p>参数由很多，笔者用下面这个重载函数对这些参数做讲解</p>\n<pre><code class=\"language-cs\">        /// &lt;summary&gt;\n        /// Creates video writer structure. \n        /// &lt;/summary&gt;\n        /// &lt;param name=\"fileName\"&gt;Name of the output video file. &lt;/param&gt;\n        /// &lt;param name=\"fourcc\"&gt;4-character code of codec used to compress the frames. For example, \"PIM1\" is MPEG-1 codec, \"MJPG\" is motion-jpeg codec etc. \n        /// Under Win32 it is possible to pass null in order to choose compression method and additional compression parameters from dialog. &lt;/param&gt;\n        /// &lt;param name=\"fps\"&gt;Frame rate of the created video stream. &lt;/param&gt;\n        /// &lt;param name=\"frameSize\"&gt;Size of video frames. &lt;/param&gt;\n        /// &lt;param name=\"prms\"&gt;The `params` parameter allows to specify extra encoder parameters encoded as pairs (paramId_1, paramValue_1, paramId_2, paramValue_2, ... .)\n        /// see cv::VideoWriterProperties&lt;/param&gt;\n        /// &lt;returns&gt;&lt;/returns&gt;\n        public VideoWriter(string fileName, FourCC fourcc, double fps, Size frameSize, int[] prms)\n        {\n            FileName = fileName ?? throw new ArgumentNullException(nameof(fileName));\n            Fps = fps;\n            FrameSize = frameSize;\n            NativeMethods.HandleException(\n                NativeMethods.videoio_VideoWriter_new4(fileName, (int)fourcc, fps, frameSize, prms, prms.Length, out ptr));\n            if (ptr == IntPtr.Zero)\n                throw new OpenCvSharpException(\"Failed to create VideoWriter\");\n        }</code></pre>\n<p>fileName：就是生成的视频文件的名字，可由使用者自定义。</p>\n<p>fourcc：使用的图片格式，像mjpg。</p>\n<p>fps：设置生成的视频的帧率。</p>\n<p>frameSize：生成的视频每一帧的大小。</p>\n<p>prms：其他的一些参数，像编码格式等，由使用者自定义。</p>\n<h3>三、代码</h3>\n<pre><code class=\"language-cs\">            Mat SourceMat = Cv2.ImRead(@\"F:\\Media\\1018_2.png\");//方法1\n            Size imgSize = new Size(SourceMat.Width, SourceMat.Height);\n\n            //构造函数设置必要参数\n            //VideoWriter videoWriter = new VideoWriter(outVideo, VideoWriter.FourCC(@\"MPG4\"), 20, imgSize, true);\n            VideoWriter videoWriter = new VideoWriter(@\"F:\\out.avi\", VideoWriter.FourCC(@\"XVID\"), 20, imgSize, true);\n\n            for (int i = 1; i &lt;= 500; i++)\n            {\n                Mat mat = new Mat();\n                string FileString = @\"F:\\Media\\1018_2.png\";\n                //FileString = FileString + i.ToString() + \".jpg\";\n\n                mat = Cv2.ImRead(FileString);\n                if (!mat.Empty())\n                {\n                    //Cv2.ImShow(\"Image\", mat);\n                    videoWriter.Write(mat);\n                    Cv2.WaitKey(0);\n                }\n            }</code></pre>\n<p>这里面需要注意的是构造函数中的参数一定要对，不然可能生不成视频或生成后打不开。</p>\n<p><img alt=\"\" height=\"74\" src=\"..\\..\\static\\image\\82cc1e9073994437946dd2cc9c7fd28e.png\" width=\"700\"/></p>\n<p> 不过这里有个问题，就是这个out.avi有大小也可以正常播放，但是会发现这个视频的时长是0，用迅雷播放器播放不会有走秒</p>\n<p><img alt=\"\" height=\"549\" src=\"..\\..\\static\\image\\3892934f845d4bd889fd604d57238d59.png\" width=\"643\"/></p>\n<p> 用系统自带的Media Player可以看到视频在走秒</p>\n<p><img alt=\"\" height=\"1046\" src=\"..\\..\\static\\image\\cba75a78cff2453ca7e4a670f09488b0.png\" width=\"1200\"/></p>\n<p> 不知道是哪里的问题，有知道的大神忘能指导一二。</p>\n<p> </p>\n<p> </p>\n</div>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 1, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-01-10 09:50:23", "summary": "写作原因：前段时间做图像识别，一朋友用将一张图片合成了一段视频，用于测试使用，先就做一个图片转视频的记录，使用的是，如有不对的地方，请多多指教。一、准备需要使用到的对象为其中重载函数有好几个，用来对应"}