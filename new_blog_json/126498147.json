{"blogid": "126498147", "writerAge": "码龄6年", "writerBlogNum": "1198", "writerCollect": "3851", "writerComment": "1480", "writerFan": "12984", "writerGrade": "7级", "writerIntegral": "18310", "writerName": "红目香薰", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126498147.jpg", "writerRankTotal": "496", "writerRankWeekly": "740", "writerThumb": "2805", "writerVisitNum": "1055309", "blog_read_count": "211", "blog_time": "已于 2022-09-06 18:04:02 修改", "blog_title": "中秋节的广西甘蔗——智蔗见智·向新而生", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>中秋节的时候我们理论上应该放假，但是放假、什么是放假？咱们程序员需要放假？不可能的。所以利用假期时间搞定广西万顷甘蔗地的图像分析还是会有很大的成就感的。</p>\n<hr/>\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"%E8%AE%AD%E7%BB%83%E8%B5%84%E6%BA%90%E5%9C%B0%E5%9D%80-toc\" style=\"margin-left:40px;\"><a href=\"#%E8%AE%AD%E7%BB%83%E8%B5%84%E6%BA%90%E5%9C%B0%E5%9D%80\">训练资源地址</a></p>\n<p id=\"obs%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-toc\" style=\"margin-left:40px;\"><a href=\"#obs%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\">obs环境准备</a></p>\n<p id=\"%E8%BF%90%E8%A1%8C-%E5%85%B1%E8%AE%A1%E8%BF%90%E8%A1%8C%E5%B7%AE%E4%B8%8D%E5%A4%9A50s-toc\" style=\"margin-left:40px;\"><a href=\"#%E8%BF%90%E8%A1%8C-%E5%85%B1%E8%AE%A1%E8%BF%90%E8%A1%8C%E5%B7%AE%E4%B8%8D%E5%A4%9A50s\">运行-共计运行差不多50s</a></p>\n<p id=\"baseline%E5%A4%8D%E7%8E%B0-toc\" style=\"margin-left:40px;\"><a href=\"#baseline%E5%A4%8D%E7%8E%B0\">baseline复现</a></p>\n<p id=\"%E8%AE%AD%E7%BB%83%E6%96%B9%E5%BC%8F-toc\" style=\"margin-left:40px;\"><a href=\"#%E8%AE%AD%E7%BB%83%E6%96%B9%E5%BC%8F\">训练方式</a></p>\n<p id=\"baseline%E6%BC%94%E7%A4%BA-toc\" style=\"margin-left:40px;\"><a href=\"#baseline%E6%BC%94%E7%A4%BA\">baseline演示</a></p>\n<p id=\"%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E9%AA%8C%E8%AF%81%E9%9B%86%E7%9A%84%E5%88%92%E5%88%86-toc\" style=\"margin-left:80px;\"><a href=\"#%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E9%AA%8C%E8%AF%81%E9%9B%86%E7%9A%84%E5%88%92%E5%88%86\">训练集和验证集的划分</a></p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91%E5%BC%80%E5%A7%8B%E8%AE%AD%E7%BB%83-toc\" style=\"margin-left:80px;\"><a href=\"#%E2%80%8B%E7%BC%96%E8%BE%91%E5%BC%80%E5%A7%8B%E8%AE%AD%E7%BB%83\">​编辑开始训练</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<h2 id=\"%E8%AE%AD%E7%BB%83%E8%B5%84%E6%BA%90%E5%9C%B0%E5%9D%80\">训练资源地址</h2>\n<p>接下来我们使用华为云的平台来处理甘蔗地图片。</p>\n<p>可以在华为云中下载获取，这里得通过桶进行保存：<a href=\"https://developer.huaweicloud.com/develop/aigallery/dataset/detail?id=51fbd002-c57e-41e9-b4a7-bee0124591e4\" title=\"AI Gallery_数据详情_开发者_华为云\">AI Gallery_数据详情_开发者_华为云</a></p>\n<p>训练集数据压缩包解压后是一系列png格式图片，<strong><code>*_img.png</code></strong>表示遥感图像，与其同名且后缀为<strong><code>_mask.png</code></strong>的图像为对应的label图像。</p>\n<p><img alt=\"\" height=\"617\" src=\"..\\..\\static\\image\\7463f8a0da0945a99b25b5eeb2536346.png\" width=\"1097\"/></p>\n<p><img alt=\"\" height=\"324\" src=\"..\\..\\static\\image\\c1879057c9664d1ba14517d9834ddc2f.png\" width=\"1200\"/></p>\n<h2 id=\"obs%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87\">obs环境准备</h2>\n<p>先登录到存储服务</p>\n<p><a href=\"https://storage.huaweicloud.com/obs/?locale=zh-cn&amp;region=cn-north-4\" title=\"https://storage.huaweicloud.com/obs/?locale=zh-cn&amp;region=cn-north-4\">https://storage.huaweicloud.com/obs/?locale=zh-cn&amp;region=cn-north-4</a></p>\n<p><img alt=\"\" height=\"636\" src=\"..\\..\\static\\image\\e845f5e9cd174202a61b45f53f496002.png\" width=\"1200\"/></p>\n<p>我这有现成的桶我就不再创建了。</p>\n<p><img alt=\"\" height=\"86\" src=\"..\\..\\static\\image\\0c686da1c939470fbb29c4b7b024fd07.png\" width=\"1200\"/></p>\n<p>没有的需要自己创建一下。</p>\n<p><img alt=\"\" height=\"1080\" src=\"..\\..\\static\\image\\8441cf498d95447c84c3cc5334cf24b8.png\" width=\"1200\"/></p>\n<p>进入桶：</p>\n<p><img alt=\"\" height=\"946\" src=\"..\\..\\static\\image\\155a202d553841e9a403d0f0ca6a4152.png\" width=\"1200\"/></p>\n<p>进入：</p>\n<p><a href=\"https://console.huaweicloud.com/modelarts/?region=cn-north-4#/dashboard\" title=\"https://console.huaweicloud.com/modelarts/?region=cn-north-4#/dashboard\">https://console.huaweicloud.com/modelarts/?region=cn-north-4#/dashboard</a></p>\n<p>咱们需要使用CodeLab</p>\n<p><img alt=\"\" height=\"920\" src=\"..\\..\\static\\image\\71f5ab5092ce4ae69cac2a9a7a3ae97b.png\" width=\"1200\"/></p>\n<p>有72小时免费示例，初始化的时候需要等待一会。我9点52开始初始化的。</p>\n<p><img alt=\"\" height=\"875\" src=\"..\\..\\static\\image\\ef30e48f538f4a7a95640f15ffceb8ef.png\" width=\"1200\"/></p>\n<p>大概1分多钟完成的。</p>\n<p><img alt=\"\" height=\"976\" src=\"..\\..\\static\\image\\d7d97ad3f357468493690b6a91d82f2b.png\" width=\"1200\"/></p>\n<p>这里咱们选择C【Conda-python3】</p>\n<p><img alt=\"\" height=\"330\" src=\"..\\..\\static\\image\\73ea781b801a4fb6b28e1d7c867ccc04.png\" width=\"972\"/></p>\n<p>进入编码阶段了。示例的桶是我的链接。具体看需求使用啊，从哪里复制到哪里。这里先有个说明，咱们接下来看baseline复现。</p>\n<pre><code class=\"language-python\">import moxing as mox\n\n# 拷贝obs数据到notebook环境中\nmox.file.copy('obs://mytestbosqwe8403000/data/train.zip', './train.zip')\n# 拷贝notebook环境中数据到obs\nmox.file.copy('./train.zip', 'obs://mytestbosqwe8403000/data/train.zip')\n\n!unzip train.zip &amp;&gt; /dev/null\n# copy_parallel用于copy文件夹\nmox.file.copy_parallel('./train', 'obs://mytestbosqwe8403000/data/train/')</code></pre>\n<p></p>\n<h2 id=\"baseline%E5%A4%8D%E7%8E%B0\">baseline复现</h2>\n<p>通过在modelarts中notebook中编写代码获取（注意这里路径没有换行）</p>\n<p>obs地址为<strong><code>obs://ma-competitions-bj4/guangxi_remote_sense_segmentation/code/</code></strong>，可以通过在notebook中新建如下代码将baseline的代码copy到你的环境下。</p>\n<pre><code class=\"language-python\">import moxing as mox\nmox.file.copy_parallel('obs://ma-competitions-bj4/guangxi_remote_sense_segmentation/code/', 'obs://mytestbosqwe8403000/data/baseline/')</code></pre>\n<p>拿到baseline的代码后，可以看到四个文件夹，一共有两个baseline code及其对应的推理代码。对应解释如下</p>\n<p><img alt=\"\" height=\"561\" src=\"..\\..\\static\\image\\3470b762faab47e693aa2dc6c2da4dd5.png\" width=\"1059\"/></p>\n<p>也可以直接复制到代码区</p>\n<pre><code class=\"language-python\">import moxing as mox\nmox.file.copy_parallel('obs://mytestbosqwe8403000/data/baseline/', './baseline')</code></pre>\n<p><img alt=\"\" height=\"402\" src=\"..\\..\\static\\image\\8f765a5c68e14b2e91933c3291fe2682.png\" width=\"495\"/></p>\n<p>层级介绍 </p>\n<pre><code class=\"language-python\">|-- inference-for-mmseg           （推理代码）mmsegmentation 适配 ModelArts 中AI应用的演示代码\n    |-- model\n    |   `-- README.md             演示代码说明文件\n    |   `-- otherfiles...             \n|-- inference-for-pl              （推理代码）pytorch-lightning-unet 适配 ModelArts 中AI应用的演示代码\n\t|-- model\n    |   `-- README.md             演示代码说明文件\n    |   `-- otherfiles...\n|-- mmsegmentation                mmsegmentation适配于比赛数据的修改版本\n|   `-- README.md                 安装说明和convnext-upernet相关训练指令说明\n|   `-- otherfiles...\n|-- pytorch-lightning-unet        基于pytorch-lightning的unet实现\n|   `-- README.md                 安装说明和unet相关训练指令说明\n    `-- otherfiles...</code></pre>\n<p>其中【/baseline/pytorch-lightning-unet/README.md】是说明文档</p>\n<p id=\"%E2%80%8B%E7%BC%96%E8%BE%91\"><img alt=\"\" height=\"838\" src=\"..\\..\\static\\image\\f0f79c5c124e4eb6a143d31ff8a9d1a2.png\" width=\"1200\"/></p>\n<h2 id=\"%E8%AE%AD%E7%BB%83%E6%96%B9%E5%BC%8F\">训练方式</h2>\n<p><a href=\"https://console.huaweicloud.com/modelarts/?region=cn-north-4#/dev-container/create\" title=\"https://console.huaweicloud.com/modelarts/?region=cn-north-4#/dev-container/create\">https://console.huaweicloud.com/modelarts/?region=cn-north-4#/dev-container/create</a></p>\n<p>直接如下图选择并创建，有券免费。</p>\n<p><img alt=\"\" height=\"1078\" src=\"..\\..\\static\\image\\732debe9537d47d595d4e4898af03f73.png\" width=\"1200\"/></p>\n<p>创建需要等一会，完成之后点击【打开】 </p>\n<p><img alt=\"\" height=\"390\" src=\"..\\..\\static\\image\\19357299860945edbbd756483d49b8c1.png\" width=\"1200\"/></p>\n<p>主要使用文件类型 </p>\n<p><img alt=\"\" height=\"911\" src=\"..\\..\\static\\image\\ab9e1de3129a4d598fe93487aaed8239.png\" width=\"1200\"/></p>\n<p>复制baseline</p>\n<pre><code class=\"language-python\">import moxing as mox\nmox.file.copy_parallel('obs://ma-competitions-bj4/guangxi_remote_sense_segmentation/code/', './baseline')</code></pre>\n<p>复制train</p>\n<pre><code class=\"language-python\">mox.file.copy_parallel('obs://mytestbosqwe8403000/data/train.zip', './train.zip')</code></pre>\n<p><img alt=\"\" height=\"376\" src=\"..\\..\\static\\image\\77d492b561724aa79158e2a1333b22c3.png\" width=\"1128\"/></p>\n<p>环境升级</p>\n<p>添加一个Terminal</p>\n<p><img alt=\"\" height=\"537\" src=\"..\\..\\static\\image\\896edf252ba842d99786fb594180a690.png\" width=\"1200\"/></p>\n<p>升级命令</p>\n<pre><code class=\"language-python\">pip install torchvision==0.12.0 --upgrade</code></pre>\n<p><img alt=\"\" height=\"856\" src=\"..\\..\\static\\image\\b4ca0e436b104abb95eae2aae04f28ae.png\" width=\"1200\"/></p>\n<p>解压zip压缩包</p>\n<pre><code class=\"language-python\">unzip train.zip</code></pre>\n<p><img alt=\"\" height=\"813\" src=\"..\\..\\static\\image\\c1e4c9d83c1e4f578829e888b7aff5e1.png\" width=\"579\"/></p>\n<p>批量操作</p>\n<pre><code class=\"language-python\">pip install opencv-python\npip install matplotlib\npip install pytorch-lightning==1.6.5\npip install torchmetrics\n</code></pre>\n<h2 id=\"baseline%E6%BC%94%E7%A4%BA\">baseline演示</h2>\n<p>当前的文档中3个内容1是baseline代码，2是操作文件，3是训练图片</p>\n<p><img alt=\"\" height=\"302\" src=\"..\\..\\static\\image\\95fcfcb7c4a04cfe91c721b692200dac.png\" width=\"377\"/></p>\n<h3 id=\"%E8%AE%AD%E7%BB%83%E9%9B%86%E5%92%8C%E9%AA%8C%E8%AF%81%E9%9B%86%E7%9A%84%E5%88%92%E5%88%86\">训练集和验证集的划分</h3>\n<p><img alt=\"\" height=\"965\" src=\"..\\..\\static\\image\\03fe45d5c40b491fab886cc547df209c.png\" width=\"1200\"/></p>\n<p>在72和73行是训练集和测试集 </p>\n<p><img alt=\"\" height=\"425\" src=\"..\\..\\static\\image\\26d450a9a8b04d9fa803bb8bce1c6cca.png\" width=\"1066\"/></p>\n<p>要求的路径是./dataset下，是train.py的相对路径，所以需要单独创建一个dataset文件夹，然后在往里面放置两个文件夹train与split_imgs分别是训练集和测试集，他的代码中有这个文件处理，我们直接都放一个文件夹就行。</p>\n<p><img alt=\"\" height=\"766\" src=\"..\\..\\static\\image\\989ee089f98c4e159daf80e383862610.png\" width=\"725\"/></p>\n<p><img alt=\"\" height=\"574\" src=\"..\\..\\static\\image\\69413ffd1d5b4e68b85496abc33f9014.png\" width=\"425\"/></p>\n<p>再在/home/ma-user/work/baseline/pytorch-lightning-unet/dataset文件夹下创建train与split_imgs的文件夹，这里复制过来train的文件夹改个名字就行。</p>\n<pre><code class=\"language-python\">cp -r ./train ./baseline/pytorch-lightning-unet/dataset/train\ncp -r ./train ./baseline/pytorch-lightning-unet/dataset/split_imgs</code></pre>\n<p><img alt=\"\" height=\"206\" src=\"..\\..\\static\\image\\63aafda6db2544e78e3159c25ded15b9.png\" width=\"1056\"/>可以看到已经粘贴过去了。</p>\n<p><img alt=\"\" height=\"564\" src=\"..\\..\\static\\image\\3b7fb85a26a64fde873678c7acf1b9d8.png\" width=\"619\"/></p>\n<p>航拍照片与标记照片都在一个文件夹里面，但是他的代码里面有区分，我们就不用管了。</p>\n<h3 id=\"%E2%80%8B%E7%BC%96%E8%BE%91%E5%BC%80%E5%A7%8B%E8%AE%AD%E7%BB%83\"><img alt=\"\" height=\"561\" src=\"..\\..\\static\\image\\490db50af9284ad8b1c0365d3005ede6.png\" width=\"1200\"/><br/> 开始训练</h3>\n<p>由于刚才一直在【/home/ma-user/work/】下干活了，咱们需要进入到train.py的文件夹执行</p>\n<pre><code class=\"language-python\">cd ./baseline/pytorch-lightning-unet/\npython train.py</code></pre>\n<p><img alt=\"\" height=\"903\" src=\"..\\..\\static\\image\\b840a46726794a8cbe8b09fad5e0c80c.png\" width=\"1200\"/></p>\n<p>由于max是50，预计时间70小时左右。</p>\n<p><img alt=\"\" height=\"329\" src=\"..\\..\\static\\image\\0d364563209d4dd8936fd294b470f848.png\" width=\"854\"/></p>\n<p></p>\n</div>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-06 18:04:02", "summary": "中秋节的时候我们理论上应该放假，但是放假、什么是放假？咱们程序员需要放假？不可能的。所以利用假期时间搞定广西万顷甘蔗地的图像分析还是会有很大的成就感的。目录训练资源地址环境准备运行共计运行差不多复现训"}