{"blogid": "126720660", "writerAge": "码龄118天", "writerBlogNum": "22", "writerCollect": "103", "writerComment": "114", "writerFan": "1383", "writerGrade": "3级", "writerIntegral": "526", "writerName": "LeoATLiang", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126720660.jpg", "writerRankTotal": "29913", "writerRankWeekly": "289", "writerThumb": "141", "writerVisitNum": "10156", "blog_read_count": "170", "blog_time": "已于 2022-09-06 21:26:47 修改", "blog_title": "【OpenCV图像处理14】图像分割与修复", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#_1\">十四、图像分割与修复</a></li><li><ul><li><a href=\"#1_3\">1、图像分割</a></li><li><ul><li><a href=\"#11__16\">1.1 分水岭法</a></li><li><a href=\"#12_GrabCut_218\">1.2 GrabCut法</a></li><li><a href=\"#13_MeanShift_391\">1.3 MeanShift法</a></li></ul>\n</li><li><a href=\"#2_440\">2、视频前后景分离(视频背景抠图)</a></li><li><ul><li><a href=\"#31_MOG2_497\">3.1 MOG2去背景</a></li><li><a href=\"#32_GMG_538\">3.2 GMG去背景</a></li></ul>\n</li><li><a href=\"#3_583\">3、图像修复</a></li></ul>\n</li></ul>\n</div>\n<p></p>\n<h1><a id=\"_1\"></a>十四、图像分割与修复</h1>\n<h2><a id=\"1_3\"></a>1、图像分割</h2>\n<p><strong>图像分割：</strong> 将前景物体从背景中分离出来。</p>\n<p><strong>图像分割的方法：</strong></p>\n<ul><li>传统的图像分割方法 \n  <ul><li>分水岭法</li><li>GrabCut法</li><li>MeanShift法</li><li>背景抠图</li></ul> </li><li>基于深度学习的图像分割方法</li></ul>\n<h3><a id=\"11__16\"></a>1.1 分水岭法</h3>\n<p><strong>1、分水岭法的原理：</strong></p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\b51ab55932ab4062ac2f7240faa02d2a.png\"/></p>\n<p><strong>2、分水岭法的问题：</strong></p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\b8574fb203fe402da9ad11fd721c1773.png\"/></p>\n<blockquote>\n<p>图像存在过多的极小区域，从而产生许多小的集水盆。</p>\n</blockquote>\n<p><strong>3、分水岭法的基本步骤：</strong></p>\n<ul><li>标记背景</li><li>标记前景</li><li>标记未知域</li><li>进行分割</li></ul>\n<p><strong>4、实战：分割硬币</strong></p>\n<p><strong><code>watershed()</code>用法：</strong></p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>watershed<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> markers<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>markers：前景、背景设置不同的值用以区分它们</li></ul>\n<p>原图像：</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\2b38624019904e37b4a1ef6c6b9a1276.png\"/></p>\n<p>获取背景：</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\e19b73b93c0e48b4af55cc69af7c26b0.png\"/></p>\n<p>获取前景：</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\7acb75cc7aee49e28344a9e36bc8d1b3.png\"/></p>\n<p>获取未知域：</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\c48ea34995844b6c8af1b510fdef5bc5.png\"/></p>\n<p><strong>4.1 获取背景：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token comment\"># 获取背景</span>\n<span class=\"token comment\"># 1.通过二值法得到黑白图像</span>\n<span class=\"token comment\"># 2.通过形态学获取背景</span>\nret<span class=\"token punctuation\">,</span> thresh <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>THRESH_BINARY_INV <span class=\"token operator\">+</span> cv2<span class=\"token punctuation\">.</span>THRESH_OTSU<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 开运算</span>\nkernel <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>ones<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>int8<span class=\"token punctuation\">)</span>\nopen1 <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>morphologyEx<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>MORPH_OPEN<span class=\"token punctuation\">,</span> kernel<span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 膨胀</span>\nbg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>dilate<span class=\"token punctuation\">(</span>open1<span class=\"token punctuation\">,</span> kernel<span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'thresh'</span><span class=\"token punctuation\">,</span> thresh<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'bg'</span><span class=\"token punctuation\">,</span> bg<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\cbf1e0cbf08c4a43b9b32b629405b5f5.png\"/></p>\n<p><strong>4.2 获取前景：</strong></p>\n<p><strong>距离变换：</strong><code>distanceTransform()</code>用法</p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>distanceTransform<span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> distanceType<span class=\"token punctuation\">,</span> maskSize<span class=\"token punctuation\">,</span> dst<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> dstType<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>distanceType：DIST_L1（绝对值），DIST_L2（勾股定理）</li><li>maskSize：L1：3，L2：5</li></ul>\n<pre><code class=\"prism language-python\"><span class=\"token comment\"># 获取前景</span>\ndist <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>distanceTransform<span class=\"token punctuation\">(</span>open1<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>DIST_L2<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n\nret<span class=\"token punctuation\">,</span> fg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">(</span>dist<span class=\"token punctuation\">,</span> <span class=\"token number\">0.7</span><span class=\"token operator\">*</span>dist<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>THRESH_BINARY<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># plt.imshow(dist, cmap='gray')</span>\n<span class=\"token comment\"># plt.show()</span>\n<span class=\"token comment\"># exit()</span>\n\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'dist'</span><span class=\"token punctuation\">,</span> dist<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'fg'</span><span class=\"token punctuation\">,</span> fg<span class=\"token punctuation\">)</span>\n</code></pre>\n<blockquote>\n<p>使用Matplotlib画出dist：<br/> <img alt=\"\" src=\"..\\..\\static\\image\\6b7b915300f4492f96c9a533d6ddb818.png\"/></p>\n</blockquote>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\b6ce61a348a34d498d7c78416b043bca.png\"/></p>\n<p><strong>4.3 获取未知域：</strong></p>\n<p><strong>求连通域：</strong><code>connectedComponents()</code>用法</p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>connectedComponents<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> labels<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> connectivity<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> ltype<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>connectivity：4，8（默认）</li></ul>\n<pre><code class=\"prism language-python\"><span class=\"token comment\"># 获取未知域</span>\nfg <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">(</span>fg<span class=\"token punctuation\">)</span>\nunknown <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>subtract<span class=\"token punctuation\">(</span>bg<span class=\"token punctuation\">,</span> fg<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 创建连通域</span>\nret<span class=\"token punctuation\">,</span> marker <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>connectedComponents<span class=\"token punctuation\">(</span>fg<span class=\"token punctuation\">)</span>\n\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'unknown'</span><span class=\"token punctuation\">,</span> unknown<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\8312a9e4e93b4755a0bd3aeb35dc6094.png\"/></p>\n<p><strong>4.4 进行分割：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token comment\"># 进行分割</span>\nresult <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>watershed<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> marker<span class=\"token punctuation\">)</span>\nimg<span class=\"token punctuation\">[</span>result <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">]</span>\n\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">,</span> img<span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\d0e34ec10bfa4053adb36b24f00161a5.png\"/></p>\n<p><strong>代码实现（完整代码）：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">from</span> matplotlib <span class=\"token keyword\">import</span> pyplot <span class=\"token keyword\">as</span> plt\n\nimg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/money.png'</span><span class=\"token punctuation\">)</span>\ngray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 获取背景</span>\n<span class=\"token comment\"># 1.通过二值法得到黑白图像</span>\n<span class=\"token comment\"># 2.通过形态学获取背景</span>\nret<span class=\"token punctuation\">,</span> thresh <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>THRESH_BINARY_INV <span class=\"token operator\">+</span> cv2<span class=\"token punctuation\">.</span>THRESH_OTSU<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 开运算</span>\nkernel <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>ones<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>int8<span class=\"token punctuation\">)</span>\nopen1 <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>morphologyEx<span class=\"token punctuation\">(</span>thresh<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>MORPH_OPEN<span class=\"token punctuation\">,</span> kernel<span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 膨胀</span>\nbg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>dilate<span class=\"token punctuation\">(</span>open1<span class=\"token punctuation\">,</span> kernel<span class=\"token punctuation\">,</span> iterations<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 获取前景</span>\ndist <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>distanceTransform<span class=\"token punctuation\">(</span>open1<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>DIST_L2<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n\nret<span class=\"token punctuation\">,</span> fg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>threshold<span class=\"token punctuation\">(</span>dist<span class=\"token punctuation\">,</span> <span class=\"token number\">0.7</span> <span class=\"token operator\">*</span> dist<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>THRESH_BINARY<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># plt.imshow(dist, cmap='gray')</span>\n<span class=\"token comment\"># plt.show()</span>\n<span class=\"token comment\"># exit()</span>\n\n<span class=\"token comment\"># 获取未知域</span>\nfg <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">(</span>fg<span class=\"token punctuation\">)</span>\nunknown <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>subtract<span class=\"token punctuation\">(</span>bg<span class=\"token punctuation\">,</span> fg<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 创建连通域</span>\nret<span class=\"token punctuation\">,</span> marker <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>connectedComponents<span class=\"token punctuation\">(</span>fg<span class=\"token punctuation\">)</span>\n\nmarker <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\nmarker<span class=\"token punctuation\">[</span>unknown <span class=\"token operator\">==</span> <span class=\"token number\">255</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n<span class=\"token comment\"># 进行分割</span>\nresult <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>watershed<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> marker<span class=\"token punctuation\">)</span>\nimg<span class=\"token punctuation\">[</span>result <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># cv2.imshow('thresh', thresh)</span>\n<span class=\"token comment\"># cv2.imshow('bg', bg)</span>\n<span class=\"token comment\"># cv2.imshow('dist', dist)</span>\n<span class=\"token comment\"># cv2.imshow('fg', fg)</span>\n<span class=\"token comment\"># cv2.imshow('unknown', unknown)</span>\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">,</span> img<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<h3><a id=\"12_GrabCut_218\"></a>1.2 GrabCut法</h3>\n<p>GrabCut：通过交互的方式获得前景物体。</p>\n<p><strong>基本原理：</strong></p>\n<p>（1）：用户可以指定前景的大体区域，剩下的为背景区域。</p>\n<p>（2）：用户还可以明确指定某些地方为前景或背景。</p>\n<p>（3）：GrabCut采用分段迭代的方法分析前景物体形成模型树。</p>\n<p>（3）：最后根据权重决定某个像素是前景还是背景。</p>\n<p><strong>实战步骤：</strong></p>\n<p>（1）：主体结构</p>\n<p>（2）：鼠标事件的处理</p>\n<p>（3）：调用GrabCut实现图像分割</p>\n<p><strong>1、主体结构：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">onmouse</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> flags<span class=\"token punctuation\">,</span> param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'onmouse'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'run'</span><span class=\"token punctuation\">)</span>\n\n        cv2<span class=\"token punctuation\">.</span>namedWindow<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>setMouseCallback<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>onmouse<span class=\"token punctuation\">)</span>\n\n        img <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/lena.bmp'</span><span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> img<span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nApp<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"https://img-blog.csdnimg.cn/7978a48342b1409ba6acf04b41bc6a60.gif#pic_left\"/></p>\n<p><strong>2、鼠标事件的处理</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">:</span>\n    flag_rect <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\n    startX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    startY <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">onmouse</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> flags<span class=\"token punctuation\">,</span> param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> event <span class=\"token operator\">==</span> cv2<span class=\"token punctuation\">.</span>EVENT_LBUTTONDOWN<span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>flag_rect <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n            self<span class=\"token punctuation\">.</span>startX <span class=\"token operator\">=</span> x\n            self<span class=\"token punctuation\">.</span>startY <span class=\"token operator\">=</span> y\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'LBUTTONDOWN: 左键按下'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> event <span class=\"token operator\">==</span> cv2<span class=\"token punctuation\">.</span>EVENT_LBUTTONUP<span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>flag_rect <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\n            cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>startX<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>startY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'LBUTTONUP: 左键抬起'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> event <span class=\"token operator\">==</span> cv2<span class=\"token punctuation\">.</span>EVENT_MOUSEMOVE<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>flag_rect <span class=\"token operator\">==</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n                self<span class=\"token punctuation\">.</span>img <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>img2<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>startX<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>startY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MOUSEMOVE: 鼠标移动'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'onmouse'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'run'</span><span class=\"token punctuation\">)</span>\n\n        cv2<span class=\"token punctuation\">.</span>namedWindow<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>setMouseCallback<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>onmouse<span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>img <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/lena.bmp'</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>img2 <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">)</span>\n            key <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token number\">27</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">break</span>\n\nApp<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"https://img-blog.csdnimg.cn/817357e7c3c74c5893bb165ce082393e.gif#pic_left\"/></p>\n<p><strong>3、调用GrabCut实现图像分割</strong></p>\n<p><strong><code>grabCut()</code>用法：</strong></p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>grabCut<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> mask<span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">,</span> bgdModel<span class=\"token punctuation\">,</span> fgdModel<span class=\"token punctuation\">,</span> iterCount<span class=\"token punctuation\">,</span> mode<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>mask：生成的掩码 \n  <ul><li>BGD：背景，0</li><li>FGD：前景，1</li><li>PR_BGD：可能是背景，2</li><li>PR_FGD：可能是前景，3</li></ul> </li><li>bgdModel, fgdModel：np.float64 type zero arrays of size(1, 65)</li><li>mode：模式 \n  <ul><li>GC_INIT_WITH_RECT：指定某个区域，即在该区域中找前景</li><li>GC_INIT_WITH_MASK：如果是第二次或第三次，可使用该参数再次迭代</li></ul> </li></ul>\n<p><strong>代码实现（完整代码）：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">:</span>\n    flag_rect <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\n    rect <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n    startX <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    startY <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">onmouse</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> event<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> flags<span class=\"token punctuation\">,</span> param<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> event <span class=\"token operator\">==</span> cv2<span class=\"token punctuation\">.</span>EVENT_LBUTTONDOWN<span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>flag_rect <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\n            self<span class=\"token punctuation\">.</span>startX <span class=\"token operator\">=</span> x\n            self<span class=\"token punctuation\">.</span>startY <span class=\"token operator\">=</span> y\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'LBUTTONDOWN: 左键按下'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> event <span class=\"token operator\">==</span> cv2<span class=\"token punctuation\">.</span>EVENT_LBUTTONUP<span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>flag_rect <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\n            cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>startX<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>startY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n            self<span class=\"token punctuation\">.</span>rect <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>startX<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>startY<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">abs</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>startX <span class=\"token operator\">-</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">abs</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>startY <span class=\"token operator\">-</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'LBUTTONUP: 左键抬起'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">elif</span> event <span class=\"token operator\">==</span> cv2<span class=\"token punctuation\">.</span>EVENT_MOUSEMOVE<span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>flag_rect <span class=\"token operator\">==</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n                self<span class=\"token punctuation\">.</span>img <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>img2<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>startX<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>startY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MOUSEMOVE: 鼠标移动'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'onmouse'</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'run'</span><span class=\"token punctuation\">)</span>\n\n        cv2<span class=\"token punctuation\">.</span>namedWindow<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span>\n        cv2<span class=\"token punctuation\">.</span>setMouseCallback<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>onmouse<span class=\"token punctuation\">)</span>\n\n        self<span class=\"token punctuation\">.</span>img <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/lena.bmp'</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>img2 <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>mask <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span>np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>output <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>uint8<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">)</span>\n            cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'output'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">)</span>\n            key <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token number\">27</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">break</span>\n\n            <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token builtin\">ord</span><span class=\"token punctuation\">(</span><span class=\"token string\">'g'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                bgdModel <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">65</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>float64<span class=\"token punctuation\">)</span>\n                fgdModel <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">65</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>float64<span class=\"token punctuation\">)</span>\n                cv2<span class=\"token punctuation\">.</span>grabCut<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>img2<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>mask<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>rect<span class=\"token punctuation\">,</span> bgdModel<span class=\"token punctuation\">,</span> fgdModel<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>GC_INIT_WITH_RECT<span class=\"token punctuation\">)</span>\n            mask2 <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>where<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>mask <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>mask <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>astype<span class=\"token punctuation\">(</span><span class=\"token string\">'uint8'</span><span class=\"token punctuation\">)</span>\n            self<span class=\"token punctuation\">.</span>output <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>bitwise_and<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>img2<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>img2<span class=\"token punctuation\">,</span> mask<span class=\"token operator\">=</span>mask2<span class=\"token punctuation\">)</span>\n\nApp<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"https://img-blog.csdnimg.cn/4f40c0dbf49b4033acebda2142f9a643.gif#pic_left\"/></p>\n<h3><a id=\"13_MeanShift_391\"></a>1.3 MeanShift法</h3>\n<p>严格来说，该方法并不是用来对图像分割的，而是在色彩层面的平滑滤波。</p>\n<p>它会中和色彩分布相近的颜色，平滑色彩细节，侵蚀掉面积较小的颜色区域。以图像上任一点p为圆心，半径为sp，色彩幅值为sr进行不断的迭代。</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\1af129071ec84f0fa6bce8e162532a33.png\"/></p>\n<p><strong><code>pyrMeanShiftFiltering()</code>用法：</strong></p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>pyrMeanShiftFiltering<span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> sp<span class=\"token punctuation\">,</span> sr<span class=\"token punctuation\">,</span> dst<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> maxLevel<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> termcrit<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>sp：圆的半径</li><li>sp：色彩幅值</li></ul>\n<p><strong>代码实现：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> cv2\n\nimg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/flower.png'</span><span class=\"token punctuation\">)</span>\n\nimg_mean <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>pyrMeanShiftFiltering<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span>\nimg_canny <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>Canny<span class=\"token punctuation\">(</span>img_mean<span class=\"token punctuation\">,</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span>\n\ncontours<span class=\"token punctuation\">,</span> _ <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>findContours<span class=\"token punctuation\">(</span>img_canny<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>RETR_EXTERNAL<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>CHAIN_APPROX_SIMPLE<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>drawContours<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> contours<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">,</span> img<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img_mean'</span><span class=\"token punctuation\">,</span> img_mean<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img_canny'</span><span class=\"token punctuation\">,</span> img_canny<span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\01500f50043d410abb1e2cbfeeddc342.png\"/></p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\98d67f2edae54e5088b8bacf73aaeaa9.png\"/></p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\7b346e464b454fd6b1c0dd721b9dcd1d.png\"/></p>\n<h2><a id=\"2_440\"></a>2、视频前后景分离(视频背景抠图)</h2>\n<p><strong>原视频：</strong></p>\n<p></p>\n<div class=\"csdn-video-box\">\n<iframe allowfullscreen=\"true\" data-mediaembed=\"csdn\" id=\"iaqTehq7-1662470792891\" src=\"https://live.csdn.net/v/embed/237110\"></iframe>\n<p></p>\n</div>\n<p></p>\n<p><strong>原理：</strong></p>\n<ul><li>视频是一组连续的帧（一幅幅图组成）</li><li>帧与帧之间关系密切（GOP）</li><li>在GOP中，背景几乎是不变的</li></ul>\n<p><strong>MOG去背景：</strong> 混合高斯模型为基础的前景/背景分割算法</p>\n<p><strong><code>createBackgroundSubtractorMOG()</code>用法：</strong></p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>bgsegm<span class=\"token punctuation\">.</span>createBackgroundSubtractorMOG<span class=\"token punctuation\">(</span>history<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> nmixtures<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> backgroundRatio<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> noiseSigma<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>history：参考帧，默认 200</li><li>nmixtures：高斯范围值，默认 5</li><li>backgroundRatio：背景比率，默认 0.7</li><li>noiseSigma：自动降噪，默认 0</li></ul>\n<p><strong>代码实现：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> cv2\n\ncap <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>VideoCapture<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/Car.mp4'</span><span class=\"token punctuation\">)</span>\n\nmog <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>bgsegm<span class=\"token punctuation\">.</span>createBackgroundSubtractorMOG<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    ret<span class=\"token punctuation\">,</span> frame <span class=\"token operator\">=</span> cap<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    fgmask <span class=\"token operator\">=</span> mog<span class=\"token punctuation\">.</span><span class=\"token builtin\">apply</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">)</span>\n\n    cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">,</span> fgmask<span class=\"token punctuation\">)</span>\n\n    key <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token number\">27</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span>\n\ncap<span class=\"token punctuation\">.</span>release<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"https://img-blog.csdnimg.cn/5802485d9c1848cf892348a1cc94de58.gif#pic_left\"/></p>\n<h3><a id=\"31_MOG2_497\"></a>3.1 MOG2去背景</h3>\n<p>同MOG类似，不过对亮度产生的阴影有更好的识别.</p>\n<p><strong><code>createBackgroundSubtractorMOG2()</code>用法：</strong></p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>createBackgroundSubtractorMOG2<span class=\"token punctuation\">(</span>history<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> varThreshold<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> detectShadows<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>history：参数帧，默认 500</li><li>detectShadows：是否检测阴影，默认 True</li></ul>\n<p><strong>代码实现：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> cv2\n\ncap <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>VideoCapture<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/Car.mp4'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 优点: 可以计算出阴影部分</span>\n<span class=\"token comment\"># 缺点: 会产生很多噪点</span>\nmog2 <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>createBackgroundSubtractorMOG2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    ret<span class=\"token punctuation\">,</span> frame <span class=\"token operator\">=</span> cap<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    fgmask <span class=\"token operator\">=</span> mog2<span class=\"token punctuation\">.</span><span class=\"token builtin\">apply</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">)</span>\n\n    cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">,</span> fgmask<span class=\"token punctuation\">)</span>\n\n    key <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token number\">27</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span>\n\ncap<span class=\"token punctuation\">.</span>release<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"https://img-blog.csdnimg.cn/ce4ca504a6ef41f4a2408e30e1eafbab.gif#pic_left\"/></p>\n<h3><a id=\"32_GMG_538\"></a>3.2 GMG去背景</h3>\n<p>静态背景图像估计和每个像素的贝叶斯分割，抗噪性更强。</p>\n<p><strong><code>createBackgroundSubtractorGMG()</code>用法：</strong></p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>bgsegm<span class=\"token punctuation\">.</span>createBackgroundSubtractorGMG<span class=\"token punctuation\">(</span>initializationFrames<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> decisionThreshold<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>initializationFrames：初始帧数，默认 120</li></ul>\n<p><strong>代码实现：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> cv2\n\ncap <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>VideoCapture<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/Car.mp4'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 优点: 可以算出阴影部分,同时减少了噪点</span>\n<span class=\"token comment\"># 缺点: 如果采用默认值,则在开始会有很长时间不显示</span>\ngmg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>bgsegm<span class=\"token punctuation\">.</span>createBackgroundSubtractorGMG<span class=\"token punctuation\">(</span>initializationFrames<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 解决办法: 调整初始参考帧的数量</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    ret<span class=\"token punctuation\">,</span> frame <span class=\"token operator\">=</span> cap<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    fgmask <span class=\"token operator\">=</span> gmg<span class=\"token punctuation\">.</span><span class=\"token builtin\">apply</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">)</span>\n\n    cv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">,</span> fgmask<span class=\"token punctuation\">)</span>\n\n    key <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> key <span class=\"token operator\">==</span> <span class=\"token number\">27</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">break</span>\n\ncap<span class=\"token punctuation\">.</span>release<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"https://img-blog.csdnimg.cn/ccda53dcf5a5464cbc356d6a470f1c71.gif#pic_left\"/></p>\n<h2><a id=\"3_583\"></a>3、图像修复</h2>\n<p>图像修复效果：</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\caad3ef2366748859c09acb6d3bdfb6f.png\"/></p>\n<p><strong><code>inpaint()</code>用法：</strong></p>\n<pre><code class=\"prism language-python\">cv2<span class=\"token punctuation\">.</span>inpaint<span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> inpaintMask<span class=\"token punctuation\">,</span> inpaintRadius<span class=\"token punctuation\">,</span> flags<span class=\"token punctuation\">,</span> dst<span class=\"token punctuation\">:</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>参数说明：</strong></p>\n<ul><li>inpaintMask：修复掩码</li><li>inpaintRadius：每个点的圆形领域半径</li><li>flags： \n  <ul><li>INPAINT_NS</li><li>INPAINT_TELEA</li></ul> </li><li>dst：输出与src具有相同大小和类型的图像</li></ul>\n<p><strong>代码实现：</strong></p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">import</span> cv2\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\nimg <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/cvLogo_Ori.png'</span><span class=\"token punctuation\">)</span>\nmask <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span><span class=\"token string\">'../resource/cvLogo_Mask.png'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\ndst <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>inpaint<span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> mask<span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>INPAINT_TELEA<span class=\"token punctuation\">)</span>\n\ncv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>hstack<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> dst<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\ncv2<span class=\"token punctuation\">.</span>destroyAllWindows<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\c5ae69aae77f4ab68400433401ff652e.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-06 21:26:47", "summary": "文章目录十四、图像分割与修复、图像分割分水岭法法法、视频前后景分离视频背景抠图去背景去背景、图像修复十四、图像分割与修复、图像分割图像分割：将前景物体从背景中分离出来。图像分割的方法：传统的图像分割方"}