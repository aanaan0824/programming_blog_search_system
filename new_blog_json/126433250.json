{"blogid": "126433250", "writerAge": "码龄100天", "writerBlogNum": "125", "writerCollect": "1178", "writerComment": "1773", "writerFan": "1157", "writerGrade": "6级", "writerIntegral": "5056", "writerName": "林有酒", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126433250.jpg", "writerRankTotal": "3492", "writerRankWeekly": "55", "writerThumb": "1203", "writerVisitNum": "21419", "blog_read_count": "71", "blog_time": "于 2022-09-06 00:00:00 发布", "blog_title": "【小程序】常见系统API | 页面分享 | 位置信息 | 本地存储", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><ul><li><a href=\"#API_1\">常见系统API</a></li><li><ul><li><a href=\"#_2\">页面分享的基本介绍</a></li><li><a href=\"#_39\">设备信息和位置信息</a></li><li><a href=\"#Storage_83\">小程序Storage存储</a></li></ul>\n</li></ul>\n</li></ul>\n</div>\n<p></p>\n<h2><a id=\"API_1\"></a>常见系统API</h2>\n<h3><a id=\"_2\"></a>页面分享的基本介绍</h3>\n<p><strong>分享是小程序扩散的一种重要方式，小程序中有两种分享方式</strong>：</p>\n<blockquote>\n<p>方式一：点击右上角的菜单按钮，之后点击转发</p>\n<p>方式二：点击某一个按钮，直接转发</p>\n</blockquote>\n<p><strong>当我们转发给好友一个小程序时，通常小程序中会显示一些信息</strong>:</p>\n<blockquote>\n<p>如何决定这些信息的展示呢？通过 <code>onShareAppMessage</code></p>\n<p><code>onShareAppMessage</code>是监听用户点击页面内转发按钮（button 组件 open-type= “share”）或右上角菜单“转发”按钮回调的函数，并自定义转发内容。</p>\n<p>此事件处理函数需要 return 一个 Object，用于自定义转发内容；</p>\n</blockquote>\n<table><thead><tr><th align=\"left\">属性</th><th align=\"left\">类型</th><th align=\"left\">说明</th></tr></thead><tbody><tr><td align=\"left\">title</td><td align=\"left\">string</td><td align=\"left\">转发标题，不传则默认使用当前小游戏的昵称。</td></tr><tr><td align=\"left\">imageUrl</td><td align=\"left\">string</td><td align=\"left\">转发显示图片的链接，可以是网络图片路径或本地图片文件路径或相对代码包根目录的图片文件路径。显示图片长宽比是 5:4</td></tr><tr><td align=\"left\">query</td><td align=\"left\">string</td><td align=\"left\">查询字符串，必须是 key1=val1&amp;key2=val2 的格式。从这条转发消息进入后，可通过 wx.getLaunchOptionsSync() 或 wx.onShow() 获取启动参数中的 query。</td></tr><tr><td align=\"left\">imageUrlId</td><td align=\"left\">string</td><td align=\"left\">审核通过的图片 ID，详见使用审核通过的转发图片</td></tr><tr><td align=\"left\">promise</td><td align=\"left\">promise</td><td align=\"left\">如果该参数存在，则其它的参数将会以 resolve 结果为准，如果三秒内不 resolve，分享会使用上面传入的默认参数</td></tr><tr><td align=\"left\">toCurrentGroup</td><td align=\"left\">boolean</td><td align=\"left\">是否转发到当前群。该参数只对从群工具栏打开的场景下生效，默认转发到当前群，填入 false 时可转发到其他会话。</td></tr></tbody></table>\n<pre><code class=\"prism language-js\"><span class=\"token function\">onShareAppMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"我是分享的标题\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/pages/index/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">imageUrl</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/assets/zznh.png\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<hr/>\n<h3><a id=\"_39\"></a>设备信息和位置信息</h3>\n<p><strong>获取设备信息</strong></p>\n<blockquote>\n<p>在开发中，我们需要经常获取当前设备的信息，用于手机信息或者进行一些适配工作。</p>\n<p>小程序提供了相关个API： <code>wx.getSystemInfo(Object object)</code></p>\n</blockquote>\n<pre><code class=\"prism language-js\">wx<span class=\"token punctuation\">.</span><span class=\"token function\">getSystemInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>获取位置信息</strong></p>\n<blockquote>\n<p>开发中我们需要经常获取用户的位置信息，以方便给用户提供相关的服务：</p>\n<p>我们可以通过API获取： <code>wx.getLocation(Object object)</code></p>\n</blockquote>\n<pre><code class=\"prism language-js\">wx<span class=\"token punctuation\">.</span><span class=\"token function\">getLocation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>成功回调res中包含下面一些信息</strong></p>\n<table><thead><tr><th align=\"left\">属性</th><th align=\"left\">类型</th><th align=\"left\">说明</th></tr></thead><tbody><tr><td align=\"left\">latitude</td><td align=\"left\">number</td><td align=\"left\">纬度，范围为 -90~90，负数表示南纬</td></tr><tr><td align=\"left\">longitude</td><td align=\"left\">number</td><td align=\"left\">经度，范围为 -180~180，负数表示西经</td></tr><tr><td align=\"left\">speed</td><td align=\"left\">number</td><td align=\"left\">速度，单位 m/s</td></tr><tr><td align=\"left\">accuracy</td><td align=\"left\">number</td><td align=\"left\">位置的精确度，反应与真实位置之间的接近程度，可以理解成10即与真实位置相差10m，越小越精确</td></tr><tr><td align=\"left\">altitude</td><td align=\"left\">number</td><td align=\"left\">高度，单位 m</td></tr><tr><td align=\"left\">verticalAccuracy</td><td align=\"left\">number</td><td align=\"left\">垂直精度，单位 m（Android 无法获取，返回 0）</td></tr><tr><td align=\"left\">horizontalAccuracy</td><td align=\"left\">number</td><td align=\"left\">水平精度，单位 m</td></tr></tbody></table>\n<hr/>\n<h3><a id=\"Storage_83\"></a>小程序Storage存储</h3>\n<p><strong>在开发中，某些常见我们需要将一部分数据存储在本地：比如token、用户信息等</strong>。</p>\n<blockquote>\n<p>小程序提供了专门的Storage用于进行本地存储。</p>\n</blockquote>\n<p><strong>同步存取数据的方法</strong>：</p>\n<blockquote>\n<p>存入: wx.setStorageSync(string key, any data)</p>\n<p>取出: any wx.getStorageSync(string key)</p>\n<p>移除: wx.removeStorageSync(string key)</p>\n<p>清空: wx.clearStorageSync()</p>\n</blockquote>\n<pre><code class=\"prism language-js\"><span class=\"token comment\">// 存入数据</span>\nwx<span class=\"token punctuation\">.</span><span class=\"token function\">setStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"chenyq\"</span><span class=\"token punctuation\">)</span>\nwx<span class=\"token punctuation\">.</span><span class=\"token function\">setStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 取出数据</span>\n<span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> wx<span class=\"token punctuation\">.</span><span class=\"token function\">getStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> age <span class=\"token operator\">=</span> wx<span class=\"token punctuation\">.</span><span class=\"token function\">getStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"age\"</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>age<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 删除数据</span>\nwx<span class=\"token punctuation\">.</span><span class=\"token function\">removeStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 清空数据</span>\nwx<span class=\"token punctuation\">.</span><span class=\"token function\">clearStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>异步存储数据的方法</strong>：注意传入的是对象</p>\n<blockquote>\n<p>wx.setStorage(Object object)</p>\n<p>wx.getStorage(Object object)</p>\n<p>wx.removeStorage(Object object)</p>\n<p>wx.clearStorage(Object object)</p>\n</blockquote>\n<pre><code class=\"prism language-js\"><span class=\"token comment\">// 存入数据</span>\n\t\twx<span class=\"token punctuation\">.</span><span class=\"token function\">setStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">\"names\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"aaa\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bbb\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ccc\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token comment\">// 存入成功的回调</span>\n\t\t\t<span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token comment\">// 取出数据</span>\n\t\t<span class=\"token keyword\">const</span> names <span class=\"token operator\">=</span> wx<span class=\"token punctuation\">.</span><span class=\"token function\">getStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">\"names\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token comment\">// 删除数据</span>\n\t\twx<span class=\"token punctuation\">.</span><span class=\"token function\">removeStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t<span class=\"token literal-property property\">key</span><span class=\"token operator\">:</span> <span class=\"token string\">\"names\"</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token comment\">// 清空数据</span>\n\t\twx<span class=\"token punctuation\">.</span><span class=\"token function\">clearStorage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><strong>区别: 同步和异步的区别就是, 同步存取代码执行完成后, 可以立即获取数据, 而异步代码执行完成, 不能保证可以立即获取到数据</strong></p>\n<blockquote>\n<p>如果是存完之后就要使用, 那么使用同步存取</p>\n<p>如果只是想存入一个数据, 那么使用异步操作</p>\n</blockquote>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-06 00:00:00", "summary": "文章目录常见系统页面分享的基本介绍设备信息和位置信息小程序存储常见系统页面分享的基本介绍分享是小程序扩散的一种重要方式，小程序中有两种分享方式：方式一：点击右上角的菜单按钮，之后点击转发方式二：点击某"}