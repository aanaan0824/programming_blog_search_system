{"blogid": "123482751", "writerAge": "码龄7年", "writerBlogNum": "327", "writerCollect": "3192", "writerComment": "197", "writerFan": "19011", "writerGrade": "6级", "writerIntegral": "8025", "writerName": "小薛引路", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123482751.jpg", "writerRankTotal": "2664", "writerRankWeekly": "1758", "writerThumb": "538", "writerVisitNum": "579839", "blog_read_count": "3372", "blog_time": "于 2022-03-14 17:18:56 发布", "blog_title": "C#编程学习49：将数据写入到excel中", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>本文为</p>\n<p><a href=\"https://blog.csdn.net/m1m2m3mmm/article/details/96010380\" title=\"C#编程学习27: C#操作Excel从入门到精通_m1m2m3mmm的博客-CSDN博客\">C#编程学习27: C#操作Excel从入门到精通_m1m2m3mmm的博客-CSDN博客</a></p>\n<p>中单独提炼出的新建Excel文件并导出数据的专门总结；更全面的总结可以上一篇。</p>\n<hr/>\n<p></p>\n<h1>1 添加引用及名称空间</h1>\n<p>添加引用</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\20190711134727344.png\"/><span title=\"点击并拖拽以改变尺寸\">​</span></p>\n<p>添加名称空间</p>\n<div>\n<pre><code class=\"hljs language-cs\"><span class=\"hljs-comment\">//用到的名空间</span>\n<span class=\"hljs-keyword\">using</span> Excel = Microsoft.Office.Interop.Excel;\n<span class=\"hljs-keyword\">using</span> System.Runtime.InteropServices;<span class=\"hljs-comment\">//导入dll</span>\n</code></pre>\n</div>\n<h1>2 实现代码及逻辑</h1>\n<h2>2.1 代码框架</h2>\n<p>这段代码主要干了以下几个事情：</p>\n<ul><li>创建excel应用，关闭excel；</li><li>在excel中创建workbook，<span style=\"color:#fe2c24;\"><strong>对于本身不存在需要程序新创建的excel文件，不能使用myApp.Workbooks.Open(str)方法，否则会报 HRESULT:0x800A03EC异常</strong></span></li><li>并在workbook中添加worksheets</li><li>将worksheets另存为指定目录</li><li>关闭workbook</li></ul>\n<div>\n<pre><code class=\"hljs language-cs\"><span class=\"hljs-comment\">//打开实验数据</span>\n<span class=\"hljs-built_in\">string</span> str = <span class=\"hljs-string\">@\"E:\\C#\\Example200\\LearnExcel\\LearnExcel\\data.xlsx\"</span>;\nExcel.Workbook wb = myApp.Workbooks.Add(<span class=\"hljs-literal\">true</span>);\nExcel.WorkShee ws = myApp.WorkSheets.Add();\n \n \n \n<span class=\"hljs-comment\">//....</span>\n \nws.SaveAs(str);\n<span class=\"hljs-comment\">//关闭数据表</span>\nwb.Close();\n \nmyApp.Quit();\nmyApp = <span class=\"hljs-literal\">null</span>;\nSystem.Runtime.InteropServices.Marshal.ReleaseComObject(myApp);</code></pre>\n</div>\n<h2>2.2 创建数据表</h2>\n<p>一般我们汇报数据保存在DataTable对象中，这一部分我们介绍DataTable使用的一些基本知识。</p>\n<ul><li>创建DataTable对象并生成列头</li></ul>\n<div>\n<pre><code class=\"hljs language-cs\">            DataTable dt = <span class=\"hljs-keyword\">new</span> DataTable();\n            <span class=\"hljs-comment\">//添加表头</span>\n            dt.Columns.Add(<span class=\"hljs-string\">\"姓名\"</span>);\n            dt.Columns.Add(<span class=\"hljs-string\">\"年龄\"</span>);\n            dt.Columns.Add(<span class=\"hljs-string\">\"性别\"</span>);\n            </code></pre>\n</div>\n<ul><li>创建新行并将其添加到DataTable对象中</li></ul>\n<div>\n<pre><code class=\"hljs language-cs\">DataRow dr = dt.NewRow();\ndr[<span class=\"hljs-string\">\"姓名\"</span>] = <span class=\"hljs-string\">\"张三\"</span>;\ndr[<span class=\"hljs-string\">\"年龄\"</span>] = <span class=\"hljs-string\">\"18\"</span>;\ndr[<span class=\"hljs-string\">\"性别\"</span>] = <span class=\"hljs-string\">\"女\"</span>;\ndt.Rows.Add(dr);\n\n</code></pre>\n</div>\n<h2>2.3 将DataTable对象写入到worksheets中</h2>\n<ul><li>在第一行写表头文字</li></ul>\n<div>\n<pre><code class=\"hljs language-cs\">ws.Cells[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>] = <span class=\"hljs-string\">\"姓名\"</span>;\nws.Cells[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>] = <span class=\"hljs-string\">\"年龄\"</span>;\nws.Cells[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">3</span>] = <span class=\"hljs-string\">\"性别\"</span>;</code></pre>\n</div>\n<ul><li>将dt对象的数据写入excel，<span style=\"color:#fe2c24;\"><strong>注意在Excel中，行和列的编号是从1开始的</strong></span></li></ul>\n<div>\n<pre><code class=\"hljs language-cs\">            <span class=\"hljs-built_in\">int</span> rowIndex = <span class=\"hljs-number\">2</span>;\n            <span class=\"hljs-keyword\">foreach</span> (DataRow row <span class=\"hljs-keyword\">in</span> dt.Rows)\n            {\n                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-built_in\">int</span> colIndex = <span class=\"hljs-number\">0</span>; colIndex &lt; dt.Columns.Count; colIndex++)\n                {\n                    ws.Cells[rowIndex, colIndex + <span class=\"hljs-number\">1</span>] = row[colIndex].ToString();\n                }\n                rowIndex++;\n            }\n</code></pre>\n</div>\n<h1>3 完整代码</h1>\n<div>\n<pre><code class=\"hljs language-cs\"><span class=\"hljs-comment\">//打开实验数据</span>\n<span class=\"hljs-built_in\">string</span> str = <span class=\"hljs-string\">@\"E:\\C#\\Example200\\LearnExcel\\LearnExcel\\data.xlsx\"</span>;\nExcel.Workbook wb = myApp.Workbooks.Add(<span class=\"hljs-literal\">true</span>);\nExcel.WorkShee ws = myApp.WorkSheets.Add();\n \nDataTable dt = <span class=\"hljs-keyword\">new</span> DataTable();\n<span class=\"hljs-comment\">//添加表头</span>\ndt.Columns.Add(<span class=\"hljs-string\">\"姓名\"</span>);\ndt.Columns.Add(<span class=\"hljs-string\">\"年龄\"</span>);\ndt.Columns.Add(<span class=\"hljs-string\">\"性别\"</span>); \n \n<span class=\"hljs-comment\">// 添加一行数据</span>\nDataRow dr = dt.NewRow();\ndr[<span class=\"hljs-string\">\"姓名\"</span>] = <span class=\"hljs-string\">\"张三\"</span>;\ndr[<span class=\"hljs-string\">\"年龄\"</span>] = <span class=\"hljs-string\">\"18\"</span>;\ndr[<span class=\"hljs-string\">\"性别\"</span>] = <span class=\"hljs-string\">\"女\"</span>;\ndt.Rows.Add(dr);\n\n<span class=\"hljs-comment\">// 往表格中写入第一行数据，即表头</span>\nws.Cells[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>] = <span class=\"hljs-string\">\"姓名\"</span>;\nws.Cells[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>] = <span class=\"hljs-string\">\"年龄\"</span>;\nws.Cells[<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">3</span>] = <span class=\"hljs-string\">\"性别\"</span>;\n\n<span class=\"hljs-comment\">// 往表格中写入数据行</span>\n<span class=\"hljs-built_in\">int</span> rowIndex = <span class=\"hljs-number\">2</span>;\n<span class=\"hljs-keyword\">foreach</span> (DataRow row <span class=\"hljs-keyword\">in</span> dt.Rows)\n{\n      <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-built_in\">int</span> colIndex = <span class=\"hljs-number\">0</span>; colIndex &lt; dt.Columns.Count; colIndex++)\n      {\n          ws.Cells[rowIndex, colIndex + <span class=\"hljs-number\">1</span>] = row[colIndex].ToString();\n      }\n      rowIndex++;\n}\n\nws.SaveAs(str);\n<span class=\"hljs-comment\">//关闭数据表</span>\nwb.Close();\n \nmyApp.Quit();\nmyApp = <span class=\"hljs-literal\">null</span>;\nSystem.Runtime.InteropServices.Marshal.ReleaseComObject(myApp);</code></pre>\n</div>\n<p></p>\n</div>\n</div>", "first_tag": "C#", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-03-14 17:18:56", "summary": "本文为编程学习操作从入门到精通的博客博客编程学习操作从入门到精通的博客博客中单独提炼出的新建文件并导出数据的专门总结；更全面的总结可以上一篇。添加引用及名称空间添加引用点击并拖拽以改变尺寸添加名称空间"}