{"blogid": "125095346", "writerAge": "码龄4年", "writerBlogNum": "23", "writerCollect": "379", "writerComment": "137", "writerFan": "1540", "writerGrade": "3级", "writerIntegral": "566", "writerName": "大屁桃", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125095346.jpg", "writerRankTotal": "48613", "writerRankWeekly": "9715", "writerThumb": "168", "writerVisitNum": "38085", "blog_read_count": "817", "blog_time": "已于 2022-06-02 10:41:56 修改", "blog_title": "【STM32基础】第三篇、ADC的快速上手", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E3%80%81%E5%85%B3%E4%BA%8EADC%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E3%80%81%E5%85%B3%E4%BA%8EADC%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86\">第一部分、关于ADC的基础知识</a></p>\n<p id=\"1%E3%80%81STM32ADC%E6%98%AF%E5%A4%9A%E5%B0%91%E4%BD%8D%E7%9A%84%EF%BC%9F-toc\" style=\"margin-left:80px;\"><a href=\"#1%E3%80%81STM32ADC%E6%98%AF%E5%A4%9A%E5%B0%91%E4%BD%8D%E7%9A%84%EF%BC%9F\">1、STM32ADC是多少位的？</a></p>\n<p id=\"2%E3%80%81STM32ADCADC%E5%8F%82%E8%80%83%E7%94%B5%E5%8E%8B%E4%B8%BA%E5%A4%9A%E5%B0%91%EF%BC%9F-toc\" style=\"margin-left:80px;\"><a href=\"#2%E3%80%81STM32ADCADC%E5%8F%82%E8%80%83%E7%94%B5%E5%8E%8B%E4%B8%BA%E5%A4%9A%E5%B0%91%EF%BC%9F\">2、STM32ADCADC参考电压为多少？</a></p>\n<p id=\"3%E3%80%81%E5%8F%82%E8%80%83%E7%94%B5%E5%8E%8B%E4%B8%8EADC%E4%BD%8D%E6%95%B0%E7%9A%84%E8%BD%AC%E6%8D%A2%E5%85%B3%E7%B3%BB-toc\" style=\"margin-left:80px;\"><a href=\"#3%E3%80%81%E5%8F%82%E8%80%83%E7%94%B5%E5%8E%8B%E4%B8%8EADC%E4%BD%8D%E6%95%B0%E7%9A%84%E8%BD%AC%E6%8D%A2%E5%85%B3%E7%B3%BB\">3、参考电压与ADC位数的转换关系</a></p>\n<p id=\"4%E3%80%81ADC%E9%80%9A%E9%81%93%E5%AF%B9%E5%BA%94%E7%9A%84%E7%AB%AF%E5%8F%A3%EF%BC%88%E6%9D%A5%E8%87%AA%E9%87%8E%E7%81%AB%E7%9A%84%E6%96%87%E6%A1%A3%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#4%E3%80%81ADC%E9%80%9A%E9%81%93%E5%AF%B9%E5%BA%94%E7%9A%84%E7%AB%AF%E5%8F%A3%EF%BC%88%E6%9D%A5%E8%87%AA%E9%87%8E%E7%81%AB%E7%9A%84%E6%96%87%E6%A1%A3%EF%BC%89\">4、ADC通道对应的端口（来自野火的文档）</a></p>\n<p id=\"%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E3%80%81%E7%9B%B4%E6%8E%A5%E4%B8%8A%E6%89%8B%E7%9A%84%E5%A5%BD%E7%94%A8%E4%BB%A3%E7%A0%81-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E3%80%81%E7%9B%B4%E6%8E%A5%E4%B8%8A%E6%89%8B%E7%9A%84%E5%A5%BD%E7%94%A8%E4%BB%A3%E7%A0%81\">第二部分、直接上手的好用代码</a></p>\n<p id=\"1%E3%80%81adc.c%E6%96%87%E4%BB%B6-toc\" style=\"margin-left:80px;\"><a href=\"#1%E3%80%81adc.c%E6%96%87%E4%BB%B6\">1、adc.c文件</a></p>\n<p id=\"2%E3%80%81adc.h%E6%96%87%E4%BB%B6-toc\" style=\"margin-left:80px;\"><a href=\"#2%E3%80%81adc.h%E6%96%87%E4%BB%B6\">2、adc.h文件</a></p>\n<p id=\"3%E3%80%81main.h%E6%96%87%E4%BB%B6-toc\" style=\"margin-left:80px;\"><a href=\"#3%E3%80%81main.h%E6%96%87%E4%BB%B6\">3、main.h文件</a></p>\n<p id=\"%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E3%80%81%E6%80%BB%E7%BB%93-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E3%80%81%E6%80%BB%E7%BB%93\">第三部分、总结</a></p>\n<p></p>\n<h2 id=\"%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E3%80%81%E5%85%B3%E4%BA%8EADC%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86\">第一部分、关于ADC的基础知识</h2>\n<h3 id=\"1%E3%80%81STM32ADC%E6%98%AF%E5%A4%9A%E5%B0%91%E4%BD%8D%E7%9A%84%EF%BC%9F\">1、STM32ADC是多少位的？</h3>\n<p>        STM32f103 系列有 3 个 ADC，精度都为 ：<span style=\"color:#fe2c24;\"><strong>12 位</strong></span>。</p>\n<h3 id=\"2%E3%80%81STM32ADCADC%E5%8F%82%E8%80%83%E7%94%B5%E5%8E%8B%E4%B8%BA%E5%A4%9A%E5%B0%91%EF%BC%9F\">2、STM32ADCADC参考电压为多少？</h3>\n<p>        STM32C8T6的 ADC 的输入电压范围为：<span style=\"color:#fe2c24;\"> <strong>0~3.3V</strong></span>。</p>\n<h3 id=\"3%E3%80%81%E5%8F%82%E8%80%83%E7%94%B5%E5%8E%8B%E4%B8%8EADC%E4%BD%8D%E6%95%B0%E7%9A%84%E8%BD%AC%E6%8D%A2%E5%85%B3%E7%B3%BB\">3、参考电压与ADC位数的转换关系</h3>\n<p>        由上知STM32的 ADC是 12 位的，而最大电压为 3.3V，那么3.3V被分成了2^12这么多份。因此，如果ADC得到数值为 X ， 那么该X对应的模拟电压为 <strong><span style=\"color:#956fe7;\">Y = (3.3 / 2^12)* X</span></strong> 。</p>\n<h3 id=\"4%E3%80%81ADC%E9%80%9A%E9%81%93%E5%AF%B9%E5%BA%94%E7%9A%84%E7%AB%AF%E5%8F%A3%EF%BC%88%E6%9D%A5%E8%87%AA%E9%87%8E%E7%81%AB%E7%9A%84%E6%96%87%E6%A1%A3%EF%BC%89\">4、ADC通道对应的端口（来自野火的文档）</h3>\n<p>        想要了解关于ADC的细节知识，可以去看《零死角玩转 STM32—基于野火 F103开发板》这本书，强烈推荐新手去看。</p>\n<p class=\"img-center\"><img alt=\"\" height=\"433\" src=\"..\\..\\static\\image\\12a12364f2174d8c891c8c041e8c54a3.png\" width=\"762\"/></p>\n<h2 id=\"%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E3%80%81%E7%9B%B4%E6%8E%A5%E4%B8%8A%E6%89%8B%E7%9A%84%E5%A5%BD%E7%94%A8%E4%BB%A3%E7%A0%81\">第二部分、直接上手的好用代码</h2>\n<h3 id=\"1%E3%80%81adc.c%E6%96%87%E4%BB%B6\">1、adc.c文件</h3>\n<p>        这里把通道二和通道三给屏蔽 ，因为串口2的管脚刚好对应与PA2和PA3。</p>\n<pre><code class=\"language-cpp\">#include \"adc.h\"\n#include \"delay.h\" \n\nvoid ADC_init(u8 ADC_CHx)\n{    \n\tswitch(ADC_CHx)\n\t{\n\t\tcase ADC_CH0: RCC-&gt;APB2ENR|=1&lt;&lt;2; GPIOA-&gt;CRL&amp;=0XFFFFFFF0; break;  //PA0\n\t\tcase ADC_CH1: RCC-&gt;APB2ENR|=1&lt;&lt;2; GPIOA-&gt;CRL&amp;=0XFFFFFF0F; break;  //PA1\n//\t\tcase ADC_CH2: RCC-&gt;APB2ENR|=1&lt;&lt;2; GPIOA-&gt;CRL&amp;=0XFFFFF0FF; break;//PA2\n//\t\tcase ADC_CH3: RCC-&gt;APB2ENR|=1&lt;&lt;2; GPIOA-&gt;CRL&amp;=0XFFFF0FFF; break;//PA3\n\t\tcase ADC_CH4: RCC-&gt;APB2ENR|=1&lt;&lt;2; GPIOA-&gt;CRL&amp;=0XFFF0FFFF; break;  //PA4\n\t\tcase ADC_CH5: RCC-&gt;APB2ENR|=1&lt;&lt;2; GPIOA-&gt;CRL&amp;=0XFF0FFFFF; break;  //PA5\n\t\tcase ADC_CH6: RCC-&gt;APB2ENR|=1&lt;&lt;2; GPIOA-&gt;CRL&amp;=0XF0FFFFFF; break;  //PA6\n\t\tcase ADC_CH7: RCC-&gt;APB2ENR|=1&lt;&lt;2; GPIOA-&gt;CRL&amp;=0X0FFFFFFF; break;  //PA7\n\t\tcase ADC_CH8: RCC-&gt;APB2ENR|=1&lt;&lt;3; GPIOB-&gt;CRL&amp;=0XFFFFFFF0; break;  //PB0\n\t\tcase ADC_CH9: RCC-&gt;APB2ENR|=1&lt;&lt;3; GPIOB-&gt;CRL&amp;=0XFFFFFF0F; break;  //PB1\n\t\tcase ADC_CH10:RCC-&gt;APB2ENR|=1&lt;&lt;4; GPIOC-&gt;CRL&amp;=0XFFFFFFF0; break;  //PC0\n\t\tcase ADC_CH11:RCC-&gt;APB2ENR|=1&lt;&lt;4; GPIOC-&gt;CRL&amp;=0XFFFFFF0F; break;  //PC1\n\t\tcase ADC_CH12:RCC-&gt;APB2ENR|=1&lt;&lt;4; GPIOC-&gt;CRL&amp;=0XFFFFF0FF; break;  //PC2\n\t\tcase ADC_CH13:RCC-&gt;APB2ENR|=1&lt;&lt;4; GPIOC-&gt;CRL&amp;=0XFFFF0FFF; break;  //PC3\n\t\tcase ADC_CH14:RCC-&gt;APB2ENR|=1&lt;&lt;4; GPIOC-&gt;CRL&amp;=0XFFF0FFFF; break;  //PC4\n\t\tcase ADC_CH15:RCC-&gt;APB2ENR|=1&lt;&lt;4; GPIOC-&gt;CRL&amp;=0XFF0FFFFF; break;  //PC5\n\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//通道10/11设置\t\t\t \n\tRCC-&gt;APB2ENR|=1&lt;&lt;9;    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//ADC1时钟使能\t  \n\tRCC-&gt;APB2RSTR|=1&lt;&lt;9;   \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//ADC1复位\n\tRCC-&gt;APB2RSTR&amp;=~(1&lt;&lt;9);\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//复位结束\t    \n\tRCC-&gt;CFGR&amp;=~(3&lt;&lt;14);  \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//分频因子清零\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//否则将导致ADC准确度下降! \n\tRCC-&gt;CFGR|=2&lt;&lt;14;      \t \n\tADC1-&gt;CR1&amp;=0XF0FFFF;   \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//工作模式清零\n\tADC1-&gt;CR1|= 0&lt;&lt;16;\n\tADC1-&gt;CR1|= ~(1&lt;&lt;8);\n\tADC1-&gt;CR2|= 1&lt;&lt;20;\n\tADC1-&gt;CR2&amp;= ~(1&lt;&lt;1);\n\tADC1-&gt;CR2|= 7&lt;&lt;17;\n\tADC1-&gt;CR2&amp;=~(1&lt;&lt;11); \n\tADC1-&gt;SMPR2&amp;=~(7&lt;&lt;3);\n\tADC1-&gt;SQR1&amp;=~(0XF&lt;&lt;20);\n\tADC1-&gt;SQR1|=0&lt;&lt;20;  \n\tADC1-&gt;CR2|=1&lt;&lt;0;\t\n\tADC1-&gt;CR2|=1&lt;&lt;3;\n\twhile(ADC1-&gt;CR2&amp;(1&lt;&lt;3));\n\tADC1-&gt;CR2|=1&lt;&lt;2;\n\twhile(ADC1-&gt;CR2&amp;(1&lt;&lt;2));\n}\t\t\t\t  \n\n /**\n * @brief   \t\t得到ADC转换值函数\n * @code\n * // 得到ADC通道4值\n * Get_Adc(ADC_CH4);\n * @endcode\n * @param[in]   ADC_CHx ADC通道号：   值：ADC_CH0~ADC_CH15\n */\nu16 Get_Adc(u8 ADC_CHx)   \n{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//设置转换序列\t  \t\t \n\tADC1-&gt;SQR3&amp;=0XFFFFFFE0;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//规则序列1 通道ch\n\tADC1-&gt;SQR3|=ADC_CHx;\t\t  \t\t\t    \n\tADC1-&gt;CR2|=1&lt;&lt;22;       \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//启动规则转换通道 \n\twhile(!(ADC1-&gt;SR&amp;1&lt;&lt;1));\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//等待转换结束\t \t   \n\treturn ADC1-&gt;DR;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//返回adc值\t\n}\n\n /**\n * @brief   \t\t得到ADC转换平均值函数\n * @code\n * // 得到ADC通道4值，次数为20\n * Get_Adc_Average(ADC_CH4，20);\n * @endcode\n * @param[in]   ADC_CHx ADC通道号：   值：ADC_CH0~ADC_CH15\n * @param[in]   times  平均次数        \n */\nu16 Get_Adc_Average(u8 ADC_CHx,u8 times)\n{\n\tu32 temp_val=0;\n\tu8 t;\n\tfor(t=0;t&lt;times;t++)\n\t{\n\t\ttemp_val+=Get_Adc(ADC_CHx);\n\t\tdelay_ms(5);\t\t\n\t}\n\treturn temp_val/times;\n} </code></pre>\n<p></p>\n<h3 id=\"2%E3%80%81adc.h%E6%96%87%E4%BB%B6\">2、adc.h文件</h3>\n<pre><code class=\"language-cpp\">#ifndef __ADC_H\n#define __ADC_H\n\n#include \"stm32f10x.h\"\n#include \"sys.h\" \n\n/* ADC规则通道 端口定义 */\n#define ADC_CH0   0       // PA0\n#define ADC_CH1   1  \t\t\t// PA1\n//#define ADC_CH2   2  \t\t\t// PA2\n//#define ADC_CH3   3  \t\t\t// PA3\n#define ADC_CH4   4  \t\t\t// PA4\n#define ADC_CH5   5  \t\t\t// PA5\n#define ADC_CH6   6  \t\t\t// PA6\n#define ADC_CH7   7  \t\t\t// PA7\n#define ADC_CH8   8  \t\t\t// PB0\n#define ADC_CH9   9  \t\t\t// PB1\n#define ADC_CH10  10   \t\t// PC0\n#define ADC_CH11  11   \t\t// PC1\n#define ADC_CH12  12   \t\t// PC2\n#define ADC_CH13  13   \t\t// PC3\n#define ADC_CH14  14   \t\t// PC4\n#define ADC_CH15  15   \t\t// PC5\n\n\n//ADC1 API\nvoid ADC_init(u8 ADC_CHx);\nu16 Get_Adc(u8 ADC_CHx);\nu16 Get_Adc_Average(u8 ADC_CHx,u8 times);\n\n\n#endif</code></pre>\n<p></p>\n<h3 id=\"3%E3%80%81main.h%E6%96%87%E4%BB%B6\">3、main.h文件</h3>\n<p>        注意：这里不是完整的main.c函数，主要是明白这个函数如何调用。</p>\n<pre><code class=\"language-cpp\">int main()\n{\n    /*ADC的采集值*/\n    u16 ADC_Value；\n\n    /*ADC初始化*/\n    ADC_init(ADC_CH4);     //ADC1 通道四 PA4 初始化\n    while(1)\n    {\n        ADC_Value = Get_Adc_Average(ADC_CH4, 20);\n    }\n}</code></pre>\n<h2 id=\"%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%E3%80%81%E6%80%BB%E7%BB%93\">第三部分、总结</h2>\n<p>        代码是我的朋友发给我，其实很多时候你不必要去明白ADC的驱动代码它到底怎么配置的，为什么这么配置，你只要明白它是一个工具，学会怎么用这个工具就可以了。然后在照葫芦画瓢弄明白哪些代码是用来更改的，就可以了。</p>\n<p>        站在巨人的肩膀上，永远是最快的学习方法。</p>\n</div>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-06-02 10:41:56", "summary": "目录第一部分、关于的基础知识、是多少位的？、参考电压为多少？、参考电压与位数的转换关系、通道对应的端口来自野火的文档第二部分、直接上手的好用代码、文件、文件、文件第三部分、总结第一部分、关于的基础知识"}