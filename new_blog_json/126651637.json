{"blogid": "126651637", "writerAge": "ç é¾„10å¹´", "writerBlogNum": "552", "writerCollect": "9235", "writerComment": "889", "writerFan": "7562", "writerGrade": "7çº§", "writerIntegral": "22512", "writerName": "vbirdbest", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126651637.jpg", "writerRankTotal": "338", "writerRankWeekly": "5771", "writerThumb": "2638", "writerVisitNum": "2974344", "blog_read_count": "502", "blog_time": "å·²äºÂ 2022-09-04 19:24:21Â ä¿®æ”¹", "blog_title": "SpringBootå…¥é—¨æ•™ç¨‹ï¼šæ•°æ®åº“æ¢å¤ï¼ˆmysqldumpå’Œmysqlbinlogï¼‰", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p><img alt=\"è¯·æ·»åŠ å›¾ç‰‡æè¿°\" height=\"400\" src=\"..\\..\\static\\image\\1694d9d4f4574b9bbb9fa29b23692e98.jpeg\" width=\"400\"/></p>\n<h1><a id=\"bin_log_3\"></a>ä¸€ï¼šä»€ä¹ˆæ˜¯bin log</h1>\n<p>MySQLçš„æ‰€æœ‰çš„æ•°æ®åº“æ”¹å˜æ“ä½œï¼ˆé™¤äº†selectç­‰ï¼‰éƒ½ä¼šè®°å½•åˆ°ä¸€ç§äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œè¿™ç§æ–‡ä»¶å°±æ˜¯bin logã€‚<br/> bin log ç”¨æ¥å®ç°ä¸»ä»å¤åˆ¶ï¼Œä¹Ÿå¸¸ç”¨æ¥è¯¯åˆ æ•°æ®åº“æ‰¾å›ä¸¢å¤±çš„è®°å½•ã€‚</p>\n<p>ä¸€èˆ¬æ¢å¤ä»ä¸¤ç§çº¬åº¦æ¥è¿›è¡Œæ¢å¤ï¼š</p>\n<ol><li>ä¸€éƒ¨åˆ†ä»mysqldumpä¸­æ¢å¤å¤‡ä»½åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚</li><li>å¦ä¸€éƒ¨åˆ†åœ¨æ¢å¤åˆ°å¤‡ä»½ä¹‹å‰çš„åŸºç¡€ä¸Šå†ä»bin logä¸­æ‰¾å‡ºéœ€è¦æ¢å¤çš„æ•°æ®ã€‚</li></ol>\n<h1><a id=\"bin_log_11\"></a>äºŒï¼šæŸ¥çœ‹bin logé…ç½®</h1>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\ef868be01dff4ee782a9f8bcfa60eb92.png\"/></p>\n<ul><li>log_bin ï¼šæ˜¯å¦å¼€å¯bin logï¼Œé»˜è®¤å€¼ä¸º <code>ON</code> è¡¨ç¤ºå¼€å¯ã€‚</li><li>log_bin_basename ï¼šé…ç½®bin logæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼ˆ<code>/usr/local/mysql/data</code>ï¼‰ä»¥åŠæ–‡ä»¶åå‰ç¼€ï¼ˆ<code>mysql-bin</code>ï¼‰ã€‚bin logæ–‡ä»¶åæ˜¯ä»<code>mysql-bin.000001</code>å¼€å§‹çš„ã€‚</li><li>log_bin_indexï¼šé…ç½®ç´¢å¼•å¯¹åº”çš„bin logæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œæ–‡ä»¶ä¸­è®°å½•æ‰€æœ‰bin logæ–‡ä»¶åã€‚ <code>/usr/local/mysql/data/mysql-bin.index</code> ã€‚</li></ul>\n<h1><a id=\"bin_log_19\"></a>ä¸‰ï¼šåˆ é™¤bin logæ–‡ä»¶</h1>\n<p>ä¸ºäº†æµ‹è¯•æ–¹ä¾¿å¯ä»¥å…ˆåˆ é™¤ä¹‹å‰çš„bin logæ–‡ä»¶ã€‚</p>\n<p><mark>æ³¨æ„ï¼šæœ€å¥½æ˜¯è‡ªå·±æœ¬åœ°å¼€å‘ç¯å¢ƒæ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåƒä¸‡ä¸è¦åœ¨æµ‹è¯•ç¯å¢ƒæˆ–è€…å…¶å®ƒå…±ç”¨ç¯å¢ƒåˆ é™¤bin logã€‚</mark></p>\n<pre><code class=\"prism language-sql\"><span class=\"token comment\"># ç”¨æ¥æŸ¥çœ‹å½“å‰æœ€æ–°çš„bin logæ–‡ä»¶åŠå¯¹åº”çš„ç»“æŸä½ç½®</span>\n<span class=\"token keyword\">show</span> master <span class=\"token keyword\">status</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># æŸ¥çœ‹æ‰€æœ‰bin logæ–‡ä»¶</span>\n<span class=\"token keyword\">show</span> <span class=\"token keyword\">binary</span> logs<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># ç”Ÿæˆä¸€ä¸ªæ–°çš„bin logæ–‡ä»¶ï¼ˆæ¨èï¼šè‡ªå·±ç©çš„æ—¶å€™å¯ä»¥å…ˆç”Ÿæˆä¸€ä¸ªæ–°çš„bin logæ–‡ä»¶ï¼Œæ‰€æœ‰æ–°æ“ä½œéƒ½è®°å½•åœ¨æ–°ç”Ÿæˆçš„æ–‡ä»¶ä¸­ï¼‰</span>\nflush <span class=\"token keyword\">binary</span> logs<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># åˆ é™¤æ‰€æœ‰binlogæ—¥å¿—ï¼Œæ–°æ—¥å¿—ç¼–å·ä»å¤´000001å¼€å§‹ï¼ˆå»ºè®®è‡ªå·±ç©çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼‰</span>\nreset master<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># åˆ é™¤mysql-bin.000001ä¹‹å‰çš„æ‰€æœ‰bin log</span>\n<span class=\"token keyword\">purge</span> master logs <span class=\"token keyword\">to</span> <span class=\"token string\">'mysql-bin.000001'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># åˆ é™¤æŒ‡å®šæ—¶é—´ä¹‹å‰çš„æ•°æ®</span>\n<span class=\"token keyword\">purge</span> master logs before <span class=\"token string\">'2022-09-01 23:59:59'</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h1><a id=\"_44\"></a>å››ï¼šå‡†å¤‡æµ‹è¯•æ•°æ®</h1>\n<p>æ‰§è¡ŒSQLæ—¶ä¸è¦ä¸€ä¸‹å­å…¨éƒ¨æ‰§è¡Œï¼Œä¸ºäº†åç»­æ–¹ä¾¿æ¼”ç¤ºåŸºäºæ—¶é—´èŒƒå›´çš„æ“ä½œï¼Œéœ€è¦ä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œï¼Œæœ€å¥½æ¯æ¡å‘½ä»¤é—´éš”1ç§’ä»¥ä¸Šæ‰§è¡Œã€‚</p>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>db1<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> db1<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tbl_user<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç”¨æˆ·å'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'çŠ¶æ€(0:å…³é—­ï¼Œ1ï¼šæ‰“å¼€)'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4<span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> tbl_user<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">status</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span><span class=\"token string\">'monday'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> tbl_user<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">status</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vbirdbest'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">update</span> tbl_user <span class=\"token keyword\">set</span> <span class=\"token keyword\">status</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token keyword\">where</span> username <span class=\"token operator\">=</span> <span class=\"token string\">'monday'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">delete</span> <span class=\"token keyword\">from</span> tbl_user <span class=\"token keyword\">where</span> username <span class=\"token operator\">=</span> <span class=\"token string\">'vbirdbest'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">drop</span> <span class=\"token keyword\">database</span> db1<span class=\"token punctuation\">;</span>\n</code></pre>\n<h1><a id=\"bin_log_66\"></a>äº”ï¼šæŸ¥çœ‹bin log</h1>\n<p>bin log éœ€è¦å…³æ³¨çš„å­—æ®µï¼š</p>\n<ul><li>Log_nameï¼šbin log æ–‡ä»¶åã€‚</li><li><code>Pos</code>ï¼šå¼€å§‹ä½ç½®ç‚¹ã€‚</li><li><code>End_log_pos</code>ï¼šç»“æŸä½ç½®ç‚¹ã€‚</li><li>Event_typeï¼šäº‹ä»¶ç±»å‹ï¼ˆQueryï¼šDMLè¯­å¥ï¼ŒWrite_rowsï¼šinsertè¯­å¥ï¼ŒUpdate_rowsï¼šupdateè¯­å¥ï¼ŒDelete_rowsï¼šdeleteè¯­å¥ï¼‰ã€‚</li></ul>\n<h2><a id=\"show_binlog_events_73\"></a>æ–¹å¼ä¸€ï¼šshow binlog events</h2>\n<pre><code class=\"prism language-sql\"><span class=\"token comment\"># æŸ¥çœ‹å½“å‰æœ€æ–°çš„bin logæ–‡ä»¶</span>\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">show</span> master <span class=\"token keyword\">status</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># æŸ¥çœ‹binæ–‡ä»¶åŸºæœ¬ä¿¡æ¯, Posè¡¨ç¤ºä½ç½®positionï¼Œå¦‚904ä½ç½®æ˜¯insertä¸€æ¡æ•°æ®</span>\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">show</span> binlog events <span class=\"token operator\">in</span> <span class=\"token string\">'mysql-bin.000001'</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\31715633b5b446448b921fb1a4129ce5.png\"/></p>\n<h2><a id=\"mysqlbinlog_83\"></a>æ–¹å¼äºŒï¼šmysqlbinlogå‘½ä»¤</h2>\n<p>mysqlbinlogæ–¹å¼å’Œshow binlog eventsæ–¹å¼å·®ä¸å¤šï¼Œå…¶ä¸­ <code>at</code> è¡¨ç¤ºå¼€å§‹ä½ç½®<code>Pos</code>(position)ï¼Œ<code>end_log_pos</code>è¡¨ç¤ºç»“æŸä½ç½®ç‚¹ã€‚</p>\n<ul><li>bin logä¸­åˆ›å»ºæ•°æ®åº“create databaseã€åˆ›å»ºè¡¨create tableã€åˆ é™¤æ•°æ®åº“drop database éƒ½æ˜¯ç›´æ¥è®°å½•çš„SQLè¯­å¥ï¼Œ</li><li>æ’å…¥insertã€æ›´æ–°updateã€åˆ é™¤delete éƒ½æ˜¯ç¼–ç ä¹‹åçš„äººç±»ä¸å¯è¯»çš„å†…å®¹å­˜åœ¨ã€‚æ‰€ä»¥éœ€è¦<code>--base64-output=DECODE-ROWS -vv</code>è§£ç ã€‚</li><li>æ¯ä¸ªSQLæ“ä½œéƒ½ä¼šè®°å½•<code>æ“ä½œæ—¶é—´</code>ï¼Œ <code>#220903 17:08:44</code>ã€‚</li></ul>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\"># å¦‚æœæŠ¥æƒé™é—®é¢˜åˆ‡æ¢rootç”¨æˆ· mysqlbinlog: File '/usr/local/mysql/data/mysql-bin.000001' not found (Errcode: 13 - Permission denied)</span>\n~ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span>\n\n<span class=\"token comment\"># è§£ç ï¼šå°†insert/update/deleteç­‰è§£ç æˆSQLè¯­å¥</span>\nmysqlbinlog --no-defaults --skip-gtids --base64-output<span class=\"token operator\">=</span>DECODE-ROWS -vv /usr/local/mysql/data/mysql-bin.000001\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\96d24916df8b4c7aad9fb2525bbdf96e.png\"/></p>\n<h1><a id=\"mysqlbinlog_99\"></a>å…­ï¼šæ¢å¤æ•°æ®mysqlbinlog</h1>\n<h2><a id=\"61_mysqlbinlog_100\"></a>6.1 mysqlbinlogå‘½ä»¤å¸¸ç”¨å‚æ•°</h2>\n<ul><li><code>--no-defaults</code>ï¼šå¦‚æœä¸æŠ¥é”™å¯ä»¥ä¸ä½¿ç”¨è¯¥å‚æ•°ã€‚ <code>mysqlbinlog: [ERROR] unknown variable 'default-character-set=utf8'</code>ã€‚</li><li><code>--skip-gtids=true</code>ï¼šgtidæ˜¯ä¸€ç§å…¨å±€å”¯ä¸€idã€‚è®¾ç½®ä¸ºtrueè¡¨ç¤ºå¯¼å‡ºçš„sqlä¸­ä¸åŒ…å«gtidç›¸å…³çš„è®¾ç½®ã€‚</li><li><code>--base64-output=DECODE-ROWS -vv</code>ï¼šbin logå†…å®¹ç»è¿‡ç¼–ç äº†ï¼Œéœ€è¦è§£ç ä¹‹åäººç±»æ‰å¯è¯»ã€‚</li><li><code>--start-position=801</code>ï¼šæ¢å¤çš„å¼€å§‹ä½ç½®ã€‚æ³¨æ„ï¼šå¼€å§‹ä½ç½®ä¸€èˆ¬å–<code>BEGIN</code>çš„ä½ç½®ï¼Œå–é ä¸‹çš„ä½ç½®å¯èƒ½å¯¼ä¸å‡ºæ¥æƒ³è¦çš„logã€‚</li><li><code>--stop-position=1590</code>ï¼šæ¢å¤çš„ç»“æŸä½ç½®ã€‚<code>æ³¨æ„ï¼šæ˜¯ä¸åŒ…å«åœæ­¢ä½ç½®çš„ã€‚</code></li><li><code>--start-datetime=\"2022-01-01 00:00:00\" </code>ï¼šæŒ‡å®šå¼€å§‹æ—¶é—´ä¹‹åçš„bin logã€‚å¦‚æœä¸æŒ‡å®šè¡¨ç¤ºä»å¤´å¼€å§‹ã€‚</li><li><code>--stop-datetime=\"2022-09-01 23:59:59\"</code>ï¼šæŒ‡å®šç»“æŸæ—¶é—´ä¹‹å‰çš„bin logã€‚å¦‚æœä¸æŒ‡å®šè¡¨ç¤ºä¸€ç›´åˆ°ç»“å°¾ã€‚</li><li><code>--database=db1</code>ï¼šbin log æ–‡ä»¶ä¼šè®°å½•æ‰€æœ‰æ•°æ®åº“çš„å˜æ›´ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬éœ€è¦æŒ‡å®šæ•°æ®åº“å¯¹åº”çš„bin logã€‚</li></ul>\n<h2><a id=\"62_bin_log_111\"></a>6.2 æŸ¥çœ‹æœ€æ–°çš„bin logæ–‡ä»¶</h2>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\"># åˆ é™¤æ‰€æœ‰bin logæ–‡ä»¶ï¼Œä»mysql-bin.000001å¼€å§‹</span>\nmysql<span class=\"token operator\">&gt;</span> reset master<span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">&gt;</span> show master status<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\3fb2151a42af43b29d3ac243481a5e04.png\"/></p>\n<h2><a id=\"63__119\"></a>6.3 æ¨¡æ‹Ÿæ•°æ®åº“è¯¯åˆ æ“ä½œ</h2>\n<pre><code class=\"prism language-sql\">mysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>db1<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">use</span> db1<span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>tbl_user<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ç”¨æˆ·å'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'çŠ¶æ€(0:å…³é—­ï¼Œ1ï¼šæ‰“å¼€)'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4<span class=\"token punctuation\">;</span>\n\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> tbl_user<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">status</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span><span class=\"token string\">'monday'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> tbl_user<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">status</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vbirdbest'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># mysqlå¤‡ä»½ https://blog.csdn.net/zhou920786312/article/details/123354503</span>\n<span class=\"token comment\"># å•äº‹åŠ¡å¯¼å‡ºåŒ…æ‹¬å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€äº‹ä»¶</span>\n<span class=\"token operator\">~</span> mysqldump <span class=\"token operator\">-</span>uroot <span class=\"token operator\">-</span>p <span class=\"token comment\">--single-transaction --triggers --routines --events --databases db1 &gt; db1-20220904.dump</span>\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> tbl_user<span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> <span class=\"token keyword\">status</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span><span class=\"token string\">'modely'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n\n<span class=\"token comment\"># æ¨¡æ‹Ÿè¯¯æ“ä½œï¼Œæ¸…ç©ºäº†è¡¨</span>\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token keyword\">delete</span> <span class=\"token keyword\">from</span> tbl_user<span class=\"token punctuation\">;</span>\n</code></pre>\n<h2><a id=\"63__145\"></a>6.3 ä»å¤‡ä»½ä¸­æ¢å¤</h2>\n<pre><code class=\"prism language-sql\"><span class=\"token operator\">~</span> mysql <span class=\"token operator\">-</span>uroot <span class=\"token operator\">-</span>p  <span class=\"token operator\">&lt;</span> alldb1<span class=\"token punctuation\">.</span><span class=\"token keyword\">dump</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\47898ba68f7a4a3f95c2ef175197890d.png\"/></p>\n<h1><a id=\"bin_log_153\"></a>ä¸ƒï¼šä»bin logä¸­æ¢å¤</h1>\n<p>æ€»å…±æœ‰3æ¡æ•°æ®ï¼Œå·²ç»æœ‰2æ¡ä»å¤‡ä»½ä¸­æ¢å¤äº†ï¼Œå‰©ä¸‹1æ¡æˆ‘ä»¬ä»bin logä¸­æ‰¾å‡ºæ¥æ¢å¤ã€‚</p>\n<h2><a id=\"71__156\"></a>7.1 æ–¹å¼ä¸€ï¼šåŸºäºæ—¶é—´èŒƒå›´</h2>\n<h3><a id=\"711__157\"></a>7.1.1 å…ˆæŸ¥çœ‹ä¸€ä¸‹æ‰€æœ‰çš„å†…å®¹ï¼Œç¡®è®¤æ—¶é—´èŒƒå›´</h3>\n<pre><code class=\"prism language-shell\">~ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span>\n~ /usr/local/mysql/bin/mysqlbinlog --no-defaults <span class=\"token punctuation\">\\</span>\n--base64-output<span class=\"token operator\">=</span>DECODE-ROWS -vv --skip-gtids<span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n--database<span class=\"token operator\">=</span>db1 /usr/local/mysql/data/mysql-bin.000001\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\62d74f89c705466587b4b2ac99d6275b.png\"/></p>\n<h3><a id=\"712__167\"></a>7.1.2 æ ¹æ®æ—¶é—´èŒƒå›´ç¡®è®¤è¿‡æ»¤å‡ºæ¥çš„æ—¥å¿—</h3>\n<pre><code class=\"prism language-shell\">/usr/local/mysql/bin/mysqlbinlog <span class=\"token punctuation\">\\</span>\n--no-defaults <span class=\"token punctuation\">\\</span>\n--start-datetime<span class=\"token operator\">=</span><span class=\"token string\">\"2022-09-04 18:12:17\"</span> <span class=\"token punctuation\">\\</span>\n--stop-datetime<span class=\"token operator\">=</span><span class=\"token string\">\"2022-09-04 18:12:52\"</span> <span class=\"token punctuation\">\\</span>\n--base64-output<span class=\"token operator\">=</span>DECODE-ROWS -vv <span class=\"token punctuation\">\\</span>\n--skip-gtids<span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n--database<span class=\"token operator\">=</span>db1 /usr/local/mysql/data/mysql-bin.000001 \n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\efb0704864294ee180e4fb17af966e46.png\"/></p>\n<h3><a id=\"713_sql_179\"></a>7.1.3 ç¡®è®¤å¥½åå¯¼å‡º.sqlæ–‡ä»¶</h3>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\"># å¯¼å‡ºsqlæ–‡ä»¶</span>\n/usr/local/mysql/bin/mysqlbinlog <span class=\"token punctuation\">\\</span>\n--no-defaults <span class=\"token punctuation\">\\</span>\n--start-datetime<span class=\"token operator\">=</span><span class=\"token string\">\"2022-09-04 18:12:17\"</span> <span class=\"token punctuation\">\\</span>\n--stop-datetime<span class=\"token operator\">=</span><span class=\"token string\">\"2022-09-04 18:12:52\"</span> <span class=\"token punctuation\">\\</span>\n--base64-output<span class=\"token operator\">=</span>DECODE-ROWS -vv <span class=\"token punctuation\">\\</span>\n--skip-gtids<span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n--database<span class=\"token operator\">=</span>db1 /usr/local/mysql/data/mysql-bin.000001 <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">&gt;</span> /Users/mengday/binlog.sql \n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\061c68db5dc2465586f8251fe79a15f5.png\"/></p>\n<h3><a id=\"714_sql_194\"></a>7.1.4 ä».sqlæ–‡ä»¶ä¸­æ¢å¤æ•°æ®</h3>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\"># 2. æ–¹å¼ä¸€ï¼šç„¶åç™»å½•mysql sourceè¿™ä¸ªæ–‡ä»¶</span>\n~ mysql -uroot -p\t\nmysql<span class=\"token operator\">&gt;</span> <span class=\"token builtin class-name\">source</span> /Users/mengday/binlog.sql<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># 2. æ–¹å¼äºŒ</span>\nmysql -uroot -p <span class=\"token operator\">&lt;</span> /Users/mengday/binlog.sql<span class=\"token punctuation\">;</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\f9cc9d9c5a4a4538891a46d896299116.png\"/><br/> <mark>é€šè¿‡ <code>source binlog.sql æˆ–è€… mysql -uroot -p &lt; binlog.sql</code> éƒ½æ²¡æœ‰å°†insertè¯­å¥æ’å…¥è¿›å»ï¼Œä¸çŸ¥é“ä»€ä¹ˆåŸå› ã€‚é€šè¿‡å¦ä¸€ç§å½¢å¼ä¹Ÿæ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼ï¼ï¼</mark></p>\n<pre><code class=\"prism language-shell\">/usr/local/mysql/bin/mysqlbinlog <span class=\"token punctuation\">\\</span>\n--no-defaults <span class=\"token punctuation\">\\</span>\n--start-datetime<span class=\"token operator\">=</span><span class=\"token string\">\"2022-09-04 18:12:17\"</span> <span class=\"token punctuation\">\\</span>\n--stop-datetime<span class=\"token operator\">=</span><span class=\"token string\">\"2022-09-04 18:12:52\"</span> <span class=\"token punctuation\">\\</span>\n--base64-output<span class=\"token operator\">=</span>DECODE-ROWS -vv <span class=\"token punctuation\">\\</span>\n--skip-gtids<span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n--database<span class=\"token operator\">=</span>db1 /usr/local/mysql/data/mysql-bin.000001 <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span> mysql -uroot -p\n</code></pre>\n<h2><a id=\"72__218\"></a>7.2 æ–¹å¼äºŒï¼šåŸºäºä½ç½®(æ¨è)</h2>\n<p>å› ä¸ºåœ¨åŒä¸€ç§’ä¸­å¯èƒ½æ“ä½œå¤šæ¡SQLï¼Œå¦‚æœåœ¨è¿™ä¸€ç§’ä¸­æœ‰ä¸€éƒ¨åˆ†éœ€è¦æ¢å¤æœ‰ä¸€éƒ¨åˆ†ä¸éœ€è¦æ¢å¤é‚£ä¹ˆä½¿ç”¨å±…äºæ—¶é—´èŒƒå›´çš„å°±ä¸å‡†ç¡®ï¼Œä½¿ç”¨åŸºäºä½ç½®çš„å°±æ›´åŠ å‡†ç¡®ã€‚</p>\n<h3><a id=\"721__220\"></a>7.2.1 åŸºäºä½ç½®è¿‡æ»¤æ—¥å¿—</h3>\n<pre><code class=\"prism language-shell\">/usr/local/mysql/bin/mysqlbinlog <span class=\"token punctuation\">\\</span>\n--no-defaults <span class=\"token punctuation\">\\</span>\n--start-position<span class=\"token operator\">=</span><span class=\"token number\">841</span> <span class=\"token punctuation\">\\</span>\n--stop-position<span class=\"token operator\">=</span><span class=\"token number\">948</span> <span class=\"token punctuation\">\\</span>\n--base64-output<span class=\"token operator\">=</span>DECODE-ROWS -vv <span class=\"token punctuation\">\\</span>\n--skip-gtids<span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n--database<span class=\"token operator\">=</span>db1 /usr/local/mysql/data/mysql-bin.000001 <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">&gt;</span> /Users/mengday/binlog2.sql\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\4f3a8ddabdcc48269a3e7ae048b4ea07.png\"/></p>\n<h3><a id=\"722__233\"></a>7.2.2 æ¢å¤æ•°æ®</h3>\n<pre><code class=\"prism language-sql\">source binlog2<span class=\"token punctuation\">.</span><span class=\"token keyword\">sql</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>åŒæ ·ä¸å‡ºæ„å¤–çš„insertè¯­å¥å¹¶æ²¡æœ‰æ‰§è¡Œã€‚</p>\n<h3><a id=\"73__241\"></a>7.3 å¤šæ–‡ä»¶æ¢å¤</h3>\n<pre><code class=\"prism language-shell\"><span class=\"token comment\"># è·¨bin logæ–‡ä»¶</span>\nmysqlbinlog --skip-gtids<span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n--start-position<span class=\"token operator\">=</span><span class=\"token number\">802</span> mysql-bin.000001 <span class=\"token punctuation\">\\</span>\n--stop-position<span class=\"token operator\">=</span><span class=\"token number\">726</span> mysql-bin.000002 <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>mysql -uroot -proot\n\n<span class=\"token comment\"># ä»mysql-bin.000001 802ä½ç½®å¼€å§‹åˆ°mysql-bin.000002ç»“æŸ</span>\nmysqlbinlog --skip-gtids<span class=\"token operator\">=</span>true <span class=\"token punctuation\">\\</span>\n--start-position<span class=\"token operator\">=</span><span class=\"token number\">802</span> mysql-bin.000001  mysql-bin.000002 <span class=\"token punctuation\">\\</span>\n<span class=\"token operator\">|</span>mysql -uroot -proot\n</code></pre>\n<p><code>æ³¨æ„ï¼šå¦‚æœæœ‰å¤šä¸ªmysql-binæ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­çš„ä½ç½®positionä¸æ˜¯å”¯ä¸€çš„ï¼Œæ˜¯é‡å¤åˆ©ç”¨çš„ã€‚æ‰€ä»¥å½“æ“ä½œå¤šä¸ªæ–‡ä»¶æ—¶è¦å°å¿ƒã€‚ä¾‹å¦‚ at 4 å¯èƒ½åœ¨å¤šä¸ªbin logä¸­å‡ºç°ã€‚éœ€è¦æ“ä½œå¤šä¸ªæ–‡ä»¶æ—¶æœ€å¥½åˆ†å¼€ä¸€ä¸ªä¸€ä¸ªå•ç‹¬æ“ä½œã€‚</code></p>\n<h1><a id=\"binlog2sql__259\"></a>å…«ï¼šbinlog2sql å·¥å…·</h1>\n<p>æ—¢ç„¶é€šè¿‡sourceä¸èƒ½ç›´æ¥æ‰§è¡Œbin log sqlè¯­å¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠbin log sqlè¯­å¥è½¬åŒ–æˆæ­£å¸¸çš„sqlè¯­å¥è‡ªå·±æ‰‹åŠ¨æ‰§è¡Œã€‚</p>\n<p><a href=\"https://github.com/danfengcao/binlog2sql\">Pythonå·¥å…· binlog2sqlï¼šhttps://github.com/danfengcao/binlog2sql</a></p>\n<pre><code class=\"prism language-shell\"><span class=\"token function\">git</span> clone https://github.com/danfengcao/binlog2sql.git <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> binlog2sql\n\n<span class=\"token comment\"># æ³¨æ„ï¼šå¦‚æœæœ¬åœ°pythonç¯å¢ƒå†²çªçš„è¯ï¼Œæœ€å¥½ä¸ºå½“å‰é¡¹ç›®åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå¦åˆ™å¾ˆå®¹æ˜“æŠ¥ModuleNotFoundError: No module named 'pymysqlreplication'</span>\npython3 -m venv <span class=\"token function\">env</span>\n<span class=\"token builtin class-name\">source</span> env/bin/activate\npip3 <span class=\"token function\">install</span> -r requirements.txt\n\n<span class=\"token comment\"># æŸ¥è¯¢æ‰€æœ‰sqlè¯­å¥ï¼Œä»è€Œæ‰¾åˆ°æƒ³è¦æ¢å¤æ˜¯sqlè¯­å¥</span>\npython3 binlog2sql/binlog2sql.py -h127.0.0.1 -P3306 -uroot -p<span class=\"token string\">'root123'</span> -ddb1 -ttbl_user --start-file<span class=\"token operator\">=</span><span class=\"token string\">'mysql-bin.000001'</span>\n\n<span class=\"token comment\"># é€šè¿‡èµ·å§‹ä½ç½®è¿›ä¸€æ­¥ç¡®è®¤æ˜¯å¦æ˜¯æƒ³è¦çš„sql</span>\npython3 binlog2sql/binlog2sql.py -h127.0.0.1 -P3306 -uroot -p<span class=\"token string\">'root123'</span> -ddb1 -ttbl_user --start-file<span class=\"token operator\">=</span><span class=\"token string\">'mysql-bin.000001'</span> --start-position<span class=\"token operator\">=</span><span class=\"token number\">705</span> --stop-position<span class=\"token operator\">=</span><span class=\"token number\">948</span>\n\n<span class=\"token comment\"># -Bå‚æ•°ç”Ÿæˆå¯¹åº”çš„å›æ»šsqlï¼Œå¦‚insertå›æ»šsqlä¸ºdelete</span>\npython3 binlog2sql/binlog2sql.py -h127.0.0.1 -P3306 -uroot -p<span class=\"token string\">'root123'</span> -ddb1 -ttbl_user --start-file<span class=\"token operator\">=</span><span class=\"token string\">'mysql-bin.000001'</span> --start-position<span class=\"token operator\">=</span><span class=\"token number\">705</span> --stop-position<span class=\"token operator\">=</span><span class=\"token number\">948</span> <span class=\"token operator\">&gt;</span> insert.sql <span class=\"token operator\">|</span> <span class=\"token function\">cat</span>\n\n<span class=\"token comment\"># æ‹¿åˆ°è¿™ä¸ªSQLæˆ‘ç›´æ¥æ‰§è¡Œï¼Œæˆ‘å°±ä¸ä¿¡æ¢å¤ä¸è¿‡æ¥</span>\nINSERT INTO <span class=\"token variable\"><span class=\"token variable\">`</span>db1<span class=\"token variable\">`</span></span><span class=\"token builtin class-name\">.</span><span class=\"token variable\"><span class=\"token variable\">`</span>tbl_user<span class=\"token variable\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">id</span><span class=\"token variable\">`</span></span>, <span class=\"token variable\"><span class=\"token variable\">`</span>username<span class=\"token variable\">`</span></span>, <span class=\"token variable\"><span class=\"token variable\">`</span>status<span class=\"token variable\">`</span></span><span class=\"token punctuation\">)</span> VALUES <span class=\"token punctuation\">(</span><span class=\"token number\">6</span>, <span class=\"token string\">'modely'</span>, <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">#start 705 end 948 time 2022-09-04 18:12:17</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\ac54d28da856405a8cb82382e73ffee8.png\"/></p>\n<h1><a id=\"_286\"></a><mark>ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹è‡³æ­¤è‘µèŠ±å®å…¸å·²ç»è¿æˆã€‚ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹ğŸŒ¹</mark></h1>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\2d24091c2c3343b7a01e223383aa4d69.png\"/></p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "SQL", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 1, "php": 0, "time": "2022-09-04 19:24:21", "summary": "è¯·æ·»åŠ å›¾ç‰‡æè¿°ä¸€ï¼šä»€ä¹ˆæ˜¯çš„æ‰€æœ‰çš„æ•°æ®åº“æ”¹å˜æ“ä½œé™¤äº†ç­‰éƒ½ä¼šè®°å½•åˆ°ä¸€ç§äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œè¿™ç§æ–‡ä»¶å°±æ˜¯ã€‚ç”¨æ¥å®ç°ä¸»ä»å¤åˆ¶ï¼Œä¹Ÿå¸¸ç”¨æ¥è¯¯åˆ æ•°æ®åº“æ‰¾å›ä¸¢å¤±çš„è®°å½•ã€‚ä¸€èˆ¬æ¢å¤ä»ä¸¤ç§çº¬åº¦æ¥è¿›è¡Œæ¢å¤ï¼šä¸€éƒ¨åˆ†ä»ä¸­æ¢å¤å¤‡ä»½åˆ°ä¹‹å‰"}