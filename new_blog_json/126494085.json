{"blogid": "126494085", "writerAge": "ç é¾„6å¹´", "writerBlogNum": "62", "writerCollect": "4777", "writerComment": "5057", "writerFan": "18620", "writerGrade": "7çº§", "writerIntegral": "10131", "writerName": "åƒçŒ«çš„é±¼python", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126494085.jpg", "writerRankTotal": "1212", "writerRankWeekly": "3", "writerThumb": "3915", "writerVisitNum": "126178", "blog_read_count": "17798", "blog_time": "äºÂ 2022-08-23 22:21:41Â å‘å¸ƒ", "blog_title": "è®¡ç®—æœºè§†è§‰é¡¹ç›®-äººè„¸è¯†åˆ«ä¸æ£€æµ‹", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p>ğŸ˜ŠğŸ˜ŠğŸ˜Š<font color=\"GoldenRod\" face=\"æ¥·ä½“\" size=\"3\"><strong>æ¬¢è¿æ¥åˆ°æœ¬åšå®¢</strong>ğŸ˜ŠğŸ˜ŠğŸ˜Š</font><br/> <strong>æœ¬æ¬¡åšå®¢å†…å®¹å°†ç»§ç»­è®²è§£å…³äºOpenCVçš„ç›¸å…³çŸ¥è¯†</strong><br/> ğŸ‰<strong>ä½œè€…ç®€ä»‹</strong>ï¼š<font color=\"Orange\" face=\"æ¥·ä½“\" size=\"3\">â­ï¸â­ï¸â­ï¸<strong>ç›®å‰è®¡ç®—æœºç ”ç©¶ç”Ÿåœ¨è¯»ã€‚ä¸»è¦ç ”ç©¶æ–¹å‘æ˜¯äººå·¥æ™ºèƒ½å’Œç¾¤æ™ºèƒ½ç®—æ³•æ–¹å‘ã€‚ç›®å‰ç†Ÿæ‚‰æ·±åº¦å­¦ä¹ ï¼ˆkerasã€pytorchã€yoloç³»åˆ—ï¼‰ï¼Œpythonç½‘é¡µçˆ¬è™«ã€æœºå™¨å­¦ä¹ ã€è®¡ç®—æœºè§†è§‰ï¼ˆOpenCVï¼‰ã€ç¾¤æ™ºèƒ½ç®—æ³•ã€‚ç„¶åæ­£åœ¨å­¦ä¹ æ·±åº¦å­¦ä¹ çš„ç›¸å…³å†…å®¹ã€‚ä»¥åå¯èƒ½ä¼šæ¶‰åŠåˆ°ç½‘ç»œå®‰å…¨ç›¸å…³é¢†åŸŸï¼Œæ¯•ç«Ÿè¿™æ˜¯æ¯ä¸€ä¸ªå­¦ä¹ è®¡ç®—æœºçš„æ¢¦æƒ³å˜›ï¼</strong></font><br/> ğŸ“<strong>ç›®å‰æ›´æ–°</strong>ï¼š<font color=\"PaleVioletRed\" face=\"æ¥·ä½“\" size=\"3\">ğŸŒŸğŸŒŸğŸŒŸç›®å‰å·²ç»æ›´æ–°äº†å…³äºç½‘ç»œçˆ¬è™«çš„ç›¸å…³çŸ¥è¯†ã€æœºå™¨å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†ã€ç›®å‰æ­£åœ¨æ›´æ–°è®¡ç®—æœºè§†è§‰-OpenCVçš„ç›¸å…³å†…å®¹ã€‚</font><br/> ğŸ’›ğŸ’›ğŸ’›<em><strong>æœ¬æ–‡æ‘˜è¦</strong></em>ğŸ’›ğŸ’›ğŸ’›</p>\n<table><tbody><tr><td bgcolor=\"LightBlue\"><strong>æœ¬æ–‡æˆ‘ä»¬å°†ç»§ç»­è®²è§£AIé¢†åŸŸé¡¹ç›®-ç›®æ ‡è¯†åˆ«çš„ç›¸å…³æ“ä½œã€‚</strong><br/>\n<div class=\"toc\">\n<h3>æ–‡ç« ç›®å½•</h3>\n<ul><li><ul><li><a href=\"#_11\">ğŸŒŸé¡¹ç›®ä»‹ç»å‰è¨€</a></li><li><a href=\"#_14\">ğŸŒŸè¯†åˆ«æ£€æµ‹æ–¹æ³•</a></li><li><a href=\"#_25\">ğŸŒŸæœ¬æ–‡æ–¹æ³•</a></li><li><a href=\"#_31\">ğŸŒŸé¡¹ç›®è§£æ</a></li><li><a href=\"#_198\">ğŸŒŸå®Œæ•´ä»£ç åŠæ•ˆæœå±•ç¤º</a></li></ul>\n</li></ul>\n</div><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\5ec35d6063cb4d28ab97028f5a1658f0.png\"/></td></tr></tbody></table>\n<p></p>\n</blockquote>\n<h2><a id=\"_11\"></a>ğŸŒŸé¡¹ç›®ä»‹ç»å‰è¨€</h2>\n<p>äººè„¸è¯†åˆ«ä½œä¸ºä¸€ç§ç”Ÿç‰©ç‰¹å¾è¯†åˆ«æŠ€æœ¯ï¼Œå…·æœ‰<strong>éä¾µæ‰°æ€§ã€éæ¥è§¦æ€§ã€å‹å¥½æ€§å’Œä¾¿æ·æ€§</strong>ç­‰ä¼˜ç‚¹ã€‚äººè„¸è¯†åˆ«é€šç”¨çš„æµç¨‹ä¸»è¦åŒ…æ‹¬<strong>äººè„¸æ£€æµ‹ã€äººè„¸è£å‰ªã€äººè„¸æ ¡æ­£ã€ç‰¹å¾æå–å’Œäººè„¸è¯†åˆ«</strong>ã€‚äººè„¸æ£€æµ‹æ˜¯ä»è·å–çš„å›¾åƒä¸­å»é™¤å¹²æ‰°ï¼Œæå–äººè„¸ä¿¡æ¯ï¼Œè·å–äººè„¸å›¾åƒä½ç½®ï¼Œæ£€æµ‹çš„æˆåŠŸç‡ä¸»è¦å—<strong>å›¾åƒè´¨é‡ï¼Œå…‰çº¿å¼ºå¼±å’Œé®æŒ¡</strong>ç­‰å› ç´ å½±å“ã€‚ä¸‹å›¾æ˜¯æ•´ä¸ªäººè„¸æ£€æµ‹è¿‡ç¨‹ã€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\08e50836f0d0457da36f23acda36b289.png\"/></p>\n<h2><a id=\"_14\"></a>ğŸŒŸè¯†åˆ«æ£€æµ‹æ–¹æ³•</h2>\n<ol><li> <p>ä¼ ç»Ÿè¯†åˆ«æ–¹æ³•<br/> (1)åŸºäºç‚¹äº‘æ•°æ®çš„äººè„¸è¯†åˆ«<br/> (2)åŸºäºé¢éƒ¨ç‰¹å¾çš„3Däººè„¸è¯†åˆ«</p> </li><li> <p>æ·±åº¦å­¦ä¹ è¯†åˆ«æ–¹æ³•<br/> (1)åŸºäºæ·±åº¦å›¾çš„äººè„¸è¯†åˆ«<br/> (2)åŸºäºRGB-3DMMçš„äººè„¸è¯†åˆ«<br/> (3)åŸºäºRGB-Dçš„äººè„¸è¯†åˆ«</p> </li></ol>\n<h2><a id=\"_25\"></a>ğŸŒŸæœ¬æ–‡æ–¹æ³•</h2>\n<p>å…³é”®ç‚¹å®šä½æ¦‚è¿°<br/> ä¸€èˆ¬äººè„¸ä¸­æœ‰5ä¸ªå…³é”®ç‚¹ï¼Œå…¶ä¸­åŒ…æ‹¬çœ¼ç›ä¸¤ä¸ªï¼Œé¼»å­ä¸€ä¸ªï¼Œå˜´è§’ä¸¤ä¸ªã€‚è¿˜å¯ä»¥ç»†è‡´çš„åˆ†ä¸º68ä¸ªå…³é”®ç‚¹ï¼Œè¿™æ ·çš„è¯ä¼šæ¦‚æ‹¬çš„æ¯”è¾ƒå…¨é¢ï¼Œæˆ‘ä»¬æœ¬æ¬¡ç ”ç©¶å°±æ˜¯68ä¸ªå…³é”®ç‚¹å®šä½ã€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\a93e0c8895654531a6c33c897a35421f.png\"/><br/> ä¸Šå›¾å°±æ˜¯æˆ‘ä»¬å®šä½äººè„¸çš„68ä¸ªå…³é”®ç‚¹ï¼Œå…¶ä¸­ä»–çš„é¡ºåºæ˜¯è¦ä¸¥æ ¼çš„è¿›è¡Œæ’åºçš„ã€‚ä»1åˆ°68ç‚¹çš„é¡ºåºä¸èƒ½é”™è¯¯ã€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\4856f0e20e2345a89be58e7126d4ba0b.png\"/></p>\n<h2><a id=\"_31\"></a>ğŸŒŸé¡¹ç›®è§£æ</h2>\n<p>ä½¿ç”¨æœºå™¨å­¦ä¹ æ¡†æ¶dlibåšæœ¬æ¬¡çš„é¡¹ç›®ã€‚é¦–å…ˆæˆ‘ä»¬è¦æŒ‡å®šå‚æ•°æ—¶ï¼Œè¦æŠŠdlibä¸­çš„68å…³é”®ç‚¹äººè„¸å®šä½æ‰¾åˆ°ã€‚è®¾ç½®å‡ºæ¥çš„68å…³é”®ç‚¹äººè„¸å®šä½æ‰¾åˆ°ã€‚å¹¶ä¸”è®¾ç½®å‡ºæ¥ã€‚</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> OrderedDict\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> argparse\n<span class=\"token keyword\">import</span> dlib\n<span class=\"token keyword\">import</span> cv2\n</code></pre>\n<p>é¦–å…ˆæˆ‘ä»¬å¯¼å…¥å·¥å…·åŒ…ã€‚å…¶ä¸­<code>dlib</code>åº“æ˜¯é€šè¿‡è¿™ä¸ªç½‘å€<code>http://dlib.net/files/</code>è¿›è¡Œä¸‹è½½çš„ã€‚ç„¶åæˆ‘ä»¬å¯¼å…¥å‚æ•°ã€‚</p>\n<pre><code class=\"prism language-python\">ap <span class=\"token operator\">=</span> argparse<span class=\"token punctuation\">.</span>ArgumentParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nap<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"-p\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--shape-predictor\"</span><span class=\"token punctuation\">,</span> required<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"path to facial landmark predictor\"</span><span class=\"token punctuation\">)</span>\nap<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"-i\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--image\"</span><span class=\"token punctuation\">,</span> required<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"path to input image\"</span><span class=\"token punctuation\">)</span>\nargs <span class=\"token operator\">=</span> <span class=\"token builtin\">vars</span><span class=\"token punctuation\">(</span>ap<span class=\"token punctuation\">.</span>parse_args<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>è¿™é‡Œæˆ‘ä»¬è¦è®¾ç½®å‚æ•°ï¼Œ<br/> <code>--shape-predictor shape_predictor_68_face_landmarks.dat --image images/lanqiudui.jpg</code>ã€‚å¦‚æœä¸€å¼ å›¾åƒé‡Œé¢æœ‰å¤šä¸ªäººè„¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ†ä¸åŒéƒ¨åˆ†è¿›è¡Œæ£€æµ‹ï¼Œè£å‰ªå‡ºæ¥æ‰€å¯¹åº”çš„ROIåŒºåŸŸã€‚æˆ‘ä»¬çš„æ•´ä½“æ€è·¯å°±æ˜¯å…ˆæ£€æµ‹äººè„¸æ‰€åœ¨çš„ä¸€ä¸ªåŒºåŸŸä½ç½®ï¼Œç„¶åæ£€æµ‹é¼»å­ç›¸å¯¹äºäººè„¸æ¡†æ‰€åœ¨çš„ä¸€ä¸ªä½ç½®ï¼Œæ¯”å¦‚è¯´äººçš„å·¦çœ¼ç›åœ¨0.2wï¼Œ0.2hçš„äººè„¸æ¡†å¤„ã€‚</p>\n<pre><code class=\"prism language-python\">FACIAL_LANDMARKS_68_IDXS <span class=\"token operator\">=</span> OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"mouth\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">68</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"right_eyebrow\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">17</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"left_eyebrow\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">,</span> <span class=\"token number\">27</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"right_eye\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"left_eye\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"nose\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">27</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"jaw\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">17</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>è¿™ä¸ªæ˜¯68ä¸ªå…³é”®ç‚¹å®šä½çš„å„ä¸ªéƒ¨ä½ç›¸å¯¹äºäººè„¸æ¡†çš„æ‰€åœ¨ä½ç½®ã€‚åˆ†åˆ«å¯¹åº”ç€å˜´ï¼Œå·¦çœ¼ã€å³çœ¼ã€å·¦çœ¼çœ‰ã€å³çœ¼çœ‰ã€é¼»å­ã€ä¸‹å·´ã€‚</p>\n<pre><code class=\"prism language-python\">FACIAL_LANDMARKS_5_IDXS <span class=\"token operator\">=</span> OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"right_eye\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"left_eye\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"nose\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>å¦‚æœæ˜¯5ç‚¹å®šä½ï¼Œé‚£ä¹ˆå°±éœ€è¦å®šä½å·¦çœ¼ã€å³çœ¼ã€é¼»å­ã€‚0ã€1ã€2ã€3ã€4åˆ†åˆ«è¡¨ç¤ºå¯¹åº”çš„5ä¸ªç‚¹ã€‚</p>\n<pre><code class=\"prism language-python\">detector <span class=\"token operator\">=</span> dlib<span class=\"token punctuation\">.</span>get_frontal_face_detector<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\npredictor <span class=\"token operator\">=</span> dlib<span class=\"token punctuation\">.</span>shape_predictor<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"shape_predictor\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>åŠ è½½äººè„¸æ£€æµ‹ä¸å…³é”®ç‚¹å®šä½ã€‚åŠ è½½å‡ºæ¥ã€‚å…¶ä¸­<code>detector</code>é»˜è®¤çš„äººè„¸æ£€æµ‹å™¨ã€‚ç„¶åé€šè¿‡ä¼ å…¥å‚æ•°è¿”å›äººè„¸æ£€æµ‹çŸ©å½¢æ¡†4ç‚¹åæ ‡ã€‚å…¶ä¸­<code>predictor</code>ä»¥å›¾åƒçš„æŸå—åŒºåŸŸä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¸€ç³»åˆ—çš„ç‚¹ï¼ˆpoint locationï¼‰ä»¥è¡¨ç¤ºæ­¤å›¾åƒregioné‡Œobjectçš„å§¿åŠ¿poseã€‚è¿”å›è®­ç»ƒå¥½çš„äººè„¸68ç‰¹å¾ç‚¹æ£€æµ‹å™¨ã€‚</p>\n<pre><code class=\"prism language-python\">image <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"image\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\nwidth<span class=\"token operator\">=</span><span class=\"token number\">500</span>\nr <span class=\"token operator\">=</span> width <span class=\"token operator\">/</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">)</span>\ndim <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>h <span class=\"token operator\">*</span> r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nimage <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> dim<span class=\"token punctuation\">,</span> interpolation<span class=\"token operator\">=</span>cv2<span class=\"token punctuation\">.</span>INTER_AREA<span class=\"token punctuation\">)</span>\ngray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span>\n</code></pre>\n<p>è¿™é‡Œæˆ‘ä»¬æŠŠæ•°æ®è¯»äº†è¿›æ¥ï¼Œç„¶åè¿›è¡Œéœ€å¤„ç†ï¼Œæå–hå’Œwï¼Œå…¶ä¸­æˆ‘ä»¬è‡ªå·±è®¾å®šå›¾åƒçš„wä¸º500ï¼Œç„¶åæŒ‰ç…§æ¯”ä¾‹åŒæ¯”ä¾‹è®¾ç½®hã€‚ç„¶åè¿›è¡Œäº†resizeæ“ä½œï¼Œæœ€åè½¬åŒ–ä¸ºç°åº¦å›¾ã€‚</p>\n<pre><code class=\"prism language-python\">rects <span class=\"token operator\">=</span> detector<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>è¿™é‡Œè°ƒç”¨äº†<code>detector</code>çš„äººè„¸æ¡†æ£€æµ‹å™¨ï¼Œè¦ä½¿ç”¨ç°åº¦å›¾è¿›è¡Œæ£€æµ‹ï¼Œè¿™ä¸ª1æ˜¯é‡é‡‡æ ·ä¸ªæ•°ã€‚è¿™é‡Œé¢è¿”å›çš„æ˜¯äººè„¸æ£€æµ‹çŸ©å½¢æ¡†4ç‚¹åæ ‡ã€‚ç„¶åå¯¹æ£€æµ‹æ¡†è¿›è¡Œéå†</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>rects<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># å¯¹äººè„¸æ¡†è¿›è¡Œå…³é”®ç‚¹å®šä½</span>\n\t<span class=\"token comment\"># è½¬æ¢æˆndarray</span>\n\tshape <span class=\"token operator\">=</span> predictor<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">)</span>\n\tshape <span class=\"token operator\">=</span> shape_to_np<span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">)</span>\n</code></pre>\n<p>è¿™é‡Œé¢è¿”å›68ä¸ªå…³é”®ç‚¹å®šä½ã€‚<code>shape_to_np</code>è¿™ä¸ªå‡½æ•°å¦‚ä¸‹ã€‚</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">shape_to_np</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span><span class=\"token string\">\"int\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># åˆ›å»º68*2</span>\n\tcoords <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">.</span>num_parts<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span>dtype<span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\"># éå†æ¯ä¸€ä¸ªå…³é”®ç‚¹</span>\n\t<span class=\"token comment\"># å¾—åˆ°åæ ‡</span>\n\t<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> shape<span class=\"token punctuation\">.</span>num_parts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\tcoords<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> shape<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> coords\n</code></pre>\n<p>è¿™é‡Œ<code>shape_to_np</code>å‡½æ•°çš„ä½œç”¨å°±æ˜¯å¾—åˆ°å…³é”®ç‚¹å®šä½çš„åæ ‡ã€‚</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> FACIAL_LANDMARKS_68_IDXS<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\tclone <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\tcv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>clone<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_SIMPLEX<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> \n\n\t\t<span class=\"token comment\"># æ ¹æ®ä½ç½®ç”»ç‚¹</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> shape<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n\t\t\tcv2<span class=\"token punctuation\">.</span>circle<span class=\"token punctuation\">(</span>clone<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token comment\"># æå–ROIåŒºåŸŸ</span>\n\t\t<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>boundingRect<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>shape<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\n\t\troi <span class=\"token operator\">=</span> image<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">:</span>y <span class=\"token operator\">+</span> h<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span>x <span class=\"token operator\">+</span> w<span class=\"token punctuation\">]</span>\n\t\t<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> roi<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\t\twidth<span class=\"token operator\">=</span><span class=\"token number\">250</span>\n\t\tr <span class=\"token operator\">=</span> width <span class=\"token operator\">/</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">)</span>\n\t\tdim <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>h <span class=\"token operator\">*</span> r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\troi <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>roi<span class=\"token punctuation\">,</span> dim<span class=\"token punctuation\">,</span> interpolation<span class=\"token operator\">=</span>cv2<span class=\"token punctuation\">.</span>INTER_AREA<span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token comment\"># æ˜¾ç¤ºæ¯ä¸€éƒ¨åˆ†</span>\n\t\tcv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">\"ROI\"</span><span class=\"token punctuation\">,</span> roi<span class=\"token punctuation\">)</span>\n\t\tcv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">\"Image\"</span><span class=\"token punctuation\">,</span> clone<span class=\"token punctuation\">)</span>\n\t\tcv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>è¿™é‡Œå­—å…¸<code>FACIAL_LANDMARKS_68_IDXS.items()</code>æ˜¯åŒæ—¶æå–å­—å…¸ä¸­çš„keyå’Œvalueæ•°å€¼ã€‚ç„¶åéå†å‡ºæ¥è¿™å‡ ä¸ªåŒºåŸŸï¼Œå¹¶ä¸”è¿›è¡Œæ˜¾ç¤ºå…·ä½“æ˜¯é‚£ä¸ªåŒºåŸŸï¼Œå¹¶ä¸”å°†è¿™ä¸ªåŒºåŸŸç”»åœ†ã€‚éšåæå–roiåŒºåŸŸå¹¶ä¸”è¿›è¡Œæ˜¾ç¤ºã€‚åé¢éƒ¨åˆ†å°±æ˜¯åŒæ¯”ä¾‹æ˜¾ç¤ºwå’Œhã€‚ç„¶åå±•ç¤ºå‡ºæ¥ã€‚</p>\n<pre><code class=\"prism language-python\">\toutput <span class=\"token operator\">=</span> visualize_facial_landmarks<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> shape<span class=\"token punctuation\">)</span>\n\tcv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">\"Image\"</span><span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">)</span>\n\tcv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>æœ€åå±•ç¤ºæ‰€æœ‰åŒºåŸŸã€‚<br/> å…¶ä¸­<code>visualize_facial_landmarks</code>å‡½æ•°å°±æ˜¯ï¼š</p>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">visualize_facial_landmarks</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> shape<span class=\"token punctuation\">,</span> colors<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> alpha<span class=\"token operator\">=</span><span class=\"token number\">0.75</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># åˆ›å»ºä¸¤ä¸ªcopy</span>\n\t<span class=\"token comment\"># overlay and one for the final output image</span>\n\toverlay <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\toutput <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\"># è®¾ç½®ä¸€äº›é¢œè‰²åŒºåŸŸ</span>\n\t<span class=\"token keyword\">if</span> colors <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n\t\tcolors <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token number\">19</span><span class=\"token punctuation\">,</span> <span class=\"token number\">199</span><span class=\"token punctuation\">,</span> <span class=\"token number\">109</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">79</span><span class=\"token punctuation\">,</span> <span class=\"token number\">76</span><span class=\"token punctuation\">,</span> <span class=\"token number\">240</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">230</span><span class=\"token punctuation\">,</span> <span class=\"token number\">159</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token number\">168</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">168</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">158</span><span class=\"token punctuation\">,</span> <span class=\"token number\">163</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token number\">163</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">180</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token number\">220</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token comment\"># éå†æ¯ä¸€ä¸ªåŒºåŸŸ</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>FACIAL_LANDMARKS_68_IDXS<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token comment\"># å¾—åˆ°æ¯ä¸€ä¸ªç‚¹çš„åæ ‡</span>\n\t\t<span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> FACIAL_LANDMARKS_68_IDXS<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span>\n\t\tpts <span class=\"token operator\">=</span> shape<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">:</span>k<span class=\"token punctuation\">]</span>\n\t\t<span class=\"token comment\"># æ£€æŸ¥ä½ç½®</span>\n\t\t<span class=\"token keyword\">if</span> name <span class=\"token operator\">==</span> <span class=\"token string\">\"jaw\"</span><span class=\"token punctuation\">:</span>\n\t\t\t<span class=\"token comment\"># ç”¨çº¿æ¡è¿èµ·æ¥</span>\n\t\t\t<span class=\"token keyword\">for</span> l <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t\t\tptA <span class=\"token operator\">=</span> <span class=\"token builtin\">tuple</span><span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">[</span>l <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t\t\t\tptB <span class=\"token operator\">=</span> <span class=\"token builtin\">tuple</span><span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t\t\t\tcv2<span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">(</span>overlay<span class=\"token punctuation\">,</span> ptA<span class=\"token punctuation\">,</span> ptB<span class=\"token punctuation\">,</span> colors<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token comment\"># è®¡ç®—å‡¸åŒ…</span>\n\t\t<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n\t\t\thull <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>convexHull<span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">)</span>\n\t\t\tcv2<span class=\"token punctuation\">.</span>drawContours<span class=\"token punctuation\">(</span>overlay<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>hull<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> colors<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\"># å åŠ åœ¨åŸå›¾ä¸Šï¼Œå¯ä»¥æŒ‡å®šæ¯”ä¾‹</span>\n\tcv2<span class=\"token punctuation\">.</span>addWeighted<span class=\"token punctuation\">(</span>overlay<span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> alpha<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> output\n</code></pre>\n<p>è¿™ä¸ªå‡½æ•°æ˜¯è®¡ç®—<code>cv2.convexHull</code>å‡¸åŒ…çš„ï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾è¿™ä¸ªæ„æ€ã€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\f81de9bff8b340a79a6f1d90fa1afe54.png\"/><br/> è¿™ä¸ªå‡½æ•°<code>cv2.addWeighted</code>æ˜¯åšå›¾åƒå åŠ çš„ã€‚</p>\n<blockquote>\n<p>src1, src2ï¼šéœ€è¦èåˆå åŠ çš„ä¸¤å‰¯å›¾åƒï¼Œè¦æ±‚å¤§å°å’Œé€šé“æ•°ç›¸ç­‰<br/> alphaï¼šsrc1 çš„æƒé‡<br/> betaï¼šsrc2 çš„æƒé‡<br/> gammaï¼šgamma ä¿®æ­£ç³»æ•°ï¼Œä¸éœ€è¦ä¿®æ­£è®¾ç½®ä¸º 0<br/> dstï¼šå¯é€‰å‚æ•°ï¼Œè¾“å‡ºç»“æœä¿å­˜çš„å˜é‡ï¼Œé»˜è®¤å€¼ä¸º None<br/> dtypeï¼šå¯é€‰å‚æ•°ï¼Œè¾“å‡ºå›¾åƒæ•°ç»„çš„æ·±åº¦ï¼Œå³å›¾åƒå•ä¸ªåƒç´ å€¼çš„ä½æ•°ï¼ˆå¦‚ RGB ç”¨ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œåˆ™ä¸º 24 ä½ï¼‰ï¼Œé€‰é»˜è®¤å€¼ None è¡¨ç¤ºä¸æºå›¾åƒä¿æŒä¸€è‡´ã€‚</p>\n</blockquote>\n<p>dst = src1 Ã— alpha + src2 Ã— beta + gamma;ä¸Šé¢çš„å¼å­ç†è§£ä¸ºï¼Œç»“æœå›¾åƒ = å›¾åƒ 1Ã— ç³»æ•° 1+å›¾åƒ 2Ã— ç³»æ•° 2+äº®åº¦è°ƒèŠ‚é‡ã€‚</p>\n<h2><a id=\"_198\"></a>ğŸŒŸå®Œæ•´ä»£ç åŠæ•ˆæœå±•ç¤º</h2>\n<pre><code class=\"prism language-python\"><span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> OrderedDict\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> argparse\n<span class=\"token keyword\">import</span> dlib\n<span class=\"token keyword\">import</span> cv2\n\nap <span class=\"token operator\">=</span> argparse<span class=\"token punctuation\">.</span>ArgumentParser<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nap<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"-p\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--shape-predictor\"</span><span class=\"token punctuation\">,</span> required<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"path to facial landmark predictor\"</span><span class=\"token punctuation\">)</span>\nap<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"-i\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"--image\"</span><span class=\"token punctuation\">,</span> required<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token builtin\">help</span><span class=\"token operator\">=</span><span class=\"token string\">\"path to input image\"</span><span class=\"token punctuation\">)</span>\nargs <span class=\"token operator\">=</span> <span class=\"token builtin\">vars</span><span class=\"token punctuation\">(</span>ap<span class=\"token punctuation\">.</span>parse_args<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nFACIAL_LANDMARKS_68_IDXS <span class=\"token operator\">=</span> OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"mouth\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">48</span><span class=\"token punctuation\">,</span> <span class=\"token number\">68</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"right_eyebrow\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">17</span><span class=\"token punctuation\">,</span> <span class=\"token number\">22</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"left_eyebrow\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">22</span><span class=\"token punctuation\">,</span> <span class=\"token number\">27</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"right_eye\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">36</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"left_eye\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token number\">48</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"nose\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">27</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"jaw\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">17</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n\nFACIAL_LANDMARKS_5_IDXS <span class=\"token operator\">=</span> OrderedDict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"right_eye\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"left_eye\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">(</span><span class=\"token string\">\"nose\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">shape_to_np</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span><span class=\"token string\">\"int\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># åˆ›å»º68*2</span>\n\tcoords <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>zeros<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">.</span>num_parts<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span>dtype<span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\"># éå†æ¯ä¸€ä¸ªå…³é”®ç‚¹</span>\n\t<span class=\"token comment\"># å¾—åˆ°åæ ‡</span>\n\t<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> shape<span class=\"token punctuation\">.</span>num_parts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\tcoords<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">,</span> shape<span class=\"token punctuation\">.</span>part<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> coords\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">visualize_facial_landmarks</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> shape<span class=\"token punctuation\">,</span> colors<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> alpha<span class=\"token operator\">=</span><span class=\"token number\">0.75</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># åˆ›å»ºä¸¤ä¸ªcopy</span>\n\t<span class=\"token comment\"># overlay and one for the final output image</span>\n\toverlay <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\toutput <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\"># è®¾ç½®ä¸€äº›é¢œè‰²åŒºåŸŸ</span>\n\t<span class=\"token keyword\">if</span> colors <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n\t\tcolors <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span><span class=\"token number\">19</span><span class=\"token punctuation\">,</span> <span class=\"token number\">199</span><span class=\"token punctuation\">,</span> <span class=\"token number\">109</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">79</span><span class=\"token punctuation\">,</span> <span class=\"token number\">76</span><span class=\"token punctuation\">,</span> <span class=\"token number\">240</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">230</span><span class=\"token punctuation\">,</span> <span class=\"token number\">159</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token number\">168</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">168</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">158</span><span class=\"token punctuation\">,</span> <span class=\"token number\">163</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">(</span><span class=\"token number\">163</span><span class=\"token punctuation\">,</span> <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">180</span><span class=\"token punctuation\">,</span> <span class=\"token number\">42</span><span class=\"token punctuation\">,</span> <span class=\"token number\">220</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\t<span class=\"token comment\"># éå†æ¯ä¸€ä¸ªåŒºåŸŸ</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>FACIAL_LANDMARKS_68_IDXS<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t<span class=\"token comment\"># å¾—åˆ°æ¯ä¸€ä¸ªç‚¹çš„åæ ‡</span>\n\t\t<span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> FACIAL_LANDMARKS_68_IDXS<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span>\n\t\tpts <span class=\"token operator\">=</span> shape<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">:</span>k<span class=\"token punctuation\">]</span>\n\t\t<span class=\"token comment\"># æ£€æŸ¥ä½ç½®</span>\n\t\t<span class=\"token keyword\">if</span> name <span class=\"token operator\">==</span> <span class=\"token string\">\"jaw\"</span><span class=\"token punctuation\">:</span>\n\t\t\t<span class=\"token comment\"># ç”¨çº¿æ¡è¿èµ·æ¥</span>\n\t\t\t<span class=\"token keyword\">for</span> l <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\t\t\tptA <span class=\"token operator\">=</span> <span class=\"token builtin\">tuple</span><span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">[</span>l <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t\t\t\tptB <span class=\"token operator\">=</span> <span class=\"token builtin\">tuple</span><span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t\t\t\tcv2<span class=\"token punctuation\">.</span>line<span class=\"token punctuation\">(</span>overlay<span class=\"token punctuation\">,</span> ptA<span class=\"token punctuation\">,</span> ptB<span class=\"token punctuation\">,</span> colors<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token comment\"># è®¡ç®—å‡¸åŒ…</span>\n\t\t<span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n\t\t\thull <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>convexHull<span class=\"token punctuation\">(</span>pts<span class=\"token punctuation\">)</span>\n\t\t\tcv2<span class=\"token punctuation\">.</span>drawContours<span class=\"token punctuation\">(</span>overlay<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>hull<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> colors<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\"># å åŠ åœ¨åŸå›¾ä¸Šï¼Œå¯ä»¥æŒ‡å®šæ¯”ä¾‹</span>\n\tcv2<span class=\"token punctuation\">.</span>addWeighted<span class=\"token punctuation\">(</span>overlay<span class=\"token punctuation\">,</span> alpha<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> alpha<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">return</span> output\n\n<span class=\"token comment\"># åŠ è½½äººè„¸æ£€æµ‹ä¸å…³é”®ç‚¹å®šä½</span>\ndetector <span class=\"token operator\">=</span> dlib<span class=\"token punctuation\">.</span>get_frontal_face_detector<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\npredictor <span class=\"token operator\">=</span> dlib<span class=\"token punctuation\">.</span>shape_predictor<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"shape_predictor\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># è¯»å–è¾“å…¥æ•°æ®ï¼Œé¢„å¤„ç†</span>\nimage <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">[</span><span class=\"token string\">\"image\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\nwidth<span class=\"token operator\">=</span><span class=\"token number\">500</span>\nr <span class=\"token operator\">=</span> width <span class=\"token operator\">/</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">)</span>\ndim <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>h <span class=\"token operator\">*</span> r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nimage <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> dim<span class=\"token punctuation\">,</span> interpolation<span class=\"token operator\">=</span>cv2<span class=\"token punctuation\">.</span>INTER_AREA<span class=\"token punctuation\">)</span>\ngray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># äººè„¸æ£€æµ‹</span>\nrects <span class=\"token operator\">=</span> detector<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># éå†æ£€æµ‹åˆ°çš„æ¡†</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>rects<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\"># å¯¹äººè„¸æ¡†è¿›è¡Œå…³é”®ç‚¹å®šä½</span>\n\t<span class=\"token comment\"># è½¬æ¢æˆndarray</span>\n\tshape <span class=\"token operator\">=</span> predictor<span class=\"token punctuation\">(</span>gray<span class=\"token punctuation\">,</span> rect<span class=\"token punctuation\">)</span>\n\tshape <span class=\"token operator\">=</span> shape_to_np<span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># éå†æ¯ä¸€ä¸ªéƒ¨åˆ†</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> FACIAL_LANDMARKS_68_IDXS<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t\tclone <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>copy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\tcv2<span class=\"token punctuation\">.</span>putText<span class=\"token punctuation\">(</span>clone<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>FONT_HERSHEY_SIMPLEX<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token number\">0.7</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> \n\n\t\t<span class=\"token comment\"># æ ¹æ®ä½ç½®ç”»ç‚¹</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> shape<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n\t\t\tcv2<span class=\"token punctuation\">.</span>circle<span class=\"token punctuation\">(</span>clone<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n\t\t<span class=\"token comment\"># æå–ROIåŒºåŸŸ</span>\n\t\t<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">,</span> h<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>boundingRect<span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>shape<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">:</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\n\t\troi <span class=\"token operator\">=</span> image<span class=\"token punctuation\">[</span>y<span class=\"token punctuation\">:</span>y <span class=\"token operator\">+</span> h<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span>x <span class=\"token operator\">+</span> w<span class=\"token punctuation\">]</span>\n\t\t<span class=\"token punctuation\">(</span>h<span class=\"token punctuation\">,</span> w<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> roi<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n\t\twidth<span class=\"token operator\">=</span><span class=\"token number\">250</span>\n\t\tr <span class=\"token operator\">=</span> width <span class=\"token operator\">/</span> <span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span>w<span class=\"token punctuation\">)</span>\n\t\tdim <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>width<span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>h <span class=\"token operator\">*</span> r<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\troi <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>resize<span class=\"token punctuation\">(</span>roi<span class=\"token punctuation\">,</span> dim<span class=\"token punctuation\">,</span> interpolation<span class=\"token operator\">=</span>cv2<span class=\"token punctuation\">.</span>INTER_AREA<span class=\"token punctuation\">)</span>\n\t\t\n\t\t<span class=\"token comment\"># æ˜¾ç¤ºæ¯ä¸€éƒ¨åˆ†</span>\n\t\tcv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">\"ROI\"</span><span class=\"token punctuation\">,</span> roi<span class=\"token punctuation\">)</span>\n\t\tcv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">\"Image\"</span><span class=\"token punctuation\">,</span> clone<span class=\"token punctuation\">)</span>\n\t\tcv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token comment\"># å±•ç¤ºæ‰€æœ‰åŒºåŸŸ</span>\n\toutput <span class=\"token operator\">=</span> visualize_facial_landmarks<span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> shape<span class=\"token punctuation\">)</span>\n\tcv2<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span><span class=\"token string\">\"Image\"</span><span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">)</span>\n\tcv2<span class=\"token punctuation\">.</span>waitKey<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\9882d96f3feb4013a65b9a8725138b6f.png\"/><br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\a89fc5512f21463e95ed8035f5c9f408.png\"/><br/> æœ€ç»ˆå°†7ä¸ªäººçš„äººè„¸éƒ½ä¾æ¬¡çš„æ£€æµ‹åˆ°äº†ã€‚å¹¶ä¸”æ ¹æ®å…³é”®ç‚¹å®šä½åˆ°äº†ã€‚<br/> <img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\074f9c37680441b1ab515597d6b692f9.png\"/></p>\n<blockquote>\n<p>ğŸ”<strong>æ”¯æŒ</strong>ï¼š<font color=\"OliveDrab\" face=\"æ¥·ä½“\" size=\"3\">ğŸğŸğŸ<strong>å¦‚æœè§‰å¾—åšä¸»çš„æ–‡ç« è¿˜ä¸é”™æˆ–è€…æ‚¨ç”¨å¾—åˆ°çš„è¯ï¼Œå¯ä»¥å…è´¹çš„å…³æ³¨ä¸€ä¸‹åšä¸»ï¼Œå¦‚æœä¸‰è¿æ”¶è—æ”¯æŒå°±æ›´å¥½å•¦ï¼è¿™å°±æ˜¯ç»™äºˆæˆ‘æœ€å¤§çš„æ”¯æŒï¼</strong></font></p>\n</blockquote>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Python", "cpp": 0, "csharp": 0, "python": 1, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-08-23 22:21:41", "summary": "æ¥·ä½“æ¬¢è¿æ¥åˆ°æœ¬åšå®¢æœ¬æ¬¡åšå®¢å†…å®¹å°†ç»§ç»­è®²è§£å…³äºçš„ç›¸å…³çŸ¥è¯†ä½œè€…ç®€ä»‹ï¼šæ¥·ä½“ç›®å‰è®¡ç®—æœºç ”ç©¶ç”Ÿåœ¨è¯»ã€‚ä¸»è¦ç ”ç©¶æ–¹å‘æ˜¯äººå·¥æ™ºèƒ½å’Œç¾¤æ™ºèƒ½ç®—æ³•æ–¹å‘ã€‚ç›®å‰ç†Ÿæ‚‰æ·±åº¦å­¦ä¹ ã€ã€ç³»åˆ—ï¼Œç½‘é¡µçˆ¬è™«ã€æœºå™¨å­¦ä¹ ã€è®¡ç®—æœºè§†è§‰ã€ç¾¤æ™ºèƒ½ç®—æ³•ã€‚"}