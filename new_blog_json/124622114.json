{"blogid": "124622114", "writerAge": "码龄2年", "writerBlogNum": "39", "writerCollect": "117", "writerComment": "85", "writerFan": "777", "writerGrade": "3级", "writerIntegral": "709", "writerName": "渗透者:'", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124622114.jpg", "writerRankTotal": "35466", "writerRankWeekly": "25446", "writerThumb": "117", "writerVisitNum": "38356", "blog_read_count": "1598", "blog_time": "已于 2022-05-07 00:39:10 修改", "blog_title": "网络安全之文件上传漏洞", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"%E4%B8%80.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%80.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D\">一.文件上传漏洞原理🐱‍🏍🐱‍🏍🐱‍🏍</a></p>\n<p id=\"1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD-toc\" style=\"margin-left:40px;\"><a href=\"#1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD\">1.文件上传功能</a></p>\n<p id=\"2.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC-toc\" style=\"margin-left:40px;\"><a href=\"#2.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC\">2.一句话木马</a></p>\n<p id=\"%E4%BA%8CWebshell%E4%BB%8B%E7%BB%8D%E2%98%A0%E2%98%A0%E2%98%A0-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%8CWebshell%E4%BB%8B%E7%BB%8D%E2%98%A0%E2%98%A0%E2%98%A0\">二Webshell介绍☠☠☠</a></p>\n<p id=\"1.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E7%89%B9%E7%82%B9-toc\" style=\"margin-left:40px;\"><a href=\"#1.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E7%89%B9%E7%82%B9\">1.一句话木马的特点</a></p>\n<p id=\"2.%E5%B0%8F%E9%A9%AC-toc\" style=\"margin-left:40px;\"><a href=\"#2.%E5%B0%8F%E9%A9%AC\">2.小马</a></p>\n<p id=\"3.%E5%A4%A7%E9%A9%AC-toc\" style=\"margin-left:40px;\"><a href=\"#3.%E5%A4%A7%E9%A9%AC\">3.大马</a></p>\n<p id=\"%E4%B8%89%E7%BD%91%E7%AB%99%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7%F0%9F%A6%84%F0%9F%A6%84%F0%9F%A6%84-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%89%E7%BD%91%E7%AB%99%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7%F0%9F%A6%84%F0%9F%A6%84%F0%9F%A6%84\">三网站控制工具🦄🦄🦄</a></p>\n<p id=\"%E5%9B%9B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%8D%B1%E5%AE%B3%F0%9F%91%80%F0%9F%91%80%F0%9F%91%80-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%9B%9B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%8D%B1%E5%AE%B3%F0%9F%91%80%F0%9F%91%80%F0%9F%91%80\">四文件上传的危害👀👀👀</a></p>\n<p id=\"%E4%BA%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0%F0%9F%90%B2%F0%9F%90%B2%F0%9F%90%B2-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0%F0%9F%90%B2%F0%9F%90%B2%F0%9F%90%B2\">五文件上传靶场练习🐲🐲🐲</a></p>\n<p id=\"%E5%85%AD.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89-toc\" style=\"margin-left:0px;\"><a href=\"#%E5%85%AD.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89\">六.文件上传漏洞发现与利用🐱‍🐉🐱‍🐉🐱‍🐉</a></p>\n<p id=\"1.%E5%88%A9%E7%94%A8%E7%9A%84%E6%B5%81%E7%A8%8B-toc\" style=\"margin-left:40px;\"><a href=\"#1.%E5%88%A9%E7%94%A8%E7%9A%84%E6%B5%81%E7%A8%8B\">1.利用的流程</a></p>\n<p id=\"1%E6%89%BE%E5%88%B0%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BD%8D%E7%BD%AE-toc\" style=\"margin-left:80px;\"><a href=\"#1%E6%89%BE%E5%88%B0%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BD%8D%E7%BD%AE\">1找到上传的位置</a></p>\n<p id=\"2.%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E6%A0%A1%E9%AA%8C%2C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6-toc\" style=\"margin-left:80px;\"><a href=\"#2.%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E6%A0%A1%E9%AA%8C%2C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6\">2.尝试绕过校验,上传文件</a></p>\n<p id=\"3.%E8%8E%B7%E5%BE%97%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE-toc\" style=\"margin-left:80px;\"><a href=\"#3.%E8%8E%B7%E5%BE%97%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE\">3.获得文件位置</a></p>\n<p id=\"4.%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%2C%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6-toc\" style=\"margin-left:80px;\"><a href=\"#4.%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%2C%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6\">4.蚁剑链接,管理文件</a></p>\n<p id=\"7.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B2%E5%BE%A1%F0%9F%91%B9%F0%9F%91%B9%F0%9F%91%B9-toc\" style=\"margin-left:0px;\"><a href=\"#7.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B2%E5%BE%A1%F0%9F%91%B9%F0%9F%91%B9%F0%9F%91%B9\">7.文件上传漏洞的防御👹👹👹</a></p>\n<p id=\"1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%94%9F%E7%9A%84%E5%89%8D%E6%8F%90-toc\" style=\"margin-left:40px;\"><a href=\"#1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%94%9F%E7%9A%84%E5%89%8D%E6%8F%90\">1.文件上传漏洞发生的前提</a></p>\n<p id=\"2.%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD%F0%9F%A4%A1%F0%9F%A4%A1%F0%9F%A4%A1-toc\" style=\"margin-left:40px;\"><a href=\"#2.%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD%F0%9F%A4%A1%F0%9F%A4%A1%F0%9F%A4%A1\">2.防御措施🤡🤡🤡</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<p></p>\n<h1 id=\"%E4%B8%80.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D%F0%9F%90%B1%E2%80%8D%F0%9F%8F%8D\">一.文件上传漏洞原理🐱‍🏍🐱‍🏍🐱‍🏍</h1>\n<h2 id=\"1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD\">1.文件上传功能</h2>\n<p>网站Web应用都有一些文件上传功能，比如文档、图片、头像、视频上传，当上传功能的实现代码没有严格校验上传文件的后缀和文件类型，此时攻击者就可以上传一个webshell到一个Web可访问的目录上，并将恶意文件传递给如PHP解释器去执行，之后就可以在服务器上执行恶意代码，进行数据库执行、服务器文件管理，服务器命令执行等恶意操作。还有一部分是攻击者通过Web服务器的解析漏洞来突破Web应用程序的防护。</p>\n<p><img alt=\"\" height=\"357\" src=\"..\\..\\static\\image\\2c8a00a7fb6d45bcbad01a65cb5f3eb8.png\" width=\"726\"/></p>\n<p></p>\n<p></p>\n<h2 id=\"2.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC\">2.一句话木马</h2>\n<p><img alt=\"\" height=\"109\" src=\"..\\..\\static\\image\\c9efd97fbacc488c9a6048ecd17da749.png\" width=\"686\"/></p>\n<p></p>\n<p></p>\n<h1 id=\"%E4%BA%8CWebshell%E4%BB%8B%E7%BB%8D%E2%98%A0%E2%98%A0%E2%98%A0\">二Webshell介绍☠☠☠</h1>\n<h2 id=\"1.%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E7%9A%84%E7%89%B9%E7%82%B9\">1.一句话木马的特点</h2>\n<p>代码短,只有一行代码.</p>\n<p>场景多,可以单独生成文件,也可以插入图片中</p>\n<p>安全性高,隐匿性强,可变形免杀</p>\n<p></p>\n<h2 id=\"2.%E5%B0%8F%E9%A9%AC\">2.小马</h2>\n<p>体积小,功能少</p>\n<p>只有文件上传功能</p>\n<p></p>\n<h2 id=\"3.%E5%A4%A7%E9%A9%AC\">3.大马</h2>\n<p>体积大,功能全</p>\n<p>能够管理数据库,文件管理,对站点进行快速的信息收集,甚至能够提权</p>\n<p></p>\n<pre>github.com/tennc/webshell</pre>\n<p></p>\n<h1 id=\"%E4%B8%89%E7%BD%91%E7%AB%99%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7%F0%9F%A6%84%F0%9F%A6%84%F0%9F%A6%84\">三网站控制工具🦄🦄🦄</h1>\n<p>主流工具(注:如果需要这些工具的安装和使用教程请私信我扣1,我看人数来决定更新)</p>\n<p>中国菜刀</p>\n<p>中国蚁剑</p>\n<pre><code>https://github/AntSwordProject/antSword</code></pre>\n<p><img alt=\"\" height=\"458\" src=\"..\\..\\static\\image\\a895b83740764658b54ff45792570504.png\" width=\"691\"/></p>\n<p></p>\n<p></p>\n<p>weevely</p>\n<pre><code>https://github.com/epinna/weevely3</code></pre>\n<p>哥斯拉 godzilla</p>\n<pre><code>https://github.com/BeichenDream/Godzilla</code></pre>\n<p><img alt=\"\" height=\"277\" src=\"..\\..\\static\\image\\88e04f7994a548fba6a255ac3b3a27ba.png\" width=\"711\"/></p>\n<p></p>\n<p></p>\n<p>冰蝎</p>\n<pre><code>https://github.com/rebeyond/Behinder</code></pre>\n<p><img alt=\"\" height=\"537\" src=\"..\\..\\static\\image\\ed8c738071be480e8f6dbf48901abff5.png\" width=\"711\"/></p>\n<p></p>\n<p></p>\n<h1 id=\"%E5%9B%9B%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%8D%B1%E5%AE%B3%F0%9F%91%80%F0%9F%91%80%F0%9F%91%80\">四文件上传的危害👀👀👀</h1>\n<p>文件上传漏洞是指用户上传一个可执行的脚本文件,而且通过这个脚本文件获得了执行服务器端命令的能力</p>\n<pre>wooyun.2xss.cc/searchbug.php?q=文件上传              //现在已经挂掉,只剩下一个镜像站</pre>\n<p></p>\n<p>1.危害一:黑链接</p>\n<p>有可能被攻击者挂上黑链接</p>\n<p><img alt=\"\" height=\"338\" src=\"..\\..\\static\\image\\81907b225ac7410abd30c88b50ea653e.png\" width=\"657\"/></p>\n<p></p>\n<p></p>\n<p>2.挖矿</p>\n<p><img alt=\"\" height=\"160\" src=\"..\\..\\static\\image\\73f1c8ac988f4ee9b85050a2bc505bf6.png\" width=\"679\"/></p>\n<p></p>\n<p></p>\n<p>3.敏感文件的泄露(不具体展示)</p>\n<p><img alt=\"\" height=\"47\" src=\"..\\..\\static\\image\\2a9b829ec89b47fe854fe3be215a8146.png\" width=\"551\"/></p>\n<p></p>\n<h1 id=\"%E4%BA%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%9D%B6%E5%9C%BA%E7%BB%83%E4%B9%A0%F0%9F%90%B2%F0%9F%90%B2%F0%9F%90%B2\">五文件上传靶场练习🐲🐲🐲</h1>\n<p>(注:靶场我会出一个专栏给大家补上md的)</p>\n<pre><code>https://github.com/c0ny1/upload-labs</code></pre>\n<p><img alt=\"\" height=\"318\" src=\"..\\..\\static\\image\\c2e736e2caf44871881297d8eaecd9c5.png\" width=\"712\"/></p>\n<p></p>\n<p></p>\n<h1 id=\"%E5%85%AD.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0%E4%B8%8E%E5%88%A9%E7%94%A8%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89%F0%9F%90%B1%E2%80%8D%F0%9F%90%89\">六.文件上传漏洞发现与利用🐱‍🐉🐱‍🐉🐱‍🐉</h1>\n<h2 id=\"1.%E5%88%A9%E7%94%A8%E7%9A%84%E6%B5%81%E7%A8%8B\">1.利用的流程</h2>\n<pre>github.com/almandin/fuxploider</pre>\n<h3 id=\"1%E6%89%BE%E5%88%B0%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BD%8D%E7%BD%AE\">1找到上传的位置</h3>\n<h3 id=\"2.%E5%B0%9D%E8%AF%95%E7%BB%95%E8%BF%87%E6%A0%A1%E9%AA%8C%2C%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6\">2.尝试绕过校验,上传文件</h3>\n<p>删除/禁用JS,修改MIME,等价扩展名,大小写,htaccess,双写,空格,点. ::$DATA , %00截断, 0x00截断, 图片马,条件竞争等等</p>\n<h3 id=\"3.%E8%8E%B7%E5%BE%97%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE\">3.获得文件位置</h3>\n<p>1.开源的就审计代码</p>\n<p>2.做一个文件的审查器</p>\n<h3 id=\"4.%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%2C%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6\">4.蚁剑链接,管理文件</h3>\n<p></p>\n<h1 id=\"7.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%98%B2%E5%BE%A1%F0%9F%91%B9%F0%9F%91%B9%F0%9F%91%B9\">7.文件上传漏洞的防御👹👹👹</h1>\n<h2 id=\"1.%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%94%9F%E7%9A%84%E5%89%8D%E6%8F%90\">1.文件上传漏洞发生的前提</h2>\n<p>1.网站上传功能正常</p>\n<p>2.文件类型允许上传</p>\n<p>3.上传路径可以确认</p>\n<p>4.文件可以被访问,可以被执行或被包含</p>\n<p></p>\n<p>Linux文件权限</p>\n<p><img alt=\"\" height=\"795\" src=\"..\\..\\static\\image\\a0e63fb70d784ee3ac019458f47de684.png\" width=\"705\"/></p>\n<p></p>\n<p></p>\n<h2 id=\"2.%E9%98%B2%E5%BE%A1%E6%8E%AA%E6%96%BD%F0%9F%A4%A1%F0%9F%A4%A1%F0%9F%A4%A1\">2.防御措施🤡🤡🤡</h2>\n<p>1.扩展名(后缀)黑白名单</p>\n<p>2.MIME类型校验(image/gif)</p>\n<p>3.文件内容头校验(GIF89a)</p>\n<p>4.对文件内容进行二次渲染</p>\n<p>5.对上传的文件重命名,不易被猜测</p>\n<p>6.不要暴露上传文件的位置</p>\n<p>7.禁用上传文件的执行权限</p>\n</div>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-05-07 00:39:10", "summary": "目录一文件上传漏洞原理文件上传功能一句话木马二介绍一句话木马的特点小马大马三网站控制工具四文件上传的危害五文件上传靶场练习六文件上传漏洞发现与利用利用的流程找到上传的位置尝试绕过校验上传文件获得文件位"}