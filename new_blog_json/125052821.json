{"blogid": "125052821", "writerAge": "码龄2年", "writerBlogNum": "34", "writerCollect": "14", "writerComment": "19", "writerFan": "8", "writerGrade": "3级", "writerIntegral": "413", "writerName": "可乐沙司", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125052821.jpg", "writerRankTotal": "58602", "writerRankWeekly": "392983", "writerThumb": "28", "writerVisitNum": "10429", "blog_read_count": "1025", "blog_time": "于 2022-05-30 19:58:33 发布", "blog_title": "自动生成单号", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p style=\"margin-left:.0001pt;\">开发工具与关键技术： VisualStudio2019  C#</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">作者：可乐沙司</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">撰写时间：2022/5/30</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">单号：有订单号，收据号，支票号，快递单号，发票号，在我们做项目的时候常常会出现，单号是不断的变化的，所以要怎么实现的不断变化呢？</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">今天的内容就是：如何自动生成单号。</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">第一：在项目添加一个类：</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"400\" src=\"..\\..\\static\\image\\486022d3400d43b8a25e7c67c1bbacb5.png\" width=\"375\"/></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">第二：在这个名为OriginalNumer的类里面，引用你的数据库模型：</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"294\" src=\"..\\..\\static\\image\\65dd152f9ece40b28a4c21192b1eef0e.png\" width=\"554\"/></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">第三：这个类里面的代码：</p>\n<pre><code class=\"language-cs\">using System;\n\nusing System.Collections.Generic;\n\nusing System.Linq;\n\nusing System.Web;\n\n\n\nnamespace 医院信息管理系统.EntityClass\n\n{\n\n    public class OriginalNumber\n\n    {\n\n        Models.SYS_HISEntities myModel = new Models.SYS_HISEntities();\n\n\n\n        public string GenerateReceipts(string strQZ, string Number)\n\n        {\n\n            try\n\n            {\n\n                string strNumber = \"\";\n\n                //从第几个开始,截取长度为 几 的字符串\n\n                string date = Number.Substring(0, 8);//日期(202103300001)\n\n                string dtnow = DateTime.Now.ToString(\"yyyyMMdd\");\n\n                //比较单号日期和现在日期\n\n                if (date == dtnow)\n\n                {\n\n                    //(1)日期一致：原来单号 + 1\n\n                    //从右边开始取4个字符\n\n                    int intNumber = System.Convert.ToInt32(Number.Substring((Number.Trim()).Length - 4));\n\n\n\n                    strNumber = (intNumber + 1).ToString();\n\n                }\n\n                else\n\n                {\n\n                    //(2)日期不一致：从1开始\n\n                    strNumber = \"1\";\n\n                }\n\n\n\n                switch (strNumber.Length)\n\n                {\n\n                    case 1:\n\n                        strNumber = \"000\" + strNumber;\n\n                        break;\n\n                    case 2:\n\n                        strNumber = \"00\" + strNumber;\n\n                        break;\n\n                    case 3:\n\n                        strNumber = \"0\" + strNumber;\n\n                        break;\n\n                    case 4:\n\n                        strNumber = \"\" + strNumber;\n\n                        break;\n\n                }\n\n\n\n                //获取日期\n\n                strNumber = strQZ + dtnow + strNumber;\n\n\n\n                return strNumber;\n\n            }\n\n            catch (Exception e)\n\n            {\n\n                Console.WriteLine(e);\n\n                return null;\n\n            }\n\n        }\n\n\n\n        //生成进货单号\n\n        public string CreateCJNo()\n\n        {\n\n            string purchase = \"\";\n\n            try\n\n            {\n\n                //获取上一次收据单号，查看日期是否为今天，若是收据号码加一，反之从今天第一单开始\n\n                var ReceiptNumders = myModel.AdvanceGold.OrderByDescending(o =&gt; o.AdvanceGoldID).First().ReceiptNumder;\n\n                //截取后面的数组进行对比\n\n                string strpurchase = ReceiptNumders.Substring(ReceiptNumders.Trim().Length - 12);\n\n                purchase = GenerateReceipts(\"SJ\", strpurchase);\n\n            }\n\n            catch (Exception)\n\n            {\n\n                purchase = \"SJ\" + DateTime.Now.ToString(\"yyyyMMdd\") + \"0001\";\n\n            }\n\n\n\n            return purchase;\n\n        }\n\n    }\n\n}</code></pre>\n<p style=\"margin-left:.0001pt;text-align:justify;\">第四：方法讲解：</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"212\" src=\"..\\..\\static\\image\\98740cf1e47f47aabf27047e1186dd6a.png\" width=\"554\"/></p>\n<p>1.OrderByDescending（）：按根据某个健按降序的方式对序列的元素进行排序。</p>\n<p>2.First（）：返回一个序列的第一个元素。</p>\n<p>3.Substring（）：检索子字符串，字符串在指定的字符位置开始一直到该字符串的末尾。</p>\n<p>4.First（）后面的ReceiptNumer是要在数据库查询的字段。</p>\n<p>5.GenerateRecipts（）：跳转。</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"689\" src=\"..\\..\\static\\image\\363d276ab3d2426db986c2f66f8630cb.png\" width=\"544\"/></p>\n<p> 括号里面是下面方法转过来的两个字符串，然后声明一个字符串，最终用来输出，获取当前日期，比较单号日期，如果日期一致，单号加一，如果不一致，就会从今天的第一单开始。</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">第五：控制器引用：</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"237\" src=\"..\\..\\static\\image\\8d0e98d926094f608700a3f990dcd020.png\" width=\"494\"/></p>\n<p> 在控制器实例化单号，把单号传回页面。</p>\n<p>第六：页面引用：</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"50\" src=\"..\\..\\static\\image\\c147027f25014ee28010c433a0f0461f.png\" width=\"554\"/></p>\n<p> 效果:</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"54\" src=\"..\\..\\static\\image\\2c3462f821bd40498c47064f60f344b0.png\" width=\"206\"/></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"49\" src=\"..\\..\\static\\image\\ad42f3871dd543dc914562f329641241.png\" width=\"553\"/></p>\n<p> 效果：</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"><img alt=\"\" height=\"52\" src=\"..\\..\\static\\image\\04cf5e71f9b6485ba53255660d655aa5.png\" width=\"554\"/></p>\n<p> </p>\n<p style=\"margin-left:.0001pt;text-align:justify;\"></p>\n</div>\n</div>", "first_tag": "C#", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-05-30 19:58:33", "summary": "开发工具与关键技术：作者：可乐沙司撰写时间：单号：有订单号，收据号，支票号，快递单号，发票号，在我们做项目的时候常常会出现，单号是不断的变化的，所以要怎么实现的不断变化呢？今天的内容就是：如何自动生成"}