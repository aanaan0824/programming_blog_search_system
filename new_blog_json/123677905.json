{"blogid": "123677905", "writerAge": "码龄8年", "writerBlogNum": "23", "writerCollect": "67", "writerComment": "18", "writerFan": "14", "writerGrade": "2级", "writerIntegral": "381", "writerName": "愤怒小绵羊", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123677905.jpg", "writerRankTotal": "80306", "writerRankWeekly": "492574", "writerThumb": "16", "writerVisitNum": "34480", "blog_read_count": "8096", "blog_time": "已于 2022-04-26 13:41:52 修改", "blog_title": "Vue页面生成PDF的方法", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p>最近项目有个需求，将系统统计的数据生成分析报告，然后可以导出成PDF。</p>\n<p>这种方法可以有两种，一种是直接调用打印，用户通过浏览器提供的打印页面手动选择导出PDF。当然这种方式兼容性差，且体验不好，显然不是我们想要的效果。</p>\n<p>那么第二种方法的实现思路是什么呢？</p>\n<p>首先生成报告页面，也就是常规页面；<br/> 然后将页面转换成图片（ 用到的组件 html2canvas ）；<br/> 最后将图片导出成PDF（ 用到的组件 jspdf ）。</p>\n<h2><a id=\"_10\"></a>安装依赖</h2>\n<pre><code class=\"prism language-html\">npm install --save html2canvas  // 页面转图片\nnpm install jspdf --save  // 图片转pdf\n</code></pre>\n<h2><a id=\"_15\"></a>页面转图片</h2>\n<p>新建一个 index.vue 页面：</p>\n<pre><code class=\"prism language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pdf<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    这是待转换的页面，点击 \n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">@click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleExport<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>导出<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span> 按钮，完成导出操作。\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">&gt;</span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{<!-- --></span>downloadPDF<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/util/pdf.js\"</span>  <span class=\"token comment\">//工具方法，导出操作</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pdf\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{<!-- --></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">methods</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function\">handleExport</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token function\">downloadPDF</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>pdf<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<p>页面很简单，一段话加上一个导出按钮。整个页面被设置别名 （ref=“pdf”），导出的时候通过别名导出整个页面。</p>\n<p>按钮点击事件中调用了一个工具方法 downloadPDF()，来自于工具类 pdf.js：</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">import</span> html2canvas <span class=\"token keyword\">from</span> <span class=\"token string\">\"html2canvas\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">downloadPDF</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">page</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token function\">html2canvas</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">canvas</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    page<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>也很简单，首先引入了 html2canvas，定义downloadPDF方法，接受一个参数就是要导出的内容，可以使用id获取，也可以使用 ref 。</p>\n<p>运行结果：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8a0c1568ba9e4661be2d4e4475d3932f.png\"/></p>\n<p>当我们点击导出按钮后，在现有的页面增加了一行相同的内容。通过元素检查器可以看到增加的这行内容实际是一个 canvas 图像，里面的按钮已经不可以操作了。</p>\n<p>这样，页面转换图片的过程就完成了。</p>\n<h2><a id=\"PDF_62\"></a>图片转PDF</h2>\n<p>首先给index.vue改造一下，为了让我们导出的pdf好看一点，使用el-table做个表格，其它的导出逻辑不变：</p>\n<pre><code class=\"prism language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pdf<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n    \n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-table</span>\n      <span class=\"token attr-name\">:data</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tableData<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 700px</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-table-column</span>\n        <span class=\"token attr-name\">prop</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>date<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>时间<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>180<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-table-column</span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-table-column</span>\n        <span class=\"token attr-name\">prop</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>姓名<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>180<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-table-column</span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>el-table-column</span>\n        <span class=\"token attr-name\">prop</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>address<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>对我说<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-table-column</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>el-table</span><span class=\"token punctuation\">&gt;</span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">@click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleExport<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>导出<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">&gt;</span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">&gt;</span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{<!-- --></span>downloadPDF<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/util/pdf.js\"</span>  <span class=\"token comment\">//工具方法，导出操作</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"pdf\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{<!-- --></span>\n      \n          <span class=\"token literal-property property\">tableData</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> <span class=\"token string\">'昨天'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'刘德华'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">address</span><span class=\"token operator\">:</span> <span class=\"token string\">'你好帅'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> <span class=\"token string\">'今天'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'郭富城'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">address</span><span class=\"token operator\">:</span> <span class=\"token string\">'你最帅'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> <span class=\"token string\">'明天'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'张学友'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">address</span><span class=\"token operator\">:</span> <span class=\"token string\">'你贼帅'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> <span class=\"token string\">'每天'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'黎明'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">address</span><span class=\"token operator\">:</span> <span class=\"token string\">'我没你帅'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">methods</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function\">handleExport</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{<!-- --></span>\n      <span class=\"token function\">downloadPDF</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$refs<span class=\"token punctuation\">.</span>pdf<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<p>效果图：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\1a1bd217fa5b465796d8f53751338fb2.png\"/><br/> 然后改造一下pdf.js，增加上pdf转换逻辑</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">import</span> html2canvas <span class=\"token keyword\">from</span> <span class=\"token string\">\"html2canvas\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> jsPDF <span class=\"token keyword\">from</span> <span class=\"token string\">\"jspdf\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">downloadPDF</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">page</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token function\">html2canvas</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">canvas</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function\">canvas2PDF</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">canvas2PDF</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">canvas</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token keyword\">let</span> contentWidth <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> contentHeight <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">let</span> imgHeight <span class=\"token operator\">=</span> contentHeight<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> imgWidth <span class=\"token operator\">=</span> contentWidth<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 第一个参数： l：横向  p：纵向</span>\n  <span class=\"token comment\">// 第二个参数：测量单位（\"pt\"，\"mm\", \"cm\", \"m\", \"in\" or \"px\"）</span>\n  <span class=\"token keyword\">let</span> pdf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">jsPDF</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"l\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"pt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  pdf<span class=\"token punctuation\">.</span><span class=\"token function\">addImage</span><span class=\"token punctuation\">(</span>\n    canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image/jpeg\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"JPEG\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    imgWidth<span class=\"token punctuation\">,</span>\n    imgHeight\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  pdf<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"导出.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>canvas2PDF 方法中创建了jsPDF的实例，然后添加上一步生成的图片，最后保存导出pdf文件。</p>\n<p>导出的文件效果：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\7d2de57748d74f21ba53a221723461a2.png\"/></p>\n<h2><a id=\"A4_166\"></a>A4打印适配</h2>\n<p>因为部分需求有需要生成的页面使用A4纸打印，那么pdf生成时的宽高尺寸就不能像上面一样设定。需要按照A4纸的尺寸比例调整（其它打印需求同理，使用对应纸张比例即可）</p>\n<p>那么改造一下 pdf.js</p>\n<pre><code class=\"prism language-javascript\"><span class=\"token keyword\">import</span> html2canvas <span class=\"token keyword\">from</span> <span class=\"token string\">\"html2canvas\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> jsPDF <span class=\"token keyword\">from</span> <span class=\"token string\">\"jspdf\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">downloadPDF</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">page</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token function\">html2canvas</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">canvas</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function\">canvas2PDF</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">canvas2PDF</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">canvas</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token keyword\">let</span> contentWidth <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> contentHeight <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高</span>\n  <span class=\"token keyword\">let</span> imgWidth <span class=\"token operator\">=</span> <span class=\"token number\">595.28</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> imgHeight <span class=\"token operator\">=</span> <span class=\"token number\">592.28</span><span class=\"token operator\">/</span>contentWidth <span class=\"token operator\">*</span> contentHeight<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 第一个参数： l：横向  p：纵向</span>\n  <span class=\"token comment\">// 第二个参数：测量单位（\"pt\"，\"mm\", \"cm\", \"m\", \"in\" or \"px\"）</span>\n  <span class=\"token keyword\">let</span> pdf <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">jsPDF</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"p\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"pt\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  pdf<span class=\"token punctuation\">.</span><span class=\"token function\">addImage</span><span class=\"token punctuation\">(</span>\n    canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image/jpeg\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"JPEG\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    imgWidth<span class=\"token punctuation\">,</span>\n    imgHeight\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  pdf<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"导出.pdf\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>这里面将 imgWidth 和 imgHeight 按照A4纸比例调整后，导出的pdf就可以正常比例打印了。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "JavaScript", "cpp": 0, "csharp": 0, "python": 0, "javascript": 1, "java": 0, "sql": 0, "php": 0, "time": "2022-04-26 13:41:52", "summary": "最近项目有个需求，将系统统计的数据生成分析报告，然后可以导出成。这种方法可以有两种，一种是直接调用打印，用户通过浏览器提供的打印页面手动选择导出。当然这种方式兼容性差，且体验不好，显然不是我们想要的效"}