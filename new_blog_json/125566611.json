{"blogid": "125566611", "writerAge": "码龄3年", "writerBlogNum": "57", "writerCollect": "168", "writerComment": "135", "writerFan": "2005", "writerGrade": "4级", "writerIntegral": "1367", "writerName": "阿杆.", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125566611.jpg", "writerRankTotal": "13648", "writerRankWeekly": "397", "writerThumb": "175", "writerVisitNum": "74800", "blog_read_count": "2681", "blog_time": "已于 2022-07-27 19:42:29 修改", "blog_title": "MySQL占用内存过大解决方案", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><ul><li><a href=\"#_2\">前言</a></li><li><a href=\"#_16\">解决方案</a></li><li><ul><li><a href=\"#1__20\">1. 找到配置文件</a></li><li><ul><li><a href=\"#_Windows_Service_2016_22\">- Windows Service 2016</a></li><li><a href=\"#_CentOS7_31\">- CentOS7</a></li></ul>\n</li><li><a href=\"#2__37\">2. 修改配置文件</a></li><li><a href=\"#3_MySQL_63\">3. 重启MySQL</a></li><li><ul><li><a href=\"#_Windows_Service_2016_65\">- Windows Service 2016</a></li><li><a href=\"#_CentOS7_74\">- CentOS7</a></li></ul>\n</li></ul>\n</li><li><a href=\"#_87\">后记</a></li></ul>\n</li></ul>\n</div>\n<p></p>\n<h2><a id=\"_2\"></a>前言</h2>\n<p>对于部分小资玩家来说，服务器数量和内存往往是很有限的，像我个人的服务器配置就是2核4G5M。</p>\n<p>4G内存对于Java玩家来说，真的不大，开几个中间件+自己的微服务真的还蛮挤的，然后又摊上MySQL这个大冤种。我本机上的MySQL仅仅只占几M内存（虽然我不怎么用，但是本机MySQL确实是开着的）：</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\09b403e01def4e81ada45c410577e9e5.png\"/></p>\n<p>而服务器的则要占400M，怎么说其实没什么吞吐量，纯粹是自己玩一玩，这内存占用属实有点吃不消啊。。。</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\f50b93d42afb4c44ab129efe4ec56b3d.png\"/></p>\n<h2><a id=\"_16\"></a>解决方案</h2>\n<p>了解到可以通过修改配置来减小MySQL的内存占用，便尝试了一下，并进行了记录。由于我同时有两台服务器，一台装的是windows service 2016，还有一台装的是CentOS7，两台情况都是差不多的，故同时做两份记录，供大家参考。</p>\n<h3><a id=\"1__20\"></a>1. 找到配置文件</h3>\n<h4><a id=\"_Windows_Service_2016_22\"></a>- Windows Service 2016</h4>\n<p>配置文件的默认位置是 <mark>C:\\ProgramData\\MySQL\\MySQL Server 8.0\\my.ini</mark>，如果有修改，则根据自己的实际情况找到。</p>\n<p><img alt=\"\" src=\"..\\..\\static\\image\\dc35153e42304749ace73a174549abcd.png\"/></p>\n<h4><a id=\"_CentOS7_31\"></a>- CentOS7</h4>\n<p>配置文件的默认路径在 <mark>/etc/my.cnf</mark>，如果有修改，则根据自己的实际情况找到。</p>\n<h3><a id=\"2__37\"></a>2. 修改配置文件</h3>\n<p>Windows上可以用Ctrl + F 进行搜索，Linux上可以用 ‘/key’ 进行搜索，不会的话可以参考一下百度。</p>\n<p>我们需要找到并修改的东西一共有三个：</p>\n<ol><li> <p>找到 <code>table_definition_cache</code>，我们修改为400</p> <p>官方解释为：可以存储在定义缓存中的表定义数（来自.frm文件）。如果使用大量表，可以创建大型表定义缓存以加快表的打开速度。与普通的表缓存不同，表定义缓存占用更少的空间，并且不使用文件描述符。最小值和默认值均为400。</p> </li><li> <p>找到 <code>table_open_cache</code>，我们修改为256</p> <p>MySQL每打开一个表，都会读入一些数据到table_open_cache缓存中，当MySQL在这个缓存中找不到相应信息时，才会去磁盘上读取。</p> <p>官方解释为：所有线程的打开表数。增加该值会增加mysqld所需的文件描述符的数量。因此，您必须确保在[mysqld safe]部分的变量“open files limit”中将允许打开的文件量设置为至少4096。</p> </li><li> <p>找到 <code>performance_schema</code> ，修改为off</p> <p>如果找不到这个的话，直接在合适的地方加上 <code>performance_schema = off</code> 即可。</p> <p>用于监控MySQL server在一个较低级别的运行过程中的资源消耗、资源等待等情况，关闭之后可以节省开销，不会使server的行为发生变化。</p> </li></ol>\n<p>修改完之后保存退出。</p>\n<h3><a id=\"3_MySQL_63\"></a>3. 重启MySQL</h3>\n<h4><a id=\"_Windows_Service_2016_65\"></a>- Windows Service 2016</h4>\n<p>以管理员身份启动控制台，输入 net stop mysql，然后再输入 net start mysql。</p>\n<p>重启之后还占62M。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\0c4ff3f9c6e44a8fb2cd04e1b0a7df37.png\"/></p>\n<h4><a id=\"_CentOS7_74\"></a>- CentOS7</h4>\n<p>控制台输入 service mysqld restart 即可重启。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d6d63d3b8929428c94e09fae8d63d38d.png\"/></p>\n<p>如果不行的话，可以试试 <code>/etc/init.d/mysqld restart</code> 这个指令。</p>\n<p>重启之后占用92M，比Windows那台多点。</p>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\976d5e2b9afb4445b6797af3228025b4.png\"/></p>\n<h2><a id=\"_87\"></a>后记</h2>\n<p>通过这种方法确实可以降低mysql的内存占用，但我这只是通过降低性能来换取内存罢了，如果对吞吐量要求比较高的情况，那肯定是不能这样直接修改的，得根据实际请求进行调整才行。</p>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "SQL", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 1, "sql": 1, "php": 0, "time": "2022-07-27 19:42:29", "summary": "文章目录前言解决方案找到配置文件修改配置文件重启后记前言对于部分小资玩家来说，服务器数量和内存往往是很有限的，像我个人的服务器配置就是核。内存对于玩家来说，真的不大，开几个中间件自己的微服务真的还蛮挤"}