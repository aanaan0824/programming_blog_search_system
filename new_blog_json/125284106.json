{"blogid": "125284106", "writerAge": "码龄6年", "writerBlogNum": "377", "writerCollect": "5137", "writerComment": "576", "writerFan": "7902", "writerGrade": "7级", "writerIntegral": "9342", "writerName": "安替-AnTi", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_125284106.jpg", "writerRankTotal": "1479", "writerRankWeekly": "1059", "writerThumb": "977", "writerVisitNum": "841775", "blog_read_count": "638", "blog_time": "已于 2022-06-14 20:51:41 修改", "blog_title": "C#实现程序的版本在线升级更新", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><ul><li><ul><li><ul><li><a href=\"#_1\">背景</a></li><li><a href=\"#_3\">代码</a></li><li><a href=\"#_335\">下载地址</a></li><li><a href=\"#_338\">设置到的知识点</a></li><li><a href=\"#_380\">参考文献</a></li></ul>\n</li></ul>\n</li></ul>\n</li></ul>\n</div>\n<p></p>\n<h4><a id=\"_1\"></a>背景</h4>\n<p>最近在做开发的时候，需要程序有自动版本升级的功能。特此记录下整个过程。</p>\n<h4><a id=\"_3\"></a>代码</h4>\n<p>注意事项：</p>\n<ul><li>服务器端需要上传XML配置文件和待下载的软件</li><li>本地AssemblyInfo需要填写版本，和服务器端XML文件的版本号进行比较<br/> 直接上代码</li></ul>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Reflection</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>IO</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>NET</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Xml</span><span class=\"token punctuation\">;</span>  \n  \n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">Update</span>  \n<span class=\"token punctuation\">{<!-- --></span>  \n    <span class=\"token comment\">/// &lt;summary&gt;  </span>\n    <span class=\"token comment\">/// 更新完成触发的事件  </span>\n    <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">delegate</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">UpdateState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token comment\">/// &lt;summary&gt;  </span>\n    <span class=\"token comment\">/// 程序更新  </span>\n    <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SoftUpdate</span>  \n    <span class=\"token punctuation\">{<!-- --></span>  \n  \n        <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> download<span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">const</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> updateUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://www.csdn.Net/update.xml\"</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//升级配置的XML文件地址  </span>\n \n        <span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 构造函数  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">SoftUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 程序更新  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token comment\">/// &lt;param name=\"file\"&gt;要更新的文件&lt;/param&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">SoftUpdate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> file<span class=\"token punctuation\">,</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> softName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>LoadFile <span class=\"token operator\">=</span> file<span class=\"token punctuation\">;</span>  \n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>SoftName <span class=\"token operator\">=</span> softName<span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>   \n        <span class=\"token preprocessor property\">#<span class=\"token directive keyword\">endregion</span>  </span>\n \n        <span class=\"token preprocessor property\">#<span class=\"token directive keyword\">region</span> 属性  </span>\n        <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> loadFile<span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> newVerson<span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> softName<span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">bool</span></span> isUpdate<span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 或取是否需要更新  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> IsUpdate  \n        <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">get</span>   \n            <span class=\"token punctuation\">{<!-- --></span>  \n                <span class=\"token function\">checkUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token keyword\">return</span> isUpdate<span class=\"token punctuation\">;</span>   \n            <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 要检查更新的文件  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> LoadFile  \n        <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">return</span> loadFile<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>  \n            <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{<!-- --></span> loadFile <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 程序集新版本  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> NewVerson  \n        <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">return</span> newVerson<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 升级的名称  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> SoftName  \n        <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">return</span> softName<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>  \n            <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{<!-- --></span> softName <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span>  \n \n        <span class=\"token preprocessor property\">#<span class=\"token directive keyword\">endregion</span>  </span>\n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 更新完成时触发的事件  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">event</span> <span class=\"token class-name\">UpdateState</span> UpdateFinish<span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">isFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>UpdateFinish <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>  \n                <span class=\"token function\">UpdateFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 下载更新  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n        <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">try</span>  \n            <span class=\"token punctuation\">{<!-- --></span>  \n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isUpdate<span class=\"token punctuation\">)</span>  \n                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\">WebClient</span> wc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">WebClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> filename <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> exten <span class=\"token operator\">=</span> download<span class=\"token punctuation\">.</span><span class=\"token function\">Substring</span><span class=\"token punctuation\">(</span>download<span class=\"token punctuation\">.</span><span class=\"token function\">LastIndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>loadFile<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">@\"/\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>  \n                    filename <span class=\"token operator\">=</span> <span class=\"token string\">\"Update_\"</span> <span class=\"token operator\">+</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetFileNameWithoutExtension</span><span class=\"token punctuation\">(</span>loadFile<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> exten<span class=\"token punctuation\">;</span>  \n                <span class=\"token keyword\">else</span>  \n                    filename <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetDirectoryName</span><span class=\"token punctuation\">(</span>loadFile<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"//Update_\"</span> <span class=\"token operator\">+</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetFileNameWithoutExtension</span><span class=\"token punctuation\">(</span>loadFile<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> exten<span class=\"token punctuation\">;</span>  \n                wc<span class=\"token punctuation\">.</span><span class=\"token function\">DownloadFile</span><span class=\"token punctuation\">(</span>download<span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                wc<span class=\"token punctuation\">.</span><span class=\"token function\">Dispose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token function\">isFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n            <span class=\"token keyword\">catch</span>  \n            <span class=\"token punctuation\">{<!-- --></span>  \n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"更新出现错误，网络连接失败！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 检查是否需要更新  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">checkUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>   \n        <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{<!-- --></span>  \n                <span class=\"token class-name\">WebClient</span> wc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">WebClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\">Stream</span> stream <span class=\"token operator\">=</span> wc<span class=\"token punctuation\">.</span><span class=\"token function\">OpenRead</span><span class=\"token punctuation\">(</span>updateUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\">XmlDocument</span> xmlDoc <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">XmlDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                xmlDoc<span class=\"token punctuation\">.</span><span class=\"token function\">Load</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\">XmlNode</span> list <span class=\"token operator\">=</span> xmlDoc<span class=\"token punctuation\">.</span><span class=\"token function\">SelectSingleNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Update\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">XmlNode</span> node <span class=\"token keyword\">in</span> list<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>  \n                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Name <span class=\"token operator\">==</span> <span class=\"token string\">\"Soft\"</span> <span class=\"token operator\">&amp;&amp;</span> node<span class=\"token punctuation\">.</span>Attributes<span class=\"token punctuation\">[</span><span class=\"token string\">\"Name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>Value<span class=\"token punctuation\">.</span><span class=\"token function\">ToLower</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> SoftName<span class=\"token punctuation\">.</span><span class=\"token function\">ToLower</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>  \n                        <span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">XmlNode</span> xml <span class=\"token keyword\">in</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>  \n                            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>xml<span class=\"token punctuation\">.</span>Name <span class=\"token operator\">==</span> <span class=\"token string\">\"Verson\"</span><span class=\"token punctuation\">)</span>  \n                                newVerson <span class=\"token operator\">=</span> xml<span class=\"token punctuation\">.</span>InnerText<span class=\"token punctuation\">;</span>  \n                            <span class=\"token keyword\">else</span>  \n                                download <span class=\"token operator\">=</span> xml<span class=\"token punctuation\">.</span>InnerText<span class=\"token punctuation\">;</span>  \n                        <span class=\"token punctuation\">}</span>  \n                    <span class=\"token punctuation\">}</span>  \n                <span class=\"token punctuation\">}</span>  \n  \n                <span class=\"token class-name\">Version</span> ver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Version</span><span class=\"token punctuation\">(</span>newVerson<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\">Version</span> verson <span class=\"token operator\">=</span> Assembly<span class=\"token punctuation\">.</span><span class=\"token function\">LoadFrom</span><span class=\"token punctuation\">(</span>loadFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>Version<span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> tm <span class=\"token operator\">=</span> verson<span class=\"token punctuation\">.</span><span class=\"token function\">CompareTo</span><span class=\"token punctuation\">(</span>ver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>tm <span class=\"token operator\">&gt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>  \n                    isUpdate <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token keyword\">else</span>  \n                    isUpdate <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n            <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>  \n                              <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"更新出现错误，请确认网络连接无误后重试！\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token comment\">/// &lt;summary&gt;  </span>\n        <span class=\"token comment\">/// 获取要更新的文件  </span>\n        <span class=\"token comment\">/// &lt;/summary&gt;  </span>\n        <span class=\"token comment\">/// &lt;returns&gt;&lt;/returns&gt;  </span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">override</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> <span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n        <span class=\"token punctuation\">{<!-- --></span>  \n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>loadFile<span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>下面是更新的XML文件类容，传到服务器上就可以了，得到XML文件的地址。</p>\n<pre><code class=\"prism language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?&gt;</span>   \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Update</span><span class=\"token punctuation\">&gt;</span></span>  \n   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Soft</span> <span class=\"token attr-name\">Name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>BlogWriter<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>  \n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Verson</span><span class=\"token punctuation\">&gt;</span></span>1.0.1.2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Verson</span><span class=\"token punctuation\">&gt;</span></span>   \n     <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>DownLoad</span><span class=\"token punctuation\">&gt;</span></span>http://www.csdn.net/BlogWrite.rar<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>DownLoad</span><span class=\"token punctuation\">&gt;</span></span>   \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Soft</span><span class=\"token punctuation\">&gt;</span></span>  \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Update</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<p>程序更新调用方法如下</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>ComponentModel</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Data</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Drawing</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>IO</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Threading</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Xml</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Update</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">UpdateTest</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">partial</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Form1</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Form</span></span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">Form1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">InitializeComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">checkUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">checkUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\">SoftUpdate</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SoftUpdate</span><span class=\"token punctuation\">(</span>Application<span class=\"token punctuation\">.</span>ExecutablePath<span class=\"token punctuation\">,</span> <span class=\"token string\">\"BlogWriter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            app<span class=\"token punctuation\">.</span>UpdateFinish <span class=\"token operator\">+=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">UpdateState</span><span class=\"token punctuation\">(</span>app_UpdateFinish<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">try</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>IsUpdate <span class=\"token operator\">&amp;&amp;</span> MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"检查到新版本，是否更新？\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Update\"</span><span class=\"token punctuation\">,</span> MessageBoxButtons<span class=\"token punctuation\">.</span>YesNo<span class=\"token punctuation\">,</span> MessageBoxIcon<span class=\"token punctuation\">.</span>Question<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> DialogResult<span class=\"token punctuation\">.</span>Yes<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n\n                    <span class=\"token class-name\">Thread</span> update <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Thread</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ThreadStart</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">.</span>Update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    update<span class=\"token punctuation\">.</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> ex<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">.</span>Message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">app_UpdateFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"更新完成，请重新启动程序！\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Update\"</span><span class=\"token punctuation\">,</span> MessageBoxButtons<span class=\"token punctuation\">.</span>OK<span class=\"token punctuation\">,</span> MessageBoxIcon<span class=\"token punctuation\">.</span>Information<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>如果需要异步下载并且显示下载进度信息，可以按照如下函数进行修改</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>ComponentModel</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Data</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Drawing</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>IO</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Linq</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Net</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Threading<span class=\"token punctuation\">.</span>Tasks</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">Wolfy<span class=\"token punctuation\">.</span>DownLoad</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">partial</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MainFrm</span> <span class=\"token punctuation\">:</span> <span class=\"token type-list\"><span class=\"token class-name\">Form</span></span>\n    <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">private</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> _saveDir<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">public</span> <span class=\"token function\">MainFrm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token function\">InitializeComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            _saveDir <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">Combine</span><span class=\"token punctuation\">(</span>AppDomain<span class=\"token punctuation\">.</span>CurrentDomain<span class=\"token punctuation\">.</span>BaseDirectory<span class=\"token punctuation\">,</span> <span class=\"token string\">\"download\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">MainFrm_Load</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>Directory<span class=\"token punctuation\">.</span><span class=\"token function\">Exists</span><span class=\"token punctuation\">(</span>_saveDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                Directory<span class=\"token punctuation\">.</span><span class=\"token function\">CreateDirectory</span><span class=\"token punctuation\">(</span>_saveDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">private</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">btnDownLoad_Click</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">EventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> imageUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"http://image.3761.com/nvxing/2016022921/2016022921382152113.jpg\"</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> fileExt <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetExtension</span><span class=\"token punctuation\">(</span>imageUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> fileNewName <span class=\"token operator\">=</span> Guid<span class=\"token punctuation\">.</span><span class=\"token function\">NewGuid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> fileExt<span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\"><span class=\"token keyword\">bool</span></span> isDownLoad <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> filePath <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">Combine</span><span class=\"token punctuation\">(</span>_saveDir<span class=\"token punctuation\">,</span> fileNewName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>File<span class=\"token punctuation\">.</span><span class=\"token function\">Exists</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                isDownLoad <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> file <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">FileMessage</span>\n               <span class=\"token punctuation\">{<!-- --></span>\n                   FileName <span class=\"token operator\">=</span> fileNewName<span class=\"token punctuation\">,</span>\n                   RelativeUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"nvxing/2016022921/2016022921382152113.jpg\"</span><span class=\"token punctuation\">,</span>\n                   Url <span class=\"token operator\">=</span> imageUrl<span class=\"token punctuation\">,</span>\n                   IsDownLoad <span class=\"token operator\">=</span> isDownLoad<span class=\"token punctuation\">,</span>\n                   SavePath <span class=\"token operator\">=</span> filePath\n               <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span>IsDownLoad<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n\n                <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> fileDirPath <span class=\"token operator\">=</span> Path<span class=\"token punctuation\">.</span><span class=\"token function\">GetDirectoryName</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>SavePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>Directory<span class=\"token punctuation\">.</span><span class=\"token function\">Exists</span><span class=\"token punctuation\">(</span>fileDirPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    Directory<span class=\"token punctuation\">.</span><span class=\"token function\">CreateDirectory</span><span class=\"token punctuation\">(</span>fileDirPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">try</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token class-name\">WebClient</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">WebClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    client<span class=\"token punctuation\">.</span>DownloadFileCompleted <span class=\"token operator\">+=</span> client_DownloadFileCompleted<span class=\"token punctuation\">;</span>\n                    client<span class=\"token punctuation\">.</span>DownloadProgressChanged <span class=\"token operator\">+=</span> client_DownloadProgressChanged<span class=\"token punctuation\">;</span>\n                    client<span class=\"token punctuation\">.</span><span class=\"token function\">DownloadFileAsync</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">Uri</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>Url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">.</span>SavePath<span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">.</span>FileName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">catch</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n\n                <span class=\"token punctuation\">}</span>\n\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">client_DownloadFileCompleted</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AsyncCompletedEventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>UserState <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lblMessage<span class=\"token punctuation\">.</span>Text <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>UserState<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\",下载完成\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">client_DownloadProgressChanged</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">object</span></span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">DownloadProgressChangedEventArgs</span> e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>proBarDownLoad<span class=\"token punctuation\">.</span>Minimum <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>proBarDownLoad<span class=\"token punctuation\">.</span>Maximum <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>e<span class=\"token punctuation\">.</span>TotalBytesToReceive<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>proBarDownLoad<span class=\"token punctuation\">.</span>Value <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>e<span class=\"token punctuation\">.</span>BytesReceived<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lblPercent<span class=\"token punctuation\">.</span>Text <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>ProgressPercentage <span class=\"token operator\">+</span> <span class=\"token string\">\"%\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>在这过程中还参考了别人的代码过程，以及B站课程<br/> 下载地址：https://gakkiwife.lanzoub.com/ix8rN06eqtde</p>\n<h4><a id=\"_335\"></a>下载地址</h4>\n<p>c#的整体代码可以通过链接进行下载：<br/> https://gakkiwife.lanzoub.com/iEc8u06eyfni</p>\n<h4><a id=\"_338\"></a>设置到的知识点</h4>\n<ul><li>更新触发事件代码</li></ul>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">delegate</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">UpdateState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/// &lt;summary&gt;  </span>\n<span class=\"token comment\">/// 更新完成时触发的事件  </span>\n<span class=\"token comment\">/// &lt;/summary&gt;  </span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">event</span> <span class=\"token class-name\">UpdateState</span> UpdateFinish<span class=\"token punctuation\">;</span>\n<span class=\"token preprocessor property\">#调用触发事件</span>\napp<span class=\"token punctuation\">.</span>UpdateFinish <span class=\"token operator\">+=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">UpdateState</span><span class=\"token punctuation\">(</span>app_UpdateFinish<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">app_UpdateFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n       <span class=\"token punctuation\">{<!-- --></span>\n           MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"下载完成，请点击进行安装！\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Update\"</span><span class=\"token punctuation\">,</span> MessageBoxButtons<span class=\"token punctuation\">.</span>OK<span class=\"token punctuation\">,</span>MessageBoxIcon<span class=\"token punctuation\">.</span>Information<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token punctuation\">}</span>\n</code></pre>\n<ul><li>set、get默认设置</li></ul>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token function\">SoftUpdate</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> file<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> softName<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>LoadFile <span class=\"token operator\">=</span> file<span class=\"token punctuation\">;</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>SoftName <span class=\"token operator\">=</span> softName<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">/// &lt;summary&gt;  </span>\n<span class=\"token comment\">/// 要检查更新的文件  </span>\n<span class=\"token comment\">/// &lt;/summary&gt;  </span>\n<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> LoadFile\n<span class=\"token punctuation\">{<!-- --></span>\n   <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">return</span> loadFile<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{<!-- --></span> loadFile <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">/// &lt;summary&gt;  </span>\n<span class=\"token comment\">/// 升级的名称  </span>\n<span class=\"token comment\">/// &lt;/summary&gt;  </span>\n<span class=\"token keyword\">public</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">string</span></span> SoftName\n<span class=\"token punctuation\">{<!-- --></span>\n   <span class=\"token keyword\">get</span> <span class=\"token punctuation\">{<!-- --></span> <span class=\"token keyword\">return</span> softName<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">set</span> <span class=\"token punctuation\">{<!-- --></span> softName <span class=\"token operator\">=</span> <span class=\"token keyword\">value</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h4><a id=\"_380\"></a>参考文献</h4>\n<ul><li>https://www.cnblogs.com/shadowme/p/6250089.html</li><li>https://www.cnblogs.com/wolf-sun/p/6699733.html</li></ul>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "C#", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-06-14 20:51:41", "summary": "文章目录背景代码下载地址设置到的知识点参考文献背景最近在做开发的时候，需要程序有自动版本升级的功能。特此记录下整个过程。代码注意事项：服务器端需要上传配置文件和待下载的软件本地需要填写版本，和服务器端"}