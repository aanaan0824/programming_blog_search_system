{"blogid": "123149041", "writerAge": "码龄8年", "writerBlogNum": "67", "writerCollect": "65", "writerComment": "37", "writerFan": "10", "writerGrade": "5级", "writerIntegral": "1936", "writerName": "繁华pk落幕", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123149041.jpg", "writerRankTotal": "22099", "writerRankWeekly": "49041", "writerThumb": "24", "writerVisitNum": "250552", "blog_read_count": "2773", "blog_time": "已于 2022-02-26 14:22:28 修改", "blog_title": "使用php,根据输入的文字自动生成图片,并把文字在图片上展示出来", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p><strong>背景:</strong></p>\n<p>为了减少服务器内图片的数量,采用了同事介绍的这种图片展示方式,用着还不错</p>\n<p><img alt=\"\" height=\"505\" src=\"..\\..\\static\\image\\b9b023d480404b5685da24b62fdfc086.png\" width=\"800\"/></p>\n<p><strong>需要准备的东西:</strong></p>\n<p>字体库(.ttf的文件)存放在font文件夹下</p>\n<p>样式图片(.jpg是背景图规格大小是800*500,.png是用于放输出文字的地方600*400)存放在image文件夹下</p>\n<p>php版本(5.6X左右就好,不建议到7.X因为之前用过7.3的版本出问题了),并且php开启gd库.</p>\n<p><img alt=\"\" height=\"440\" src=\"..\\..\\static\\image\\c8e72c2432584e2a99825bc6cde48b1b.png\" width=\"863\"/></p>\n<p></p>\n<p>代码很简单,就一个文件就好 url.php(这个文件是要与伪静态中的配置对应起来)</p>\n<pre><code class=\"language-php\">&lt;?php\n$numrand=rand(1,2);\n\n$bgimg ='./image/'.$numrand.'.jpg';\n$bg_info = getimagesize($bgimg);\n//获取图片的后缀\n$bg_type = image_type_to_extension($bg_info[2], false);\n//拼接图片资源句柄函数\n$func = 'imagecreatefrom' . $bg_type;\n//创建图片资源句柄\n$bg_image = $func($bgimg);\n//图1处理\n$numrand2=rand(1,2);\n$tu1 ='./image/'.$numrand2.'.png';\n$tu1_info = getimagesize($tu1);\n$tu1_type = image_type_to_extension($tu1_info[2], false);\n//创建图片资源句柄\n$tu1_func = 'imagecreatefrom' . $tu1_type;\n$tu1_image = $tu1_func($tu1);\n//合并背景图+图1\nimagecopy($bg_image, $tu1_image, 100, 50, 0, 0, 600, 400);  //图1 200距左边距 50距顶边距 301 299图1大小  背景图 0 0\n//图2处理  二维码\n$tu2 = './image/'.$numrand2.'.png';\n$tu2_mark = getimagesize($tu2);\n$tu2_type = image_type_to_extension($tu2_mark[2], false);\n//创建图片资源句柄\n$tu2_func = 'imagecreatefrom' . $tu2_type;\n$tu2_image = $tu2_func($tu2);\n//合并背景图+二维码\nimagecopy($bg_image, $tu2_image, 583, 1193, 0, 0, 258, 261);\n//文字\n$get=$_GET['title'];\n\n$len = mb_strlen($get,'utf-8');\n\n$gettxtone=mb_substr($get,0,12,'utf-8');\n$gettxttwo=mb_substr($get,12,13,'utf-8');\n$gettxtsan=mb_substr($get,25,13,'utf-8');\n\n$text1 = preg_split('/(?&lt;!^)(?!$)/u', $gettxtone);\n$text2 = preg_split('/(?&lt;!^)(?!$)/u', $gettxttwo);\n$text3 = preg_split('/(?&lt;!^)(?!$)/u', $gettxtsan);\n\n//水印开关\n$waterturn=1; //1是水印开，否则是关\nif($waterturn==1){\n//添加水印\n$waterfont=\"捷安智能\";\n$waterfont = preg_split('/(?&lt;!^)(?!$)/u', $waterfont);\n//水印的x轴\n$waterx=620;\n//水印的y轴\n$watery=480;\n//水印结束\n}\n\n$color = imagecolorallocate($bg_image, 255,255,255);//字体颜色\n//随机字体\n$fontrand=rand(1,8);\n$font = \"./font/\".$fontrand.\".ttf\"; //字体文件\n$font_lposition = [110, 60]; //距左边距\n$font_tposition = [220, 120]; //距上边距\n$height=500;\n$width=800;\n$height =$height +  $h*$size;\n\n//这里根据是否有第三行文字,设置第一行的高度\n$num_size = 2;\nif(count($text3) &gt; 1){\n$num_size = 3;\n}\n\n\n$size = 30;//字体大小\n$x=130;//第一行定位\n$y=($height-imagefontheight($size))/$num_size;\n $x2=110;//第二行定位\n $y2=$y+60;\n\n $x3=110;//第二行定位\n $y3=$y2+60;\n\n  foreach ($text1 as $k =&gt; $v) {\n            #imagettftext(参数A:背景图路径,参数B:字体大小,参数C:文字角度0标识从左到右读的文本,参数D:首个文字在背景图上的横坐标,参数E:首个文字在背景图上的纵坐标,参数F:文字的颜色值,参数G:字体库路径,参数H:需要写在图上的文字,)\n\t\t\timagettftext($bg_image, $size, 0, $x, $y, $color, $font, $v);//在背景图上循环添加文字\n            $x = $x + 45;//增加横坐标来做到间距的效果，没有这个参数打印出来的字会重叠在一起！\n } \n   foreach ($text2 as $k =&gt; $v) {\n\t         \n            #imagettftext(参数A:背景图路径,参数B:字体大小,参数C:文字角度0标识从左到右读的文本,参数D:首个文字在背景图上的横坐标,参数E:首个文字在背景图上的纵坐标,参数F:文字的颜色值,参数G:字体库路径,参数H:需要写在图上的文字,)\n\t\t\timagettftext($bg_image, $size, 0, $x2, $y2, $color, $font, $v);//在背景图上循环添加文字\n            $x2 = $x2+ 45;//增加横坐标来做到间距的效果，没有这个参数打印出来的字会重叠在一起！\n } \n foreach ($text3 as $k =&gt; $v) {\n\t         \n            #imagettftext(参数A:背景图路径,参数B:字体大小,参数C:文字角度0标识从左到右读的文本,参数D:首个文字在背景图上的横坐标,参数E:首个文字在背景图上的纵坐标,参数F:文字的颜色值,参数G:字体库路径,参数H:需要写在图上的文字,)\n\t\t\timagettftext($bg_image, $size, 0, $x3, $y3, $color, $font, $v);//在背景图上循环添加文字\n            $x3 = $x3+ 45;//增加横坐标来做到间距的效果，没有这个参数打印出来的字会重叠在一起！\n } \n //判断是否存在水印\nif($waterfont){\nforeach ($waterfont as $k =&gt; $v) {        \n            #imagettftext(参数A:背景图路径,参数B:字体大小,参数C:文字角度0标识从左到右读的文本,参数D:首个文字在背景图上的横坐标,参数E:首个文字在背景图上的纵坐标,参数F:文字的颜色值,参数G:字体库路径,参数H:需要写在图上的文字,)\n\t\t\timagettftext($bg_image, $size, 0, $waterx, $watery, $color, $font, $v);//在背景图上循环添加文字\n            $waterx =$waterx+ 45;//增加横坐标来做到间距的效果，没有这个参数打印出来的字会重叠在一起！\n } \n}\n//保存图片\n header(\"Content-type:image/png\");\n imagepng($bg_image);\n imagedestroy($bg_image);\n//销毁内存\nimagedestroy($bg_image);\nimagedestroy($tu1_image);\nimagedestroy($tu2_image);\n//开启缓存\nsession_start(); \nheader(\"Cache-Control: private, max-age=10800, pre-check=10800\");\nheader(\"Pragma: private\");\nheader(\"Expires: \" . date(DATE_RFC822,strtotime(\" 2 day\")));\n?&gt;</code></pre>\n<p>伪静态配置:</p>\n<pre><code>\napache的伪静态\n\nRewriteRule  ^(aiimage)/(.*).png$  $1/url.php?title=$2\n\nngnix的伪静态\n\nlocation /aiimage {\n  rewrite ^/(aiimage)/(.*).png$ /$1/url.php?title=$2;\n}\n或者：\nrewrite ^/(aiimage)/(.*).png$ /$1/url.php?title=$2;</code></pre>\n<p>我的是apache的 .htaccess文件</p>\n<pre><code>&lt;IfModule mod_rewrite.c&gt;\n  Options +FollowSymlinks\n  RewriteEngine On\n  \n  RewriteCond %{REQUEST_FILENAME} !-d\n  RewriteCond %{REQUEST_FILENAME} !-f\n  \n  RewriteRule  ^(.*).png$  /url.php?title=$1\n&lt;/IfModule&gt;</code></pre>\n<p></p>\n<p>示例代码:_根据上面来的基本上可以不用下载.如果看不明白的可以下载参考一下</p>\n<p><a class=\"has-card\" href=\"https://download.csdn.net/download/u014401637/82455611\" title=\"https://download.csdn.net/download/u014401637/82455611\"><span class=\"link-card-box\"><span class=\"link-title\">https://download.csdn.net/download/u014401637/82455611</span><span class=\"link-link\"><img alt=\"\" class=\"link-link-icon\" src=\"..\\..\\static\\image\\icon-default.png\"/>https://download.csdn.net/download/u014401637/82455611</span></span></a></p>\n<p>示例网址:最下方的图片就是这样生成的</p>\n<p><a class=\"has-card\" href=\"http://www.mybancai.cn/problem/759.html\" title=\"非直角剪力墙加固-木模支设加固与新型墙体加固件加固对比-墙体加固件生产厂家\"><span class=\"link-card-box\"><span class=\"link-title\">非直角剪力墙加固-木模支设加固与新型墙体加固件加固对比-墙体加固件生产厂家</span><span class=\"link-desc\">剪力墙结构是民用建筑中较常见的结构形式,当采用木模支设时,墙体拐角处的加固是比较困难的,特别是非直角拐角,如45°,120°,135°等,处理不好,浇筑混凝土时极易发生位移、胀模和漏浆等质量缺陷。下面捷安智能分别举例使用传统木方加钢管的方式以及捷安智能新型剪力墙加固件的方式进行加固传统木方加钢管一、制作(以1</span><span class=\"link-link\"><img alt=\"\" class=\"link-link-icon\" src=\"..\\..\\static\\image\\icon-default.png\"/>http://www.mybancai.cn/problem/759.html</span></span></a></p>\n<p> =======================分割线========================</p>\n<p>还有就是结合之前的一篇文章就可以在pbootcms中根据文章标题自动生成图片</p>\n<p><a class=\"has-card\" href=\"https://blog.csdn.net/u014401637/article/details/122164903\" title=\"pbootcms自定义标签开发_替换标题中的特殊符号_u014401637的博客-CSDN博客\"><span class=\"link-card-box\"><span class=\"link-title\">pbootcms自定义标签开发_替换标题中的特殊符号_u014401637的博客-CSDN博客</span><span class=\"link-desc\">如题:最新在使用pbootcms进行建站,现有的标签不符合自己的一些业务需求,想着自己做个符合自己的业务的标签,于是参考了一下网上的资料以后便开始着手开发了,整个二开还是比较简单,下面放出来需要修改的文件.前端使用标签的地方我的需求其实是在news.html也就是新闻中文章末尾添加一个自定义图片(根据标题生成一张图片,因为生成图片的方法不能包含特殊符号所以需要把标题中的特殊符号尤其是?去掉)&lt;!-- 新增图片_dcx--&gt;&lt;p style=\"text-align: ce</span><span class=\"link-link\"><img alt=\"\" class=\"link-link-icon\" src=\"https://g.csdnimg.cn/static/logo/favicon32.ico\"/>https://blog.csdn.net/u014401637/article/details/122164903</span></span></a></p>\n<p></p>\n</div>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-02-26 14:22:28", "summary": "背景为了减少服务器内图片的数量采用了同事介绍的这种图片展示方式用着还不错需要准备的东西字体库的文件存放在文件夹下样式图片是背景图规格大小是是用于放输出文字的地方存放在文件夹下版本左右就好不建议到因为之"}