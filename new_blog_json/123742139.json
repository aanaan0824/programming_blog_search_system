{"blogid": "123742139", "writerAge": "码龄8年", "writerBlogNum": "2", "writerCollect": "1", "writerComment": "5", "writerFan": "0", "writerGrade": "1级", "writerIntegral": "25", "writerName": "杰克文", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_123742139.jpg", "writerRankTotal": "220839", "writerRankWeekly": "1156509", "writerThumb": "1", "writerVisitNum": "5633", "blog_read_count": "4228", "blog_time": "已于 2022-03-25 19:22:40 修改", "blog_title": "简单两步解决nginx+php 的高并发502问题（nginx限流，定时重启php-fpm）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p>两个步骤解决502问题。</p>\n<p>第一步：nginx设置</p>\n<p>在nginx的http中添加</p>\n<pre><code>limit_conn_zone $binary_remote_addr zone=one:10m;\nlimit_req_zone $binary_remote_addr zone=two:10m rate=10r/s; </code></pre>\n<p>在nginx的server中添加（每个server都要）</p>\n<pre><code>limit_conn one 3; \nlimit_req zone=two burst=10;</code></pre>\n<p>第二步：定时重启nginx和php-fpm</p>\n<p>在/sbin/文件夹下建立一个【cq】的命令</p>\n<p>vi /sbin/cq</p>\n<pre><code>/etc/init.d/nginx reload\n/etc/init.d/php-fpm reload</code></pre>\n<p>添加执行权限</p>\n<p>chmod +x /sbin/*</p>\n<p>设置定时20秒平滑重启nginx+php</p>\n<p>crontab -e</p>\n<pre><code>* * * * * /sbin/cq\n* * * * * sleep 20;/sbin/cq\n* * * * * sleep 40;/sbin/cq</code></pre>\n<p></p>\n<p>至此，所有操作完毕，是不是非常简单。</p>\n<p>如有不明可以给我留言。</p>\n<p></p>\n</div>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 1, "time": "2022-03-25 19:22:40", "summary": "两个步骤解决问题。第一步：设置在的中添加在的中添加每个都要第二步：定时重启和在文件夹下建立一个的命令添加执行权限设置定时秒平滑重启至此，所有操作完毕，是不是非常简单。如有不明可以给我留言。"}