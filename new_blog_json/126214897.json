{"blogid": "126214897", "writerAge": "ç é¾„3å¹´", "writerBlogNum": "118", "writerCollect": "5262", "writerComment": "4588", "writerFan": "30907", "writerGrade": "7çº§", "writerIntegral": "12149", "writerName": "Bug ç»ˆç»“è€…", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126214897.jpg", "writerRankTotal": "867", "writerRankWeekly": "4", "writerThumb": "3973", "writerVisitNum": "250329", "blog_read_count": "6602", "blog_time": "äºÂ 2022-08-08 08:17:13Â å‘å¸ƒ", "blog_title": "ã€äº‘åŸç”Ÿã€‘Spring Cloud Alibaba ä¹‹ Gateway æœåŠ¡ç½‘å…³å®æˆ˜å¼€å‘", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>æ–‡ç« ç›®å½•</h3>\n<ul><li><a href=\"#_2\">âš¡å¼•è¨€</a></li><li><a href=\"#_6\">ä¸€ã€ä»€ä¹ˆæ˜¯ç½‘å…³</a></li><li><ul><li><a href=\"#_10\">â›…ç½‘å…³çš„å®ç°åŸç†</a></li></ul>\n</li><li><a href=\"#Gateway__Zuul__32\">äºŒã€Gateway ä¸ Zuul çš„åŒºåˆ«ï¼Ÿ</a></li><li><a href=\"#Gateway___46\">ä¸‰ã€Gateway æœåŠ¡ç½‘å…³ å¿«é€Ÿå…¥é—¨</a></li><li><ul><li><a href=\"#_48\">â›„éœ€æ±‚</a></li><li><a href=\"#_58\">â³é¡¹ç›®æ­å»º</a></li><li><a href=\"#_144\">âœ…å¯åŠ¨æµ‹è¯•</a></li></ul>\n</li><li><a href=\"#Gateway__192\">å››ã€Gateway æ–­è¨€å·¥å‚</a></li><li><a href=\"#Gateway__222\">äº”ã€Gateway è¿‡æ»¤å™¨</a></li><li><ul><li><a href=\"#_228\">â›½è¿‡æ»¤å™¨å·¥å‚</a></li><li><a href=\"#_305\">â™¨ï¸å…¨å±€è¿‡æ»¤å™¨</a></li></ul>\n</li><li><a href=\"#_434\">å…­ã€æºç åœ°å€</a></li><li><a href=\"#_440\">â›µå°ç»“</a></li></ul>\n</div>\n<p></p>\n<h1><a id=\"_2\"></a>âš¡å¼•è¨€</h1>\n<p><strong>è¯¥é¡¹ç›®åŸºäº <a href=\"https://wanghuichen.blog.csdn.net/article/details/125921637?spm=1001.2014.3001.5502\">ã€äº‘åŸç”Ÿã€‘SpringCloud Alibaba ä¹‹ Nacosæ³¨å†Œä¸­å¿ƒå®æˆ˜</a></strong> ç¼–å†™ï¼Œ<strong>æºç åœ°å€è§æ–‡æœ«</strong></p>\n<h1><a id=\"_6\"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ç½‘å…³</h1>\n<p><strong><code>Spring Cloud Gateway</code></strong> æ˜¯ Spring Cloud çš„ä¸€ä¸ª<strong>å…¨æ–°é¡¹ç›®</strong>ï¼Œè¯¥é¡¹ç›®æ˜¯åŸºäº <strong>Spring 5.0ï¼ŒSpring Boot 2.0 å’Œ Project Reactor</strong> ç­‰å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶æµæŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼Œå®ƒæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§<strong>ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€çš„ API è·¯ç”±ç®¡ç†æ–¹å¼</strong>ã€‚</p>\n<h2><a id=\"_10\"></a>â›…ç½‘å…³çš„å®ç°åŸç†</h2>\n<p>Gateway æœåŠ¡ç½‘å…³æ˜¯æ‰€æœ‰è¯·æ±‚çš„ç»Ÿä¸€å…¥å£ï¼Œæ¯æ¬¡è¯·æ±‚ç”±æœåŠ¡ç½‘å…³æ¥å—å¹¶æ ¹æ®è·¯å¾„æ¡ä»¶è½¬å‘è‡³ä¸åŒçš„å¾®æœåŠ¡ä¸­ã€‚</p>\n<p><strong>ç½‘å…³çš„æ ¸å¿ƒç‰¹æ€§</strong></p>\n<ul><li>è¯·æ±‚è·¯ç”±</li><li>æƒé™æ§åˆ¶</li><li>é™æµ</li></ul>\n<p><strong>æ¶æ„å›¾</strong></p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\e0023ebba1e5404ab94f87df0bdea179.png\"/></p>\n<p><strong>æƒé™æ§åˆ¶</strong>ï¼šç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚</p>\n<p><strong>è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</strong>ï¼šä¸€åˆ‡è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡gatewayï¼Œä½†ç½‘å…³ä¸å¤„ç†ä¸šåŠ¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°æŸä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšè·¯ç”±ã€‚å½“ç„¶è·¯ç”±çš„ç›®æ ‡æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œè¿˜éœ€è¦åšè´Ÿè½½å‡è¡¡ã€‚</p>\n<p><strong>é™æµ</strong>ï¼šå½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚</p>\n<h1><a id=\"Gateway__Zuul__32\"></a>äºŒã€Gateway ä¸ Zuul çš„åŒºåˆ«ï¼Ÿ</h1>\n<blockquote>\n<p><strong>Spring Cloud ä¸­çš„ ç½‘å…³ç±»å‹</strong></p>\n</blockquote>\n<ul><li>Gateway</li><li>Zuul</li></ul>\n<blockquote>\n<p><strong>ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«</strong></p>\n</blockquote>\n<ul><li>Zuul æ˜¯åŸºäº<strong>Servlet</strong> çš„å®ç°ï¼Œå±äº <code>é˜»å¡å¼ç¼–ç¨‹</code></li><li>Spring Cloud Alibaba Gateway æœåŠ¡ç½‘å…³æ˜¯<strong>åŸºäº Spring5.x æä¾›çš„WebFlux</strong>ï¼Œå±äº<code>å“åº”å¼ç¼–ç¨‹</code>çš„å®ç°ï¼Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ã€‚</li></ul>\n<h1><a id=\"Gateway___46\"></a>ä¸‰ã€Gateway æœåŠ¡ç½‘å…³ å¿«é€Ÿå…¥é—¨</h1>\n<h2><a id=\"_48\"></a>â›„éœ€æ±‚</h2>\n<p><strong>åŸºäº Spring Cloud Alibaba Gateway æœåŠ¡ç½‘å…³å®Œæˆ è·¯ç”±è½¬å‘</strong>ï¼Œå…·ä½“è¦æ±‚å¦‚ä¸‹</p>\n<ul><li>å¿…é¡»åŸºäº Gateway æœåŠ¡ç½‘å…³è½¬å‘è·¯ç”±è‡³æŒ‡å®šçš„å¾®æœåŠ¡</li><li>é…ç½®è·¯ç”±çš„è®¿é—®æ—¶é—´ï¼Œ<strong>order-service</strong> æœåŠ¡ è®¿é—®å¿…é¡»åœ¨<strong>2022-07-09ä¹‹å‰</strong></li><li>é…ç½®æœåŠ¡çš„è´Ÿè½½å‡è¡¡ï¼Œé˜²æ­¢å¤§è§„æ¨¡è¯·æ±‚é€ æˆæœåŠ¡æ— æ³•è®¿é—®</li></ul>\n<h2><a id=\"_58\"></a>â³é¡¹ç›®æ­å»º</h2>\n<blockquote>\n<p><strong>æ–°å»º module</strong></p>\n</blockquote>\n<p><strong>å³å‡» <code>nacos-demo</code> æ–°å»º module</strong></p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\b0cd1a11daaf4a4aace50d17d630417d.png\"/></p>\n<p><strong>Next ä¸‹ä¸€æ­¥ï¼Œå‘½åä¸º <code>gateway</code></strong>ï¼Œå•å‡» <strong>Finish</strong>å®Œæˆåˆ›å»º</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\dae827b96cb24eeaa5eeab5cc1aa8121.png\"/></p>\n<blockquote>\n<p><strong>å¼•å…¥ä¾èµ–</strong></p>\n</blockquote>\n<pre><code class=\"prism language-xml\"><span class=\"token comment\">&lt;!--ç½‘å…³--&gt;</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-cloud-starter-gateway<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token comment\">&lt;!--nacosæœåŠ¡å‘ç°ä¾èµ–--&gt;</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token comment\">&lt;!--å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡loadbalancer--&gt;</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>org.springframework.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">&gt;</span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>spring-cloud-starter-loadbalancer<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">&gt;</span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">&gt;</span></span>\n</code></pre>\n<blockquote>\n<p><strong>é…ç½®é¡¹ç›®åŸºæœ¬ä¿¡æ¯</strong></p>\n</blockquote>\n<pre><code class=\"prism language-yaml\"><span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10010</span> <span class=\"token comment\"># ç½‘å…³ç«¯å£</span>\n<span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">application</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> gateway <span class=\"token comment\"># æœåŠ¡åç§°</span>\n  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">nacos</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">server-addr</span><span class=\"token punctuation\">:</span> localhost<span class=\"token punctuation\">:</span><span class=\"token number\">8848</span> <span class=\"token comment\"># nacosåœ°å€</span>\n    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># ç½‘å…³è·¯ç”±é…ç½®</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">-</span>service <span class=\"token comment\"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span>\n          <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span>\n          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userService <span class=\"token comment\"># è·¯ç”±çš„ç›®æ ‡åœ°å€ lbå°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Œåé¢è·ŸæœåŠ¡åç§°</span>\n          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è·¯ç”±æ–­è¨€ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™çš„æ¡ä»¶</span>\n            <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> <span class=\"token comment\"># è¿™ä¸ªæ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œåªè¦ä»¥/user/å¼€å¤´å°±ç¬¦åˆè¦æ±‚</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> order<span class=\"token punctuation\">-</span>service <span class=\"token comment\"># è·¯ç”±idï¼Œè‡ªå®šä¹‰ï¼Œåªè¦å”¯ä¸€å³å¯</span>\n          <span class=\"token comment\"># uri: http://127.0.0.1:8081 # è·¯ç”±çš„ç›®æ ‡åœ°å€ httpå°±æ˜¯å›ºå®šåœ°å€</span>\n          <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//orderService\n          <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> Path=/order/<span class=\"token important\">**</span>\n            <span class=\"token punctuation\">-</span> Before=2022<span class=\"token punctuation\">-</span>07<span class=\"token punctuation\">-</span>09T17<span class=\"token punctuation\">:</span>42<span class=\"token punctuation\">:</span>47.789<span class=\"token punctuation\">-</span>07<span class=\"token punctuation\">:</span>00<span class=\"token punctuation\">[</span>Asia/Shanghai<span class=\"token punctuation\">]</span>\n</code></pre>\n<p>æˆ‘ä»¬å°†ç¬¦åˆ<code>Path</code> è§„åˆ™çš„ä¸€åˆ‡è¯·æ±‚ï¼Œéƒ½ä»£ç†åˆ° <code>uri</code>å‚æ•°æŒ‡å®šçš„åœ°å€ã€‚</p>\n<p>æˆ‘ä»¬å°† <code>/user/**</code>å¼€å¤´çš„è¯·æ±‚ï¼Œä»£ç†åˆ°<code>lb://userService</code>ï¼Œ <code>/order/**</code> å¼€å¤´çš„è¯·æ±‚ï¼Œä»£ç†åˆ° <code>lb://orderService</code> ï¼Œ lbæ˜¯è´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®æœåŠ¡åæ‹‰å–æœåŠ¡åˆ—è¡¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p>\n<p><strong>æ–°å»º Application å¯åŠ¨ç±»</strong></p>\n<pre><code class=\"prism language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>chen</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootApplication</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GatewayApplication</span> <span class=\"token punctuation\">{<!-- --></span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">GatewayApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<h2><a id=\"_144\"></a>âœ…å¯åŠ¨æµ‹è¯•</h2>\n<blockquote>\n<p><strong>ä¾èµ–æœåŠ¡å¯åŠ¨</strong></p>\n</blockquote>\n<p><strong>åœ¨å¯åŠ¨ä¹‹å‰ï¼Œè¯·åŠ¡å¿…å¯åŠ¨ Nacos æœåŠ¡ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½<code>éœ€è¦ä¾èµ–äº NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¥å®ç°</code></strong></p>\n<p><strong>å¯åŠ¨ order-serviceã€user-serviceã€gatewayæœåŠ¡</strong></p>\n<blockquote>\n<p><strong>æµ‹è¯•è®¿é—®</strong></p>\n</blockquote>\n<p><strong>è®¿é—® localhost:10010/user/1</strong>ï¼Œç¬¦åˆ<code>/user/**</code>è§„åˆ™ï¼Œè¯·æ±‚è½¬å‘ uri è‡³ http://userService/user/1ï¼Œå¾—åˆ°ç»“æœ</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\d5a0e53a8f694fd9a1a4882a506631e8.png\"/></p>\n<p><strong>è®¿é—® localhost:10010/order/101</strong>ï¼Œç¬¦åˆ <code>/order/**</code> è§„åˆ™ï¼Œä½†ä¸ç¬¦åˆ <code>Before=2022-07-09T17:42:47.789-07:00[Asia/Shanghai]</code> è§„åˆ™ï¼Œæ‰€ä»¥ï¼Œè½¬å‘uriå¤±è´¥ï¼</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\93261c94932a43078c0151dcd964561c.png\"/></p>\n<p><strong>æµ‹è¯•æˆåŠŸï¼Œè®¿é—®useræœåŠ¡æˆåŠŸè®¿é—®ï¼Œè®¿é—®orderæœåŠ¡ç”±äºå·²è¿‡æœŸé™ï¼Œæ‰€ä»¥æŠ¥404æœªæ‰¾åˆ°ï¼</strong></p>\n<blockquote>\n<p><strong>å°ç»“ GatewayæœåŠ¡ç½‘å…³é¡¹ç›®</strong></p>\n</blockquote>\n<p><strong>ç½‘å…³æ­å»ºæ­¥éª¤ï¼š</strong></p>\n<ol><li> <p>åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥nacosæœåŠ¡å‘ç°å’Œgatewayä¾èµ–</p> </li><li> <p>é…ç½®application.ymlï¼ŒåŒ…æ‹¬æœåŠ¡åŸºæœ¬ä¿¡æ¯ã€nacosåœ°å€ã€è·¯ç”±</p> </li></ol>\n<p><strong>è·¯ç”±é…ç½®åŒ…æ‹¬ï¼š</strong></p>\n<ol><li> <p>è·¯ç”±idï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º</p> </li><li> <p>è·¯ç”±ç›®æ ‡ï¼ˆuriï¼‰ï¼šè·¯ç”±çš„ç›®æ ‡åœ°å€ï¼Œhttpä»£è¡¨å›ºå®šåœ°å€ï¼Œlbä»£è¡¨æ ¹æ®æœåŠ¡åè´Ÿè½½å‡è¡¡</p> </li><li> <p>è·¯ç”±æ–­è¨€ï¼ˆpredicatesï¼‰ï¼šåˆ¤æ–­è·¯ç”±çš„è§„åˆ™ï¼Œ</p> </li><li> <p>è·¯ç”±è¿‡æ»¤å™¨ï¼ˆfiltersï¼‰ï¼šå¯¹è¯·æ±‚æˆ–å“åº”åšå¤„ç†</p> </li></ol>\n<h1><a id=\"Gateway__192\"></a>å››ã€Gateway æ–­è¨€å·¥å‚</h1>\n<p>æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å†™çš„æ–­è¨€è§„åˆ™åªæ˜¯å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä¼šè¢«Predicate Factoryè¯»å–å¹¶å¤„ç†ï¼Œè½¬å˜ä¸ºè·¯ç”±åˆ¤æ–­çš„æ¡ä»¶</p>\n<p>ä¾‹å¦‚Path=/user/**æ˜¯æŒ‰ç…§è·¯å¾„åŒ¹é…ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯ç”±</p>\n<p><code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code>ç±»æ¥</p>\n<p>å¤„ç†çš„ï¼Œåƒè¿™æ ·çš„æ–­è¨€å·¥å‚åœ¨SpringCloudGatewayè¿˜æœ‰åå‡ ä¸ª:</p>\n<table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td>After</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td><td>- After=2037-01-20T17:42:47.789-07:00[America/Denver]</td></tr><tr><td>Before</td><td>æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>- Before=2031-04-13T15:14:47.433+08:00[Asia/Shanghai]</td></tr><tr><td>Between</td><td>æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td>- Between=2037-01-20T17:42:47.789-07:00[America/Denver], 2037-01-21T17:42:47.789-07:00[America/Denver]</td></tr><tr><td>Cookie</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td><td>- Cookie=chocolate, ch.p</td></tr><tr><td>Header</td><td>è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td><td>- Header=X-Request-Id, \\d+</td></tr><tr><td>Host</td><td>è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td><td>- Host=<strong>.somehost.org,</strong>.anotherhost.org</td></tr><tr><td>Method</td><td>è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td><td>- Method=GET,POST</td></tr><tr><td>Path</td><td>è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td><td>- Path=/red/{segment},/blue/**</td></tr><tr><td>Query</td><td>è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td><td>- Query=name, Jackæˆ–è€…- Query=name</td></tr><tr><td>RemoteAddr</td><td>è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td><td>- RemoteAddr=192.168.1.1/24</td></tr><tr><td>Weight</td><td>æƒé‡å¤„ç†</td><td></td></tr></tbody></table>\n<p><strong>ä¾‹å¦‚ï¼Œ<code>Path</code>ã€ Beforeï¼Œåœ¨Gatewayé¡¹ç›®å¿«é€Ÿå…¥é—¨ä¸­å°±ç”¨åˆ°äº†è¯¥æ–­è¨€å·¥å‚</strong></p>\n<p><strong>å…·ä½“çš„è¯¦ç»†é…ç½®å¯çœ‹ <a href=\"https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories\">Spring Cloud Alibaba Gateway å®˜ç½‘</a></strong></p>\n<h1><a id=\"Gateway__222\"></a>äº”ã€Gateway è¿‡æ»¤å™¨</h1>\n<p>GatewayFilteræ˜¯ç½‘å…³ä¸­æä¾›çš„ä¸€ç§è¿‡æ»¤å™¨ï¼Œå¯ä»¥å¯¹è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡è¿”å›çš„å“åº”åšå¤„ç†ï¼š</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\3a7124d2bd394066b38ba2efa030b7b6.png\"/></p>\n<h2><a id=\"_228\"></a>â›½è¿‡æ»¤å™¨å·¥å‚</h2>\n<p><strong>è·¯ç”±å™¨çš„ç§ç±»</strong></p>\n<p>Springæä¾›äº†31ç§ä¸åŒçš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ã€‚ä¾‹å¦‚ï¼š</p>\n<table><thead><tr><th><strong>åç§°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>AddRequestHeader</td><td>ç»™å½“å‰è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´</td></tr><tr><td>RemoveRequestHeader</td><td>ç§»é™¤è¯·æ±‚ä¸­çš„ä¸€ä¸ªè¯·æ±‚å¤´</td></tr><tr><td>AddResponseHeader</td><td>ç»™å“åº”ç»“æœä¸­æ·»åŠ ä¸€ä¸ªå“åº”å¤´</td></tr><tr><td>RemoveResponseHeader</td><td>ä»å“åº”ç»“æœä¸­ç§»é™¤æœ‰ä¸€ä¸ªå“åº”å¤´</td></tr><tr><td>RequestRateLimiter</td><td>é™åˆ¶è¯·æ±‚çš„æµé‡</td></tr></tbody></table>\n<blockquote>\n<p><strong>è¯·æ±‚å¤´è¿‡æ»¤å™¨</strong></p>\n</blockquote>\n<p>ä¸‹é¢æˆ‘ä»¬ä»¥AddRequestHeader ä¸ºä¾‹æ¥è®²è§£ã€‚</p>\n<p><strong>éœ€æ±‚</strong>ï¼šç»™æ‰€æœ‰è¿›å…¥userserviceçš„è¯·æ±‚æ·»åŠ ä¸€ä¸ªè¯·æ±‚å¤´ï¼šTruth= Hello WHC !!!</p>\n<p>åªéœ€ä¿®æ”¹ gateway æœåŠ¡çš„ application.yaml æ–‡ä»¶å³å¯æ·»åŠ è·¯ç”±è¿‡æ»¤å³å¯</p>\n<pre><code class=\"prism language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">-</span>service \n        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userService \n        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> \n        <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span> \n        <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># è¿‡æ»¤å™¨</span>\n        <span class=\"token punctuation\">-</span> AddRequestHeader=Truth<span class=\"token punctuation\">,</span> Hello WHC <span class=\"token tag\">!</span><span class=\"token tag\">!</span><span class=\"token tag\">!</span> <span class=\"token comment\"># æ·»åŠ è¯·æ±‚å¤´</span>\n</code></pre>\n<p><strong>åœ¨userService ä¸‹å†™è¿‡æ»¤å™¨ï¼Œåªå¯¹userServiceæœåŠ¡ç”Ÿæ•ˆï¼Œé‡æ–°å¯åŠ¨å³å¯ç”Ÿæ•ˆ</strong></p>\n<blockquote>\n<p><strong>é»˜è®¤è¿‡æ»¤å™¨</strong></p>\n</blockquote>\n<p>å¦‚æœè¦å¯¹æ‰€æœ‰çš„è·¯ç”±éƒ½ç”Ÿæ•ˆï¼Œåˆ™å¯ä»¥å°†è¿‡æ»¤å™¨å·¥å‚å†™åˆ°defaultä¸‹ã€‚æ ¼å¼å¦‚ä¸‹ï¼š</p>\n<pre><code class=\"prism language-yaml\"><span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">cloud</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">-</span>service \n        <span class=\"token key atrule\">uri</span><span class=\"token punctuation\">:</span> lb<span class=\"token punctuation\">:</span>//userservice \n        <span class=\"token key atrule\">predicates</span><span class=\"token punctuation\">:</span> \n        <span class=\"token punctuation\">-</span> Path=/user/<span class=\"token important\">**</span>\n      <span class=\"token key atrule\">default-filters</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># é»˜è®¤è¿‡æ»¤é¡¹ï¼Œå…¨å±€ç”Ÿæ•ˆ</span>\n      <span class=\"token punctuation\">-</span> AddRequestHeader=Truth<span class=\"token punctuation\">,</span> Hello WHC <span class=\"token tag\">!</span><span class=\"token tag\">!</span><span class=\"token tag\">!</span> <span class=\"token comment\"># æ·»åŠ è¯·æ±‚å¤´ </span>\n</code></pre>\n<p><strong>æ·»åŠ è¯¥é»˜è®¤è¿‡æ»¤å™¨ï¼Œå¯¹æ‰€æœ‰å¾®æœåŠ¡ç”Ÿæ•ˆï¼Œé‡æ–°å¯åŠ¨æœåŠ¡å³å¯ç”Ÿæ•ˆ</strong></p>\n<blockquote>\n<p><strong>è¿‡æ»¤å™¨å°ç»“</strong></p>\n</blockquote>\n<p><strong>è¿‡æ»¤å™¨çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>\n<ol><li>å¯¹è·¯ç”±çš„è¯·æ±‚å’Œå“åº”åšåŠ å·¥å¤„ç†ï¼Œæ¯”å¦‚æ·»åŠ è¯·æ±‚å¤´ï¼Œè¿”å›æŒ‡å®šå“åº”ä¿¡æ¯</li><li>é…ç½®åœ¨è·¯ç”±ä¸‹çš„è¿‡æ»¤å™¨åªå¯¹å½“å‰æœåŠ¡ç”Ÿæ•ˆ</li></ol>\n<p><strong>defaultFiltersçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>\n<ul><li>é…ç½®è¿‡æ»¤å™¨ï¼Œå¹¶å¯¹å…¨å±€æœåŠ¡ç”Ÿæ•ˆ</li></ul>\n<h2><a id=\"_305\"></a>â™¨ï¸å…¨å±€è¿‡æ»¤å™¨</h2>\n<p>ä¸Šä¸€èŠ‚çš„è¿‡æ»¤å™¨ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œè¿™äº›è¿‡æ»¤å™¨éƒ½æ˜¯å›ºå®šçš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ‹¦æˆªè¯·æ±‚ï¼Œåšè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ›´æ˜¯æ— æ³•å®ç°</p>\n<blockquote>\n<p><strong>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨</strong></p>\n</blockquote>\n<p>å…¨å±€è¿‡æ»¤å™¨çš„ä½œç”¨ä¹Ÿæ˜¯å¤„ç†ä¸€åˆ‡è¿›å…¥ç½‘å…³çš„è¯·æ±‚å’Œå¾®æœåŠ¡å“åº”ï¼Œä¸<strong>GatewayFilter</strong>çš„ä½œç”¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äºGatewayFilteré€šè¿‡é…ç½®å®šä¹‰ï¼Œå¤„ç†é€»è¾‘æ˜¯å›ºå®šçš„ï¼›<strong>è€ŒGlobalFilterçš„é€»è¾‘éœ€è¦è‡ªå·±å†™ä»£ç å®ç°ã€‚</strong></p>\n<p><strong>å®ç°æµç¨‹</strong></p>\n<p>å®ç°GlobalFilteræ¥å£</p>\n<pre><code class=\"prism language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">GlobalFilter</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token comment\">/**\n     *  å¤„ç†å½“å‰è¯·æ±‚ï¼Œæœ‰å¿…è¦çš„è¯é€šè¿‡{@link GatewayFilterChain}å°†è¯·æ±‚äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç†\n     *\n     * @param exchange è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å¯ä»¥è·å–Requestã€Responseç­‰ä¿¡æ¯\n     * @param chain ç”¨æ¥æŠŠè¯·æ±‚å§”æ‰˜ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ \n     * @return {@code Mono&lt;Void&gt;} è¿”å›æ ‡ç¤ºå½“å‰è¿‡æ»¤å™¨ä¸šåŠ¡ç»“æŸ\n     */</span>\n    <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerWebExchange</span> exchange<span class=\"token punctuation\">,</span> <span class=\"token class-name\">GatewayFilterChain</span> chain<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>åœ¨filterä¸­ç¼–å†™è‡ªå®šä¹‰é€»è¾‘ï¼Œå¯ä»¥å®ç°ä¸‹åˆ—åŠŸèƒ½ï¼š</p>\n<ul><li>ç™»å½•çŠ¶æ€åˆ¤æ–­</li><li>æƒé™æ ¡éªŒ</li><li>è¯·æ±‚é™æµç­‰</li></ul>\n<blockquote>\n<p><strong>è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</strong></p>\n</blockquote>\n<p><strong>éœ€æ±‚</strong>ï¼šå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ‹¦æˆªè¯·æ±‚ï¼Œåˆ¤æ–­è¯·æ±‚çš„å‚æ•°æ˜¯å¦æ»¡è¶³ä¸‹é¢æ¡ä»¶ï¼š</p>\n<ul><li> <p>å‚æ•°ä¸­æ˜¯å¦æœ‰authorizationï¼Œ</p> </li><li> <p>authorizationå‚æ•°å€¼æ˜¯å¦ä¸ºadmin</p> </li></ul>\n<p>å¦‚æœåŒæ—¶æ»¡è¶³åˆ™æ”¾è¡Œï¼Œå¦åˆ™æ‹¦æˆª</p>\n<p><strong>æ ¸å¿ƒä»£ç </strong></p>\n<pre><code class=\"prism language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>chen<span class=\"token punctuation\">.</span>gateway</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>gateway<span class=\"token punctuation\">.</span>filter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GatewayFilterChain</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span>gateway<span class=\"token punctuation\">.</span>filter<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">GlobalFilter</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Ordered</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>annotation<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Order</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>http<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span>reactive<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerHttpRequest</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>stereotype<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Component</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">MultiValueMap</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServerWebExchange</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">reactor<span class=\"token punctuation\">.</span>core<span class=\"token punctuation\">.</span>publisher<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Mono</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * è®¤è¯è¿‡æ»¤å™¨ç±»\n * éœ€è¦é€šè¿‡æ³¨è§£æˆ–æ¥å£çš„å½¢å¼å»ç®¡ç†è¿‡æ»¤å™¨çš„é¡ºåºï¼Œå› ä¸ºä¸€ä¸ªé¡¹ç›®ä¸­å¯èƒ½æœ‰å¤šä¸ªè¿‡æ»¤å™¨\n */</span>\n<span class=\"token comment\">//@Order(-1)</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AuthorizeFilter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">GlobalFilter</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Ordered</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Void</span><span class=\"token punctuation\">&gt;</span></span> <span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServerWebExchange</span> exchange<span class=\"token punctuation\">,</span> <span class=\"token class-name\">GatewayFilterChain</span> chain<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token comment\">// ç½‘å…³åŸºäº WebFlux å“åº”å¼ç¼–ç¨‹ç¼–å†™ï¼Œapiå¯èƒ½æœ‰äº›ä¸ä¸€æ ·</span>\n\n        <span class=\"token comment\">// 1. è·å–è¯·æ±‚å‚æ•°</span>\n        <span class=\"token class-name\">ServerHttpRequest</span> request <span class=\"token operator\">=</span> exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 2. è·å–å‚æ•°ä¸­çš„authorization å‚æ•°</span>\n        <span class=\"token class-name\">MultiValueMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">&gt;</span></span> params <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 3ï¼Œ åˆ¤æ–­å‚æ•°å€¼æ˜¯å¦ç­‰äº admin</span>\n        <span class=\"token class-name\">String</span> auth <span class=\"token operator\">=</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">getFirst</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authorization\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// 4. å¦‚æœç›¸ç­‰ï¼Œæ”¾è¡Œ</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>auth<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token keyword\">return</span> chain<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>exchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// è®¾ç½®å“åº”ç ï¼Œæœªç™»å½•</span>\n        exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span>UNAUTHORIZED<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// 5ï¼Œå¦‚æœä¸ç­‰ï¼Œåˆ™æ‹¦æˆª</span>\n        <span class=\"token keyword\">return</span> exchange<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setComplete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n<blockquote>\n<p><strong>è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåº</strong></p>\n</blockquote>\n<p>è¯·æ±‚è¿›å…¥ç½‘å…³ä¼šç¢°åˆ°ä¸‰ç±»è¿‡æ»¤å™¨ï¼šå½“å‰è·¯ç”±çš„è¿‡æ»¤å™¨ã€DefaultFilterã€GlobalFilter</p>\n<p>è¯·æ±‚è·¯ç”±åï¼Œä¼šå°†å½“å‰è·¯ç”±è¿‡æ»¤å™¨å’ŒDefaultFilterã€GlobalFilterï¼Œåˆå¹¶åˆ°ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼ˆé›†åˆï¼‰ä¸­ï¼Œæ’åºåä¾æ¬¡æ‰§è¡Œæ¯ä¸ªè¿‡æ»¤å™¨ï¼š</p>\n<p><img alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\" src=\"..\\..\\static\\image\\b56473d6e4044e01aecd8889762c010a.png\"/></p>\n<p>æ’åºçš„è§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<ul><li>æ¯ä¸€ä¸ªè¿‡æ»¤å™¨éƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªintç±»å‹çš„orderå€¼ï¼Œ<strong>orderå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œé¡ºåºè¶Šé å‰</strong>ã€‚</li><li>GlobalFilteré€šè¿‡å®ç°Orderedæ¥å£ï¼Œæˆ–è€…æ·»åŠ @Orderæ³¨è§£æ¥æŒ‡å®šorderå€¼ï¼Œç”±æˆ‘ä»¬è‡ªå·±æŒ‡å®š</li><li>è·¯ç”±è¿‡æ»¤å™¨å’ŒdefaultFilterçš„orderç”±SpringæŒ‡å®šï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å£°æ˜é¡ºåºä»1é€’å¢ã€‚</li><li>å½“è¿‡æ»¤å™¨çš„orderå€¼ä¸€æ ·æ—¶ï¼Œä¼šæŒ‰ç…§ defaultFilter &gt; è·¯ç”±è¿‡æ»¤å™¨ &gt; GlobalFilterçš„é¡ºåºæ‰§è¡Œã€‚</li></ul>\n<p>è¯¦ç»†å†…å®¹ï¼Œ<strong>å¯ä»¥æŸ¥çœ‹æºç ï¼š</strong></p>\n<p><code>org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator#getFilters()</code>æ–¹æ³•æ˜¯å…ˆåŠ è½½defaultFiltersï¼Œç„¶åå†åŠ è½½æŸä¸ªrouteçš„filtersï¼Œç„¶ååˆå¹¶ã€‚</p>\n<p><code>org.springframework.cloud.gateway.handler.FilteringWebHandler#handle()</code>æ–¹æ³•ä¼šåŠ è½½å…¨å±€è¿‡æ»¤å™¨ï¼Œä¸å‰é¢çš„è¿‡æ»¤å™¨åˆå¹¶åæ ¹æ®orderæ’åºï¼Œç»„ç»‡è¿‡æ»¤å™¨é“¾</p>\n<h1><a id=\"_434\"></a>å…­ã€æºç åœ°å€</h1>\n<p><strong>GitHubå¼€æºåœ°å€ï¼š</strong><a href=\"https://github.com/wanghuichen/nacos-demo\">https://github.com/wanghuichen/nacos-demo</a></p>\n<p><strong>GitEE å¼€æºåœ°å€ï¼š</strong> <a href=\"https://gitee.com/javawhc/nacos-demo\">https://gitee.com/javawhc/nacos-demo</a></p>\n<h1><a id=\"_440\"></a>â›µå°ç»“</h1>\n<p>ä»¥ä¸Šå°±æ˜¯ã€<strong>Bug ç»ˆç»“è€…</strong>ã€‘å¯¹ <strong>ã€äº‘åŸç”Ÿã€‘Spring Cloud Alibaba ä¹‹ Gateway æœåŠ¡ç½‘å…³å®æˆ˜å¼€å‘</strong> çš„ç®€å•ä»‹ç»ï¼Œ<strong>Spring Cloud Alibaba æ˜¯ç›®å‰æ¯”è¾ƒç«çš„å¾®æœåŠ¡ä¸­é—´ä»¶ï¼Œå¾ˆå¼ºå¤§ï¼Œå¿…é¡»åƒé€ï¼</strong>ï¼ŒåŒæ—¶ï¼Œ<strong>Gateway æœåŠ¡ç½‘å…³æ˜¯æ’‘èµ·åˆ†å¸ƒå¼çš„è¯·æ±‚å…¥å£ï¼Œèµ·åˆ°<code>æ‰¿ä¸Šå¯ä¸‹</code>çš„ä½œç”¨</strong>ï¼ŒGateway <strong>ä¹Ÿå¯ä»¥è§£å†³æµé‡å‰Šå³°é—®é¢˜</strong>ï¼Œé˜²æ­¢å¤§è§„æ¨¡è¯·æ±‚ä¸€æ‹¥è€Œä¸Šï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ç­‰é—®é¢˜ï¼Œå¯ä»¥è¯´ï¼Œ<strong>Gatewayæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„æœåŠ¡ç½‘å…³ï¼</strong></p>\n<blockquote>\n<p>å¦‚æœè¿™ç¯‡ã€æ–‡ç« ã€‘æœ‰å¸®åŠ©åˆ°ä½ ï¼Œå¸Œæœ›å¯ä»¥ç»™ã€<strong>Bug ç»ˆç»“è€…</strong>ã€‘ç‚¹ä¸ªèµğŸ‘ï¼Œåˆ›ä½œä¸æ˜“ï¼Œå¦‚æœæœ‰å¯¹ã€<strong>åç«¯æŠ€æœ¯</strong>ã€‘ã€ã€<strong>å‰ç«¯é¢†åŸŸ</strong>ã€‘æ„Ÿå…´è¶£çš„å°å¯çˆ±ï¼Œä¹Ÿæ¬¢è¿å…³æ³¨â¤ï¸â¤ï¸â¤ï¸ ã€<strong>Bug ç»ˆç»“è€…</strong>ã€‘â¤ï¸â¤ï¸â¤ï¸ï¼Œæˆ‘å°†ä¼šç»™ä½ å¸¦æ¥å·¨å¤§çš„ã€æ”¶è·ä¸æƒŠå–œã€‘ğŸ’ğŸ’ğŸ’ï¼</p>\n</blockquote>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Java", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 1, "sql": 0, "php": 0, "time": "2022-08-08 08:17:13", "summary": "æ–‡ç« ç›®å½•å¼•è¨€ä¸€ã€ä»€ä¹ˆæ˜¯ç½‘å…³ç½‘å…³çš„å®ç°åŸç†äºŒã€ä¸çš„åŒºåˆ«ï¼Ÿä¸‰ã€æœåŠ¡ç½‘å…³å¿«é€Ÿå…¥é—¨éœ€æ±‚é¡¹ç›®æ­å»ºå¯åŠ¨æµ‹è¯•å››ã€æ–­è¨€å·¥å‚äº”ã€è¿‡æ»¤å™¨è¿‡æ»¤å™¨å·¥å‚å…¨å±€è¿‡æ»¤å™¨å…­ã€æºç åœ°å€å°ç»“å¼•è¨€è¯¥é¡¹ç›®åŸºäºäº‘åŸç”Ÿä¹‹æ³¨å†Œä¸­å¿ƒå®æˆ˜ç¼–å†™ï¼Œæºç åœ°å€"}