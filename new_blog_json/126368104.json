{"blogid": "126368104", "writerAge": "码龄83天", "writerBlogNum": "61", "writerCollect": "1544", "writerComment": "1930", "writerFan": "2802", "writerGrade": "6级", "writerIntegral": "4836", "writerName": "小余努力搬砖", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126368104.jpg", "writerRankTotal": "3430", "writerRankWeekly": "52", "writerThumb": "1831", "writerVisitNum": "29171", "blog_read_count": "901", "blog_time": "已于 2022-08-22 08:22:25 修改", "blog_title": "【Vue组件间通信】 全局事件总线、订阅与发布", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"htmledit_views\" id=\"content_views\">\n<p id=\"main-toc\"><strong>目录</strong></p>\n<p id=\"%E4%B8%80%E3%80%81%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%B8%80%E3%80%81%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF\">一、全局事件总线</a></p>\n<p id=\"%E4%BD%9C%E7%94%A8-toc\" style=\"margin-left:40px;\"><a href=\"#%E4%BD%9C%E7%94%A8\">作用</a></p>\n<p id=\"%E5%AE%89%E8%A3%85-toc\" style=\"margin-left:40px;\"><a href=\"#%E5%AE%89%E8%A3%85\">安装</a></p>\n<p id=\"%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B\">组件使用案例</a></p>\n<p id=\"%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-toc\" style=\"margin-left:80px;\"><a href=\"#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90\">案例分析</a></p>\n<p id=\"%E7%BB%84%E4%BB%B6%E4%B8%80%EF%BC%88%E5%B0%8F%E6%98%8E%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%E7%BB%84%E4%BB%B6%E4%B8%80%EF%BC%88%E5%B0%8F%E6%98%8E%EF%BC%89\">组件一（小明）</a></p>\n<p id=\"%E7%BB%84%E4%BB%B6%E4%BA%8C%EF%BC%88%E5%B0%8F%E7%BA%A2%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%E7%BB%84%E4%BB%B6%E4%BA%8C%EF%BC%88%E5%B0%8F%E7%BA%A2%EF%BC%89\">组件二（小红）</a></p>\n<p id=\"%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA-toc\" style=\"margin-left:80px;\"><a href=\"#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA\">效果展示</a></p>\n<p id=\"%E4%BA%8C%E3%80%81%E8%AE%A2%E9%98%85%E4%B8%8E%E5%8F%91%E5%B8%83%C2%A0-toc\" style=\"margin-left:0px;\"><a href=\"#%E4%BA%8C%E3%80%81%E8%AE%A2%E9%98%85%E4%B8%8E%E5%8F%91%E5%B8%83%C2%A0\">二、订阅与发布 </a></p>\n<p id=\"%E5%AE%89%E8%A3%85-toc\" style=\"margin-left:40px;\"><a href=\"#%E5%AE%89%E8%A3%85\">安装</a></p>\n<p id=\"%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B-toc\" style=\"margin-left:40px;\"><a href=\"#%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B\">组件使用案例</a></p>\n<p id=\"%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90-toc\" style=\"margin-left:80px;\"><a href=\"#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90\">案例分析</a></p>\n<p id=\"%E7%BB%84%E4%BB%B6%E4%B8%80%EF%BC%88%E5%B0%8F%E6%98%8E%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%E7%BB%84%E4%BB%B6%E4%B8%80%EF%BC%88%E5%B0%8F%E6%98%8E%EF%BC%89\">组件一（小明）</a></p>\n<p id=\"%E7%BB%84%E4%BB%B6%E4%BA%8C%EF%BC%88%E5%B0%8F%E7%BA%A2%EF%BC%89-toc\" style=\"margin-left:80px;\"><a href=\"#%E7%BB%84%E4%BB%B6%E4%BA%8C%EF%BC%88%E5%B0%8F%E7%BA%A2%EF%BC%89\">组件二（小红）</a></p>\n<p id=\"%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA-toc\" style=\"margin-left:80px;\"><a href=\"#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA\">效果展示</a></p>\n<hr id=\"hr-toc\"/>\n<p></p>\n<h1 id=\"%E4%B8%80%E3%80%81%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF\">一、全局事件总线</h1>\n<h2 id=\"%E4%BD%9C%E7%94%A8\" style=\"margin-left:.0001pt;text-align:justify;\"><strong><strong>作用</strong></strong></h2>\n<p style=\"margin-left:.0001pt;text-align:justify;\">一种组件间通信的方式 适用于任意组件间通信。</p>\n<h2 id=\"%E5%AE%89%E8%A3%85\" style=\"margin-left:.0001pt;text-align:justify;\"><strong><strong>安装</strong></strong></h2>\n<p style=\"margin-left:.0001pt;text-align:justify;\">安装全局事件总线:在入口文件main.js中，给VM添加$bus，任意组件都可以在原型中调用。</p>\n<pre><code class=\"language-javascript\">new Vue({\n  render: h =&gt; h(App),\n\n  beforeCreate(){\n  \t  Vue.prototype.$bus  = this\n  }\n\n}).$mount('#app')</code></pre>\n<h2 id=\"%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B\" style=\"margin-left:.0001pt;text-align:justify;\"><strong><strong>组件使用案例</strong></strong></h2>\n<h3 id=\"%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90\"><strong><strong>案例分析</strong></strong></h3>\n<p>创建两个子组件，如下组件，<strong>其中注释内容是演示订阅与发布无视即可</strong></p>\n<p>下面代码所演示的是，小明组件给小红组件姓名“小明”，小红组件给小明组件“年龄”，主要通过<span style=\"color:#fe2c24;\">自定义事件</span>，其中小明组件自定义“getName”,需要传递给小红组件，小红组件就需要“getName”来接收，也可以销毁传递</p>\n<p>发送代码如下</p>\n<pre><code class=\"language-javascript\">this.$bus.$emit('getName',this.name)//this.name是所要传递的值，</code></pre>\n<p>接收代码如下</p>\n<pre><code class=\"language-javascript\">this.$bus.$on('getName',(name)=&gt;{\n            console.log( '小红得到的名字',name);\n          })</code></pre>\n<p>销毁代码如下</p>\n<p>需要一个点击事件来触发</p>\n<pre><code class=\"language-javascript\">this.$bus.$off('getName')</code></pre>\n<h3 id=\"%E7%BB%84%E4%BB%B6%E4%B8%80%EF%BC%88%E5%B0%8F%E6%98%8E%EF%BC%89\">组件一（小明）</h3>\n<pre><code class=\"language-javascript\">&lt;template&gt;\n\t&lt;div&gt;\n\t\t姓名：{<!-- -->{name}}年龄：{<!-- -->{age}}&lt;button @click=\"sendMsg\"&gt;给小红组件传姓名&lt;/button&gt; &lt;button @click=\"del\"&gt;销毁传递&lt;/button&gt;\n\n\t&lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\n\t// import pubsub from 'pubsub-js'\n\texport default {\n\t  name: 'XiaoMing',\n\t  data(){\n\t\treturn{\n\t\t\tname:'小明',\n\t\t\tage:20\n\t\t}\n\t  },\n\t  methods:{\n\t\t  sendMsg(){\n\t\t\t//   pubsub.publish('usname',this.name)\n\n\t\t\t  this.$bus.$emit('getName',this.name)\n\t\t  },\n\t\t  del(){\n\t\t\tthis.$bus.$off('getName')\n\t\t\tconsole.log('已销毁');\n\t\t  }\n\t  },\n\tmounted(){\n\t\t// pubsub.subscribe('age',(e,page)=&gt;{\n\t\t// \tconsole.log('小明得到小红',e,page);\n\t\t// })\n\t\tthis.$bus.$on('getAge',(age)=&gt;{\n\t\t\tconsole.log('小明得到的年龄',age);\n\t\t})\n\t}\n\t}\n&lt;/script&gt;\n\n&lt;style&gt;\n&lt;/style&gt;</code></pre>\n<h3 id=\"%E7%BB%84%E4%BB%B6%E4%BA%8C%EF%BC%88%E5%B0%8F%E7%BA%A2%EF%BC%89\">组件二（小红）</h3>\n<pre><code class=\"language-javascript\">&lt;template&gt;\n\t&lt;div&gt;\n\t\t姓名：{<!-- -->{name}}年龄：{<!-- -->{age}} &lt;button @click=\"sendAge\"&gt;给小明组件传年龄&lt;/button&gt;&lt;button &gt;取消订阅&lt;/button&gt;\n\t&lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\n\t// import pubsub from 'pubsub-js'\n\texport default {\n\t  name:'XiaoHong',\n\t  data(){\n\t\treturn{\n\t\t\tname:'小红',\n\t\t\tage:18\n\t\t}\n\t  },\n\t  methods:{\n\t\tsendAge(){\n\t\t\t// pubsub.publish('age',this.age)\n\n\t\t\tthis.$bus.$emit('getAge',this.age)\n\t\t},\n\t\t// noRead(){\n\t\t// \tpubsub.unsubscribe(this.del)\n\t\t// }\n\t  },\n\t  mounted(){\n\t\t//   this.del=pubsub.subscribe('usname',(q,msg)=&gt;{\n\t\t// \t  console.log('小红得到小明',q,msg)\n\t\t//   }),\n\n\n\t\t  this.$bus.$on('getName',(name)=&gt;{\n\t\t\tconsole.log( '小红得到的名字',name);\n\t\t  })\n\t  },\t  \n\t}\n&lt;/script&gt;\n&lt;style&gt;\n&lt;/style&gt;</code></pre>\n<h3 id=\"%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA\">效果展示</h3>\n<p style=\"text-align:center;\"><img alt=\"\" src=\"https://img-blog.csdnimg.cn/047af9f6d5844c81bebc53105e993a57.gif\"/></p>\n<h1 id=\"%E4%BA%8C%E3%80%81%E8%AE%A2%E9%98%85%E4%B8%8E%E5%8F%91%E5%B8%83%C2%A0\">二、订阅与发布 </h1>\n<h2 style=\"margin-left:.0001pt;text-align:justify;\"><strong><strong>安装</strong></strong></h2>\n<p style=\"margin-left:.0001pt;text-align:justify;\">一种组件间通信的方式，适用于任意组件间通信，如今有很多消息订阅与发布的包，在这里只介绍一种，pubsub-js。</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">打开终端输入命令：<strong>npm i pubsub-js</strong></p>\n<h2 style=\"margin-left:.0001pt;text-align:justify;\">组件使用案例</h2>\n<h3>案例分析</h3>\n<p>通过订阅与发布的方式，小明组件给小红组件姓名，小红组件给小明组件年龄</p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">第一步我们需要引入:<span style=\"color:#fe2c24;\"><strong> import pubsub from 'pubsub-js'</strong></span></p>\n<p style=\"margin-left:.0001pt;text-align:justify;\">第二步通过在小明组件发布</p>\n<pre><code class=\"language-javascript\">pubsub.publish('usname',this.name) //usname:发布消息的名称，第二个参数：为发布内容</code></pre>\n<p>第三步在小红组件订阅</p>\n<pre><code class=\"language-javascript\"> this.del=pubsub.subscribe('usname',(q,msg)=&gt;{\n\t\t\t  console.log('小红得到小明',q,msg)\n\t\t  })</code></pre>\n<p>第四步想要取消订阅，自定义事件，绑定销毁，通过第三步的this.del</p>\n<pre><code class=\"language-javascript\">pubsub.unsubscribe(this.del)</code></pre>\n<h3>组件一（小明）</h3>\n<pre><code class=\"language-javascript\">&lt;template&gt;\n\t&lt;div&gt;\n\t\t姓名：{<!-- -->{name}}年龄：{<!-- -->{age}}&lt;button @click=\"sendMsg\"&gt;给小红组件传姓名&lt;/button&gt; &lt;button &gt;销毁传递&lt;/button&gt;\n\n\t&lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\n\timport pubsub from 'pubsub-js'\n\texport default {\n\t  name: 'XiaoMing',\n\t  data(){\n\t\treturn{\n\t\t\tname:'小明',\n\t\t\tage:20\n\t\t}\n\t  },\n\n\t  methods:{\n\t\t  sendMsg(){\n\t\t\t  pubsub.publish('usname',this.name)\n\n\t\t\t//   this.$bus.$emit('getName',this.name)\n\t\t  },\n\t\t//   del(){\n\t\t// \tthis.$bus.$off('getName')\n\t\t// \tconsole.log('已销毁');\n\t\t//   }\n\t  },\n\tmounted(){\n\t\tpubsub.subscribe('age',(e,page)=&gt;{\n\t\t\tconsole.log('小明得到小红',e,page);\n\t\t})\n\n\t\t// this.$bus.$on('getAge',(age)=&gt;{\n\t\t// \tconsole.log('小明得到的年龄',age);\n\t\t// })\n\t}\n\t}\n&lt;/script&gt;\n\n&lt;style&gt;\n&lt;/style&gt;</code></pre>\n<h3>组件二（小红）</h3>\n<pre><code class=\"language-javascript\">&lt;template&gt;\n\t&lt;div&gt;\n\t\t姓名：{<!-- -->{name}}年龄：{<!-- -->{age}} &lt;button @click=\"sendAge\"&gt;给小明组件传年龄&lt;/button&gt;&lt;button @click=\"noRead\"&gt;取消订阅&lt;/button&gt;\n\t&lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\n\timport pubsub from 'pubsub-js'\n\texport default {\n\t  name:'XiaoHong',\n\t  data(){\n\t\treturn{\n\t\t\tname:'小红',\n\t\t\tage:18\n\t\t}\n\t  },\n\t  methods:{\n\t\tsendAge(){\n\t\t\tpubsub.publish('age',this.age)\n\n\t\t\t// this.$bus.$emit('getAge',this.age)\n\t\t},\n\t\tnoRead(){\n\t\t\tpubsub.unsubscribe(this.del)\n\t\t}\n\t  },\n\t  mounted(){\n\t\t  this.del=pubsub.subscribe('usname',(q,msg)=&gt;{\n\t\t\t  console.log('小红得到小明',q,msg)\n\t\t  })\n\n\n\t\t//   this.$bus.$on('getName',(name)=&gt;{\n\t\t// \tconsole.log( '小红得到的名字',name);\n\t\t//   })\n\t  },\n\t\n\t  \n\t}\n&lt;/script&gt;\n\n&lt;style&gt;\n&lt;/style&gt;</code></pre>\n<h3>效果展示</h3>\n<p><img alt=\"\" height=\"556\" src=\"https://img-blog.csdnimg.cn/b3fa0fa603f549cd9eb5b7a8f22b2d36.gif\" width=\"882\"/></p>\n<p></p>\n</div>\n</div>", "first_tag": "JavaScript", "cpp": 0, "csharp": 0, "python": 0, "javascript": 1, "java": 0, "sql": 0, "php": 0, "time": "2022-08-22 08:22:25", "summary": "目录一、全局事件总线作用安装组件使用案例案例分析组件一小明组件二小红效果展示二、订阅与发布安装组件使用案例案例分析组件一小明组件二小红效果展示一、全局事件总线作用一种组件间通信的方式适用于任意组件间通"}