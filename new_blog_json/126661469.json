{"blogid": "126661469", "writerAge": "码龄15年", "writerBlogNum": "368", "writerCollect": "256", "writerComment": "69", "writerFan": "5880", "writerGrade": "6级", "writerIntegral": "5424", "writerName": "路过君_P", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126661469.jpg", "writerRankTotal": "5946", "writerRankWeekly": "2700", "writerThumb": "487", "writerVisitNum": "328265", "blog_read_count": "110", "blog_time": "于 2022-09-05 14:44:10 发布", "blog_title": "vite+vue3+ts开发组件库，发布npm", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-light\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<h1><a id=\"_0\"></a>版本</h1>\n<p>vite 3.0.7<br/> vue 3.2.27</p>\n<h1><a id=\"_3\"></a>所需依赖</h1>\n<p>@types/node 使用resolve解析项目路径<br/> vite-plugin-dts 1.4.1 自动生成ts声明文件</p>\n<h1><a id=\"_6\"></a>步骤</h1>\n<h2><a id=\"1_packagejson_7\"></a>1. 修改package.json</h2>\n<ol><li>修改配置模块入口指向构建输出的js文件</li></ol>\n<pre><code class=\"prism language-json\"><span class=\"token string-property property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./dist/my-lib.umd.cjs\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string-property property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./dist/my-lib.js\"</span>\n</code></pre>\n<ol start=\"2\"><li>修改ts声明文件指向构建输出的js声明文件</li></ol>\n<pre><code class=\"prism language-json\"><span class=\"token string-property property\">\"types\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\".dist/components/index.d.ts\"</span>\n</code></pre>\n<ol start=\"3\"><li>配置模块导入对应关系</li></ol>\n<pre><code class=\"prism language-json\"><span class=\"token string-property property\">\"exports\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token string-property property\">\".\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token string-property property\">\"import\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./dist/my-lib.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"require\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./dist/my-lib.umd.cjs\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</code></pre>\n<ol start=\"4\"><li>修改需要发布的文件清单</li></ol>\n<pre><code class=\"prism language-json\"><span class=\"token string-property property\">\"files\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"package.json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"README.md\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"LICENSE\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"dist\"</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</code></pre>\n<ol start=\"5\"><li>设置发布配置<br/> 默认私有发布，需要收费，这里配置公共发布</li></ol>\n<pre><code class=\"prism language-json\"><span class=\"token string-property property\">\"publishConfig\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n  <span class=\"token string-property property\">\"registry\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://registry.npmjs.org\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string-property property\">\"access\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"public\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</code></pre>\n<h2><a id=\"2_viteviteconfigts_43\"></a>2. 修改vite配置vite.config.ts</h2>\n<ol><li>启用lib模式</li><li>配置vite-plugin-dts插件</li></ol>\n<pre><code class=\"prism language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{<!-- --></span>resolve<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'path'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{<!-- --></span>defineConfig<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vite'</span>\n<span class=\"token keyword\">import</span> vue <span class=\"token keyword\">from</span> <span class=\"token string\">'@vitejs/plugin-vue'</span>\n<span class=\"token keyword\">import</span> dts <span class=\"token keyword\">from</span> <span class=\"token string\">'vite-plugin-dts'</span>\n<span class=\"token comment\">// https://vitejs.dev/config/</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">defineConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n    plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">dts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    build<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        lib<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n        \t<span class=\"token comment\">// 入口指向组件库入口模块</span>\n            entry<span class=\"token operator\">:</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'src/components/index.ts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            name<span class=\"token operator\">:</span> <span class=\"token string\">'my-lib'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// 构建生成的文件名，与package.json中配置一致</span>\n            fileName<span class=\"token operator\">:</span> <span class=\"token string\">'my-lib'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        rollupOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token comment\">// 确保外部化处理那些你不想打包进库的依赖</span>\n            external<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'vue'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            output<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n                globals<span class=\"token operator\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token comment\">// 在 UMD 构建模式下为这些外部化的依赖提供一个全局变量</span>\n                    vue<span class=\"token operator\">:</span> <span class=\"token string\">'Vue'</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<h2><a id=\"3__75\"></a>3. 创建组件库入口模块</h2>\n<p>./components/index.ts</p>\n<pre><code class=\"prism language-ts\"><span class=\"token keyword\">import</span> MyComponent <span class=\"token keyword\">from</span> <span class=\"token string\">\"./my-component'\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{<!-- --></span>App<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vue\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 按需导入用</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{<!-- --></span>\n\tMyComponent \n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 全局导入用</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token function-variable function\">install</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>app<span class=\"token operator\">:</span> App<span class=\"token punctuation\">)</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{<!-- --></span>\n        app<span class=\"token punctuation\">.</span><span class=\"token function\">component</span><span class=\"token punctuation\">(</span><span class=\"token string\">'MyComponent'</span><span class=\"token punctuation\">,</span> MyComponent<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h2><a id=\"4__92\"></a>4. 构建项目</h2>\n<h2><a id=\"5_npm_93\"></a>5. 发布npm</h2>\n<ol><li>登录npm</li></ol>\n<pre><code class=\"prism language-bash\"><span class=\"token function\">npm</span> login\n</code></pre>\n<ol start=\"2\"><li>发布(由于在package.json中指定了公共发布，这里不需要参数 --access public)</li></ol>\n<pre><code class=\"prism language-bash\"><span class=\"token function\">npm</span> publish\n</code></pre>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "Others", "cpp": 0, "csharp": 0, "python": 0, "javascript": 0, "java": 0, "sql": 0, "php": 0, "time": "2022-09-05 14:44:10", "summary": "版本所需依赖使用解析项目路径自动生成声明文件步骤修改修改配置模块入口指向构建输出的文件修改声明文件指向构建输出的声明文件配置模块导入对应关系修改需要发布的文件清单设置发布配置默认私有发布，需要收费，这"}