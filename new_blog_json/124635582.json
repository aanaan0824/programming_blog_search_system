{"blogid": "124635582", "writerAge": "码龄3年", "writerBlogNum": "264", "writerCollect": "3242", "writerComment": "869", "writerFan": "2813", "writerGrade": "7级", "writerIntegral": "13154", "writerName": "嵌入式悦翔园", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_124635582.jpg", "writerRankTotal": "1016", "writerRankWeekly": "2693", "writerThumb": "1580", "writerVisitNum": "1021320", "blog_read_count": "1382", "blog_time": "已于 2022-05-07 18:21:27 修改", "blog_title": "C# Winform中DataGridView导出为Excel（保姆级步骤）", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-atom-one-dark\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<p></p>\n<div class=\"toc\">\n<h3>Winform中DataGridView导出为Excel</h3>\n<ul><li><ul><li><a href=\"#1_1\">1、前言</a></li><li><a href=\"#2_3\">2、效果展示</a></li><li><a href=\"#3_8\">3、详细步骤</a></li><li><ul><li><a href=\"#31_NPOINPOIExcel_11\">3.1 添加NPOI和NPOI.Excel包</a></li><li><a href=\"#32_NPOIHelper_20\">3.2 创建NPOIHelper类</a></li><li><ul><li><a href=\"#321__25\">3.2.1 导入命名空间</a></li><li><a href=\"#322__41\">3.2.2 插入代码</a></li></ul>\n</li><li><a href=\"#33_SaveFileDialog_224\">3.3 给画面添加SaveFileDialog</a></li><li><ul><li><a href=\"#34__229\">3.4 引入命名空间</a></li></ul>\n</li><li><a href=\"#35_click_245\">3.5 给按钮添加click事件</a></li></ul>\n</li><li><a href=\"#4__265\">4、 成功</a></li><li><a href=\"#5_268\">5、写在最后</a></li></ul>\n</li></ul>\n</div>\n<p></p>\n<h2><a id=\"1_1\"></a>1、前言</h2>\n<p>大家再使用该教程成功后记得来点个赞哦！话不多说，跟着我的步骤保证你也能成功，下面直接开始！</p>\n<h2><a id=\"2_3\"></a>2、效果展示</h2>\n<p><strong>导出前</strong><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\f785404e7d2b4efa8a02d8311afc0b5f.png\"/><br/> <strong>导出后</strong><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\b8b80399f7ff4e9f999751b5929ad510.png\"/></p>\n<h2><a id=\"3_8\"></a>3、详细步骤</h2>\n<p>下面是详细操作步骤，请跟着我的步伐，一步一步进行操作，保证你能够导出成功！</p>\n<h3><a id=\"31_NPOINPOIExcel_11\"></a>3.1 添加NPOI和NPOI.Excel包</h3>\n<p>首先请请确定你的vs已经打开了【解决方案资源管理器】，打开步骤见下图：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\9d7ad541cccc49e3b3a051a4f55a2930.png\"/><br/> 在资源管理器中找到【引用】，然后在【引用】上右键选择【管理程序包】并点击，如下图：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\1b40552cb7d84dffad985b651f5cf912.png\"/><br/> 在新打开的窗口中点击【浏览】并在搜索框中依次输入NPOI和NPOI.Excel并进行安装，安装按钮位置如下图：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\58db834f86144f9dbfc6b95c0453f278.png\"/><br/> 待安装完成再进行下一步</p>\n<h3><a id=\"32_NPOIHelper_20\"></a>3.2 创建NPOIHelper类</h3>\n<p>首先在资源管理器中选中你的项目，【右键】找到【添加】–&gt;【类】，具体如下图：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\fe444683fb9643bca0669bc5890cc315.png\"/><br/> 创建一个名字为【NPOIHelper.cs】的类并打开</p>\n<h4><a id=\"321__25\"></a>3.2.1 导入命名空间</h4>\n<p>复制下面的代码，覆盖你自动生成的命名空间</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">NPOI<span class=\"token punctuation\">.</span>HSSF<span class=\"token punctuation\">.</span>UserModel</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">NPOI<span class=\"token punctuation\">.</span>SS<span class=\"token punctuation\">.</span>UserModel</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">NPOI<span class=\"token punctuation\">.</span>XSSF<span class=\"token punctuation\">.</span>UserModel</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Data</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>IO</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Linq</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Threading<span class=\"token punctuation\">.</span>Tasks</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms</span><span class=\"token punctuation\">;</span>\n\n</code></pre>\n<h4><a id=\"322__41\"></a>3.2.2 插入代码</h4>\n<p>将下面的代码导入到下图位置：<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\2260e1fc027b45c295a92c991d69db58.png\"/></p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ExcelUtility</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token comment\">/// &lt;summary&gt;</span>\n            <span class=\"token comment\">/// 将excel导入到datatable</span>\n            <span class=\"token comment\">/// &lt;/summary&gt;</span>\n            <span class=\"token comment\">/// &lt;param name=\"filePath\"&gt;excel路径&lt;/param&gt;</span>\n            <span class=\"token comment\">/// &lt;param name=\"isColumnName\"&gt;第一行是否是列名&lt;/param&gt;</span>\n            <span class=\"token comment\">/// &lt;returns&gt;返回datatable&lt;/returns&gt;</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\">DataTable</span> <span class=\"token function\">ExcelToDataTable</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span></span> filePath<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">bool</span></span> isColumnName<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token class-name\">DataTable</span> dataTable <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">FileStream</span> fs <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">DataColumn</span> column <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">DataRow</span> dataRow <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">IWorkbook</span> workbook <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">ISheet</span> sheet <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">IRow</span> row <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\">ICell</span> cell <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> startRow <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">try</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span>fs <span class=\"token operator\">=</span> File<span class=\"token punctuation\">.</span><span class=\"token function\">OpenRead</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        <span class=\"token comment\">// 版本后缀控制</span>\n                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".xlsx\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n                            workbook <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">XSSFWorkbook</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token comment\">// 版本后缀控制</span>\n                        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">.</span><span class=\"token function\">IndexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".xls\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n                            workbook <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">HSSFWorkbook</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>workbook <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">{<!-- --></span>\n                            sheet <span class=\"token operator\">=</span> workbook<span class=\"token punctuation\">.</span><span class=\"token function\">GetSheetAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//读取第一个sheet，当然也可以循环读取每个sheet</span>\n                            dataTable <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">DataTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sheet <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                            <span class=\"token punctuation\">{<!-- --></span>\n                                <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> rowCount <span class=\"token operator\">=</span> sheet<span class=\"token punctuation\">.</span>LastRowNum<span class=\"token punctuation\">;</span><span class=\"token comment\">//总行数</span>\n                                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rowCount <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n                                <span class=\"token punctuation\">{<!-- --></span>\n                                    <span class=\"token class-name\">IRow</span> firstRow <span class=\"token operator\">=</span> sheet<span class=\"token punctuation\">.</span><span class=\"token function\">GetRow</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//第一行</span>\n                                    <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> cellCount <span class=\"token operator\">=</span> firstRow<span class=\"token punctuation\">.</span>LastCellNum<span class=\"token punctuation\">;</span><span class=\"token comment\">//列数</span>\n\n                                    <span class=\"token comment\">//构建datatable的列</span>\n                                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isColumnName<span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">{<!-- --></span>\n                                        startRow <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//如果第一行是列名，则从第二行开始读取</span>\n                                        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> firstRow<span class=\"token punctuation\">.</span>FirstCellNum<span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> cellCount<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span>\n                                        <span class=\"token punctuation\">{<!-- --></span>\n                                            cell <span class=\"token operator\">=</span> firstRow<span class=\"token punctuation\">.</span><span class=\"token function\">GetCell</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cell <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                                            <span class=\"token punctuation\">{<!-- --></span>\n                                                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cell<span class=\"token punctuation\">.</span>StringCellValue <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                                                <span class=\"token punctuation\">{<!-- --></span>\n                                                    column <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">DataColumn</span><span class=\"token punctuation\">(</span>cell<span class=\"token punctuation\">.</span>StringCellValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                                    dataTable<span class=\"token punctuation\">.</span>Columns<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>column<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                                <span class=\"token punctuation\">}</span>\n                                            <span class=\"token punctuation\">}</span>\n                                        <span class=\"token punctuation\">}</span>\n                                    <span class=\"token punctuation\">}</span>\n                                    <span class=\"token keyword\">else</span>\n                                    <span class=\"token punctuation\">{<!-- --></span>\n                                        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> firstRow<span class=\"token punctuation\">.</span>FirstCellNum<span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> cellCount<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span>\n                                        <span class=\"token punctuation\">{<!-- --></span>\n                                            column <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">DataColumn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"column\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                            dataTable<span class=\"token punctuation\">.</span>Columns<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>column<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                        <span class=\"token punctuation\">}</span>\n                                    <span class=\"token punctuation\">}</span>\n\n                                    <span class=\"token comment\">//填充行</span>\n                                    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> startRow<span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> rowCount<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span>\n                                    <span class=\"token punctuation\">{<!-- --></span>\n                                        row <span class=\"token operator\">=</span> sheet<span class=\"token punctuation\">.</span><span class=\"token function\">GetRow</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>row <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n\n                                        dataRow <span class=\"token operator\">=</span> dataTable<span class=\"token punctuation\">.</span><span class=\"token function\">NewRow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> j <span class=\"token operator\">=</span> row<span class=\"token punctuation\">.</span>FirstCellNum<span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> cellCount<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>j<span class=\"token punctuation\">)</span>\n                                        <span class=\"token punctuation\">{<!-- --></span>\n                                            cell <span class=\"token operator\">=</span> row<span class=\"token punctuation\">.</span><span class=\"token function\">GetCell</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cell <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                                            <span class=\"token punctuation\">{<!-- --></span>\n                                                dataRow<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n                                            <span class=\"token punctuation\">}</span>\n                                            <span class=\"token keyword\">else</span>\n                                            <span class=\"token punctuation\">{<!-- --></span>\n                                                <span class=\"token comment\">//CellType(Unknown = -1,Numeric = 0,String = 1,Formula = 2,Blank = 3,Boolean = 4,Error = 5,)</span>\n                                                <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>cell<span class=\"token punctuation\">.</span>CellType<span class=\"token punctuation\">)</span>\n                                                <span class=\"token punctuation\">{<!-- --></span>\n                                                    <span class=\"token keyword\">case</span> CellType<span class=\"token punctuation\">.</span>Blank<span class=\"token punctuation\">:</span>\n                                                        dataRow<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n                                                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                                                    <span class=\"token keyword\">case</span> CellType<span class=\"token punctuation\">.</span>Numeric<span class=\"token punctuation\">:</span>\n                                                        <span class=\"token class-name\"><span class=\"token keyword\">short</span></span> format <span class=\"token operator\">=</span> cell<span class=\"token punctuation\">.</span>CellStyle<span class=\"token punctuation\">.</span>DataFormat<span class=\"token punctuation\">;</span>\n                                                        <span class=\"token comment\">//对时间格式（2015.12.5、2015/12/5、2015-12-5等）的处理</span>\n                                                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>format <span class=\"token operator\">==</span> <span class=\"token number\">14</span> <span class=\"token operator\">||</span> format <span class=\"token operator\">==</span> <span class=\"token number\">31</span> <span class=\"token operator\">||</span> format <span class=\"token operator\">==</span> <span class=\"token number\">57</span> <span class=\"token operator\">||</span> format <span class=\"token operator\">==</span> <span class=\"token number\">58</span><span class=\"token punctuation\">)</span>\n                                                            dataRow<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> cell<span class=\"token punctuation\">.</span>DateCellValue<span class=\"token punctuation\">;</span>\n                                                        <span class=\"token keyword\">else</span>\n                                                            dataRow<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> cell<span class=\"token punctuation\">.</span>NumericCellValue<span class=\"token punctuation\">;</span>\n                                                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                                                    <span class=\"token keyword\">case</span> CellType<span class=\"token punctuation\">.</span>String<span class=\"token punctuation\">:</span>\n                                                        dataRow<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> cell<span class=\"token punctuation\">.</span>StringCellValue<span class=\"token punctuation\">;</span>\n                                                        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n                                                <span class=\"token punctuation\">}</span>\n                                            <span class=\"token punctuation\">}</span>\n                                        <span class=\"token punctuation\">}</span>\n                                        dataTable<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">.</span><span class=\"token function\">Add</span><span class=\"token punctuation\">(</span>dataRow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                                    <span class=\"token punctuation\">}</span>\n                                <span class=\"token punctuation\">}</span>\n                            <span class=\"token punctuation\">}</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword\">return</span> dataTable<span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fs <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        fs<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> <span class=\"token function\">DataTableToExcel</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DataTable</span> dt<span class=\"token punctuation\">,</span> <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> txtPath<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{<!-- --></span>\n            <span class=\"token class-name\"><span class=\"token keyword\">bool</span></span> result <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">IWorkbook</span> workbook <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">FileStream</span> fs <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">IRow</span> row <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">ISheet</span> sheet <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">ICell</span> cell <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">try</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>dt <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> dt<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">.</span>Count <span class=\"token operator\">&gt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    workbook <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">HSSFWorkbook</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    sheet <span class=\"token operator\">=</span> workbook<span class=\"token punctuation\">.</span><span class=\"token function\">CreateSheet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Sheet0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//创建一个名称为Sheet0的表</span>\n                    <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> rowCount <span class=\"token operator\">=</span> dt<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span><span class=\"token comment\">//行数</span>\n                    <span class=\"token class-name\"><span class=\"token keyword\">int</span></span> columnCount <span class=\"token operator\">=</span> dt<span class=\"token punctuation\">.</span>Columns<span class=\"token punctuation\">.</span>Count<span class=\"token punctuation\">;</span><span class=\"token comment\">//列数</span>\n\n                    <span class=\"token comment\">//设置列头</span>\n                    row <span class=\"token operator\">=</span> sheet<span class=\"token punctuation\">.</span><span class=\"token function\">CreateRow</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//excel第一行设为列头</span>\n                    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> c <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> c <span class=\"token operator\">&lt;</span> columnCount<span class=\"token punctuation\">;</span> c<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        cell <span class=\"token operator\">=</span> row<span class=\"token punctuation\">.</span><span class=\"token function\">CreateCell</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        cell<span class=\"token punctuation\">.</span><span class=\"token function\">SetCellValue</span><span class=\"token punctuation\">(</span>dt<span class=\"token punctuation\">.</span>Columns<span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>ColumnName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n\n                    <span class=\"token comment\">//设置每行每列的单元格,</span>\n                    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> rowCount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        row <span class=\"token operator\">=</span> sheet<span class=\"token punctuation\">.</span><span class=\"token function\">CreateRow</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">int</span></span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> columnCount<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">{<!-- --></span>\n                            cell <span class=\"token operator\">=</span> row<span class=\"token punctuation\">.</span><span class=\"token function\">CreateCell</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//excel第二行开始写入数据</span>\n                            cell<span class=\"token punctuation\">.</span><span class=\"token function\">SetCellValue</span><span class=\"token punctuation\">(</span>dt<span class=\"token punctuation\">.</span>Rows<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">j</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span>fs <span class=\"token operator\">=</span> File<span class=\"token punctuation\">.</span><span class=\"token function\">OpenWrite</span><span class=\"token punctuation\">(</span>txtPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">{<!-- --></span>\n                        workbook<span class=\"token punctuation\">.</span><span class=\"token function\">Write</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//向打开的这个xls文件中写入数据</span>\n                        result <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n                MessageBox<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"导出成功\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{<!-- --></span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fs <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">{<!-- --></span>\n                    fs<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n        <span class=\"token punctuation\">}</span>\n</code></pre>\n<h3><a id=\"33_SaveFileDialog_224\"></a>3.3 给画面添加SaveFileDialog</h3>\n<p>首先在工具箱里找到SaveFileDialog（如果不知到工具箱在哪的可以点击上方的【视图】–&gt; 【工具箱】）<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\054377b1add94ae88d46cb93fd931687.png\"/><br/> 点住SaveFileDialog拖入页面中效果如上图所示</p>\n<h4><a id=\"34__229\"></a>3.4 引入命名空间</h4>\n<p>将下方命名空间引入到你按钮所在的cs中（主要是3、4）</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Collections<span class=\"token punctuation\">.</span>Generic</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>ComponentModel</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Data</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Drawing</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Linq</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Text</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Threading<span class=\"token punctuation\">.</span>Tasks</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Windows<span class=\"token punctuation\">.</span>Forms</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">System<span class=\"token punctuation\">.</span>Data<span class=\"token punctuation\">.</span>OleDb</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3><a id=\"35_click_245\"></a>3.5 给按钮添加click事件</h3>\n<p>给按钮添加click事件（直接双击按钮即可），并在click函数中插入以下代码</p>\n<pre><code class=\"prism language-csharp\"><span class=\"token comment\">//打开文件对话框，导出文件</span>\n<span class=\"token class-name\">SaveFileDialog</span> saveFileDialog1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SaveFileDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsaveFileDialog1<span class=\"token punctuation\">.</span>Title <span class=\"token operator\">=</span> <span class=\"token string\">\"保存文件\"</span><span class=\"token punctuation\">;</span>\nsaveFileDialog1<span class=\"token punctuation\">.</span>Filter <span class=\"token operator\">=</span> <span class=\"token string\">\"Excel 文件(*.xls)|*.xls|Excel 文件(*.xlsx)|*.xlsx|所有文件(*.*)|*.*\"</span><span class=\"token punctuation\">;</span>\nsaveFileDialog1<span class=\"token punctuation\">.</span>FileName <span class=\"token operator\">=</span> <span class=\"token string\">\"用户信息.xls\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//设置默认另存为的名字</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saveFileDialog1<span class=\"token punctuation\">.</span><span class=\"token function\">ShowDialog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> DialogResult<span class=\"token punctuation\">.</span>OK<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{<!-- --></span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> txtPath <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>saveFileDialog1<span class=\"token punctuation\">.</span>FileName<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> sql <span class=\"token operator\">=</span> <span class=\"token string\">\"select ID as ID,UserName as 用户名,LoginAccount as 账号,UserPower as 用户权限,Founder as 创建者,Addtime as 创建日期,Activestate as 状态 from UserData\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">SqlHelp</span> sqlHelper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">SqlHelp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">DataTable</span> dt <span class=\"token operator\">=</span> sqlHelper<span class=\"token punctuation\">.</span><span class=\"token function\">GetDataTableValue</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    NPOIHelper<span class=\"token punctuation\">.</span><span class=\"token function\">DataTableToExcel</span><span class=\"token punctuation\">(</span>dt<span class=\"token punctuation\">,</span> txtPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>注意：上面的saveFileDialog1要和你视图里的一样一般没问题，sql语句我就不详细讲了不会的可以看我其他文章。</p>\n<h2><a id=\"4__265\"></a>4、 成功</h2>\n<p>相信大家根据我的步骤应该都能成功了，如果成功了别忘了三连哦！如果在操作过程中遇到什么问题记得评论或者私信。</p>\n<h2><a id=\"5_268\"></a>5、写在最后</h2>\n<p>大家如果也在学习C# winform可以关注，后期会继续给大家分享c#知识。另外大家需要嵌入式资料的话可以关注一下下方的公众号哦！回复“资源”获取。</p>\n<div align=\"center\">\n<font color=\"red\" face=\"黑体\" size=\"3\">👇点击下方公众号卡片获取资料👇</font>\n</div>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "SQL", "cpp": 0, "csharp": 1, "python": 0, "javascript": 0, "java": 0, "sql": 1, "php": 0, "time": "2022-05-07 18:21:27", "summary": "中导出为、前言、效果展示、详细步骤添加和包创建类导入命名空间插入代码给画面添加引入命名空间给按钮添加事件、成功、写在最后、前言大家再使用该教程成功后记得来点个赞哦！话不多说，跟着我的步骤保证你也能成功"}