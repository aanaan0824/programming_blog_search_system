{"blogid": "126736239", "writerAge": "码龄6年", "writerBlogNum": "21", "writerCollect": "167", "writerComment": "196", "writerFan": "270", "writerGrade": "3级", "writerIntegral": "748", "writerName": "北京前端 年薪100w+", "writerProfileAdress": "..\\..\\static\\writer_image\\profile_126736239.jpg", "writerRankTotal": "34708", "writerRankWeekly": "734", "writerThumb": "236", "writerVisitNum": "3438", "blog_read_count": "226", "blog_time": "已于 2022-09-07 08:00:34 修改", "blog_title": "uniapp｜微信小程序获取当前城市名称--逆地址解析", "content": "<div class=\"article_content clearfix\" id=\"article_content\">\n<link href=\"../../static/bootstrap/css/csdnstyle.css\" rel=\"stylesheet\"/>\n<div class=\"markdown_views prism-tomorrow-night-eighties\" id=\"content_views\">\n<svg style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M5,0 0,2.5 5,5z\" id=\"raphael-marker-block\" stroke-linecap=\"round\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);\"></path>\n</svg>\n<blockquote>\n<p><em>六年代码两茫茫，不思量，自难忘</em><br/> 6年资深前端主管一枚，只分享技术干货，项目实战经验<br/> <strong>关注博主不迷路~</strong></p>\n</blockquote>\n<p></p>\n<div class=\"toc\">\n<h3>文章目录</h3>\n<ul><li><a href=\"#_7\">问题</a></li><li><a href=\"#_9\">解决步骤</a></li><li><ul><li><a href=\"#_10\">看文档</a></li><li><a href=\"#_38\">逆地址解析</a></li><li><ul><li><a href=\"#1__39\">1. 创建应用</a></li><li><a href=\"#2_uniapp_50\">2. uniapp配置</a></li><li><a href=\"#3__66\">3. 代码部分</a></li></ul>\n</li></ul>\n</li><li><a href=\"#_112\">总结</a></li></ul>\n</div>\n<p></p>\n<hr/>\n<h1><a id=\"_7\"></a>问题</h1>\n<p>uniapp开发的小程序需要获取当前城市名称</p>\n<h1><a id=\"_9\"></a>解决步骤</h1>\n<h2><a id=\"_10\"></a>看文档</h2>\n<p>当然是看uniapp文档，我们查到有提供相关的API,即<code>uni.getLocation(OBJECT)</code>，获取当前的地理位置、速度。<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\60e55b3644d74d5d9894908ac6579223.png\"/><br/> 我们试试吧</p>\n<pre><code class=\"prism language-bash\">uni.getLocation<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n\ttype: <span class=\"token string\">'wgs84'</span>,\n\tgeocode:true,\n\tsuccess: <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\tconsole.log<span class=\"token punctuation\">(</span><span class=\"token string\">'当前位置的经度：'</span> + res.longitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tconsole.log<span class=\"token punctuation\">(</span><span class=\"token string\">'当前位置的纬度：'</span> + res.latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n</code></pre>\n<p>我们发现只能返回经纬度信息，并不会返回城市信息。<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\cc3d906cb72947c1970789a33c8d36eb.png\"/><br/> <mark>原来是只有app才支持geocode</mark><br/> 哈哈事情没有想象中那么简单~</p>\n<hr/>\n<p><strong>思考ing…</strong></p>\n<p>查阅了相关资料，<code>原来是位置详细信息的一些保密协议，并不能直接获取到</code>。那么我们就需要通过经纬度，利用腾讯地图JavaScript SDK逆地址解析,即输入坐标返回地理位置信息。</p>\n<hr/>\n<p><strong>有方法了，开整</strong></p>\n<h2><a id=\"_38\"></a>逆地址解析</h2>\n<h3><a id=\"1__39\"></a>1. 创建应用</h3>\n<p>打开<a href=\"https://lbs.qq.com/\">腾讯地图开放平台</a>，创建应用<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\51eba9571bc24a53aa47a674ac73927d.png\"/><br/> 然后<br/> 控制台 -&gt;应用管理 -&gt; 我的应用 -&gt;添加key-&gt; 勾选<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8cb1af3f4179410b969fdd73abb342bb.png\"/><br/> <code>小程序SDK需要用到webserviceAPI的部分服务，所以使用该功能的KEY需要具备相应的权限</code><br/> <code>授权ip即当前连接服务的IP地址（注意：上线后这个一定要换成上线IP地址哦）</code><br/> <code>填入微信小程序appid</code><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\aa032369f61544eca75be517c26baa82.png\"/><br/> 现在有了地图秘钥key</p>\n<h3><a id=\"2_uniapp_50\"></a>2. uniapp配置</h3>\n<ol><li>pages.json配置<br/> 加入以下配置项，用于申请获得位置权限</li></ol>\n<pre><code class=\"prism language-bash\"><span class=\"token string\">\"permission\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t<span class=\"token string\">\"scope.userLocation\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t<span class=\"token string\">\"desc\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"你的位置信息将用于小程序位置接口的效果展示\"</span> \n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<ol start=\"2\"><li>uniapp配置<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8f78e23be9c74433b0cff458e49b4d57.png\"/><br/> <code>这里填写的描述信息就是微信弹起信息微信授权弹框的描述信息</code><br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\d13b689b6c7443cf9d180335c23a259e.png\"/></li></ol>\n<h3><a id=\"3__66\"></a>3. 代码部分</h3>\n<p><a href=\"https://mapapi.qq.com/web/miniprogram/JSSDK/qqmap-wx-jssdk1.2.zip\">下载微信小程序JavaScriptSDK</a></p>\n<pre><code class=\"prism language-bash\">var QQMapWX <span class=\"token operator\">=</span> require<span class=\"token punctuation\">(</span><span class=\"token string\">'@/utils/qqmap-wx-jssdk.min.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n// 实例化API核心类\nvar qqmapsdk <span class=\"token operator\">=</span> new QQMapWX<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n    key: <span class=\"token string\">''</span> // 必填\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p><code>key即申请的腾讯地图秘钥key</code></p>\n<pre><code class=\"prism language-bash\">uni.getLocation<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\ttype: <span class=\"token string\">'gcj02'</span>,\n\t\t\tgeocode: true,\n\t\t\tsuccess: <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t//逆地址解析  坐标转地址信息\n\t\t\t\tqqmapsdk.reverseGeocoder<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t  //Object格式\n\t\t\t\t       location: <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t         latitude: res.latitude,\n\t\t\t\t         longitude: res.longitude\n\t\t\t\t       <span class=\"token punctuation\">}</span>, \n\t\t\t\t    success: function<span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>//成功后的回调\n\t\t\t\t\t   const mapdata<span class=\"token operator\">=</span>res.result.ad_info<span class=\"token punctuation\">;</span>\n\t\t\t\t\t   that.city <span class=\"token operator\">=</span> mapdata.city<span class=\"token punctuation\">;</span>\n\t\t\t\t   <span class=\"token punctuation\">}</span>,fail: function<span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t       console.error<span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t     <span class=\"token punctuation\">}</span>,\n\t\t\t\t     complete: function<span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{<!-- --></span>\n\t\t\t\t       //console.log<span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t     <span class=\"token punctuation\">}</span>\n\t\t\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>编译<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\8a942c366cf849f187987c82be6e1f54.png\"/></p>\n<p>我们看返回信息<br/> <img alt=\"在这里插入图片描述\" src=\"..\\..\\static\\image\\3d1c0ecd349f4c4386c65b27843e9c37.png\"/><br/> 现在是有返回当前位置详细信息了，当前也包括城市名称。</p>\n<p><strong>问题解决！</strong></p>\n<hr/>\n<h1><a id=\"_112\"></a>总结</h1>\n<p>遇到问题并不可怕，可怕的是停滞不前，知难而退。只有发现问题才能解决问题，才会得到成长和锻炼。人生的路总是一波三折，代码也是，风雨之后总会见到彩虹的，加油！</p>\n<blockquote>\n<p>✨原 创 不 易 ， 还 希 望 各 位 支 持<br/> 👍 点 赞 ， 你 的 认 可 是 我 创 作 的 动 力 ！<br/> ⭐️ 收 藏 ， 你 的 青 睐 是 我 努 力 的 方 向 ！<br/> ✏️ 评 论 ， 你 的 意 见 是 我 进 步 的 财 富 ！</p>\n</blockquote>\n</div>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-22a2fefd3b.css\" rel=\"stylesheet\"/>\n<link href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-4f8fbf9108.css\" rel=\"stylesheet\"/>\n</div>", "first_tag": "JavaScript", "cpp": 0, "csharp": 0, "python": 0, "javascript": 1, "java": 0, "sql": 0, "php": 0, "time": "2022-09-07 08:00:34", "summary": "六年代码两茫茫，不思量，自难忘年资深前端主管一枚，只分享技术干货，项目实战经验关注博主不迷路文章目录问题解决步骤看文档逆地址解析创建应用配置代码部分总结问题开发的小程序需要获取当前城市名称解决步骤看文"}